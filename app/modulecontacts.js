/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-15 08:39:15
 *
 *                     build: 2023.02.001.1692081555935
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_contacts_modulecontacts_ts"],{1435:(e,s,t)=>{t.r(s),t.d(s,{ModuleContacts:()=>ae});var i=t(1180),l=t(4755),a=t(5030),n=t(4357),o=t(3190),d=t(4826),r=t(6490),c=t(3735),u=t(2242),h=t(5329),g=t(5710),m=t(4044),p=t(3463);let b=(()=>{var e;class ContactNewslettersButton{constructor(e,s,t,l){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"ViewContainerRef",void 0),(0,i.Z)(this,"disabled",!0),this.language=e,this.model=s,this.modal=t,this.ViewContainerRef=l}ngOnInit(){this.handleDisabled(),this.model.mode$.subscribe((e=>{this.handleDisabled()})),this.model.data$.subscribe((e=>{this.handleDisabled()}))}execute(){this.modal.openModal("ContactNewsletters",!0,this.ViewContainerRef.injector)}handleDisabled(){this.disabled=!(this.model.getField("email1")&&!this.model.isEditing&&this.model.checkAccess("edit"))}}return e=ContactNewslettersButton,(0,i.Z)(ContactNewslettersButton,"ɵfac",(function(s){return new(s||e)(u.Y36(h.d),u.Y36(g.o),u.Y36(m.o),u.Y36(u.s_b))})),(0,i.Z)(ContactNewslettersButton,"ɵcmp",u.Xpm({type:e,selectors:[["contact-newsletters-button"]],decls:2,vars:0,consts:[["label","LBL_MANAGE_SUBSCRIPTIONS"]],template:function(e,s){1&e&&(u.TgZ(0,"span"),u._UZ(1,"system-label",0),u.qZA())},dependencies:[p._],encapsulation:2})),ContactNewslettersButton})();var f=t(4505),Z=t(4154),_=t(2656),x=t(9621),v=t(3499),w=t(5767),y=t(1916);function L(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"li",16),u.NdJ("click",(function(){const s=u.CHM(e).$implicit,t=u.oxw();return u.KtG(t.selectNewsletter("available",s.id))})),u.TgZ(1,"span",17),u._uU(2),u.qZA()()}if(2&e){const e=s.$implicit,t=u.oxw();u.uIk("aria-selected",t.isSelected("available",e.id)),u.xp6(2),u.Oqu(e.summary_text)}}function A(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"li",16),u.NdJ("click",(function(){const s=u.CHM(e).$implicit,t=u.oxw();return u.KtG(t.selectNewsletter("subscribed",s.id))})),u.TgZ(1,"span",17),u._uU(2),u.qZA()()}if(2&e){const e=s.$implicit,t=u.oxw();u.uIk("aria-selected",t.isSelected("subscribed",e.id)),u.xp6(2),u.Oqu(e.summary_text)}}let C=(()=>{var e;class ContactNewsletters{constructor(e,s,t,l){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"rawResult",{}),(0,i.Z)(this,"availableNewsLetters",[]),(0,i.Z)(this,"subscribedNewsLetters",[]),(0,i.Z)(this,"selectedAvailable",[]),(0,i.Z)(this,"selectedSubscribed",[]),(0,i.Z)(this,"multiselect",!1),(0,i.Z)(this,"self",{}),this.language=e,this.backend=s,this.metadata=t,this.model=l,this.backend.getRequest("module/Contacts/"+this.model.id+"/newsletters/subscriptions").subscribe((e=>{this.rawResult=e;let s={};for(let t of e.news_type_list_arr)switch(t.list_type){case"default":s[t.campaign_id]||(s[t.campaign_id]={name:t.name},s[t.campaign_id].defaultList=t.prospect_list_id);break;case"exempt":s[t.campaign_id]||(s[t.campaign_id]={name:t.name}),s[t.campaign_id].exemptList=t.prospect_list_id}for(let t of e.current_plp_arr)for(let e in s)s[e].defaultList==t.prospect_list_id?(this.subscribedNewsLetters.push({id:e,summary_text:s[e].name,defaultList:s[e].defaultList,exemptList:s[e].exemptList}),delete s[e]):s[e].defaultList==t.prospect_list_id&&(this.availableNewsLetters.push({id:e,summary_text:s[e].name,defaultList:s[e].defaultList,exemptList:s[e].exemptList}),delete s[e]);for(let e in s)this.availableNewsLetters.push({id:e,summary_text:s[e].name,defaultList:s[e].defaultList,exemptList:s[e].exemptList}),delete s[e]}))}closePopup(){this.self.destroy()}keypressed(e){"keydown"===e.type&&"Control"===e.key&&!1===this.multiselect&&(this.multiselect=!0),"keyup"===e.type&&"Control"===e.key&&!0===this.multiselect&&(this.multiselect=!1)}isSelected(e,s){switch(e){case"available":return this.selectedAvailable.indexOf(s)>=0;case"subscribed":return this.selectedSubscribed.indexOf(s)>=0}}selectNewsletter(e,s){switch(e){case"available":!1===this.multiselect?this.selectedAvailable=[s]:this.selectedAvailable.indexOf(s)>=0?this.selectedAvailable.splice(this.selectedAvailable.indexOf(s),1):this.selectedAvailable.push(s);break;case"subscribed":!1===this.multiselect?this.selectedSubscribed=[s]:this.selectedSubscribed.indexOf(s)>=0?this.selectedSubscribed.splice(this.selectedSubscribed.indexOf(s),1):this.selectedSubscribed.push(s)}}subscribe(){this.selectedAvailable.forEach((e=>{this.availableNewsLetters.some(((s,t)=>{if(e==s.id)return this.subscribedNewsLetters.push(this.availableNewsLetters.splice(t,1)[0]),!0}))})),this.selectedAvailable=[]}unsubscribe(){this.selectedSubscribed.forEach((e=>{this.subscribedNewsLetters.some(((s,t)=>{if(e==s.id)return this.availableNewsLetters.push(this.subscribedNewsLetters.splice(t,1)[0]),!0}))})),this.selectedSubscribed=[]}save(){let e={subscribed:this.subscribedNewsLetters,unsubscribed:this.availableNewsLetters};this.backend.postRequest("module/Contacts/"+this.model.id+"/newsletters/subscriptions",{},e).subscribe((e=>{this.closePopup()}))}}return e=ContactNewsletters,(0,i.Z)(ContactNewsletters,"ɵfac",(function(s){return new(s||e)(u.Y36(h.d),u.Y36(f.y),u.Y36(Z.Pu),u.Y36(g.o))})),(0,i.Z)(ContactNewsletters,"ɵcmp",u.Xpm({type:e,selectors:[["contact-newsletters"]],decls:30,vars:7,consts:[[3,"close"],[1,"slds-text-heading--medium"],[1,"slds-picklist--draggable","slds-grid","slds-grid--align-center"],[1,"slds-grid","slds-grid--align-center"],[1,"slds-form-element"],["aria-label","select-1",1,"slds-form-element__label"],[1,"slds-picklist"],[1,"slds-picklist__options","slds-picklist__options--multi"],["draggable","false","class","slds-picklist__item","role","option",3,"click",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical"],[1,"slds-button","slds-button--icon-container",3,"disabled","click"],[3,"icon"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],["draggable","false","role","option",1,"slds-picklist__item",3,"click"],[1,"slds-truncate"]],template:function(e,s){1&e&&(u.TgZ(0,"system-modal")(1,"system-modal-header",0),u.NdJ("close",(function(){return s.closePopup()})),u.TgZ(2,"h2",1),u._uU(3),u.qZA()(),u.TgZ(4,"system-modal-content")(5,"div",2)(6,"div",3)(7,"div",4)(8,"span",5),u._uU(9,"Available Newsletters"),u.qZA(),u.TgZ(10,"div",6)(11,"ul",7),u.YNc(12,L,3,2,"li",8),u.qZA()()(),u.TgZ(13,"div",9)(14,"button",10),u.NdJ("click",(function(){return s.unsubscribe()})),u._UZ(15,"system-button-icon",11),u.qZA(),u.TgZ(16,"button",10),u.NdJ("click",(function(){return s.subscribe()})),u._UZ(17,"system-button-icon",11),u.qZA()()(),u.TgZ(18,"div",3)(19,"div",4)(20,"span",5),u._uU(21,"Subscribed Newsletters"),u.qZA(),u.TgZ(22,"div",6)(23,"ul",7),u.YNc(24,A,3,2,"li",8),u.qZA()()()()()(),u.TgZ(25,"system-modal-footer")(26,"button",12),u.NdJ("click",(function(){return s.closePopup()})),u._UZ(27,"system-label",13),u.qZA(),u.TgZ(28,"button",14),u.NdJ("click",(function(){return s.save()})),u._UZ(29,"system-label",15),u.qZA()()()),2&e&&(u.xp6(3),u.hij("Newsletter Subscriptions for ",s.model.data.name,""),u.xp6(9),u.Q6J("ngForOf",s.availableNewsLetters),u.xp6(2),u.Q6J("disabled",0===s.selectedSubscribed.length),u.xp6(1),u.Q6J("icon","left"),u.xp6(1),u.Q6J("disabled",0===s.selectedAvailable.length),u.xp6(1),u.Q6J("icon","right"),u.xp6(7),u.Q6J("ngForOf",s.subscribedNewsLetters))},dependencies:[l.sg,_.J,p._,x.j,v.x,w.p,y.y],encapsulation:2})),ContactNewsletters})(),N=(()=>{var e;class ContactPortalButton{constructor(e,s,t,l,a){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"viewContainerRef",void 0),(0,i.Z)(this,"disabled",!0),this.language=e,this.model=s,this.metadata=t,this.modal=l,this.viewContainerRef=a}ngOnInit(){this.handleDisabled(),this.model.mode$.subscribe((e=>{this.handleDisabled()})),this.model.data$.subscribe((e=>{this.handleDisabled()}))}handleDisabled(){this.disabled=!((this.model.getField("email1")||this.model.getField("email_address_private"))&&!this.model.isEditing&&this.model.checkAccess("edit"))}execute(){this.modal.openModal("ContactPortalDetails",!0,this.viewContainerRef.injector)}}return e=ContactPortalButton,(0,i.Z)(ContactPortalButton,"ɵfac",(function(s){return new(s||e)(u.Y36(h.d),u.Y36(g.o),u.Y36(Z.Pu),u.Y36(m.o),u.Y36(u.s_b))})),(0,i.Z)(ContactPortalButton,"ɵcmp",u.Xpm({type:e,selectors:[["contact-portal-button"]],decls:2,vars:0,consts:[["label","LBL_PORTAL_INFORMATION"]],template:function(e,s){1&e&&(u.TgZ(0,"span"),u._UZ(1,"system-label",0),u.qZA())},dependencies:[p._],encapsulation:2})),ContactPortalButton})();var T=t(5698),P=t(3278),E=t(6625),R=t(4664),S=t(8594);function U(e,s){1&e&&(u.ynx(0),u._UZ(1,"system-label",8),u.BQk())}function q(e,s){1&e&&(u.ynx(0),u._UZ(1,"system-label",9),u.BQk())}function k(e,s){if(1&e&&(u.ynx(0),u.YNc(1,U,2,0,"ng-container",1),u.YNc(2,q,2,0,"ng-container",1),u.TgZ(3,"span",6)(4,"span",7),u._uU(5),u.qZA()(),u.BQk()),2&e){const e=u.oxw();u.xp6(1),u.Q6J("ngIf",e.isNewUser),u.xp6(1),u.Q6J("ngIf",!e.isNewUser),u.xp6(3),u.Oqu(e.model.data.name)}}function J(e,s){1&e&&(u.ynx(0),u._UZ(1,"system-label",10),u.BQk())}function M(e,s){1&e&&u._UZ(0,"system-spinner")}function O(e,s){1&e&&(u.TgZ(0,"div",33),u._UZ(1,"system-label",34),u.qZA())}function Y(e,s){1&e&&(u.ynx(0),u.TgZ(1,"abbr",21),u._uU(2,"* "),u.qZA(),u._UZ(3,"system-label",35),u.BQk())}function I(e,s){1&e&&(u.ynx(0),u._UZ(1,"system-label",36),u._uU(2,"?"),u.BQk())}function Q(e,s){if(1&e&&(u.TgZ(0,"div",33),u._uU(1),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.Oqu(e.pwdError)}}function D(e,s){if(1&e&&(u.TgZ(0,"div",37),u._UZ(1,"system-label",38),u._uU(2,":"),u._UZ(3,"br"),u._uU(4),u.qZA()),2&e){const e=u.oxw(2);u.xp6(4),u.hij(" ",e.pwdGuideline," ")}}function B(e,s){if(1&e&&(u.TgZ(0,"option",40),u._uU(1),u.qZA()),2&e){const e=s.$implicit,t=u.oxw(3);u.Q6J("value",e.id)("selected",t.user.aclRole===e.id),u.xp6(1),u.Oqu(e.name)}}function F(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"div",12)(1,"label",13)(2,"abbr",21),u._uU(3,"* "),u.qZA(),u._UZ(4,"system-label",39),u.qZA(),u.TgZ(5,"div",15)(6,"div",29)(7,"select",30),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw(2);return u.KtG(t.user.aclRole=s)})),u.YNc(8,B,2,3,"option",31),u.qZA()()()()}if(2&e){const e=u.oxw(2);u.xp6(7),u.Q6J("ngModel",e.user.aclRole),u.xp6(1),u.Q6J("ngForOf",e.aclRoles)}}function G(e,s){if(1&e&&(u.TgZ(0,"option",40),u._uU(1),u.qZA()),2&e){const e=s.$implicit,t=u.oxw(3);u.Q6J("value",e.id)("selected",t.user.aclProfile===e.id),u.xp6(1),u.Oqu(e.name)}}function W(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"div",12)(1,"label",13)(2,"abbr",21),u._uU(3,"* "),u.qZA(),u._UZ(4,"system-label",41),u.qZA(),u.TgZ(5,"div",15)(6,"div",29)(7,"select",30),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw(2);return u.KtG(t.user.aclProfile=s)})),u.YNc(8,G,2,3,"option",31),u.qZA()()()()}if(2&e){const e=u.oxw(2);u.xp6(7),u.Q6J("ngModel",e.user.aclProfile),u.xp6(1),u.Q6J("ngForOf",e.aclProfiles)}}function H(e,s){if(1&e&&(u.TgZ(0,"option",40),u._uU(1),u.qZA()),2&e){const e=s.$implicit,t=u.oxw(2);u.Q6J("value",e.id)("selected",t.user.portalRole===e.id),u.xp6(1),u.Oqu(e.name)}}function j(e,s){if(1&e&&(u.TgZ(0,"label",13),u._uU(1),u._UZ(2,"system-icon-help-text",42),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.hij("",e.language.getLabel("LBL_SET_DATE_TIME_PREFS")," "),u.xp6(1),u.Q6J("helpText",e.language.getLabel("HLP_SET_DATE_TIME_PREFS"))}}function K(e,s){if(1&e&&(u.TgZ(0,"label",13),u._uU(1),u._UZ(2,"system-icon-help-text",42),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.hij("",e.language.getLabel("LBL_RESET_DATE_TIME_PREFS")," "),u.xp6(1),u.Q6J("helpText",e.language.getLabel("HLP_RESET_DATE_TIME_PREFS"))}}const $=function(e){return{"slds-has-error":e}};function z(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"div",11)(1,"div",12)(2,"label",13),u._UZ(3,"system-label",14),u.qZA(),u.TgZ(4,"div",15)(5,"label",16)(6,"input",17),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw();return u.KtG(t.user.active=s)})),u.qZA(),u.TgZ(7,"span",18),u._UZ(8,"span",19),u.qZA()()()(),u.TgZ(9,"div",20)(10,"label",13)(11,"abbr",21),u._uU(12,"* "),u.qZA(),u._UZ(13,"system-label",22),u.qZA(),u.TgZ(14,"div",15)(15,"input",23),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw();return u.KtG(t.user.name=s)}))("change",(function(){u.CHM(e);const s=u.oxw();return u.KtG(s.testUsername())})),u.qZA(),u.YNc(16,O,2,0,"div",24),u.qZA()(),u.TgZ(17,"div",20)(18,"label",13),u.YNc(19,Y,4,0,"ng-container",1),u.YNc(20,I,3,0,"ng-container",1),u.qZA(),u.TgZ(21,"div",15)(22,"input",25),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw();return u.KtG(t.user.password=s)})),u.qZA(),u.YNc(23,Q,2,1,"div",24),u.YNc(24,D,5,1,"div",26),u.qZA()(),u.YNc(25,F,9,2,"div",27),u.YNc(26,W,9,2,"div",27),u.TgZ(27,"div",12)(28,"label",13)(29,"abbr",21),u._uU(30,"* "),u.qZA(),u._UZ(31,"system-label",28),u.qZA(),u.TgZ(32,"div",15)(33,"div",29)(34,"select",30),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw();return u.KtG(t.user.portalRole=s)})),u.YNc(35,H,2,3,"option",31),u.qZA()()()(),u.TgZ(36,"div",12),u.YNc(37,j,3,2,"label",32),u.YNc(38,K,3,2,"label",32),u.TgZ(39,"div",15)(40,"label",16)(41,"input",17),u.NdJ("ngModelChange",(function(s){u.CHM(e);const t=u.oxw();return u.KtG(t.user.setDateTimePrefsWithSystemDefaults=s)})),u.qZA(),u.TgZ(42,"span",18),u._UZ(43,"span",19),u.qZA()()()()()}if(2&e){const e=u.oxw();u.xp6(6),u.Q6J("ngModel",e.user.active),u.xp6(3),u.Q6J("ngClass",u.VKq(19,$,e.usernameAlreadyExists)),u.xp6(6),u.Q6J("ngModel",e.user.name)("disabled",e.usernameTesting),u.xp6(1),u.Q6J("ngIf",e.usernameAlreadyExists),u.xp6(1),u.Q6J("ngClass",u.VKq(21,$,e.pwdError)),u.xp6(2),u.Q6J("ngIf",e.isNewUser),u.xp6(1),u.Q6J("ngIf",!e.isNewUser),u.xp6(2),u.Q6J("ngModel",e.user.password)("ngClass",u.VKq(23,$,e.pwdError)),u.xp6(1),u.Q6J("ngIf",e.pwdError),u.xp6(1),u.Q6J("ngIf",e.pwdGuideline),u.xp6(1),u.Q6J("ngIf",e.aclRoles.length),u.xp6(1),u.Q6J("ngIf",e.aclProfiles.length),u.xp6(8),u.Q6J("ngModel",e.user.portalRole),u.xp6(1),u.Q6J("ngForOf",e.portalRoles),u.xp6(2),u.Q6J("ngIf",e.isNewUser),u.xp6(1),u.Q6J("ngIf",!e.isNewUser),u.xp6(3),u.Q6J("ngModel",e.user.setDateTimePrefsWithSystemDefaults)}}function V(e,s){if(1&e){const e=u.EpF();u.TgZ(0,"button",43),u.NdJ("click",(function(){u.CHM(e);const s=u.oxw();return u.KtG(s.save())})),u._UZ(1,"system-label",44),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("disabled",!e.canSave)}}let X=(()=>{var e;class ContactPortalDetails{constructor(e,s,t,l,a,n){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"configuration",void 0),(0,i.Z)(this,"loaded",!1),(0,i.Z)(this,"user",{active:!1,id:"",aclRole:"",aclProfile:"",portalRole:"",password:"",name:"",setDateTimePrefsWithSystemDefaults:!0}),(0,i.Z)(this,"pwdGuideline",""),(0,i.Z)(this,"pwdCheckRegex",new RegExp("//")),(0,i.Z)(this,"aclRoles",[]),(0,i.Z)(this,"aclProfiles",[]),(0,i.Z)(this,"portalRoles",[]),(0,i.Z)(this,"defaultPortalUserProfile",void 0),(0,i.Z)(this,"self",void 0),(0,i.Z)(this,"usernameAlreadyExists",!1),(0,i.Z)(this,"usernameTesting",!1),(0,i.Z)(this,"lastToast",void 0),(0,i.Z)(this,"isSaving",!1),this.language=e,this.backend=s,this.metadata=t,this.model=l,this.toast=a,this.configuration=n}ngOnInit(){this.getInfo(),this.backend.getRequest("module/Contacts/"+this.model.id+"/portalAccess").pipe((0,T.q)(1)).subscribe((e=>{e.aclRoles&&(this.aclRoles=e.aclRoles),e.aclProfiles&&(this.aclProfiles=e.aclProfiles),e.defaultPortalUserProfile&&(this.defaultPortalUserProfile=e.defaultPortalUserProfile),this.portalRoles=e.portalRoles,e.user&&e.user.id&&(this.user.active=e.user.status,this.user.id=e.user.id,e.user.aclRole&&(this.user.aclRole=e.user.aclRole),e.user.aclProfile&&(this.user.aclProfile=e.user.aclProfile),this.user.portalRole=e.user.portalRole,this.user.setDateTimePrefsWithSystemDefaults=!1),this.user.id||(this.aclRoles.some((e=>{if("Portal"===e.name)return this.user.aclRole=e.id,!0})),this.portalRoles.some((e=>{if("Portal"===e.name)return this.user.portalRole=e.id,!0}))),this.user.id?(this.user.name=e.user.username,this.loaded=!0):(this.user.name=this.model.getField("email1")?this.model.getField("email1"):this.model.getField("email_address_private"),this.testUsername(),1===this.aclProfiles.length?this.user.aclProfile=this.aclProfiles[0].id:this.defaultPortalUserProfile&&(this.user.aclProfile=this.defaultPortalUserProfile))}))}testUsername(){this.user.name&&(this.usernameTesting=!0,this.backend.getRequest("module/Contacts/"+this.model.id+"/testUsername",{username:this.user.name}).pipe((0,T.q)(1)).subscribe((e=>{e.error||(this.usernameAlreadyExists=e.exists,this.loaded=!0,this.usernameTesting=!1)})))}get pwdError(){return!!this.loaded&&(!(!this.user.password||this.pwdCheckRegex.test(this.user.password))&&this.language.getLabel("MSG_PWD_NOT_LEGAL"))}closeModal(){this.self.destroy()}get isNewUser(){return this.loaded&&""==this.user.id}get canSave(){if(this.isSaving)return!1;if(this.usernameTesting)return!1;if(!this.user.name||!this.user.portalRole||!this.user.aclRole&&this.aclRoles.length||!this.user.aclProfile&&this.aclProfiles.length)return!1;if(this.usernameAlreadyExists)return!1;if(this.isNewUser){if(!this.user.password||this.pwdError)return!1}else if(this.pwdError)return!1;return!0}save(){if(this.canSave){this.isSaving=!0;let e={status:this.user.active,aclRole:this.aclRoles.length?this.user.aclRole:void 0,aclProfile:this.aclProfiles.length?this.user.aclProfile:void 0,portalRole:this.user.portalRole,username:this.user.name,password:this.user.password,setDateTimePrefsWithSystemDefaults:this.user.setDateTimePrefsWithSystemDefaults};this.toast.clearToast(this.lastToast),this.isNewUser?this.backend.postRequest("module/Contacts/"+this.model.id+"/portalAccess",{},e).pipe((0,T.q)(1)).subscribe((e=>{e.success&&(this.lastToast=this.toast.sendToast("Portal user created successfully.","success")),this.closeModal()}),(e=>{this.lastToast=this.toast.sendToast("Error saving data of portal user.","error",e.error.error.message,!1),this.isSaving=!1})):this.backend.putRequest("module/Contacts/"+this.model.id+"/portalAccess",{},e).pipe((0,T.q)(1)).subscribe((e=>{e.success&&(this.lastToast=this.toast.sendToast("Portal user edited successfully.","success")),this.closeModal()}),(e=>{this.lastToast=this.toast.sendToast("Error saving data of portal user.","error",e.error.error.message,!1),this.isSaving=!1}))}}getInfo(){let e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheckRegex=new RegExp(e.regex);let s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.onespecial&&s.push(this.language.getLabel("MSG_PASSWORD_ONESPECIAL")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")}}return e=ContactPortalDetails,(0,i.Z)(ContactPortalDetails,"ɵfac",(function(s){return new(s||e)(u.Y36(h.d),u.Y36(f.y),u.Y36(Z.Pu),u.Y36(g.o),u.Y36(P.A),u.Y36(E.C))})),(0,i.Z)(ContactPortalDetails,"ɵcmp",u.Xpm({type:e,selectors:[["contact-portal-details"]],decls:11,vars:5,consts:[[3,"close"],[4,"ngIf"],["class","slds-form slds-form_horizontal",4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],["class","slds-button slds-button--brand",3,"disabled","click",4,"ngIf"],[1,"slds-text-heading_small","slds-p-top_x-small",2,"display","block"],[1,"slds-p-horizontal--x-small","slds-theme--info","slds-text-color--inverse",2,"opacity","0.66"],["label","LBL_CREATE_PORTAL_USER"],["label","LBL_EDIT_PORTAL_USER"],["label","LBL_PORTAL_USER"],[1,"slds-form","slds-form_horizontal"],[1,"slds-form-element"],[1,"slds-form-element__label"],["label","LBL_ACTIVE"],[1,"slds-form-element__control"],[1,"slds-checkbox_toggle","slds-grid"],["type","checkbox","name","active",3,"ngModel","ngModelChange"],["aria-live","assertive",1,"slds-checkbox_faux_container"],[1,"slds-checkbox_faux"],[1,"slds-form-element",3,"ngClass"],["title","required",1,"slds-required"],["label","LBL_USER_NAME"],["type","text",1,"slds-input",3,"ngModel","disabled","ngModelChange","change"],["class","slds-form-element__help",4,"ngIf"],["type","text",1,"slds-input",3,"ngModel","ngClass","ngModelChange"],["class","slds-m-top--xx-small slds-form-element__help","style","color:inherit",4,"ngIf"],["class","slds-form-element",4,"ngIf"],["label","LBL_PORTAL_ROLE"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],["class","slds-form-element__label",4,"ngIf"],[1,"slds-form-element__help"],["label","MSG_USERNAME_ALREADY_EXISTS"],["label","LBL_PASSWORD"],["label","LBL_NEW_PWD"],[1,"slds-m-top--xx-small","slds-form-element__help",2,"color","inherit"],["label","LBL_PWD_GUIDELINE"],["label","LBL_ACL_ROLE"],[3,"value","selected"],["label","LBL_SPICEACLPROFILE"],[3,"helpText"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(u.TgZ(0,"system-modal")(1,"system-modal-header",0),u.NdJ("close",(function(){return s.closeModal()})),u.YNc(2,k,6,3,"ng-container",1),u.YNc(3,J,2,0,"ng-container",1),u.qZA(),u.TgZ(4,"system-modal-content"),u.YNc(5,M,1,0,"system-spinner",1),u.YNc(6,z,44,25,"div",2),u.qZA(),u.TgZ(7,"system-modal-footer")(8,"button",3),u.NdJ("click",(function(){return s.closeModal()})),u._UZ(9,"system-label",4),u.qZA(),u.YNc(10,V,2,1,"button",5),u.qZA()()),2&e&&(u.xp6(2),u.Q6J("ngIf",s.loaded),u.xp6(1),u.Q6J("ngIf",!s.loaded),u.xp6(2),u.Q6J("ngIf",!s.loaded),u.xp6(1),u.Q6J("ngIf",s.loaded),u.xp6(4),u.Q6J("ngIf",s.loaded))},dependencies:[l.mk,l.sg,l.O5,a.YN,a.Kr,a.Fj,a.Wl,a.EJ,a.JJ,a.On,p._,x.j,v.x,w.p,y.y,R.W,S.h],encapsulation:2})),ContactPortalDetails})();var ee=t(727),se=t(8859);function te(e,s){if(1&e&&u._UZ(0,"system-utility-icon",5),2&e){const e=u.oxw();u.Q6J("icon",e.syncicon)}}function ie(e,s){1&e&&u._UZ(0,"system-spinner",6)}let le=(()=>{var e;class ContactExchangeSyncButton{constructor(e,s,t,l,a,n,o){(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"configuration",void 0),(0,i.Z)(this,"isLoading",!1),(0,i.Z)(this,"hidden",!0),(0,i.Z)(this,"subscriptions",new ee.w0),this.metadata=e,this.toast=s,this.language=t,this.model=l,this.modal=a,this.backend=n,this.configuration=o,this.setHidden(),this.configuration.datachanged$.subscribe((e=>{"microsoftserviceuserconfig"==e&&this.setHidden()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}setHidden(){let e=this.configuration.getData("microsoftserviceuserconfig"),s=this.metadata.getModuleDefs("Contacts");this.hidden=!e||e&&-1==e?.findIndex((e=>e.sysmodule_id==s.id))}execute(){this.isLoading=!0,this.model.getField("sync_contact")?this.backend.deleteRequest(`module/Contacts/${this.model.id}/exchangesync`).subscribe((e=>{this.model.setField("sync_contact",!this.model.getField("sync_contact")),this.isLoading=!1}),(e=>{this.isLoading=!1})):this.backend.putRequest(`module/Contacts/${this.model.id}/exchangesync`).subscribe((e=>{e.message?this.toast.sendToast(e.message,"error"):this.model.setField("sync_contact",!this.model.getField("sync_contact")),this.isLoading=!1}),(e=>{this.isLoading=!1}))}get disabled(){return!(!this.isLoading&&!this.model.isLoading&&this.model.getField("email1")&&!this.model.isEditing)}get syncicon(){return this.model.getField("sync_contact")?"check":"add"}}return e=ContactExchangeSyncButton,(0,i.Z)(ContactExchangeSyncButton,"ɵfac",(function(s){return new(s||e)(u.Y36(Z.Pu),u.Y36(P.A),u.Y36(h.d),u.Y36(g.o),u.Y36(m.o),u.Y36(f.y),u.Y36(E.C))})),(0,i.Z)(ContactExchangeSyncButton,"ɵcmp",u.Xpm({type:e,selectors:[["ng-component"]],decls:5,vars:2,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],["size","xx-small",3,"icon",4,"ngIf"],["size","12",4,"ngIf"],[1,"slds-p-left--xx-small"],["label","LBL_EXCHANGE"],["size","xx-small",3,"icon"],["size","12"]],template:function(e,s){1&e&&(u.TgZ(0,"div",0),u.YNc(1,te,1,1,"system-utility-icon",1),u.YNc(2,ie,1,0,"system-spinner",2),u.TgZ(3,"div",3),u._UZ(4,"system-label",4),u.qZA()()),2&e&&(u.xp6(1),u.Q6J("ngIf",!s.isLoading),u.xp6(1),u.Q6J("ngIf",s.isLoading))},dependencies:[l.O5,p._,R.W,se.r],encapsulation:2})),ContactExchangeSyncButton})(),ae=(()=>{var e;class ModuleContacts{}return e=ModuleContacts,(0,i.Z)(ModuleContacts,"ɵfac",(function(s){return new(s||e)})),(0,i.Z)(ModuleContacts,"ɵmod",u.oAB({type:e})),(0,i.Z)(ModuleContacts,"ɵinj",u.cJS({imports:[l.ez,a.u5,o.ObjectFields,d.GlobalComponents,r.ObjectComponents,c.SystemComponents,n.o]})),ModuleContacts})();("undefined"==typeof ngJitMode||ngJitMode)&&u.kYT(ae,{declarations:[b,C,N,X,le],imports:[l.ez,a.u5,o.ObjectFields,d.GlobalComponents,r.ObjectComponents,c.SystemComponents,n.o]})}}]);