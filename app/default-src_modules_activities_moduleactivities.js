/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:53:45
 *
 *                     build: 2024.01.001.1717779225604
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["default-src_modules_activities_moduleactivities_ts"],{23221:(t,e,i)=>{i.d(e,{t:()=>a});var s=i(54438),n=i(83935);const l=["container"];let a=(()=>{class ActivityTimelineItemContainer{constructor(t){this.metadata=t,this.activity={}}ngOnInit(){let t=this.metadata.getComponentConfig("ActivityTimelineItemContainer",this.activity.module);if(t.componentset){let e=this.metadata.getComponentSetObjects(t.componentset);for(let t of e)this.metadata.addComponent(t.component,this.container).subscribe((e=>{e.instance.activity=this.activity,e.instance.module=this.module,e.instance.componentconfig=t.componentconfig}))}}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineItemContainer)(s.rXU(n.yu))};static#e=this.ɵcmp=s.VBU({type:ActivityTimelineItemContainer,selectors:[["activitytimeline-item-container"]],viewQuery:function(t,e){if(1&t&&s.GBs(l,7,s.c1b),2&t){let t;s.mGM(t=s.lsd())&&(e.container=t.first)}},inputs:{activity:"activity",module:"module"},decls:2,vars:0,consts:[["container",""]],template:function(t,e){1&t&&s.eu8(0,null,0)},encapsulation:2})}return ActivityTimelineItemContainer})()},56639:(t,e,i)=>{i.d(e,{v:()=>o});var s=i(54438),n=i(25863),l=i(68823),a=i(43308);let o=(()=>{class ActivityTimelineStencil{static#t=this.ɵfac=function(t){return new(t||ActivityTimelineStencil)};static#e=this.ɵcmp=s.VBU({type:ActivityTimelineStencil,selectors:[["activitytimeline-stencil"]],decls:18,vars:0,consts:[[1,"slds-timeline__item_expandable","slds-timeline__item_email"],[1,"slds-media"],[1,"slds-media__figure"],[1,"slds-button","slds-button_icon"],["icon","switch","addclasses","slds-timeline__details-action-icon"],["icon","generic_loading","size","small","divClass","slds-icon_container slds-icon-standard-email slds-timeline__icon"],[1,"slds-media__body"],[1,"slds-grid","slds-grid_align-spread","slds-timeline__trigger"],[1,"slds-grid","slds-grid_vertical-align-center","slds-truncate_container_75","slds-no-space"],[1,"slds-truncate"],[1,"slds-timeline__actions","slds-timeline__actions_inline"],[1,"slds-timeline__date"],["disabled","",1,"slds-button","slds-button--icon-border-filled","slds-button--icon-x-small"],["icon","down"],[1,"slds-m-horizontal_xx-small"]],template:function(t,e){1&t&&(s.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),s.nrm(4,"system-button-icon",4),s.k0s(),s.nrm(5,"system-icon",5),s.k0s(),s.j41(6,"div",6)(7,"div",7)(8,"div",8)(9,"h3",9),s.nrm(10,"system-stencil"),s.k0s()(),s.j41(11,"div",10)(12,"p",11),s.nrm(13,"system-stencil"),s.k0s(),s.j41(14,"button",12),s.nrm(15,"system-button-icon",13),s.k0s()()(),s.j41(16,"p",14),s.nrm(17,"system-stencil"),s.k0s()()()())},dependencies:[n.t,l.J,a.O],encapsulation:2})}return ActivityTimelineStencil})()},78625:(t,e,i)=>{i.r(e),i.d(e,{ModuleActivities:()=>Gs});var s=i(60177),n=i(84341),l=i(7745),a=i(12948),o=i(37328),d=i(70569),c=i(71341),r=i(54438),m=i(40553),u=i(60968),h=i(35911),p=i(75103),g=i(72486),f=i(69904),v=i(48717),b=i(28933),y=i(41731),k=i(83935),j=i(92462),x=i(15091);function R(t,e){1&t&&(r.j41(0,"span"),r.EFF(1," • "),r.k0s())}function G(t,e){if(1&t&&(r.qex(0),r.nrm(1,"field-container",10),r.DNE(2,R,2,0,"span",11),r.bVm()),2&t){const t=r.XpG(),e=t.$implicit,i=t.index,s=r.XpG();r.R7$(),r.Y8G("field",e.field)("fieldconfig",e.fieldconfig)("fielddisplayclass","slds-truncate"),r.R7$(),r.Y8G("ngIf",i<s.fielsetFields.length-1)}}function A(t,e){if(1&t&&(r.qex(0),r.DNE(1,G,3,4,"ng-container",11),r.bVm()),2&t){const t=e.$implicit,i=r.XpG();r.R7$(),r.Y8G("ngIf",i.model.data[t.field])}}const C=()=>({highlightpast:!0});let I=(()=>{class TasksManagerTask{constructor(t,e,i,s,n){this.language=t,this.metadata=e,this.model=i,this.modelutilities=s,this.view=n,this.task={},this.focus="",this.taskselected=new r.bkB,this.fielsetFields=[];let l=this.metadata.getComponentConfig("TasksManagerTask","Tasks");l.fieldset&&(this.fielsetFields=this.metadata.getFieldSetItems(l.fieldset)),this.view.displayLabels=!1}ngOnInit(){this.model.module="Tasks",this.model.id=this.task.id,this.model.setData(this.task)}get isCompleted(){return"Completed"==this.model.getField("status")}get canEdit(){return this.model.checkAccess("edit")}get nameStyle(){let t={};return this.isCompleted&&(t["text-decoration"]="line-through"),t}get focusClass(){return this.model.id==this.focus?"slds-theme--shade slds-border--right":""}completeTask(){this.model.setField("status","Completed"),this.model.save()}selectTask(){this.taskselected.emit(this.model.id)}static#t=this.ɵfac=function(t){return new(t||TasksManagerTask)(r.rXU(f.B),r.rXU(k.yu),r.rXU(h.g),r.rXU(j.g),r.rXU(y.U))};static#e=this.ɵcmp=r.VBU({type:TasksManagerTask,selectors:[["tasks-manager-task"]],inputs:{task:"task",focus:"focus"},outputs:{taskselected:"taskselected"},features:[r.Jv_([h.g,y.U])],decls:15,vars:12,consts:[[1,"slds-p-horizontal--medium","slds-p-vertical--medium","slds-border--bottom",3,"ngClass"],[1,"slds-grid","slds-grid--align-spread",2,"cursor","pointer",3,"click"],[1,"slds-grid"],[1,"slds-form-element"],[1,"slds-checkbox"],["type","checkbox",3,"disabled","checked","id","click"],[1,"slds-checkbox__label"],[1,"slds-checkbox_faux"],[1,"slds-text-title_caps",3,"ngStyle"],[4,"ngFor","ngForOf"],[3,"field","fieldconfig","fielddisplayclass"],[4,"ngIf"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"div",1),r.bIt("click",(function(){return e.selectTask()})),r.j41(2,"div",2)(3,"div",3)(4,"span",4)(5,"input",5),r.bIt("click",(function(){return e.completeTask()})),r.k0s(),r.j41(6,"label",6),r.nrm(7,"span",7),r.k0s()()(),r.j41(8,"div")(9,"div",8),r.EFF(10),r.k0s(),r.j41(11,"div",2),r.DNE(12,A,2,1,"ng-container",9),r.k0s()()(),r.j41(13,"div"),r.nrm(14,"field-container",10),r.k0s()()()),2&t&&(r.Y8G("ngClass",e.focusClass),r.R7$(5),r.Y8G("disabled",e.isCompleted||!e.canEdit)("checked",e.isCompleted)("id",e.model.id),r.R7$(),r.BMQ("for",e.model.id),r.R7$(3),r.Y8G("ngStyle",e.nameStyle),r.R7$(),r.JRh(e.model.data.name),r.R7$(2),r.Y8G("ngForOf",e.fielsetFields),r.R7$(2),r.Y8G("field","date_due")("fieldconfig",r.lJ4(11,C))("fielddisplayclass","slds-truncate"))},dependencies:[s.YU,s.Sq,s.bT,s.B3,x.y],encapsulation:2})}return TasksManagerTask})();const X=t=>({"slds-theme_shade":t});function E(t,e){if(1&t){const t=r.RV6();r.j41(0,"tasks-manager-task",3),r.bIt("taskselected",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.selectTask(e))})),r.k0s()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("task",t)("focus",i.focus)("ngClass",r.eq3(3,X,i.focus==t.id))}}function S(t,e){1&t&&(r.j41(0,"div",4),r.nrm(1,"system-spinner"),r.k0s())}let T=(()=>{class TasksManagerTasks{constructor(t,e){this.language=t,this.modellist=e,this.taskselected=new r.bkB,this.focus=""}selectTask(t){this.focus=t,this.taskselected.emit(t)}handleScroll(){this.modellist.loadMoreList()}static#t=this.ɵfac=function(t){return new(t||TasksManagerTasks)(r.rXU(f.B),r.rXU(p.K))};static#e=this.ɵcmp=r.VBU({type:TasksManagerTasks,selectors:[["tasks-manager-tasks"]],outputs:{taskselected:"taskselected"},decls:3,vars:2,consts:[[3,"system-to-bottom"],[3,"task","focus","ngClass","taskselected",4,"ngFor","ngForOf"],["class","slds-p-around--medium slds-align--absolute-center",4,"ngIf"],[3,"task","focus","ngClass","taskselected"],[1,"slds-p-around--medium","slds-align--absolute-center"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.bIt("system-to-bottom",(function(){return e.handleScroll()})),r.DNE(1,E,1,5,"tasks-manager-task",1)(2,S,2,0,"div",2),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngForOf",e.modellist.listData.list),r.R7$(),r.Y8G("ngIf",e.modellist.isLoading))},dependencies:[s.YU,s.Sq,s.bT,v.P,b.b,I],encapsulation:2})}return TasksManagerTasks})();var L=i(32062);const U=["detailscontent"];function M(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",5)(1,"div",6)(2,"span",7)(3,"input",8),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.completeTask())})),r.k0s(),r.j41(4,"label",9),r.nrm(5,"span",10),r.k0s()()(),r.j41(6,"div",11),r.nrm(7,"field-container",12),r.k0s()()}if(2&t){const t=r.XpG();r.R7$(3),r.Y8G("disabled",t.isCompleted||!t.canEdit)("checked",t.isCompleted),r.R7$(4),r.Y8G("field","name")("fielddisplayclass","slds-text-heading--small")}}function B(t,e){1&t&&(r.j41(0,"div",13),r.nrm(1,"system-label",14),r.k0s())}const D=t=>({"slds-theme--default":t});let F=(()=>{class TasksManagerTaskDetails{constructor(t,e,i,s,n,l){this.view=t,this.language=e,this.elementRef=i,this.metadata=s,this.model=n,this.broadcast=l,this.focusid="",this.viewComponent=null,this.modelSubscription=null,this.model.module="Tasks",this.modelSubscription=this.broadcast.message$.subscribe((t=>{this.handleMessage(t)})),this.view.displayLabels=!1}handleMessage(t){if(t.messagedata.module===this.model.module)switch(t.messagetype){case"model.delete":break;case"model.save":this.model.id===t.messagedata.id&&this.model.setData(t.messagedata.data,!1)}}ngOnChanges(){this.viewComponent&&(this.viewComponent.destroy(),this.viewComponent=null),this.focusid&&this.metadata.addComponent("ObjectRecordDetails",this.detailscontent).subscribe((t=>{this.viewComponent=t})),this.focusid&&this.focusid!=this.model.id&&(this.model.id=this.focusid,this.model.getData())}ngOnDestroy(){this.modelSubscription.unsubscribe()}get nameStyle(){let t={};return this.isCompleted&&(t["text-decoration"]="line-through"),t}get isCompleted(){return"Completed"==this.model.getField("status")}get canEdit(){try{return this.model.checkAccess("edit")}catch(t){return!1}}completeTask(){this.model.setField("status","Completed"),this.model.save()}static#t=this.ɵfac=function(t){return new(t||TasksManagerTaskDetails)(r.rXU(y.U),r.rXU(f.B),r.rXU(r.aKT),r.rXU(k.yu),r.rXU(h.g),r.rXU(m.m))};static#e=this.ɵcmp=r.VBU({type:TasksManagerTaskDetails,selectors:[["tasks-manager-task-details"]],viewQuery:function(t,e){if(1&t&&r.GBs(U,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.detailscontent=t.first)}},hostAttrs:[1,"slds-theme--shade"],inputs:{focusid:"focusid"},features:[r.Jv_([h.g,y.U]),r.OA$],decls:6,vars:5,consts:[[1,"slds-scrollable--y"],["class","slds-m-around--x-small slds-p-around--x-small slds-grid slds-grid_vertical-align-center",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small",3,"ngClass"],["detailscontent",""],["class","slds-align--absolute-center","style","height:100%",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small","slds-grid","slds-grid_vertical-align-center"],[1,"slds-form-element__control"],[1,"slds-checkbox"],["type","checkbox","id","closetask",3,"disabled","checked","click"],["for","closetask",1,"slds-checkbox__label"],[1,"slds-checkbox_faux"],[1,"slds-text-heading--small","slds-p-left--small"],[3,"field","fielddisplayclass"],[1,"slds-align--absolute-center",2,"height","100%"],["label","LBL_MAKE_SELECTION"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,M,8,4,"div",1),r.j41(2,"div",2),r.nrm(3,"div",null,3),r.k0s(),r.DNE(5,B,2,0,"div",4),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",e.focusid),r.R7$(),r.Y8G("ngClass",r.eq3(3,D,e.focusid)),r.R7$(3),r.Y8G("ngIf",!e.focusid))},dependencies:[s.YU,s.bT,x.y,L.W],encapsulation:2})}return TasksManagerTaskDetails})();function w(t,e){if(1&t){const t=r.RV6();r.qex(0),r.j41(1,"tasks-manager-tasks",3),r.bIt("taskselected",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.taskSelected(e))})),r.k0s(),r.nrm(2,"tasks-manager-task-details",4),r.bVm()}if(2&t){const t=r.XpG();r.R7$(2),r.Y8G("focusid",t.focus)}}function Y(t,e){1&t&&(r.j41(0,"div",5),r.nrm(1,"system-illustration-no-task"),r.k0s())}let $=(()=>{class TasksManagerView{constructor(t,e,i,s,n){this.broadcast=t,this.navigation=e,this.elementRef=i,this.model=s,this.modellist=n,this.modellistsubscribe={},this.focus=null,this.modellistsubscribe=this.modellist.listType$.subscribe((t=>this.handleListTypeChange(t))),this.loadList()}ngOnDestroy(){this.modellistsubscribe.unsubscribe()}handleListTypeChange(t){"TasksManagerView"==t.listcomponent&&this.loadList()}loadList(){this.focus=null,this.modellist.setSortField("date_due","ASC"),this.modellist.getListData()}taskSelected(t){this.focus=t}static#t=this.ɵfac=function(t){return new(t||TasksManagerView)(r.rXU(m.m),r.rXU(u.L),r.rXU(r.aKT),r.rXU(h.g),r.rXU(p.K))};static#e=this.ɵcmp=r.VBU({type:TasksManagerView,selectors:[["ng-component"]],decls:4,vars:2,consts:[[1,"slds-grid","slds-height_full"],[4,"ngIf","ngIfElse"],["noitems",""],[1,"slds-size--1-of-2",3,"taskselected"],[1,"slds-size--1-of-2",3,"focusid"],[1,"slds-height_full","slds-align--absolute-center"]],template:function(t,e){if(1&t&&(r.j41(0,"div",0),r.DNE(1,w,3,1,"ng-container",1)(2,Y,2,0,"ng-template",null,2,r.C5r),r.k0s()),2&t){const t=r.sdS(3);r.R7$(),r.Y8G("ngIf",e.modellist.isLoading||e.modellist.listData.totalcount>0)("ngIfElse",t)}},dependencies:[s.bT,g.w,T,F],encapsulation:2})}return TasksManagerView})();var N=i(13562);let O=(()=>{class TasksAssitantTileClose{constructor(t,e,i,s){this.model=t,this.language=e,this.helper=i,this.broadcast=s}doAction(){this.helper.confirm(this.language.getLabel("LBL_COMPLETE_TASK"),this.language.getLabel("MSG_COMPLETE_TASK")).subscribe((t=>{t&&(this.model.setField("status","Completed"),this.model.save(),this.broadcast.broadcastMessage("assistant.complete",{id:this.model.id,module:"Assistant",data:this.model.data}))}))}static#t=this.ɵfac=function(t){return new(t||TasksAssitantTileClose)(r.rXU(h.g),r.rXU(f.B),r.rXU(N.d),r.rXU(m.m))};static#e=this.ɵcmp=r.VBU({type:TasksAssitantTileClose,selectors:[["tasks-assistant-tile-close"]],decls:4,vars:0,consts:[["role","presentation",1,"slds-dropdown__item",3,"click"],["href","javascript:void(0);","role","menuitem"],[1,"slds-truncate"],["label","LBL_CLOSE"]],template:function(t,e){1&t&&(r.j41(0,"li",0),r.bIt("click",(function(){return e.doAction()})),r.j41(1,"a",1)(2,"span",2),r.nrm(3,"system-label",3),r.k0s()()())},dependencies:[L.W],encapsulation:2})}return TasksAssitantTileClose})(),V=(()=>{class ActivityTimelineSaveButton{constructor(t,e,i,s){this.language=t,this.metadata=e,this.model=i,this.view=s,this.actionconfig={},this.actionemitter=new r.bkB,this.parent={},this.module="",this.saving=!1}get buttonLabel(){return this.actionconfig.label?this.actionconfig.label:"LBL_SAVE"}execute(){this.saving||this.model.validate()&&(this.saving=!0,this.model.save(!0).subscribe((t=>{this.actionemitter.emit("save"),this.model.endEdit()})))}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineSaveButton)(r.rXU(f.B),r.rXU(k.yu),r.rXU(h.g),r.rXU(y.U))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSaveButton,selectors:[["activity-timeline-save-button"]],outputs:{actionemitter:"actionemitter"},decls:2,vars:1,consts:[[3,"label"]],template:function(t,e){1&t&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s()),2&t&&(r.R7$(),r.Y8G("label",e.buttonLabel))},dependencies:[L.W],encapsulation:2})}return ActivityTimelineSaveButton})();var z=i(18359),P=i(50531),H=i(25863);function q(t,e){1&t&&r.nrm(0,"system-button-icon",2)}function J(t,e){1&t&&(r.j41(0,"span"),r.nrm(1,"system-label",3),r.k0s())}let W=(()=>{class ActionActivityCloseButton{constructor(t,e,i,s,n){this.language=t,this.metadata=e,this.model=i,this.modal=s,this.viewContainerRef=n,this.hidden=!1,this.displayasicon=!1,this.disabled=!0,this.subscriptions=new z.yU}ngOnInit(){this.componentconfig=this.metadata.getComponentConfig("ActionActivityCloseButton",this.model.module),this.model.getField(this.componentconfig.statusField)==this.componentconfig.statusValues&&this.handleDisabled("display"),this.handleDisabled(this.model.isEditing?"edit":"display"),this.subscriptions.add(this.model.mode$.subscribe((t=>{this.handleDisabled(t)}))),this.subscriptions.add(this.model.data$.subscribe((t=>{this.handleDisabled(this.model.isEditing?"edit":"display")})))}ngOnDestroy(){this.subscriptions.unsubscribe()}execute(){let t=this.componentconfig.componentset,e=this.componentconfig.actionset;this.modal.openModal("ActivityCloseModal",!0,this.viewContainerRef.injector).subscribe((i=>{i&&(t&&""!=t&&(i.instance.componentSet=t),e&&""!=e&&(i.instance.actionSet=e),this.model.startEdit())}))}handleDisabled(t){this.model.checkAccess("edit")?this.disabled="edit"==t:this.disabled=!0}static#t=this.ɵfac=function(t){return new(t||ActionActivityCloseButton)(r.rXU(f.B),r.rXU(k.yu),r.rXU(h.g),r.rXU(P.y),r.rXU(r.c1b))};static#e=this.ɵcmp=r.VBU({type:ActionActivityCloseButton,selectors:[["action-activity-close-button"]],decls:2,vars:2,consts:[["icon","close",4,"ngIf"],[4,"ngIf"],["icon","close"],["label","LBL_CLOSE"]],template:function(t,e){1&t&&r.DNE(0,q,1,0,"system-button-icon",0)(1,J,2,0,"span",1),2&t&&(r.Y8G("ngIf",e.displayasicon),r.R7$(),r.Y8G("ngIf",!e.displayasicon))},dependencies:[s.bT,H.t,L.W],encapsulation:2})}return ActionActivityCloseButton})();var K=i(70315);let Q=(()=>{class ActionActivityCloseCreateButton{constructor(t,e,i,s,n,l){this.language=t,this.metadata=e,this.model=i,this.modal=s,this.injector=n,this.modalwindow=l,this.saving=!1,this.canCreate=!1}ngOnInit(){let t=this.metadata.getComponentConfig("ActivityCloseCreateModal",this.model.module).newBeanModules;if(t){let e=t.split(",");for(let t of e)if(this.metadata.checkModuleAcl(t,"create")){this.canCreate=!0;break}}}get disabled(){return!this.model.checkAccess("edit")}execute(){this.saving||(this.actionconfig.statusfield&&this.actionconfig.statusvalue&&this.model.getField(this.actionconfig.statusfield)!=this.actionconfig.statusvalue&&(this.model.isEditing||this.model.startEdit(),this.model.setField(this.actionconfig.statusfield,this.actionconfig.statusvalue)),this.model.validate()?(this.saving=!0,this.modal.openModal("SystemLoadingModal").subscribe((t=>{t.instance.messagelabel="LBL_SAVING_DATA",this.model.save().subscribe((e=>{this.saving=!1,t.instance.self.destroy(),this.modalwindow&&this.modalwindow.self.destroy(),this.modal.openModal("ActivityCloseCreateModal",!0,this.injector).subscribe((t=>{t&&(t.instance.parent=this.model)}))}))}))):this.modalwindow||this.model.edit(!1))}get actionlabel(){return this.model.getField(this.actionconfig.statusfield)!=this.actionconfig.statusvalue&&this.model.getField(this.actionconfig.statusfield)!=this.actionconfig.statusvalue?"LBL_CLOSE_AND_NEW":this.model.isEditing?"LBL_SAVE_AND_NEW":"LBL_NEW"}static#t=this.ɵfac=function(t){return new(t||ActionActivityCloseCreateButton)(r.rXU(f.B),r.rXU(k.yu),r.rXU(h.g),r.rXU(P.y),r.rXU(r.zZn),r.rXU(K.w,8))};static#e=this.ɵcmp=r.VBU({type:ActionActivityCloseCreateButton,selectors:[["action-activity-close-create-button"]],decls:2,vars:1,consts:[[3,"label"]],template:function(t,e){1&t&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s()),2&t&&(r.R7$(),r.Y8G("label",e.actionlabel))},dependencies:[L.W],encapsulation:2})}return ActionActivityCloseCreateButton})();var Z=i(21413),tt=i(71985),et=i(57363),it=i(41081),st=i(44261),nt=i(28134),lt=i(40713),at=i(25028),ot=i(88418),dt=i(83524);const ct=["modalContent"];let rt=(()=>{class ActivityCloseModal{constructor(t,e,i,s,n,l,a){this.router=t,this.language=e,this.model=i,this.view=s,this.metadata=n,this.modal=l,this.toast=a,this.componentconfig={},this.actionSetItems=[],this.newValueFields=[],this.actionSubject=new Z.B,this.action$=new tt.c,this.preventGoingToRecord=!1,this.self={},this.view.isEditable=!0,this.view.setEditMode(),this.action$=this.actionSubject.asObservable()}ngOnInit(){this.componentconfig=this.metadata.getComponentConfig(this.constructor.name,this.model.module),this.actionSetItems=this.metadata.getActionSetItems(this.componentconfig.actionset),this.newValueFields=this.componentconfig.newValueFields,this.setNewValues()}emitaction(t){t&&this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED")+".","success"),this.self.destroy()}closeModal(){this.model.cancelEdit(),this.actionSubject.next(!1),this.actionSubject.complete(),this.self.destroy()}setNewValues(){this.newValueFields=JSON.parse(this.newValueFields);for(let t of this.newValueFields)this.model.setField(t.name,t.value)}static#t=this.ɵfac=function(t){return new(t||ActivityCloseModal)(r.rXU(et.Ix),r.rXU(f.B),r.rXU(h.g),r.rXU(y.U),r.rXU(k.yu),r.rXU(P.y),r.rXU(it.o))};static#e=this.ɵcmp=r.VBU({type:ActivityCloseModal,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&r.GBs(ct,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.modalContent=t.first)}},inputs:{preventGoingToRecord:"preventGoingToRecord"},features:[r.Jv_([y.U])],decls:13,vars:2,consts:[["size","large"],[3,"close"],["label","LBL_CLOSE"],["margin","none"],["modalContent",""],[1,"slds-grid"],[1,"slds-grid--vertical","slds-grow"],[3,"componentSet"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grid--align-spread"],[1,"slds-col"],[3,"actionset","actionemitter"]],template:function(t,e){1&t&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return e.closeModal()})),r.nrm(2,"system-label",2),r.k0s(),r.j41(3,"system-modal-content",3,4)(5,"div",5)(6,"div",6),r.nrm(7,"object-edit-modal-dialog-container",7),r.k0s()()(),r.j41(8,"system-modal-footer")(9,"div",8),r.nrm(10,"div",9),r.j41(11,"div",9)(12,"object-action-container",10),r.bIt("actionemitter",(function(t){return e.emitaction(t)})),r.k0s()()()()()),2&t&&(r.R7$(7),r.Y8G("componentSet",e.componentSet),r.R7$(5),r.Y8G("actionset",e.actionSet))},dependencies:[st.l,nt.A,L.W,lt.D,at.I,ot.Q,dt.C],encapsulation:2})}return ActivityCloseModal})();var mt=i(66589);function ut(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-input-radio",11),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.value,e)||(i.value=e),r.Njj(e)})),r.EFF(1),r.k0s()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("value",t.module),r.R50("ngModel",i.value),r.R7$(),r.JRh(i.language.getLabel(t.singular_label))}}let ht=(()=>{class ActivityCloseCreateModal{constructor(t,e,i){this.language=t,this.model=e,this.metadata=i,this.componentconfig={},this.newBeanModules=[],this.parent={},this.self={},this.value=""}ngOnInit(){this.componentconfig=this.metadata.getComponentConfig(this.constructor.name,this.parent.module);let t=this.componentconfig.newBeanModules;if(t){let e=t.split(",");for(let t of e)this.metadata.checkModuleAcl(t,"create")&&this.newBeanModules.push(this.metadata.getModuleDefs(t))}}closeModal(){this.self.destroy()}create(){this.model.module=this.value,this.model.addModel("",this.parent),this.self.destroy()}static#t=this.ɵfac=function(t){return new(t||ActivityCloseCreateModal)(r.rXU(f.B),r.rXU(h.g),r.rXU(k.yu))};static#e=this.ɵcmp=r.VBU({type:ActivityCloseCreateModal,selectors:[["ng-component"]],inputs:{parent:"parent"},features:[r.Jv_([h.g])],decls:13,vars:1,consts:[["size","x-small"],[3,"close"],["label","LBL_CREATE"],["margin","none"],[1,"slds-m-left_x-small","slds-m-vertical_large"],[1,"slds-form-element"],[1,"slds-form-element__control"],["name","module",3,"value","ngModel","ngModelChange",4,"ngFor","ngForOf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["name","module",3,"value","ngModel","ngModelChange"]],template:function(t,e){1&t&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return e.closeModal()})),r.nrm(2,"system-label",2),r.k0s(),r.j41(3,"system-modal-content",3)(4,"div",4)(5,"div",5)(6,"div",6),r.DNE(7,ut,2,3,"system-input-radio",7),r.k0s()()()(),r.j41(8,"system-modal-footer")(9,"button",8),r.bIt("click",(function(){return e.closeModal()})),r.nrm(10,"system-label",9),r.k0s(),r.j41(11,"button",10),r.bIt("click",(function(){return e.create()})),r.nrm(12,"system-label",2),r.k0s()()()),2&t&&(r.R7$(7),r.Y8G("ngForOf",e.newBeanModules))},dependencies:[s.Sq,n.BC,n.vS,mt.J,L.W,lt.D,at.I,ot.Q,dt.C],encapsulation:2})}return ActivityCloseCreateModal})();var pt=i(91107);let gt=(()=>{class ActivitiesPopoverAddBarButton{constructor(t,e,i,s){this.model=t,this.language=e,this.metadata=i,this.relatedmodels=s,this.module=""}addModel(){this.model.module=this.module;let t=[this.parent];this.relatedmodels&&this.relatedmodels.model&&t.push(this.relatedmodels.model),this.model.addModel("",t)}static#t=this.ɵfac=function(t){return new(t||ActivitiesPopoverAddBarButton)(r.rXU(h.g),r.rXU(f.B),r.rXU(k.yu),r.rXU(pt.K,8))};static#e=this.ɵcmp=r.VBU({type:ActivitiesPopoverAddBarButton,selectors:[["activities-popover-addbar-button"]],inputs:{module:"module",parent:"parent"},features:[r.Jv_([h.g])],decls:2,vars:2,consts:[[1,"slds-button","slds-button_icon","slds-button_icon-border",3,"title","click"],["size","large",3,"module"]],template:function(t,e){1&t&&(r.j41(0,"button",0),r.bIt("click",(function(){return e.addModel()})),r.nrm(1,"system-button-icon",1),r.k0s()),2&t&&(r.Y8G("title",e.language.getModuleCombinedLabel("LBL_ADD",e.module)),r.R7$(),r.Y8G("module",e.module))},dependencies:[H.t],encapsulation:2})}return ActivitiesPopoverAddBarButton})();function ft(t,e){if(1&t&&(r.j41(0,"div",3),r.nrm(1,"activities-popover-addbar-button",4),r.k0s()),2&t){const t=e.$implicit,i=r.XpG(2);r.R7$(),r.Y8G("module",t)("parent",i.model)}}function vt(t,e){if(1&t&&(r.j41(0,"div",1),r.DNE(1,ft,2,2,"div",2),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngForOf",t.modules)}}let bt=(()=>{class ActivitiesPopoverAddBar{constructor(t,e,i){this.model=t,this.language=e,this.metadata=i,this.modules=[]}ngOnInit(){if(this.componentconfig.modules){let t=this.componentconfig.modules.split(",");for(let e of t)this.metadata.checkModuleAcl(e,"create")&&this.modules.push(e)}}static#t=this.ɵfac=function(t){return new(t||ActivitiesPopoverAddBar)(r.rXU(h.g),r.rXU(f.B),r.rXU(k.yu))};static#e=this.ɵcmp=r.VBU({type:ActivitiesPopoverAddBar,selectors:[["ng-component"]],decls:1,vars:1,consts:[["class","slds-grid slds-p-vertical--x-small",4,"ngIf"],[1,"slds-grid","slds-p-vertical--x-small"],["class","slds-p-horizontal--xx-small",4,"ngFor","ngForOf"],[1,"slds-p-horizontal--xx-small"],[3,"module","parent"]],template:function(t,e){1&t&&r.DNE(0,vt,2,1,"div",0),2&t&&r.Y8G("ngIf",e.modules.length>0)},dependencies:[s.Sq,s.bT,gt],encapsulation:2})}return ActivitiesPopoverAddBar})();const yt=["field-activities-addactions-button",""];let kt=(()=>{class fieldActivitiesAddActionsButton extends gt{static#t=this.ɵfac=(()=>{let t;return function(e){return(t||(t=r.xGo(fieldActivitiesAddActionsButton)))(e||fieldActivitiesAddActionsButton)}})();static#e=this.ɵcmp=r.VBU({type:fieldActivitiesAddActionsButton,selectors:[["","field-activities-addactions-button",""]],hostBindings:function(t,e){1&t&&r.bIt("click",(function(){return e.addModel()}))},features:[r.Jv_([h.g]),r.Vt3],attrs:yt,decls:1,vars:1,consts:[["size","large",3,"module"]],template:function(t,e){1&t&&r.nrm(0,"system-button-icon",0),2&t&&r.Y8G("module",e.module)},dependencies:[H.t],encapsulation:2})}return fieldActivitiesAddActionsButton})();function _t(t,e){if(1&t&&r.nrm(0,"button",3),2&t){const t=e.$implicit,i=r.XpG(2);r.Y8G("title",i.language.getModuleCombinedLabel("LBL_ADD",t))("module",t)("parent",i.model)}}function jt(t,e){if(1&t&&(r.j41(0,"div",1),r.DNE(1,_t,1,3,"button",2),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngForOf",t.modules)}}let xt=(()=>{class fieldActivitiesAddActions{constructor(t,e,i){this.model=t,this.language=e,this.metadata=i,this.fieldconfig={},this.modules=[]}ngOnInit(){if(this.fieldconfig.modules){let t=this.fieldconfig.modules.split(",");for(let e of t)this.metadata.checkModuleAcl(e,"create")&&this.modules.push(e)}}static#t=this.ɵfac=function(t){return new(t||fieldActivitiesAddActions)(r.rXU(h.g),r.rXU(f.B),r.rXU(k.yu))};static#e=this.ɵcmp=r.VBU({type:fieldActivitiesAddActions,selectors:[["ng-component"]],inputs:{fieldconfig:"fieldconfig"},decls:1,vars:1,consts:[["class","slds-button-group","role","group",4,"ngIf"],["role","group",1,"slds-button-group"],["field-activities-addactions-button","","style","height: 24px; width:24px;","class","slds-button slds-button_icon slds-button_icon-border",3,"title","module","parent",4,"ngFor","ngForOf"],["field-activities-addactions-button","",1,"slds-button","slds-button_icon","slds-button_icon-border",2,"height","24px","width","24px",3,"title","module","parent"]],template:function(t,e){1&t&&r.DNE(0,jt,2,1,"div",0),2&t&&r.Y8G("ngIf",e.modules.length>0)},dependencies:[s.Sq,s.bT,kt],encapsulation:2})}return fieldActivitiesAddActions})();var Rt=i(13921),Gt=i(766),At=i(66935),Ct=i(84359),It=i(33325);function Xt(t,e){if(1&t&&r.nrm(0,"field-label",2),2&t){const t=r.XpG();r.Y8G("fieldname",t.fieldname)("fieldconfig",t.fieldconfig)}}function Et(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-checkbox",7),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG(2);return r.DH7(i.completed,e)||(i.completed=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG(2);r.R50("ngModel",t.completed)}}function St(t,e){if(1&t&&(r.j41(0,"field-generic-display",3)(1,"div",4),r.DNE(2,Et,1,1,"system-checkbox",5),r.j41(3,"div",6),r.EFF(4),r.k0s()()()),2&t){const t=r.XpG();r.Y8G("fielddisplayclass",t.fielddisplayclass)("editable",t.isEditable())("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),r.R7$(2),r.Y8G("ngIf",t.canComplete),r.R7$(2),r.JRh(t.value)}}let Tt=(()=>{class fieldActivitiesTaskWithCloseCheckbox extends Rt.s{constructor(t,e,i,s,n){super(t,e,i,s,n),this.model=t,this.view=e,this.language=i,this.metadata=s,this.router=n}get canComplete(){return"Completed"!==this.model.getField("status")&&"Deferred"!==this.model.getField("status")||!this.model.checkAccess("edit")}get completed(){return"Completed"==this.model.getField("status")}set completed(t){t&&this.canComplete&&(this.model.startEdit(),this.model.setField("status","Completed"),this.model.save())}static#t=this.ɵfac=function(t){return new(t||fieldActivitiesTaskWithCloseCheckbox)(r.rXU(h.g),r.rXU(y.U),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix))};static#e=this.ɵcmp=r.VBU({type:fieldActivitiesTaskWithCloseCheckbox,selectors:[["ng-component"]],features:[r.Vt3],decls:2,vars:2,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[1,"slds-grid","slds-grid_vertical-align-center"],[3,"ngModel","ngModelChange",4,"ngIf"],["system-model-popover",""],[3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&r.DNE(0,Xt,1,2,"field-label",0)(1,St,5,6,"field-generic-display",1),2&t&&(r.Y8G("ngIf",e.displayLabel),r.R7$(),r.Y8G("ngIf",!e.isEditMode()))},dependencies:[s.bT,n.BC,n.vS,Gt.b,At.K,Ct.f,It.j],encapsulation:2})}return fieldActivitiesTaskWithCloseCheckbox})();var Lt=i(48849),Ut=i(89166);function Mt(t,e){if(1&t&&r.nrm(0,"field-label",3),2&t){const t=r.XpG();r.Y8G("fieldname",t.fieldname)("fieldconfig",t.fieldconfig)}}function Bt(t,e){if(1&t&&(r.j41(0,"field-generic-display",4),r.nrm(1,"system-label",5),r.k0s()),2&t){const t=r.XpG();r.Y8G("fielddisplayclass",t.fielddisplayclass)("editable",t.isEditable())("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),r.R7$(),r.Y8G("label",t.display)}}function Dt(t,e){1&t&&r.nrm(0,"option")}function Ft(t,e){if(1&t&&(r.j41(0,"option",14),r.nrm(1,"system-label",5),r.k0s()),2&t){const t=e.$implicit;r.Y8G("value",t.value),r.R7$(),r.Y8G("label",t.label)}}function wt(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",6)(1,"div",7)(2,"div",8)(3,"select",9,10),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.value,e)||(i.value=e),r.Njj(e)})),r.DNE(5,Dt,1,0,"option",11)(6,Ft,2,2,"option",12),r.k0s()(),r.nrm(7,"field-messages",13),r.k0s()()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("ngClass",t.getFieldClass()),r.R7$(2),r.R50("ngModel",t.value),r.R7$(2),r.Y8G("ngIf",t.fieldconfig.showEmptyOption),r.R7$(),r.Y8G("ngForOf",t.options),r.R7$(),r.Y8G("fieldname",t.fieldname)}}let Yt=(()=>{class fieldActivityReminder extends Rt.s{constructor(t,e,i,s,n,l,a,o,d,c){super(t,e,s,n,l),this.model=t,this.view=e,this.broadcast=i,this.language=s,this.metadata=n,this.router=l,this.elementRef=a,this.renderer=o,this.modal=d,this.userpreferences=c,this.options=[{value:"-1",label:"LBL_REMINDER_NONE"},{value:"60",label:"LBL_REMINDER_1MINUTE"},{value:"300",label:"LBL_REMINDER_5MINUTES"},{value:"600",label:"LBL_REMINDER_10MINUTES"},{value:"900",label:"LBL_REMINDER_15MINUTES"},{value:"1800",label:"LBL_REMINDER_30MINUTES"},{value:"3600",label:"LBL_REMINDER_1HOUR"},{value:"7200",label:"LBL_REMINDER_2HOURS"},{value:"10800",label:"LBL_REMINDER_3HOURS"},{value:"18000",label:"LBL_REMINDER_5HOURS"},{value:"86400",label:"LBL_REMINDER_1DAY"}]}get display(){return this.options.find((t=>t.value==this.value))&&this.options.find((t=>t.value==this.value)).label?this.options.find((t=>t.value==this.value)).label:this.options.find((t=>"-1"==t.value)).label}get value(){let t=this.model.getField(this.fieldname);return t||"-1"}set value(t){this.model.setField(this.fieldname,t)}static#t=this.ɵfac=function(t){return new(t||fieldActivityReminder)(r.rXU(h.g),r.rXU(y.U),r.rXU(m.m),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix),r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(P.y),r.rXU(Lt.S))};static#e=this.ɵcmp=r.VBU({type:fieldActivityReminder,selectors:[["field-activity-reminder"]],features:[r.Vt3],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[3,"label"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"ngModel","ngModelChange"],["focus",""],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[3,"fieldname"],[3,"value"]],template:function(t,e){1&t&&r.DNE(0,Mt,1,2,"field-label",0)(1,Bt,2,5,"field-generic-display",1)(2,wt,8,5,"div",2),2&t&&(r.Y8G("ngIf",e.displayLabel),r.R7$(),r.Y8G("ngIf",!e.isEditMode()),r.R7$(),r.Y8G("ngIf",e.isEditMode()))},dependencies:[s.YU,s.Sq,s.bT,n.xH,n.y7,n.wz,n.BC,n.vS,Gt.b,At.K,Ut.A,L.W],encapsulation:2})}return fieldActivityReminder})();const $t=["activity-participation-panel-header",""];function Nt(t,e){if(1&t&&(r.j41(0,"th",2),r.nrm(1,"field-label",3),r.k0s()),2&t){const t=e.$implicit;r.R7$(),r.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}let Ot=(()=>{class ActivityParticipationPanelHeader{constructor(t,e,i){this.model=t,this.metadata=e,this.view=i,this.fieldsetfields=[],this.model.module="Contacts"}ngOnInit(){this.fieldsetfields=this.metadata.getFieldSetFields(this.fieldset)}static#t=this.ɵfac=function(t){return new(t||ActivityParticipationPanelHeader)(r.rXU(h.g),r.rXU(k.yu),r.rXU(y.U))};static#e=this.ɵcmp=r.VBU({type:ActivityParticipationPanelHeader,selectors:[["","activity-participation-panel-header",""]],inputs:{fieldset:"fieldset"},features:[r.Jv_([h.g])],attrs:$t,decls:2,vars:1,consts:[["scope","col",1,"slds-cell-shrink"],["class","","scope","col",4,"ngFor","ngForOf"],["scope","col",1,""],[3,"fieldname","fieldconfig"]],template:function(t,e){1&t&&(r.nrm(0,"th",0),r.DNE(1,Nt,2,2,"th",1)),2&t&&(r.R7$(),r.Y8G("ngForOf",e.fieldsetfields))},dependencies:[s.Sq,Gt.b],encapsulation:2})}return ActivityParticipationPanelHeader})();var Vt=i(68823),zt=i(18521);const Pt=["activity-participation-panel-participant",""];function Ht(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-utility-icon",4),r.bIt("click",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.removeItem(e))})),r.k0s()}}function qt(t,e){if(1&t&&(r.j41(0,"td"),r.nrm(1,"field-container",5),r.k0s()),2&t){const t=e.$implicit;r.R7$(),r.Y8G("field",t.field)("fieldconfig",t.fieldconfig)}}let Jt=(()=>{class ActivityParticipationPanelParticipant{constructor(t,e,i,s){this.model=t,this.parent=e,this.metadata=i,this.view=s,this.participant={},this.editmode=!1,this.fieldsetfields=[],this.remove=new r.bkB}ngOnInit(){this.model.module=this.participant.module,this.model.id=this.participant.id,this.model.setData(this.participant.data),this.model.parentmodel=this.parent,this.fieldsetfields=this.metadata.getFieldSetFields(this.fieldset)}removeItem(t){t.stopPropagation(),this.editmode&&this.remove.emit(!0)}static#t=this.ɵfac=function(t){return new(t||ActivityParticipationPanelParticipant)(r.rXU(h.g),r.rXU(h.g,4),r.rXU(k.yu),r.rXU(y.U))};static#e=this.ɵcmp=r.VBU({type:ActivityParticipationPanelParticipant,selectors:[["","activity-participation-panel-participant",""]],inputs:{participant:"participant",module:"module",editmode:"editmode",fieldset:"fieldset"},outputs:{remove:"remove"},features:[r.Jv_([h.g])],attrs:Pt,decls:5,vars:3,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],["class","slds-m-right--xx-small","icon","close","size","xx-small",3,"click",4,"ngIf"],["size","xx-small",3,"module"],[4,"ngFor","ngForOf"],["icon","close","size","xx-small",1,"slds-m-right--xx-small",3,"click"],["fielddisplayclass","slds-truncate slds-p-horizontal--x-small",3,"field","fieldconfig"]],template:function(t,e){1&t&&(r.j41(0,"td")(1,"div",0),r.DNE(2,Ht,1,0,"system-utility-icon",1),r.nrm(3,"system-icon",2),r.k0s()(),r.DNE(4,qt,2,2,"td",3)),2&t&&(r.R7$(2),r.Y8G("ngIf",e.editmode),r.R7$(),r.Y8G("module",e.model.module),r.R7$(),r.Y8G("ngForOf",e.fieldsetfields))},dependencies:[s.Sq,s.bT,x.y,Vt.J,zt.B],encapsulation:2})}return ActivityParticipationPanelParticipant})();function Wt(t,e){if(1&t){const t=r.RV6();r.j41(0,"tr",4),r.bIt("remove",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.removeParticipant(e))})),r.k0s()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("participant",t)("editmode",i.editmode)("fieldset",i.fieldset)}}let Kt=(()=>{class ActivityParticipationPanel{constructor(t,e,i,s){this.model=t,this.metadata=e,this.view=i,this.language=s,this.participants=[],this.editmode=!1,this.remove=new r.bkB,this.view.isEditable=!1,this.view.displayLabels=!1}removeParticipant(t){this.remove.emit(t)}participantid(t,e){return e.id}static#t=this.ɵfac=function(t){return new(t||ActivityParticipationPanel)(r.rXU(h.g),r.rXU(k.yu),r.rXU(y.U),r.rXU(f.B))};static#e=this.ɵcmp=r.VBU({type:ActivityParticipationPanel,selectors:[["activity-participation-panel"]],inputs:{participants:"participants",editmode:"editmode",fieldset:"fieldset"},outputs:{remove:"remove"},features:[r.Jv_([y.U])],decls:6,vars:3,consts:[[1,"slds-size--1-of-1","slds-scrollable--y"],[1,"slds-table","slds-table_bordered"],["activity-participation-panel-header","",1,"slds-line-height_reset",3,"fieldset"],["activity-participation-panel-participant","",3,"participant","editmode","fieldset","remove",4,"ngFor","ngForOf","ngForTrackBy"],["activity-participation-panel-participant","",3,"participant","editmode","fieldset","remove"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"table",1)(2,"thead"),r.nrm(3,"tr",2),r.k0s(),r.j41(4,"tbody"),r.DNE(5,Wt,1,3,"tr",3),r.k0s()()()),2&t&&(r.R7$(3),r.Y8G("fieldset",e.fieldset),r.R7$(2),r.Y8G("ngForOf",e.participants)("ngForTrackBy",e.participantid))},dependencies:[s.Sq,Ot,Jt],encapsulation:2})}return ActivityParticipationPanel})();var Qt=i(53915),Zt=i(29836),te=i(44985);function ee(t,e){if(1&t&&r.nrm(0,"field-label",3),2&t){const t=r.XpG();r.Y8G("fieldname",t.fieldname)("fieldconfig",t.fieldconfig)}}function ie(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",24),r.bIt("click",(function(){const e=r.eBV(t).index,i=r.XpG(3);return r.Njj(i.setLookupType(e))})),r.j41(1,"div",25)(2,"div",26),r.nrm(3,"system-icon",27),r.j41(4,"div",28),r.nrm(5,"system-label-modulename",29),r.k0s()()()()}if(2&t){const t=e.$implicit;r.R7$(3),r.Y8G("module",t.module),r.R7$(2),r.Y8G("module",t.module)}}const se=t=>({"slds-is-open":t});function ne(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",16)(1,"div",17)(2,"div",8)(3,"div",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.toggleLookupTypeSelect())})),r.nrm(4,"input",19)(5,"system-icon",20),r.k0s(),r.j41(6,"div",21)(7,"ul",22),r.DNE(8,ie,6,2,"li",23),r.k0s()()()()()}if(2&t){const t=r.XpG(2);r.R7$(2),r.Y8G("ngClass",r.eq3(3,se,t.lookuplinkSelectOpen)),r.R7$(2),r.Y8G("value",t.lookupTypeName),r.R7$(4),r.Y8G("ngForOf",t.lookuplinks)}}function le(t,e){if(1&t){const t=r.RV6();r.j41(0,"field-lookup-recent",30),r.bIt("selectedObject",(function(e){r.eBV(t);const i=r.XpG(2);return r.Njj(i.addItem(e))})),r.k0s()}if(2&t){const t=r.XpG(2);r.Y8G("module",t.lookuplinks[t.lookupType].module)}}function ae(t,e){if(1&t){const t=r.RV6();r.j41(0,"field-lookup-search",31),r.bIt("selectedObject",(function(e){r.eBV(t);const i=r.XpG(2);return r.Njj(i.addItem(e))}))("searchWithModal",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.searchWithModal())})),r.k0s()}if(2&t){const t=r.XpG(2);r.Y8G("module",t.lookuplinks[t.lookupType].module)("relatefilter",t.relateFilter)("searchterm",t.lookupSearchTerm)}}const oe=t=>({"slds-combobox__input":t});function de(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",4)(1,"div",5),r.DNE(2,ne,9,5,"div",6),r.j41(3,"div",7)(4,"div",8)(5,"div",9)(6,"input",10),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.onFocus())}))("focus",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.onFocus())})),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.lookupSearchTerm,e)||(i.lookupSearchTerm=e),r.Njj(e)})),r.k0s(),r.j41(7,"button",11),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.searchWithModal())})),r.nrm(8,"system-button-icon",12),r.k0s()(),r.j41(9,"div",13),r.DNE(10,le,1,1,"field-lookup-recent",14)(11,ae,1,3,"field-lookup-search",15),r.k0s()()()()()}if(2&t){const t=r.XpG();r.R7$(2),r.Y8G("ngIf",t.lookuplinks.length>1),r.R7$(2),r.Y8G("ngClass",r.eq3(8,se,t.lookupSearchOpen)),r.R7$(2),r.Y8G("ngClass",r.eq3(10,oe,t.lookuplinks.length>1)),r.R50("ngModel",t.lookupSearchTerm),r.Y8G("placeholder",t.language.getModuleCombinedLabel("LBL_SEARCH",null==t.lookuplinks[t.lookupType]?null:t.lookuplinks[t.lookupType].module)),r.R7$(2),r.Y8G("icon","search"),r.R7$(2),r.Y8G("ngIf",t.lookupSearchOpen&&""===t.lookupSearchTerm),r.R7$(),r.Y8G("ngIf",t.lookupSearchOpen&&""!==t.lookupSearchTerm)}}let ce=(()=>{class fieldActivityParticipationPanel extends Rt.s{constructor(t,e,i,s,n,l,a,o,d){super(t,e,s,n,l),this.model=t,this.view=e,this.broadcast=i,this.language=s,this.metadata=n,this.router=l,this.elementRef=a,this.renderer=o,this.modal=d,this.lookupType=0,this.lookuplinks=[],this.lookuplinkSelectOpen=!1,this.lookupSearchOpen=!1,this.lookupSearchTerm="",this.participants=[],this.subscriptions.add(this.broadcast.message$.subscribe((t=>this.handleMessage(t)))),this.subscriptions.add(this.model.data$.subscribe((t=>{this.lookuplinks.length>0&&this.setParticipants(),this.updateRelateFilter()})))}get lookupTypeName(){return this.language.getModuleName(this.lookuplinks[this.lookupType]?.module)}get relateFilterActive(){return"Users"!=this.lookuplinks[this.lookupType]?.module}ngOnInit(){this.lookuplinks=this.getLookuplinks(),this.setParticipants(),this.fieldconfig.fieldset?this.fieldset=this.fieldconfig.fieldset:this.fieldset=this.metadata.getComponentConfig("fieldActivityParticipationPanel").fieldset,this.fieldconfig.relatefilterfield&&this.createRelateFilter()}ngOnDestroy(){this.subscriptions.unsubscribe()}onClick(t){this.elementRef.nativeElement.contains(t.target)||this.closePopups()}handleRelateFIlterField(){this.fieldconfig.relatefilterfield&&(this.createRelateFilter(),this.subscriptions.add(this.model.data$.subscribe((t=>{this.updateRelateFilter()}))))}createRelateFilter(){let t=this.metadata.getFieldDefs(this.model.module,this.fieldconfig.relatefilterfield);if(t){let e="parent"==t.type?this.model.getField(t.type_name):t.module;this.relateFilter={module:e,relationship:this.fieldconfig.relatefilterrelationship,id:this.model.getField(t.id_name),display:this.model.getField(this.fieldconfig.relatefilterfield),active:!!this.model.getField(t.id_name),required:!1}}}removeRelateFilter(){this.relateFilter=void 0}updateRelateFilter(){if(this.relateFilterActive){let t=this.metadata.getFieldDefs(this.model.module,this.fieldconfig.relatefilterfield);t&&(this.relateFilter.id=this.model.getField(t.id_name),this.relateFilter.display=this.model.getField(this.fieldconfig.relatefilterfield),this.relateFilter.active=!!this.relateFilter.id)}}getLookuplinks(){let t=[];this.fieldconfig.linknames&&(t=this.fieldconfig.linknames.split(",")),0==t.length&&(t=["contacts","users","consumers"]);let e=[];for(let i of t){i=i.trim();let t=this.metadata.getFieldDefs(this.model.module,i)?.module;t&&this.metadata.moduleDefs[t]&&e.push({name:i,module:t})}return e}setParticipants(){for(let t of this.lookuplinks)if(this.model.data[t.name]&&this.model.data[t.name].beans)for(let e in this.model.data[t.name].beans){let i=this.model.data[t.name].beans[e];("Users"!=t.module||this.displayAssignedUser||e!=this.model.data.assigned_user_id)&&(this.participants.findIndex((t=>t.id==i.id))<0&&this.participants.push({module:t.module,id:i.id,data:i,link:t.name}))}}addItem(t){this.model.data[this.lookuplinks[this.lookupType].name]||(this.model.data[this.lookuplinks[this.lookupType].name]={beans:{}}),this.model.data[this.lookuplinks[this.lookupType].name].beans[t.id]=t.data,this.lookupSearchOpen=!1,this.setParticipants()}handleMessage(t){if(t.messagedata.reference&&"model.save"===t.messagetype)this.fieldid===t.messagedata.reference&&(this.lookupSearchTerm="",this.addItem({id:t.messagedata.data.id,text:t.messagedata.data.summary_text}))}closePopups(){this.lookupSearchOpen=!1,this.lookuplinkSelectOpen=!1,this.clickListener()}toggleLookupTypeSelect(){this.lookuplinkSelectOpen=!this.lookuplinkSelectOpen,this.lookupSearchOpen=!1}setLookupType(t){this.lookupSearchTerm="",this.lookupType=t,this.lookuplinkSelectOpen=!1,this.relateFilterActive?this.createRelateFilter():this.removeRelateFilter()}removeItem(t){this.model.data[t.link].beans_relations_to_delete||(this.model.data[t.link].beans_relations_to_delete={}),this.model.data[t.link].beans_relations_to_delete[t.id]=t,delete this.model.data[t.link].beans[t.id],this.participants=this.participants.filter((e=>e.id!=t.id))}onFocus(){this.openSearchDropDown()}openSearchDropDown(){this.lookuplinkSelectOpen=!1,this.lookupSearchOpen=!0,this.clickListener=this.renderer.listen("document","click",(t=>this.onClick(t)))}searchWithModal(){this.modal.openModal("ObjectModalModuleLookup").subscribe((t=>{t.instance.module=this.lookuplinks[this.lookupType].module,t.instance.multiselect=!1,this.relateFilter&&(t.instance.relatefilter=this.relateFilter),t.instance.selectedItems.subscribe((t=>{this.addItem({id:t[0].id,text:t[0].summary_text,data:t[0]})})),t.instance.usedSearchTerm.subscribe((t=>{this.lookupSearchTerm=t})),t.instance.searchTerm=this.lookupSearchTerm}))}static#t=this.ɵfac=function(t){return new(t||fieldActivityParticipationPanel)(r.rXU(h.g),r.rXU(y.U),r.rXU(m.m),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix),r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(P.y))};static#e=this.ɵcmp=r.VBU({type:fieldActivityParticipationPanel,selectors:[["ng-component"]],features:[r.Vt3],decls:3,vars:5,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fieldset","participants","editmode","remove"],["class","slds-form-element__control",4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-form-element__control"],[1,"slds-combobox-group","slds-p-vertical--xx-small"],["class","slds-combobox_object-switcher slds-combobox-addon_start",4,"ngIf"],[1,"slds-combobox_container","slds-combobox-addon_end"],["role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click",3,"ngClass"],["role","none",1,"slds-combobox__form-element","slds-input-has-icon","slds-input-has-icon_right"],["type","text","aria-autocomplete","list","autoComplete","off","role","textbox",1,"slds-input",3,"ngClass","ngModel","placeholder","click","focus","ngModelChange"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"click"],[3,"icon"],["role","listbox",1,"slds-dropdown","slds-dropdown_length-with-icon-7","slds-dropdown_fluid"],[3,"module","selectedObject",4,"ngIf"],[3,"module","relatefilter","searchterm","selectedObject","searchWithModal",4,"ngIf"],[1,"slds-combobox_object-switcher","slds-combobox-addon_start"],[1,"slds-combobox_container"],[1,"slds-combobox__form-element","slds-input-has-icon","slds-input-has-icon--right",3,"click"],["type","text","readonly","","autoComplete","off","role","textbox",1,"slds-input","slds-combobox__input","slds-combobox__input-value",3,"value"],["icon","down","sprite","utility","addclasses","slds-input__icon slds-input__icon_right"],["role","listbox",1,"slds-dropdown","slds-dropdown_length-5","slds-dropdown_x-small","slds-dropdown_left"],["role","group","aria-label","Suggested for you",1,"slds-listbox","slds-listbox_vertical"],["role","presentation","class","slds-listbox__item",3,"click",4,"ngFor","ngForOf"],["role","presentation",1,"slds-listbox__item",3,"click"],["role","option",1,"slds-media","slds-listbox__option","slds-listbox__option_plain","slds-media_small"],[1,"slds-grid","slds-grid--vertical-align-center"],["size","x-small",3,"module"],[1,"slds-truncate"],[3,"module"],[3,"module","selectedObject"],[3,"module","relatefilter","searchterm","selectedObject","searchWithModal"]],template:function(t,e){1&t&&(r.DNE(0,ee,1,2,"field-label",0),r.j41(1,"activity-participation-panel",1),r.bIt("remove",(function(t){return e.removeItem(t)})),r.k0s(),r.DNE(2,de,12,12,"div",2)),2&t&&(r.Y8G("ngIf",e.displayLabel),r.R7$(),r.Y8G("fieldset",e.fieldset)("participants",e.participants)("editmode",e.isEditMode()),r.R7$(),r.Y8G("ngIf",e.isEditable()&&e.isEditMode()))},dependencies:[s.YU,s.Sq,s.bT,n.me,n.BC,n.vS,Gt.b,Qt._,Zt.T,H.t,Vt.J,te.r,Kt],encapsulation:2})}return fieldActivityParticipationPanel})();var re=i(29994),me=i(49722);const ue=t=>({"slds-is-selected":t});let he=(()=>{class ActivityParticipationStatus{constructor(t,e,i,s,n){this.view=t,this.session=e,this.cdRef=i,this.backend=s,this.toast=n,this.status="none",this.updating=!1}get disabled(){return!(!this.view.isEditMode()&&!this.updating&&"Users"==this.model.module&&this.model.id==this.session.authData.userId&&this.parent&&"Planned"==this.parent.getField("status"))}accept(){this.setStatus("accept")}decline(){this.setStatus("decline")}tentative(){this.setStatus("tentative")}setStatus(t){this.updating=!0,this.backend.postRequest(`module/${this.parent.module}/${this.parent.id}/status/${this.model.id}/${t}`).subscribe((e=>{this.status=t,this.onChange(this.status),this.updating=!1}),(t=>{this.toast.sendToast("Error Updating","error"),this.updating=!1}))}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}writeValue(t){this.status=t||"none",this.cdRef.detectChanges()}static#t=this.ɵfac=function(t){return new(t||ActivityParticipationStatus)(r.rXU(y.U),r.rXU(re.d),r.rXU(r.gRc),r.rXU(me.H),r.rXU(it.o))};static#e=this.ɵcmp=r.VBU({type:ActivityParticipationStatus,selectors:[["activity-participation-status"]],inputs:{parent:"parent",model:"model"},features:[r.Jv_([{provide:n.kq,useExisting:(0,r.Rfq)((()=>ActivityParticipationStatus)),multi:!0}])],decls:7,vars:12,consts:[["role","group",1,"slds-button-group"],[1,"slds-button","slds-button-icon","slds-button_icon-border-filled",2,"height","22px","width","22px",3,"disabled","ngClass","click"],["icon","check","size","xx-small"],["icon","question_mark"],["icon","error"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"button",1),r.bIt("click",(function(){return e.accept()})),r.nrm(2,"system-button-icon",2),r.k0s(),r.j41(3,"button",1),r.bIt("click",(function(){return e.tentative()})),r.nrm(4,"system-button-icon",3),r.k0s(),r.j41(5,"button",1),r.bIt("click",(function(){return e.decline()})),r.nrm(6,"system-button-icon",4),r.k0s()()),2&t&&(r.R7$(),r.Y8G("disabled",e.disabled)("ngClass",r.eq3(6,ue,"accept"==e.status)),r.R7$(2),r.Y8G("disabled",e.disabled)("ngClass",r.eq3(8,ue,"tentative"==e.status)),r.R7$(2),r.Y8G("disabled",e.disabled)("ngClass",r.eq3(10,ue,"decline"==e.status)))},dependencies:[s.YU,H.t],encapsulation:2})}return ActivityParticipationStatus})(),pe=(()=>{class fieldActivityParticipationStatus extends Rt.s{constructor(t,e,i,s,n,l,a,o,d,c){super(t,e,s,n,l),this.model=t,this.view=e,this.broadcast=i,this.language=s,this.metadata=n,this.router=l,this.elementRef=a,this.renderer=o,this.modal=d,this.session=c}get disabled(){return"Users"!=this.model.module||this.model.getField("id")!=this.session.authData.userId||!this.model.parentmodel||"Planned"!=this.model.parentmodel.getField("status")}static#t=this.ɵfac=function(t){return new(t||fieldActivityParticipationStatus)(r.rXU(h.g),r.rXU(y.U),r.rXU(m.m),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix),r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(P.y),r.rXU(re.d))};static#e=this.ɵcmp=r.VBU({type:fieldActivityParticipationStatus,selectors:[["ng-component"]],features:[r.Vt3],decls:1,vars:3,consts:[[3,"model","ngModel","parent","ngModelChange"]],template:function(t,e){1&t&&(r.j41(0,"activity-participation-status",0),r.mxI("ngModelChange",(function(t){return r.DH7(e.value,t)||(e.value=t),t})),r.k0s()),2&t&&(r.Y8G("model",e.model),r.R50("ngModel",e.value),r.Y8G("parent",e.model.parentmodel))},dependencies:[n.BC,n.vS,he],encapsulation:2})}return fieldActivityParticipationStatus})();const ge=t=>({id:t,module:"Users"});function fe(t,e){if(1&t){const t=r.RV6();r.j41(0,"activity-participation-status",1),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.value,e)||(i.value=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG();r.Y8G("model",r.eq3(3,ge,t.partcipationRecord.id)),r.R50("ngModel",t.value),r.Y8G("parent",t.model)}}let ve=(()=>{class fieldActivityCurrentUserParticipationStatus extends Rt.s{constructor(t,e,i,s,n,l,a,o,d,c){super(t,e,s,n,l),this.model=t,this.view=e,this.broadcast=i,this.language=s,this.metadata=n,this.router=l,this.elementRef=a,this.renderer=o,this.modal=d,this.session=c,this.partcipationRecord=void 0,this.subscriptions.add(this.model.data$.subscribe((t=>{this.setParticipation()})))}get disabled(){return!(this.partcipationRecord&&!this.isEditMode()&&"Planned"==this.model.getField("status"))}get value(){return this.partcipationRecord?this.partcipationRecord.activity_accept_status:"none"}set value(t){this.partcipationRecord.activity_accept_status=t}setParticipation(){if(this.partcipationRecord=void 0,this.model.getField("assigned_user_id")!=this.session.authData.userId&&this.model.data.users)for(let t in this.model.data.users.beans)this.model.data.users.beans[t].id==this.session.authData.userId&&(this.partcipationRecord=this.model.data.users.beans[t])}static#t=this.ɵfac=function(t){return new(t||fieldActivityCurrentUserParticipationStatus)(r.rXU(h.g),r.rXU(y.U),r.rXU(m.m),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix),r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(P.y),r.rXU(re.d))};static#e=this.ɵcmp=r.VBU({type:fieldActivityCurrentUserParticipationStatus,selectors:[["ng-component"]],features:[r.Vt3],decls:1,vars:1,consts:[[3,"model","ngModel","parent","ngModelChange",4,"ngIf"],[3,"model","ngModel","parent","ngModelChange"]],template:function(t,e){1&t&&r.DNE(0,fe,1,5,"activity-participation-status",0),2&t&&r.Y8G("ngIf",e.partcipationRecord)},dependencies:[s.bT,n.BC,n.vS,he],encapsulation:2})}return fieldActivityCurrentUserParticipationStatus})();var be=i(95757),ye=i(71692),ke=i(66031),_e=i(95096),je=i(53584),xe=i(30012);function Re(t,e){if(1&t&&(r.j41(0,"div",2)(1,"div",3),r.nrm(2,"system-icon",4),r.k0s(),r.j41(3,"div",5)(4,"div",6)(5,"h3",7)(6,"a",8),r.EFF(7),r.k0s()()(),r.j41(8,"div",6)(9,"div",9)(10,"span",10)(11,"span",11),r.EFF(12,"Progress: 25%"),r.k0s()()(),r.j41(13,"div",12),r.EFF(14),r.k0s()()()()),2&t){const t=r.XpG();r.R7$(2),r.Y8G("icon",t.uploadData.fileIcon.icon)("sprite",t.uploadData.fileIcon.sprite),r.R7$(5),r.JRh(t.uploadData.fileName),r.R7$(3),r.Y8G("ngStyle",t.progressBarStyle),r.R7$(4),r.SpI(" ",t.uploadData.progress," % ")}}const Ge=["*"];let Ae=(()=>{class ActivityTimelineDropZoneWrapper{constructor(t,e,i,s,n,l,a,o){this.language=t,this.toast=e,this.configurationService=i,this.activitiytimeline=s,this.noteModel=n,this.model=l,this.session=a,this.helper=o,this.uploadData={fileName:"",fileIcon:{},uploading:!1,progress:void 0}}get maxSize(){return this.configurationService.getSystemParamater("upload_maxsize")}get progressBarStyle(){return{width:(this.uploadData.progress||0)+"%"}}handleDroppedFiles(t){let e=[],i=[],s=[];for(let n in t)t.hasOwnProperty(n)&&(this.fileSizeExceeded(t[n])?this.toast.sendToast(this.language.getLabelFormatted("LBL_EXCEEDS_MAX_UPLOADFILESIZE",[t[n].name,this.helper.humanFileSize(this.maxSize)]),"error"):".msg"==t[n].name.substring(t[n].name.length-4).toLowerCase()?e.push(t[n]):".eml"==t[n].name.substring(t[n].name.length-4).toLowerCase()?i.push(t[n]):s.push(t[n]));e.length>0&&(this.uploadData.uploading=!0,this.uploadFiles(e,this.model.module,this.model.id,"msg").subscribe((t=>{this.uploadData.fileName=t.fileName,this.uploadData.progress=t.progress,this.setFileIcon(t.fileName,t.fileType)}),(()=>{this.toast.sendToast(this.language.getLabel("ERR_UPLOAD_FAILED"),"error")}),(()=>{this.activitiytimeline.getTimeLineData("History"),this.uploadData.uploading=!1}))),i.length>0&&(this.uploadData.uploading=!0,this.uploadFiles(i,this.model.module,this.model.id,"eml").subscribe((t=>{this.uploadData.fileName=t.fileName,this.uploadData.progress=t.progress,this.setFileIcon(t.fileName,t.fileType)}),(()=>{this.toast.sendToast(this.language.getLabel("ERR_UPLOAD_FAILED"),"error")}),(()=>{this.activitiytimeline.getTimeLineData("History"),this.uploadData.uploading=!1}))),s.length>0&&this.addNotesFromFiles(s)}uploadFiles(t,e,i,s){if(0===t.length)return;let n=new Z.B;for(let l of t)this.readFile(l).subscribe((()=>{let t=new XMLHttpRequest,a={};t.onreadystatechange=(i=this)=>{if(4==t.readyState)try{if("Notes"==e){let e=JSON.parse(t.response);n.next({progress:100,fileName:l.name,fileType:l.type,fileMD5:e[0].filemd5})}n.complete()}catch(e){a={status:"error",data:"Unknown error occurred: ["+t.responseText+"]"}}},t.upload.addEventListener("progress",(t=>{n.next({progress:Math.round(t.loaded/t.total*100),fileName:l.name,fileType:l.type,fileMD5:l.filemd5})}),!1);let o=this.configurationService.getBackendUrl()+"/common/spiceattachments";"Notes"!=e&&(o=this.configurationService.getBackendUrl()+"/module/Emails/"+s),t.open("POST",o,!0),t.setRequestHeader("OAuth-Token",this.session.authData.sessionId),t.setRequestHeader("Content-Type","application/json;charset=UTF-8");let d={file:l.filecontent,filename:l.name,filemimetype:l.type?l.type:"application/octet-stream",filemd5:void 0,beanId:i,beanModule:e};t.send(JSON.stringify(d))}));return n.asObservable()}readFile(t){let e=new Z.B,i=new FileReader;return i.file=t,i.onloadend=()=>{let t=i.result.toString();t=t.substring(t.indexOf("base64,")+7);let s=i.file;s.filecontent=t,e.next(s),e.complete()},i.readAsDataURL(t),e.asObservable()}setFileIcon(t,e){if(e==this.uploadData.fileIcon.fileType)return;let i=this.helper.determineFileIcon(e);if("unknown"==i){"msg"==t.split(".").splice(-1,1)[0].toLowerCase()&&(this.uploadData.fileIcon={icon:"email",sprite:"standard",fileType:e})}this.uploadData.fileIcon={icon:i,sprite:"doctype",fileType:e}}addNotesFromFiles(t){this.addNewNote(t)}addNewNote(t,e=0){this.noteModel.reset(),this.noteModel.module="Notes",this.noteModel.initialize(this.activitiytimeline.parent),this.noteModel.startEdit(!1),this.noteModel.setField("name",t[e].name),this.noteModel.setField("file_name",t[e].name),this.noteModel.setField("file_mime_type",t[e].type?t[e].type:"application/octet-stream"),this.uploadData.uploading=!0,this.uploadFiles([t[e]],this.noteModel.module,this.noteModel.id).subscribe((t=>{this.uploadData.fileName=t.fileName,this.uploadData.progress=t.progress,this.setFileIcon(t.fileName,t.fileType),t.fileMD5&&this.noteModel.setField("file_md5",t.fileMD5)}),(()=>{this.toast.sendToast(this.language.getLabel("ERR_UPLOAD_FAILED"),"error")}),(()=>{this.noteModel.save().subscribe((i=>{e+1>=t.length?(this.activitiytimeline.getTimeLineData("History"),this.uploadData.uploading=!1):this.addNewNote(t,e+1)}))}))}fileSizeExceeded(t){return this.maxSize&&t.size>this.maxSize}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineDropZoneWrapper)(r.rXU(f.B),r.rXU(it.o),r.rXU(je.i),r.rXU(be.k),r.rXU(h.g),r.rXU(h.g,4),r.rXU(re.d),r.rXU(N.d))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineDropZoneWrapper,selectors:[["activity-timeline-drop-zone-wrapper"]],features:[r.Jv_([],[h.g])],ngContentSelectors:Ge,decls:3,vars:1,consts:[[3,"system-drop-file"],["class","slds-m-vertical--medium slds-media",4,"ngIf"],[1,"slds-m-vertical--medium","slds-media"],[1,"slds-m-right--x-small","slds-align--absolute-center",2,"width","30px","height","30px"],["divClass","","size","'small'",3,"icon","sprite"],[1,"slds-media__body"],[1,"slds-grid","slds-grid_vertical-align-center","slds-grid--align-spread","slds-has-flexi-truncate"],[1,"slds-truncate","slds-text-heading--x-small","slds-p-right--xxx-small"],["href","javascript:void(0);"],[1,"slds-progress-bar"],[1,"slds-progress-bar__value",3,"ngStyle"],[1,"slds-assistive-text"],[1,"slds-text-align--right",2,"width","50px"]],template:function(t,e){1&t&&(r.NAR(),r.j41(0,"div",0),r.bIt("system-drop-file",(function(t){return e.handleDroppedFiles(t)})),r.DNE(1,Re,15,5,"div",1),r.SdG(2),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",e.uploadData.uploading))},dependencies:[s.bT,s.B3,Vt.J,xe.H],encapsulation:2})}return ActivityTimelineDropZoneWrapper})();function Ce(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",7)(1,"div",8),r.bIt("click",(function(e){const i=r.eBV(t).$implicit,s=r.XpG();return r.Njj(s.setFilter(e,i.type))})),r.j41(2,"span",9),r.nrm(3,"input",36),r.j41(4,"label",37),r.nrm(5,"span",12),r.j41(6,"span",13),r.EFF(7),r.k0s()()()()()}if(2&t){const t=e.$implicit,i=r.XpG();r.R7$(3),r.Y8G("id",t.type)("checked",i.getChecked(t.type)),r.R7$(),r.BMQ("for",t.type),r.R7$(3),r.JRh(t.name)}}const Ie=t=>({"slds-is-open":t});let Xe=(()=>{class ActivityTimelineFilter{constructor(t,e,i,s,n){this.renderer=t,this.elementRef=e,this.language=i,this.metadata=s,this.activitiytimeline=n,this.isOpen=!1,this.activityTypes=[],this.objectfilters=[],this.ownerfilter="",this.setFromService()}setFromService(){this.objectfilters=JSON.parse(JSON.stringify(this.activitiytimeline.filters.objectfilters)),this.ownerfilter=this.activitiytimeline.filters.own}setToService(){this.activitiytimeline.filters.objectfilters=JSON.parse(JSON.stringify(this.objectfilters)),this.activitiytimeline.filters.own=this.ownerfilter,this.activitiytimeline.reload()}toggleOpen(t){t.stopPropagation(),this.isOpen=!this.isOpen,this.isOpen?this.clickListener=this.renderer.listen("document","click",(t=>this.onClick(t))):this.clickListener&&this.clickListener(),this.isOpen&&this.buildTypes()}onClick(t){this.elementRef.nativeElement.contains(t.target)||(this.isOpen=!1,this.clickListener())}buildTypes(){this.activityTypes=[];for(let t of this.activitiytimeline.filterObjects)this.activityTypes.push({type:t,name:this.language.getModuleName(t)});this.activityTypes.sort(((t,e)=>t.name>e.name?1:-1))}get filterColorClass(){return this.activitiytimeline.filters.objectfilters.length>0||this.activitiytimeline.filters.own?"slds-icon-text-error":"slds-icon-text-default"}setFilter(t,e){if(t.preventDefault(),"all"==e)this.objectfilters=[];else{let t=this.objectfilters.indexOf(e);t>=0?this.objectfilters.splice(t,1):this.objectfilters.push(e)}}getChecked(t){return"all"==t?0==this.objectfilters.length:this.objectfilters.indexOf(t)>=0}closeDialog(t){this.clickListener&&this.clickListener(),t?this.setToService():this.setFromService(),this.isOpen=!1}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineFilter)(r.rXU(r.sFG),r.rXU(r.aKT),r.rXU(f.B),r.rXU(k.yu),r.rXU(be.k))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineFilter,selectors:[["activity-timeline-filter"]],decls:45,vars:10,consts:[[1,"slds-dropdown-trigger","slds-dropdown-trigger_click","slds-p-horizontal--xxx-small",3,"ngClass"],["icon","filterList","size","x-small",3,"colorclass","title","click"],[1,"slds-is-absolute","slds-dropdown","slds-dropdown_right","slds-nubbin_top-right",2,"right","-10px","top","25px"],[1,"slds-grid"],[1,"slds-p-horizontal--small","slds-border--right",2,"min-width","180px"],[1,"slds-p-vertical--x-small"],["label","LBL_TYPE"],[1,"slds-form-element","slds-p-vertical--xx-small"],[1,"slds-form-element__control",3,"click"],[1,"slds-checkbox"],["type","checkbox","id","alltypes",3,"checked"],["for","alltypes",1,"slds-checkbox__label"],[1,"slds-checkbox_faux"],[1,"slds-form-element__label"],["label","LBL_ALL"],["class","slds-form-element slds-p-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-p-horizontal--small",2,"min-width","180px"],["label","LBL_FILTER"],[1,"slds-form-element"],[1,"slds-form-element__control"],[1,"slds-radio"],["type","radio","id","ownerall","name","filters","value","",3,"ngModel","ngModelChange"],["for","ownerall",1,"slds-radio__label"],[1,"slds-radio_faux"],["type","radio","id","ownerassignedtome","name","filters","value","assigned",3,"ngModel","ngModelChange"],["for","ownerassignedtome",1,"slds-radio__label"],[1,"slds-form-element__label","slds-truncate"],["label","LBL_ASSIGNEDTOME"],["type","radio","id","ownercreatedbyme","name","filters","value","created",3,"ngModel","ngModelChange"],["for","ownercreatedbyme",1,"slds-radio__label"],["label","LBL_CREATEDBYME"],[1,"slds-popover__footer"],[1,"slds-col--bump-left","slds-button","slds-button_neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_APPLY"],["type","checkbox",3,"id","checked"],[1,"slds-checkbox__label"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"system-utility-icon",1),r.bIt("click",(function(t){return e.toggleOpen(t)})),r.k0s(),r.j41(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),r.nrm(6,"system-label",6),r.k0s(),r.j41(7,"div",7)(8,"div",8),r.bIt("click",(function(t){return e.setFilter(t,"all")})),r.j41(9,"span",9),r.nrm(10,"input",10),r.j41(11,"label",11),r.nrm(12,"span",12),r.j41(13,"span",13),r.nrm(14,"system-label",14),r.k0s()()()()(),r.DNE(15,Ce,8,4,"div",15),r.k0s(),r.j41(16,"div",16)(17,"div",5),r.nrm(18,"system-label",17),r.k0s(),r.j41(19,"fieldset",18)(20,"div",19)(21,"span",20)(22,"input",21),r.mxI("ngModelChange",(function(t){return r.DH7(e.ownerfilter,t)||(e.ownerfilter=t),t})),r.k0s(),r.j41(23,"label",22),r.nrm(24,"span",23),r.j41(25,"span",13),r.nrm(26,"system-label",14),r.k0s()()(),r.j41(27,"span",20)(28,"input",24),r.mxI("ngModelChange",(function(t){return r.DH7(e.ownerfilter,t)||(e.ownerfilter=t),t})),r.k0s(),r.j41(29,"label",25),r.nrm(30,"span",23),r.j41(31,"span",26),r.nrm(32,"system-label",27),r.k0s()()(),r.j41(33,"span",20)(34,"input",28),r.mxI("ngModelChange",(function(t){return r.DH7(e.ownerfilter,t)||(e.ownerfilter=t),t})),r.k0s(),r.j41(35,"label",29),r.nrm(36,"span",23),r.j41(37,"span",26),r.nrm(38,"system-label",30),r.k0s()()()()()()(),r.j41(39,"footer",31)(40,"div",3)(41,"button",32),r.bIt("click",(function(){return e.closeDialog(!1)})),r.nrm(42,"system-label",33),r.k0s(),r.j41(43,"button",34),r.bIt("click",(function(){return e.closeDialog(!0)})),r.nrm(44,"system-label",35),r.k0s()()()()()),2&t&&(r.Y8G("ngClass",r.eq3(8,Ie,e.isOpen)),r.R7$(),r.Y8G("colorclass",e.filterColorClass)("title",e.language.getLabel("LBL_FILTER")),r.R7$(9),r.Y8G("checked",e.getChecked("all")),r.R7$(5),r.Y8G("ngForOf",e.activityTypes),r.R7$(7),r.R50("ngModel",e.ownerfilter),r.R7$(6),r.R50("ngModel",e.ownerfilter),r.R7$(6),r.R50("ngModel",e.ownerfilter))},dependencies:[s.YU,s.Sq,n.me,n.Fm,n.BC,n.vS,L.W,zt.B],encapsulation:2})}return ActivityTimelineFilter})();var Ee=i(58461),Se=i(23221),Te=i(56639);function Le(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",5),r.bIt("click",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.toggleModuleFilter(e.module))})),r.j41(1,"div",6),r.nrm(2,"system-icon",7),r.k0s(),r.j41(3,"div",6),r.EFF(4),r.k0s(),r.j41(5,"div"),r.nrm(6,"system-label-modulename",8),r.k0s()()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("ngStyle",i.getElementStyle(t.module)),r.R7$(2),r.Y8G("title",i.language.getModuleName(t.module))("module",t.module),r.R7$(2),r.SpI(" ",t.count," "),r.R7$(2),r.Y8G("module",t.module)("singular",1==t.count)}}function Ue(t,e){if(1&t&&(r.j41(0,"div",9)(1,"div",6),r.EFF(2),r.k0s(),r.j41(3,"div"),r.EFF(4),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.SpI(" ",t.year,": "),r.R7$(2),r.SpI(" ",t.count," ")}}let Me=(()=>{class ActivityTimelineAggregates{constructor(t,e,i){this.metadata=t,this.language=e,this.activitiytimeline=i,this.labellength="default"}get moduleaggregates(){return this.module&&this.activitiytimeline.activities[this.module].aggregates.module?this.activitiytimeline.activities[this.module].aggregates.module:[]}get yearaggregates(){return this.module&&this.activitiytimeline.activities[this.module].aggregates.year?this.activitiytimeline.activities[this.module].aggregates.year:[]}getElementStyle(t){if(!this.activitiytimeline.checkModuleActive(t))return{filter:"grayscale(100%)",opacity:"0.5"}}toggleModuleFilter(t){this.activitiytimeline.toggleModuleFilter(t),this.metadata.getModuleDefs(t).ftsactivities.Activities&&this.activitiytimeline.getTimeLineData("Activities"),this.metadata.getModuleDefs(t).ftsactivities.History&&this.activitiytimeline.getTimeLineData("History")}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineAggregates)(r.rXU(k.yu),r.rXU(f.B),r.rXU(be.k))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineAggregates,selectors:[["activity-timeline-aggregates"]],inputs:{module:"module",labellength:"labellength"},decls:5,vars:2,consts:[[1,"slds-grid","slds-box--border"],[1,"slds-size--1-of-2","slds-p-around--x-small","slds-border--right"],["class","slds-grid slds-grid--vertical-align-center slds-p-vertical--xxx-small slds-gutters_direct-xxx-small",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"slds-size--1-of-2","slds-p-around--x-small"],["class","slds-grid slds-grid--vertical-align-center slds-p-vertical--xxx-small slds-gutters_direct-xxx-small",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-vertical--xxx-small","slds-gutters_direct-xxx-small",3,"ngStyle","click"],[1,"slds-p-right--small"],["size","xx-small","divClass","slds-align--absolute-center",3,"title","module"],[3,"module","singular"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-vertical--xxx-small","slds-gutters_direct-xxx-small"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"div",1),r.DNE(2,Le,7,6,"div",2),r.k0s(),r.j41(3,"div",3),r.DNE(4,Ue,5,2,"div",4),r.k0s()()),2&t&&(r.R7$(2),r.Y8G("ngForOf",e.moduleaggregates),r.R7$(2),r.Y8G("ngForOf",e.yearaggregates))},dependencies:[s.Sq,s.B3,Vt.J,te.r],encapsulation:2})}return ActivityTimelineAggregates})();function Be(t,e){if(1&t&&(r.j41(0,"div",4),r.nrm(1,"activity-timeline-aggregates",5),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("module",t.module)}}function De(t,e){if(1&t&&(r.j41(0,"li"),r.nrm(1,"activitytimeline-item-container",8),r.k0s()),2&t){const t=e.$implicit,i=r.XpG(2);r.R7$(),r.Y8G("activity",t)("module",i.module)}}const Fe=t=>({"slds-hide":t});function we(t,e){if(1&t&&(r.j41(0,"ul",6),r.DNE(1,De,2,2,"li",7),r.k0s()),2&t){const t=r.XpG();r.Y8G("ngClass",r.eq3(2,Fe,t.loading)),r.R7$(),r.Y8G("ngForOf",t.activities)}}function Ye(t,e){1&t&&(r.j41(0,"ul",9)(1,"li"),r.nrm(2,"activitytimeline-stencil"),r.k0s(),r.j41(3,"li",10),r.nrm(4,"activitytimeline-stencil"),r.k0s(),r.j41(5,"li",11),r.nrm(6,"activitytimeline-stencil"),r.k0s()())}function $e(t,e){1&t&&(r.j41(0,"system-illustration-no-records"),r.nrm(1,"system-label",14),r.k0s())}function Ne(t,e){if(1&t&&(r.j41(0,"div",12),r.DNE(1,$e,2,0,"system-illustration-no-records",13),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngIf",!t.loading)}}let Oe=(()=>{class ActivityTimelineContainer{constructor(t,e){this.activitiytimeline=t,this.language=e,this.displayaggregates=!1}ngOnInit(){this.activitiytimeline.getTimeLineData(this.module)}get activities(){return this.activitiytimeline.activities[this.module].list}get hasActivities(){return this.activitiytimeline.activities[this.module].list.length>0}get loading(){return this.activitiytimeline.activities[this.module].loading}get loadingmore(){return this.activitiytimeline.activities[this.module].loadingmore}get hasAggregates(){try{return this.activitiytimeline.activities[this.module].aggregates.module.length>0}catch(t){return!1}}trackByFn(t,e){return e.id}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineContainer)(r.rXU(be.k),r.rXU(f.B))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineContainer,selectors:[["activitytimeline-container"]],inputs:{module:"module",displayaggregates:"displayaggregates"},decls:5,vars:4,consts:[["class","slds-p-vertical--x-small slds-m-top--x-small",4,"ngIf"],["class","slds-timeline slds-p-vertical--small",3,"ngClass",4,"ngIf","ngIfElse"],["class","slds-timeline",4,"ngIf"],["nocontent",""],[1,"slds-p-vertical--x-small","slds-m-top--x-small"],["labellength","short",3,"module"],[1,"slds-timeline","slds-p-vertical--small",3,"ngClass"],[4,"ngFor","ngForOf"],[3,"activity","module"],[1,"slds-timeline"],[2,"opacity","0.6"],[2,"opacity","0.3"],[1,"slds-p-vertical--medium"],[4,"ngIf"],["label","LBL_NO_ENTRIES"]],template:function(t,e){if(1&t&&r.DNE(0,Be,2,1,"div",0)(1,we,2,4,"ul",1)(2,Ye,7,0,"ul",2)(3,Ne,2,1,"ng-template",null,3,r.C5r),2&t){const t=r.sdS(4);r.Y8G("ngIf",e.displayaggregates&&e.hasAggregates),r.R7$(),r.Y8G("ngIf",e.hasActivities)("ngIfElse",t),r.R7$(),r.Y8G("ngIf",e.loading||e.loadingmore)}},dependencies:[s.YU,s.Sq,s.bT,Ee.b,L.W,Se.t,Te.v,Me],encapsulation:2})}return ActivityTimelineContainer})();var Ve=i(10650);const ze=["moretab"],Pe=["maintabs"],He=["moretabs"],qe=t=>({"slds-active":t});function Je(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",13,14)(2,"a",15),r.bIt("click",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.setTab(e.module))})),r.nrm(3,"system-label-modulename",16),r.k0s()()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("ngClass",r.eq3(4,qe,i.checkTab(t.module))),r.BMQ("data-module",t.module),r.R7$(3),r.Y8G("module",t.module)("singular",!0)}}const We=t=>({"slds-hidden":t});function Ke(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",17,18),r.bIt("click",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.setTab(e.module))})),r.j41(2,"a",19)(3,"span",20),r.nrm(4,"system-utility-icon",21)(5,"system-label-modulename",16),r.k0s()()()}if(2&t){const t=e.$implicit,i=r.XpG();r.BMQ("data-module",t.module),r.R7$(4),r.Y8G("ngClass",r.eq3(4,We,!i.checkTab(t.module))),r.R7$(),r.Y8G("module",t.module)("singular",!0)}}function Qe(t,e){if(1&t&&(r.j41(0,"div",22),r.nrm(1,"system-dynamic-component",23),r.k0s()),2&t){const t=e.$implicit,i=r.XpG();r.Y8G("ngClass",i.tabClass(t))("hidden",!i.checkTab(t.module)),r.R7$(),r.Y8G("component",t.component)("componentconfig",t.componentconfig)}}function Ze(t,e){1&t&&(r.j41(0,"div",24),r.EFF(1,"no actions configured"),r.k0s())}function ti(t,e){1&t&&r.DNE(0,Ze,2,0,"ng-template")}const ei=t=>({"slds-hide":t}),ii=(t,e)=>({"slds-is-open":t,"slds-active":e});let si=(()=>{class ActivityTimelineAddContainer{constructor(t,e,i,s,n,l){this.model=t,this.language=e,this.activitiytimeline=i,this.metadata=s,this.elementRef=n,this.renderer=l,this.currenttab="",this.tabs=[],this.moreOpen=!1,this.moreModules=[],this.resizeListener=this.renderer.listen("window","resize",(t=>{this.handleOverflow()}))}ngOnInit(){let t=this.metadata.getComponentConfig("ActivityTimelineAddContainer",this.model.module);if(t&&t.componentset){let e=this.metadata.getComponentSetObjects(t.componentset);for(let t of e)t.componentconfig.module&&this.metadata.checkModuleAcl(t.componentconfig.module,"create")&&this.tabs.push({module:t.componentconfig.module,component:t.component,componentconfig:t.componentconfig});this.currenttab=this.tabs[0].module}else t&&t.tabs&&t.tabs.length>0&&(this.tabs=t.tabs,this.currenttab=t.tabs[0].module)}ngAfterViewInit(){this.handleOverflow()}ngOnDestroy(){this.resizeListener()}handleOverflow(){this.moreModules=[],this.maintabs.forEach((t=>{t.element.nativeElement.classList.remove("slds-hide"),t.element.nativeElement.classList.add("slds-hidden")})),this.moretab.element.nativeElement.classList.add("slds-hidden"),this.moretab.element.nativeElement.classList.remove("slds-hide");let t=this.elementRef.nativeElement.getBoundingClientRect().width,e=this.moretab.element.nativeElement.getBoundingClientRect().width,i=!1,s=0;this.maintabs.forEach(((n,l)=>{let a=n.element.nativeElement.getBoundingClientRect().width;s+=a,s>t-e&&(i||l+1<this.maintabs.length||a>e)&&(n.element.nativeElement.classList.add("slds-hide"),this.moreModules.push(n.element.nativeElement.attributes.getNamedItem("data-module").value),i=!0),n.element.nativeElement.classList.remove("slds-hidden")})),i?(this.moretab.element.nativeElement.classList.remove("slds-hidden"),this.moretabs.forEach((t=>{this.moreModules.indexOf(t.element.nativeElement.attributes.getNamedItem("data-module").value)>=0?t.element.nativeElement.classList.remove("slds-hide"):t.element.nativeElement.classList.add("slds-hide")}))):(this.moretab.element.nativeElement.classList.remove("slds-hidden"),this.moretab.element.nativeElement.classList.add("slds-hide"))}setTab(t){this.currenttab=t}checkTab(t){return this.currenttab==t}get moreactive(){return this.moreModules.indexOf(this.currenttab)>=0}tabClass(t){return this.currenttab==t.module?"slds-show":"slds-hide"}toggleOpen(){this.moreOpen=!this.moreOpen}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineAddContainer)(r.rXU(h.g),r.rXU(f.B),r.rXU(be.k),r.rXU(k.yu),r.rXU(r.aKT),r.rXU(r.sFG))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineAddContainer,selectors:[["activitytimeline-add-container"]],viewQuery:function(t,e){if(1&t&&(r.GBs(ze,5,r.c1b),r.GBs(Pe,5,r.c1b),r.GBs(He,5,r.c1b)),2&t){let t;r.mGM(t=r.lsd())&&(e.moretab=t.first),r.mGM(t=r.lsd())&&(e.maintabs=t),r.mGM(t=r.lsd())&&(e.moretabs=t)}},decls:13,vars:11,consts:[[1,"slds-tabs--scoped",3,"ngClass"],["role","tablist",1,"slds-tabs--scoped__nav"],["class","slds-tabs--scoped__item","role","presentation",3,"ngClass",4,"ngFor","ngForOf"],["role","presentation",1,"slds-tabs_scoped__item","slds-tabs_scoped__overflow-button","slds-dropdown-trigger","slds-dropdown-trigger_click",3,"ngClass","click"],["moretab",""],["href","javascript:void(0);","role","tab",1,"slds-tabs--scoped__link"],["label","LBL_MORE"],["icon","down","size","x-small",1,"slds-p-horizontal--xx-small"],[1,"slds-dropdown","slds-dropdown_right"],["role","menu",1,"slds-dropdown__list","slds-dropdown_length-with-icon-10"],["class","slds-dropdown__item","role","presentation",3,"click",4,"ngFor","ngForOf"],["class","slds-tabs--scoped__content slds-p-around--none","role","tabpanel",3,"ngClass","hidden",4,"ngFor","ngForOf"],[4,"ngIf"],["role","presentation",1,"slds-tabs--scoped__item",3,"ngClass"],["maintabs",""],["href","javascript:void(0);","role","tab",1,"slds-tabs--scoped__link",3,"click"],[3,"module","singular"],["role","presentation",1,"slds-dropdown__item",3,"click"],["moretabs",""],["href","javascript:void(0);","role","menuitem"],[1,"slds-truncate"],["icon","check","size","x-small",1,"slds-p-right--xx-small",3,"ngClass"],["role","tabpanel",1,"slds-tabs--scoped__content","slds-p-around--none",3,"ngClass","hidden"],[3,"component","componentconfig"],[1,"slds-box","slds-theme--shade","slds-align--absolute-center"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"ul",1),r.DNE(2,Je,4,6,"li",2),r.j41(3,"li",3,4),r.bIt("click",(function(){return e.toggleOpen()})),r.j41(5,"a",5),r.nrm(6,"system-label",6)(7,"system-utility-icon",7),r.k0s(),r.j41(8,"div",8)(9,"ul",9),r.DNE(10,Ke,6,6,"li",10),r.k0s()()()(),r.DNE(11,Qe,2,4,"div",11),r.k0s(),r.DNE(12,ti,1,0,null,12)),2&t&&(r.Y8G("ngClass",r.eq3(6,ei,0==e.tabs.length)),r.R7$(2),r.Y8G("ngForOf",e.tabs),r.R7$(),r.Y8G("ngClass",r.l_i(8,ii,e.moreOpen,e.moreactive)),r.R7$(7),r.Y8G("ngForOf",e.tabs),r.R7$(),r.Y8G("ngForOf",e.tabs),r.R7$(),r.Y8G("ngIf",0==e.tabs.length))},dependencies:[s.YU,s.Sq,s.bT,Ve.s,L.W,te.r,zt.B],encapsulation:2})}return ActivityTimelineAddContainer})(),ni=(()=>{class ActivityTimelineSummaryButton{constructor(t,e,i,s){this.model=t,this.language=e,this.router=i,this.navigationtab=s}displaySummary(){let t="";this.navigationtab?.tabid&&(t="/tab/"+this.navigationtab.tabid),this.router.navigate([t+"/module/"+this.model.module+"/historysummary/"+this.model.id])}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineSummaryButton)(r.rXU(h.g),r.rXU(f.B),r.rXU(et.Ix),r.rXU(ke._,8))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSummaryButton,selectors:[["activitytimeline-summary-button"]],decls:2,vars:0,consts:[["type","button",1,"slds-button","slds-button--neutral","slds-is-absolute",2,"right",".5rem","top","-3px",3,"click"],["label","LBL_SUMMARY"]],template:function(t,e){1&t&&(r.j41(0,"button",0),r.bIt("click",(function(){return e.displaySummary()})),r.nrm(1,"system-label",1),r.k0s())},dependencies:[L.W],encapsulation:2})}return ActivityTimelineSummaryButton})();class PendingCopy{constructor(t,e){this._document=e;const i=this._textarea=this._document.createElement("textarea"),s=i.style;s.position="fixed",s.top=s.opacity="0",s.left="-999em",i.setAttribute("aria-hidden","true"),i.value=t,i.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(i)}copy(){const t=this._textarea;let e=!1;try{if(t){const i=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),e=this._document.execCommand("copy"),i&&i.focus()}}catch{}return e}destroy(){const t=this._textarea;t&&(t.remove(),this._textarea=void 0)}}let li=(()=>{class Clipboard{constructor(t){this._document=t}copy(t){const e=this.beginCopy(t),i=e.copy();return e.destroy(),i}beginCopy(t){return new PendingCopy(t,this._document)}static#t=this.ɵfac=function(t){return new(t||Clipboard)(r.KVO(s.qQ))};static#e=this.ɵprov=r.jDH({token:Clipboard,factory:Clipboard.ɵfac,providedIn:"root"})}return Clipboard})();let ai=(()=>{class ClipboardModule{static#t=this.ɵfac=function(t){return new(t||ClipboardModule)};static#e=this.ɵmod=r.$C({type:ClipboardModule});static#i=this.ɵinj=r.G2t({})}return ClipboardModule})();function oi(t,e){1&t&&r.nrm(0,"system-spinner",2)}function di(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",3),r.bIt("click",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.getToken(e))})),r.j41(1,"system-utility-icon",4),r.nrm(2,"system-label",5),r.k0s()()}if(2&t){const t=r.XpG();r.Y8G("ngStyle",t.handleVisibility())}}let ci=(()=>{class ActivityTimelineSpiceMailButton{constructor(t,e,i,s,n,l){this.backend=t,this.configuration=e,this.toast=i,this.model=s,this.language=n,this.clipboard=l,this.tokenconfig=!1,this.emailbean=!1,this.tokenLoading=!1}ngOnInit(){this.checkEmailRel(),this.getMailboxToken()}checkEmailRel(){let t=this.model._fields;Object.entries(t).forEach((([t,e],i)=>{"link"==e.type&&"Emails"==e.module&&(this.emailbean=!0)}))}getMailboxToken(){this.backend.getRequest("spicemailtoken/mailboxprocessor").subscribe({next:t=>{this.tokenconfig=t.tokenConfig}})}handleVisibility(){return this.tokenconfig&&this.emailbean?{display:"block"}:{display:"none"}}getToken(t){this.tokenLoading=!0,t.preventDefault(),t.stopPropagation(),this.backend.getRequest("spicemailtoken/"+this.model.module+"/"+this.model.id).subscribe({next:t=>{this.token=t.tokenEmail,this.clipboard.copy(this.token),this.toast.sendToast(this.language.getLabel("LBL_DATA_COPIED")+": "+this.token,"success"),this.tokenLoading=!1},error:()=>{this.toast.sendToast(this.language.getLabel("LBL_ERROR_COPYING_DATA"),"error"),this.tokenLoading=!1}})}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineSpiceMailButton)(r.rXU(me.H),r.rXU(je.i),r.rXU(it.o),r.rXU(h.g),r.rXU(f.B),r.rXU(li))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSpiceMailButton,selectors:[["activitytimeline-spice-mail-button"]],decls:2,vars:2,consts:[["size","12",4,"ngIf"],[3,"ngStyle","click",4,"ngIf"],["size","12"],[3,"ngStyle","click"],["icon","number_input","size","x-small"],["label","LBL_COPY"]],template:function(t,e){1&t&&r.DNE(0,oi,1,0,"system-spinner",0)(1,di,3,1,"div",1),2&t&&(r.Y8G("ngIf",e.tokenLoading),r.R7$(),r.Y8G("ngIf",!e.tokenLoading))},dependencies:[s.bT,s.B3,L.W,v.P,zt.B],encapsulation:2})}return ActivityTimelineSpiceMailButton})();function ri(t,e){1&t&&r.nrm(0,"activitytimeline-add-container")}function mi(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-input-delayed",19),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.ftsSearchTerm,e)||(i.ftsSearchTerm=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG();r.Y8G("placeholder",t.language.getLabel("LBL_SEARCH")),r.R50("ngModel",t.ftsSearchTerm)}}function ui(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-utility-icon",23),r.bIt("click",(function(e){r.eBV(t);const i=r.XpG(2);return r.Njj(i.toggleAggregates("Activities",e))})),r.k0s()}if(2&t){const t=r.XpG(2);r.Y8G("icon",t.displayaggregates.Activities?"up":"down")}}function hi(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",24),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.loadMore("Activities"))})),r.j41(1,"span"),r.nrm(2,"system-label",25),r.k0s()()}}function pi(t,e){if(1&t&&(r.qex(0),r.j41(1,"div",11)(2,"div",12)(3,"span"),r.EFF(4),r.k0s(),r.j41(5,"span",13),r.nrm(6,"system-label",20),r.k0s(),r.DNE(7,ui,1,1,"system-utility-icon",15),r.k0s(),r.DNE(8,hi,3,0,"button",21),r.k0s(),r.nrm(9,"activitytimeline-container",22),r.bVm()),2&t){const t=r.XpG();r.R7$(4),r.JRh(t.activitiytimeline.activities.Activities.totalcount),r.R7$(3),r.Y8G("ngIf",t.activitiytimeline.usefts&&t.activitiytimeline.activities.Activities.totalcount>0),r.R7$(),r.Y8G("ngIf",t.activitiytimeline.canLoadMore("Activities")),r.R7$(),r.Y8G("displayaggregates",t.displayaggregates.Activities)}}function gi(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-utility-icon",23),r.bIt("click",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.toggleAggregates("History",e))})),r.k0s()}if(2&t){const t=r.XpG();r.Y8G("icon",t.displayaggregates.History?"up":"down")}}function fi(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",26),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.loadMore("History"))})),r.j41(1,"span"),r.nrm(2,"system-label",25),r.k0s()()}}let vi=(()=>{class ActivityTimeline{constructor(t,e,i,s,n,l,a,o,d){this.model=t,this.router=e,this.language=i,this.activitiytimeline=s,this.metadata=n,this.utils=l,this.layout=a,this.navigationtab=o,this.injector=d,this.componentconfig={},this.displayaggregates={Activities:!1,History:!1}}ngOnInit(){this.activitiytimeline.parent=this.model,this.componentconfig.usefts&&(this.activitiytimeline.usefts=!0),this.componentconfig.defaultentries&&(this.activitiytimeline.defaultLimit=this.componentconfig.defaultentries)}get ftsSearchTerm(){return this.activitiytimeline.filters.searchterm}set ftsSearchTerm(t){this.activitiytimeline.filters.searchterm=t,this.activitiytimeline.reload()}get displayAddContainer(){return!this.componentconfig.hideaddcontainer}get displayActivitiesContainer(){return!this.componentconfig.hideactivitiescontainer}ngOnDestroy(){this.activitiytimeline.stopSubscriptions()}reload(){this.displayActivitiesContainer&&this.activitiytimeline.getTimeLineData("Activities"),this.activitiytimeline.getTimeLineData("History")}toggleAggregates(t,e){e.stopPropagation(),this.displayaggregates[t]=!this.displayaggregates[t]}loadMore(t){this.activitiytimeline.getMoreTimeLineData(t,this.componentconfig.defaultentries)}toggleOpen(){this.activitiytimeline.openness=!this.activitiytimeline.openness}get isSmall(){return"small"==this.layout.screenwidth}static#t=this.ɵfac=function(t){return new(t||ActivityTimeline)(r.rXU(h.g),r.rXU(et.Ix),r.rXU(f.B),r.rXU(be.k),r.rXU(k.yu),r.rXU(j.g),r.rXU(ye.Z),r.rXU(ke._,8),r.rXU(r.zZn))};static#e=this.ɵcmp=r.VBU({type:ActivityTimeline,selectors:[["activity-timeline"]],features:[r.Jv_([be.k])],decls:27,vars:10,consts:[[4,"ngIf"],[1,"slds-grid","slds-grid--align-spread","slds-p-top--small","slds-grid--vertical-align-center"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-p-vertical--xx-small","slds-text-heading--small"],["label","LBL_ACTIVITIES"],["delay","1000","class","slds-p-horizontal--xx-small",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],[1,"slds-p-horizontal--xxx-small"],[1,"slds-button","slds-button--icon",3,"title","click"],["icon","refresh",1,"slds-p-horizontal--xxx-small","slds-icon-text-default"],[1,"slds-p-horizontal--xxx-small",3,"icon"],[1,"slds-p-top--x-small","activities-activity"],[1,"slds-is-relative","spiceActivitiyTimelineHeader"],[1,"slds-p-vertical--xx-small","slds-text-heading--x-small"],[1,"slds-p-horizontal--xx-small"],["label","LBL_PAST_ACTIVITIES"],["size","x-small",3,"icon","click",4,"ngIf"],["module","History",3,"displayaggregates"],[1,"slds-grid","slds-grid_align-end"],["class","slds-button slds-button--neutral","type","button",3,"click",4,"ngIf"],["delay","1000",1,"slds-p-horizontal--xx-small",3,"placeholder","ngModel","ngModelChange"],["label","LBL_NEXT_STEPS"],["class","slds-button slds-button--neutral slds-is-absolute","style","right:.5rem; top:-3px;","type","button",3,"click",4,"ngIf"],["module","Activities",3,"displayaggregates"],["size","x-small",3,"icon","click"],["type","button",1,"slds-button","slds-button--neutral","slds-is-absolute",2,"right",".5rem","top","-3px",3,"click"],["label","LBL_MORE"],["type","button",1,"slds-button","slds-button--neutral",3,"click"]],template:function(t,e){1&t&&(r.DNE(0,ri,1,0,"activitytimeline-add-container",0),r.j41(1,"div",1)(2,"div",2)(3,"div",3),r.nrm(4,"system-label",4),r.k0s()(),r.j41(5,"div",2),r.DNE(6,mi,1,2,"system-input-delayed",5),r.nrm(7,"activitytimeline-spice-mail-button",6)(8,"activity-timeline-filter",6),r.j41(9,"button",7),r.bIt("click",(function(){return e.reload()})),r.nrm(10,"system-button-icon",8),r.k0s(),r.j41(11,"button",7),r.bIt("click",(function(){return e.toggleOpen()})),r.nrm(12,"system-button-icon",9),r.k0s()()(),r.j41(13,"div",10),r.DNE(14,pi,10,4,"ng-container",0),r.j41(15,"div",11)(16,"div",12)(17,"span"),r.EFF(18),r.k0s(),r.j41(19,"span",13),r.nrm(20,"system-label",14),r.k0s(),r.DNE(21,gi,1,1,"system-utility-icon",15),r.k0s(),r.nrm(22,"activitytimeline-summary-button"),r.k0s(),r.j41(23,"activity-timeline-drop-zone-wrapper"),r.nrm(24,"activitytimeline-container",16),r.k0s(),r.j41(25,"div",17),r.DNE(26,fi,3,0,"button",18),r.k0s()()),2&t&&(r.Y8G("ngIf",e.displayAddContainer),r.R7$(6),r.Y8G("ngIf",e.activitiytimeline.usefts),r.R7$(3),r.Y8G("title",e.language.getLabel("LBL_RELOAD")),r.R7$(2),r.Y8G("title",e.language.getLabel("LBL_OPEN_ALL")),r.R7$(),r.Y8G("icon",e.activitiytimeline.openness?"chevronup":"chevrondown"),r.R7$(2),r.Y8G("ngIf",e.displayActivitiesContainer),r.R7$(4),r.JRh(e.activitiytimeline.activities.History.totalcount),r.R7$(3),r.Y8G("ngIf",e.activitiytimeline.usefts&&e.activitiytimeline.activities.History.totalcount>0),r.R7$(3),r.Y8G("displayaggregates",e.displayaggregates.History),r.R7$(2),r.Y8G("ngIf",e.activitiytimeline.canLoadMore("History")))},dependencies:[s.bT,n.BC,n.vS,H.t,_e._,L.W,zt.B,Ae,Xe,Oe,si,ni,ci],encapsulation:2})}return ActivityTimeline})();var bi=i(74547);function yi(t,e){1&t&&r.nrm(0,"activitytimeline-add-container")}function ki(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-input-delayed",22),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG(2);return r.DH7(i.ftsSearchTerm,e)||(i.ftsSearchTerm=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG(2);r.Y8G("placeholder",t.language.getLabel("LBL_SEARCH")),r.R50("ngModel",t.ftsSearchTerm)}}function _i(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",15),r.DNE(1,ki,1,2,"system-input-delayed",16),r.nrm(2,"activity-timeline-filter",17),r.j41(3,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.reload())})),r.nrm(4,"system-button-icon",19),r.k0s(),r.j41(5,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.displaySummary())})),r.nrm(6,"system-button-icon",20),r.k0s(),r.j41(7,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.toggleOpen())})),r.nrm(8,"system-button-icon",21),r.k0s()()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("ngIf",t.activitiytimeline.usefts),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_RELOAD")),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_SUMMARY")),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_OPEN_ALL")),r.R7$(),r.Y8G("icon",t.activitiytimeline.openness?"chevronup":"chevrondown")}}function ji(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-input-delayed",25),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG(2);return r.DH7(i.ftsSearchTerm,e)||(i.ftsSearchTerm=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG(2);r.Y8G("placeholder",t.language.getLabel("LBL_SEARCH")),r.R50("ngModel",t.ftsSearchTerm)}}function xi(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",23)(1,"div",3),r.DNE(2,ji,1,2,"system-input-delayed",24),r.nrm(3,"activity-timeline-filter",17),r.j41(4,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.reload())})),r.nrm(5,"system-button-icon",19),r.k0s(),r.j41(6,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.displaySummary())})),r.nrm(7,"system-button-icon",20),r.k0s(),r.j41(8,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.toggleOpen())})),r.nrm(9,"system-button-icon",21),r.k0s()()()}if(2&t){const t=r.XpG();r.R7$(2),r.Y8G("ngIf",t.activitiytimeline.usefts),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_RELOAD")),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_SUMMARY")),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_OPEN_ALL")),r.R7$(),r.Y8G("icon",t.activitiytimeline.openness?"chevronup":"chevrondown")}}function Ri(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",26),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.loadMore("History"))})),r.j41(1,"span"),r.nrm(2,"system-label",27),r.k0s()()}}function Gi(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",26),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.loadMore("Activities"))})),r.j41(1,"span"),r.nrm(2,"system-label",27),r.k0s()()}}const Ai=t=>({"slds-is-active":t}),Ci=t=>({"slds-hide":t});let Ii=(()=>{class ActivityTimelineTabbed extends vi{constructor(){super(...arguments),this.activetab="history"}displaySummary(){let t="";this.navigationtab?.tabid&&(t="/tab/"+this.navigationtab.tabid),this.router.navigate([t+"/module/"+this.model.module+"/historysummary/"+this.model.id])}static#t=this.ɵfac=(()=>{let t;return function(e){return(t||(t=r.xGo(ActivityTimelineTabbed)))(e||ActivityTimelineTabbed)}})();static#e=this.ɵcmp=r.VBU({type:ActivityTimelineTabbed,selectors:[["ng-component"]],features:[r.Jv_([be.k,bi.S]),r.Vt3],decls:23,vars:20,consts:[[4,"ngIf"],[1,"slds-tabs_default"],["class","slds-grid slds-grid--vertical-align-center slds-p-top--x-small",4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center"],["role","tablist",1,"slds-tabs_default__nav","slds-grow"],["role","presentation",1,"slds-tabs_default__item",3,"ngClass"],["href","javascript:void(0);","role","tab",1,"slds-tabs_default__link",3,"click"],["label","LBL_PAST_ACTIVITIES"],["label","LBL_NEXT_STEPS"],["class","slds-col--bump-left slds-p-vertical--xx-small",4,"ngIf"],["role","tabpanel",1,"slds-tabs_default__content","slds-p-top--xxx-small",3,"ngClass"],["module","History",3,"displayaggregates"],[1,"slds-align--absolute-center"],["class","slds-button slds-button--neutral","type","button",3,"click",4,"ngIf"],["module","Activities"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-top--x-small"],["delay","1000","class","slds-p-horizontal--xx-small slds-grow",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],[1,"slds-p-horizontal--xxx-small"],[1,"slds-button","slds-button--icon",3,"title","click"],["icon","refresh",1,"slds-p-horizontal--xxx-small","slds-icon-text-default"],["icon","side_list",1,"slds-p-horizontal--xxx-small"],[1,"slds-p-horizontal--xxx-small",3,"icon"],["delay","1000",1,"slds-p-horizontal--xx-small","slds-grow",3,"placeholder","ngModel","ngModelChange"],[1,"slds-col--bump-left","slds-p-vertical--xx-small"],["delay","1000","class","slds-p-horizontal--xx-small",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],["delay","1000",1,"slds-p-horizontal--xx-small",3,"placeholder","ngModel","ngModelChange"],["type","button",1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_MORE"]],template:function(t,e){1&t&&(r.DNE(0,yi,1,0,"activitytimeline-add-container",0),r.j41(1,"div",1),r.DNE(2,_i,9,5,"div",2),r.j41(3,"div",3)(4,"ul",4)(5,"li",5)(6,"a",6),r.bIt("click",(function(){return e.activetab="history"})),r.nrm(7,"system-label",7),r.EFF(8),r.k0s()(),r.j41(9,"li",5)(10,"a",6),r.bIt("click",(function(){return e.activetab="planned"})),r.nrm(11,"system-label",8),r.EFF(12),r.k0s()(),r.DNE(13,xi,10,5,"li",9),r.k0s()(),r.j41(14,"div",10)(15,"activity-timeline-drop-zone-wrapper"),r.nrm(16,"activitytimeline-container",11),r.k0s(),r.j41(17,"div",12),r.DNE(18,Ri,3,0,"button",13),r.k0s()(),r.j41(19,"div",10),r.nrm(20,"activitytimeline-container",14),r.j41(21,"div",12),r.DNE(22,Gi,3,0,"button",13),r.k0s()()()),2&t&&(r.Y8G("ngIf",e.displayAddContainer),r.R7$(2),r.Y8G("ngIf",e.isSmall),r.R7$(3),r.Y8G("ngClass",r.eq3(12,Ai,"history"==e.activetab)),r.R7$(3),r.SpI(" (",e.activitiytimeline.activities.History.totalcount,")"),r.R7$(),r.Y8G("ngClass",r.eq3(14,Ai,"planned"==e.activetab)),r.R7$(3),r.SpI(" (",e.activitiytimeline.activities.Activities.totalcount,")"),r.R7$(),r.Y8G("ngIf",!e.isSmall),r.R7$(),r.Y8G("ngClass",r.eq3(16,Ci,"history"!=e.activetab)),r.R7$(2),r.Y8G("displayaggregates",!1),r.R7$(2),r.Y8G("ngIf",e.activitiytimeline.canLoadMore("History")),r.R7$(),r.Y8G("ngClass",r.eq3(18,Ci,"planned"!=e.activetab)),r.R7$(3),r.Y8G("ngIf",e.activitiytimeline.canLoadMore("Activities")))},dependencies:[s.YU,s.bT,n.BC,n.vS,H.t,_e._,L.W,Ae,Xe,Oe,si],encapsulation:2})}return ActivityTimelineTabbed})();var Xi=i(23855),Ei=i(3719),Si=i(29895),Ti=i(37263);function Li(t,e){1&t&&r.nrm(0,"system-dynamic-component",23)}function Ui(t,e){if(1&t&&(r.j41(0,"div",21),r.DNE(1,Li,1,0,"system-dynamic-component",22),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngIf",t.displayattachments)}}function Mi(t,e){if(1&t&&r.nrm(0,"object-record-fieldset-horizontal-list",24),2&t){const t=r.XpG();r.Y8G("fieldset",t.headerFieldSet)}}function Bi(t,e){if(1&t&&(r.j41(0,"div",25),r.EFF(1),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.JRh(t.subject)}}function Di(t,e){if(1&t&&r.nrm(0,"object-action-menu",26),2&t){const t=r.XpG();r.Y8G("buttonsize","x-small")("actionset",t.actionset)}}function Fi(t,e){if(1&t&&r.nrm(0,"object-record-fieldset-horizontal-list",24),2&t){const t=r.XpG();r.Y8G("fieldset",t.subheaderFieldSet)}}function wi(t,e){1&t&&r.nrm(0,"system-dynamic-component",30)}function Yi(t,e){if(1&t&&(r.j41(0,"article",27),r.nrm(1,"object-record-fieldset",28),r.DNE(2,wi,1,0,"system-dynamic-component",29),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("fieldset",t.formFieldSet),r.R7$(),r.Y8G("ngIf",t.hasattachments)}}function $i(t,e){if(1&t){const t=r.RV6();r.j41(0,"object-action-menu",31),r.bIt("actionemitter",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.handleAction(e))})),r.k0s()}if(2&t){const t=r.XpG();r.Y8G("buttonsize","x-small")("actionset",t.actionset)}}const Ni=t=>({"slds-is-open":t}),Oi=t=>({"slds-hidden":t}),Vi=()=>({displayLabels:!1}),zi=(t,e)=>({"slds-theme--error":t,"slds-theme--warning":e});let Pi=(()=>{class ActivityTimelineItem{constructor(t,e,i,s,n,l,a,o,d,c){this.model=t,this.modelattachments=e,this.metadata=i,this.view=s,this.userpreferences=n,this.session=l,this.language=a,this.backend=o,this.activitiytimeline=d,this.cdref=c,this.activity={},this.showtoolset=!0,this.formFieldSet="",this.isopen=!1,this.componentconfig={},this.subscriptions=new z.yU,this.view.isEditable=!1,this.view.displayLabels=!0,this.isopen=!!d&&d.openness}ngOnInit(){this.model.id=this.activity.id,this.model.setData(this.activity.data),this.model.module=this.activity.module,this.displayattachments&&(this.modelattachments.module=this.model.module,this.modelattachments.id=this.model.id);let t=this.metadata.getComponentConfig("ActivityTimelineItem",this.model.module);this.headerFieldSet=this.componentconfig.headerfieldset?this.componentconfig.headerfieldset:t.headerfieldset,this.subheaderFieldSet=this.componentconfig.subheaderfieldset?this.componentconfig.subheaderfieldset:t.subheaderfieldset,this.formFieldSet=this.componentconfig.fieldset}ngAfterViewInit(){this.activitiytimeline&&this.subscriptions.add(this.activitiytimeline.openness$.subscribe((t=>{this.isopen=t,this.cdref.detectChanges()}))),this.subscriptions.add(this.modelattachments.loaded$.subscribe((t=>{this.cdref.detectChanges()})))}ngOnDestroy(){this.subscriptions.unsubscribe()}get actionset(){return this.componentconfig.actionset}get displayattachments(){return this.componentconfig.displayattachments}get hasattachments(){return this.componentconfig.displayattachments&&this.modelattachments.count>0}attachmentsloaded(){this.cdref.detectChanges()}get subject(){let t=this.model.getField("summary_text");return t||"-- no subject --"}get starttime(){let t=new moment.utc(this.activity.date_activity).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0));return t?t.format(this.userpreferences.getTimeFormat()):""}get startdate(){let t=new moment.utc(this.activity.date_activity).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0));return t?t.format(this.userpreferences.getDateFormat()):""}get activitiyDate(){const t=new moment.utc(this.activity.date_activity).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0)),e=t.format("YYYYMMDD")==(new moment).format("YYYYMMDD"),i=t.format("YYYY")==(new moment).format("YYYY");return e?t.format(this.userpreferences.getTimeFormat()):i?t.format("MMM D"):t.format(this.userpreferences.getDateFormat())}get isToday(){let t=(new moment.utc).tz(this.session.getSessionData("timezone"));return"Activities"==this.module&&new moment.utc(this.activity.date_activity).tz(this.session.getSessionData("timezone")).isSame(t,"day")}get isPast(){let t=(new moment.utc).tz(this.session.getSessionData("timezone"));return"Activities"==this.module&&new moment.utc(this.activity.date_activity).tz(this.session.getSessionData("timezone")).isBefore(t,"day")}get cantexpand(){return!this.formFieldSet}get enableDetail(){return this.model.checkAccess("detail")}handleAction(t){this.cdref.detectChanges()}goDetail(){this.enableDetail&&this.model.goDetail()}toggleexpand(){this.isopen=!this.isopen,this.isopen&&this.componentconfig.displayattachments&&!this.modelattachments.loaded&&this.modelattachments.getAttachments(),"Emails"==this.model.module&&"unread"==this.model.getField("status")&&(this.model.setField("status","read"),this.backend.postRequest(`module/Emails/${this.model.id}/status`,{},{status:"read"}).subscribe({error:()=>{this.model.setField("status","unread")}}))}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineItem)(r.rXU(h.g),r.rXU(bi.S),r.rXU(k.yu),r.rXU(y.U),r.rXU(Lt.S),r.rXU(re.d),r.rXU(f.B),r.rXU(me.H),r.rXU(be.k,8),r.rXU(r.gRc))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineItem,selectors:[["activitytimeline-item"]],inputs:{activity:"activity",showtoolset:"showtoolset",module:"module"},features:[r.Jv_([h.g,bi.S,y.U])],decls:23,vars:26,consts:[[1,"slds-timeline__item_expandable","slds-p-vertical--none",3,"ngClass"],[1,"slds-media"],[1,"slds-media__figure"],[1,"slds-button","slds-button_icon",3,"ngClass","disabled","click"],["icon","switch","addclasses","slds-timeline__details-action-icon"],["size","small","divClass","slds-icon_container slds-timeline__icon",3,"module","title"],[1,"slds-media__body","slds-truncate"],[1,"slds-grid","slds-grid_align-spread","slds-timeline__trigger","slds-truncate"],[1,"slds-grid","slds-grid_vertical-align-center","slds-truncate_container--75","slds-size--6-of-7","slds-no-space","slds-text-title_bold",3,"system-view-provider"],[1,"slds-truncate","slds-grid","slds-grid--vertical-align-center"],["class","slds-p-horizontal--xx-small",4,"ngIf"],[3,"fieldset",4,"ngIf","ngIfElse"],["noheaderfieldset",""],[1,"slds-timeline__date","slds-p-horizontal--x-small","slds-theme--shade",2,"border-radius","10px","height","18px",3,"title","ngClass"],[1,"slds-align--absolute-center"],[1,"slds-timeline__actions","slds-timeline__actions_inline"],["class","slds-show--medium",3,"buttonsize","actionset",4,"ngIf"],[1,"slds-m-horizontal_xx-small",3,"system-view-provider"],[3,"fieldset",4,"ngIf"],["class","slds-box slds-timeline__item_details slds-theme_shade slds-m-top_x-small slds-m-horizontal_xx-small",4,"ngIf"],["class","slds-hide--medium",3,"buttonsize","actionset","actionemitter",4,"ngIf"],[1,"slds-p-horizontal--xx-small"],["component","SpiceAttachmentsCount",4,"ngIf"],["component","SpiceAttachmentsCount"],[3,"fieldset"],["system-model-popover",""],[1,"slds-show--medium",3,"buttonsize","actionset"],[1,"slds-box","slds-timeline__item_details","slds-theme_shade","slds-m-top_x-small","slds-m-horizontal_xx-small"],["direction","vertical","fielddisplayclass","slds-truncate","fieldpadding","none",3,"fieldset"],["component","SpiceAttachmentsList",4,"ngIf"],["component","SpiceAttachmentsList"],[1,"slds-hide--medium",3,"buttonsize","actionset","actionemitter"]],template:function(t,e){if(1&t&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.bIt("click",(function(){return e.toggleexpand()})),r.nrm(4,"system-button-icon",4),r.k0s(),r.nrm(5,"system-icon",5),r.k0s(),r.j41(6,"div",6)(7,"div",7)(8,"div",8)(9,"h3",9),r.DNE(10,Ui,2,1,"div",10)(11,Mi,1,1,"object-record-fieldset-horizontal-list",11)(12,Bi,2,1,"ng-template",null,12,r.C5r),r.k0s()(),r.j41(14,"div",13)(15,"div",14),r.EFF(16),r.k0s()(),r.j41(17,"div",15),r.DNE(18,Di,1,2,"object-action-menu",16),r.k0s()(),r.j41(19,"div",17),r.DNE(20,Fi,1,1,"object-record-fieldset-horizontal-list",18),r.k0s(),r.DNE(21,Yi,3,2,"article",19),r.k0s()(),r.DNE(22,$i,1,2,"object-action-menu",20),r.k0s()),2&t){const t=r.sdS(13);r.Y8G("ngClass",r.eq3(17,Ni,e.isopen)),r.R7$(3),r.Y8G("ngClass",r.eq3(19,Oi,e.cantexpand))("disabled",e.cantexpand),r.R7$(2),r.Y8G("module",e.model.module)("title",e.language.getModuleName(e.model.module,!0)),r.R7$(3),r.Y8G("system-view-provider",r.lJ4(21,Vi)),r.R7$(2),r.Y8G("ngIf",e.displayattachments),r.R7$(),r.Y8G("ngIf",e.headerFieldSet)("ngIfElse",t),r.R7$(3),r.Y8G("title",e.startdate+" "+e.starttime)("ngClass",r.l_i(22,zi,e.isPast,e.isToday)),r.R7$(2),r.JRh(e.activitiyDate),r.R7$(2),r.Y8G("ngIf",e.showtoolset),r.R7$(),r.Y8G("system-view-provider",r.lJ4(25,Vi)),r.R7$(),r.Y8G("ngIf",e.subheaderFieldSet),r.R7$(),r.Y8G("ngIf",e.isopen&&!e.cantexpand),r.R7$(),r.Y8G("ngIf",e.showtoolset)}},dependencies:[s.YU,s.bT,Xi.P,Ei.D,Si.b,H.t,Ve.s,Vt.J,It.j,Ti.x],encapsulation:2,changeDetection:0})}return ActivityTimelineItem})();var Hi=i(47866),qi=i(34796);function Ji(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",5)(1,"button",6),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.cancel())})),r.nrm(2,"system-button-icon",7),r.j41(3,"span",8),r.nrm(4,"system-label",9),r.k0s()(),r.j41(5,"button",10),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.expand())})),r.nrm(6,"system-button-icon",11),r.j41(7,"span",8),r.nrm(8,"system-label",12),r.k0s()(),r.j41(9,"button",10),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.dock())})),r.nrm(10,"system-button-icon",13),r.j41(11,"span",8),r.nrm(12,"system-label",14),r.k0s()()()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("title",t.language.getLabel("LBL_CANCEL")),r.R7$(4),r.Y8G("disabled",!t.canExpand)("title",t.language.getLabel("LBL_EXPAND")),r.R7$(4),r.Y8G("disabled",!t.canDock)("title",t.language.getLabel("LBL_DOCK"))}}function Wi(t,e){1&t&&r.nrm(0,"system-dynamic-component",23)}function Ki(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",28),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(3);return r.Njj(e.expand())})),r.nrm(1,"system-button-icon",11),r.j41(2,"span",8),r.nrm(3,"system-label",12),r.k0s()()}if(2&t){const t=r.XpG(3);r.Y8G("disabled",!t.canExpand)("title",t.language.getLabel("LBL_EXPAND"))}}function Qi(t,e){if(1&t){const t=r.RV6();r.j41(0,"button",28),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(3);return r.Njj(e.dock())})),r.nrm(1,"system-button-icon",13),r.j41(2,"span",8),r.nrm(3,"system-label",14),r.k0s()()}if(2&t){const t=r.XpG(3);r.Y8G("disabled",!t.canDock)("title",t.language.getLabel("LBL_DOCK"))}}function Zi(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",24)(1,"button",25),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.cancel())})),r.nrm(2,"system-button-icon",26),r.j41(3,"span",8),r.nrm(4,"system-label",9),r.k0s()(),r.DNE(5,Ki,4,2,"button",27)(6,Qi,4,2,"button",27),r.k0s()}if(2&t){const t=r.XpG(2);r.R7$(),r.Y8G("title",t.language.getLabel("LBL_CANCEL")),r.R7$(4),r.Y8G("ngIf",!t.componentconfig.hideutilitybuttons),r.R7$(),r.Y8G("ngIf",!t.componentconfig.hideutilitybuttons)}}function ts(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",15),r.nrm(1,"object-record-fieldset",16),r.DNE(2,Wi,1,0,"system-dynamic-component",17),r.j41(3,"div",18),r.DNE(4,Zi,7,3,"div",19),r.j41(5,"div",20),r.nrm(6,"object-record-messages-badge",21),r.j41(7,"object-action-container",22),r.bIt("actionemitter",(function(e){r.eBV(t);const i=r.XpG();return r.Njj(i.handleaction(e))})),r.k0s()()()()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("fieldset",t.bodyFieldSet)("direction","vertical"),r.R7$(),r.Y8G("ngIf",t.allowattachments),r.R7$(2),r.Y8G("ngIf","top"!=t.utilityButtonsPosition),r.R7$(3),r.Y8G("actionset",t.actionset)}}let es=(()=>{class ActivityTimelineAddItem{constructor(t,e,i,s,n,l,a,o){this.metadata=t,this.activitiytimeline=e,this.model=i,this.view=s,this.language=n,this.modal=l,this.dockedComposer=a,this.ViewContainerRef=o,this.componentconfig={},this.headerFieldSet="",this.bodyFieldSet="",this.utilityButtonsPosition="bottom",this.isExpanded=!1,this.canExpand=!1,this.canDock=!1}ngOnInit(){this.model.module=this.module,this.model.initializeModel(),this.parentSubscription=this.activitiytimeline.parent.data$.subscribe((t=>{t.id==this.model.getField("parent_id")&&this.model.setField("parent_name",t.summary_text)})),this.view.isEditable=!0,this.view.setEditMode(),this.headerFieldSet=this.componentconfig.headerfieldset,this.bodyFieldSet=this.componentconfig.bodyfieldset,this.componentconfig.utilitybuttonsposition&&(this.utilityButtonsPosition=this.componentconfig.utilitybuttonsposition),this.checkCanExpand(),this.checkCanDock()}ngOnDestroy(){this.parentSubscription&&this.parentSubscription.unsubscribe()}get module(){return this.componentconfig.module}get actionset(){return this.componentconfig.actionset}get allowattachments(){return!0===this.componentconfig.allowattachments}initializeModule(){this.model.module=this.module,this.model.id=void 0,this.model.initializeModel(this.activitiytimeline.parent)}onHeaderClick(){this.isExpanded||(this.isExpanded=!0,this.initializeModule(),this.model.startEdit(!1))}checkCanExpand(){this.canExpand=!_.isEmpty(this.metadata.getComponentConfig("GlobalDockedComposerModal",this.model.module))}expand(){this.dockedComposer.addComposer(this.model.module,this.model,!0),this.isExpanded=!1,this.initializeModule()}checkCanDock(){this.canDock=!_.isEmpty(this.metadata.getComponentConfig("GlobalDockedComposer",this.model.module))}dock(){this.dockedComposer.addComposer(this.model.module,this.model),this.isExpanded=!1,this.initializeModule()}cancel(){this.model.cancelEdit(),this.isExpanded=!1,this.initializeModule()}handleaction(t){this.initializeModule(),this.view.setEditMode(),this.isExpanded=!1}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineAddItem)(r.rXU(k.yu),r.rXU(be.k),r.rXU(h.g),r.rXU(y.U),r.rXU(f.B),r.rXU(P.y),r.rXU(Hi.n),r.rXU(r.c1b))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineAddItem,selectors:[["activitytimeline-add-item"]],features:[r.Jv_([h.g,y.U])],decls:5,vars:3,consts:[[1,""],["class","slds-p-horizontal--xx-small slds-float_right",4,"ngIf"],[1,"slds-p-horizontal--xx-small",3,"click"],[3,"fieldset"],["class","slds-p-horizontal--xx-small",4,"ngIf"],[1,"slds-p-horizontal--xx-small","slds-float_right"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","close","size","medium"],[1,"slds-assistive-text"],["label","LBL_CANCEL"],[1,"slds-button","slds-button_icon",3,"disabled","title","click"],["icon","expand"],["label","LBL_EXPAND"],["icon","dock_panel"],["label","LBL_DOCK"],[1,"slds-p-horizontal--xx-small"],[3,"fieldset","direction"],["component","SpiceAttachmentsPanel",4,"ngIf"],[1,"slds-p-vertical--x-small","slds-grid"],["class","slds-button-group","role","group",4,"ngIf"],[1,"slds-col--bump-left","slds-grid","slds-grid--vertical-align-center"],["side","right"],[3,"actionset","actionemitter"],["component","SpiceAttachmentsPanel"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--icon-border","slds-button--neutral",3,"title","click"],["icon","close"],["class","slds-button slds-button--icon-border slds-button--neutral",3,"disabled","title","click",4,"ngIf"],[1,"slds-button","slds-button--icon-border","slds-button--neutral",3,"disabled","title","click"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,Ji,13,5,"div",1),r.j41(2,"div",2),r.bIt("click",(function(){return e.onHeaderClick()})),r.nrm(3,"object-record-fieldset",3),r.k0s(),r.DNE(4,ts,8,5,"div",4),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",e.isExpanded&&"top"==e.utilityButtonsPosition),r.R7$(2),r.Y8G("fieldset",e.headerFieldSet),r.R7$(),r.Y8G("ngIf",e.isExpanded))},dependencies:[s.bT,st.l,Ei.D,qi.o,H.t,Ve.s,L.W],encapsulation:2})}return ActivityTimelineAddItem})();var is=i(32130);function ss(t,e){if(1&t){const t=r.RV6();r.qex(0),r.nrm(1,"object-record-fieldset",4)(2,"system-dynamic-component",5),r.j41(3,"div",6)(4,"div",7)(5,"button",8),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.cancel())})),r.nrm(6,"system-button-icon",9),r.j41(7,"span",10),r.nrm(8,"system-label",11),r.k0s()(),r.j41(9,"button",8),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.expand())})),r.nrm(10,"system-button-icon",12),r.j41(11,"span",10),r.nrm(12,"system-label",13),r.k0s()(),r.j41(13,"button",8),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.dock())})),r.nrm(14,"system-button-icon",14),r.j41(15,"span",10),r.nrm(16,"system-label",15),r.k0s()()(),r.j41(17,"div",16),r.nrm(18,"object-record-messages-badge",17),r.j41(19,"button",18),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.send())})),r.nrm(20,"system-label",19),r.k0s()()(),r.bVm()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("fieldset",t.formFieldSet)("direction","vertical"),r.R7$(4),r.Y8G("title",t.language.getLabel("LBL_CANCEL")),r.R7$(4),r.Y8G("title",t.language.getLabel("LBL_EXPAND")),r.R7$(4),r.Y8G("title",t.language.getLabel("LBL_DOCK")),r.R7$(6),r.Y8G("disabled",!t.canSend)}}let ns=(()=>{class ActivityTimelineAddEmail extends es{constructor(t,e,i,s,n,l,a,o,d,c){super(t,e,i,s,n,l,a,o),this.metadata=t,this.activitiytimeline=e,this.model=i,this.view=s,this.language=n,this.modal=l,this.dockedComposer=a,this.ViewContainerRef=o,this.backend=d,this.session=c,this.formFields=[],this.formFieldSet="",this.headerFieldSet=""}get canSend(){let t=this.model.getField("recipient_addresses");return!!t&&t.some((t=>"to"==t.address_type))}ngOnInit(){this.model.module="Emails",this.setEditMode(),this.subscribeParent(),this.getFieldsetFields()}initializeEmail(){this.model.id=this.model.generateGuid(),this.model.initializeModel(),this.model.startEdit(),this.model.setFields({parent_type:this.activitiytimeline.parent.module,parent_id:this.activitiytimeline.parent.id,parent_name:this.activitiytimeline.parent.getField("summary_text"),type:"out",status:"created",recipient_addresses:[],from_addr_name:this.session.authData.email})}onHeaderClick(){this.isExpanded||(this.isExpanded=!0,this.initializeEmail(),this.model.startEdit(!1))}subscribeParent(){this.activitiytimeline.parent.data$.subscribe((t=>{0==this.model.getField("recipient_addresses")?.length&&this.determineRecipientAddress(),t.id==this.model.getField("parent_id")&&this.model.setField("parent_name",t.summary_text)}))}setEditMode(){this.view.isEditable=!0,this.view.setEditMode()}getFieldsetFields(){let t=this.metadata.getComponentConfig("ActivityTimelineAddEmail",this.model.module);this.formFieldSet=t.fieldset,this.headerFieldSet=t.headerfieldset,this.formFields=this.metadata.getFieldSetItems(t.fieldset)}onFocus(){this.isExpanded||(this.isExpanded=!0,this.initializeEmail(),this.determineRecipientAddress(),this.setEditMode())}determineRecipientAddress(){this.activitiytimeline.parent.getField("email1")&&this.model.setField("recipient_addresses",[{parent_type:this.activitiytimeline.parent.module,parent_id:this.activitiytimeline.parent.id,email_address:this.activitiytimeline.parent.getField("email1"),id:this.model.generateGuid(),address_type:"to"}])}send(){this.canSend&&(this.model.getField("name")||this.model.getField("body")?this.save():this.modal.prompt("confirm",this.language.getLabel("LBL_EMAIL_SEND_EMPTY",null,"long"),this.language.getLabel("LBL_EMAIL_SEND_EMPTY")).subscribe((t=>{t&&this.save()})))}save(){this.model.setField("to_be_sent",!0),this.model.save().subscribe((()=>{this.isExpanded=!1,this.model.setField("to_be_sent",!1),this.initializeEmail(),this.determineRecipientAddress(),this.model.endEdit()}))}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineAddEmail)(r.rXU(k.yu),r.rXU(be.k),r.rXU(h.g),r.rXU(y.U),r.rXU(f.B),r.rXU(P.y),r.rXU(Hi.n),r.rXU(r.c1b),r.rXU(me.H),r.rXU(re.d))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineAddEmail,selectors:[["activitytimeline-add-email"]],features:[r.Jv_([h.g,y.U]),r.Vt3],decls:4,vars:3,consts:[[1,"slds-p-around--xx-small",3,"system-overlay-loading-spinner"],[3,"click"],[3,"fieldset"],[4,"ngIf"],[3,"fieldset","direction"],["component","SpiceAttachmentsPanel"],[1,"slds-p-vertical--x-small","slds-grid"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"title","click"],["icon","close"],[1,"slds-assistive-text"],["label","LBL_CANCEL"],["icon","expand"],["label","LBL_EXPAND"],["icon","dock_panel"],["label","LBL_DOCK"],[1,"slds-col--bump-left","slds-grid","slds-grid--vertical-align-center"],["side","right"],[1,"slds-button","slds-button--brand",".slds-button-space-left","slds-float--right",3,"disabled","click"],["label","LBL_SEND"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"div",1),r.bIt("click",(function(){return e.onHeaderClick()})),r.nrm(2,"object-record-fieldset",2),r.k0s(),r.DNE(3,ss,21,6,"ng-container",3),r.k0s()),2&t&&(r.Y8G("system-overlay-loading-spinner",e.model.isSaving),r.R7$(2),r.Y8G("fieldset",e.headerFieldSet),r.R7$(),r.Y8G("ngIf",e.isExpanded))},dependencies:[s.bT,Ei.D,qi.o,H.t,Ve.s,L.W,is.M],encapsulation:2})}return ActivityTimelineAddEmail})();const ls=["detailContainer"];let as=(()=>{class ActivityTimelineSummaryItemView{constructor(t,e,i,s,n,l){this.metadata=t,this.parent=e,this.model=i,this.language=s,this.activitiytimeline=n,this.activatedRoute=l,this.componentRefs=[]}ngOnChanges(){this.model.module=this.module,this.model.id=this.id,this.model.setData(this.data,!1);for(let t of this.componentRefs)t.destroy();let t=this.metadata.getComponentConfig("ActivityTimelineSummary",this.module);if(t&&t.componentsets)for(let e of t.componentsets)for(let t of this.metadata.getComponentSetObjects(e))this.metadata.addComponent(t.component,this.detailContainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineSummaryItemView)(r.rXU(k.yu),r.rXU(h.g),r.rXU(h.g),r.rXU(f.B),r.rXU(be.k),r.rXU(et.nX))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSummaryItemView,selectors:[["activity-timeline-summary-item-view"]],viewQuery:function(t,e){if(1&t&&r.GBs(ls,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.detailContainer=t.first)}},inputs:{module:"module",id:"id",data:"data"},features:[r.Jv_([h.g]),r.OA$],decls:14,vars:3,consts:[[1,"slds-border_bottom","slds-p-around--medium","slds-theme--shade"],[1,"slds-grid"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-text-title--caps","slds-line-height--reset"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[1,"slds-p-around--xx-small"],["detailContainer",""]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),r.nrm(4,"system-icon",4),r.j41(5,"div",5)(6,"p",6),r.nrm(7,"system-label-modulename",4),r.k0s(),r.j41(8,"div")(9,"h1",7),r.EFF(10),r.k0s()()()()()()(),r.j41(11,"div",8),r.nrm(12,"div",null,9),r.k0s()),2&t&&(r.R7$(4),r.Y8G("module",e.model.module),r.R7$(3),r.Y8G("module",e.model.module),r.R7$(3),r.SpI(" ",e.model.data.name,""))},dependencies:[Vt.J,te.r],encapsulation:2})}return ActivityTimelineSummaryItemView})();function os(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",3),r.bIt("click",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.toggleModuleFilter(e.module))})),r.j41(1,"div",4),r.nrm(2,"system-icon",5),r.k0s(),r.j41(3,"div",4),r.EFF(4),r.k0s(),r.j41(5,"div"),r.nrm(6,"system-label-modulename",6),r.k0s()()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("ngStyle",i.getElementStyle(t.module)),r.R7$(2),r.Y8G("title",i.language.getModuleName(t.module))("module",t.module),r.R7$(2),r.SpI(" ",t.count," "),r.R7$(2),r.Y8G("module",t.module)("singular",1==t.count)}}function ds(t,e){if(1&t&&(r.j41(0,"li",7)(1,"div",4),r.EFF(2),r.k0s(),r.j41(3,"div"),r.EFF(4),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.SpI(" ",t.year,": "),r.R7$(2),r.SpI(" ",t.count," ")}}let cs=(()=>{class ActivityTimelineSummaryAggregates extends Me{static#t=this.ɵfac=(()=>{let t;return function(e){return(t||(t=r.xGo(ActivityTimelineSummaryAggregates)))(e||ActivityTimelineSummaryAggregates)}})();static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSummaryAggregates,selectors:[["activity-timeline-summary-aggregates"]],features:[r.Vt3],decls:3,vars:2,consts:[[1,"slds-list_horizontal","slds-has-dividers_right"],["class","slds-item slds-grid slds-grid--vertical-align-center",3,"ngStyle","click",4,"ngFor","ngForOf"],["class","slds-item slds-grid slds-grid--vertical-align-center",4,"ngFor","ngForOf"],[1,"slds-item","slds-grid","slds-grid--vertical-align-center",3,"ngStyle","click"],[1,"slds-p-right--xxx-small"],["size","xx-small","divClass","slds-align--absolute-center",3,"title","module"],[3,"module","singular"],[1,"slds-item","slds-grid","slds-grid--vertical-align-center"]],template:function(t,e){1&t&&(r.j41(0,"ul",0),r.DNE(1,os,7,6,"li",1)(2,ds,5,2,"li",2),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngForOf",e.moduleaggregates),r.R7$(),r.Y8G("ngForOf",e.yearaggregates))},dependencies:[s.Sq,s.B3,Vt.J,te.r],encapsulation:2})}return ActivityTimelineSummaryAggregates})();const rs=["listContainer"];function ms(t,e){if(1&t){const t=r.RV6();r.j41(0,"system-input-delayed",24),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.searchterm,e)||(i.searchterm=e),r.Njj(e)})),r.k0s()}if(2&t){const t=r.XpG();r.R50("ngModel",t.searchterm)}}const us=t=>({"slds-theme--default slds-border--bottom slds-border--top":t});function hs(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",25),r.bIt("click",(function(){const e=r.eBV(t).$implicit,i=r.XpG();return r.Njj(i.setActivitiy(e))})),r.nrm(1,"activitytimeline-item-container",26),r.k0s()}if(2&t){const t=e.$implicit,i=r.XpG();r.Y8G("ngClass",r.eq3(2,us,t.id==i.activityid)),r.R7$(),r.Y8G("activity",t)}}function ps(t,e){1&t&&(r.j41(0,"ul",27)(1,"li",28),r.nrm(2,"activitytimeline-stencil"),r.k0s(),r.j41(3,"li",29),r.nrm(4,"activitytimeline-stencil"),r.k0s(),r.j41(5,"li",30),r.nrm(6,"activitytimeline-stencil"),r.k0s(),r.j41(7,"li",31),r.nrm(8,"activitytimeline-stencil"),r.k0s(),r.j41(9,"li",32),r.nrm(10,"activitytimeline-stencil"),r.k0s()())}function gs(t,e){if(1&t&&r.nrm(0,"activity-timeline-summary-item-view",35),2&t){const t=r.XpG(2);r.Y8G("module",t.activitymodule)("id",t.activityid)("data",t.activitydata)}}function fs(t,e){if(1&t&&(r.j41(0,"div",33),r.DNE(1,gs,1,3,"activity-timeline-summary-item-view",34),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngIf",t.activitymodule)}}const vs=t=>({"slds-hide":t});let bs=(()=>{class ActivityTimelineSummary{constructor(t,e,i,s,n,l){this.metadata=t,this.parent=e,this.language=i,this.activitiytimeline=s,this.navigationtab=n,this.layout=l,this.componentconfig=this.metadata.getComponentConfig("ActivityTimelineSummary"),this.componentconfig.usefts&&(this.activitiytimeline.usefts=!0),this.subscription=this.activitiytimeline.loading$.subscribe((t=>this.clearActivitiy()))}ngOnInit(){this.initialize(this.navigationtab.activeRoute.params)}ngOnDestroy(){this.subscription.unsubscribe()}get activities(){return this.activitiytimeline.activities.History.list}get displayDetailsPane(){return"small"!=this.layout.screenwidth}get searchterm(){return this.activitiytimeline.filters.searchterm}set searchterm(t){this.activitiytimeline.filters.searchterm=t,this.activitiytimeline.reload()}reload(){this.activitiytimeline.reload()}initialize(t){this.parent.module=t.module,this.parent.id=t.id,this.parent.getData(!0,"",!0).subscribe((t=>{this.navigationtab.setTabInfo({displayname:this.parent.getField("summary_text")+" • "+this.language.getModuleName("History"),displaymodule:"History"})})),this.activitiytimeline.parent=this.parent,this.activitiytimeline.defaultLimit=25,this.activitiytimeline.modules=["History"],this.activitiytimeline.reload()}onScroll(t){let e=this.listContainer.element.nativeElement;e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.activitiytimeline.canLoadMore("History")&&this.activitiytimeline.getMoreTimeLineData("History",20)}setActivitiy(t){this.activitymodule=t.module,this.activityid=t.id,this.activitydata=t.data}clearActivitiy(){this.activitymodule="",this.activityid="",this.activitydata=""}goModel(){this.parent.goDetail()}goModule(){this.parent.goModule()}static#t=this.ɵfac=function(t){return new(t||ActivityTimelineSummary)(r.rXU(k.yu),r.rXU(h.g),r.rXU(f.B),r.rXU(be.k),r.rXU(ke._),r.rXU(ye.Z))};static#e=this.ɵcmp=r.VBU({type:ActivityTimelineSummary,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&r.GBs(rs,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.listContainer=t.first)}},features:[r.Jv_([be.k,h.g])],decls:31,vars:10,consts:[[1,"slds-page-header","slds-grid","slds-grid--align-spread"],[1,"slds-col"],["role","navigation","aria-label","Breadcrumbs"],[1,"slds-breadcrumb","slds-list_horizontal","slds-wrap"],[1,"slds-breadcrumb__item","slds-text-title_caps"],["href","javascript:void(0);",3,"click"],[3,"module"],[1,"slds-p-horizontal--x-small"],[1,"slds-col","slds-align-bottom","slds-p-top--xxx-small"],["module","History"],[1,"slds-page-header__col-actions","slds-grid"],["delay","1000",3,"ngModel","ngModelChange",4,"ngIf"],[1,"slds-page-header__controls"],[1,"slds-page-header__control"],[1,"slds-align--absolute-center","slds-button","slds-button--icon","slds-button--icon-border-filled"],[1,"slds-button","slds-button--icon","slds-button--icon-border-filled"],["icon","refresh",3,"click"],[1,"slds-grid"],["system-to-bottom","",1,"slds-size--1-of-1","slds-medium-size--1-of-3","slds-border--right","slds-scrollable",3,"scroll"],["listContainer",""],[1,"slds-timeline",3,"ngClass"],["class","slds-p-around--x-small",3,"ngClass","click",4,"ngFor","ngForOf"],["class","slds-timeline",4,"ngIf"],["class","slds-size--2-of-3","system-to-bottom","",4,"ngIf"],["delay","1000",3,"ngModel","ngModelChange"],[1,"slds-p-around--x-small",3,"ngClass","click"],[3,"activity"],[1,"slds-timeline"],[1,"slds-p-around--x-small"],[1,"slds-p-around--x-small",2,"opacity","0.8"],[1,"slds-p-around--x-small",2,"opacity","0.6"],[1,"slds-p-around--x-small",2,"opacity","0.4"],[1,"slds-p-around--x-small",2,"opacity","0.2"],["system-to-bottom","",1,"slds-size--2-of-3"],[3,"module","id","data",4,"ngIf"],[3,"module","id","data"]],template:function(t,e){1&t&&(r.j41(0,"div",0)(1,"div",1)(2,"nav",2)(3,"ol",3)(4,"li",4)(5,"a",5),r.bIt("click",(function(){return e.goModule()})),r.nrm(6,"system-label-modulename",6),r.k0s()(),r.j41(7,"li",4)(8,"a",5),r.bIt("click",(function(){return e.goModel()})),r.EFF(9),r.k0s()(),r.j41(10,"li",4)(11,"span",7),r.nrm(12,"system-label-modulename",6),r.k0s()()()(),r.j41(13,"div",8),r.nrm(14,"activity-timeline-summary-aggregates",9),r.k0s()(),r.j41(15,"div",10),r.DNE(16,ms,1,1,"system-input-delayed",11),r.j41(17,"div",12)(18,"div",13),r.nrm(19,"activity-timeline-filter",14),r.k0s()(),r.j41(20,"div",12)(21,"div",13)(22,"button",15)(23,"system-button-icon",16),r.bIt("click",(function(){return e.reload()})),r.k0s()()()()()(),r.j41(24,"div",17)(25,"div",18,19),r.bIt("scroll",(function(t){return e.onScroll(t)})),r.j41(27,"ul",20),r.DNE(28,hs,2,4,"li",21),r.k0s(),r.DNE(29,ps,11,0,"ul",22),r.k0s(),r.DNE(30,fs,2,1,"div",23),r.k0s()),2&t&&(r.R7$(6),r.Y8G("module",e.parent.module),r.R7$(3),r.JRh(e.parent.data.summary_text),r.R7$(3),r.Y8G("module","History"),r.R7$(4),r.Y8G("ngIf",e.componentconfig.usefts),r.R7$(11),r.Y8G("ngClass",r.eq3(8,vs,e.activitiytimeline.activities.History.loading)),r.R7$(),r.Y8G("ngForOf",e.activities),r.R7$(),r.Y8G("ngIf",e.activitiytimeline.activities.History.loading),r.R7$(),r.Y8G("ngIf",e.displayDetailsPane))},dependencies:[s.YU,s.Sq,s.bT,n.BC,n.vS,H.t,_e._,te.r,b.b,Xe,Se.t,Te.v,as,cs],encapsulation:2})}return ActivityTimelineSummary})();var ys=i(26024),ks=i(64029);function _s(t,e){if(1&t&&r.nrm(0,"field-label",3),2&t){const t=r.XpG();r.Y8G("fieldname",t.fieldname)("fieldconfig",t.fieldconfig)}}function js(t,e){if(1&t&&(r.j41(0,"field-generic-display",4),r.EFF(1),r.k0s()),2&t){const t=r.XpG();r.Y8G("fielddisplayclass",t.fielddisplayclass)("editable",t.isEditable())("fieldconfig",t.fieldconfig),r.R7$(),r.SpI(" ",t.cachedValue.formatted,"\n")}}function xs(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",5)(1,"div",6)(2,"system-input-date",7),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.value,e)||(i.value=e),r.Njj(e)})),r.k0s(),r.j41(3,"system-input-time",8),r.mxI("ngModelChange",(function(e){r.eBV(t);const i=r.XpG();return r.DH7(i.value,e)||(i.value=e),r.Njj(e)})),r.k0s()(),r.nrm(4,"field-messages",9),r.k0s()}if(2&t){const t=r.XpG();r.Y8G("ngClass",t.css_classes),r.R7$(2),r.R50("ngModel",t.value),r.R7$(),r.R50("ngModel",t.value),r.R7$(),r.Y8G("fieldname",t.fieldname)}}let Rs=(()=>{class fieldActivityDate extends Rt.s{constructor(t,e,i,s,n,l,a,o,d,c){super(t,e,s,n,l),this.model=t,this.view=e,this.broadcast=i,this.language=s,this.metadata=n,this.router=l,this.elementRef=a,this.renderer=o,this.modal=d,this.userpreferences=c,this.subscribeToDataChange()}ngOnInit(){super.ngOnInit(),this.setFormattedValue()}subscribeToDataChange(){this.subscriptions.add(this.model.data$.subscribe((t=>{t[this.fieldname]&&!moment(this.cachedValue?.raw).isSame(t[this.fieldname])&&this.setFormattedValue()})))}setFormattedValue(){if(!this.value)return;this.cachedValue={raw:this.value};const t=new moment(this.value),e=moment(t.format("YYYY M D")).isSame((new moment).format("YYYY M D")),i=t.isSame(new moment,"year");this.cachedValue.formatted=e?t.format(this.userpreferences.getTimeFormat()):i?t.format("MMM D"):t.format(this.userpreferences.getDateFormat())}static#t=this.ɵfac=function(t){return new(t||fieldActivityDate)(r.rXU(h.g),r.rXU(y.U),r.rXU(m.m),r.rXU(f.B),r.rXU(k.yu),r.rXU(et.Ix),r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(P.y),r.rXU(Lt.S))};static#e=this.ɵcmp=r.VBU({type:fieldActivityDate,selectors:[["field-activity-date"]],features:[r.Vt3],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element__control slds-p-around--xx-small",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[1,"slds-form-element__control","slds-p-around--xx-small",3,"ngClass"],[1,"slds-grid"],[1,"slds-size--1-of-2","slds-p-right--xxx-small",3,"ngModel","ngModelChange"],[1,"slds-size--1-of-2","slds-p-left--xxx-small",3,"ngModel","ngModelChange"],[3,"fieldname"]],template:function(t,e){1&t&&r.DNE(0,_s,1,2,"field-label",0)(1,js,2,4,"field-generic-display",1)(2,xs,5,4,"div",2),2&t&&(r.Y8G("ngIf",e.displayLabel),r.R7$(),r.Y8G("ngIf",!e.isEditMode()),r.R7$(),r.Y8G("ngIf",e.isEditable()&&e.isEditMode()))},dependencies:[s.YU,s.bT,n.BC,n.vS,Gt.b,At.K,Ut.A,ys.M,ks.T],encapsulation:2})}return fieldActivityDate})(),Gs=(()=>{class ModuleActivities{static#t=this.ɵfac=function(t){return new(t||ModuleActivities)};static#e=this.ɵmod=r.$C({type:ModuleActivities});static#i=this.ɵinj=r.G2t({imports:[s.MD,n.YN,l.ObjectFields,a.GlobalComponents,o.ObjectComponents,d.SystemComponents,c.h,ai]})}return ModuleActivities})();("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(Gs,{declarations:[$,T,I,F,O,V,W,Q,rt,ht,bt,gt,xt,kt,Tt,ce,Yt,Kt,Ot,Jt,he,pe,ve,vi,Ii,Ae,Xe,Oe,Se.t,Pi,Te.v,si,es,ns,bs,Me,as,ni,cs,ci,Rs],imports:[s.MD,n.YN,l.ObjectFields,a.GlobalComponents,o.ObjectComponents,d.SystemComponents,c.h,ai],exports:[Se.t,Te.v]})},95757:(t,e,i)=>{i.d(e,{k:()=>h});var s=i(54438),n=i(84412),l=i(7673),a=i(21413),o=i(83935),d=i(49722),c=i(92462),r=i(53584),m=i(29994),u=i(40553);let h=(()=>{class activitiytimeline{constructor(t,e,i,l,a,o){this.metadata=t,this.backend=e,this.modelutilities=i,this.configurationService=l,this.session=a,this.broadcast=o,this.httpRequestsRefID=_.uniqueId("activity_timeline_http_ref_"),this.serviceSubscriptions=[],this.filters={searchterm:"",objectfilters:[],own:""},this.loading$=new s.bkB,this.defaultLimit=5,this.modules=["Activities","History"],this.activeStates=["Planned","In Progress","Not Started","Pending Input"],this.activityObjects=["Tasks","Meetings","Calls","Notes","Emails"],this.sortDates={Calls:"date_start",Meetings:"date_start",Tasks:"date_due",Emails:"date_entered",Notes:"date_entered"},this.activities={Activities:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]},History:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]}},this.usefts=!1,this._openness=!1,this.serviceSubscriptions.push(this.broadcast.message$.subscribe((t=>this.handleMessage(t)))),this.openness$=new n.t(this._openness)}get openness(){return this._openness}set openness(t){this._openness=t,this.openness$.next(t)}get filterObjects(){if(this.usefts){let t=[];for(let e in this.activities)t=t.concat(this.getAggregateObjects(e));return _.uniq(t)}return this.activityObjects}getAggregateObjects(t){try{let e=[];for(let i of this.activities[t].aggregates.module)e.push(i.module);return e}catch(t){return[]}}stopSubscriptions(){for(let t of this.serviceSubscriptions)t.unsubscribe();this.backend.cancelPendingRequests([this.httpRequestsRefID])}handleMessage(t){let e=t.messagetype.split(".");if("model"===e[0])switch(e[1]){case"merge":this.parent&&t.messagedata.module==this.parent.module&&t.messagedata.id==this.parent.id&&(this.getTimeLineData("Activities",!0),this.getTimeLineData("History",!0));break;case"save":this.metadata.getModuleDefs(t.messagedata.module).ftsactivities.Activities&&this.getTimeLineData("Activities",!0),this.metadata.getModuleDefs(t.messagedata.module).ftsactivities.History&&this.getTimeLineData("History",!0);break;case"delete":for(let e of this.modules){let i=this.activities[e].list.findIndex((e=>e.module==t.messagedata.module&&e.id==t.messagedata.id));i>=0&&this.activities[e].list.splice(i,1)}}}checkModuleActive(t){return 0==this.filters.objectfilters.length||this.filters.objectfilters.indexOf(t)>=0}toggleModuleFilter(t){0==this.filters.objectfilters.length?(this.filters.objectfilters=this.filterObjects,this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(t),1)):this.filters.objectfilters.indexOf(t)>=0?this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(t),1):(this.filters.objectfilters.push(t),this.filters.objectfilters.length==this.filterObjects.length&&(this.filters.objectfilters=[]))}reload(t=!1){this.loading$.emit(!0);for(let e of this.modules)this.getTimeLineData(e,t)}getTimeLineData(t,e=!1){e||(this.activities[t].loading=!0);let i={count:!0,limit:this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};this.backend.postRequest("module/"+t+"/fts/"+this.parent.module+"/"+this.parent.id,{},i,this.httpRequestsRefID).subscribe({next:e=>{if(e){this.resetListData(t);for(let t of e.items)t.data=this.modelutilities.backendModel2spice(t.module,t.data);this.activities[t].list=e.items,this.activities[t].totalcount=parseInt(e.totalcount,10),this.activities[t].aggregates=e.aggregates?e.aggregates:[]}this.activities[t].loading=!1},error:e=>{this.activities[t].loading=!1}})}getMoreTimeLineData(t,e){if(!this.canLoadMore(t)||this.activities[t].loading)return(0,l.of)(!0);let i=new a.B,s={start:this.activities[t].list.length,limit:e||this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};return this.activities[t].loadingmore=!0,this.backend.postRequest("module/"+t+"/fts/"+this.parent.module+"/"+this.parent.id,{},s,this.httpRequestsRefID).subscribe({next:e=>{for(let i of e.items)i.data=this.modelutilities.backendModel2spice(i.module,i.data),this.activities[t].list.push(i);this.activities[t].loadingmore=!1,i.next(!0),i.complete()},error:e=>{this.activities[t].loadingmore=!1,i.error(e),i.complete()}}),i.asObservable()}resetListData(t){this.activities[t]={loading:!1,loadingmore:!1,list:[],totalcount:0}}canLoadMore(t){return this.activities[t].totalcount>this.activities[t].list.length&&!this.activities[t].loadingmore}sortListdata(t){this.activities[t].list.sort(((e,i)=>{let s=new moment(e.data[this.sortDates[e.module]]),n=new moment(i.data[this.sortDates[i.module]]);return"Activities"!==t?s.isBefore(n):s.isAfter(n)}))}static#t=this.ɵfac=function(t){return new(t||activitiytimeline)(s.KVO(o.yu),s.KVO(d.H),s.KVO(c.g),s.KVO(r.i),s.KVO(m.d),s.KVO(u.m))};static#e=this.ɵprov=s.jDH({token:activitiytimeline,factory:activitiytimeline.ɵfac})}return activitiytimeline})()}}]);