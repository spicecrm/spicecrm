/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-15 08:39:15
 *
 *                     build: 2023.02.001.1692081555935
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_spicemap_spicemap_ts"],{3106:(e,t,s)=>{s.r(t),s.d(t,{ModuleSpiceMap:()=>Ee});var i=s(1180),o=s(4755),n=s(5030),r=s(4357),l=s(3190),a=s(4826),d=s(6490),c=s(3735),h=s(2242),g=s(5329),p=s(5710),u=s(6163),m=s(4505),f=s(3348),M=s(4154),v=s(2067),C=s(423),b=s(3463),Z=s(7674);const x=["mapelement"];function L(e,t){if(1&e&&(h.TgZ(0,"th",18)(1,"a",19)(2,"span",20),h._UZ(3,"system-label-fieldname",21),h.qZA()()()),2&e){const e=t.$implicit,s=h.oxw();h.xp6(3),h.Q6J("module",s.model.module)("field",e.field)("fieldconfig",e.fieldconfig)}}function y(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"tr",22),h.NdJ("mouseenter",(function(){const t=h.CHM(e).$implicit,s=h.oxw();return h.KtG(s.mouseOver(t.id))}))("mouseleave",(function(){const t=h.CHM(e).$implicit,s=h.oxw();return h.KtG(s.mouseOut(t.id))})),h.qZA()}if(2&e){const e=t.$implicit,s=h.oxw();h.Q6J("module",s.model.module)("listfields",s.getListFields())("listitem",e)}}let w=(()=>{var e;class SpiceMap{constructor(e,t,s,o,n,r,l,a){(0,i.Z)(this,"zone",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modelutilities",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"router",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"libloader",void 0),(0,i.Z)(this,"mapelement",void 0),(0,i.Z)(this,"componentconfig",{}),(0,i.Z)(this,"map",{}),(0,i.Z)(this,"circle",{}),(0,i.Z)(this,"mousedown",!1),(0,i.Z)(this,"mapBoundaries",{}),(0,i.Z)(this,"modelMarker",{}),(0,i.Z)(this,"surroundingFunction",{}),(0,i.Z)(this,"surroundingMarkers",[]),(0,i.Z)(this,"surroundingObjects",[]),(0,i.Z)(this,"listfields",[]),this.zone=e,this.language=t,this.model=s,this.modelutilities=o,this.backend=n,this.router=r,this.metadata=l,this.libloader=a}getListFields(){return this.metadata.getFieldSetFields(this.componentconfig.fieldset)}ngAfterViewInit(){this.libloader.loadLib("maps.googleapis").subscribe((e=>{this.renderMap()}))}get latField(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_latitude":"address_latitude"}get lngField(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_longitude":"address_longitude"}get lat(){return this.model.getField(this.latField)}get lng(){return this.model.getField(this.lngField)}renderMap(){let e={lat:48.2,lng:16.3};this.lng&&this.lat&&(e={lat:this.lat,lng:this.lng}),this.map=new google.maps.Map(this.mapelement.element.nativeElement,{center:e,scrollwheel:!0,zoom:14,minZoom:8}),this.lng&&this.lat&&(this.modelMarker=new google.maps.Marker({position:e,map:this.map,icon:"https://maps.google.com/mapfiles/ms/micons/red-dot.png",title:this.model.getField("summary_text")})),this.map.addListener("bounds_changed",(()=>{this.mapBoundaries=this.map.getBounds(),this.surroundingFunction&&window.clearTimeout(this.surroundingFunction),this.surroundingFunction=window.setTimeout((()=>this.getSurrounding()),500)}))}reCenter(){this.map.setCenter(this.modelMarker.position)}isApiLoaded(){return window.google&&window.google.maps}getSurrounding(){for(let e of this.surroundingMarkers)e.setMap(null);this.surroundingMarkers=[];let e=this.mapBoundaries.getNorthEast(),t=this.mapBoundaries.getSouthWest(),s={join:"AND",conditions:[{field:"id",operator:"<>",value:this.model.id},{field:this.lngField,operator:"<",value:e.lng()},{field:this.latField,operator:"<",value:e.lat()},{field:this.lngField,operator:">",value:t.lng()},{field:this.latField,operator:">",value:t.lat()}]},i={searchfields:JSON.stringify(s),fields:JSON.stringify(["id","name",this.lngField,this.latField])};this.backend.getRequest("module/"+this.model.module,i).subscribe((e=>{for(let t in e.list){for(let s in e.list[t])e.list[t][s]=this.modelutilities.backend2spice(this.model.module,s,e.list[t][s]);let s=new google.maps.Marker({position:{lat:e.list[t][this.latField],lng:e.list[t][this.lngField]},map:this.map,title:e.list[t].summary_text,icon:"http://maps.google.com/mapfiles/ms/micons/green.png",sugarId:e.list[t].id,sugarModule:this.model.module});this.surroundingMarkers.push(s)}this.surroundingObjects=e.list,this.zone.run((()=>{}))}))}mouseOver(e){this.surroundingMarkers.some((t=>{if(t.sugarId===e)return t.setIcon("http://maps.google.com/mapfiles/ms/micons/yellow-dot.png"),!0}))}mouseOut(e){this.surroundingMarkers.some((t=>{if(t.sugarId===e)return t.setIcon("http://maps.google.com/mapfiles/ms/micons/green.png"),!0}))}}return e=SpiceMap,(0,i.Z)(SpiceMap,"ɵfac",(function(t){return new(t||e)(h.Y36(h.R0b),h.Y36(g.d),h.Y36(p.o),h.Y36(u.A),h.Y36(m.y),h.Y36(f.F0),h.Y36(M.Pu),h.Y36(v.$))})),(0,i.Z)(SpiceMap,"ɵcmp",h.Xpm({type:e,selectors:[["spice-map"]],viewQuery:function(e,t){if(1&e&&h.Gf(x,7,h.s_b),2&e){let e;h.iGM(e=h.CRH())&&(t.mapelement=e.first)}},decls:22,vars:3,consts:[[1,"slds-card","slds-card_boundary","slds-m-bottom--medium"],[1,"slds-card__header","slds-grid"],[1,"slds-media","slds-media--center","slds-has-flexi-truncate"],[1,"slds-media__body","slds-truncate"],[1,"slds-text-heading--small"],["label","LBL_MAP_VIEW"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_RECENTER"],[1,"slds-card__body","slds-p-horizontal--small"],[2,"width","100%","height","400px","border-radius","4px","overflow","hidden"],["mapelement",""],[1,"slds-p-top--small"],[1,"slds-table","slds-table--bordered","slds-table--fixed-layout"],[1,"slds-text-title--caps"],["class","slds-is-sortable","scope","col",4,"ngFor","ngForOf"],["scope","col",1,"slds-cell-shrink"],["object-related-list-item","","class","slds-hint-parent",3,"module","listfields","listitem","mouseenter","mouseleave",4,"ngFor","ngForOf"],["scope","col",1,"slds-is-sortable"],["href","javascript:void(0);",1,"slds-th__action","slds-text-link--reset"],[1,"slds-truncate"],[3,"module","field","fieldconfig"],["object-related-list-item","",1,"slds-hint-parent",3,"module","listfields","listitem","mouseenter","mouseleave"]],template:function(e,t){1&e&&(h.TgZ(0,"article",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"h2")(5,"span",4),h._UZ(6,"system-label",5),h._uU(7),h.qZA()()()(),h.TgZ(8,"div",6)(9,"button",7),h.NdJ("click",(function(){return t.reCenter()})),h._UZ(10,"system-label",8),h.qZA()()(),h.TgZ(11,"div",9),h._UZ(12,"div",10,11),h.TgZ(14,"div",12)(15,"table",13)(16,"thead")(17,"tr",14),h.YNc(18,L,4,3,"th",15),h._UZ(19,"th",16),h.qZA()(),h.TgZ(20,"tbody"),h.YNc(21,y,1,3,"tr",17),h.qZA()()()()()),2&e&&(h.xp6(7),h.hij(" (",t.surroundingObjects.length,")"),h.xp6(11),h.Q6J("ngForOf",t.getListFields()),h.xp6(3),h.Q6J("ngForOf",t.surroundingObjects))},dependencies:[o.sg,C.X,b._,Z.h],encapsulation:2})),SpiceMap})();var R=s(727),O=s(2644),k=s(7102),T=s(4822),S=s(2348),F=s(2656),A=s(7514),I=s(3333),N=s(8859);function G(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"system-checkbox",8),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw();return h.KtG(s.relateFilterActive=t)})),h._UZ(1,"system-label",9)(2,"system-label-modulename",10),h._uU(3),h.qZA()}if(2&e){const e=h.oxw();h.Q6J("disabled",e.relateFilter.required)("ngModel",e.relateFilterActive),h.xp6(2),h.Q6J("module",e.relateFilter.module)("singular",!0),h.xp6(1),h.hij(" ",e.relateFilter.display," ")}}let D=(()=>{var e;class SpiceGoogleMapsListHeader{constructor(e,t,s,o){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"modellist",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"element",void 0),(0,i.Z)(this,"searchTerm",""),(0,i.Z)(this,"searchTermOld",""),(0,i.Z)(this,"searchTimeOut",void 0),(0,i.Z)(this,"subscriptions",new R.w0),(0,i.Z)(this,"usedSearchTerm",new h.vpe),this.language=e,this.modellist=t,this.metadata=s,this.element=o}get requestfields(){let e=[];for(let t of this.modellist.listfields)-1!=e.indexOf(t.field)&&e.push(t.field);return e}get relateFilter(){return this.modellist.relatefilter}get relateFilterActive(){return this.relateFilter?.active}set relateFilterActive(e){this.relateFilter.active=e,this.modellist.relatefilter.active=e,this.modellist.reLoadList()}ngOnInit(){this.searchTerm=this.modellist.searchTerm,this.searchTermOld=this.modellist.searchTerm}ngOnDestroy(){this.subscriptions.unsubscribe()}doSearch(){this.searchTermOld=this.searchTerm,this.modellist.searchTerm=this.searchTerm,this.modellist.getListData()}triggerSearch(e){if(this.searchTerm!==this.searchTermOld)if("Enter"===e.key)this.searchTerm.length>0&&(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.doSearch());else this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.doSearch()),1e3)}}return e=SpiceGoogleMapsListHeader,(0,i.Z)(SpiceGoogleMapsListHeader,"ɵfac",(function(t){return new(t||e)(h.Y36(g.d),h.Y36(O.t),h.Y36(M.Pu),h.Y36(h.SBq))})),(0,i.Z)(SpiceGoogleMapsListHeader,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps-list-header"]],outputs:{usedSearchTerm:"usedSearchTerm"},decls:11,vars:3,consts:[[1,"slds-form-element","slds-p-top--medium","slds-p-horizontal--medium","slds-m-bottom--small","slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["icon","search","size","x-small","addclasses","slds-input__icon"],["type","text","id","lookup","autocomplete","search-term",1,"slds-input",3,"ngModel","placeholder","ngModelChange","keyup"],[1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-horizontal--xxx-small",3,"click"],["icon","refresh"],[1,"slds-theme--shade","slds-p-around--x-small","slds-border--top","slds-grid","slds-grid--vertical-align-center","slds","slds-grid--align-spread"],[3,"disabled","ngModel","ngModelChange",4,"ngIf"],[3,"disabled","ngModel","ngModelChange"],["label","LBL_RELATED_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(h.TgZ(0,"div",0),h._UZ(1,"object-list-types"),h.TgZ(2,"div",1),h._UZ(3,"system-utility-icon",2),h.TgZ(4,"input",3),h.NdJ("ngModelChange",(function(e){return t.searchTerm=e}))("keyup",(function(e){return t.triggerSearch(e)})),h.qZA()(),h.TgZ(5,"button",4),h.NdJ("click",(function(){return t.modellist.reLoadList()})),h._UZ(6,"system-button-icon",5),h.qZA(),h._UZ(7,"object-listview-aggregates-button"),h.qZA(),h.TgZ(8,"div",6),h._UZ(9,"object-listview-header-details"),h.YNc(10,G,4,5,"system-checkbox",7),h.qZA()),2&e&&(h.xp6(4),h.Q6J("ngModel",t.searchTerm)("placeholder",t.language.getModuleName(t.modellist.module)),h.xp6(6),h.Q6J("ngIf",t.relateFilter&&t.relateFilter.id))},dependencies:[o.O5,n.Fj,n.JJ,n.On,k.l,T.X,S.M,F.J,A.U,b._,I.M,N.r],encapsulation:2,changeDetection:0})),SpiceGoogleMapsListHeader})();var E=s(2032),J=s(3369),Y=s(7228),U=s(7954),q=s(7763),B=s(4021),z=s(151),Q=s(3917),P=s(3278);const H=["mapContainer"];let j=(()=>{var e;class SpiceGoogleMaps{constructor(e,t,s,o,n,r,l,a,d){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"libLoader",void 0),(0,i.Z)(this,"footer",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"renderer",void 0),(0,i.Z)(this,"zone",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"options",void 0),(0,i.Z)(this,"records",[]),(0,i.Z)(this,"focusedRecordId",void 0),(0,i.Z)(this,"routes",[]),(0,i.Z)(this,"radiusChange",new h.vpe),(0,i.Z)(this,"centerChange",new h.vpe),(0,i.Z)(this,"directionChange",new h.vpe),(0,i.Z)(this,"mapIdleChange",new h.vpe),(0,i.Z)(this,"fixedCircle",void 0),(0,i.Z)(this,"mapContainer",void 0),(0,i.Z)(this,"map",void 0),(0,i.Z)(this,"circle",void 0),(0,i.Z)(this,"popoverComponentRef",null),(0,i.Z)(this,"mapBounds",void 0),(0,i.Z)(this,"markers",[]),(0,i.Z)(this,"myLocationMarker",void 0),(0,i.Z)(this,"markerCluster",void 0),(0,i.Z)(this,"centerControlListener",void 0),(0,i.Z)(this,"directionsService",void 0),(0,i.Z)(this,"directionsRenderers",[]),(0,i.Z)(this,"focusedMarker",void 0),(0,i.Z)(this,"isMapIdled",!1),this.language=e,this.model=t,this.libLoader=s,this.footer=o,this.metadata=n,this.renderer=r,this.zone=l,this.injector=a,this.toast=d}ngOnChanges(e){this.isMapIdled&&this.zone.runOutsideAngular((()=>{e.records&&this.setMarkers(),e.focusedRecordId&&this.setFocusedMarker(),e.routes&&this.renderRoutes(),e.options&&this.handleOptionsChange()}))}ngAfterViewInit(){this.loadNecessaryLibraries()}ngOnDestroy(){google.maps.event.clearInstanceListeners(this.map),this.clearMarkers(),this.clearMyLocationMarker(),this.removeReCenterControlListener(),this.removeCircle(),this.removeFixedCircle(),this.closePopover(),this.clearFocusedMarker()}convertDistanceToString(e){if("IMPERIAL"==this.options.unitSystem){const t=3.2808*e;if(t>5280){return Math.pow(+(t/5280).toFixed(1),1)+" mile"}return Math.round(t)+" ft"}if(e>1e3){return Math.pow(+(e/1e3).toFixed(1),1)+" km"}return e+" m"}generateMarkerColor(e){return{path:"M 0,0 L -43.3,-75 A 50 50 1 1 1 43.30,-75 L 0,0 z",strokeColor:"#fff",strokeWeight:1,fillOpacity:1,scale:.25,anchor:{x:4.5,y:5},fillColor:0==e.indexOf("#")?e:"#"+e}}createCircle(e){if(!window.google)return;const t=e?"fixedCircle":"circle";this[t]&&this.removeCircle(t);let s=this.options[t].center;s&&this.verifyLatLng(s)||(s={lat:this.map.getCenter().lat(),lng:this.map.getCenter().lng()},this.reverseGeoCode(s),this.options[t].center=s),this[t]=new google.maps.Circle(this.generateCircleOptions(this.options[t],e)),e||(this.setCircleListeners(),this.map.setCenter(s))}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}generateCircleOptions(e,t){let s=1e3*(e.radius||5);const i=e.radiusPercentage||80;return e.radius||t||!this.map.getBounds()||!i||isNaN(i)||(s=this.setRadiusFromMapDimensions(i)),{strokeColor:e.color,fillOpacity:0,strokeWeight:2,clickable:!1,editable:e.editable,draggable:e.draggable,zIndex:1,map:this.map,center:e.center,radius:s}}setRadiusFromMapDimensions(e){const t=google.maps.geometry.spherical,s=this.map.getBounds().getNorthEast(),i=this.map.getBounds().getSouthWest(),o=new google.maps.LatLng(i.lat(),s.lng()),n=new google.maps.LatLng(s.lat(),i.lng()),r=t.computeDistanceBetween(s,n),l=t.computeDistanceBetween(s,o),a=(l<r?l:r)/2*(e/100);return this.zone.run((()=>this.radiusChange.emit(Math.round(a/100)/10))),a}setFocusedMarker(){this.clearFocusedMarker(),this.markers.some((e=>{if(e.id==this.focusedRecordId){const t=this.options.focusColor||"#1A73E8";return e.setIcon(this.generateMarkerColor(t)),this.markerCluster&&(this.markerCluster.removeMarker(e),e.setMap(this.map)),this.mapBounds=new google.maps.LatLngBounds,this.mapBounds.extend(e.position),this.fitMapBounds(),this.focusedMarker=e,!0}}))}clearFocusedMarker(){this.focusedMarker&&(this.markerCluster&&(this.markerCluster.removeMarker(this.focusedMarker),this.markerCluster.addMarker(this.focusedMarker)),this.focusedMarker.setIcon(this.focusedMarker.defaultColor?this.generateMarkerColor(this.focusedMarker.defaultColor):null),this.focusedMarker=void 0)}handleOptionsChange(){this.options.fixedCircle?this.options.changed.fixedCircle&&(this.clearRoutes(),this.createFixedCircle()):this.removeFixedCircle(),this.options.circle?this.options.changed.circle?(this.clearRoutes(),this.createCircle()):this.options.changed.circleRadius?this.circle.setRadius(1e3*this.options.circle.radius):this.options.changed.circleCenter?this.circle.setCenter(this.options.circle.center):this.options.changed.circleEditable&&(this.circle.setEditable(this.options.circle.editable),this.circle.setDraggable(this.options.circle.draggable)):this.removeCircle(),this.options.showCluster?this.options.changed.showCluster&&this.setMarkerCluster():this.removeMarkerClusterMarkers(),this.options.showMyLocation?this.options.changed.showMyLocation&&this.setCurrentLocationMarker():this.clearMyLocationMarker()}renderRoutes(){if(this.removeCircle(),this.removeFixedCircle(),!window.google||0==this.routes.length)return this.clearRoutes();this.directionsService||(this.directionsService=new google.maps.DirectionsService),this.routes.forEach((e=>{if(e.length<2)return;const t=e.splice(0,1)[0],s=e.splice(e.length-1,1)[0];this.renderRoute(t,s,e)}))}renderRoute(e,t,s){this.directionsService.route({origin:e,destination:t,waypoints:s,travelMode:this.options.directionTravelMode||"DRIVING",unitSystem:google.maps.UnitSystem[this.options.unitSystem||"METRIC"]},((e,t)=>{if("OK"===t){const t=new google.maps.DirectionsRenderer;t.setMap(this.map),t.setDirections(e),this.directionsRenderers.push(t),this.clearMarkers();const s=this.calculateDirectionData(e.routes);this.zone.run((()=>this.directionChange.emit(s)))}else this.toast.sendToast(`${this.language.getLabel("MSG_DIRECTION_REQUEST_FAILED")} ${t}`,"error"),this.zone.run((()=>this.directionChange.emit(null)))}))}clearRoutes(){0!=this.directionsRenderers.length&&(this.directionsRenderers.forEach((e=>e.setMap(null))),this.directionsRenderers=[])}removeReCenterControlListener(){this.centerControlListener&&(this.centerControlListener(),this.centerControlListener=null)}loadNecessaryLibraries(){this.libLoader.loadLib("maps.googleapis").subscribe((()=>{this.zone.runOutsideAngular((()=>this.renderMap())),this.libLoader.loadLib("MarkerClustererPlus").subscribe((()=>this.setMarkerCluster()))}))}renderMap(){this.map=new google.maps.Map(this.mapContainer.element.nativeElement,{center:{lat:48.168588,lng:16.346818},zoom:11,streetViewControl:!1,fullscreenControl:!1}),this.mapBounds=new google.maps.LatLngBounds,google.maps.event.addListener(this.map,"click",(()=>this.closePopover())),google.maps.event.addListenerOnce(this.map,"idle",(()=>{this.isMapIdled=!0,this.options.showMyLocation&&this.setCurrentLocationMarker(),this.options.fixedCircle&&(this.options.fixedCircle.center&&this.map.setCenter(this.options.fixedCircle.center),this.createFixedCircle()),this.options.circle&&(this.options.circle.center&&this.map.setCenter(this.options.circle.center),this.createCircle()),this.setMarkers()})),this.defineReCenterControl(),this.routes&&this.routes.length>0&&(this.directionsService=new google.maps.DirectionsService)}setCurrentLocationMarker(){this.clearMyLocationMarker(),window.google&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const t={map:this.map,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,strokeColor:"#fff",strokeWeight:2,fillOpacity:1,fillColor:"#CA1B21"},position:{lat:e.coords.latitude,lng:e.coords.longitude}};this.myLocationMarker=new google.maps.Marker(t)}))}clearMyLocationMarker(){this.myLocationMarker&&(this.myLocationMarker.setMap(null),google.maps.event.clearInstanceListeners(this.myLocationMarker),this.myLocationMarker=void 0)}defineReCenterControl(){const e=document.createElement("div");e.title=this.language.getLabel("LBL_RE_CENTER"),e.classList.add("spice-google-maps-control-recenter");const t=document.createElement("div");t.classList.add("spice-google-maps-control-recenter-icon"),e.appendChild(t),this.centerControlListener=this.renderer.listen(e,"click",(()=>{this.options.circle?this.map.setCenter(this.circle.getCenter()):this.fitMapBounds()})),this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e)}fitMapBounds(){this.map.setOptions({maxZoom:14}),this.map.fitBounds(this.mapBounds),this.map.setOptions({maxZoom:null})}setMarkerCluster(){!window.MarkerClusterer||0==this.markers.length||this.routes.length>0||(this.removeMarkerClusterMarkers(),this.markerCluster?this.markerCluster.addMarkers(this.markers):this.markerCluster=new MarkerClusterer(this.map,this.markers,{imagePath:"vendor/google-maps/MarkerClustererPlus/images/m"}))}removeMarkerClusterMarkers(){this.markerCluster&&this.markerCluster.clearMarkers()}createFixedCircle(){this.zone.runOutsideAngular((()=>this.createCircle(!0)))}setCircleListeners(){this.circle.addListener("radius_changed",(()=>{this.zone.run((()=>this.radiusChange.emit(Math.round(this.circle.getRadius()/100)/10)))})),this.circle.addListener("center_changed",(()=>{this.circle.getCenter().toString()!==this.options.circle.center.toString()&&(this.options.circle.draggable&&this.options.circle.editable?this.reverseGeoCode({lat:this.circle.getCenter().lat(),lng:this.circle.getCenter().lng()}):this.zone.runOutsideAngular((()=>this.createCircle())))}))}reverseGeoCode(e){(new google.maps.Geocoder).geocode({location:e},((t,s)=>{"OK"===s&&this.zone.run((()=>this.centerChange.emit({address:t[0].formatted_address,...e})))}))}removeFixedCircle(){this.removeCircle("fixedCircle")}removeCircle(e="circle"){this[e]&&(this[e].setMap(null),google.maps.event.clearInstanceListeners(this[e]),this[e]=void 0)}clearMarkers(){this.removeMarkerClusterMarkers(),this.markers.forEach((e=>{e.setMap(null),google.maps.event.clearInstanceListeners(e)})),this.markers=[],this.options.circle||this.map.setZoom(11)}setMarkers(){this.map&&(this.mapBounds=new google.maps.LatLngBounds,this.clearMarkers(),this.records.forEach((e=>{if(!this.verifyLatLng(e))return;const t={id:e.id,map:this.map,title:e.title?e.title:"",animation:google.maps.Animation.DROP,position:{lat:+e.lat,lng:+e.lng}};e.color&&(t.icon=this.generateMarkerColor(e.color));const s=new google.maps.Marker(t);s.defaultColor=e.color,this.mapBounds.extend(s.position),this.options.markerWithModelPopover&&s.addListener("click",(t=>{this.zone.run((()=>this.renderPopover(e.id,e.module,t)))})),this.markers.push(s)})),this.options.showCluster&&this.setMarkerCluster(),this.options.circle||this.fitMapBounds())}calculateDirectionData(e){let t={value:0,text:""},s=0;return e.forEach((e=>{e.legs.forEach((e=>{t.value+=e.distance.value,s+=e.duration.value}))})),t.text=this.convertDistanceToString(t.value),{distance:t,duration:{minutes:Math.round(60*(s/3600-Math.floor(s/3600))),hours:Math.floor(s/3600)}}}closePopover(){this.popoverComponentRef&&this.zone.run((()=>this.popoverComponentRef.instance.closePopover(!0)))}renderPopover(e,t,s){let i;if(this.closePopover(),_.toArray(s).some((e=>{if(e instanceof MouseEvent)return i=e.target,!0})),!i)return;const o=this.options.popoverComponent?this.options.popoverComponent:"ObjectModelPopover";this.metadata.addComponent(o,this.footer.footercontainer,this.injector).subscribe((s=>{s.instance.popoverid=e,s.instance.popovermodule=t,s.instance.parentElementRef={nativeElement:i},s.changeDetectorRef.detectChanges(),this.popoverComponentRef=s}))}}return e=SpiceGoogleMaps,(0,i.Z)(SpiceGoogleMaps,"ɵfac",(function(t){return new(t||e)(h.Y36(g.d),h.Y36(p.o),h.Y36(v.$),h.Y36(Q.M),h.Y36(M.Pu),h.Y36(h.Qsj),h.Y36(h.R0b),h.Y36(h.zs3),h.Y36(P.A))})),(0,i.Z)(SpiceGoogleMaps,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps"]],viewQuery:function(e,t){if(1&e&&h.Gf(H,5,h.s_b),2&e){let e;h.iGM(e=h.CRH())&&(t.mapContainer=e.first)}},inputs:{options:"options",records:"records",focusedRecordId:"focusedRecordId",routes:"routes"},outputs:{radiusChange:"radiusChange",centerChange:"centerChange",directionChange:"directionChange",mapIdleChange:"mapIdleChange"},features:[h.TTD],decls:2,vars:0,consts:[[2,"width","100%","height","100%","overflow","hidden"],["mapContainer",""]],template:function(e,t){1&e&&h._UZ(0,"div",0,1)},encapsulation:2,changeDetection:0})),SpiceGoogleMaps})();function K(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"a",14),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw();return h.KtG(t.loadMore())})),h._UZ(1,"system-label",15),h.qZA()}}function W(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"input",21),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw(2);return h.KtG(s.mapOptions.circle.radius=t)}))("ngModelChange",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.setMapOptionChanged("circleRadius"))})),h.qZA()(),h.TgZ(4,"input",22),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw(2);return h.KtG(s.mapOptions.circle.radius=t)}))("ngModelChange",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.setMapOptionChanged("circleRadius"))})),h.qZA(),h.TgZ(5,"span",23),h._uU(6,"km"),h.qZA()(),h.TgZ(7,"div",24)(8,"button",25),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.cancelEditingRadius())})),h._UZ(9,"system-button-icon",26),h.qZA(),h.TgZ(10,"button",27),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.confirmRadiusInput())})),h._UZ(11,"system-button-icon",28),h.qZA()()()}if(2&e){const e=h.oxw(2);h.xp6(3),h.Q6J("ngModel",e.mapOptions.circle.radius),h.xp6(1),h.Q6J("ngModel",e.mapOptions.circle.radius)}}function V(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",29)(1,"span",30),h._uU(2),h.qZA(),h.TgZ(3,"button",31),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.startRadiusEditing())})),h._UZ(4,"system-button-icon",32),h.qZA()()}if(2&e){const e=h.oxw(2);h.xp6(2),h.hij(" ",(null==e.mapOptions.circle?null:e.mapOptions.circle.radius)+"km around "+(null==e.mapOptions.circle||null==e.mapOptions.circle.center?null:e.mapOptions.circle.center.address)," "),h.xp6(2),h.Q6J("icon","edit")}}function $(e,t){if(1&e&&(h.ynx(0),h.YNc(1,W,12,2,"div",16),h.YNc(2,V,5,2,"div",17),h.BQk()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("ngIf",e.editingRadius&&!!e.mapOptions.circle),h.xp6(1),h.Q6J("ngIf",!e.editingRadius)}}function X(e,t){1&e&&h._UZ(0,"spice-google-maps-list-header")}function ee(e,t){if(1&e&&(h.TgZ(0,"div",36),h._UZ(1,"object-listview-aggregate",37),h.qZA()),2&e){const e=t.$implicit;h.xp6(1),h.Q6J("aggregate",e)}}const te=function(e){return{module:e}};function se(e,t){if(1&e&&(h.TgZ(0,"div",33)(1,"div",34),h.YNc(2,ee,2,1,"div",35),h.qZA()()),2&e){const e=h.oxw();h.Q6J("@animatepanel",void 0)("system-model-provider",h.VKq(3,te,e.modelList.module)),h.xp6(2),h.Q6J("ngForOf",e.modelList.moduleAggregates)}}let ie=(()=>{var e;class SpiceGoogleMapsList{constructor(e,t,s,o,n,r,l,a){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"modelList",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"iterableDiffers",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"navigation",void 0),(0,i.Z)(this,"broadcast",void 0),(0,i.Z)(this,"editingRadius",!1),(0,i.Z)(this,"searchAroundActive",!1),(0,i.Z)(this,"lngName","longitude"),(0,i.Z)(this,"latName","latitude"),(0,i.Z)(this,"componentconfig",void 0),(0,i.Z)(this,"subscriptions",new R.w0),(0,i.Z)(this,"focusedRecordId",void 0),(0,i.Z)(this,"mapOptions",{}),(0,i.Z)(this,"records",[]),this.language=e,this.modelList=t,this.metadata=s,this.iterableDiffers=o,this.cdRef=n,this.model=r,this.navigation=l,this.broadcast=a}get isLoading(){return this.modelList.isLoading}get canLoadMore(){return this.modelList.listData.list.length<this.modelList.listData.totalcount}ngOnInit(){this.loadComponentConfigs(),this.subscribeToModelListChanges(),this.subscribeToBroadcastMessages()}ngAfterViewInit(){this.setMapOptionChanged("circle")}ngOnDestroy(){this.subscriptions.unsubscribe(),this.modelList.searchGeo=void 0}setRecords(){this.records=this.latName&&this.lngName?this.modelList.listData.list.filter((e=>this.verifyLatLng({lat:e[this.latName],lng:e[this.lngName]}))).map((e=>({id:e.id,module:this.modelList.module,title:""+e.summary_text,lng:+e[this.lngName],lat:+e[this.latName]}))):[],this.cdRef.detectChanges()}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsList",this.modelList.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.radiusPercentage&&!isNaN(this.componentconfig.radiusPercentage)||(this.componentconfig.radiusPercentage=80),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.mapHeight||(this.componentconfig.mapHeight=500),this.componentconfig.circleColor||(this.componentconfig.circleColor="#CA1B21"),this.componentconfig.filterCircleColor||(this.componentconfig.filterCircleColor="#1A73E8"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8"),this.setMapOptionsFromComponentConfig(),this.setLatLngFieldsNames()}onRadiusChange(e){this.mapOptions.circle&&(this.mapOptions.circle.radius=e,this.cdRef.detectChanges()),this.editingRadius||(this.modelList.searchGeo={radius:e,lat:this.mapOptions.circle.center.lat,lng:this.mapOptions.circle.center.lng},this.modelList.reLoadList(!0).subscribe((()=>{this.setRecords()})))}onCenterChange(e){this.mapOptions.circle&&(this.mapOptions.circle.center=e)}setMapOptionChanged(e){this.mapOptions.changed={[e]:!0},this.mapOptions={...this.mapOptions},this.cdRef.detectChanges()}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}handleBroadcastMessage(e){if(("map.focus"==e.messagetype||"map.defocus"==e.messagetype)&&e.messagedata&&e.messagedata.record&&this.navigation.activeTab==e.messagedata.tabId){if(this.focusedRecordId=void 0,this.cdRef.detectChanges(),"map.defocus"==e.messagetype)this.mapOptions.circle=void 0,this.searchAroundActive=!1,this.setMapOptionChanged("circle");else{const t=this.records.find((t=>t.id==e.messagedata.record.id));t?this.focusedRecordId=t.id:(this.mapOptions.circle={center:{lat:e.messagedata.record.data[this.latName],lng:e.messagedata.record.data[this.lngName]},draggable:!0,editable:!0,radius:null,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor},this.searchAroundActive=!0,this.startRadiusEditing(!0),this.setMapOptionChanged("circle"))}this.cdRef.detectChanges()}}subscribeToBroadcastMessages(){this.subscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleBroadcastMessage(e)})))}setMapOptionsFromComponentConfig(){this.mapOptions={showCluster:this.componentconfig.showCluster,markerWithModelPopover:this.componentconfig.markerWithModelPopover,popoverComponent:this.componentconfig.popoverComponent,focusColor:this.componentconfig.focusColor,showMyLocation:this.componentconfig.showMyLocation}}setLatLngFieldsNames(){const e=this.metadata.getModuleDefs(this.modelList.module);e&&e.ftsgeo&&(this.lngName=e.ftsgeo.longitude_field,this.latName=e.ftsgeo.latitude_field)}setFixedCircle(){const e=this.modelList.getFilterDefs().geography;if(!e||!this.verifyLatLng(e)||!e.radius||isNaN(e.radius))return this.mapOptions.fixedCircle=void 0,this.setMapOptionChanged("fixedCircle");this.mapOptions.fixedCircle={radius:e.radius,center:{lng:e.lng,lat:e.lat},color:this.componentconfig.filterCircleColor},this.setMapOptionChanged("fixedCircle")}subscribeToModelListChanges(){this.subscriptions.add(this.modelList.listType$.subscribe((e=>{this.handleListTypeChange(e)}))),this.subscriptions.add(this.modelList.listDataChanged$.subscribe((()=>{this.setRecords(),this.setFixedCircle()})))}handleListTypeChange(e){"SpiceGoogleMapsList"==e.listcomponent&&this.setRecords()}loadMore(){this.modelList.loadMoreList()}toggleSearchAround(){this.searchAroundActive=!this.searchAroundActive,this.searchAroundActive?(this.mapOptions.circle={center:null,draggable:!0,editable:!0,radius:null,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor},this.startRadiusEditing(!0)):(this.mapOptions.circle=void 0,this.editingRadius=!1,this.modelList.searchGeo=void 0,this.modelList.reLoadList(!0)),this.setMapOptionChanged("circle")}startRadiusEditing(e){this.editingRadius=!0,this.mapOptions.circle.editable=!0,this.mapOptions.circle.draggable=!0,e||this.setMapOptionChanged("circleEditable")}cancelEditingRadius(){this.editingRadius=!1,this.mapOptions.circle.editable=!1,this.mapOptions.circle.draggable=!1,this.setMapOptionChanged("circleEditable")}confirmRadiusInput(){this.cancelEditingRadius(),this.setMapOptionChanged("circleRadius")}}return e=SpiceGoogleMapsList,(0,i.Z)(SpiceGoogleMapsList,"ɵfac",(function(t){return new(t||e)(h.Y36(g.d),h.Y36(O.t),h.Y36(M.Pu),h.Y36(h.ZZ4),h.Y36(h.sBO),h.Y36(p.o),h.Y36(E.G),h.Y36(J.f))})),(0,i.Z)(SpiceGoogleMapsList,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps-list"]],inputs:{componentconfig:"componentconfig"},decls:16,vars:11,consts:[[1,"slds-grid","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full","slds-size--1-of-2","slds-border--right",3,"system-overlay-loading-spinner"],[1,"slds-grow",2,"display","block",3,"options","records","focusedRecordId","radiusChange","centerChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-theme--shade","slds-p-around--xx-small","slds-border--bottom","slds-border--top","slds-border--left","slds-border--right"],[1,"slds-truncate","slds-grow"],["label","MSG_RECORDS_FOUND_WITH_GEO_DATA"],["class","slds-text-link slds-m-left--x-small",3,"click",4,"ngIf"],["system-title","LBL_SEARCH_AROUND",1,"slds-button","slds-button--icon-border","slds-m-left--x-small",2,"height","32px","padding","0","width","32px",3,"click"],["icon","choice","size","medium"],[4,"ngIf"],[1,"slds-size--1-of-2","slds-height_full","slds-grid","slds-grid--vertical"],[1,"slds-grow","slds-is-relative",2,"display","block","width","100%","min-height","0"],[1,"slds-grow","slds-height_full","slds-size--1-of-1",2,"display","block"],["class","slds-is-absolute slds-panel slds-panel--filters slds-filters__body slds-nowrap  slds-scrollable--y","style","width: 320px; height: 100%; top:0; right: 0;z-index: 99;",3,"system-model-provider",4,"ngIf"],[1,"slds-text-link","slds-m-left--x-small",3,"click"],["label","LBL_MORE"],["class","slds-grid slds-grow",4,"ngIf"],["class","slds-align-middle slds-m-left--x-small slds-grid slds-grow",4,"ngIf"],[1,"slds-grid","slds-grow"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange"],["type","number",1,"slds-input",2,"width","40px","padding",".3rem","height","32px","min-height","32px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],[1,"slds-button-group","slds-m-left--xx-small"],["system-title","LBL_CANCEL",1,"slds-button","slds-button--icon-border-filled",2,"height","32px","padding","0","width","32px",3,"click"],["icon","close","size","medium"],["system-title","LBL_CONFIRM",1,"slds-button","slds-button--icon-border-filled",2,"height","32px","padding","0","width","32px",3,"click"],["icon","check","size","medium"],[1,"slds-align-middle","slds-m-left--x-small","slds-grid","slds-grow"],[1,"slds-truncate"],[1,"slds-button","slds-button--icon","slds-m-left--xx-small",2,"float","right",3,"click"],[3,"icon"],[1,"slds-is-absolute","slds-panel","slds-panel--filters","slds-filters__body","slds-nowrap","slds-scrollable--y",2,"width","320px","height","100%","top","0","right","0","z-index","99",3,"system-model-provider"],[1,"slds-filters__body","slds-grid_vertical"],["class","slds-m-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-m-vertical--xx-small"],[3,"aggregate"]],template:function(e,t){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"spice-google-maps",2),h.NdJ("radiusChange",(function(e){return t.onRadiusChange(e)}))("centerChange",(function(e){return t.onCenterChange(e)})),h.qZA(),h.TgZ(3,"div",3)(4,"span",4),h._uU(5),h._UZ(6,"system-label",5),h.qZA(),h.YNc(7,K,2,0,"a",6),h.TgZ(8,"button",7),h.NdJ("click",(function(){return t.toggleSearchAround()})),h._UZ(9,"system-button-icon",8),h.qZA(),h.YNc(10,$,3,2,"ng-container",9),h.qZA()(),h.TgZ(11,"div",10),h.YNc(12,X,1,0,"spice-google-maps-list-header",9),h.TgZ(13,"div",11),h._UZ(14,"object-list",12),h.YNc(15,se,3,5,"div",13),h.qZA()()()),2&e&&(h.xp6(1),h.Q6J("system-overlay-loading-spinner",t.isLoading),h.xp6(1),h.Q6J("options",t.mapOptions)("records",t.records)("focusedRecordId",t.focusedRecordId),h.xp6(3),h.hij("( ",t.records.length," ) "),h.xp6(2),h.Q6J("ngIf",t.canLoadMore),h.xp6(1),h.ekj("slds-button--brand",t.searchAroundActive),h.xp6(2),h.Q6J("ngIf",t.searchAroundActive),h.xp6(2),h.Q6J("ngIf",!!t.componentconfig.showListHeader),h.xp6(3),h.Q6J("ngIf",t.modelList.displayAggregates))},dependencies:[o.sg,o.O5,n.Fj,n.wV,n.eT,n.JJ,n.On,Y.s,U.i,F.J,b._,q.u,B._,z.S,D,j],encapsulation:2,changeDetection:0})),SpiceGoogleMapsList})();var oe=s(2646),ne=s(5920),re=s(2422),le=s(5659),ae=s(6271);function de(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"system-input-radio-button-group",15),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw();return h.KtG(s.useMapFor=t)})),h.qZA()}if(2&e){const e=h.oxw();h.Q6J("ngModel",e.useMapFor)("disabled",e.isLoadingDirection||e.modelList.isLoading)("inputOptions",e.useMapForOptions)}}function ce(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",16),h._UZ(1,"object-list-types"),h.TgZ(2,"div",17),h._UZ(3,"system-utility-icon",18),h.TgZ(4,"input",19),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw();return h.KtG(s.listSearchTerm=t)}))("keyup.enter",(function(){h.CHM(e);const t=h.oxw();return h.KtG(t.triggerSearch())})),h.qZA()(),h.TgZ(5,"button",20),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw();return h.KtG(t.modelList.reLoadList())})),h._UZ(6,"system-button-icon",7),h.qZA(),h._UZ(7,"object-listview-aggregates-button"),h.qZA()}if(2&e){const e=h.oxw();h.xp6(4),h.Q6J("ngModel",e.listSearchTerm)("placeholder",e.language.getModuleName(e.modelList.module)),h.xp6(2),h.Q6J("icon","refresh")}}function he(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",21)(1,"system-input-radio-button-group",15),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw();return h.KtG(s.directionStartType=t)})),h.qZA(),h.TgZ(2,"div",22)(3,"system-googleplaces-autocomplete",23),h.NdJ("address",(function(t){h.CHM(e);const s=h.oxw();return h.KtG(s.defineMapRouteFromSearchAddress(t))})),h.qZA()()()}if(2&e){const e=h.oxw();h.xp6(1),h.Q6J("ngModel",e.directionStartType)("disabled",e.isLoadingDirection)("inputOptions",e.directionStartOptions),h.xp6(2),h.Q6J("disabled",!e.directionStartType||"address"!=e.directionStartType||e.isLoadingDirection)}}function ge(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"a",29),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.loadMore())})),h._UZ(1,"system-label",30),h.qZA()}}function pe(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",31)(1,"div",32)(2,"div",33)(3,"input",34,35),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw(2);return h.KtG(s.mapOptions.circle.radius=t)}))("mousedown",(function(){h.CHM(e);const t=h.MAs(4),s=h.oxw(2);return h.KtG(s.onRangeMouseDown(t))})),h.qZA()(),h.TgZ(5,"input",36),h.NdJ("ngModelChange",(function(t){h.CHM(e);const s=h.oxw(2);return h.KtG(s.mapOptions.circle.radius=t)}))("ngModelChange",(function(){h.CHM(e);const t=h.oxw(2);return h.KtG(t.setMapOptionChanged("circleRadius"))})),h.qZA(),h.TgZ(6,"span",37),h._uU(7,"km"),h.qZA()()()}if(2&e){const e=h.oxw(2);h.xp6(3),h.Q6J("ngModel",e.mapOptions.circle.radius),h.xp6(2),h.Q6J("ngModel",e.mapOptions.circle.radius)}}function ue(e,t){if(1&e&&(h.TgZ(0,"div",24),h._UZ(1,"object-listview-header-details"),h.TgZ(2,"span",25),h._uU(3),h._UZ(4,"system-label",26),h.qZA(),h.YNc(5,ge,2,0,"a",27),h.YNc(6,pe,8,2,"div",28),h.qZA()),2&e){const e=h.oxw();h.xp6(3),h.hij("( ",e.records.length," ) "),h.xp6(2),h.Q6J("ngIf",e.canLoadMore),h.xp6(1),h.Q6J("ngIf",!!e.mapOptions.circle)}}function me(e,t){if(1&e&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&e){const e=h.oxw(2);h.xp6(1),h.lnq(" ",null==e.directionResult.duration?null:e.directionResult.duration.hours," h ",null==e.directionResult.duration?null:e.directionResult.duration.minutes," min ( ",null==e.directionResult.distance?null:e.directionResult.distance.text," ) ")}}function fe(e,t){1&e&&(h.TgZ(0,"span",41),h._UZ(1,"system-label",42),h.qZA())}function Me(e,t){if(1&e&&(h._UZ(0,"system-utility-icon",38),h.YNc(1,me,2,3,"span",39),h.YNc(2,fe,2,0,"ng-template",null,40,h.W1O)),2&e){const e=h.MAs(3),t=h.oxw();h.Q6J("icon","DRIVING"==t.mapOptions.directionTravelMode&&t.directionResult?"travel_and_places":"info_alt"),h.xp6(1),h.Q6J("ngIf",t.directionResult)("ngIfElse",e)}}function ve(e,t){1&e&&h._UZ(0,"object-list",43)}function Ce(e,t){if(1&e&&(h.TgZ(0,"div",47),h._UZ(1,"object-listview-aggregate",48),h.qZA()),2&e){const e=t.$implicit;h.xp6(1),h.Q6J("aggregate",e)}}const be=function(e){return{module:e}};function Ze(e,t){if(1&e&&(h.TgZ(0,"div",44)(1,"div",45),h.YNc(2,Ce,2,1,"div",46),h.qZA()()),2&e){const e=h.oxw();h.Q6J("@animatepanel",void 0)("system-model-provider",h.VKq(3,be,e.modelList.module)),h.xp6(2),h.Q6J("ngForOf",e.listAggregates)}}let xe=(()=>{var e;class SpiceGoogleMapsRecord extends ie{constructor(e,t,s,o,n,r,l,a,d,c,h,g,p,u,m){super(e,t,s,n,r,d,p,g),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"modelList",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"iterableDiffers",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"zone",void 0),(0,i.Z)(this,"session",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"elementRef",void 0),(0,i.Z)(this,"renderer",void 0),(0,i.Z)(this,"broadcast",void 0),(0,i.Z)(this,"navigation",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"userpreferences",void 0),(0,i.Z)(this,"routes",[]),(0,i.Z)(this,"mapOptions",{}),(0,i.Z)(this,"useMapForOptions",[{icon:"search",value:"search"},{icon:"travel_and_places",value:"direction"}]),(0,i.Z)(this,"directionStartOptions",[{value:"myLocation",label:"LBL_MY_LOCATION"},{value:"office",label:"LBL_OFFICE"},{value:"address",label:"LBL_ADDRESS"}]),(0,i.Z)(this,"autoMapHeight",!1),(0,i.Z)(this,"directionResult",void 0),(0,i.Z)(this,"unitSystem","METRIC"),(0,i.Z)(this,"searchTimeout",void 0),(0,i.Z)(this,"isLoadingDirection",!1),(0,i.Z)(this,"isFullScreenOn",!1),(0,i.Z)(this,"showUseMapOptions",!0),(0,i.Z)(this,"_useMapFor","search"),(0,i.Z)(this,"_listSearchTerm",""),(0,i.Z)(this,"_directionStartType",void 0),this.language=e,this.modelList=t,this.metadata=s,this.backend=o,this.iterableDiffers=n,this.cdRef=r,this.zone=l,this.session=a,this.model=d,this.elementRef=c,this.renderer=h,this.broadcast=g,this.navigation=p,this.toast=u,this.userpreferences=m}set applyUseMapOptions(e){this.showUseMapOptions=e.search&&e.direction,this._useMapFor=e.search?"search":"direction"}get useMapFor(){return this._useMapFor}set useMapFor(e){this.isLoadingDirection||this.modelList.isLoading||(this._useMapFor=e,this.records=[],this.directionStartType=void 0,this.directionResult=void 0,this.adjustMap())}get mapHeight(){return this.isFullScreenOn||this.autoMapHeight?"search"==this._useMapFor?"50%":"100%":this.componentconfig.mapHeight+"px"}get listSearchTerm(){return this._listSearchTerm}set listSearchTerm(e){window.clearTimeout(this.searchTimeout),e!==this._listSearchTerm?(this._listSearchTerm=e,this.zone.runOutsideAngular((()=>{this.searchTimeout=window.setTimeout((()=>this.triggerSearch()),1e3)}))):this._listSearchTerm=e}get directionStartType(){return this._directionStartType}set directionStartType(e){switch(this._directionStartType=e,e){case"myLocation":this.defineMapRouteFromMyLocation();break;case"office":this.defineMapRouteFromUserAddress()}}get listAggregates(){return this.modelList.moduleAggregates}ngOnInit(){this.setDistanceUnitSystemFromPreferences(),super.ngOnInit()}ngAfterViewInit(){this.adjustMap(),super.ngAfterViewInit()}setRecords(){"search"==this.useMapFor&&super.setRecords()}handleBroadcastMessage(e){switch(e.messagetype){case"userpreferences.save":this.unitSystem=this.userpreferences.toUse.distance_unit_system||"METRIC",this.directionResult&&(this.directionResult.distance.text=this.convertDistanceToString(this.directionResult.distance.value));break;case"model.save":e.messagedata.module==this.model.module&&this.adjustMap()}super.handleBroadcastMessage(e),this.cdRef.detectChanges()}setDistanceUnitSystemFromPreferences(){this.unitSystem=this.userpreferences.toUse.distance_unit_system||"METRIC"}convertDistanceToString(e){if("IMPERIAL"==this.unitSystem){const t=3.2808*e;if(t>5280){return Math.pow(+(t/5280).toFixed(1),1)+" mile"}return Math.round(t)+" ft"}if(e>1e3){return Math.pow(+(e/1e3).toFixed(1),1)+" km"}return e+" m"}verifyPlaceLatLng(e){return!!e.placeId||this.verifyLatLng(e)}adjustMap(){"search"==this._useMapFor?(this.setCenterFromModel(),this.setMapOptionsForSearchUse()):(this.setMapOptionsForDirectionUse(),this.setRecordsFromModel(this.componentconfig.focusColor))}setRecordsFromModel(e){this.records=[{id:this.model.id,module:this.model.module,title:""+this.model.getField("summary_text"),lng:+this.model.getField(this.lngName),lat:+this.model.getField(this.latName),color:e}],this.cdRef.detectChanges()}setMapOptionsForSearchUse(){this.mapOptions={showCluster:this.componentconfig.showCluster,markerWithModelPopover:this.componentconfig.markerWithModelPopover,popoverComponent:this.componentconfig.popoverComponent,focusColor:this.componentconfig.focusColor,circle:this.mapOptions.circle,changed:{showCluster:!0,markerWithModelPopover:!0,circle:!0}},this.cdRef.detectChanges()}setMapOptionsForDirectionUse(){this.mapOptions={showCluster:!1,markerWithModelPopover:!1,circle:void 0,directionTravelMode:this.componentconfig.directionTravelMode,unitSystem:this.unitSystem,changed:{showCluster:!0,markerWithModelPopover:!0,circle:!0,directionTravelMode:!0,unitSystem:!0}},this.cdRef.detectChanges()}setCenterFromModel(){this.mapOptions.circle={center:{lng:+this.model.getField(this.lngName),lat:+this.model.getField(this.latName)},radius:void 0,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor,editable:!0},this.verifyLatLng(this.mapOptions.circle.center)||(this.mapOptions.circle=void 0)}setMapRoute(e){const t=this.buildRoute(e);if(!this.verifyPlaceLatLng(t[0])||!this.verifyPlaceLatLng(t[1]))return this.isLoadingDirection=!1;this.routes=[t],this.cdRef.detectChanges()}defineMapRouteFromSearchAddress(e){if("address"!=this.directionStartType)return;this.isLoadingDirection=!0;const t={lat:e.latitude,lng:e.longitude};this.setMapRoute(t)}defineMapRouteFromUserAddress(){this.isLoadingDirection=!0,this.backend.get("Users",this.session.authData.userId,"details").subscribe((e=>{if(!(e&&e.address_street&&e.address_postalcode&&e.address_city))return this.toast.sendToast(this.language.getLabel("MSG_NO_OFFICE_ADDRESSE_DEFINED"),"error"),this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges();const t=`${e.address_street}, ${e.address_postalcode} ${e.address_city}, ${e.address_country}`;this.backend.getRequest(`channels/groupware/gsuite/places/autocomplete/${encodeURIComponent(t)}`).subscribe((e=>{if(e.predictions&&e.predictions.length>0){const t={placeId:e.predictions[0].place_id};this.setMapRoute(t)}else this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges()}))}))}defineMapRouteFromMyLocation(){navigator.geolocation&&(this.isLoadingDirection=!0,navigator.geolocation.getCurrentPosition((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};this.setMapRoute(t)}),(()=>{this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges()})))}buildRoute(e){return[e,{lat:+this.model.getField(this.latName),lng:+this.model.getField(this.lngName)}]}triggerSearch(){this.zone.run((()=>{this.modelList.searchTerm=this.listSearchTerm,this.modelList.reLoadList()}))}setDirectionResult(e){this.isLoadingDirection=!1,this.directionResult=e,this.cdRef.detectChanges()}toggleFullScreen(e){this.zone.runOutsideAngular((()=>{if(document.onfullscreenchange=()=>{this.isFullScreenOn=!!document.fullscreenElement,this.cdRef.detectChanges()},this.isFullScreenOn){const e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}else e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}))}onRangeMouseDown(e){const t=this.renderer.listen(e,"mouseup",(()=>{this.setMapOptionChanged("circleRadius"),t()}))}}return e=SpiceGoogleMapsRecord,(0,i.Z)(SpiceGoogleMapsRecord,"ɵfac",(function(t){return new(t||e)(h.Y36(g.d),h.Y36(O.t),h.Y36(M.Pu),h.Y36(m.y),h.Y36(h.ZZ4),h.Y36(h.sBO),h.Y36(h.R0b),h.Y36(ne.n),h.Y36(p.o),h.Y36(h.SBq),h.Y36(h.Qsj),h.Y36(J.f),h.Y36(E.G),h.Y36(P.A),h.Y36(re.z))})),(0,i.Z)(SpiceGoogleMapsRecord,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps-record"]],inputs:{autoMapHeight:"autoMapHeight",applyUseMapOptions:["useMapOptions","applyUseMapOptions"]},features:[h.qOj],decls:18,vars:17,consts:[[1,"slds-grid","slds-grid--vertical","slds-theme--default","slds-height_full",2,"width","100%"],["mainContainer",""],[1,"slds-grid","slds-p-bottom--x-small"],["class","slds-m-right--x-small",3,"ngModel","disabled","inputOptions","ngModelChange",4,"ngIf"],["class","slds-form-element slds-grid slds-grid--vertical-align-center slds-grow",4,"ngIf","ngIfElse"],["directionToolsContainer",""],["system-title","LBL_FULL_SCREEN",1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-left--xx-small","slds-m-right--xxx-small","slds-col--bump-left",3,"click"],[3,"icon"],[1,"slds-grid","slds-theme--shade","slds-p-around--xx-small","slds-border--bottom","slds-border--top","slds-border--left","slds-border--right"],["class","slds-grid slds-grid--vertical-align-center",4,"ngIf","ngIfElse"],["directionInfoContainer",""],[1,"slds-border--left","slds-border--right","slds-border--bottom","slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0",3,"system-overlay-loading-spinner"],[2,"display","block",3,"focusedRecordId","options","records","routes","radiusChange","directionChange"],["style","display: block; height: 250px; min-height: 250px; max-height: 500px",4,"ngIf"],["class","slds-is-absolute slds-panel slds-panel--filters slds-filters__body slds-nowrap  slds-scrollable--y","style","width: 320px; height: 100%; top:0; right: 0;z-index: 99;",3,"system-model-provider",4,"ngIf"],[1,"slds-m-right--x-small",3,"ngModel","disabled","inputOptions","ngModelChange"],[1,"slds-form-element","slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["icon","search","size","x-small","addclasses","slds-input__icon"],["type","text","autocomplete","off",1,"slds-input",3,"ngModel","placeholder","ngModelChange","keyup.enter"],[1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-left--xx-small","slds-m-right--xxx-small",3,"click"],[1,"slds-grid","slds-grow","slds-grid--vertical-align-center"],[1,"slds-grow"],[3,"disabled","address"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-left--x-small","slds-truncate"],["label","MSG_RECORDS_FOUND_WITH_GEO_DATA"],["class","slds-text-link slds-m-left--x-small",3,"click",4,"ngIf"],["class","slds-grid slds-grow",4,"ngIf"],[1,"slds-text-link","slds-m-left--x-small",3,"click"],["label","LBL_MORE"],[1,"slds-grid","slds-grow"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange","mousedown"],["inputRangeElement",""],["type","number",1,"slds-input",2,"width","40px","padding",".3rem","height","32px","min-height","32px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],["size","x-small",1,"slds-m-right--x-small",3,"icon"],[4,"ngIf","ngIfElse"],["infoTextContainer",""],[1,"slds-truncate"],["label","MSG_SELECT_DIRECTION_TYPE"],[2,"display","block","height","250px","min-height","250px","max-height","500px"],[1,"slds-is-absolute","slds-panel","slds-panel--filters","slds-filters__body","slds-nowrap","slds-scrollable--y",2,"width","320px","height","100%","top","0","right","0","z-index","99",3,"system-model-provider"],[1,"slds-filters__body","slds-grid_vertical"],["class","slds-m-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-m-vertical--xx-small"],[3,"aggregate"]],template:function(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",0,1)(2,"div")(3,"div",2),h.YNc(4,de,1,3,"system-input-radio-button-group",3),h.YNc(5,ce,8,3,"div",4),h.YNc(6,he,4,4,"ng-template",null,5,h.W1O),h.TgZ(8,"button",6),h.NdJ("click",(function(){h.CHM(e);const s=h.MAs(1);return h.KtG(t.toggleFullScreen(s))})),h._UZ(9,"system-button-icon",7),h.qZA()(),h.TgZ(10,"div",8),h.YNc(11,ue,7,3,"div",9),h.YNc(12,Me,4,3,"ng-template",null,10,h.W1O),h.qZA()(),h.TgZ(14,"div",11)(15,"spice-google-maps",12),h.NdJ("radiusChange",(function(e){return t.onRadiusChange(e)}))("directionChange",(function(e){return t.setDirectionResult(e)})),h.qZA(),h.YNc(16,ve,1,0,"object-list",13),h.YNc(17,Ze,3,5,"div",14),h.qZA()()}if(2&e){const e=h.MAs(7),s=h.MAs(13);h.xp6(3),h.ekj("slds-p-around--x-small",t.isFullScreenOn),h.xp6(1),h.Q6J("ngIf",t.showUseMapOptions),h.xp6(1),h.Q6J("ngIf","search"==t.useMapFor)("ngIfElse",e),h.xp6(4),h.Q6J("icon",t.isFullScreenOn?"contract":"expand"),h.xp6(2),h.Q6J("ngIf","search"==t.useMapFor)("ngIfElse",s),h.xp6(3),h.Q6J("system-overlay-loading-spinner",t.isLoading||t.isLoadingDirection),h.xp6(1),h.Udp("height",t.mapHeight),h.Q6J("focusedRecordId",t.focusedRecordId)("options",t.mapOptions)("records",t.records)("routes",t.routes),h.xp6(1),h.Q6J("ngIf","search"==t.useMapFor),h.xp6(1),h.Q6J("ngIf",t.modelList.displayAggregates)}},dependencies:[o.sg,o.O5,n.Fj,n.wV,n.eT,n.JJ,n.On,Y.s,k.l,U.i,T.X,S.M,F.J,le.t,ae.p,b._,N.r,q.u,B._,z.S,j],encapsulation:2,changeDetection:0})),SpiceGoogleMapsRecord})();function Le(e,t){if(1&e&&(h.ynx(0),h._UZ(1,"spice-google-maps-record",2),h.BQk()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("componentconfig",e.componentconfig)}}function ye(e,t){1&e&&(h.TgZ(0,"div",3)(1,"system-illustration-no-data"),h._UZ(2,"system-label",4),h.qZA()())}let _e=(()=>{var e;class SpiceGoogleMapsRecordContainer{constructor(e,t,s,o,n){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"broadcast",void 0),(0,i.Z)(this,"modelList",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"componentconfig",void 0),(0,i.Z)(this,"subscription",new R.w0),(0,i.Z)(this,"hasGeoData",!1),this.model=e,this.cdRef=t,this.broadcast=s,this.modelList=o,this.metadata=n}ngOnInit(){this.modelList.cancelPendingRequests=!1,this.initializeModelList(),this.loadComponentConfigs(),this.subscribeToModelChanges(),this.checkModelHasGeoData()}ngOnDestroy(){this.subscription.unsubscribe()}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}initializeModelList(){this.modelList.useCache=!1,this.modelList.initialize(this.model.module,"SpiceGoogleMapsRecordContainer")}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsRecordContainer",this.model.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.radiusPercentage&&!isNaN(this.componentconfig.radiusPercentage)||(this.componentconfig.radiusPercentage=80),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.mapHeight||(this.componentconfig.mapHeight=500),this.componentconfig.circleColor||(this.componentconfig.circleColor="#CA1B21"),this.componentconfig.filterCircleColor||(this.componentconfig.filterCircleColor="#1A73E8"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8")}subscribeToModelChanges(){this.subscription=this.broadcast.message$.subscribe((e=>{"model.save"==e.messagetype&&e.messagedata.module===this.model.module&&this.checkModelHasGeoData()}))}checkModelHasGeoData(){const e=this.metadata.getModuleDefs(this.model.module);if(e&&e.ftsgeo){const t=e.ftsgeo.longitude_field,s=e.ftsgeo.latitude_field;this.hasGeoData=this.verifyLatLng({lat:this.model.getField(s),lng:this.model.getField(t)})}else this.hasGeoData=!1;this.cdRef.detectChanges()}}return e=SpiceGoogleMapsRecordContainer,(0,i.Z)(SpiceGoogleMapsRecordContainer,"ɵfac",(function(t){return new(t||e)(h.Y36(p.o),h.Y36(h.sBO),h.Y36(J.f),h.Y36(O.t),h.Y36(M.Pu))})),(0,i.Z)(SpiceGoogleMapsRecordContainer,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps-record-container"]],features:[h._Bn([O.t])],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["hasNoGeoDataContainer",""],[3,"componentconfig"],[1,"slds-grid","slds-grid_vertical-align-center","slds-height_full","slds-grid--align-center","slds-p-around--large"],["label","MSG_RECORD_HAS_NO_GEO_DATA"]],template:function(e,t){if(1&e&&(h.YNc(0,Le,2,1,"ng-container",0),h.YNc(1,ye,3,0,"ng-template",null,1,h.W1O)),2&e){const e=h.MAs(2);h.Q6J("ngIf",t.hasGeoData)("ngIfElse",e)}},dependencies:[o.O5,oe.t,b._,xe],encapsulation:2,changeDetection:0})),SpiceGoogleMapsRecordContainer})();var we=s(3845),Re=s(9621),Oe=s(3499),ke=s(5767),Te=s(1916);const Se=["mapelement"],Fe=["headerinput"];let Ae=(()=>{var e;class SpiceMapSelector{constructor(e,t,s,o){(0,i.Z)(this,"zone",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"libloader",void 0),(0,i.Z)(this,"mapelement",void 0),(0,i.Z)(this,"headerinput",void 0),(0,i.Z)(this,"self",void 0),(0,i.Z)(this,"map",{}),(0,i.Z)(this,"circle",{}),(0,i.Z)(this,"lat",void 0),(0,i.Z)(this,"lng",void 0),(0,i.Z)(this,"_radius",10),(0,i.Z)(this,"address",void 0),(0,i.Z)(this,"searchterm",""),(0,i.Z)(this,"geoSearchemitter",new h.vpe),this.zone=e,this.language=t,this.metadata=s,this.libloader=o}get radius(){return this._radius?this._radius:10}set radius(e){this._radius=e,this.circle&&this.circle.setRadius(1e3*this._radius)}ngAfterViewInit(){this.libloader.loadLib("maps.googleapis").subscribe((e=>{this.lat||this.lng?this.renderMap():navigator.geolocation.getCurrentPosition((e=>{this.lat=e.coords.latitude,this.lng=e.coords.longitude,this.renderMap(),this.reverseGeoCode()}),(()=>{this.renderMap()}))}))}renderMap(){let e={lat:this.lat,lng:this.lng};this.map=new google.maps.Map(this.mapelement.element.nativeElement,{center:e,scrollwheel:!0,streetViewControl:!1,zoom:11,minZoom:8}),this.circle=new google.maps.Circle({strokeColor:"red",fillColor:"#dddddd",fillOpacity:.5,strokeWeight:2,clickable:!0,draggable:!0,editable:!0,zIndex:1,map:this.map,center:e,radius:1e3*this._radius}),google.maps.event.addListener(this.circle,"center_changed",(()=>{this.lat!=this.circle.getCenter().lat()&&this.lng!=this.circle.getCenter().lng()&&(this.lat=this.circle.getCenter().lat(),this.lng=this.circle.getCenter().lng(),this.reverseGeoCode())})),google.maps.event.addListener(this.circle,"radius_changed",(()=>{this._radius=Math.round(this.circle.getRadius()/100)/10})),this.reverseGeoCode()}reverseGeoCode(){(new google.maps.Geocoder).geocode({location:{lat:this.lat,lng:this.lng}},((e,t)=>{this.address=e[0].formatted_address}))}close(){this.self.destroy()}set(){this.geoSearchemitter.emit({radius:this._radius,lat:this.lat,lng:this.lng,address:this.address}),this.close()}clear(){this.geoSearchemitter.emit(!1),this.close()}setDetails(e){this.lat=e.address.latitude,this.lng=e.address.longitude,this.address=[e.name,e.formatted_address].join(", "),this.map.setCenter({lat:e.address.latitude,lng:e.address.longitude}),this.circle.setCenter({lat:e.address.latitude,lng:e.address.longitude})}get mapStyle(){this.headerinput.element.nativeElement.getBoundingClientRect();return{width:"100%",height:"calc(100% - "+this.headerinput.element.nativeElement.getBoundingClientRect().height+"px)"}}}return e=SpiceMapSelector,(0,i.Z)(SpiceMapSelector,"ɵfac",(function(t){return new(t||e)(h.Y36(h.R0b),h.Y36(g.d),h.Y36(M.Pu),h.Y36(v.$))})),(0,i.Z)(SpiceMapSelector,"ɵcmp",h.Xpm({type:e,selectors:[["spice-map-selector"]],viewQuery:function(e,t){if(1&e&&(h.Gf(Se,7,h.s_b),h.Gf(Fe,7,h.s_b)),2&e){let e;h.iGM(e=h.CRH())&&(t.mapelement=e.first),h.iGM(e=h.CRH())&&(t.headerinput=e.first)}},decls:22,vars:6,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--x-small"],["headerinput",""],[1,"slds-size--2-of-3",3,"ngModel","ngModelChange","details"],[1,"slds-grid","slds-grid_vertical-align-center","slds-size--1-of-3","slds-p-left--x-small"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange"],["type","number",1,"slds-input",2,"width","60px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],[3,"ngStyle"],["mapelement",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CLEAR"],["label","LBL_SET"],["label","LBL_CLOSE"]],template:function(e,t){1&e&&(h.TgZ(0,"system-modal",0)(1,"system-modal-header",1),h.NdJ("close",(function(){return t.close()})),h.qZA(),h.TgZ(2,"system-modal-content",2)(3,"div",3,4)(5,"system-googleplaces-search",5),h.NdJ("ngModelChange",(function(e){return t.searchterm=e}))("details",(function(e){return t.setDetails(e)})),h.qZA(),h.TgZ(6,"div",6)(7,"div",7)(8,"input",8),h.NdJ("ngModelChange",(function(e){return t.radius=e})),h.qZA()(),h.TgZ(9,"input",9),h.NdJ("ngModelChange",(function(e){return t.radius=e})),h.qZA(),h.TgZ(10,"span",10),h._uU(11,"km"),h.qZA()()(),h._UZ(12,"div",11,12),h.qZA(),h.TgZ(14,"system-modal-footer"),h._uU(15),h.TgZ(16,"button",13),h.NdJ("click",(function(){return t.clear()})),h._UZ(17,"system-label",14),h.qZA(),h.TgZ(18,"button",13),h.NdJ("click",(function(){return t.set()})),h._UZ(19,"system-label",15),h.qZA(),h.TgZ(20,"button",13),h.NdJ("click",(function(){return t.close()})),h._UZ(21,"system-label",16),h.qZA()()()),2&e&&(h.xp6(2),h.Q6J("grow",!0),h.xp6(3),h.Q6J("ngModel",t.searchterm),h.xp6(3),h.Q6J("ngModel",t.radius),h.xp6(1),h.Q6J("ngModel",t.radius),h.xp6(3),h.Q6J("ngStyle",t.mapStyle),h.xp6(3),h.hij(" ",t.address," "))},dependencies:[o.PC,n.Fj,n.wV,n.eT,n.JJ,n.On,we.l,b._,Re.j,Oe.x,ke.p,Te.y],encapsulation:2})),SpiceMapSelector})();var Ie=s(4044);function Ne(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"div",1)(1,"button",2),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw();return h.KtG(t.emitBroadcastMessage())})),h._UZ(2,"system-button-icon",3),h.qZA(),h.TgZ(3,"button",4),h.NdJ("click",(function(){h.CHM(e);const t=h.oxw();return h.KtG(t.openDirectionModal())})),h._UZ(4,"system-button-icon",5),h.qZA()()}}let Ge=(()=>{var e;class SpiceMapGeoDataField{constructor(e,t,s,o,n,r,l){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"navigation",void 0),(0,i.Z)(this,"broadcast",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"hasGeoData",!1),this.model=e,this.metadata=t,this.navigation=s,this.broadcast=o,this.modal=n,this.injector=r,this.cdRef=l}ngOnInit(){this.checkModelGeoData()}setHasGeoData(){this.hasGeoData=!0,this.cdRef.detectChanges()}emitBroadcastMessage(){const e={tabId:this.navigation.activeTabObject.id,record:this.model.data};this.broadcast.broadcastMessage("map.focus",e)}checkModelGeoData(){const e=this.metadata.getModuleDefs(this.model.module);if(e&&e.ftsgeo){const t=this.model.getField(e.ftsgeo.longitude_field),s=this.model.getField(e.ftsgeo.latitude_field);t&&!isNaN(t)&&s&&!isNaN(s)?this.setHasGeoData():this.cdRef.detach()}}openDirectionModal(){this.modal.openModal("SpiceGoogleMapsDirectionModal",!0,this.injector)}}return e=SpiceMapGeoDataField,(0,i.Z)(SpiceMapGeoDataField,"ɵfac",(function(t){return new(t||e)(h.Y36(p.o),h.Y36(M.Pu),h.Y36(E.G),h.Y36(J.f),h.Y36(Ie.o),h.Y36(h.zs3),h.Y36(h.sBO))})),(0,i.Z)(SpiceMapGeoDataField,"ɵcmp",h.Xpm({type:e,selectors:[["spice-map-geo-data-field"]],decls:1,vars:1,consts:[["class","slds-button-group",4,"ngIf"],[1,"slds-button-group"],["system-title","LBL_GEO_DATA",1,"slds-button","slds-button--icon-border-filled","slds-button-group-item",2,"height","24px","width","24px",3,"click"],["icon","world","size","medium"],["system-title","LBL_ROUTE_PLANNER",1,"slds-button","slds-button--icon-border-filled","slds-button-group-item",2,"height","24px","width","24px",3,"click"],["icon","travel_and_places","size","medium"]],template:function(e,t){1&e&&h.YNc(0,Ne,5,0,"div",0),2&e&&h.Q6J("ngIf",t.hasGeoData)},dependencies:[o.O5,F.J,z.S],encapsulation:2,changeDetection:0})),SpiceMapGeoDataField})(),De=(()=>{var e;class SpiceGoogleMapsDirectionModal{constructor(e,t,s){(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"self",{}),(0,i.Z)(this,"componentconfig",void 0),(0,i.Z)(this,"useMapOptions",{direction:!0,search:!1}),this.cdRef=e,this.metadata=t,this.model=s}ngOnInit(){this.loadComponentConfigs()}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsDirectionModal",this.model.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8")}close(){this.cdRef.detach(),this.self.destroy()}}return e=SpiceGoogleMapsDirectionModal,(0,i.Z)(SpiceGoogleMapsDirectionModal,"ɵfac",(function(t){return new(t||e)(h.Y36(h.sBO),h.Y36(M.Pu),h.Y36(p.o))})),(0,i.Z)(SpiceGoogleMapsDirectionModal,"ɵcmp",h.Xpm({type:e,selectors:[["spice-google-maps-direction-modal"]],decls:8,vars:4,consts:[[3,"close"],["label","LBL_DIRECTION"],[3,"grow"],[3,"componentconfig","autoMapHeight","useMapOptions"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"]],template:function(e,t){1&e&&(h.TgZ(0,"system-modal")(1,"system-modal-header",0),h.NdJ("close",(function(){return t.self.destroy()})),h._UZ(2,"system-label",1),h.qZA(),h.TgZ(3,"system-modal-content",2),h._UZ(4,"spice-google-maps-record",3),h.qZA(),h.TgZ(5,"system-modal-footer")(6,"button",4),h.NdJ("click",(function(){return t.close()})),h._UZ(7,"system-label",5),h.qZA()()()),2&e&&(h.xp6(3),h.Q6J("grow",!0),h.xp6(1),h.Q6J("componentconfig",t.componentconfig)("autoMapHeight",!0)("useMapOptions",t.useMapOptions))},dependencies:[b._,Re.j,Oe.x,ke.p,Te.y,xe],encapsulation:2,changeDetection:0})),SpiceGoogleMapsDirectionModal})(),Ee=(()=>{var e;class ModuleSpiceMap{}return e=ModuleSpiceMap,(0,i.Z)(ModuleSpiceMap,"ɵfac",(function(t){return new(t||e)})),(0,i.Z)(ModuleSpiceMap,"ɵmod",h.oAB({type:e})),(0,i.Z)(ModuleSpiceMap,"ɵinj",h.cJS({imports:[o.ez,n.u5,l.ObjectFields,a.GlobalComponents,d.ObjectComponents,c.SystemComponents,r.o]})),ModuleSpiceMap})();("undefined"==typeof ngJitMode||ngJitMode)&&h.kYT(Ee,{declarations:[w,D,ie,_e,xe,j,Ae,Ge,De],imports:[o.ez,n.u5,l.ObjectFields,a.GlobalComponents,d.ObjectComponents,c.SystemComponents,r.o],exports:[j,Ge,xe]})}}]);