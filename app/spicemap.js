/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:53:45
 *
 *                     build: 2024.01.001.1717779225604
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_spicemap_spicemap_ts"],{583:(e,t,s)=>{s.r(t),s.d(t,{ModuleSpiceMap:()=>Te});var i=s(60177),o=s(84341),n=s(71341),r=s(7745),l=s(12948),a=s(37328),c=s(70569),d=s(54438),h=s(69904),g=s(35911),p=s(92462),u=s(49722),m=s(57363),f=s(83935),M=s(82802),C=s(52872),b=s(32062),v=s(45915);const R=["mapelement"];function k(e,t){if(1&e&&(d.j41(0,"th",18)(1,"a",19)(2,"span",20),d.nrm(3,"system-label-fieldname",21),d.k0s()()()),2&e){const e=t.$implicit,s=d.XpG();d.R7$(3),d.Y8G("module",s.model.module)("field",e.field)("fieldconfig",e.fieldconfig)}}function L(e,t){if(1&e){const e=d.RV6();d.j41(0,"tr",22),d.bIt("mouseenter",(function(){const t=d.eBV(e).$implicit,s=d.XpG();return d.Njj(s.mouseOver(t.id))}))("mouseleave",(function(){const t=d.eBV(e).$implicit,s=d.XpG();return d.Njj(s.mouseOut(t.id))})),d.k0s()}if(2&e){const e=t.$implicit,s=d.XpG();d.Y8G("module",s.model.module)("listfields",s.getListFields())("listitem",e)}}let y=(()=>{class SpiceMap{constructor(e,t,s,i,o,n,r,l){this.zone=e,this.language=t,this.model=s,this.modelutilities=i,this.backend=o,this.router=n,this.metadata=r,this.libloader=l,this.componentconfig={},this.map={},this.circle={},this.mousedown=!1,this.mapBoundaries={},this.modelMarker={},this.surroundingFunction={},this.surroundingMarkers=[],this.surroundingObjects=[],this.listfields=[]}getListFields(){return this.metadata.getFieldSetFields(this.componentconfig.fieldset)}ngAfterViewInit(){this.libloader.loadLib("maps.googleapis").subscribe((e=>{this.renderMap()}))}get latField(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_latitude":"address_latitude"}get lngField(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_longitude":"address_longitude"}get lat(){return this.model.getField(this.latField)}get lng(){return this.model.getField(this.lngField)}renderMap(){let e={lat:48.2,lng:16.3};this.lng&&this.lat&&(e={lat:this.lat,lng:this.lng}),this.map=new google.maps.Map(this.mapelement.element.nativeElement,{center:e,scrollwheel:!0,zoom:14,minZoom:8}),this.lng&&this.lat&&(this.modelMarker=new google.maps.Marker({position:e,map:this.map,icon:"https://maps.google.com/mapfiles/ms/micons/red-dot.png",title:this.model.getField("summary_text")})),this.map.addListener("bounds_changed",(()=>{this.mapBoundaries=this.map.getBounds(),this.surroundingFunction&&window.clearTimeout(this.surroundingFunction),this.surroundingFunction=window.setTimeout((()=>this.getSurrounding()),500)}))}reCenter(){this.map.setCenter(this.modelMarker.position)}isApiLoaded(){return window.google&&window.google.maps}getSurrounding(){for(let e of this.surroundingMarkers)e.setMap(null);this.surroundingMarkers=[];let e=this.mapBoundaries.getNorthEast(),t=this.mapBoundaries.getSouthWest(),s={join:"AND",conditions:[{field:"id",operator:"<>",value:this.model.id},{field:this.lngField,operator:"<",value:e.lng()},{field:this.latField,operator:"<",value:e.lat()},{field:this.lngField,operator:">",value:t.lng()},{field:this.latField,operator:">",value:t.lat()}]},i={searchfields:JSON.stringify(s),fields:JSON.stringify(["id","name",this.lngField,this.latField])};this.backend.getRequest("module/"+this.model.module,i).subscribe((e=>{for(let t in e.list){for(let s in e.list[t])e.list[t][s]=this.modelutilities.backend2spice(this.model.module,s,e.list[t][s]);let s=new google.maps.Marker({position:{lat:e.list[t][this.latField],lng:e.list[t][this.lngField]},map:this.map,title:e.list[t].summary_text,icon:"http://maps.google.com/mapfiles/ms/micons/green.png",sugarId:e.list[t].id,sugarModule:this.model.module});this.surroundingMarkers.push(s)}this.surroundingObjects=e.list,this.zone.run((()=>{}))}))}mouseOver(e){this.surroundingMarkers.some((t=>{if(t.sugarId===e)return t.setIcon("http://maps.google.com/mapfiles/ms/micons/yellow-dot.png"),!0}))}mouseOut(e){this.surroundingMarkers.some((t=>{if(t.sugarId===e)return t.setIcon("http://maps.google.com/mapfiles/ms/micons/green.png"),!0}))}static#e=this.ɵfac=function(e){return new(e||SpiceMap)(d.rXU(d.SKi),d.rXU(h.B),d.rXU(g.g),d.rXU(p.g),d.rXU(u.H),d.rXU(m.Ix),d.rXU(f.yu),d.rXU(M.b))};static#t=this.ɵcmp=d.VBU({type:SpiceMap,selectors:[["spice-map"]],viewQuery:function(e,t){if(1&e&&d.GBs(R,7,d.c1b),2&e){let e;d.mGM(e=d.lsd())&&(t.mapelement=e.first)}},decls:22,vars:3,consts:[[1,"slds-card","slds-card_boundary","slds-m-bottom--medium"],[1,"slds-card__header","slds-grid"],[1,"slds-media","slds-media--center","slds-has-flexi-truncate"],[1,"slds-media__body","slds-truncate"],[1,"slds-text-heading--small"],["label","LBL_MAP_VIEW"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_RECENTER"],[1,"slds-card__body","slds-p-horizontal--small"],[2,"width","100%","height","400px","border-radius","4px","overflow","hidden"],["mapelement",""],[1,"slds-p-top--small"],[1,"slds-table","slds-table--bordered","slds-table--fixed-layout"],[1,"slds-text-title--caps"],["class","slds-is-sortable","scope","col",4,"ngFor","ngForOf"],["scope","col",1,"slds-cell-shrink"],["object-related-list-item","","class","slds-hint-parent",3,"module","listfields","listitem","mouseenter","mouseleave",4,"ngFor","ngForOf"],["scope","col",1,"slds-is-sortable"],["href","javascript:void(0);",1,"slds-th__action","slds-text-link--reset"],[1,"slds-truncate"],[3,"module","field","fieldconfig"],["object-related-list-item","",1,"slds-hint-parent",3,"module","listfields","listitem","mouseenter","mouseleave"]],template:function(e,t){1&e&&(d.j41(0,"article",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"h2")(5,"span",4),d.nrm(6,"system-label",5),d.EFF(7),d.k0s()()()(),d.j41(8,"div",6)(9,"button",7),d.bIt("click",(function(){return t.reCenter()})),d.nrm(10,"system-label",8),d.k0s()()(),d.j41(11,"div",9),d.nrm(12,"div",10,11),d.j41(14,"div",12)(15,"table",13)(16,"thead")(17,"tr",14),d.DNE(18,k,4,3,"th",15),d.nrm(19,"th",16),d.k0s()(),d.j41(20,"tbody"),d.DNE(21,L,1,3,"tr",17),d.k0s()()()()()),2&e&&(d.R7$(7),d.SpI(" (",t.surroundingObjects.length,")"),d.R7$(11),d.Y8G("ngForOf",t.getListFields()),d.R7$(3),d.Y8G("ngForOf",t.surroundingObjects))},dependencies:[i.Sq,C.W,b.W,v.P],encapsulation:2})}return SpiceMap})();var I=s(18359),O=s(75103),S=s(37265),G=s(4467),F=s(99438),x=s(25863),w=s(84359),D=s(44985),j=s(18521);function N(e,t){if(1&e){const e=d.RV6();d.j41(0,"system-checkbox",8),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG();return d.DH7(s.relateFilterActive,t)||(s.relateFilterActive=t),d.Njj(t)})),d.nrm(1,"system-label",9)(2,"system-label-modulename",10),d.EFF(3),d.k0s()}if(2&e){const e=d.XpG();d.Y8G("disabled",e.relateFilter.required),d.R50("ngModel",e.relateFilterActive),d.R7$(2),d.Y8G("module",e.relateFilter.module)("singular",!0),d.R7$(),d.SpI(" ",e.relateFilter.display," ")}}let E=(()=>{class SpiceGoogleMapsListHeader{constructor(e,t,s,i){this.language=e,this.modellist=t,this.metadata=s,this.element=i,this.searchTerm="",this.searchTermOld="",this.searchTimeOut=void 0,this.subscriptions=new I.yU,this.usedSearchTerm=new d.bkB}get requestfields(){let e=[];for(let t of this.modellist.listfields)-1!=e.indexOf(t.field)&&e.push(t.field);return e}get relateFilter(){return this.modellist.relatefilter}get relateFilterActive(){return this.relateFilter?.active}set relateFilterActive(e){this.relateFilter.active=e,this.modellist.relatefilter.active=e,this.modellist.reLoadList()}ngOnInit(){this.searchTerm=this.modellist.searchTerm,this.searchTermOld=this.modellist.searchTerm}ngOnDestroy(){this.subscriptions.unsubscribe()}doSearch(){this.searchTermOld=this.searchTerm,this.modellist.searchTerm=this.searchTerm,this.modellist.getListData()}triggerSearch(e){if(this.searchTerm!==this.searchTermOld)if("Enter"===e.key)this.searchTerm.length>0&&(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.doSearch());else this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.doSearch()),1e3)}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMapsListHeader)(d.rXU(h.B),d.rXU(O.K),d.rXU(f.yu),d.rXU(d.aKT))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMapsListHeader,selectors:[["spice-google-maps-list-header"]],outputs:{usedSearchTerm:"usedSearchTerm"},decls:11,vars:3,consts:[[1,"slds-form-element","slds-p-top--medium","slds-p-horizontal--medium","slds-m-bottom--small","slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["icon","search","size","x-small","addclasses","slds-input__icon"],["type","text","id","lookup","autocomplete","search-term",1,"slds-input",3,"ngModel","placeholder","ngModelChange","keyup"],[1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-horizontal--xxx-small",3,"click"],["icon","refresh"],[1,"slds-theme--shade","slds-p-around--x-small","slds-border--top","slds-grid","slds-grid--vertical-align-center","slds","slds-grid--align-spread"],[3,"disabled","ngModel","ngModelChange",4,"ngIf"],[3,"disabled","ngModel","ngModelChange"],["label","LBL_RELATED_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(d.j41(0,"div",0),d.nrm(1,"object-list-types"),d.j41(2,"div",1),d.nrm(3,"system-utility-icon",2),d.j41(4,"input",3),d.mxI("ngModelChange",(function(e){return d.DH7(t.searchTerm,e)||(t.searchTerm=e),e})),d.bIt("keyup",(function(e){return t.triggerSearch(e)})),d.k0s()(),d.j41(5,"button",4),d.bIt("click",(function(){return t.modellist.reLoadList()})),d.nrm(6,"system-button-icon",5),d.k0s(),d.nrm(7,"object-listview-aggregates-button"),d.k0s(),d.j41(8,"div",6),d.nrm(9,"object-listview-header-details"),d.DNE(10,N,4,5,"system-checkbox",7),d.k0s()),2&e&&(d.R7$(4),d.R50("ngModel",t.searchTerm),d.Y8G("placeholder",t.language.getModuleName(t.modellist.module)),d.R7$(6),d.Y8G("ngIf",t.relateFilter&&t.relateFilter.id))},dependencies:[i.bT,o.me,o.BC,o.vS,S.f,G.f,F.S,x.t,w.f,b.W,D.r,j.B],encapsulation:2,changeDetection:0})}return SpiceGoogleMapsListHeader})();var T=s(60968),B=s(40553),X=s(64914),U=s(28460),A=s(98427),$=s(32130),V=s(22465),z=s(4921),Y=s(41081);const P=["mapContainer"];let H=(()=>{class SpiceGoogleMaps{constructor(e,t,s,i,o,n,r,l,a){this.language=e,this.model=t,this.libLoader=s,this.footer=i,this.metadata=o,this.renderer=n,this.zone=r,this.injector=l,this.toast=a,this.records=[],this.routes=[],this.radiusChange=new d.bkB,this.centerChange=new d.bkB,this.directionChange=new d.bkB,this.mapIdleChange=new d.bkB,this.popoverComponentRef=null,this.markers=[],this.directionsRenderers=[],this.isMapIdled=!1}ngOnChanges(e){this.isMapIdled&&this.zone.runOutsideAngular((()=>{e.records&&this.setMarkers(),e.focusedRecordId&&this.setFocusedMarker(),e.routes&&this.renderRoutes(),e.options&&this.handleOptionsChange()}))}ngAfterViewInit(){this.loadNecessaryLibraries()}ngOnDestroy(){google.maps.event.clearInstanceListeners(this.map),this.clearMarkers(),this.clearMyLocationMarker(),this.removeReCenterControlListener(),this.removeCircle(),this.removeFixedCircle(),this.closePopover(),this.clearFocusedMarker()}convertDistanceToString(e){if("IMPERIAL"==this.options.unitSystem){const t=3.2808*e;if(t>5280){return Math.pow(+(t/5280).toFixed(1),1)+" mile"}return Math.round(t)+" ft"}if(e>1e3){return Math.pow(+(e/1e3).toFixed(1),1)+" km"}return e+" m"}generateMarkerColor(e){return{path:"M 0,0 L -43.3,-75 A 50 50 1 1 1 43.30,-75 L 0,0 z",strokeColor:"#fff",strokeWeight:1,fillOpacity:1,scale:.25,anchor:{x:4.5,y:5},fillColor:0==e.indexOf("#")?e:"#"+e}}createCircle(e){if(!window.google)return;const t=e?"fixedCircle":"circle";this[t]&&this.removeCircle(t);let s=this.options[t].center;s&&this.verifyLatLng(s)||(s={lat:this.map.getCenter().lat(),lng:this.map.getCenter().lng()},this.reverseGeoCode(s),this.options[t].center=s),this[t]=new google.maps.Circle(this.generateCircleOptions(this.options[t],e)),e||(this.setCircleListeners(),this.map.setCenter(s))}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}generateCircleOptions(e,t){let s=1e3*(e.radius||5);const i=e.radiusPercentage||80;return e.radius||t||!this.map.getBounds()||!i||isNaN(i)||(s=this.setRadiusFromMapDimensions(i)),{strokeColor:e.color,fillOpacity:0,strokeWeight:2,clickable:!1,editable:e.editable,draggable:e.draggable,zIndex:1,map:this.map,center:e.center,radius:s}}setRadiusFromMapDimensions(e){const t=google.maps.geometry.spherical,s=this.map.getBounds().getNorthEast(),i=this.map.getBounds().getSouthWest(),o=new google.maps.LatLng(i.lat(),s.lng()),n=new google.maps.LatLng(s.lat(),i.lng()),r=t.computeDistanceBetween(s,n),l=t.computeDistanceBetween(s,o),a=(l<r?l:r)/2*(e/100);return this.zone.run((()=>this.radiusChange.emit(Math.round(a/100)/10))),a}setFocusedMarker(){this.clearFocusedMarker(),this.markers.some((e=>{if(e.id==this.focusedRecordId){const t=this.options.focusColor||"#1A73E8";return e.setIcon(this.generateMarkerColor(t)),this.markerCluster&&(this.markerCluster.removeMarker(e),e.setMap(this.map)),this.mapBounds=new google.maps.LatLngBounds,this.mapBounds.extend(e.position),this.fitMapBounds(),this.focusedMarker=e,!0}}))}clearFocusedMarker(){this.focusedMarker&&(this.markerCluster&&(this.markerCluster.removeMarker(this.focusedMarker),this.markerCluster.addMarker(this.focusedMarker)),this.focusedMarker.setIcon(this.focusedMarker.defaultColor?this.generateMarkerColor(this.focusedMarker.defaultColor):null),this.focusedMarker=void 0)}handleOptionsChange(){this.options.fixedCircle?this.options.changed.fixedCircle&&(this.clearRoutes(),this.createFixedCircle()):this.removeFixedCircle(),this.options.circle?this.options.changed.circle?(this.clearRoutes(),this.createCircle()):this.options.changed.circleRadius?this.circle.setRadius(1e3*this.options.circle.radius):this.options.changed.circleCenter?this.circle.setCenter(this.options.circle.center):this.options.changed.circleEditable&&(this.circle.setEditable(this.options.circle.editable),this.circle.setDraggable(this.options.circle.draggable)):this.removeCircle(),this.options.showCluster?this.options.changed.showCluster&&this.setMarkerCluster():this.removeMarkerClusterMarkers(),this.options.showMyLocation?this.options.changed.showMyLocation&&this.setCurrentLocationMarker():this.clearMyLocationMarker()}renderRoutes(){if(this.removeCircle(),this.removeFixedCircle(),!window.google||0==this.routes.length)return this.clearRoutes();this.directionsService||(this.directionsService=new google.maps.DirectionsService),this.routes.forEach((e=>{if(e.length<2)return;const t=e.splice(0,1)[0],s=e.splice(e.length-1,1)[0];this.renderRoute(t,s,e)}))}renderRoute(e,t,s){this.directionsService.route({origin:e,destination:t,waypoints:s,travelMode:this.options.directionTravelMode||"DRIVING",unitSystem:google.maps.UnitSystem[this.options.unitSystem||"METRIC"]},((e,t)=>{if("OK"===t){const t=new google.maps.DirectionsRenderer;t.setMap(this.map),t.setDirections(e),this.directionsRenderers.push(t),this.clearMarkers();const s=this.calculateDirectionData(e.routes);this.zone.run((()=>this.directionChange.emit(s)))}else this.toast.sendToast(`${this.language.getLabel("MSG_DIRECTION_REQUEST_FAILED")} ${t}`,"error"),this.zone.run((()=>this.directionChange.emit(null)))}))}clearRoutes(){0!=this.directionsRenderers.length&&(this.directionsRenderers.forEach((e=>e.setMap(null))),this.directionsRenderers=[])}removeReCenterControlListener(){this.centerControlListener&&(this.centerControlListener(),this.centerControlListener=null)}loadNecessaryLibraries(){this.libLoader.loadLib("maps.googleapis").subscribe((()=>{this.zone.runOutsideAngular((()=>this.renderMap())),this.libLoader.loadLib("MarkerClustererPlus").subscribe((()=>this.setMarkerCluster()))}))}renderMap(){this.map=new google.maps.Map(this.mapContainer.element.nativeElement,{center:{lat:48.168588,lng:16.346818},zoom:11,streetViewControl:!1,fullscreenControl:!1}),this.mapBounds=new google.maps.LatLngBounds,google.maps.event.addListener(this.map,"click",(()=>this.closePopover())),google.maps.event.addListenerOnce(this.map,"idle",(()=>{this.isMapIdled=!0,this.options.showMyLocation&&this.setCurrentLocationMarker(),this.options.fixedCircle&&(this.options.fixedCircle.center&&this.map.setCenter(this.options.fixedCircle.center),this.createFixedCircle()),this.options.circle&&(this.options.circle.center&&this.map.setCenter(this.options.circle.center),this.createCircle()),this.setMarkers()})),this.defineReCenterControl(),this.routes&&this.routes.length>0&&(this.directionsService=new google.maps.DirectionsService)}setCurrentLocationMarker(){this.clearMyLocationMarker(),window.google&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const t={map:this.map,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,strokeColor:"#fff",strokeWeight:2,fillOpacity:1,fillColor:"#CA1B21"},position:{lat:e.coords.latitude,lng:e.coords.longitude}};this.myLocationMarker=new google.maps.Marker(t)}))}clearMyLocationMarker(){this.myLocationMarker&&(this.myLocationMarker.setMap(null),google.maps.event.clearInstanceListeners(this.myLocationMarker),this.myLocationMarker=void 0)}defineReCenterControl(){const e=document.createElement("div");e.title=this.language.getLabel("LBL_RE_CENTER"),e.classList.add("spice-google-maps-control-recenter");const t=document.createElement("div");t.classList.add("spice-google-maps-control-recenter-icon"),e.appendChild(t),this.centerControlListener=this.renderer.listen(e,"click",(()=>{this.options.circle?this.map.setCenter(this.circle.getCenter()):this.fitMapBounds()})),this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e)}fitMapBounds(){this.map.setOptions({maxZoom:14}),this.map.fitBounds(this.mapBounds),this.map.setOptions({maxZoom:null})}setMarkerCluster(){!window.MarkerClusterer||0==this.markers.length||this.routes.length>0||(this.removeMarkerClusterMarkers(),this.markerCluster?this.markerCluster.addMarkers(this.markers):this.markerCluster=new MarkerClusterer(this.map,this.markers,{imagePath:"vendor/google-maps/MarkerClustererPlus/images/m"}))}removeMarkerClusterMarkers(){this.markerCluster&&this.markerCluster.clearMarkers()}createFixedCircle(){this.zone.runOutsideAngular((()=>this.createCircle(!0)))}setCircleListeners(){this.circle.addListener("radius_changed",(()=>{this.zone.run((()=>this.radiusChange.emit(Math.round(this.circle.getRadius()/100)/10)))})),this.circle.addListener("center_changed",(()=>{this.circle.getCenter().toString()!==this.options.circle.center.toString()&&(this.options.circle.draggable&&this.options.circle.editable?this.reverseGeoCode({lat:this.circle.getCenter().lat(),lng:this.circle.getCenter().lng()}):this.zone.runOutsideAngular((()=>this.createCircle())))}))}reverseGeoCode(e){(new google.maps.Geocoder).geocode({location:e},((t,s)=>{"OK"===s&&this.zone.run((()=>this.centerChange.emit({address:t[0].formatted_address,...e})))}))}removeFixedCircle(){this.removeCircle("fixedCircle")}removeCircle(e="circle"){this[e]&&(this[e].setMap(null),google.maps.event.clearInstanceListeners(this[e]),this[e]=void 0)}clearMarkers(){this.removeMarkerClusterMarkers(),this.markers.forEach((e=>{e.setMap(null),google.maps.event.clearInstanceListeners(e)})),this.markers=[],this.options.circle||this.map.setZoom(11)}setMarkers(){this.map&&(this.mapBounds=new google.maps.LatLngBounds,this.clearMarkers(),this.records.forEach((e=>{if(!this.verifyLatLng(e))return;const t={id:e.id,map:this.map,title:e.title?e.title:"",animation:google.maps.Animation.DROP,position:{lat:+e.lat,lng:+e.lng}};e.color&&(t.icon=this.generateMarkerColor(e.color));const s=new google.maps.Marker(t);s.defaultColor=e.color,this.mapBounds.extend(s.position),this.options.markerWithModelPopover&&s.addListener("click",(t=>{this.zone.run((()=>this.renderPopover(e.id,e.module,t)))})),this.markers.push(s)})),this.options.showCluster&&this.setMarkerCluster(),this.options.circle||this.fitMapBounds())}calculateDirectionData(e){let t={value:0,text:""},s=0;return e.forEach((e=>{e.legs.forEach((e=>{t.value+=e.distance.value,s+=e.duration.value}))})),t.text=this.convertDistanceToString(t.value),{distance:t,duration:{minutes:Math.round(60*(s/3600-Math.floor(s/3600))),hours:Math.floor(s/3600)}}}closePopover(){this.popoverComponentRef&&this.zone.run((()=>this.popoverComponentRef.instance.closePopover(!0)))}renderPopover(e,t,s){let i;if(this.closePopover(),_.toArray(s).some((e=>{if(e instanceof MouseEvent)return i=e.target,!0})),!i)return;const o=this.options.popoverComponent?this.options.popoverComponent:"ObjectModelPopover";this.metadata.addComponent(o,this.footer.footercontainer,this.injector).subscribe((s=>{s.instance.popoverid=e,s.instance.popovermodule=t,s.instance.parentElementRef={nativeElement:i},s.changeDetectorRef.detectChanges(),this.popoverComponentRef=s}))}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMaps)(d.rXU(h.B),d.rXU(g.g),d.rXU(M.b),d.rXU(z.q),d.rXU(f.yu),d.rXU(d.sFG),d.rXU(d.SKi),d.rXU(d.zZn),d.rXU(Y.o))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMaps,selectors:[["spice-google-maps"]],viewQuery:function(e,t){if(1&e&&d.GBs(P,5,d.c1b),2&e){let e;d.mGM(e=d.lsd())&&(t.mapContainer=e.first)}},inputs:{options:"options",records:"records",focusedRecordId:"focusedRecordId",routes:"routes"},outputs:{radiusChange:"radiusChange",centerChange:"centerChange",directionChange:"directionChange",mapIdleChange:"mapIdleChange"},features:[d.OA$],decls:2,vars:0,consts:[[2,"width","100%","height","100%","overflow","hidden"],["mapContainer",""]],template:function(e,t){1&e&&d.nrm(0,"div",0,1)},encapsulation:2,changeDetection:0})}return SpiceGoogleMaps})();function W(e,t){if(1&e){const e=d.RV6();d.j41(0,"a",14),d.bIt("click",(function(){d.eBV(e);const t=d.XpG();return d.Njj(t.loadMore())})),d.nrm(1,"system-label",15),d.k0s()}}function q(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",18)(1,"div",19)(2,"div",20)(3,"input",21),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG(2);return d.DH7(s.mapOptions.circle.radius,t)||(s.mapOptions.circle.radius=t),d.Njj(t)})),d.bIt("ngModelChange",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.setMapOptionChanged("circleRadius"))})),d.k0s()(),d.j41(4,"input",22),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG(2);return d.DH7(s.mapOptions.circle.radius,t)||(s.mapOptions.circle.radius=t),d.Njj(t)})),d.bIt("ngModelChange",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.setMapOptionChanged("circleRadius"))})),d.k0s(),d.j41(5,"span",23),d.EFF(6,"km"),d.k0s()(),d.j41(7,"div",24)(8,"button",25),d.bIt("click",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.cancelEditingRadius())})),d.nrm(9,"system-button-icon",26),d.k0s(),d.j41(10,"button",27),d.bIt("click",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.confirmRadiusInput())})),d.nrm(11,"system-button-icon",28),d.k0s()()()}if(2&e){const e=d.XpG(2);d.R7$(3),d.R50("ngModel",e.mapOptions.circle.radius),d.R7$(),d.R50("ngModel",e.mapOptions.circle.radius)}}function K(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",29)(1,"span",30),d.EFF(2),d.k0s(),d.j41(3,"button",31),d.bIt("click",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.startRadiusEditing())})),d.nrm(4,"system-button-icon",32),d.k0s()()}if(2&e){const e=d.XpG(2);d.R7$(2),d.SpI(" ",(null==e.mapOptions.circle?null:e.mapOptions.circle.radius)+"km around "+(null==e.mapOptions.circle||null==e.mapOptions.circle.center?null:e.mapOptions.circle.center.address)," "),d.R7$(2),d.Y8G("icon","edit")}}function Q(e,t){if(1&e&&(d.qex(0),d.DNE(1,q,12,2,"div",16)(2,K,5,2,"div",17),d.bVm()),2&e){const e=d.XpG();d.R7$(),d.Y8G("ngIf",e.editingRadius&&!!e.mapOptions.circle),d.R7$(),d.Y8G("ngIf",!e.editingRadius)}}function Z(e,t){1&e&&d.nrm(0,"spice-google-maps-list-header")}function J(e,t){if(1&e&&(d.j41(0,"div",36),d.nrm(1,"object-listview-aggregate",37),d.k0s()),2&e){const e=t.$implicit;d.R7$(),d.Y8G("aggregate",e)}}const ee=e=>({module:e});function te(e,t){if(1&e&&(d.j41(0,"div",33)(1,"div",34),d.DNE(2,J,2,1,"div",35),d.k0s()()),2&e){const e=d.XpG();d.Y8G("@animatepanel",void 0)("system-model-provider",d.eq3(3,ee,e.modelList.module)),d.R7$(2),d.Y8G("ngForOf",e.modelList.moduleAggregates)}}let se=(()=>{class SpiceGoogleMapsList{constructor(e,t,s,i,o,n,r,l){this.language=e,this.modelList=t,this.metadata=s,this.iterableDiffers=i,this.cdRef=o,this.model=n,this.navigation=r,this.broadcast=l,this.editingRadius=!1,this.searchAroundActive=!1,this.lngName="longitude",this.latName="latitude",this.subscriptions=new I.yU,this.mapOptions={},this.records=[]}get isLoading(){return this.modelList.isLoading}get canLoadMore(){return this.modelList.listData.list.length<this.modelList.listData.totalcount}ngOnInit(){this.loadComponentConfigs(),this.subscribeToModelListChanges(),this.subscribeToBroadcastMessages()}ngAfterViewInit(){this.setMapOptionChanged("circle")}ngOnDestroy(){this.subscriptions.unsubscribe(),this.modelList.searchGeo=void 0}setRecords(){this.records=this.latName&&this.lngName?this.modelList.listData.list.filter((e=>this.verifyLatLng({lat:e[this.latName],lng:e[this.lngName]}))).map((e=>({id:e.id,module:this.modelList.module,title:""+e.summary_text,lng:+e[this.lngName],lat:+e[this.latName]}))):[],this.cdRef.detectChanges()}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsList",this.modelList.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.radiusPercentage&&!isNaN(this.componentconfig.radiusPercentage)||(this.componentconfig.radiusPercentage=80),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.mapHeight||(this.componentconfig.mapHeight=500),this.componentconfig.circleColor||(this.componentconfig.circleColor="#CA1B21"),this.componentconfig.filterCircleColor||(this.componentconfig.filterCircleColor="#1A73E8"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8"),this.setMapOptionsFromComponentConfig(),this.setLatLngFieldsNames()}onRadiusChange(e){this.mapOptions.circle&&(this.mapOptions.circle.radius=e,this.cdRef.detectChanges()),this.editingRadius||(this.modelList.searchGeo={radius:e,lat:this.mapOptions.circle.center.lat,lng:this.mapOptions.circle.center.lng},this.modelList.reLoadList(!0).subscribe((()=>{this.setRecords()})))}onCenterChange(e){this.mapOptions.circle&&(this.mapOptions.circle.center=e)}setMapOptionChanged(e){this.mapOptions.changed={[e]:!0},this.mapOptions={...this.mapOptions},this.cdRef.detectChanges()}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}handleBroadcastMessage(e){if(("map.focus"==e.messagetype||"map.defocus"==e.messagetype)&&e.messagedata&&e.messagedata.record&&this.navigation.activeTab==e.messagedata.tabId){if(this.focusedRecordId=void 0,this.cdRef.detectChanges(),"map.defocus"==e.messagetype)this.mapOptions.circle=void 0,this.searchAroundActive=!1,this.setMapOptionChanged("circle");else{const t=this.records.find((t=>t.id==e.messagedata.record.id));t?this.focusedRecordId=t.id:(this.mapOptions.circle={center:{lat:e.messagedata.record.data[this.latName],lng:e.messagedata.record.data[this.lngName]},draggable:!0,editable:!0,radius:null,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor},this.searchAroundActive=!0,this.startRadiusEditing(!0),this.setMapOptionChanged("circle"))}this.cdRef.detectChanges()}}subscribeToBroadcastMessages(){this.subscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleBroadcastMessage(e)})))}setMapOptionsFromComponentConfig(){this.mapOptions={showCluster:this.componentconfig.showCluster,markerWithModelPopover:this.componentconfig.markerWithModelPopover,popoverComponent:this.componentconfig.popoverComponent,focusColor:this.componentconfig.focusColor,showMyLocation:this.componentconfig.showMyLocation}}setLatLngFieldsNames(){const e=this.metadata.getModuleDefs(this.modelList.module);e&&e.ftsgeo&&(this.lngName=e.ftsgeo.longitude_field,this.latName=e.ftsgeo.latitude_field)}setFixedCircle(){const e=this.modelList.getFilterDefs().geography;if(!e||!this.verifyLatLng(e)||!e.radius||isNaN(e.radius))return this.mapOptions.fixedCircle=void 0,this.setMapOptionChanged("fixedCircle");this.mapOptions.fixedCircle={radius:e.radius,center:{lng:e.lng,lat:e.lat},color:this.componentconfig.filterCircleColor},this.setMapOptionChanged("fixedCircle")}subscribeToModelListChanges(){this.subscriptions.add(this.modelList.listType$.subscribe((e=>{this.handleListTypeChange(e)}))),this.subscriptions.add(this.modelList.listDataChanged$.subscribe((()=>{this.setRecords(),this.setFixedCircle()})))}handleListTypeChange(e){"SpiceGoogleMapsList"==e.listcomponent&&this.setRecords()}loadMore(){this.modelList.loadMoreList()}toggleSearchAround(){this.searchAroundActive=!this.searchAroundActive,this.searchAroundActive?(this.mapOptions.circle={center:null,draggable:!0,editable:!0,radius:null,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor},this.startRadiusEditing(!0)):(this.mapOptions.circle=void 0,this.editingRadius=!1,this.modelList.searchGeo=void 0,this.modelList.reLoadList(!0)),this.setMapOptionChanged("circle")}startRadiusEditing(e){this.editingRadius=!0,this.mapOptions.circle.editable=!0,this.mapOptions.circle.draggable=!0,e||this.setMapOptionChanged("circleEditable")}cancelEditingRadius(){this.editingRadius=!1,this.mapOptions.circle.editable=!1,this.mapOptions.circle.draggable=!1,this.setMapOptionChanged("circleEditable")}confirmRadiusInput(){this.cancelEditingRadius(),this.setMapOptionChanged("circleRadius")}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMapsList)(d.rXU(h.B),d.rXU(O.K),d.rXU(f.yu),d.rXU(d._q3),d.rXU(d.gRc),d.rXU(g.g),d.rXU(T.L),d.rXU(B.m))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMapsList,selectors:[["spice-google-maps-list"]],inputs:{componentconfig:"componentconfig"},decls:16,vars:11,consts:[[1,"slds-grid","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full","slds-size--1-of-2","slds-border--right",3,"system-overlay-loading-spinner"],[1,"slds-grow",2,"display","block",3,"options","records","focusedRecordId","radiusChange","centerChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-theme--shade","slds-p-around--xx-small","slds-border--bottom","slds-border--top","slds-border--left","slds-border--right"],[1,"slds-truncate","slds-grow"],["label","MSG_RECORDS_FOUND_WITH_GEO_DATA"],["class","slds-text-link slds-m-left--x-small",3,"click",4,"ngIf"],["system-title","LBL_SEARCH_AROUND",1,"slds-button","slds-button--icon-border","slds-m-left--x-small",2,"height","32px","padding","0","width","32px",3,"click"],["icon","choice","size","medium"],[4,"ngIf"],[1,"slds-size--1-of-2","slds-height_full","slds-grid","slds-grid--vertical"],[1,"slds-grow","slds-is-relative",2,"display","block","width","100%","min-height","0"],[1,"slds-grow","slds-height_full","slds-size--1-of-1",2,"display","block"],["class","slds-is-absolute slds-panel slds-panel--filters slds-filters__body slds-nowrap  slds-scrollable--y","style","width: 320px; height: 100%; top:0; right: 0;z-index: 99;",3,"system-model-provider",4,"ngIf"],[1,"slds-text-link","slds-m-left--x-small",3,"click"],["label","LBL_MORE"],["class","slds-grid slds-grow",4,"ngIf"],["class","slds-align-middle slds-m-left--x-small slds-grid slds-grow",4,"ngIf"],[1,"slds-grid","slds-grow"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange"],["type","number",1,"slds-input",2,"width","40px","padding",".3rem","height","32px","min-height","32px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],[1,"slds-button-group","slds-m-left--xx-small"],["system-title","LBL_CANCEL",1,"slds-button","slds-button--icon-border-filled",2,"height","32px","padding","0","width","32px",3,"click"],["icon","close","size","medium"],["system-title","LBL_CONFIRM",1,"slds-button","slds-button--icon-border-filled",2,"height","32px","padding","0","width","32px",3,"click"],["icon","check","size","medium"],[1,"slds-align-middle","slds-m-left--x-small","slds-grid","slds-grow"],[1,"slds-truncate"],[1,"slds-button","slds-button--icon","slds-m-left--xx-small",2,"float","right",3,"click"],[3,"icon"],[1,"slds-is-absolute","slds-panel","slds-panel--filters","slds-filters__body","slds-nowrap","slds-scrollable--y",2,"width","320px","height","100%","top","0","right","0","z-index","99",3,"system-model-provider"],[1,"slds-filters__body","slds-grid_vertical"],["class","slds-m-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-m-vertical--xx-small"],[3,"aggregate"]],template:function(e,t){1&e&&(d.j41(0,"div",0)(1,"div",1)(2,"spice-google-maps",2),d.bIt("radiusChange",(function(e){return t.onRadiusChange(e)}))("centerChange",(function(e){return t.onCenterChange(e)})),d.k0s(),d.j41(3,"div",3)(4,"span",4),d.EFF(5),d.nrm(6,"system-label",5),d.k0s(),d.DNE(7,W,2,0,"a",6),d.j41(8,"button",7),d.bIt("click",(function(){return t.toggleSearchAround()})),d.nrm(9,"system-button-icon",8),d.k0s(),d.DNE(10,Q,3,2,"ng-container",9),d.k0s()(),d.j41(11,"div",10),d.DNE(12,Z,1,0,"spice-google-maps-list-header",9),d.j41(13,"div",11),d.nrm(14,"object-list",12),d.DNE(15,te,3,5,"div",13),d.k0s()()()),2&e&&(d.R7$(),d.Y8G("system-overlay-loading-spinner",t.isLoading),d.R7$(),d.Y8G("options",t.mapOptions)("records",t.records)("focusedRecordId",t.focusedRecordId),d.R7$(3),d.SpI("( ",t.records.length," ) "),d.R7$(2),d.Y8G("ngIf",t.canLoadMore),d.R7$(),d.AVh("slds-button--brand",t.searchAroundActive),d.R7$(2),d.Y8G("ngIf",t.searchAroundActive),d.R7$(2),d.Y8G("ngIf",!!t.componentconfig.showListHeader),d.R7$(3),d.Y8G("ngIf",t.modelList.displayAggregates))},dependencies:[i.Sq,i.bT,o.me,o.Q0,o.MR,o.BC,o.vS,X.Y,U.q,x.t,b.W,A.v,$.M,V.L,E,H],encapsulation:2,changeDetection:0})}return SpiceGoogleMapsList})();var ie=s(70923),oe=s(29994),ne=s(48849),re=s(87285),le=s(39554);function ae(e,t){if(1&e){const e=d.RV6();d.j41(0,"system-input-radio-button-group",15),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG();return d.DH7(s.useMapFor,t)||(s.useMapFor=t),d.Njj(t)})),d.k0s()}if(2&e){const e=d.XpG();d.R50("ngModel",e.useMapFor),d.Y8G("disabled",e.isLoadingDirection||e.modelList.isLoading)("inputOptions",e.useMapForOptions)}}function ce(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",16),d.nrm(1,"object-list-types"),d.j41(2,"div",17),d.nrm(3,"system-utility-icon",18),d.j41(4,"input",19),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG();return d.DH7(s.listSearchTerm,t)||(s.listSearchTerm=t),d.Njj(t)})),d.bIt("keyup.enter",(function(){d.eBV(e);const t=d.XpG();return d.Njj(t.triggerSearch())})),d.k0s()(),d.j41(5,"button",20),d.bIt("click",(function(){d.eBV(e);const t=d.XpG();return d.Njj(t.modelList.reLoadList())})),d.nrm(6,"system-button-icon",7),d.k0s(),d.nrm(7,"object-listview-aggregates-button"),d.k0s()}if(2&e){const e=d.XpG();d.R7$(4),d.R50("ngModel",e.listSearchTerm),d.Y8G("placeholder",e.language.getModuleName(e.modelList.module)),d.R7$(2),d.Y8G("icon","refresh")}}function de(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",21)(1,"system-input-radio-button-group",15),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG();return d.DH7(s.directionStartType,t)||(s.directionStartType=t),d.Njj(t)})),d.k0s(),d.j41(2,"div",22)(3,"system-googleplaces-autocomplete",23),d.bIt("address",(function(t){d.eBV(e);const s=d.XpG();return d.Njj(s.defineMapRouteFromSearchAddress(t))})),d.k0s()()()}if(2&e){const e=d.XpG();d.R7$(),d.R50("ngModel",e.directionStartType),d.Y8G("disabled",e.isLoadingDirection)("inputOptions",e.directionStartOptions),d.R7$(2),d.Y8G("disabled",!e.directionStartType||"address"!=e.directionStartType||e.isLoadingDirection)}}function he(e,t){if(1&e){const e=d.RV6();d.j41(0,"a",29),d.bIt("click",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.loadMore())})),d.nrm(1,"system-label",30),d.k0s()}}function ge(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",31)(1,"div",32)(2,"div",33)(3,"input",34,35),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG(2);return d.DH7(s.mapOptions.circle.radius,t)||(s.mapOptions.circle.radius=t),d.Njj(t)})),d.bIt("mousedown",(function(){d.eBV(e);const t=d.sdS(4),s=d.XpG(2);return d.Njj(s.onRangeMouseDown(t))})),d.k0s()(),d.j41(5,"input",36),d.mxI("ngModelChange",(function(t){d.eBV(e);const s=d.XpG(2);return d.DH7(s.mapOptions.circle.radius,t)||(s.mapOptions.circle.radius=t),d.Njj(t)})),d.bIt("ngModelChange",(function(){d.eBV(e);const t=d.XpG(2);return d.Njj(t.setMapOptionChanged("circleRadius"))})),d.k0s(),d.j41(6,"span",37),d.EFF(7,"km"),d.k0s()()()}if(2&e){const e=d.XpG(2);d.R7$(3),d.R50("ngModel",e.mapOptions.circle.radius),d.R7$(2),d.R50("ngModel",e.mapOptions.circle.radius)}}function pe(e,t){if(1&e&&(d.j41(0,"div",24),d.nrm(1,"object-listview-header-details"),d.j41(2,"span",25),d.EFF(3),d.nrm(4,"system-label",26),d.k0s(),d.DNE(5,he,2,0,"a",27)(6,ge,8,2,"div",28),d.k0s()),2&e){const e=d.XpG();d.R7$(3),d.SpI("( ",e.records.length," ) "),d.R7$(2),d.Y8G("ngIf",e.canLoadMore),d.R7$(),d.Y8G("ngIf",!!e.mapOptions.circle)}}function ue(e,t){if(1&e&&(d.j41(0,"span"),d.EFF(1),d.k0s()),2&e){const e=d.XpG(2);d.R7$(),d.E5c(" ",null==e.directionResult.duration?null:e.directionResult.duration.hours," h ",null==e.directionResult.duration?null:e.directionResult.duration.minutes," min ( ",null==e.directionResult.distance?null:e.directionResult.distance.text," ) ")}}function me(e,t){1&e&&(d.j41(0,"span",41),d.nrm(1,"system-label",42),d.k0s())}function fe(e,t){if(1&e&&(d.nrm(0,"system-utility-icon",38),d.DNE(1,ue,2,3,"span",39)(2,me,2,0,"ng-template",null,40,d.C5r)),2&e){const e=d.sdS(3),t=d.XpG();d.Y8G("icon","DRIVING"==t.mapOptions.directionTravelMode&&t.directionResult?"travel_and_places":"info_alt"),d.R7$(),d.Y8G("ngIf",t.directionResult)("ngIfElse",e)}}function Me(e,t){1&e&&d.nrm(0,"object-list",43)}function Ce(e,t){if(1&e&&(d.j41(0,"div",47),d.nrm(1,"object-listview-aggregate",48),d.k0s()),2&e){const e=t.$implicit;d.R7$(),d.Y8G("aggregate",e)}}const be=e=>({module:e});function ve(e,t){if(1&e&&(d.j41(0,"div",44)(1,"div",45),d.DNE(2,Ce,2,1,"div",46),d.k0s()()),2&e){const e=d.XpG();d.Y8G("@animatepanel",void 0)("system-model-provider",d.eq3(3,be,e.modelList.module)),d.R7$(2),d.Y8G("ngForOf",e.listAggregates)}}let Re=(()=>{class SpiceGoogleMapsRecord extends se{constructor(e,t,s,i,o,n,r,l,a,c,d,h,g,p,u){super(e,t,s,o,n,a,g,h),this.language=e,this.modelList=t,this.metadata=s,this.backend=i,this.iterableDiffers=o,this.cdRef=n,this.zone=r,this.session=l,this.model=a,this.elementRef=c,this.renderer=d,this.broadcast=h,this.navigation=g,this.toast=p,this.userpreferences=u,this.routes=[],this.mapOptions={},this.useMapForOptions=[{icon:"search",value:"search"},{icon:"travel_and_places",value:"direction"}],this.directionStartOptions=[{value:"myLocation",label:"LBL_MY_LOCATION"},{value:"office",label:"LBL_OFFICE"},{value:"address",label:"LBL_ADDRESS"}],this.autoMapHeight=!1,this.unitSystem="METRIC",this.isLoadingDirection=!1,this.isFullScreenOn=!1,this.showUseMapOptions=!0,this._useMapFor="search",this._listSearchTerm=""}set applyUseMapOptions(e){this.showUseMapOptions=e.search&&e.direction,this._useMapFor=e.search?"search":"direction"}get useMapFor(){return this._useMapFor}set useMapFor(e){this.isLoadingDirection||this.modelList.isLoading||(this._useMapFor=e,this.records=[],this.directionStartType=void 0,this.directionResult=void 0,this.adjustMap())}get mapHeight(){return this.isFullScreenOn||this.autoMapHeight?"search"==this._useMapFor?"50%":"100%":this.componentconfig.mapHeight+"px"}get listSearchTerm(){return this._listSearchTerm}set listSearchTerm(e){window.clearTimeout(this.searchTimeout),e!==this._listSearchTerm?(this._listSearchTerm=e,this.zone.runOutsideAngular((()=>{this.searchTimeout=window.setTimeout((()=>this.triggerSearch()),1e3)}))):this._listSearchTerm=e}get directionStartType(){return this._directionStartType}set directionStartType(e){switch(this._directionStartType=e,e){case"myLocation":this.defineMapRouteFromMyLocation();break;case"office":this.defineMapRouteFromUserAddress()}}get listAggregates(){return this.modelList.moduleAggregates}ngOnInit(){this.setDistanceUnitSystemFromPreferences(),super.ngOnInit()}ngAfterViewInit(){this.adjustMap(),super.ngAfterViewInit()}setRecords(){"search"==this.useMapFor&&super.setRecords()}handleBroadcastMessage(e){switch(e.messagetype){case"userpreferences.save":this.unitSystem=this.userpreferences.toUse.distance_unit_system||"METRIC",this.directionResult&&(this.directionResult.distance.text=this.convertDistanceToString(this.directionResult.distance.value));break;case"model.save":e.messagedata.module==this.model.module&&this.adjustMap()}super.handleBroadcastMessage(e),this.cdRef.detectChanges()}setDistanceUnitSystemFromPreferences(){this.unitSystem=this.userpreferences.toUse.distance_unit_system||"METRIC"}convertDistanceToString(e){if("IMPERIAL"==this.unitSystem){const t=3.2808*e;if(t>5280){return Math.pow(+(t/5280).toFixed(1),1)+" mile"}return Math.round(t)+" ft"}if(e>1e3){return Math.pow(+(e/1e3).toFixed(1),1)+" km"}return e+" m"}verifyPlaceLatLng(e){return!!e.placeId||this.verifyLatLng(e)}adjustMap(){"search"==this._useMapFor?(this.setCenterFromModel(),this.setMapOptionsForSearchUse()):(this.setMapOptionsForDirectionUse(),this.setRecordsFromModel(this.componentconfig.focusColor))}setRecordsFromModel(e){this.records=[{id:this.model.id,module:this.model.module,title:""+this.model.getField("summary_text"),lng:+this.model.getField(this.lngName),lat:+this.model.getField(this.latName),color:e}],this.cdRef.detectChanges()}setMapOptionsForSearchUse(){this.mapOptions={showCluster:this.componentconfig.showCluster,markerWithModelPopover:this.componentconfig.markerWithModelPopover,popoverComponent:this.componentconfig.popoverComponent,focusColor:this.componentconfig.focusColor,circle:this.mapOptions.circle,changed:{showCluster:!0,markerWithModelPopover:!0,circle:!0}},this.cdRef.detectChanges()}setMapOptionsForDirectionUse(){this.mapOptions={showCluster:!1,markerWithModelPopover:!1,circle:void 0,directionTravelMode:this.componentconfig.directionTravelMode,unitSystem:this.unitSystem,changed:{showCluster:!0,markerWithModelPopover:!0,circle:!0,directionTravelMode:!0,unitSystem:!0}},this.cdRef.detectChanges()}setCenterFromModel(){this.mapOptions.circle={center:{lng:+this.model.getField(this.lngName),lat:+this.model.getField(this.latName)},radius:void 0,radiusPercentage:this.componentconfig.radiusPercentage,color:this.componentconfig.circleColor,editable:!0},this.verifyLatLng(this.mapOptions.circle.center)||(this.mapOptions.circle=void 0)}setMapRoute(e){const t=this.buildRoute(e);if(!this.verifyPlaceLatLng(t[0])||!this.verifyPlaceLatLng(t[1]))return this.isLoadingDirection=!1;this.routes=[t],this.cdRef.detectChanges()}defineMapRouteFromSearchAddress(e){if("address"!=this.directionStartType)return;this.isLoadingDirection=!0;const t={lat:e.latitude,lng:e.longitude};this.setMapRoute(t)}defineMapRouteFromUserAddress(){this.isLoadingDirection=!0,this.backend.get("Users",this.session.authData.userId,"details").subscribe((e=>{if(!(e&&e.address_street&&e.address_postalcode&&e.address_city))return this.toast.sendToast(this.language.getLabel("MSG_NO_OFFICE_ADDRESSE_DEFINED"),"error"),this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges();const t=`${e.address_street}, ${e.address_postalcode} ${e.address_city}, ${e.address_country}`;this.backend.getRequest(`channels/groupware/gsuite/places/autocomplete/${encodeURIComponent(t)}`).subscribe((e=>{if(e.predictions&&e.predictions.length>0){const t={placeId:e.predictions[0].place_id};this.setMapRoute(t)}else this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges()}))}))}defineMapRouteFromMyLocation(){navigator.geolocation&&(this.isLoadingDirection=!0,navigator.geolocation.getCurrentPosition((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};this.setMapRoute(t)}),(()=>{this.routes=[],this.isLoadingDirection=!1,this.cdRef.detectChanges()})))}buildRoute(e){return[e,{lat:+this.model.getField(this.latName),lng:+this.model.getField(this.lngName)}]}triggerSearch(){this.zone.run((()=>{this.modelList.searchTerm=this.listSearchTerm,this.modelList.reLoadList()}))}setDirectionResult(e){this.isLoadingDirection=!1,this.directionResult=e,this.cdRef.detectChanges()}toggleFullScreen(e){this.zone.runOutsideAngular((()=>{if(document.onfullscreenchange=()=>{this.isFullScreenOn=!!document.fullscreenElement,this.cdRef.detectChanges()},this.isFullScreenOn){const e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}else e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}))}onRangeMouseDown(e){const t=this.renderer.listen(e,"mouseup",(()=>{this.setMapOptionChanged("circleRadius"),t()}))}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMapsRecord)(d.rXU(h.B),d.rXU(O.K),d.rXU(f.yu),d.rXU(u.H),d.rXU(d._q3),d.rXU(d.gRc),d.rXU(d.SKi),d.rXU(oe.d),d.rXU(g.g),d.rXU(d.aKT),d.rXU(d.sFG),d.rXU(B.m),d.rXU(T.L),d.rXU(Y.o),d.rXU(ne.S))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMapsRecord,selectors:[["spice-google-maps-record"]],inputs:{autoMapHeight:"autoMapHeight",applyUseMapOptions:[d.Mj6.None,"useMapOptions","applyUseMapOptions"]},features:[d.Vt3],decls:18,vars:17,consts:[[1,"slds-grid","slds-grid--vertical","slds-theme--default","slds-height_full",2,"width","100%"],["mainContainer",""],[1,"slds-grid","slds-p-bottom--x-small"],["class","slds-m-right--x-small",3,"ngModel","disabled","inputOptions","ngModelChange",4,"ngIf"],["class","slds-form-element slds-grid slds-grid--vertical-align-center slds-grow",4,"ngIf","ngIfElse"],["directionToolsContainer",""],["system-title","LBL_FULL_SCREEN",1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-left--xx-small","slds-m-right--xxx-small","slds-col--bump-left",3,"click"],[3,"icon"],[1,"slds-grid","slds-theme--shade","slds-p-around--xx-small","slds-border--bottom","slds-border--top","slds-border--left","slds-border--right"],["class","slds-grid slds-grid--vertical-align-center",4,"ngIf","ngIfElse"],["directionInfoContainer",""],[1,"slds-border--left","slds-border--right","slds-border--bottom","slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0",3,"system-overlay-loading-spinner"],[2,"display","block",3,"focusedRecordId","options","records","routes","radiusChange","directionChange"],["style","display: block; height: 250px; min-height: 250px; max-height: 500px",4,"ngIf"],["class","slds-is-absolute slds-panel slds-panel--filters slds-filters__body slds-nowrap  slds-scrollable--y","style","width: 320px; height: 100%; top:0; right: 0;z-index: 99;",3,"system-model-provider",4,"ngIf"],[1,"slds-m-right--x-small",3,"ngModel","disabled","inputOptions","ngModelChange"],[1,"slds-form-element","slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["icon","search","size","x-small","addclasses","slds-input__icon"],["type","text","autocomplete","off",1,"slds-input",3,"ngModel","placeholder","ngModelChange","keyup.enter"],[1,"slds-button","slds-button--neutral","slds-button--icon-border","slds-m-left--xx-small","slds-m-right--xxx-small",3,"click"],[1,"slds-grid","slds-grow","slds-grid--vertical-align-center"],[1,"slds-grow"],[3,"disabled","address"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-left--x-small","slds-truncate"],["label","MSG_RECORDS_FOUND_WITH_GEO_DATA"],["class","slds-text-link slds-m-left--x-small",3,"click",4,"ngIf"],["class","slds-grid slds-grow",4,"ngIf"],[1,"slds-text-link","slds-m-left--x-small",3,"click"],["label","LBL_MORE"],[1,"slds-grid","slds-grow"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grow"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange","mousedown"],["inputRangeElement",""],["type","number",1,"slds-input",2,"width","40px","padding",".3rem","height","32px","min-height","32px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],["size","x-small",1,"slds-m-right--x-small",3,"icon"],[4,"ngIf","ngIfElse"],["infoTextContainer",""],[1,"slds-truncate"],["label","MSG_SELECT_DIRECTION_TYPE"],[2,"display","block","height","250px","min-height","250px","max-height","500px"],[1,"slds-is-absolute","slds-panel","slds-panel--filters","slds-filters__body","slds-nowrap","slds-scrollable--y",2,"width","320px","height","100%","top","0","right","0","z-index","99",3,"system-model-provider"],[1,"slds-filters__body","slds-grid_vertical"],["class","slds-m-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-m-vertical--xx-small"],[3,"aggregate"]],template:function(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",0,1)(2,"div")(3,"div",2),d.DNE(4,ae,1,3,"system-input-radio-button-group",3)(5,ce,8,3,"div",4)(6,de,4,4,"ng-template",null,5,d.C5r),d.j41(8,"button",6),d.bIt("click",(function(){d.eBV(e);const s=d.sdS(1);return d.Njj(t.toggleFullScreen(s))})),d.nrm(9,"system-button-icon",7),d.k0s()(),d.j41(10,"div",8),d.DNE(11,pe,7,3,"div",9)(12,fe,4,3,"ng-template",null,10,d.C5r),d.k0s()(),d.j41(14,"div",11)(15,"spice-google-maps",12),d.bIt("radiusChange",(function(e){return t.onRadiusChange(e)}))("directionChange",(function(e){return t.setDirectionResult(e)})),d.k0s(),d.DNE(16,Me,1,0,"object-list",13)(17,ve,3,5,"div",14),d.k0s()()}if(2&e){const e=d.sdS(7),s=d.sdS(13);d.R7$(3),d.AVh("slds-p-around--x-small",t.isFullScreenOn),d.R7$(),d.Y8G("ngIf",t.showUseMapOptions),d.R7$(),d.Y8G("ngIf","search"==t.useMapFor)("ngIfElse",e),d.R7$(4),d.Y8G("icon",t.isFullScreenOn?"contract":"expand"),d.R7$(2),d.Y8G("ngIf","search"==t.useMapFor)("ngIfElse",s),d.R7$(3),d.Y8G("system-overlay-loading-spinner",t.isLoading||t.isLoadingDirection),d.R7$(),d.xc7("height",t.mapHeight),d.Y8G("focusedRecordId",t.focusedRecordId)("options",t.mapOptions)("records",t.records)("routes",t.routes),d.R7$(),d.Y8G("ngIf","search"==t.useMapFor),d.R7$(),d.Y8G("ngIf",t.modelList.displayAggregates)}},dependencies:[i.Sq,i.bT,o.me,o.Q0,o.MR,o.BC,o.vS,X.Y,S.f,U.q,G.f,F.S,x.t,re.Z,le.s,b.W,j.B,A.v,$.M,V.L,H],encapsulation:2,changeDetection:0})}return SpiceGoogleMapsRecord})();function ke(e,t){if(1&e&&(d.qex(0),d.nrm(1,"spice-google-maps-record",2),d.bVm()),2&e){const e=d.XpG();d.R7$(),d.Y8G("componentconfig",e.componentconfig)}}function Le(e,t){1&e&&(d.j41(0,"div",3)(1,"system-illustration-no-data"),d.nrm(2,"system-label",4),d.k0s()())}let ye=(()=>{class SpiceGoogleMapsRecordContainer{constructor(e,t,s,i,o){this.model=e,this.cdRef=t,this.broadcast=s,this.modelList=i,this.metadata=o,this.subscription=new I.yU,this.hasGeoData=!1}ngOnInit(){this.modelList.cancelPendingRequests=!1,this.initializeModelList(),this.loadComponentConfigs(),this.subscribeToModelChanges(),this.checkModelHasGeoData()}ngOnDestroy(){this.subscription.unsubscribe()}verifyLatLng(e){return!(!e.lng||isNaN(e.lng)||!e.lat||isNaN(e.lat))}initializeModelList(){this.modelList.useCache=!1,this.modelList.initialize(this.model.module,"SpiceGoogleMapsRecordContainer")}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsRecordContainer",this.model.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.radiusPercentage&&!isNaN(this.componentconfig.radiusPercentage)||(this.componentconfig.radiusPercentage=80),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.mapHeight||(this.componentconfig.mapHeight=500),this.componentconfig.circleColor||(this.componentconfig.circleColor="#CA1B21"),this.componentconfig.filterCircleColor||(this.componentconfig.filterCircleColor="#1A73E8"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8")}subscribeToModelChanges(){this.subscription=this.broadcast.message$.subscribe((e=>{"model.save"==e.messagetype&&e.messagedata.module===this.model.module&&this.checkModelHasGeoData()}))}checkModelHasGeoData(){const e=this.metadata.getModuleDefs(this.model.module);if(e&&e.ftsgeo){const t=e.ftsgeo.longitude_field,s=e.ftsgeo.latitude_field;this.hasGeoData=this.verifyLatLng({lat:this.model.getField(s),lng:this.model.getField(t)})}else this.hasGeoData=!1;this.cdRef.detectChanges()}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMapsRecordContainer)(d.rXU(g.g),d.rXU(d.gRc),d.rXU(B.m),d.rXU(O.K),d.rXU(f.yu))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMapsRecordContainer,selectors:[["spice-google-maps-record-container"]],features:[d.Jv_([O.K])],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["hasNoGeoDataContainer",""],[3,"componentconfig"],[1,"slds-grid","slds-grid_vertical-align-center","slds-height_full","slds-grid--align-center","slds-p-around--large"],["label","MSG_RECORD_HAS_NO_GEO_DATA"]],template:function(e,t){if(1&e&&d.DNE(0,ke,2,1,"ng-container",0)(1,Le,3,0,"ng-template",null,1,d.C5r),2&e){const e=d.sdS(2);d.Y8G("ngIf",t.hasGeoData)("ngIfElse",e)}},dependencies:[i.bT,ie.L,b.W,Re],encapsulation:2,changeDetection:0})}return SpiceGoogleMapsRecordContainer})();var Ie=s(38045),Oe=s(40713),Se=s(25028),_e=s(88418),Ge=s(83524);const Fe=["mapelement"],xe=["headerinput"];let we=(()=>{class SpiceMapSelector{constructor(e,t,s,i){this.zone=e,this.language=t,this.metadata=s,this.libloader=i,this.map={},this.circle={},this._radius=10,this.searchterm="",this.geoSearchemitter=new d.bkB}get radius(){return this._radius?this._radius:10}set radius(e){this._radius=e,this.circle&&this.circle.setRadius(1e3*this._radius)}ngAfterViewInit(){this.libloader.loadLib("maps.googleapis").subscribe((e=>{this.lat||this.lng?this.renderMap():navigator.geolocation.getCurrentPosition((e=>{this.lat=e.coords.latitude,this.lng=e.coords.longitude,this.renderMap(),this.reverseGeoCode()}),(()=>{this.renderMap()}))}))}renderMap(){let e={lat:this.lat,lng:this.lng};this.map=new google.maps.Map(this.mapelement.element.nativeElement,{center:e,scrollwheel:!0,streetViewControl:!1,zoom:11,minZoom:8}),this.circle=new google.maps.Circle({strokeColor:"red",fillColor:"#dddddd",fillOpacity:.5,strokeWeight:2,clickable:!0,draggable:!0,editable:!0,zIndex:1,map:this.map,center:e,radius:1e3*this._radius}),google.maps.event.addListener(this.circle,"center_changed",(()=>{this.lat!=this.circle.getCenter().lat()&&this.lng!=this.circle.getCenter().lng()&&(this.lat=this.circle.getCenter().lat(),this.lng=this.circle.getCenter().lng(),this.reverseGeoCode())})),google.maps.event.addListener(this.circle,"radius_changed",(()=>{this._radius=Math.round(this.circle.getRadius()/100)/10})),this.reverseGeoCode()}reverseGeoCode(){(new google.maps.Geocoder).geocode({location:{lat:this.lat,lng:this.lng}},((e,t)=>{this.address=e[0].formatted_address}))}close(){this.self.destroy()}set(){this.geoSearchemitter.emit({radius:this._radius,lat:this.lat,lng:this.lng,address:this.address}),this.close()}clear(){this.geoSearchemitter.emit(!1),this.close()}setDetails(e){this.lat=e.address.latitude,this.lng=e.address.longitude,this.address=[e.name,e.formatted_address].join(", "),this.map.setCenter({lat:e.address.latitude,lng:e.address.longitude}),this.circle.setCenter({lat:e.address.latitude,lng:e.address.longitude})}get mapStyle(){this.headerinput.element.nativeElement.getBoundingClientRect();return{width:"100%",height:"calc(100% - "+this.headerinput.element.nativeElement.getBoundingClientRect().height+"px)"}}static#e=this.ɵfac=function(e){return new(e||SpiceMapSelector)(d.rXU(d.SKi),d.rXU(h.B),d.rXU(f.yu),d.rXU(M.b))};static#t=this.ɵcmp=d.VBU({type:SpiceMapSelector,selectors:[["spice-map-selector"]],viewQuery:function(e,t){if(1&e&&(d.GBs(Fe,7,d.c1b),d.GBs(xe,7,d.c1b)),2&e){let e;d.mGM(e=d.lsd())&&(t.mapelement=e.first),d.mGM(e=d.lsd())&&(t.headerinput=e.first)}},decls:22,vars:6,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--x-small"],["headerinput",""],[1,"slds-size--2-of-3",3,"ngModel","ngModelChange","details"],[1,"slds-grid","slds-grid_vertical-align-center","slds-size--1-of-3","slds-p-left--x-small"],[1,"slds-slider","slds-p-horizontal--x-small","slds-grow"],["type","range","min","0","max","100",1,"slds-slider__range",3,"ngModel","ngModelChange"],["type","number",1,"slds-input",2,"width","60px",3,"ngModel","ngModelChange"],[1,"slds-p-horizontal--x-small"],[3,"ngStyle"],["mapelement",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CLEAR"],["label","LBL_SET"],["label","LBL_CLOSE"]],template:function(e,t){1&e&&(d.j41(0,"system-modal",0)(1,"system-modal-header",1),d.bIt("close",(function(){return t.close()})),d.k0s(),d.j41(2,"system-modal-content",2)(3,"div",3,4)(5,"system-googleplaces-search",5),d.mxI("ngModelChange",(function(e){return d.DH7(t.searchterm,e)||(t.searchterm=e),e})),d.bIt("details",(function(e){return t.setDetails(e)})),d.k0s(),d.j41(6,"div",6)(7,"div",7)(8,"input",8),d.mxI("ngModelChange",(function(e){return d.DH7(t.radius,e)||(t.radius=e),e})),d.k0s()(),d.j41(9,"input",9),d.mxI("ngModelChange",(function(e){return d.DH7(t.radius,e)||(t.radius=e),e})),d.k0s(),d.j41(10,"span",10),d.EFF(11,"km"),d.k0s()()(),d.nrm(12,"div",11,12),d.k0s(),d.j41(14,"system-modal-footer"),d.EFF(15),d.j41(16,"button",13),d.bIt("click",(function(){return t.clear()})),d.nrm(17,"system-label",14),d.k0s(),d.j41(18,"button",13),d.bIt("click",(function(){return t.set()})),d.nrm(19,"system-label",15),d.k0s(),d.j41(20,"button",13),d.bIt("click",(function(){return t.close()})),d.nrm(21,"system-label",16),d.k0s()()()),2&e&&(d.R7$(2),d.Y8G("grow",!0),d.R7$(3),d.R50("ngModel",t.searchterm),d.R7$(3),d.R50("ngModel",t.radius),d.R7$(),d.R50("ngModel",t.radius),d.R7$(3),d.Y8G("ngStyle",t.mapStyle),d.R7$(3),d.SpI(" ",t.address," "))},dependencies:[i.B3,o.me,o.Q0,o.MR,o.BC,o.vS,Ie.P,b.W,Oe.D,Se.I,_e.Q,Ge.C],encapsulation:2})}return SpiceMapSelector})();var De=s(50531);function je(e,t){if(1&e){const e=d.RV6();d.j41(0,"div",1)(1,"button",2),d.bIt("click",(function(){d.eBV(e);const t=d.XpG();return d.Njj(t.emitBroadcastMessage())})),d.nrm(2,"system-button-icon",3),d.k0s(),d.j41(3,"button",4),d.bIt("click",(function(){d.eBV(e);const t=d.XpG();return d.Njj(t.openDirectionModal())})),d.nrm(4,"system-button-icon",5),d.k0s()()}}let Ne=(()=>{class SpiceMapGeoDataField{constructor(e,t,s,i,o,n,r){this.model=e,this.metadata=t,this.navigation=s,this.broadcast=i,this.modal=o,this.injector=n,this.cdRef=r,this.hasGeoData=!1}ngOnInit(){this.checkModelGeoData()}setHasGeoData(){this.hasGeoData=!0,this.cdRef.detectChanges()}emitBroadcastMessage(){const e={tabId:this.navigation.activeTabObject.id,record:this.model.data};this.broadcast.broadcastMessage("map.focus",e)}checkModelGeoData(){const e=this.metadata.getModuleDefs(this.model.module);if(e&&e.ftsgeo){const t=this.model.getField(e.ftsgeo.longitude_field),s=this.model.getField(e.ftsgeo.latitude_field);t&&!isNaN(t)&&s&&!isNaN(s)?this.setHasGeoData():this.cdRef.detach()}}openDirectionModal(){this.modal.openModal("SpiceGoogleMapsDirectionModal",!0,this.injector)}static#e=this.ɵfac=function(e){return new(e||SpiceMapGeoDataField)(d.rXU(g.g),d.rXU(f.yu),d.rXU(T.L),d.rXU(B.m),d.rXU(De.y),d.rXU(d.zZn),d.rXU(d.gRc))};static#t=this.ɵcmp=d.VBU({type:SpiceMapGeoDataField,selectors:[["spice-map-geo-data-field"]],decls:1,vars:1,consts:[["class","slds-button-group",4,"ngIf"],[1,"slds-button-group"],["system-title","LBL_GEO_DATA",1,"slds-button","slds-button--icon-border-filled","slds-button-group-item",2,"height","24px","width","24px",3,"click"],["icon","world","size","medium"],["system-title","LBL_ROUTE_PLANNER",1,"slds-button","slds-button--icon-border-filled","slds-button-group-item",2,"height","24px","width","24px",3,"click"],["icon","travel_and_places","size","medium"]],template:function(e,t){1&e&&d.DNE(0,je,5,0,"div",0),2&e&&d.Y8G("ngIf",t.hasGeoData)},dependencies:[i.bT,x.t,V.L],encapsulation:2,changeDetection:0})}return SpiceMapGeoDataField})(),Ee=(()=>{class SpiceGoogleMapsDirectionModal{constructor(e,t,s){this.cdRef=e,this.metadata=t,this.model=s,this.self={},this.useMapOptions={direction:!0,search:!1}}ngOnInit(){this.loadComponentConfigs()}loadComponentConfigs(){this.componentconfig||(this.componentconfig=this.metadata.getComponentConfig("SpiceGoogleMapsDirectionModal",this.model.module)),this.componentconfig||(this.componentconfig={}),this.componentconfig.directionTravelMode&&-1!=["DRIVING","WALKING","TRANSIT","BICYCLING"].indexOf(this.componentconfig.directionTravelMode)||(this.componentconfig.directionTravelMode="DRIVING"),this.componentconfig.focusColor||(this.componentconfig.focusColor="#1A73E8")}close(){this.cdRef.detach(),this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||SpiceGoogleMapsDirectionModal)(d.rXU(d.gRc),d.rXU(f.yu),d.rXU(g.g))};static#t=this.ɵcmp=d.VBU({type:SpiceGoogleMapsDirectionModal,selectors:[["spice-google-maps-direction-modal"]],decls:8,vars:4,consts:[[3,"close"],["label","LBL_DIRECTION"],[3,"grow"],[3,"componentconfig","autoMapHeight","useMapOptions"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"]],template:function(e,t){1&e&&(d.j41(0,"system-modal")(1,"system-modal-header",0),d.bIt("close",(function(){return t.self.destroy()})),d.nrm(2,"system-label",1),d.k0s(),d.j41(3,"system-modal-content",2),d.nrm(4,"spice-google-maps-record",3),d.k0s(),d.j41(5,"system-modal-footer")(6,"button",4),d.bIt("click",(function(){return t.close()})),d.nrm(7,"system-label",5),d.k0s()()()),2&e&&(d.R7$(3),d.Y8G("grow",!0),d.R7$(),d.Y8G("componentconfig",t.componentconfig)("autoMapHeight",!0)("useMapOptions",t.useMapOptions))},dependencies:[b.W,Oe.D,Se.I,_e.Q,Ge.C,Re],encapsulation:2,changeDetection:0})}return SpiceGoogleMapsDirectionModal})(),Te=(()=>{class ModuleSpiceMap{static#e=this.ɵfac=function(e){return new(e||ModuleSpiceMap)};static#t=this.ɵmod=d.$C({type:ModuleSpiceMap});static#s=this.ɵinj=d.G2t({imports:[i.MD,o.YN,r.ObjectFields,l.GlobalComponents,a.ObjectComponents,c.SystemComponents,n.h]})}return ModuleSpiceMap})();("undefined"==typeof ngJitMode||ngJitMode)&&d.Obh(Te,{declarations:[y,E,se,ye,Re,H,we,Ne,Ee],imports:[i.MD,o.YN,r.ObjectFields,l.GlobalComponents,a.ObjectComponents,c.SystemComponents,n.h],exports:[H,Ne,Re]})}}]);