/*!
 * 
 *                     aacService
 *
 *                     release: 2022.02.001
 *
 *                     date: 2022-09-03 11:05:02
 *
 *                     build: 2022.02.001.1662195902704
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_campaigns_modulecampaigns_ts"],{2133:(t,e,s)=>{s.r(e),s.d(e,{ModuleCampaigns:()=>rt});var i=s(6895),a=s(433),l=s(3121),n=s(3283),d=s(4518),o=s(5478),c=s(1571),r=s(5329),m=s(4154),p=s(5710),u=s(3278),g=s(4505),h=s(3463),b=s(4664);function f(t,e){1&t&&(c.TgZ(0,"div",3),c._UZ(1,"system-spinner",4),c.qZA()),2&t&&(c.xp6(1),c.Q6J("size",12))}let T=(()=>{class CampaignTaskActivateButton{constructor(t,e,s,i,a){this.language=t,this.metadata=e,this.model=s,this.toast=i,this.backend=a,this.activating=!1,this.disabled=!0,this.model.mode$.subscribe((t=>{this.handleDisabled()})),this.model.data$.subscribe((t=>{this.handleDisabled()}))}get hidden(){return"Email"==this.model.getField("campaigntask_type")}handleDisabled(){"Email"!=this.model.getFieldValue("campaigntask_type")?this.model.getFieldValue("activated")?this.disabled=!0:this.disabled=!(!this.model.isEditing&&!0!==this.model.getField("activated")):this.disabled=!0}execute(){this.activating||(this.activating=!0,this.backend.postRequest(`module/CampaignTasks/${this.model.id}/activate`).subscribe((t=>{this.activating=!1,t.success?(this.toast.sendToast("Activated"),this.model.setField("activated",!0)):this.toast.sendToast("Error")})))}}return CampaignTaskActivateButton.ɵfac=function(t){return new(t||CampaignTaskActivateButton)(c.Y36(r.d),c.Y36(m.Pu),c.Y36(p.o),c.Y36(u.A),c.Y36(g.y))},CampaignTaskActivateButton.ɵcmp=c.Xpm({type:CampaignTaskActivateButton,selectors:[["ng-component"]],decls:4,vars:1,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],["class","slds-p-right--x-small",4,"ngIf"],["label","LBL_ACTIVATE"],[1,"slds-p-right--x-small"],[3,"size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.YNc(1,f,2,1,"div",1),c.TgZ(2,"span"),c._UZ(3,"system-label",2),c.qZA()()),2&t&&(c.xp6(1),c.Q6J("ngIf",e.activating))},dependencies:[i.O5,h._,b.W],encapsulation:2}),CampaignTaskActivateButton})();var _=s(1481);function y(t,e){1&t&&(c.TgZ(0,"div",3),c._UZ(1,"system-spinner",4),c.qZA()),2&t&&(c.xp6(1),c.Q6J("size",12))}let x=(()=>{class CampaignTaskExportButton{constructor(t,e,s,i,a,l){this.language=t,this.metadata=e,this.model=s,this.toast=i,this.backend=a,this.domsanitizer=l,this.exporting=!1,this.disabled=!0,this.model.mode$.subscribe((t=>{this.handleDisabled()})),this.model.data$.subscribe((t=>{this.handleDisabled()}))}get hidden(){return"Email"==this.model.getField("campaigntask_type")}handleDisabled(){this.model.getFieldValue("activated")?this.disabled=!0:this.disabled=!!this.model.isEditing}execute(){this.exporting||(this.exporting=!0,this.backend.getDownloadPostRequestFile(`/module/CampaignTasks/${this.model.id}/export`,{}).subscribe((t=>{let e=document.createElement("a");e.href=t,e.setAttribute("download",this.model.getField("name").replace(" ","_")+"_"+moment().format("YYYY_MM_DD_HH_mm_ss")+".csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e),this.exporting=!1})))}}return CampaignTaskExportButton.ɵfac=function(t){return new(t||CampaignTaskExportButton)(c.Y36(r.d),c.Y36(m.Pu),c.Y36(p.o),c.Y36(u.A),c.Y36(g.y),c.Y36(_.H7))},CampaignTaskExportButton.ɵcmp=c.Xpm({type:CampaignTaskExportButton,selectors:[["ng-component"]],decls:4,vars:1,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],["class","slds-p-right--x-small",4,"ngIf"],["label","LBL_EXPORT"],[1,"slds-p-right--x-small"],[3,"size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.YNc(1,y,2,1,"div",1),c.TgZ(2,"span"),c._UZ(3,"system-label",2),c.qZA()()),2&t&&(c.xp6(1),c.Q6J("ngIf",e.exporting))},dependencies:[i.O5,h._,b.W],encapsulation:2}),CampaignTaskExportButton})();var C=s(4561);function v(t,e){1&t&&c._UZ(0,"system-icon",5),2&t&&c.Q6J("sprite","utility")("icon","email")("size","xx-small")("addclasses","")}function M(t,e){1&t&&c._UZ(0,"system-spinner",6),2&t&&c.Q6J("size",10)("border",1)}let k=(()=>{class CampaignSendMailButton{constructor(t,e,s,i){this.language=t,this.model=e,this.backend=s,this.toast=i,this.sending=!1,this.disabled=!0,this.model.mode$.subscribe((t=>{this.handleDisabled()})),this.model.data$.subscribe((t=>{this.handleDisabled()}))}execute(){this.sending||(this.sending=!0,this.backend.postRequest(`module/CampaignTasks/${this.model.id}/queuemail`).subscribe((t=>{this.sending=!1,this.toast.sendToast("Mails queued"),this.model.setField("activated",!0)})))}get hidden(){return"Email"!==this.model.getField("campaigntask_type")}handleDisabled(){this.model.getField("activated")?this.disabled=!0:this.model.checkAccess("edit")&&"Email"===this.model.getField("campaigntask_type")&&this.model.getField("mailbox_id")?this.disabled=!!this.model.isEditing:this.disabled=!0}}return CampaignSendMailButton.ɵfac=function(t){return new(t||CampaignSendMailButton)(c.Y36(r.d),c.Y36(p.o),c.Y36(g.y),c.Y36(u.A))},CampaignSendMailButton.ɵcmp=c.Xpm({type:CampaignSendMailButton,selectors:[["campaign-send-mail-button"]],decls:6,vars:2,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],[2,"min-width","26px"],[3,"sprite","icon","size","addclasses",4,"ngIf"],[3,"size","border",4,"ngIf"],["label","LBL_QUEUE"],[3,"sprite","icon","size","addclasses"],[3,"size","border"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0)(1,"div",1),c.YNc(2,v,1,4,"system-icon",2),c.YNc(3,M,1,2,"system-spinner",3),c.qZA(),c.TgZ(4,"span"),c._UZ(5,"system-label",4),c.qZA()()),2&t&&(c.xp6(2),c.Q6J("ngIf",!e.sending),c.xp6(1),c.Q6J("ngIf",e.sending))},dependencies:[i.O5,C.f,h._,b.W],encapsulation:2}),CampaignSendMailButton})();var Z=s(4044);function L(t,e){1&t&&c._UZ(0,"system-icon",5),2&t&&c.Q6J("sprite","utility")("icon","email")("size","xx-small")("addclasses","")}function A(t,e){1&t&&c._UZ(0,"system-spinner",6),2&t&&c.Q6J("size",10)("border",1)}let E=(()=>{class CampaignSendTestMailButton{constructor(t,e,s,i,a){this.language=t,this.model=e,this.modal=s,this.backend=i,this.toast=a,this.sending=!1,this.disabled=!0,this.model.mode$.subscribe((t=>{this.handleDisabled()})),this.model.data$.subscribe((t=>{this.handleDisabled()}))}execute(){let t=this.modal.await("LBL_SENDING");this.sending||(this.sending=!0,this.backend.postRequest(`module/CampaignTasks/${this.model.id}/sendtestmail`).subscribe((e=>{this.sending=!1,t.emit(!0),"success"==e.status?this.toast.sendToast("Mails sent"):this.toast.sendToast(e.msg,"error")}),(e=>{t.emit(!0),this.sending=!1,this.toast.sendToast("ERROR")})))}get hidden(){return"Email"!==this.model.getField("campaigntask_type")}handleDisabled(){this.model.getField("activated")?this.disabled=!0:this.model.checkAccess("edit")&&"Email"===this.model.getField("campaigntask_type")&&this.model.getField("mailbox_id")?this.disabled=!!this.model.isEditing:this.disabled=!0}}return CampaignSendTestMailButton.ɵfac=function(t){return new(t||CampaignSendTestMailButton)(c.Y36(r.d),c.Y36(p.o),c.Y36(Z.o),c.Y36(g.y),c.Y36(u.A))},CampaignSendTestMailButton.ɵcmp=c.Xpm({type:CampaignSendTestMailButton,selectors:[["campaign-send-test-mail-button"]],decls:6,vars:2,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],[2,"min-width","26px"],[3,"sprite","icon","size","addclasses",4,"ngIf"],[3,"size","border",4,"ngIf"],["label","LBL_TEST"],[3,"sprite","icon","size","addclasses"],[3,"size","border"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0)(1,"div",1),c.YNc(2,L,1,4,"system-icon",2),c.YNc(3,A,1,2,"system-spinner",3),c.qZA(),c.TgZ(4,"span"),c._UZ(5,"system-label",4),c.qZA()()),2&t&&(c.xp6(2),c.Q6J("ngIf",!e.sending),c.xp6(1),c.Q6J("ngIf",e.sending))},dependencies:[i.O5,C.f,h._,b.W],encapsulation:2}),CampaignSendTestMailButton})(),B=(()=>{class CampaignExportButton{constructor(t,e,s,i){this.language=t,this.model=e,this.injector=s,this.modal=i}execute(){this.modal.openModal("CampaignExportModal",!0,this.injector)}}return CampaignExportButton.ɵfac=function(t){return new(t||CampaignExportButton)(c.Y36(r.d),c.Y36(p.o),c.Y36(c.zs3),c.Y36(Z.o))},CampaignExportButton.ɵcmp=c.Xpm({type:CampaignExportButton,selectors:[["campaign-export-button"]],decls:2,vars:0,consts:[["label","LBL_EXPORT"]],template:function(t,e){1&t&&(c.TgZ(0,"span"),c._UZ(1,"system-label",0),c.qZA())},dependencies:[h._],encapsulation:2}),CampaignExportButton})();var Y=s(2656),w=s(9621),U=s(3499),J=s(5767),z=s(1916);function I(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"div",9)(1,"div",10),c._uU(2),c.qZA(),c.TgZ(3,"button",11),c.NdJ("click",(function(){const e=c.CHM(t).$implicit,s=c.oxw();return c.KtG(s.downloadXLS(e.id))})),c._UZ(4,"system-button-icon",12),c._uU(5,"xls "),c.qZA(),c.TgZ(6,"button",11),c.NdJ("click",(function(){const e=c.CHM(t).$implicit,s=c.oxw();return c.KtG(s.downloadCSV(e.id))})),c._UZ(7,"system-button-icon",12),c._uU(8,"csv "),c.qZA()()}if(2&t){const t=e.$implicit;c.xp6(2),c.Oqu(t.name),c.xp6(1),c.Q6J("disabled",!t.xls),c.xp6(3),c.Q6J("disabled",!t.csv)}}let N=(()=>{class CampaignExportModal{constructor(t,e,s,i){this.language=t,this.model=e,this.backend=s,this.modal=i,this.exportReports=[],this.backend.getRequest("module/CampaignTasks/export/reports").subscribe((t=>{this.exportReports=t}))}close(){this.self.destroy()}downloadCSV(t){let e=this.modal.await(this.language.getLabel("LBL_DOWNLOADING"));this.backend.getDownloadPostRequestFile("module/KReports/plugins/action/kcsvexport/export",{record:t,parentbeanId:this.model.id,parentbeanModule:this.model.module}).subscribe((t=>{this.downloadURL(t,"csv"),e.emit(!0),this.close()}),(t=>{e.emit(!0)}))}downloadXLS(t){let e=this.modal.await(this.language.getLabel("LBL_DOWNLOADING"));this.backend.getDownloadPostRequestFile("module/KReports/plugins/action/kexcelexport/export",{record:t,parentbeanId:this.model.id,parentbeanModule:this.model.module}).subscribe((t=>{this.downloadURL(t,"xlsx"),e.emit(!0),this.close()}),(t=>{e.emit(!0)}))}downloadURL(t,e){let s=document.createElement("a");s.href=t,s.setAttribute("download",this.model.getField("name").replace(" ","_")+"_"+moment().format("YYYY_MM_DD_HH_mm_ss")+"."+e),document.body.appendChild(s),s.click(),document.body.removeChild(s)}}return CampaignExportModal.ɵfac=function(t){return new(t||CampaignExportModal)(c.Y36(r.d),c.Y36(p.o),c.Y36(g.y),c.Y36(Z.o))},CampaignExportModal.ɵcmp=c.Xpm({type:CampaignExportModal,selectors:[["ng-component"]],decls:10,vars:1,consts:[["size","small"],[3,"close"],["label","LBL_EXPORT"],["label","LBL_CAMPAIGNTASK"],["margin","none"],[1,"slds-p-horizontal--small"],["class","slds-grid slds-grid--vertical-align-center slds-p-around--xx-small",4,"ngFor","ngForOf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small"],[1,"slds-grow"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","download"]],template:function(t,e){1&t&&(c.TgZ(0,"system-modal",0)(1,"system-modal-header",1),c.NdJ("close",(function(){return e.close()})),c._UZ(2,"system-label",2)(3,"system-label",3),c.qZA(),c.TgZ(4,"system-modal-content",4)(5,"div",5),c.YNc(6,I,9,3,"div",6),c.qZA()(),c.TgZ(7,"system-modal-footer")(8,"button",7),c.NdJ("click",(function(){return e.close()})),c._UZ(9,"system-label",8),c.qZA()()()),2&t&&(c.xp6(6),c.Q6J("ngForOf",e.exportReports))},dependencies:[i.sg,Y.J,h._,w.j,U.x,J.p,z.y],encapsulation:2}),CampaignExportModal})();var q=s(727),D=s(2294),F=s(3634);function O(t,e){if(1&t&&c._UZ(0,"iframe",19),2&t){const t=c.oxw(2);c.Q6J("srcdoc",t.sanitizedHTML,c.oJD)}}const R=function(){return{fieldtype:"mailboxes",scope:"outboundmass"}},S=function(){return{fieldtype:"html",asiframe:!0,simplemode:!0,height:"250px"}};function Q(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"div",1)(1,"ul",2)(2,"li",3),c.NdJ("click",(function(){c.CHM(t);const e=c.oxw();return c.KtG(e.setActiveTab("details"))})),c.TgZ(3,"a",4),c._UZ(4,"system-label",5),c.qZA()(),c.TgZ(5,"li",3),c.NdJ("click",(function(){c.CHM(t);const e=c.oxw();return c.KtG(e.setActiveTab("preview"))})),c.TgZ(6,"a",4),c._UZ(7,"system-label",6),c.qZA()()(),c.TgZ(8,"div",7)(9,"div",8),c._UZ(10,"field-container",9),c.TgZ(11,"div",10),c._UZ(12,"field-container",11),c.TgZ(13,"div",12)(14,"button",13),c.NdJ("click",(function(){c.CHM(t);const e=c.oxw();return c.KtG(e.copyFromTemplate())})),c._UZ(15,"system-button-icon",14)(16,"system-label",15),c.qZA()()(),c._UZ(17,"field-container",16),c.qZA(),c.TgZ(18,"div",17),c.YNc(19,O,1,1,"iframe",18),c.qZA()()()}if(2&t){const t=c.oxw();c.xp6(2),c.ekj("slds-active","details"==t.activeTab),c.xp6(3),c.ekj("slds-active","preview"==t.activeTab),c.xp6(4),c.ekj("slds-hide","details"!=t.activeTab),c.xp6(1),c.Q6J("fieldconfig",c.DdM(12,R)),c.xp6(4),c.Q6J("disabled",!t.view.isEditMode()),c.xp6(3),c.Q6J("fieldconfig",c.DdM(13,S)),c.xp6(1),c.ekj("slds-hide","preview"!=t.activeTab),c.xp6(1),c.Q6J("ngIf",t.sanitizedHTML)}}let j=(()=>{class CampaignTaskEmailPanel{constructor(t,e,s,i,a,l,n,d){this.language=t,this.model=e,this.injector=s,this.view=i,this.sanitizer=a,this.backend=l,this.metadata=n,this.modal=d,this.componentconfig={},this.activeTab="details",this.subscription=new q.w0}get hidden(){return this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}ngOnInit(){this.setInitialValues(),this.setSanitizedHTMLValue(),this.subscribeToModelChanges()}ngOnDestroy(){this.subscription.unsubscribe()}buildHtmlDom(t,e){return`<html lang="en">\n                    <head>\n                        <style>${e.stylesheet}</style>\n                    </head>\n                    <body>\n                        <div>${e.header}</div>\n                        <div>${t||""}</div> \n                        <div>${e.footer}</div>\n                    </body>\n                </html>`}setInitialValues(){this.emailBody=this.model.getField("email_body"),this.mailboxId=this.model.getField("mailbox_id")}subscribeToModelChanges(){this.subscription.add(this.model.data$.subscribe((t=>{t.mailbox_id!==this.mailboxId&&(this.mailboxId=t.mailbox_id,this.loadMailboxData()),t.email_body!==this.emailBody&&(this.emailBody=t.email_body,this.setSanitizedHTMLValue())})))}copyFromTemplate(){this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe((t=>{t.instance.module="EmailTemplates",t.instance.multiselect=!1,t.instance.selectedItems.subscribe((t=>{t.length&&(this.model.setField("email_subject",t[0].subject),this.model.setField("email_body",t[0].body_html),this.setSanitizedHTMLValue())}))}))}setActiveTab(t){this.activeTab=t}setSanitizedHTMLValue(){if(this.mailboxId){if(this.mailboxData){const t=this.buildHtmlDom(this.emailBody,this.mailboxData);this.sanitizedHTML=this.sanitizer.bypassSecurityTrustHtml(t)}}else this.sanitizedHTML=this.sanitizer.bypassSecurityTrustHtml(this.emailBody||"")}loadMailboxData(){this.mailboxId&&(this.mailboxData=void 0,this.backend.get("Mailboxes",this.mailboxId,"details").subscribe((t=>{t&&(this.mailboxData={header:t.mailbox_header||"",footer:t.mailbox_footer||"",stylesheet:this.metadata.getHtmlStylesheetCode(t.stylesheet)||""},this.setSanitizedHTMLValue())})))}}return CampaignTaskEmailPanel.ɵfac=function(t){return new(t||CampaignTaskEmailPanel)(c.Y36(r.d),c.Y36(p.o),c.Y36(c.zs3),c.Y36(D.e),c.Y36(_.H7),c.Y36(g.y),c.Y36(m.Pu),c.Y36(Z.o))},CampaignTaskEmailPanel.ɵcmp=c.Xpm({type:CampaignTaskEmailPanel,selectors:[["campaign-task-email-panel"]],decls:1,vars:1,consts:[["class","slds-tabs--default slds-grid slds-grid--vertical",4,"ngIf"],[1,"slds-tabs--default","slds-grid","slds-grid--vertical"],["role","tablist",1,"slds-tabs--default__nav"],["role","presentation",1,"slds-tabs--default__item","slds-text-title--caps",3,"click"],["href","javascript:void(0);","role","tab","aria-selected","false",1,"slds-tabs--default__link"],["label","LBL_DETAILS"],["label","LBL_PREVIEW"],[1,"slds-grow"],[1,"slds-p-around--x-small","slds-height_full"],["field","mailbox_id","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight",3,"fieldconfig"],[1,"slds-grid"],["field","email_subject","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight",1,"slds-grow"],[1,"slds-align-bottom","slds-col--bump-left","slds-m-left--small","slds-p-bottom--xx-small"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","copy","position","left"],["label","LBL_COPY_TEMPLATE"],["field","email_body","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight",3,"fieldconfig"],[1,"slds-height_full"],["class","slds-size--1-of-1","style","height: 400px; border: 0; resize: vertical;","sandbox","",3,"srcdoc",4,"ngIf"],["sandbox","",1,"slds-size--1-of-1",2,"height","400px","border","0","resize","vertical",3,"srcdoc"]],template:function(t,e){1&t&&c.YNc(0,Q,20,14,"div",0),2&t&&c.Q6J("ngIf",!e.hidden)},dependencies:[i.O5,F.j,Y.J,h._],encapsulation:2}),CampaignTaskEmailPanel})();const P=function(){return{fieldtype:"enumalternate"}};let H=(()=>{class CampaignTaskAddModal{constructor(t,e,s,i){this.parent=t,this.model=e,this.view=s,this.modal=i,this.model.module="CampaignTasks",this.model.initialize(t),this.view.isEditable=!0,this.view.setEditMode("name")}save(){this.model.validate()&&this.model.save().subscribe((()=>{this.self.destroy()}))}close(){this.self.destroy()}}return CampaignTaskAddModal.ɵfac=function(t){return new(t||CampaignTaskAddModal)(c.Y36(p.o,4),c.Y36(p.o),c.Y36(D.e),c.Y36(Z.o))},CampaignTaskAddModal.ɵcmp=c.Xpm({type:CampaignTaskAddModal,selectors:[["campaigntask-add-modal"]],features:[c._Bn([p.o,D.e])],decls:11,vars:2,consts:[["size","small"],[3,"close"],["label","LBL_CAMPAIGNTASK"],["field","name"],["field","campaigntask_type",3,"fieldconfig"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(t,e){1&t&&(c.TgZ(0,"system-modal",0)(1,"system-modal-header",1),c.NdJ("close",(function(){return e.close()})),c._UZ(2,"system-label",2),c.qZA(),c.TgZ(3,"system-modal-content"),c._UZ(4,"field-container",3)(5,"field-container",4),c.qZA(),c.TgZ(6,"system-modal-footer")(7,"button",5),c.NdJ("click",(function(){return e.close()})),c._UZ(8,"system-label",6),c.qZA(),c.TgZ(9,"button",7),c.NdJ("click",(function(){return e.save()})),c._UZ(10,"system-label",8),c.qZA()()()),2&t&&(c.xp6(5),c.Q6J("fieldconfig",c.DdM(1,P)))},dependencies:[F.j,h._,w.j,U.x,J.p,z.y],encapsulation:2}),CampaignTaskAddModal})(),$=(()=>{class CampaignTaskAddButton{constructor(t,e,s,i){this.language=t,this.model=e,this.injector=s,this.modal=i}execute(){this.modal.openModal("CampaignTaskAddModal",!0,this.injector)}}return CampaignTaskAddButton.ɵfac=function(t){return new(t||CampaignTaskAddButton)(c.Y36(r.d),c.Y36(p.o),c.Y36(c.zs3),c.Y36(Z.o))},CampaignTaskAddButton.ɵcmp=c.Xpm({type:CampaignTaskAddButton,selectors:[["campaigntask-add-button"]],decls:1,vars:0,consts:[["label","LBL_ADD"]],template:function(t,e){1&t&&c._UZ(0,"system-label",0)},dependencies:[h._],encapsulation:2}),CampaignTaskAddButton})();var G=s(1553);const X=function(){return{label:"LBL_SUBJECT"}},V=function(){return{label:"LBL_LETTER_CONTENT",fieldtype:"richtext",asiframe:!0,simplemode:!0,height:"250px"}};function K(t,e){1&t&&(c.TgZ(0,"system-collapsable-tab",1)(1,"div",2),c._UZ(2,"field-container",3)(3,"field-container",4)(4,"field-container",5),c.qZA()()),2&t&&(c.xp6(3),c.Q6J("fieldconfig",c.DdM(2,X)),c.xp6(1),c.Q6J("fieldconfig",c.DdM(3,V)))}let W=(()=>{class CampaignTaskMailMergePanel{constructor(t,e,s,i,a,l,n,d){this.language=t,this.model=e,this.injector=s,this.view=i,this.sanitizer=a,this.backend=l,this.metadata=n,this.modal=d,this.componentconfig={},this.activeTab="details",this.subscription=new q.w0}get hidden(){return"mailmerge"!=this.model.getField("campaigntask_type")}ngOnInit(){}ngOnDestroy(){this.subscription.unsubscribe()}setActiveTab(t){this.activeTab=t}}return CampaignTaskMailMergePanel.ɵfac=function(t){return new(t||CampaignTaskMailMergePanel)(c.Y36(r.d),c.Y36(p.o),c.Y36(c.zs3),c.Y36(D.e),c.Y36(_.H7),c.Y36(g.y),c.Y36(m.Pu),c.Y36(Z.o))},CampaignTaskMailMergePanel.ɵcmp=c.Xpm({type:CampaignTaskMailMergePanel,selectors:[["campaign-task-email-panel"]],decls:1,vars:1,consts:[["title","LBL_MAILMERGE",4,"ngIf"],["title","LBL_MAILMERGE"],[1,"slds-p-horizontal--xx-small"],["field","output_template_name","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight"],["field","email_subject","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight",3,"fieldconfig"],["field","email_body","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small spice-fieldminheight",3,"fieldconfig"]],template:function(t,e){1&t&&c.YNc(0,K,5,4,"system-collapsable-tab",0),2&t&&c.Q6J("ngIf",!e.hidden)},dependencies:[i.O5,F.j,G.z],encapsulation:2}),CampaignTaskMailMergePanel})(),tt=(()=>{class CampaignTaskMailergeButton{constructor(t,e,s){this.model=t,this.injector=e,this.modal=s}get hidden(){return"mailmerge"!=this.model.getField("campaigntask_type")}get disabled(){return!this.model.getField("output_template_id")||this.model.isEditing||this.model.getField("activated")}execute(){this.modal.openModal("CampaignTaskMailMergeModal",!0,this.injector)}}return CampaignTaskMailergeButton.ɵfac=function(t){return new(t||CampaignTaskMailergeButton)(c.Y36(p.o),c.Y36(c.zs3),c.Y36(Z.o))},CampaignTaskMailergeButton.ɵcmp=c.Xpm({type:CampaignTaskMailergeButton,selectors:[["campaigntask-mailmerge-button"]],decls:1,vars:0,consts:[["label","LBL_MAILMERGE"]],template:function(t,e){1&t&&c._UZ(0,"system-label",0)},dependencies:[h._],encapsulation:2}),CampaignTaskMailergeButton})();var et=s(6625),st=s(2646),it=s(5621),at=s(151);function lt(t,e){if(1&t&&c._UZ(0,"object",27),2&t){const t=c.oxw();c.Q6J("data",t.blobUrl,c.uOi)}}function nt(t,e){1&t&&(c.TgZ(0,"div",28),c._UZ(1,"system-spinner"),c.qZA())}function dt(t,e){1&t&&(c.TgZ(0,"div",28)(1,"system-illustration-no-data"),c._UZ(2,"system-label",29),c.qZA()())}let ot=(()=>{class CampaignTaskMailMergeModal{constructor(t,e,s,i,a,l){this.language=t,this.model=e,this.backend=s,this.modal=i,this.sanitizer=a,this.configuration=l,this.totalCount=0,this.start=1,this.inactiveCount=0,this.loading=!1,this.getCount()}ngOnInit(){const t=this.configuration.getCapabilityConfig("campaigntasks").pdflimit;this.limit=t?parseInt(t,10):100}getCount(){this.backend.getRequest(`module/CampaignTasks/${this.model.id}/targetcount`).subscribe((t=>{this.totalCount=parseInt(t.count,10),this.totalCount<this.limit&&(this.limit=this.totalCount)}))}get canGenerate(){return this.totalCount>0&&this.start&&this.start>0&&this.start<=this.totalCount&&this.limit&&this.start+this.limit-1<=this.totalCount}rendertemplate(){this.blobUrl=null,this.loading=!0,this.backend.getRequest(`module/CampaignTasks/${this.model.id}/mailmerge`,{start:this.start-1,limit:this.limit}).subscribe((t=>{this.pdf=t.content,this.inactiveCount=t.inactiveCount;let e=this.datatoBlob(atob(t.content));this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e)),this.loading=!1}),(()=>{this.loading=!1}))}datatoBlob(t,e="",s=512){let i=[];for(let e=0;e<t.length;e+=s){let a=t.slice(e,e+s),l=new Array(a.length);for(let t=0;t<a.length;t++)l[t]=a.charCodeAt(t);let n=new Uint8Array(l);i.push(n)}return new Blob(i,{type:e})}download(){let t=document.createElement("a");document.body.appendChild(t);let e=this.datatoBlob(atob(this.pdf)),s=URL.createObjectURL(e);t.href=s,t.type="application/pdf";let i=`${this.model.getField("name")}_pages_${this.start}_to_${this.start+this.limit-1}.pdf`;t.download=i,t.click(),t.remove()}close(){this.self.destroy()}}return CampaignTaskMailMergeModal.ɵfac=function(t){return new(t||CampaignTaskMailMergeModal)(c.Y36(r.d),c.Y36(p.o),c.Y36(g.y),c.Y36(Z.o),c.Y36(_.H7),c.Y36(et.C))},CampaignTaskMailMergeModal.ɵcmp=c.Xpm({type:CampaignTaskMailMergeModal,selectors:[["campaigntask-mailerge-modal"]],decls:31,vars:15,consts:[["size","large"],[3,"close"],["label","LBL_MAILMERGE"],["margin","none"],[1,"slds-p-around--small"],[1,"slds-grid","slds-grid--vertical-align-center"],["label","LBL_START",1,"slds-p-horizontal--x-small"],[1,"slds-p-horizontal--x-small",3,"asNumber","precision","ngModel","ngModelChange"],["label","LBL_COUNT",1,"slds-p-horizontal--x-small"],["label","LBL_TOTAL",1,"slds-p-horizontal--x-small"],[1,"slds-p-horizontal--x-small",3,"disabled","precision","ngModel"],["system-title","LBL_MAILMERGE",1,"slds-col--bump-left","slds-button","slds-button_neutral",3,"disabled","click"],["addclasses","slds-button__icon slds-button__icon_left","icon","print"],["label","LBL_GENERATE"],[1,"slds-grid",2,"height","70vh"],[1,"slds-p-horizontal--small","slds-p-bottom--small","slds-size--1-of-1"],[1,"slds-border--top","slds-border--right","slds-border--left","slds-border--bottom",2,"width","100%","height","100%"],["type","application/pdf","width","100%","height","100%",3,"data",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%;",4,"ngIf"],[1,"slds-grid","slds-grid_vertical-align-center"],["label","LBL_EXCLUDED_INACTIVE",1,"slds-p-horizontal--x-small"],[1,"slds-text-body--regular","slds-truncate","slds-p-horizontal--x-small"],[1,"slds-col","slds-col_bump-right"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_DOWNLOAD"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],["type","application/pdf","width","100%","height","100%",3,"data"],[1,"slds-align--absolute-center",2,"height","100%"],["label","LBL_NO_PDF_GENERATED"]],template:function(t,e){1&t&&(c.TgZ(0,"system-modal",0)(1,"system-modal-header",1),c.NdJ("close",(function(){return e.close()})),c._UZ(2,"system-label",2),c.qZA(),c.TgZ(3,"system-modal-content",3)(4,"div",4)(5,"div",5),c._UZ(6,"system-label",6),c.TgZ(7,"system-input-number",7),c.NdJ("ngModelChange",(function(t){return e.start=t})),c.qZA(),c._UZ(8,"system-label",8),c.TgZ(9,"system-input-number",7),c.NdJ("ngModelChange",(function(t){return e.limit=t})),c.qZA(),c._UZ(10,"system-label",9)(11,"system-input-number",10),c.TgZ(12,"button",11),c.NdJ("click",(function(){return e.rendertemplate()})),c._UZ(13,"system-button-icon",12)(14,"system-label",13),c.qZA()()(),c.TgZ(15,"div",14)(16,"div",15)(17,"div",16),c.YNc(18,lt,1,1,"object",17),c.YNc(19,nt,2,0,"div",18),c.YNc(20,dt,3,0,"div",18),c.qZA()()()(),c.TgZ(21,"system-modal-footer")(22,"div",19),c._UZ(23,"system-label",20),c.TgZ(24,"p",21),c._uU(25),c.qZA(),c.TgZ(26,"div",22)(27,"button",23),c.NdJ("click",(function(){return e.download()})),c._UZ(28,"system-label",24),c.qZA(),c.TgZ(29,"button",25),c.NdJ("click",(function(){return e.close()})),c._UZ(30,"system-label",26),c.qZA()()()()()),2&t&&(c.xp6(7),c.Q6J("asNumber",!0)("precision",0)("ngModel",e.start),c.xp6(2),c.Q6J("asNumber",!0)("precision",0)("ngModel",e.limit),c.xp6(2),c.Q6J("disabled",!0)("precision",0)("ngModel",e.totalCount),c.xp6(1),c.Q6J("disabled",!e.canGenerate),c.xp6(6),c.Q6J("ngIf",e.blobUrl),c.xp6(1),c.Q6J("ngIf",e.loading),c.xp6(1),c.Q6J("ngIf",!e.blobUrl&&!e.loading),c.xp6(5),c.Oqu(e.inactiveCount),c.xp6(2),c.Q6J("disabled",!e.pdf||e.loading))},dependencies:[i.O5,a.JJ,a.On,Y.J,st.t,it.i,h._,w.j,U.x,J.p,z.y,b.W,at.S],encapsulation:2}),CampaignTaskMailMergeModal})();var ct=s(4357);let rt=(()=>{class ModuleCampaigns{}return ModuleCampaigns.ɵfac=function(t){return new(t||ModuleCampaigns)},ModuleCampaigns.ɵmod=c.oAB({type:ModuleCampaigns}),ModuleCampaigns.ɵinj=c.cJS({imports:[i.ez,a.u5,l.ObjectFields,n.GlobalComponents,d.ObjectComponents,o.SystemComponents,ct.o]}),ModuleCampaigns})();("undefined"==typeof ngJitMode||ngJitMode)&&c.kYT(rt,{declarations:[T,x,k,E,B,N,j,$,H,W,tt,ot],imports:[i.ez,a.u5,l.ObjectFields,n.GlobalComponents,d.ObjectComponents,o.SystemComponents,ct.o]})}}]);