/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_spiceurls_spiceurls_ts"],{39300:(s,e,t)=>{t.r(e),t.d(e,{ModuleSpiceUrls:()=>H});var l=t(60177),i=t(84341),r=t(71341),n=t(7745),d=t(12948),o=t(37328),a=t(70569),u=t(54438),c=t(82293),m=t(69904),p=t(50531),h=t(35911),g=t(41731),f=t(41081),b=t(83935),U=t(32062),_=t(48717),v=t(30012),I=t(48849),y=t(13562),S=t(25863),x=t(68823);function k(s,e){if(1&s){const s=u.RV6();u.j41(0,"div",9)(1,"button",10),u.bIt("click",(function(){u.eBV(s);const e=u.XpG();return u.Njj(e.deleteUrl())})),u.nrm(2,"system-button-icon",11),u.k0s()()}}function D(s,e){if(1&s&&(u.j41(0,"div",12)(1,"ul",13)(2,"li",14),u.EFF(3),u.k0s()()()),2&s){const s=u.XpG();u.R7$(3),u.JRh(s.urlItemDate)}}function X(s,e){if(1&s&&(u.j41(0,"div",3)(1,"div",15)(2,"span",16)(3,"span",17),u.EFF(4,"Progress: 25%"),u.k0s()()(),u.j41(5,"div",18),u.EFF(6),u.k0s()()),2&s){const s=u.XpG();u.R7$(2),u.Y8G("ngStyle",s.progressbarstyle),u.R7$(4),u.SpI(" ",s.urlItem.uploadprogress," % ")}}let R=(()=>{class SpiceUrlItem{constructor(s,e,t,l,i){this.userpreferences=s,this.modal=e,this.toast=t,this.helper=l,this.injector=i,this.urlItem={},this.editmode=!0}get urlItemDate(){return this.urlItem.date?this.urlItem.date.format(this.userpreferences.getDateFormat()):""}get uploading(){return this.urlItem.hasOwnProperty("uploadprogress")}get progressbarstyle(){return{width:this.urlItem.uploadprogress+"%"}}openUrl(s){s.preventDefault(),s.stopPropagation(),this.uploading?this.toast.sendToast("upload still in progress","info"):this.urlItem.urlItem_mime_type}deleteUrl(){this.editmode&&this.modelurls.deleteUrl(this.urlItem.id)}static#s=this.ɵfac=function(s){return new(s||SpiceUrlItem)(u.rXU(I.S),u.rXU(p.y),u.rXU(f.o),u.rXU(y.d),u.rXU(u.zZn))};static#e=this.ɵcmp=u.VBU({type:SpiceUrlItem,selectors:[["spice-url-item"]],inputs:{urlItem:"urlItem",editmode:"editmode",modelurls:"modelurls"},decls:10,vars:5,consts:[[1,"slds-m-right--x-small","slds-align--absolute-center",2,"width","30px","height","30px"],["icon","share_link","size","small",3,"module"],[1,"slds-media__body"],[1,"slds-grid","slds-grid_vertical-align-center","slds-grid--align-spread","slds-has-flexi-truncate"],[1,"slds-truncate","slds-text-heading--x-small","slds-p-right--xxx-small",3,"click"],["href","javascript:void(0);"],["class","slds-shrink-none",4,"ngIf"],["class","slds-tile__detail slds-text-body--small",4,"ngIf"],["class","slds-grid slds-grid_vertical-align-center slds-grid--align-spread slds-has-flexi-truncate",4,"ngIf"],[1,"slds-shrink-none"],[1,"slds-button","slds-button--icon",3,"click"],["icon","clear"],[1,"slds-tile__detail","slds-text-body--small"],[1,"slds-list--horizontal","slds-has-dividers--left"],[1,"slds-item"],[1,"slds-progress-bar"],[1,"slds-progress-bar__value",3,"ngStyle"],[1,"slds-assistive-text"],[1,"slds-text-align--right",2,"width","50px"]],template:function(s,e){1&s&&(u.j41(0,"div",0),u.nrm(1,"system-icon",1),u.k0s(),u.j41(2,"div",2)(3,"div",3)(4,"h3",4),u.bIt("click",(function(s){return e.openUrl(s)})),u.j41(5,"a",5),u.EFF(6),u.k0s()(),u.DNE(7,k,3,0,"div",6),u.k0s(),u.DNE(8,D,4,1,"div",7)(9,X,7,2,"div",8),u.k0s()),2&s&&(u.R7$(),u.Y8G("module","SpiceUrls"),u.R7$(5),u.JRh(e.urlItem.urlItemName),u.R7$(),u.Y8G("ngIf",!e.uploading&&e.editmode),u.R7$(),u.Y8G("ngIf",!e.uploading),u.R7$(),u.Y8G("ngIf",e.uploading))},dependencies:[l.bT,l.B3,S.t,x.J],encapsulation:2})}return SpiceUrlItem})();const j=["urlupload"];function C(s,e){if(1&s&&u.nrm(0,"spice-url-item",5),2&s){const s=e.$implicit,t=u.XpG(2);u.Y8G("modelurls",t.modelurls)("urlItem",s)("editmode",t.editing)}}function E(s,e){1&s&&(u.j41(0,"div",6)(1,"div",7),u.nrm(2,"system-spinner",8)(3,"system-label",9),u.k0s()())}function L(s,e){if(1&s){const s=u.RV6();u.j41(0,"div",1),u.bIt("system-drop-file",(function(e){u.eBV(s);const t=u.XpG();return u.Njj(t.fileDrop(e))})),u.j41(1,"div")(2,"div",2),u.DNE(3,C,1,3,"spice-url-item",3),u.k0s(),u.DNE(4,E,4,0,"div",4),u.k0s()()}if(2&s){const s=u.XpG();u.R7$(3),u.Y8G("ngForOf",s.modelurls),u.R7$(),u.Y8G("ngIf",s.modelurls.loading)}}let G=(()=>{class SpiceUrlsPanel{constructor(s,e,t,l,i,r,n,d,o,a,c){this._modelurls=s,this.parentmodelurls=e,this.language=t,this.modal=l,this.model=i,this.view=r,this.renderer=n,this.toast=d,this.metadata=o,this.modalservice=a,this.injector=c,this.uploadurls=[],this.urlsLoaded=new u.bkB,this.componentconfig={},this._modelurls.module=this.model.module,this._modelurls.id=this.model.id}get isHidden(){return!!this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}get modelurls(){return this.parentmodelurls&&this.parentmodelurls.module==this.model.module&&this.parentmodelurls.id==this.model.id?this.parentmodelurls:this._modelurls}get editing(){return this.model.isEditing&&(!this.view||this.view.isEditable)}loadUrl(){}setUploadUrl(s){}ngAfterViewInit(){this.parentmodelurls||setTimeout((()=>this.loadUrl()),10)}preventdefault(s){(s.dataTransfer.items.length>=1&&this.hasOneItemsFile(s.dataTransfer.items)||s.dataTransfer.urls.length>0)&&(s.preventDefault(),s.stopPropagation(),s.dataTransfer.dropEffect="copy")}hasOneItemsFile(s){for(let e of s)if("url"==e.kind)return!0;return!1}onDrop(s){this.preventdefault(s);let e=s.dataTransfer.urls;e&&e.length>=1&&this.doUpload(e)}fileDrop(s){s&&s.length>=1&&this.doUpload(s)}uploadUrl(){let s=this.urlUpload.element.nativeElement.urls;this.doUpload(s)}doUpload(s){}static#s=this.ɵfac=function(s){return new(s||SpiceUrlsPanel)(u.rXU(c.c),u.rXU(c.c,12),u.rXU(m.B),u.rXU(p.y),u.rXU(h.g),u.rXU(g.U,8),u.rXU(u.sFG),u.rXU(f.o),u.rXU(b.yu),u.rXU(p.y),u.rXU(u.zZn))};static#e=this.ɵcmp=u.VBU({type:SpiceUrlsPanel,selectors:[["spice-urls-panel"]],viewQuery:function(s,e){if(1&s&&u.GBs(j,5,u.c1b),2&s){let s;u.mGM(s=u.lsd())&&(e.urlUpload=s.first)}},outputs:{urlsLoaded:"urlsLoaded"},features:[u.Jv_([c.c])],decls:1,vars:1,consts:[["class","slds-box slds-m-around--xx-small",3,"system-drop-file",4,"ngIf"],[1,"slds-box","slds-m-around--xx-small",3,"system-drop-file"],[1,"slds-card__body--inner","slds-grid","slds-wrap","slds-grid--pull-padded"],["class","slds-media slds-size--1-of-1",3,"modelurls","urlItem","editmode",4,"ngFor","ngForOf"],["class","slds-p-around--x-small slds-align--absolute-center",4,"ngIf"],[1,"slds-media","slds-size--1-of-1",3,"modelurls","urlItem","editmode"],[1,"slds-p-around--x-small","slds-align--absolute-center"],[1,"slds-grid","slds-grid--vertical-align-center"],["size","14"],["label","LBL_INITIALIZING",1,"slds-p-left--x-small"]],template:function(s,e){1&s&&u.DNE(0,L,5,2,"div",0),2&s&&u.Y8G("ngIf",!e.isHidden)},dependencies:[l.Sq,l.bT,U.W,_.P,v.H,R],encapsulation:2})}return SpiceUrlsPanel})();var M=t(40553);function B(s,e){if(1&s&&(u.j41(0,"span",3),u.EFF(1),u.k0s()),2&s){const s=u.XpG();u.R7$(),u.JRh(s.urlcount)}}let F=(()=>{class SpiceUrlsPanelHeader{constructor(s,e,t,l){this.model=s,this.modelurls=e,this.language=t,this.broadcast=l,this.broadcastSubscription={},this.urlcount=0,this.broadcastSubscription=this.broadcast.message$.subscribe((s=>{this.handleMessage(s)}))}ngOnInit(){this.modelurls.module=this.model.module,this.modelurls.id=this.model.id,this.modelurls.getCount().subscribe((s=>{this.urlcount=s}))}get hasUrls(){return this.urlcount>0}handleMessage(s){if((s.messagedata.module===this.model.module||s.messagedata.id===this.model.id)&&"urls.loaded"===s.messagetype)this.urlcount=s.messagedata.urlcount}ngOnDestroy(){this.broadcastSubscription.unsubscribe()}static#s=this.ɵfac=function(s){return new(s||SpiceUrlsPanelHeader)(u.rXU(h.g),u.rXU(c.c),u.rXU(m.B),u.rXU(M.m))};static#e=this.ɵcmp=u.VBU({type:SpiceUrlsPanelHeader,selectors:[["spice-urls-panel-header"]],features:[u.Jv_([c.c])],decls:4,vars:1,consts:[[1,"slds-grid","slds-grid--vertical-align-center"],["label","LBL_URLS"],["class","slds-theme_warning slds-m-horizontal--xx-small slds-align--absolute-center spice-counter",4,"ngIf"],[1,"slds-theme_warning","slds-m-horizontal--xx-small","slds-align--absolute-center","spice-counter"]],template:function(s,e){1&s&&(u.j41(0,"div",0)(1,"span"),u.nrm(2,"system-label",1),u.k0s(),u.DNE(3,B,2,1,"span",2),u.k0s()),2&s&&(u.R7$(3),u.Y8G("ngIf",e.hasUrls))},dependencies:[l.bT,U.W],encapsulation:2})}return SpiceUrlsPanelHeader})();function w(s,e){if(1&s&&u.nrm(0,"spice-url-item",3),2&s){const s=e.$implicit,t=u.XpG(2);u.Y8G("modelurls",t.modelurls)("urlItem",s)("editmode",!1)("ngClass",t.getItemClass())}}function T(s,e){if(1&s&&(u.j41(0,"div",1),u.DNE(1,w,1,4,"spice-url-item",2),u.k0s()),2&s){const s=u.XpG();u.Y8G("ngStyle",s.getCompStyle())("ngClass",s.componentconfig.addClasses),u.R7$(),u.Y8G("ngForOf",s.modelurls.urls)}}let $=(()=>{class SpiceUrlsList{constructor(s,e,t,l){this.modelurls=s,this.language=e,this.model=t,this.cdRef=l,this.componentconfig={},this.modelurls.module=this.model.module,this.modelurls.id=this.model.id}loadFiles(){this.modelurls.getUrls().subscribe((s=>{this.cdRef.detectChanges()}))}ngAfterViewInit(){setTimeout((()=>this.loadFiles()),10)}getCompStyle(){return{marginRight:this.componentconfig.horizontal?"-16px":void 0,marginBottom:this.componentconfig.horizontal?"-8px":void 0}}getItemClass(){return this.componentconfig.horizontal?"slds-m-right_medium slds-m-bottom_x-small":"slds-size--1-of-1"}static#s=this.ɵfac=function(s){return new(s||SpiceUrlsList)(u.rXU(c.c),u.rXU(m.B),u.rXU(h.g),u.rXU(u.gRc))};static#e=this.ɵcmp=u.VBU({type:SpiceUrlsList,selectors:[["spice-urls-list"]],features:[u.Jv_([c.c])],decls:1,vars:1,consts:[["class","slds-m-vertical--xx-small slds-card__body--inner slds-grid slds-wrap slds-grid--pull-padded",3,"ngStyle","ngClass",4,"ngIf"],[1,"slds-m-vertical--xx-small","slds-card__body--inner","slds-grid","slds-wrap","slds-grid--pull-padded",3,"ngStyle","ngClass"],["class","slds-media",3,"modelurls","urlItem","editmode","ngClass",4,"ngFor","ngForOf"],[1,"slds-media",3,"modelurls","urlItem","editmode","ngClass"]],template:function(s,e){1&s&&u.DNE(0,T,2,3,"div",0),2&s&&u.Y8G("ngIf",e.modelurls.urls.length>0)},dependencies:[l.YU,l.Sq,l.bT,l.B3,R],encapsulation:2,changeDetection:0})}return SpiceUrlsList})();var N=t(53584),Y=t(49722),O=t(40713),P=t(25028),z=t(88418),V=t(83524);let A=(()=>{class SpiceUrlsEditModal{constructor(s,e,t,l,i){this.configurationService=s,this.toast=e,this.language=t,this.model=l,this.backend=i,this.url={},this.inputData={},this.self={}}close(){this.self.destroy()}save(){const s={description:this.inputData.description,url_name:this.inputData.url_name?this.inputData.url_name:""};this.backend.postRequest("common/spiceurls/"+this.url.id,{},s).subscribe({next:s=>{s&&s.success?(this.inputData.description!=this.url.description&&(this.url.description=this.inputData.description),this.inputData.url_name!=this.url.url_name&&(this.url.url_name=this.inputData.url_name),this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED"),"success")):this.toast.sendToast(this.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),this.self.destroy()},error:()=>{this.toast.sendToast(this.language.getLabel("ERR_NETWORK"),"error"),this.self.destroy()}})}static#s=this.ɵfac=function(s){return new(s||SpiceUrlsEditModal)(u.rXU(N.i),u.rXU(f.o),u.rXU(m.B),u.rXU(h.g),u.rXU(Y.H))};static#e=this.ɵcmp=u.VBU({type:SpiceUrlsEditModal,selectors:[["spice-urls-edit-modal"]],inputs:{url:"url"},decls:25,vars:3,consts:[[3,"close"],["label","LBL_EDIT"],[1,"slds-form-element"],[1,"slds-form-element__label"],["label","LBL_URL"],[1,"slds-form-element__control"],["type","text","disabled","",1,"slds-input",3,"ngModel","ngModelChange"],["label","LBL_DISPLAY_NAME"],["type","text",1,"slds-input",3,"ngModel","ngModelChange"],[1,"slds-form-element","slds-p-horizontal--xx-small"],["label","LBL_DESCRIPTION"],[1,"slds-textarea","slds-scrollable--y","slds-m-vertical--xx-small",2,"height","250px",3,"ngModel","ngModelChange"],[1,"slds-grid"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(s,e){1&s&&(u.j41(0,"system-modal")(1,"system-modal-header",0),u.bIt("close",(function(){return e.close()})),u.nrm(2,"system-label",1),u.k0s(),u.j41(3,"system-modal-content")(4,"div",2)(5,"label",3),u.nrm(6,"system-label",4),u.k0s(),u.j41(7,"div",5)(8,"input",6),u.mxI("ngModelChange",(function(s){return u.DH7(e.url.url,s)||(e.url.url=s),s})),u.k0s()()(),u.j41(9,"div",2)(10,"label",3),u.nrm(11,"system-label",7),u.k0s(),u.j41(12,"div",5)(13,"input",8),u.mxI("ngModelChange",(function(s){return u.DH7(e.inputData.url_name,s)||(e.inputData.url_name=s),s})),u.k0s()()(),u.j41(14,"div",9)(15,"label",3),u.nrm(16,"system-label",10),u.k0s(),u.j41(17,"div",5)(18,"textarea",11),u.mxI("ngModelChange",(function(s){return u.DH7(e.inputData.description,s)||(e.inputData.description=s),s})),u.k0s()()()(),u.j41(19,"system-modal-footer")(20,"div",12)(21,"button",13),u.bIt("click",(function(){return e.close()})),u.nrm(22,"system-label",14),u.k0s(),u.j41(23,"button",15),u.bIt("click",(function(){return e.save()})),u.nrm(24,"system-label",16),u.k0s()()()()),2&s&&(u.R7$(8),u.R50("ngModel",e.url.url),u.R7$(5),u.R50("ngModel",e.inputData.url_name),u.R7$(5),u.R50("ngModel",e.inputData.description))},dependencies:[i.me,i.BC,i.vS,U.W,O.D,P.I,z.Q,V.C],encapsulation:2})}return SpiceUrlsEditModal})(),H=(()=>{class ModuleSpiceUrls{static#s=this.ɵfac=function(s){return new(s||ModuleSpiceUrls)};static#e=this.ɵmod=u.$C({type:ModuleSpiceUrls});static#t=this.ɵinj=u.G2t({imports:[l.MD,i.YN,n.ObjectFields,d.GlobalComponents,o.ObjectComponents,a.SystemComponents,r.h]})}return ModuleSpiceUrls})();("undefined"==typeof ngJitMode||ngJitMode)&&u.Obh(H,{declarations:[G,F,R,$,A],imports:[l.MD,i.YN,n.ObjectFields,d.GlobalComponents,o.ObjectComponents,a.SystemComponents,r.h]})}}]);