/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-16 09:05:07
 * build: 2021.02.001.1626419107136
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,o){var i,a=arguments.length,d=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;0<=r;r--)(i=e[r])&&(d=(a<3?i(d):3<a?i(t,s,d):i(t,s))||d);return 3<a&&d&&Object.defineProperty(t,s,d),d},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__spreadArray=this&&this.__spreadArray||function(e,t){for(var s=0,o=t.length,i=e.length;s<o;s++,i++)e[i]=t[s];return e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleDashboard=exports.DashboardSelectPanelAddButton=exports.DashboardComponentset=exports.DashboardRemindersDashlet=exports.DashboardGenericDashletRow=exports.DashboardGenericDashlet=exports.DashboardWeatherDashlet=exports.DashboardAddElement=exports.DashboardContainerElement=exports.DashboardContainerBody=exports.DashboardContainerHomeHeader=exports.DashboardContainerHeader=exports.DashboardContainer=exports.DashboardSelectPanel=exports.DashboardView=exports.dashboardlayout=void 0;var common_1=require("@angular/common"),forms_1=require("@angular/forms"),directives_1=require("../../directives/directives"),core_1=require("@angular/core"),services_1=require("../../services/services"),objectfields_1=require("../../objectfields/objectfields"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),router_1=require("@angular/router"),http_1=require("@angular/common/http"),rxjs_1=require("rxjs"),dashboardlayout=function(){function e(e,t,s){this.backend=e,this.model=t,this.modal=s,this.dashboardData={},this.dashboardGrid=[],this.dashboardId="",this.dashboardElements=[],this.boxMargin=5,this.columns=9,this.editmode=!1,this.editing="",this.isMoving=!1,this.isloading=!1,this.dashboardNotFound=!1}return Object.defineProperty(e.prototype,"bodyContainerRef",{get:function(){return this.bodycontainerref.element.nativeElement},set:function(e){this.bodycontainerref=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editMode",{get:function(){return this.editmode},set:function(e){var t=this;this.editmode=e,this.editmode&&setTimeout(function(){return t.calculateGrid()},100)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementHeight",{get:function(){return this.bodyContainerRef?this.bodyContainerRef.clientHeight/this.columns:100},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementWidth",{get:function(){return this.bodyContainerRef?this.bodyContainerRef.clientWidth/this.columns:100},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compactView",{get:function(){return this.bodyContainerRef.clientWidth<768},enumerable:!1,configurable:!0}),e.prototype.calculateGrid=function(){if(this.bodyContainerRef){this.dashboardGrid=[];for(var e=0,t=this.columns,s=0,o=this.dashboardElements;s<o.length;s++){var i=o[s],i=i.position.top+i.position.height;this.bodyContainerRef.clientHeight&&i>this.columns&&(t=t<i?i:t)}for(;e<t;){for(var a=0,d=[];a<this.columns;)d.push({width:this.bodyContainerRef.clientWidth/this.columns-2*this.boxMargin,height:this.elementHeight-2*this.boxMargin,top:e*this.elementHeight+this.boxMargin,left:a*this.bodyContainerRef.clientWidth/this.columns+this.boxMargin}),a++;this.dashboardGrid.push(d),e++}this.dashboardGrid=this.dashboardGrid.slice()}},e.prototype.getElementStyle=function(e,t,s,o){var i={};return i.top=e*this.elementHeight+this.boxMargin,i.left=t*this.elementWidth+this.boxMargin,i.width=this.compactView?"100%":s*this.elementWidth-2*this.boxMargin,i.height=o*this.elementHeight-2*this.boxMargin,i},e.prototype.dropElement=function(i,a,d,r,n){var l=this;this.dashboardElements.some(function(e){if(e.id===i){var t=Math.round(a/l.elementWidth),s=Math.round(d/l.elementHeight),o=l.canDrop(i,e,a,d,n,r);switch(r){case"content":o.left&&(e.position.left+=t),o.top&&(e.position.top+=s);break;case"left":o.left&&(e.position.width-=t,e.position.left+=t);break;case"right":o.left&&(e.position.width+=t);break;case"top":o.top&&(e.position.height-=s,e.position.top+=s);break;case"bottom":o.top&&(e.position.height+=s)}return window.dispatchEvent(new Event("resize")),!0}}),setTimeout(function(){return l.calculateGrid()},100)},e.prototype.canDrop=function(e,t,s,o,i,a){var d=!0,r=!0,n=Math.round(s/this.elementWidth),l=Math.round(o/this.elementHeight),c=t.position.left,h=t.position.left+(t.position.width-1),u=t.position.top,m=t.position.top+(t.position.height-1),p=c,b=(t.position.width,h),g=u,y=(t.position.height,m);switch(a){case"content":y=m+l,b=h+n,p=c+n,g=u+l;break;case"left":p=c+n;break;case"right":b=h+n;break;case"top":g=u+l;break;case"bottom":y=m+l}for(var f=0,v=this.dashboardElements;f<v.length;f++){var _=v[f],w=_.position.left,D=_.position.left+(_.position.width-1),x=_.position.top,S=_.position.top+(_.position.height-1),C=w<=p&&p<=D,M=b<=D&&w<=b,k=x<=g&&g<=S,E=y<=S&&x<=y,R=(M||C)&&(k||E)&&_.id!=e,L=(k||E)&&(C||M)&&_.id!=e,I=p<0||b>this.columns-1,O=g<0,B=g<x&&S<y&&p<=D&&w<=b&&_.id!=e,H=D<b&&p<w&&g<=S&&x<=y&&_.id!=e;switch(a){case"content":(R||L||H||B||I||O)&&(r=d=!1);break;case"left":case"right":(R||H||I||b<p)&&(d=!1);break;case"top":case"bottom":(L||B||O||y<g)&&(r=!1)}}return{top:r,left:d}},e.prototype.applyMove=function(e,t,s,o){var i=e,e=this.bodyContainerRef,a=e.right-e.x,d=this.boxMargin,r=this.elementWidth-2*d,n=this.elementHeight-2*d,l=0,c=0;if(o&&s&&(l=o.pageX-s.pageX,c=o.pageY-s.pageY),s)switch(t){case"content":i.left=i.left+l,i.top=i.top+c,i.left<d&&(i.left=d),i.top<d&&(i.top=d),i.left+i.width>a&&(i.left=a-i.width-d);break;case"right":i.width=i.width+l,i.left+i.width>a&&(i.width=a-i.left-d,i.left=a-i.width-d),i.width<r&&(i.width=r);break;case"left":var h=i.width+i.left;i.width=i.width-l,i.left=i.left+l,i.left<d&&(i.left=d,i.width=h-d),i.width<r&&(i.width=r,i.left=h-i.width);break;case"bottom":i.height=i.height+c,i.height<n&&(i.height=n);break;case"top":h=i.height+i.top;i.height=i.height-c,i.top=i.top+c,i.top<d&&(i.top=d,i.height=h-d),i.height<n&&(i.height=n,i.top=h-i.height)}return i},e.prototype.addDashlet=function(t){var s=this;this.modal.openModal("DashboardAddElement").subscribe(function(e){e.instance.addDashlet.subscribe(function(e){!1!==e&&(s.editing=s.model.generateGuid(),e={id:s.editing,name:e.name,component:e.component,componentconfig:e.componentconfig,dashletconfig:e.dashletconfig,dashlet_id:e.dashlet_id,module:e.module,icon:e.icon,acl_action:e.acl_action,label:e.label,sysuidashboard_id:s.dashboardId,position:{top:Math.round(t.top/s.elementHeight),left:Math.round(t.left/s.elementWidth),width:Math.round(t.width/s.elementWidth),height:Math.round(t.height/s.elementHeight)},is_new:!0},s.dashboardElements=__spreadArray(__spreadArray([],s.dashboardElements),[e]))})})},e.prototype.deleteDashlet=function(s){var o=this;this.dashboardElements.some(function(e,t){if(e.id===s)return o.dashboardElements.splice(t,1),!0})},e.prototype.prepareStyle=function(e){var t,s=_.clone(e);for(t in s)s.hasOwnProperty(t)&&"number"==typeof s[t]&&(s[t]=Math.round(s[t])+"px");return s},e.prototype.sortElements=function(){this.dashboardElements=this.dashboardElements.sort(function(e,t){return e.position.top==t.position.top?e.position.left>t.position.left?1:-1:e.position.top>t.position.top?1:-1})},__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.model,services_1.modal])],e)}();exports.dashboardlayout=dashboardlayout;var DashboardView=function(){function DashboardView(e,t,s,o,i,a,d){this.navigation=e,this.language=t,this.dashboardlayout=s,this.userpreferences=o,this.model=i,this.view=a,this.modellist=d,this.panelwidth=250,this.showpanel=!1}return Object.defineProperty(DashboardView.prototype,"ismobile",{get:function(){return window.innerWidth<1024},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardView.prototype,"dashboardstyle",{get:function(){return{width:"calc(100% - "+(this.ismobile?0:this.panelwidth)+"px)"}},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardView.prototype,"panelstyle",{get:function(){return{width:this.panelwidth+"px","z-index":1,left:this.ismobile&&!this.showpanel?"-250px":"0px"}},enumerable:!1,configurable:!0}),DashboardView.prototype.ngOnInit=function(){this.loadDashboards(),this.navigation.setActiveModule("Dashboards")},DashboardView.prototype.loadDashboards=function(){var t=this,s=this.userpreferences.getPreference("last_dashboard");this.model.module="Dashboards",this.modellist.initialize("Dashboards"),this.modellist.loadlimit=250,this.modellist.getListData().subscribe(function(){s&&t.modellist.listData.list.some(function(e){if(e.id==s)return t.loadDashboard(s),!0})})},DashboardView.prototype.loadDashboard=function(e){var t=this;e!=this.dashboardlayout.dashboardId&&(this.view.setViewMode(),this.dashboardlayout.dashboardId=e,this.model.id=e,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData().subscribe(function(){t.dashboardlayout.dashboardElements=t.model.getField("components"),t.dashboardlayout.sortElements()},function(e){404==e.status&&(t.dashboardlayout.dashboardNotFound=!0)}))},__decorate([core_1.Component({selector:"dashboard-view",template:'<div class="slds-grid"><div class="slds-theme--shade" [ngClass]="{\'slds-is-absolute\': ismobile}" style="transition: left 1s" [ngStyle]="panelstyle"><dashboard-select-panel (hide)="showpanel = false" (dashboardSelect)="loadDashboard($event)"></dashboard-select-panel></div><div class="slds-theme--default" [ngStyle]="dashboardstyle"><dashboard-container-header [showdashboardselector]="ismobile" (showselect)="showpanel = true;"></dashboard-container-header><dashboard-container-body *ngIf="dashboardlayout.dashboardId"></dashboard-container-body><div system-to-bottom *ngIf="!dashboardlayout.dashboardId" class="slds-align--absolute-center"><span class="slds-text-heading--small">Please Select a Dashboard</span></div></div></div>',providers:[services_1.model,services_1.modellist,dashboardlayout,services_1.view]}),__metadata("design:paramtypes",[services_1.navigation,services_1.language,dashboardlayout,services_1.userpreferences,services_1.model,services_1.view,services_1.modellist])],DashboardView)}();exports.DashboardView=DashboardView;var DashboardSelectPanel=function(){function e(e,t,s,o,i,a,d,r){this.vcr=e,this.metadata=t,this.userpreferences=s,this.language=o,this.model=i,this.modellist=a,this.dashboardlayout=d,this.cfr=r,this.dashboardFilter="",this.hide=new core_1.EventEmitter,this.dashboardSelect=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"dashboards",{get:function(){for(var e=[],t=0,s=this.modellist.listData.list;t<s.length;t++){var o=s[t];(o.id==this.dashboardlayout.dashboardId||""==this.dashboardFilter||""!=this.dashboardFilter&&-1!=o.name.toLowerCase().indexOf(this.dashboardFilter.toLowerCase()))&&e.push(o)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canAdd",{get:function(){return this.metadata.checkModuleAcl("Dashboards","create")},enumerable:!1,configurable:!0}),e.prototype.getActiveClass=function(e){return e==this.dashboardlayout.dashboardId?"slds-is-active":""},e.prototype.setDashboard=function(e){this.userpreferences.setPreference("last_dashboard",e.id),this.dashboardSelect.emit(e.id),this.hidepanel()},e.prototype.hidepanel=function(){this.hide.emit(!0)},e.prototype.trackByFn=function(e,t){return t.id},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"hide",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"dashboardSelect",void 0),__decorate([core_1.Component({selector:"dashboard-select-panel",template:'<nav class="slds-nav-vertical" aria-label="Sub page"><div class="slds-nav-vertical__section"><div class="slds-grid slds-grid_align-spread slds-grid--vertical-align-center slds-p-horizontal--small slds-p-vertical--x-small"><h2 id="entity-header" class="slds-text-heading--small"><system-label-modulename module="Dashboards"></system-label-modulename></h2><dashboard-select-panel-add-button *ngIf="canAdd" (dashboardAdded)="setDashboard($event)"></dashboard-select-panel-add-button><button class="slds-hide--large slds-button slds-button_icon" (click)="hidepanel()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></div><div class="slds-form-element slds-p-horizontal--small slds-p-vertical--x-small"><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="dashboardFilter"></div></div><ul system-to-bottom class="spice-scrollbar" [system-overlay-loading-spinner]="modellist.isLoading"><li class="slds-nav-vertical__item" [ngClass]="getActiveClass(dashboard.id)" *ngFor="let dashboard of dashboards; trackBy: trackByFn" (click)="setDashboard(dashboard)"><div class="slds-nav-vertical__action slds-text-link_reset">{{dashboard.name}}</div></li></ul></div></nav>',providers:[services_1.model]}),__metadata("design:paramtypes",[core_1.ViewContainerRef,services_1.metadata,services_1.userpreferences,services_1.language,services_1.model,services_1.modellist,dashboardlayout,core_1.ComponentFactoryResolver])],e)}();exports.DashboardSelectPanel=DashboardSelectPanel;var DashboardContainer=function(){function DashboardContainer(e,t,s,o){this.dashboardlayout=e,this.language=t,this.router=s,this.model=o,this.dashboardid="",this.context="Dashboard"}return DashboardContainer.prototype.loadDashboard=function(){var t=this;this.dashboardid!=this.dashboardlayout.dashboardId&&(this.model.initialize(),this.model.module="Dashboards",this.dashboardlayout.dashboardId=this.dashboardid,this.model.id=this.dashboardid,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData(!1).subscribe(function(){t.dashboardlayout.dashboardElements=t.model.getField("components"),t.dashboardlayout.sortElements()},function(e){404==e.status&&(t.dashboardlayout.dashboardNotFound=!0)}))},DashboardContainer.prototype.ngOnInit=function(){this.loadDashboard()},DashboardContainer.prototype.ngOnChanges=function(){this.loadDashboard()},DashboardContainer.prototype.navigate=function(){this.router.navigate(["/module/Dashboards"])},__decorate([core_1.Input(),__metadata("design:type",String)],DashboardContainer.prototype,"dashboardid",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],DashboardContainer.prototype,"context",void 0),__decorate([core_1.Component({selector:"dashboard-container",template:'<dashboard-container-body *ngIf="dashboardid.length > 0"></dashboard-container-body><div *ngIf="dashboardid.length == 0" class="slds-align--absolute-center slds-text-heading--small" system-to-bottom><span><system-label label="MSG_NO_DASHBOARD_SELECTED"></system-label></span> <a class="slds-m-left--xx-small slds-text-link" style="cursor: pointer" (click)="navigate()"><system-label label="LBL_SELECT_DASHBOARD"></system-label></a></div>',providers:[services_1.model,services_1.view,dashboardlayout]}),__metadata("design:paramtypes",[dashboardlayout,services_1.language,router_1.Router,services_1.model])],DashboardContainer)}();exports.DashboardContainer=DashboardContainer;var DashboardContainerHeader=function(){function e(e,t,s,o,i,a,d,r){this.dashboardlayout=e,this.language=t,this.userpreferences=s,this.metadata=o,this.modal=i,this.backend=a,this.view=d,this.model=r,this.showdashboardselector=!1,this.showselect=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"deletable",{get:function(){return this.metadata.checkModuleAcl(this.model.module,"delete")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editable",{get:function(){return this.metadata.checkModuleAcl(this.model.module,"edit")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHomeDashboard",{get:function(){return this.userpreferences.toUse.home_dashboard==this.model.id},enumerable:!1,configurable:!0}),e.prototype.toggleEditContent=function(){this.view.isEditMode()?this.cancel():(this.dashboardlayout.dashboardElements=JSON.parse(JSON.stringify(this.dashboardlayout.dashboardElements)),this.view.setEditMode(),this.model.startEdit(),this.dashboardlayout.calculateGrid())},e.prototype.toggleHomeDashboard=function(){this.userpreferences.setPreference("home_dashboard",this.isHomeDashboard?"":this.model.id,!0)},e.prototype.editModal=function(){this.model.edit()},e.prototype.deleteDashboard=function(){var t=this;this.modal.confirmDeleteRecord().subscribe(function(e){e&&t.model.delete().subscribe(function(){t.dashboardlayout.dashboardId=void 0,t.model.reset(),t.model.module="Dashboards"})})},e.prototype.showpanel=function(){this.showselect.emit(!0)},e.prototype.saveComponents=function(){var e=this;this.backend.postRequest("module/Dashboards/"+this.model.id+"/components",{},this.dashboardlayout.dashboardElements).subscribe(function(){e.view.setViewMode(),e.model.endEdit()})},e.prototype.cancel=function(){this.view.setViewMode(),this.model.cancelEdit(),this.dashboardlayout.dashboardElements=this.model.getField("components")},__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"showdashboardselector",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"showselect",void 0),__decorate([core_1.Component({selector:"dashboard-container-header",template:'<div class="slds-grid slds-grid--vertical-align-center slds-p-around--small"><div class="slds-p-right--small" *ngIf="showdashboardselector"><button class="slds-button slds-button--icon" (click)="showpanel()"><system-button-icon icon="rows"></system-button-icon></button></div><div class="slds-col slds-has-flexi-truncate slds-grid slds-grid--vertical-align-center"><system-spinner size="16" class="slds-p-right--small" *ngIf="dashboardlayout.isloading"></system-spinner><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate">{{model.data.name}}</h1><button *ngIf="editable && model.id" class="slds-button slds-show--large" (click)="editModal()"><system-button-icon icon="edit"></system-button-icon></button> <button *ngIf="deletable && model.id" class="slds-button slds-show--large" (click)="deleteDashboard()"><system-button-icon icon="delete"></system-button-icon></button></div><div class="slds-col slds-no-flex slds-grid slds-align-top slds-show--large"><div *ngIf="!dashboardlayout.isloading && model.id" class="slds-button-group" role="group"><button class="slds-button slds-button--neutral" (click)="toggleHomeDashboard()"><system-button-icon class="slds-m-right--xx-small" *ngIf="isHomeDashboard" icon="check"></system-button-icon><span class="slds-truncate"><system-label label="LBL_AS_HOME_DASHBOARD"></system-label></span></button> <button *ngIf="editable && !view.isEditMode()" class="slds-button slds-button--neutral" (click)="toggleEditContent()"><system-label label="LBL_EDIT"></system-label></button></div><div *ngIf="view.isEditMode()" class="slds-button-group" role="group"><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" (click)="saveComponents()"><system-label label="LBL_SAVE"></system-label></button></div></div></div>'}),__metadata("design:paramtypes",[dashboardlayout,services_1.language,services_1.userpreferences,services_1.metadata,services_1.modal,services_1.backend,services_1.view,services_1.model])],e)}();exports.DashboardContainerHeader=DashboardContainerHeader;var DashboardContainerHomeHeader=function(){function e(e,t,s){this.dashboardlayout=e,this.language=t,this.router=s,this.dashboardid=""}return Object.defineProperty(e.prototype,"dashboardname",{get:function(){return this.dashboardlayout.model.getFieldValue("name")},enumerable:!1,configurable:!0}),e.prototype.goDashboards=function(){this.router.navigate(["/module/Dashboards"])},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"dashboardid",void 0),__decorate([core_1.Component({selector:"dashboard-container-homeheader",template:'<div class="slds-grid slds-p-around--small"><div class="slds-col slds-has-flexi-truncate"><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate"><system-stencil *ngIf="!dashboardname"></system-stencil>{{dashboardname}}</h1></div><div class="slds-col slds-no-flex slds-grid slds-align-top"><button class="slds-button slds-button--neutral" (click)="goDashboards()"><system-label-modulename module="Dashboards"></system-label-modulename></button></div></div>'}),__metadata("design:paramtypes",[dashboardlayout,services_1.language,router_1.Router])],e)}();exports.DashboardContainerHomeHeader=DashboardContainerHomeHeader;var DashboardContainerBody=function(){function e(e,t,s,o,i){var a=this;this.dashboardlayout=e,this.language=t,this.renderer=s,this.view=o,this.model=i,this.resizeListener=this.renderer.listen("window","resize",function(){return a.calculateGrid()})}return Object.defineProperty(e.prototype,"isLoading",{get:function(){return this.model.isLoading},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardGrid",{get:function(){return this.dashboardlayout.dashboardGrid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardElements",{get:function(){return this.dashboardlayout.dashboardElements},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEditMode",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bodyContainerStyle",{get:function(){return{border:this.view.isEditMode()?"1px dashed #ca1b21":"0",width:"100%"}},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.dashboardlayout.bodyContainerRef=this.bodycontainer},e.prototype.ngOnDestroy=function(){this.resizeListener&&this.resizeListener()},e.prototype.trackByGridFn=function(e,t){return e},e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.calculateGrid=function(){window.innerWidth<1024&&(this.view.setViewMode(),this.model.cancelEdit()),this.isEditMode&&this.dashboardlayout.calculateGrid()},e.prototype.addDashlet=function(e){this.dashboardlayout.addDashlet(e)},__decorate([core_1.ViewChild("bodycontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"bodycontainer",void 0),__decorate([core_1.Component({selector:"dashboard-container-body",template:'<div #bodycontainer system-to-bottom class="slds-is-relative spice-scrollbar" [ngStyle]="bodyContainerStyle"><ng-container *ngIf="isEditMode"><ng-container *ngFor="let row of dashboardGrid; trackBy: trackByGridFn"><ng-container *ngFor="let column of row"><div [ngStyle]="dashboardlayout.prepareStyle(column)" style="padding:10px;border: 1px solid #ddd;position: absolute;"><button class="slds-button slds-button--icon slds-align--absolute-center" style="height: 100%; width: 100%" (click)="addDashlet(column)"><system-button-icon [icon]="\'add\'" [size]="\'medium\'" style="height: 100%; width: 100%"></system-button-icon></button></div></ng-container></ng-container></ng-container><dashboard-container-element *ngFor="let item of dashboardElements; trackBy: trackByItemFn" [item]="item"></dashboard-container-element><div *ngIf="isLoading" class="slds-align--absolute-center slds-grid slds-grid--vertical" system-to-bottom><system-spinner></system-spinner><div class="slds-m-around--medium slds-text-heading--small"><system-label label="MSG_LOADING_DASHBOARDS"></system-label></div></div><div *ngIf="!isLoading && dashboardlayout.dashboardNotFound" class="slds-align--absolute-center slds-grid slds-grid--vertical" style="height: 100%"><system-illustration-no-access></system-illustration-no-access></div><div *ngIf="!isLoading && dashboardElements.length == 0 && !dashboardlayout.dashboardNotFound && !isEditMode" class="slds-align--absolute-center slds-grid slds-grid--vertical" style="height: 100%"><system-illustration-no-records><system-label label="MSG_NO_RECORDS_FOUND"></system-label></system-illustration-no-records></div></div>'}),__metadata("design:paramtypes",[dashboardlayout,services_1.language,core_1.Renderer2,services_1.view,services_1.model])],e)}();exports.DashboardContainerBody=DashboardContainerBody;var DashboardContainerElement=function(){function e(e,t,s,o,i){this.dashboardlayout=e,this.metadata=t,this.renderer=s,this.model=o,this.view=i,this.componentRefs=[],this.isAuthorized=!0,this.item={},this.mouseMoveListener=void 0,this.mouseUpListener=void 0,this.mouseLast=null,this.mouseStart=null,this.mouseTarget="",this.isMoving=!1}return Object.defineProperty(e.prototype,"containerClass",{get:function(){return{"slds-scrollable--y":!this.view.isEditMode(),"slds-is-absolute":!this.dashboardlayout.compactView,"slds-m-vertical_xx-small":this.dashboardlayout.compactView}},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.renderDashlet()},e.prototype.renderDashlet=function(){for(var t=this,e=0,s=this.componentRefs;e<s.length;e++)s[e].destroy();window.setTimeout(function(){return t.isAuthorized=!t.item.module||t.metadata.checkModuleAcl(t.item.module,t.item.acl_action||"list")}),this.item.component&&this.isAuthorized&&this.metadata.addComponent(this.item.component,this.containerelement).subscribe(function(e){e.instance.dashletconfig=t.item.dashletconfig,e.instance.acl_action=t.item.acl_action,e.instance.icon=t.item.icon,e.instance.dashlet_id=t.item.dashlet_id,e.instance.componentconfig=t.item.componentconfig,e.instance.dashletModule=t.item.module,e.instance.dashletLabel=t.item.label,t.componentRefs.push(e)})},e.prototype.isEditing=function(){return this.view.isEditMode()&&this.item.id===this.dashboardlayout.editing},e.prototype.getBoxStyle=function(){var e=this.item.position,e=this.dashboardlayout.getElementStyle(e.top,e.left,e.width,e.height),e=this.dashboardlayout.applyMove(e,this.mouseTarget,this.mouseStart,this.mouseLast);return this.isEditing()&&(e.border="1px dashed #ca1b21",e.cursor="move",this.isMoving&&(e.opacity=".5",e["z-index"]="9999")),this.dashboardlayout.prepareStyle(e)},e.prototype.getBoundingBoxStyle=function(e){var t=this.item.position,t=this.dashboardlayout.getElementStyle(t.top,t.left,t.width,t.height),s=this.dashboardlayout.applyMove(t,this.mouseTarget,this.mouseStart,this.mouseLast),o={};switch(e){case"top":o={top:-4,left:s.width/2-4,cursor:"n-resize"};break;case"bottom":o={top:s.height-5,left:s.width/2-4,cursor:"s-resize"};break;case"left":o={top:s.height/2-4,left:"-4px",cursor:"w-resize"};break;case"right":o={left:s.width-5,top:s.height/2-4,cursor:"e-resize"}}return o["background-color"]="#fff",o.position="absolute",o.border="1px solid #ca1b21",o.width="8px",o.height="8px",this.dashboardlayout.prepareStyle(o)},e.prototype.onMousedown=function(e,t){var s=this;this.view.isEditMode()&&(this.mouseTarget=e,this.dashboardlayout.editing=this.item.id,this.mouseStart=t,this.mouseLast=t,this.mouseUpListener=this.renderer.listen("document","mouseup",function(e){return s.onMouseUp()}),this.mouseMoveListener=this.renderer.listen("document","mousemove",function(e){return s.onMouseMove(e)}),this.isMoving=!0,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1)},e.prototype.onMouseMove=function(e){this.view.isEditMode()&&(this.mouseLast=e),this.handleScrolling()},e.prototype.onMouseUp=function(){this.mouseUpListener(),this.mouseMoveListener(),this.dropItem(),this.mouseStart=null,this.mouseLast=null,this.mouseTarget="",this.isMoving=!1},e.prototype.handleScrolling=function(){var e,t,s;this.view.isEditMode()&&this.isMoving&&(e=this.mouseLast.pageY-this.mouseStart.pageY,t=this.item.position,t=this.dashboardlayout.getElementStyle(t.top,t.left,t.width,t.height),s="bottom"==this.mouseTarget?t.height+e:t.height,t="content"==this.mouseTarget?t.top+e+s:t.top+s,(s=this.dashboardlayout.bodyContainerRef).getBoundingClientRect().bottom-s.offsetTop-50<t&&(s.scrollTop+=5))},__decorate([core_1.ViewChild("containerelement",{read:core_1.ViewContainerRef,static:!(e.prototype.dropItem=function(){if(!this.mouseLast||!this.mouseStart)return!1;var e=this.mouseLast.pageY-this.mouseStart.pageY,t=this.mouseLast.pageX-this.mouseStart.pageX;this.dashboardlayout.dropElement(this.item.id,t,e,this.mouseTarget,this.mouseLast)})}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"containerelement",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Component({selector:"dashboard-container-element",template:'<div [ngStyle]="getBoxStyle()" class="slds-box--border slds-theme--default spice-scrollbar-thin" [ngClass]="containerClass" (mousedown)="onMousedown(\'content\', $event)"><div style="width: 100%; height: 100%" [style.overflow]="view.isEditMode() ? \'hidden\': \'initial\'"><div *ngIf="isAuthorized" #containerelement></div><div *ngIf="!isAuthorized" class="slds-align_absolute-center" style="height: 100%"><system-illustration-no-access></system-illustration-no-access></div></div><div *ngIf="view.isEditMode()" style="width: 100%; height: 100%; position: absolute;top: 0; left: 0;"></div><ng-container *ngIf="isEditing()"><div *ngIf="isEditing()" class="slds-is-absolute slds-m-around--x-small slds-align_absolute-center" style="top:0;right:0"><system-utility-icon style="cursor:pointer" [icon]="\'close\'" [size]="\'xx-small\'" (click)="dashboardlayout.deleteDashlet(item.id)"></system-utility-icon></div><div [ngStyle]="getBoundingBoxStyle(\'top\')" (mousedown)="onMousedown(\'top\', $event)"></div><div [ngStyle]="getBoundingBoxStyle(\'right\')" (mousedown)="onMousedown(\'right\', $event)"></div><div [ngStyle]="getBoundingBoxStyle(\'bottom\')" (mousedown)="onMousedown(\'bottom\', $event)"></div><div [ngStyle]="getBoundingBoxStyle(\'left\')" (mousedown)="onMousedown(\'left\', $event)"></div></ng-container></div>'}),__metadata("design:paramtypes",[dashboardlayout,services_1.metadata,core_1.Renderer2,services_1.model,services_1.view])],e)}();exports.DashboardContainerElement=DashboardContainerElement;var DashboardAddElement=function(){function DashboardAddElement(e,t,s){this.language=e,this.metadata=t,this.backend=s,this.self={},this.kreports=[],this.dashboarddashlets=[],this.dashletName="",this.searchKey="",this.dashlettype="Generic",this.dashletModule="*",this.isLoading=!1,this.canLoadMore=!0,this.loadLimit=40,this.addDashlet=new core_1.EventEmitter,this.modules=[]}return Object.defineProperty(DashboardAddElement.prototype,"kReports",{get:function(){var t=this;return"*"==this.dashletModule?this.kreports:this.kreports.filter(function(e){return e.report_module==t.dashletModule})},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardAddElement.prototype,"dashboardDashlets",{get:function(){var t=this;return this.dashboarddashlets.filter(function(e){return("*"==t.dashletModule||e.module==t.dashletModule)&&(0==t.searchKey.length||-1<t.language.getLabel(e.label).toLowerCase().indexOf(t.searchKey.toLowerCase()))&&t.metadata.checkModuleAcl(e.module,"list")})},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardAddElement.prototype,"dashletType",{get:function(){return this.dashlettype},set:function(e){this.dashlettype=e,this.resetValues(),"Generic"===e?this.getDashlets():this.getKReports()},enumerable:!1,configurable:!0}),DashboardAddElement.prototype.ngOnInit=function(){this.getDashlets(),this.modules=this.metadata.getModules().sort()},DashboardAddElement.prototype.resetValues=function(){this.dashletModule="*",this.searchKey="",this.canLoadMore=!0},DashboardAddElement.prototype.search=function(){var e=this;"Generic"!==this.dashletType&&(this.searchTimeout&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout(function(){return e.getKReports()},600))},DashboardAddElement.prototype.trackByFn=function(e,t){return e},DashboardAddElement.prototype.getDashlets=function(){var t=this;this.isLoading=!0,this.dashboarddashlets=[],this.backend.getRequest("module/Dashboards/dashlets").subscribe(function(e){t.dashboarddashlets=e,t.isLoading=!1})},DashboardAddElement.prototype.getKReports=function(){var t=this;this.isLoading=!0,this.kreports=[];var e={offset:0,limit:this.loadLimit,searchKey:this.searchKey};this.backend.getRequest("module/KReports/published/"+this.dashletType,e).subscribe(function(e){t.kreports=e,t.isLoading=!1})},DashboardAddElement.prototype.getMoreKReports=function(){var e,t=this;this.canLoadMore&&!this.isLoading&&(this.isLoading=!0,e={offset:this.kReports.length,limit:this.loadLimit},this.backend.getRequest("module/KReports/published/"+this.dashletType,e).subscribe(function(e){t.kreports=t.kReports.concat(e),t.canLoadMore=e.length==t.loadLimit,t.isLoading=!1}))},DashboardAddElement.prototype.getIcon=function(e){return e&&e.split(":")[1]?e.split(":")[1]:e},DashboardAddElement.prototype.getSprite=function(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"},DashboardAddElement.prototype.onScroll=function(e){e.scrollTop+e.clientHeight>=e.scrollHeight&&this.getMoreKReports()},DashboardAddElement.prototype.add=function(e){if(e){var t=this.dashletName,s="",o={},i={},a="",d="",r="",n="",l="";switch(this.dashletType){case"dashletVisualization":s="ReporterVisualizationDashlet",o={reportid:e.id},a="KReports";break;case"dashletPresentation":s="ReporterPresentationDashlet",o={reportid:e.id},a="KReports";break;case"Generic":s=e.component,n=e.id,i=e.componentconfig?JSON.parse(e.componentconfig):"",a=e.module,l=e.label,d=e.icon,r=e.acl_action}this.addDashlet.emit({name:t,label:l,module:a,component:s,componentconfig:o,dashletconfig:i,icon:d,acl_action:r,dashlet_id:n}),this.self.destroy()}},DashboardAddElement.prototype.close=function(){this.addDashlet.emit(!1),this.self.destroy()},__decorate([core_1.Component({selector:"dashboard-add-element",template:'<system-modal size="large"><system-modal-header (close)="close()"><system-label label="LBL_ADD_DASHLET"></system-label></system-modal-header><system-modal-content [grow]="true" style="overflow-y: hidden"><div class="slds-grid" style="height: 80px"><div class="slds-form-element slds-size--1-of-3"><label class="slds-form-element__label"><system-label label="LBL_TYPE"></system-label></label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="dashletType"><option value="Generic"><system-label label="LBL_DASHLET"></system-label></option><option value="dashletVisualization"><system-label label="LBL_REPORT_CHART"></system-label></option><option value="dashletPresentation"><system-label label="LBL_REPORT_LIST"></system-label></option></select></div></div></div><div class="slds-form-element slds-size--1-of-3 slds-p-left--small"><label class="slds-form-element__label"><system-label label="LBL_MODULE"></system-label></label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="dashletModule"><option value="*">All</option><option *ngFor="let module of modules" [value]="module">{{module}}</option></select></div></div></div><div class="slds-form-element slds-size--1-of-3 slds-p-left--small"><label class="slds-form-element__label"><system-label label="LBL_SEARCH"></system-label></label><div class="slds-form-element__control"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><input type="text" class="slds-lookup__search-input slds-input" [(ngModel)]="searchKey" (keyup)="search()"><system-utility-icon *ngIf="searchKey.length == 0" icon="search" addclasses="slds-input__icon"></system-utility-icon><button *ngIf="searchKey.length > 0" class="slds-button slds-input__icon slds-input__icon_right" (click)="searchKey = \'\'"><system-button-icon icon="clear"></system-button-icon></button></div></div></div></div><div style="height: calc(100% - 80px)"><div #scrollElement class="slds-scrollable--y" style="height: 100%" (scroll)="onScroll(scrollElement)"><div *ngIf="dashletType === \'Generic\'" class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let dashlet of dashboardDashlets; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="add(dashlet)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [icon]="getIcon(dashlet.icon)" [sprite]="getSprite(dashlet.icon)" [module]="!dashlet.module ? \'Dashboards\': dashlet.module" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-border_left slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate" [title]="dashlet.label"><system-label [label]="dashlet.label"></system-label></h2><p class="slds-m-top_small slds-truncate"><system-label [label]="dashlet.label" length="long"></system-label></p></div></a></div></div></div><div *ngIf="dashletType !== \'Generic\'" class="slds-form-element slds-lookup"><div class="slds-grid slds-wrap"><div *ngFor="let kReport of kReports; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="add(kReport)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [module]="kReport.report_module" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-border_left slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate" [title]="kReport.name">{{kReport.name}}</h2><p class="slds-m-top_small slds-truncate">{{kReport.description}}</p></div></a></div></div></div><system-spinner *ngIf="isLoading"></system-spinner></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.backend])],DashboardAddElement)}();exports.DashboardAddElement=DashboardAddElement;var DashboardWeatherDashlet=function(){function DashboardWeatherDashlet(e,t,s){this.http=e,this.language=t,this.metadata=s,this.sortedDays=void 0,this.cityName=void 0,this.daytoshow=void 0,this.dayHourToShow=void 0,this.todayOnly=!1,this.forecastCity="Vienna",this.apiId="ba76af382fdb47888b5a080d6c7122b5",this.isLoading=!1}return Object.defineProperty(DashboardWeatherDashlet.prototype,"dayToShow",{get:function(){return this.daytoshow},set:function(e){this.daytoshow=e,this.dayHourToShow=8==e.length?e[4]:e[0]},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardWeatherDashlet.prototype,"description",{get:function(){if(this.dayHourToShow){for(var e=[],t=0,s=this.dayHourToShow.weather[0].description.split(" ");t<s.length;t++){var o=s[t];e.push(o.replace(/\S/,function(e){return e.toUpperCase()}))}return e.join(" ")}},enumerable:!1,configurable:!0}),DashboardWeatherDashlet.prototype.ngOnInit=function(){var t=this,e=this.metadata.getComponentConfig("DashboardWeatherDashlet","Dashboards");e.hasOwnProperty("apiid")&&(this.apiId=e.apiid),e.hasOwnProperty("city")&&""!=e.city?this.getForecastData("q="+e.city):navigator.geolocation&&(this.isLoading=!0,navigator.geolocation.getCurrentPosition(function(e){e="lat="+e.coords.latitude+"&lon="+e.coords.longitude;t.getForecastData(e)},function(e){e.code==e.PERMISSION_DENIED&&t.getForecastData("q="+t.forecastCity),t.isLoading=!1})),this.todayOnly=!!e.hasOwnProperty("todayonly")&&e.todayonly},DashboardWeatherDashlet.prototype.getForecastData=function(e){var t=this;this.isLoading=!0,this.http.get("proxy/?useurl="+btoa("http://api.openweathermap.org/data/2.5/forecast?"+e+"&APPID="+this.apiId)).subscribe(function(e){e.city&&(t.cityName=e.city.name),e.list&&t.resortDays(e.list)}),this.isLoading=!1},DashboardWeatherDashlet.prototype.resortDays=function(e){if(e){for(var t=[],s=[],e=e.sort(function(e,t){return e.dt-t.dt}),o=new Date(1e3*e[0].dt).getDay(),i=0,a=e;i<a.length;i++){var d=a[i],r=new Date(1e3*d.dt).getDay();o==r?s.push(d):(o=r,t.push(s),(s=[]).push(d))}this.sortedDays=t,this.dayToShow=t[0]}},DashboardWeatherDashlet.prototype.setDayToShow=function(e){this.dayToShow=e},DashboardWeatherDashlet.prototype.setDayHourToShow=function(e){this.dayHourToShow=e},DashboardWeatherDashlet.prototype.getHour=function(e){return moment.unix(e).format("H")+":00"},DashboardWeatherDashlet.prototype.getDayName=function(e,t){void 0===t&&(t=!1);e=new Date(1e3*e).getDay();return t?moment.weekdaysShort(e):moment.weekdays(e)},DashboardWeatherDashlet.prototype.getTemperature=function(e){return Math.round(parseInt(e,10)-273.15)},DashboardWeatherDashlet.prototype.getWind=function(e){return Math.round(3.6*e.speed)},DashboardWeatherDashlet.prototype.getWeatherIconUrl=function(e){return"proxy/?useurl="+btoa("http://openweathermap.org/img/w/"+e+".png")},DashboardWeatherDashlet.prototype.trackByFn=function(e,t){return e},__decorate([core_1.Component({template:'<div *ngIf="sortedDays && sortedDays[0]" style="height: 100%"><div class="slds-p-around--x-small"><h2 *ngIf="cityName" class="slds-text-heading--medium">Weather in {{cityName}}</h2><div *ngIf="dayHourToShow" [ngClass]="todayOnly ? \'slds-border--bottom slds-p-bottom--xxx-small\' : \'\'"><div class="slds-text-body--regular"><span>{{getDayName(dayHourToShow.dt)}} <span *ngIf="todayOnly">, {{description}}</span></span> <span *ngIf="!todayOnly" class="slds-p-left--x-small">{{getHour(dayHourToShow.dt)}}</span></div><div *ngIf="!todayOnly" class="slds-text-body--regular">{{description}}</div></div></div><div *ngIf="dayHourToShow" class="slds-grid slds-p-horizontal--x-small"><div class="slds-grid slds-size--1-2 slds-grid--vertical-align-center"><img width="50px" height="50px" [src]="getWeatherIconUrl(dayHourToShow.weather[0].icon)"><div class="slds-text-heading--large slds-grid slds-grid--vertical-align-center">{{getTemperature(dayHourToShow.main.temp)}}Â°C</div></div><div class="slds-size--2-of-2 slds-p-left--medium"><div class="slds-text-body--regular">Clouds: {{dayHourToShow.clouds.all}}%</div><div class="slds-text-body--regular">Humidity: {{dayHourToShow.main.humidity}}%</div><div class="slds-text-body--regular">Wind: {{getWind(dayHourToShow.wind)}}km/h</div></div></div><ng-container *ngIf="!todayOnly"><div class="slds-grid slds-m-top--small slds-m-bottom--xx-small slds-p-horizontal--x-small slds-p-vertical--small slds-border--top slds-border--bottom"><div *ngFor="let dayHour of dayToShow; trackBy: trackByFn" class="slds-size--1-of-5 slds-text-body--small" [ngClass]="(dayHour.dt == dayHourToShow.dt) ? \'slds-text-color--error\': \'\'" style="cursor: pointer; max-width: 2.2rem" (click)="setDayHourToShow(dayHour)">{{getHour(dayHour.dt)}}</div></div><div class="slds-grid slds-m-horizontal--xx-small"><div *ngFor="let day of sortedDays; let first = first; trackBy: trackByFn" class="slds-size--1-of-5 slds-p-vertical--xx-small" style="cursor: pointer; max-width: 4.3rem" [ngStyle]="(getDayName(first ? day[0].dt : day[4].dt) == getDayName(dayHourToShow.dt)) ? {\'background-color\': \'#faf7f7\', \'border\': \'1px solid #e0dfdf\'}: {}" (click)="setDayToShow(day)"><div class="slds-text-body--regular slds-text-align--center">{{getDayName(day[0].dt, true)}}</div><div class="slds-text-align--center"><img [src]="getWeatherIconUrl(first ? day[0].weather[0].icon : day[4].weather[0].icon)"></div><div class="slds-text-body--regular slds-text-align--center"><span>{{getTemperature(first ? day[0].main.temp_max : day[4].main.temp_max)}}Â°</span> <span c></span></div></div></div></ng-container></div><div *ngIf="isLoading && !sortedDays" class="slds-align--absolute-center" style="height: 100%"><system-spinner></system-spinner></div><div *ngIf="!sortedDays && !isLoading" class="slds-align--absolute-center slds-text-heading--small" style="height: 100%">Weather forecast is currently unavailable</div>'}),__metadata("design:paramtypes",[http_1.HttpClient,services_1.language,services_1.metadata])],DashboardWeatherDashlet)}();exports.DashboardWeatherDashlet=DashboardWeatherDashlet;var DashboardGenericDashlet=function(){function DashboardGenericDashlet(e,t,s,o,i,a){var d=this;this.language=e,this.metadata=t,this.backend=s,this.model=o,this.broadcast=i,this.elementRef=a,this.loading=!0,this.records=[],this.recordcount=0,this.recordtotal=0,this.dashletconfig=null,this.dashletModule=void 0,this.dashletLabel=void 0,this.dashletFields=[],this.dashletFieldSet=void 0,this.loadLimit=50,this.subscriptions=new rxjs_1.Subscription,this.sortparams={sortdirection:"",sortfield:""},this.subscriptions.add(this.broadcast.message$.subscribe(function(e){d.handleMessage(e)}))}return Object.defineProperty(DashboardGenericDashlet.prototype,"canLoadMore",{get:function(){return this.recordtotal>this.records.length},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardGenericDashlet.prototype,"dashletTitle",{get:function(){return this.language.getLabel(this.dashletLabel)},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardGenericDashlet.prototype,"islarge",{get:function(){return 768<window.innerWidth},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardGenericDashlet.prototype,"tableContainerStyle",{get:function(){return{height:"calc(100% - "+this.headercontainer.element.nativeElement.getBoundingClientRect().height+"px)"}},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardGenericDashlet.prototype,"params",{get:function(){var e={};if(this.dashletconfig){if(this.dashletconfig.fieldset&&(this.dashletFields=this.metadata.getFieldSetFields(this.dashletconfig.fieldset),this.dashletFieldSet=this.dashletconfig.fieldset),this.dashletconfig.filters)for(var t in this.dashletconfig.filters)this.dashletconfig.filters.hasOwnProperty(t)&&(e[t]=this.dashletconfig.filters[t]);this.dashletconfig.modulefilter&&(e.modulefilter=this.dashletconfig.modulefilter),e.sortfields=[{sortfield:this.dashletconfig.sortfield,sortdirection:this.dashletconfig.sortdirection}]}return e.limit=this.loadLimit,e},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardGenericDashlet.prototype,"tablestyle",{get:function(){return{height:"calc(98% - "+this.headercontainer.element.nativeElement.clientHeight+"px"}},enumerable:!1,configurable:!0}),DashboardGenericDashlet.prototype.ngOnInit=function(){this.model.module=this.dashletModule,this.loadLimit=this.dashletconfig&&this.dashletconfig.limit?this.dashletconfig.limit:this.loadLimit,this.loadRecords()},DashboardGenericDashlet.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},DashboardGenericDashlet.prototype.loadRecords=function(){var t=this,e=this.params;this.dashletModule&&this.backend.getRequest("module/"+this.dashletModule,e).subscribe(function(e){t.records=e.list,t.recordcount=+e.list.length,t.recordtotal=e.totalcount,t.loading=!1})},DashboardGenericDashlet.prototype.trackByFn=function(e,t){return t.id},DashboardGenericDashlet.prototype.onScroll=function(){var e=this.tablecontainer.element.nativeElement;e.scrollTop+e.clientHeight>=e.scrollHeight-5&&this.loadMore()},DashboardGenericDashlet.prototype.loadMore=function(){var e,t=this;this.canLoadMore&&!this.loading&&(this.loading=!0,(e=this.params).offset=this.records.length,this.backend.getRequest("module/"+this.dashletModule,e).subscribe(function(e){t.records=t.records.concat(e.list),t.recordcount+=+e.list.length,t.loading=!1}))},DashboardGenericDashlet.prototype.handleMessage=function(t){if(t.messagedata.module===this.dashletModule)switch(t.messagetype){case"model.delete":var e=this.records.findIndex(function(e){return e.id==t.messagedata.id});0<=e&&(this.records.splice(e,1),this.recordcount--,this.recordtotal--);break;case"model.save":0<=this.records.findIndex(function(e){return e.id==t.messagedata.id})&&(this.records=[],this.loadRecords())}},DashboardGenericDashlet.prototype.isSortable=function(e){return!0===e.fieldconfig.sortable},DashboardGenericDashlet.prototype.getSortIcon=function(){return"ASC"===this.sortparams.sortdirection?"arrowdown":"arrowup"},DashboardGenericDashlet.prototype.setSortField=function(e){this.isSortable(e)&&(this.sortparams.sortfield==e.field?this.sortparams.sortdirection="ASC"==this.sortparams.sortdirection?"DESC":"ASC":(this.sortparams.sortfield=e.field,this.sortparams.sortdirection="ASC"),this.loadRecords())},__decorate([core_1.ViewChild("tablecontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],DashboardGenericDashlet.prototype,"tablecontainer",void 0),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],DashboardGenericDashlet.prototype,"headercontainer",void 0),__decorate([core_1.Component({selector:"dashboard-generic-dashlet",template:'<div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon [module]="dashletModule" [size]="\'small\'"></system-icon><h2 class="slds-text-heading--medium slds-p-bottom--xx-small">{{dashletTitle}} ({{recordcount}} <system-label label="LBL_OF"></system-label> {{recordtotal}})</h2></div><div #tablecontainer class="slds-size--1-of-1 slds-scrollable--y" [ngStyle]="tableContainerStyle" (scroll)="onScroll()"><table class="slds-table slds-table--bordered slds-table--fixed-layout slds-max-medium-table--stacked-horizontal slds-table--header-fixed"><thead *ngIf="islarge"><tr class="slds-text-title_caps"><th class="slds-resizable" scope="col" *ngFor="let field of dashletFields; let isFirst = first; trackBy: trackByFn" system-resize [ngClass]="{\'slds-is-sortable\' : isSortable(field)}"><div class="slds-truncate"><ng-container *ngIf="isSortable(field); else nosort"><a href="javascript:void(0);" class="slds-th__action slds-text-link--reset" (click)="setSortField(field)"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="field.field" [fieldconfig]="field.fieldconfig"></field-label><system-utility-icon [icon]="getSortIcon()" addclasses="slds-is-sortable__icon" size="x-small"></system-utility-icon></a></ng-container><ng-template #nosort><field-label [fieldname]="field.field" [fieldconfig]="field.fieldconfig" addclasses="slds-truncate slds-p-vertical--xx-small slds-p-horizontal--x-small"></field-label></ng-template></div></th></tr></thead><tbody><ng-container *ngFor="let record of records; trackBy: trackByFn"><div class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small slds-hide--medium slds-text-title_bold">{{record.summary_text}}</div><tr dashboard-generic-dashlet-row [module]="dashletModule" [fieldset]="dashletFieldSet" [data]="record"></tr></ng-container></tbody><tbody system-table-stencils [columns]="dashletFields?.length" [select]="false" [tools]="false" [rows]="5" *ngIf="loading"></tbody></table><div *ngIf="!loading && records.length == 0" class="slds-align_absolute-center" style="height: calc(100% - 5px);"><system-illustration-no-records><system-label label="MSG_NO_RECORDS_FOUND"></system-label></system-illustration-no-records></div></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.backend,services_1.model,services_1.broadcast,core_1.ElementRef])],DashboardGenericDashlet)}();exports.DashboardGenericDashlet=DashboardGenericDashlet;var DashboardGenericDashletRow=function(){function e(e,t,s,o,i){this.language=e,this.metadata=t,this.model=s,this.view=o,this.modelutilities=i,this.fieldsetfields=[],this.module="",this.fieldset="",this.data={},this.view.isEditable=!1,this.view.displayLabels=!1}return e.prototype.ngOnInit=function(){this.model.module=this.module,this.model.id=this.data.id,this.model.acl=this.data.acl,this.model.data=this.modelutilities.backendModel2spice(this.module,this.data),this.fieldsetfields=this.metadata.getFieldSetFields(this.fieldset)},e.prototype.trackByFn=function(e,t){return t.id},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldset",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"data",void 0),__decorate([core_1.Component({selector:"[dashboard-generic-dashlet-row]",template:'<ng-container *ngFor="let field of fieldsetfields; trackBy: trackByFn"><td style="min-width: 8rem" [attr.data-label]="language.getFieldDisplayName(module, field.field)"><field-container [field]="field.field" [fieldconfig]="field.fieldconfig" [fielddisplayclass]="\'slds-truncate\'"></field-container></td></ng-container>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.view,services_1.modelutilities])],e)}();exports.DashboardGenericDashletRow=DashboardGenericDashletRow;var DashboardRemindersDashlet=function(){function DashboardRemindersDashlet(e,t,s,o){this.language=e,this.metadata=t,this.reminder=s,this.router=o,this.dashletLabel=void 0}return Object.defineProperty(DashboardRemindersDashlet.prototype,"recordcount",{get:function(){return this.reminder.reminders.length},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardRemindersDashlet.prototype,"dashletTitle",{get:function(){return this.language.getLabel(this.dashletLabel)},enumerable:!1,configurable:!0}),Object.defineProperty(DashboardRemindersDashlet.prototype,"reminders",{get:function(){return this.reminder.reminders.map(function(e){return e.reminder_date=new moment(e.reminder_date),e}).sort(function(e,t){return e.reminder_date-t.reminder_date})},enumerable:!1,configurable:!0}),DashboardRemindersDashlet.prototype.trackByFn=function(e,t){return t.item_id},DashboardRemindersDashlet.prototype.goRecord=function(e,t){this.router.navigate(["/module/"+e+"/"+t])},DashboardRemindersDashlet.prototype.deleteRecord=function(e,t){this.reminder.deleteReminder(e,t)},DashboardRemindersDashlet.prototype.getReminderDate=function(e){return e.format("DD.MM.YYYY")},DashboardRemindersDashlet.prototype.isOverdue=function(e){return e<new moment},__decorate([core_1.Component({selector:"dashboard-reminders-dashlet",template:'<div style="height: 100%; overflow: hidden;"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon [icon]="\'clock\'" [sprite]="\'utility\'" [size]="\'small\'"></system-icon><h2 class="slds-text-heading--medium slds-p-bottom--xx-small">{{dashletTitle}} ({{recordcount}})</h2></div><div *ngFor="let reminder of reminders; trackBy: trackByFn" class="slds-p-around--x-small slds-grid"><div class="slds-media"><div class="slds-media__figure"><system-icon [module]="reminder.module_name" [size]="\'small\'"></system-icon></div><div class="slds-media__body"><div class="slds-text-title_caps slds-text-link_reset" (click)="goRecord(reminder.module_name, reminder.item_id)">{{reminder.item_summary}}</div><div class="slds-text-body_small slds-line-height_reset" [ngClass]="{\'slds-text-color_error\': isOverdue(reminder.reminder_date)}">{{getReminderDate(reminder.reminder_date)}}</div></div></div><system-utility-icon class="slds-col_bump-left" [icon]="\'delete\'" [size]="\'x-small\'" style="cursor: pointer" (click)="deleteRecord(reminder.module_name, reminder.item_id)"></system-utility-icon></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.reminder,router_1.Router])],DashboardRemindersDashlet)}();exports.DashboardRemindersDashlet=DashboardRemindersDashlet;var DashboardComponentset=function(){function DashboardComponentset(e){this.metadata=e,this.componentRefs=[]}return DashboardComponentset.prototype.ngAfterViewInit=function(){this.renderComnponentset()},DashboardComponentset.prototype.ngOnDestroy=function(){for(var e=0,t=this.componentRefs;e<t.length;e++)t[e].destroy()},DashboardComponentset.prototype.renderComnponentset=function(){var s=this;if(this.dashletconfig&&this.dashletconfig.componentset)for(var e=this,t=0,o=this.metadata.getComponentSetObjects(this.dashletconfig.componentset);t<o.length;t++)!function(t){e.metadata.addComponent(t.component,e.componentcontainer).subscribe(function(e){e.instance.componentconfig=t.componentconfig,s.componentRefs.push(e)})}(o[t])},__decorate([core_1.ViewChild("componentcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],DashboardComponentset.prototype,"componentcontainer",void 0),__decorate([core_1.Component({selector:"dashboard-componentset",template:"<div #componentcontainer></div>"}),__metadata("design:paramtypes",[services_1.metadata])],DashboardComponentset)}();exports.DashboardComponentset=DashboardComponentset;var DashboardSelectPanelAddButton=function(){function e(e,t,s){this.model=e,this.modellist=t,this.dashboardlayout=s,this.dashboardAdded=new core_1.EventEmitter,this.model.module="Dashboards"}return e.prototype.addDashboard=function(){var t=this;this.model.reset(),this.model.module="Dashboards",this.model.addModel().subscribe(function(e){e&&(t.modellist.listData.list.push(e),t.dashboardAdded.emit({id:e.id}))})},__decorate([core_1.Output(),__metadata("design:type",Object)],e.prototype,"dashboardAdded",void 0),__decorate([core_1.Component({selector:"dashboard-select-panel-add-button",template:'<button class="slds-show--large slds-button slds-button_icon slds-button_icon-border" (click)="addDashboard()"><system-button-icon [icon]="\'add\'"></system-button-icon></button>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.model,services_1.modellist,dashboardlayout])],e)}();exports.DashboardSelectPanelAddButton=DashboardSelectPanelAddButton;var ModuleDashboard=function(){function ModuleDashboard(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[DashboardView,DashboardSelectPanel,DashboardContainer,DashboardContainerHeader,DashboardContainerHomeHeader,DashboardContainerBody,DashboardContainerElement,DashboardAddElement,DashboardWeatherDashlet,DashboardGenericDashlet,DashboardGenericDashletRow,DashboardRemindersDashlet,DashboardComponentset,DashboardSelectPanelAddButton],exports:[DashboardContainer]})],ModuleDashboard)}();exports.ModuleDashboard=ModuleDashboard;