/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-15 09:34:54
 * build: 2021.02.001.1626334494999
 **/
"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var a in t=arguments[s])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,s,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,n);else for(var i=e.length-1;0<=i;i--)(a=e[i])&&(o=(r<3?a(o):3<r?a(t,s,o):a(t,s))||o);return 3<r&&o&&Object.defineProperty(t,s,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__spreadArray=this&&this.__spreadArray||function(e,t){for(var s=0,n=t.length,a=e.length;s<n;s++,a++)e[a]=t[s];return e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleCalendar=exports.CalendarThreeDaysDashlet=exports.CalendarDayDashlet=exports.CalendarScheduleDashlet=exports.CalendarColorPicker=exports.CalendarOtherCalendarsMonitor=exports.CalendarAddModulesModal=exports.CalendarAddCalendar=exports.CalendarMoreButton=exports.CalendarGoogleEventPopover=exports.CalendarMorePopover=exports.CalendarSheetSchedule=exports.CalendarSheetMonth=exports.CalendarSheetThreeDays=exports.CalendarSheetWeek=exports.CalendarSheetDay=exports.CalendarSheetGoogleEvent=exports.CalendarSheetEvent=exports.Calendar=exports.CalendarSheetDropTarget=exports.CalendarHeader=exports.calendar=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),drag_drop_1=require("@angular/cdk/drag-drop"),services_1=require("../../services/services"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),directives_1=require("../../directives/directives"),rxjs_1=require("rxjs"),operators_1=require("rxjs/operators"),calendar=function(){function e(e,t,s,n,a,r,o,i,l){this.backend=e,this.session=t,this.broadcast=s,this.modal=n,this.language=a,this.configuration=r,this.modelutilities=o,this.cdRef=i,this.userPreferences=l,this.userCalendarChange$=new core_1.EventEmitter,this.addingEvent$=new core_1.EventEmitter,this.pickerDate$=new core_1.EventEmitter,this.otherCalendarsColor$=new core_1.EventEmitter,this.modules=[],this.ownerCalendarVisible=!0,this.usersCalendars=[],this.otherCalendars=[],this.calendars={},this.currentStart={},this.currentEnd={},this.sheetTimeWidth=50,this.sheetHourHeight=80,this.weekstartday=0,this.weekDaysCount=7,this.startHour=0,this.endHour=23,this.multiEventHeight=25,this.todayColor="#eb7092",this.absenceColor="#727272",this.eventColor="#039be5",this.googleColor="#db4437",this.loggedByGoogle=!1,this.asPicker=!1,this.isMobileView=!1,this.isDashlet=!1,this.isLoading=!1,this.userPreferencesLoaded=!1,this.duration={Day:"d",Three_Days:"d",Week:"w",Month:"M",Schedule:"M"},this.colorPalette=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"],this.subscriptions=new rxjs_1.Subscription,this._sidebarWidth=360,this._calendarDate=moment(),this._sheetType="Week",this.loadCalendarModules(),this.loadPreferences(),this.subscribeToLanguage(),this.getCalendarPreferences(),this.broadcastSubscriber()}var t;return Object.defineProperty(e.prototype,"sidebarWidth",{get:function(){return this.isMobileView||this.isDashlet?0:this._sidebarWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calendarDate",{get:function(){return this._calendarDate},set:function(e){this._calendarDate=new moment(e).locale(this.language.currentlanguage.substring(0,2)),this.session.setSessionData("calendarDate",this._calendarDate)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sheetType",{get:function(){return this._sheetType},set:function(e){this._sheetType=e,this.session.setSessionData("sheetType",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.session.authData.userId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownerName",{get:function(){return this.session.authData.userName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weekStartDay",{get:function(){return this.weekstartday},set:function(e){this.weekstartday=e},enumerable:!1,configurable:!0}),e.prototype.refresh=function(e){this.currentStart={},this.currentEnd={},this.triggerSheetReload(e)},e.prototype.shiftPlus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this._calendarDate=new moment(this._calendarDate.add(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.add(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.shiftMinus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay&&(this._calendarDate=new moment(this._calendarDate.subtract(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.subtract(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.doReload=function(e,t,s){var n=!this.calendars[s]||this.calendars[s]&&0==this.calendars[s].length,a=!(this.currentStart[s]&&this.currentEnd[s]&&this.currentStart[s].isSame(e)&&this.currentEnd[s].isSame(t));return n||a},e.prototype.loadUserEvents=function(e,t,s){var n=this;return this.loadEvents(e,t,this.owner,[s],!0).pipe(operators_1.map(function(e){return e.map(function(e){return e.id=s+e.id,e.otherColor=n.usersCalendars.find(function(e){return e.id==s}).color,e})}))},e.prototype.loadUsersEvents=function(e,t){var s=this.usersCalendars.filter(function(e){return!!e.visible}),n=s.map(function(e){return e.id}),a=_.object(n,s);return 0==s.length?rxjs_1.of([]):this.loadEvents(e,t,this.owner,n).pipe(operators_1.map(function(e){var s=[];return e.forEach(function(t){if(a[t.data.assigned_user_id])t.otherColor=a[t.data.assigned_user_id].color,s.push(t);else if(t.data.meeting_user_status_accept){var e=n.find(function(e){return!!t.data.meeting_user_status_accept.beans[e]});if(!e)return;t.id=e+t.id,t.otherColor=a[e].color,s.push(t)}}),s}))},e.prototype.loadEvents=function(a,e,t,s,n){var r=this;void 0===t&&(t=this.owner),void 0===s&&(s=[]);var o=0<s.length?"users":t;if(n||this.doReload(a,e,o)){this.isLoading=!0,this.cdRef.detectChanges();var i=new rxjs_1.Subject,l="YYYY-MM-DD HH:mm:ss",d={start:a.tz("utc").format(l),end:e.tz("utc").format(l),users:s},c=0<s.length?"module/Calendar/users/":"module/Calendar/";return this.currentEnd[o]=e,this.currentStart[o]=a,this.backend.getRequest(c+t,d).subscribe(function(e){r.calendars[o]=[];for(var t=function(t){if(o==r.owner&&t.data.external_id&&r.calendars.google&&r.calendars.google.some(function(e){return e.id==t.data.external_id})||r.otherCalendars.some(function(e){return e.name==t.module&&!e.visible}))return"continue";switch(t.type){case"event":t.start=moment.utc(t.start).tz(r.timeZone),t.end=moment.utc(t.end).tz(r.timeZone),t.isMulti=0<+t.end.diff(t.start,"days"),t.color=r.eventColor;break;case"absence":t.start=moment(t.start).second(1),t.end=moment(t.end).second(1),t.isMulti=!0,t.color=r.absenceColor;break;case"other":t.start=moment(t.start).year(a.year()).second(1),t.end=moment(t.end).year(a.year()).second(1),t.isMulti=!0}if("UserAbsences"==t.module&&("other"==t.type&&(t.data.summary_text=t.data.user_name,t.id=t.id+"-other",t.data.id=t.data.id+"-other"),r.absenceExists(t)))return"continue";r.calendars[o].push(t)},s=0,n=e;s<n.length;s++){t(n[s])}r.isLoading=!1,r.cdRef.detectChanges(),i.next(r.calendars[o]),i.complete()}),i.asObservable()}for(var h=[],u=function(t){if(p.otherCalendars.some(function(e){return e.name==t.module&&!e.visible}))return"continue";t.start<e&&t.end>a&&(t.start=moment(t.start).tz(p.timeZone),t.end=moment(t.end).tz(p.timeZone),h.push(t))},p=this,v=0,g=this.calendars[o];v<g.length;v++){u(g[v])}return rxjs_1.of(h)},e.prototype.loadGoogleEvents=function(e,t){var a=this;if(!this.loggedByGoogle)return rxjs_1.of([]);if(this.doReload(e,t,"google")){this.isLoading=!0,this.cdRef.detectChanges();var r=new rxjs_1.Subject,s="YYYY-MM-DD HH:mm:ss",n={startdate:e.format(s),enddate:t.format(s)};return this.calendars.google=[],this.currentEnd.google=t,this.currentStart.google=e,this.backend.getRequest("channels/groupware/gsuite/calendar/events",n).subscribe(function(e){if(e.events&&0<e.events.length)for(var t=function(t){if(a.calendars[a.owner]&&a.calendars[a.owner].some(function(e){return e.data.external_id==t.id}))return"continue";t.start=moment(t.start.dateTime||t.start.date).format("YYYY-MM-DD HH:mm:ss"),t.end=moment(t.end.dateTime||t.end.date).format("YYYY-MM-DD HH:mm:ss"),t.start=moment(t.start).second(1),t.end=moment(t.end).second(1),t.isMulti=0<+t.end.diff(t.start,"days"),t.color=a.googleColor,t.type="google",a.calendars.google.push(t)},s=0,n=e.events;s<n.length;s++){t(n[s])}a.isLoading=!1,a.cdRef.detectChanges(),r.next(a.calendars.google),r.complete()}),r.asObservable()}for(var o=[],i=0,l=this.calendars.google;i<l.length;i++){var d=l[i];d.start<t&&d.end>e&&o.push(d)}return rxjs_1.of(o)},e.prototype.getEvents=function(e){return void 0===e&&(e=this.owner),this.calendars[e]?this.calendars[e]:[]},e.prototype.setOtherCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.otherCalendars=e,t&&(this.userPreferences.setPreference("Other",this.otherCalendars,!0,"Calendar"),this.triggerSheetReload()))},e.prototype.addUserCalendar=function(e,t){if(!this.isMobileView&&!this.isDashlet){var s=this.usersCalendars,n={id:e,name:t,visible:!0,color:"#"+this.colorPalette[Math.floor(this.colorPalette.length*Math.random())]};s.push(n),this.userCalendarChange$.emit(n),this.setUserCalendars(s.slice())}},e.prototype.removeUserCalendar=function(t){if(!this.isMobileView&&!this.isDashlet){var e=this.usersCalendars.find(function(e){return e.id==t});e.visible=!1,this.userCalendarChange$.emit(e);var s=this.usersCalendars.filter(function(e){return e.id!=t});this.setUserCalendars(s)}},e.prototype.toggleUserCalendarVisibility=function(t){var s=this;this.usersCalendars.some(function(e){if(e.id==t)return e.visible=!e.visible,s.userCalendarChange$.emit(e),s.setUserCalendars(s.usersCalendars.slice()),!0})},e.prototype.toggleOwnerCalendarVisible=function(){this.ownerCalendarVisible=!this.ownerCalendarVisible,this.userCalendarChange$.emit({id:"owner"}),this.userPreferences.setPreference("ownerVisible",this.ownerCalendarVisible,!0,"Calendar")},e.prototype.setUserCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.usersCalendars=e,t&&this.userPreferences.setPreference("Users",this.usersCalendars,!0,"Calendar"))},e.prototype.setUserColor=function(t,s){var n=this;this.usersCalendars.some(function(e){if(e.id==t)return e.color=s,n.setUserCalendars(n.usersCalendars),n.otherCalendarsColor$.emit({id:t,color:s}),!0})},e.prototype.arrangeEvents=function(e){(e=e.map(function(e){return e.start=moment(e.start).second(0),e.end=moment(e.end).second(0),e})).sort(function(e,t){return e.start<t.start?-1:e.start===t.start&&e.end>t.end?-1:1});for(var t={},s=0,n=e;s<n.length;s++){for(var a=n[s],r=[],o=0,i=e;o<i.length;o++){var l=i[o];a.id!==l.id&&l.start<a.end&&l.end>a.start&&r.push({id:l.id,start:l.start,end:l.end})}var d=0;if(0<r.length){for(var c=0,h=r;c<h.length;c++){for(var u=h[c],p=0,v=0,g=r;v<g.length;v++){var m=g[v];m.start<u.end&&m.end>u.start&&p++}d<p&&(d=p)}d++}t[a.id]={maxOverlay:d,elementsOverlaid:r}}for(var y=[],f=0,b=e;f<b.length;f++){a=b[f];for(var _=0,C=[],D=0,w=e;D<w.length;D++){l=w[D];if(-1!==y.indexOf(l.id)&&l.start<a.end&&l.end>a.start)for(-1===C.indexOf(t[l.id].displayIndex)&&C.push(t[l.id].displayIndex);-1!==C.indexOf(_);)_++}t[a.id].displayIndex=_,y.push(a.id)}for(var E in t)for(var x=0,k=t[E].elementsOverlaid;x<k.length;x++){var M=k[x];t[E].maxOverlay<t[M.id].maxOverlay&&(t[E].maxOverlay=t[M.id].maxOverlay)}for(var S=0,O=e;S<O.length;S++){(a=O[S]).displayIndex=t[a.id].displayIndex,a.maxOverlay=t[a.id].maxOverlay}return e},e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},e.prototype.onEventDrop=function(n,e){e.some(function(e){var t=e.elementRef.nativeElement.getBoundingClientRect(),s=n.source.element.nativeElement.getBoundingClientRect();if(s.top>=t.top&&s.top<=t.bottom&&s.left>=t.left&&s.left<=t.right)return n.source.data.onDrop({day:e.day,hour:e.hour,minutes:e.minutes}),!0}),n.source.reset()},e.prototype.gotToDayView=function(e){this.refresh(e),this.sheetType="Day"},e.prototype.removeGoogleEvent=function(s){var n=this;this.calendars.google.some(function(e,t){if(e.id==s)return n.calendars.google.splice(t,1),n.cdRef.detectChanges(),!0})},e.prototype.setIsMobileView=function(e){this.isMobileView=e,this.multiEventHeight=e?20:25,this.cdRef.detectChanges()},e.prototype.isValid=function(e){return e&&"object"==typeof e&&e.isValid()},e.prototype.loadCalendarModules=function(){var t=this;this.backend.getRequest("module/Calendar/modules").subscribe(function(e){e&&(t.modules=e,t.cdRef.detectChanges())})},e.prototype.absenceExists=function(t){var e=!1;for(var s in this.calendars)if(this.calendars.hasOwnProperty(s)&&this.calendars[s].some(function(e){return e.id==t.id&&e.type==t.type})){e=!0;break}return!!e},e.prototype.broadcastSubscriber=function(){var o=this,e=this.broadcast.message$.subscribe(function(e){var t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if("timezone.changed"==e.messagetype&&(o.timeZone=e.messagedata,o.triggerSheetReload()),o.modules.some(function(e){return e.name==s}))switch(e.messagetype){case"model.save":var a=n.assigned_user_id,r=o.calendars.users&&o.calendars.users.some(function(e){return e.id==a});if(!o.calendars[a]&&!r)return;r&&(a="users"),!o.modifyEvent(t,s,n,a)&&o.isValid(n.date_end)&&o.isValid(n.date_start)&&o.calendars[a].push({id:t,module:s,type:"event",start:n.date_start,end:n.date_end,isMulti:0<+n.date_end.diff(n.date_start,"days"),data:n}),o.triggerSheetReload(),o.cdRef.markForCheck();break;case"model.delete":if(!o.calendars[o.owner])return;o.removeEvent(t,s)}});this.subscriptions.add(e)},e.prototype.modifyEvent=function(t,e,s,n){if(!this.isValid(s.date_start)||!this.isValid(s.date_end))return!0;if(s.date_start>this.currentEnd&&s.date_end<this.currentStart)return this.removeEvent(t,e),!0;var a=this.calendars[n].find(function(e){return e.data.id==t});return!!a&&(a.start=s.date_start,a.end=s.date_end,a.isMulti=0<+s.date_end.diff(s.date_start,"days"),!0)},e.prototype.removeEvent=function(s,n){var a=this;this.calendars[this.owner].some(function(e,t){if(e.data.id==s&&n==e.module)return a.calendars[a.owner].splice(t,1),a.triggerSheetReload(),a.cdRef.markForCheck(),!0})},e.prototype.loadPreferences=function(){this.timeZone=this.session.getSessionData("timezone")||moment.tz.guess();var e=this.userPreferences.toUse;this.weekStartDay="Monday"==e.week_day_start?1:this.weekStartDay,this.weekDaysCount=+e.week_days_count||this.weekDaysCount,this.startHour=+e.calendar_day_start_hour||this.startHour,this.endHour=+e.calendar_day_end_hour||this.endHour;var t=this.session.getSessionData("calendarDate",!1),s=this.session.getSessionData("sheetType",!1);s&&(this._sheetType=s),t&&(this._calendarDate=new moment(t)),this.triggerSheetReload()},e.prototype.getCalendarPreferences=function(){var t=this;this.isMobileView||this.isDashlet||(this.userPreferences.loadPreferences("Calendar").pipe(operators_1.take(1)).subscribe(function(e){t.ownerCalendarVisible=!e.hasOwnProperty("ownerVisible")||e.ownerVisible,t.setUserCalendars(e.Users,!1),t.setOtherCalendars(e.Other,!1),t.userPreferencesLoaded=!0,t.cdRef.detectChanges()}),(this.session.authData.googleToken||this.configuration.checkCapability("google_oauth")&&this.configuration.getCapabilityConfig("google_oauth").serviceaccess)&&(this.loggedByGoogle=!0))},e.prototype.subscribeToLanguage=function(){var e=this,t=this.language.currentlanguage$.subscribe(function(){return e.triggerSheetReload()});this.subscriptions.add(t)},e.prototype.triggerSheetReload=function(e){this._calendarDate=moment(e||this._calendarDate)},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.session,services_1.broadcast,services_1.modal,services_1.language,services_1.configurationService,services_1.modelutilities,"function"==typeof(t=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?t:Object,services_1.userpreferences])],e)}();exports.calendar=calendar;var CalendarHeader=function(){function e(e,t,s,n,a,r){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modelUtils=a,this.calendar=r,this.openPicker=!1,this.scheduleUntilDate={},this.showTypeSelector=!1,this.modules=[],this.datePicked=new core_1.EventEmitter,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}var t,s,n;return e.prototype.ngOnDestroy=function(){this.clickListener&&this.clickListener()},e.prototype.toggleClosed=function(){this.openPicker=!1,this.clickListener&&this.clickListener()},e.prototype.handleDatePicked=function(e){this.datePicked.emit(e)},e.prototype.shiftPlus=function(){this.calendar.shiftPlus()},e.prototype.shiftMinus=function(){this.calendar.shiftMinus()},e.prototype.getCalendarHeader=function(){var e=new moment(this.calendar.calendarDate);switch(this.calendar.sheetType){case"Week":return this.getFirstDayOfWeek()+" - "+this.getLastDayOfWeek();case"Month":return e.format("MMMM YYYY");case"Day":return e.format("MMMM D");case"Schedule":return e.format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY");case"Three_Days":return e.format("MMM D")+" - "+moment(e.add(2,"d")).format("MMM D")}},e.prototype.getCompactCalendarHeader=function(){return new moment(this.calendar.calendarDate).format("MMM, YYYY")},e.prototype.getWeekNumberDisplay=function(){var e=new moment(this.calendar.calendarDate);return this.language.getLabel("LBL_WEEK")+" "+e.format("w")},e.prototype.getFirstDayOfWeek=function(){var e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekStartDay),e.format("MMM D")},e.prototype.getLastDayOfWeek=function(){var e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekDaysCount),e.format("MMM D")},e.prototype.toggleTypeSelector=function(){this.showTypeSelector=!this.showTypeSelector},e.prototype.setType=function(e){this.calendar.sheetType=e,this.calendar.refresh(),this.showTypeSelector=!1},e.prototype.goToday=function(){this.calendar.calendarDate=new moment},e.prototype.zoomIn=function(){this.calendar.sheetHourHeight+=10},e.prototype.zoomOut=function(){this.calendar.sheetHourHeight-=10},e.prototype.resetZoom=function(){this.calendar.sheetHourHeight=80},e.prototype.toggleOpenPicker=function(t,s){var n=this;this.openPicker=!this.openPicker,this.openPicker&&(this.clickListener=this.renderer.listen("document","click",function(e){return n.onDocumentClick(e,t,s)}))},e.prototype.onDocumentClick=function(e,t,s){!this.openPicker||t.contains(e.target)||s.contains(e.target)||(this.openPicker=!1,this.clickListener())},e.prototype.toggleVisibleModule=function(t){var s=this;this.calendar.otherCalendars.some(function(e){if(e.name==t)return e.visible=!e.visible,s.calendar.setOtherCalendars(s.calendar.otherCalendars.slice()),!0})||(this.calendar.otherCalendars.push({id:this.modelUtils.generateGuid(),name:t,visible:!1}),this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()))},e.prototype.getIconStyle=function(t){return this.calendar.otherCalendars.some(function(e){return t==e.name&&!e.visible})?{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}:{}},__decorate([core_1.Input(),__metadata("design:type",Array)],e.prototype,"modules",void 0),__decorate([core_1.Output(),__metadata("design:type","function"==typeof(t=void 0!==core_1.EventEmitter&&core_1.EventEmitter)?t:Object)],e.prototype,"datePicked",void 0),e=__decorate([core_1.Component({selector:"calendar-header",template:'<div class="slds-page-header" style="border-bottom-left-radius: 0; border-bottom-right-radius: 0;" [class.slds-p-around--x-small]="calendar.isMobileView"><div class="slds-grid"><div *ngIf="!calendar.isMobileView" class="slds-col" [class.slds-m-bottom--xx-small]="calendar.isMobileView"><div class="slds-media slds-no-space slds-grow"><system-icon [module]="\'Calendar\'"></system-icon><div class="slds-media__body"><p class="slds-text-title--caps slds-line-height--reset"><system-label-modulename module="Calendar"></system-label-modulename></p><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate">{{getCalendarHeader()}} <span *ngIf="calendar.sheetType == \'Week\'" class="slds-p-horizontal--x-small slds-p-vertical--xx-small slds-pill slds-text-body--small">{{getWeekNumberDisplay()}}</span></h1></div></div></div><div *ngIf="calendar.isMobileView" class="slds-col slds-grid"><button #pickerbuttoncontainer class="slds-button slds-button--icon-border" (click)="toggleOpenPicker(pickerontainer, pickerbuttoncontainer)"><system-utility-icon icon="event" size="x-small"></system-utility-icon></button><div class="slds-page-header__title slds-m-horizontal--x-small slds-align-middle slds-truncate">{{getCompactCalendarHeader()}}</div></div><div class="slds-align-top slds-col slds-grid slds-no-flex slds-col--bump-left"><div class="slds-m-right--medium slds-grid"><system-icon *ngFor="let module of modules" [module]="module.name" [ngStyle]="getIconStyle(module.name)" (click)="toggleVisibleModule(module.name)" size="medium" divClass="slds-m-right--xx-small" style="cursor: pointer"></system-icon></div><div *ngIf="!calendar.isMobileView || calendar.asPicker" class="slds-button-group" role="group"><button class="slds-button slds-button--icon-border" (click)="shiftMinus()"><system-button-icon [icon]="\'chevronleft\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="shiftPlus()"><system-button-icon [icon]="\'chevronright\'"></system-button-icon></button></div><ng-container *ngIf="!calendar.isMobileView && !calendar.asPicker"><button class="slds-button slds-button--icon-border" (click)="calendar.refresh()"><system-button-icon [icon]="\'refresh\'"></system-button-icon></button><div class="slds-button-group slds-m-left--x-small" role="group"><button class="slds-button slds-button--icon-border" (click)="zoomOut()" [disabled]="calendar.sheetHourHeight <=30 || calendar.sheetType == \'Month\' || calendar.sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomout\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="resetZoom()" [disabled]="calendar.sheetHourHeight ==80 || calendar.sheetType == \'Month\' || calendar.sheetType == \'Schedule\'"><system-button-icon [icon]="\'undo\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="zoomIn()" [disabled]="calendar.sheetHourHeight >=140 || calendar.sheetType == \'Month\' || calendar.sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomin\'"></system-button-icon></button></div><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="goToday()"><system-label label="LBL_TODAY"></system-label></button></ng-container><div *ngIf="!calendar.asPicker" class="slds-dropdown-trigger slds-dropdown-trigger--click slds-m-left--xx-small" [class.slds-is-open]="showTypeSelector"><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="toggleTypeSelector()"><system-label [label]="\'LBL_\'+ calendar.sheetType|uppercase"></system-label><system-button-icon [icon]="\'down\'"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown--x-small"><ul class="slds-dropdown__list" role="menu"><li class="slds-dropdown__item" role="presentation"><a href="javascript:void(0);" role="menuitem" (click)="setType(\'Day\')"><span class="slds-truncate"><system-label label="LBL_DAY"></system-label></span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Three_Days\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><system-label label="LBL_THREE_DAYS"></system-label></span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Week\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><system-label label="LBL_WEEK"></system-label></span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Month\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><system-label label="LBL_MONTH"></system-label></span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Schedule\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><system-label label="LBL_SCHEDULE"></system-label></span></a></li></ul></div></div></div></div></div><div #pickerontainer [class.slds-hidden]="!openPicker || !calendar.isMobileView" aria-hidden="false" class="slds-datepicker slds-dropdown slds-dropdown_left" role="dialog"><system-input-date-picker *ngIf="openPicker" [setDate]="calendar.calendarDate" [weekStartDay]="calendar.weekStartDay" (datePicked)="handleDatePicked($event)"></system-input-date-picker></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,"function"==typeof(s=void 0!==core_1.ElementRef&&core_1.ElementRef)?s:Object,"function"==typeof(n=void 0!==core_1.Renderer2&&core_1.Renderer2)?n:Object,services_1.modelutilities,calendar])],e)}();exports.CalendarHeader=CalendarHeader;var CalendarSheetDropTarget=function(){function e(e,t,s){this.calendar=e,this.cdr=t,this.elementRef=s,this.hour=0,this.minutes=0}var t,s;return Object.defineProperty(e.prototype,"date",{get:function(){return this.day?moment(this.day.date):this.calendar.calendarDate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hourPart",{set:function(e){this.minutes=e?15*e:0},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.cdr.detach()},e.prototype.addEvent=function(){var e=moment(this.date);e.hour(this.hour).minute(this.minutes).second(0),this.calendar.asPicker?this.calendar.pickerDate$.emit(e):this.calendar.addingEvent$.emit(e)},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"day",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],e.prototype,"hour",void 0),__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],e.prototype,"hourPart",null),e=__decorate([core_1.Component({selector:"calendar-sheet-drop-target",template:'<div *ngIf="!calendar.isDashlet" (click)="addEvent()">{{hour}}:{{minutes == 0 ? \'00\' : minutes}}</div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[calendar,"function"==typeof(t=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?t:Object,"function"==typeof(s=void 0!==core_1.ElementRef&&core_1.ElementRef)?s:Object])],e)}();exports.CalendarSheetDropTarget=CalendarSheetDropTarget;var Calendar=function(){function Calendar(e,t,s,n,a,r,o,i,l,d){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modal=a,this.cdr=r,this.model=o,this.metadata=i,this.injector=l,this.calendar=d,this.componentconfig={},this.googleIsVisible=!0,this.subscriptions=new rxjs_1.Subscription,this.xDown=null,this.mainContainerClass="slds-theme--default",this.yDown=null,this.self={},this.navigation.setActiveModule("Calendar")}var e,t,s,n,a;return Object.defineProperty(Calendar.prototype,"sidebarWidth",{get:function(){return this.calendar.sidebarWidth},enumerable:!1,configurable:!0}),Object.defineProperty(Calendar.prototype,"sheetStyle",{get:function(){return{width:"calc(100% - "+this.sidebarWidth+"px)",height:"100%"}},enumerable:!1,configurable:!0}),Calendar.prototype.ngAfterViewInit=function(){var t=this;this.calendar.asPicker&&(this.mainContainerClass="slds-modal slds-fade-in-open slds-modal_large"),this.touchStartListener=this.renderer.listen("document","touchstart",function(e){return t.handleTouchStart(e)}),this.handleMobileView(),this.subscriptions.add(this.calendar.addingEvent$.subscribe(function(e){return t.addEvent(e)}))},Calendar.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe(),this.resizeListener&&this.resizeListener(),this.touchStartListener&&this.touchStartListener()},Calendar.prototype.handleMobileView=function(){var e=this;this.resizeListener=this.renderer.listen("window","resize",function(){e.calendar.setIsMobileView(e.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)}),this.calendar.setIsMobileView(this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)},Calendar.prototype.handleUntilDate=function(e){this.calendarHeader.scheduleUntilDate=e},Calendar.prototype.setDateChanged=function(e){this.calendarHeader.toggleClosed(),this.calendar.refresh(e)},Calendar.prototype.handleGoogleIsVisible=function(e){this.googleIsVisible=e},Calendar.prototype.closeModal=function(){this.self.destroy()},Calendar.prototype.handleTouchStart=function(e){var t=this,s=e.touches||e.originalEvent.touches;this.xDown=s[0].clientX,this.yDown=s[0].clientY,this.touchMoveListener=this.renderer.listen("document","touchmove",function(e){return t.handleTouchMove(e)})},Calendar.prototype.handleTouchMove=function(e){if(this.touchMoveListener(),this.xDown&&this.yDown){var t=this.xDown-e.touches[0].clientX;Math.abs(t)>Math.abs(this.yDown-e.touches[0].clientY)&&(t<0?this.calendar.shiftMinus():this.calendar.shiftPlus()),this.xDown=null,this.yDown=null}},Calendar.prototype.addEvent=function(n){var a=this;this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe(function(e){e.instance.module$.pipe(operators_1.take(1)).subscribe(function(e){var t;if(e){a.model.module=e.name;var s=((t={})[e.dateStartFieldName]=n,t);"UserAbsences"==e.name&&(s.user_id=a.calendar.owner,s.user_name=a.calendar.ownerName),a.model.addModel("",null,s)}})})},__decorate([core_1.ViewChild("calendarContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],Calendar.prototype,"calendarContainer",void 0),__decorate([core_1.ViewChild(CalendarHeader,{static:!0}),__metadata("design:type",CalendarHeader)],Calendar.prototype,"calendarHeader",void 0),Calendar=__decorate([core_1.Component({selector:"calendar",template:'<div #calendarContainer [ngClass]="mainContainerClass" [class.slds-text-body--small]="calendar.isMobileView" [attr.role]="!calendar.asPicker ? \'none\' : \'dialog\'" [system-to-bottom-noscroll]="!calendar.asPicker" style="height: 100%"><div [class.slds-modal__container]="calendar.asPicker" style="height: inherit"><div class="slds-grid slds-grid--vertical" style="height: inherit"><calendar-header [modules]="calendar.modules" (datePicked)="setDateChanged($event)" style="display: block"></calendar-header><div class="slds-grid slds-theme_default slds-border--right slds-grow" style="min-height: 100px"><div *ngIf="!calendar.isMobileView" [style.width.px]="calendar.sidebarWidth" class="slds-border--right slds-p-around--xx-small slds-scrollable--y slds-size--1-of-1 slds-theme--default" style="height: 100%; z-index: 1"><system-input-date-picker [setDate]="calendar.calendarDate" [dual]="componentconfig.pickerDualMode" [showTodayButton]="false" [weekStartDay]="calendar.weekStartDay" (datePicked)="setDateChanged($event)"></system-input-date-picker><calendar-other-calendars-monitor *ngIf="calendar.userPreferencesLoaded" [usersCalendars]="calendar.usersCalendars" (googleIsVisible$)="handleGoogleIsVisible($event)"></calendar-other-calendars-monitor></div><div [ngSwitch]="calendar.sheetType" [system-overlay-loading-spinner]="calendar.isLoading || !calendar.userPreferencesLoaded" [ngStyle]="sheetStyle"><ng-container *ngIf="calendar.userPreferencesLoaded"><calendar-sheet-day *ngSwitchCase="\'Day\'" [googleIsVisible]="googleIsVisible" [setdate]="calendar.calendarDate" style="display: block; height: inherit"></calendar-sheet-day><calendar-sheet-three-days *ngSwitchCase="\'Three_Days\'" [googleIsVisible]="googleIsVisible" [setdate]="calendar.calendarDate" style="display: block; height: inherit"></calendar-sheet-three-days><calendar-sheet-week *ngSwitchCase="\'Week\'" [googleIsVisible]="googleIsVisible" [setdate]="calendar.calendarDate" style="display: block; height: inherit"></calendar-sheet-week><calendar-sheet-month *ngSwitchCase="\'Month\'" [googleIsVisible]="googleIsVisible" [setdate]="calendar.calendarDate" style="display: block; height: inherit"></calendar-sheet-month><calendar-sheet-schedule *ngSwitchCase="\'Schedule\'" [googleIsVisible]="googleIsVisible" [setdate]="calendar.calendarDate" (untildate$)="handleUntilDate($event)" style="display: block; height: inherit"></calendar-sheet-schedule></ng-container></div></div><div><footer *ngIf="calendar.asPicker" class="slds-modal__footer"><button class="slds-button slds-button--neutral" (click)="closeModal()"><system-label label="LBL_CLOSE"></system-label></button></footer></div></div></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[calendar,services_1.model]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,"function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,"function"==typeof(s=void 0!==core_1.Renderer2&&core_1.Renderer2)?s:Object,services_1.modal,"function"==typeof(n=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?n:Object,services_1.model,services_1.metadata,"function"==typeof(a=void 0!==core_1.Injector&&core_1.Injector)?a:Object,calendar])],Calendar)}();exports.Calendar=Calendar;var CalendarSheetEvent=function(){function CalendarSheetEvent(e,t,s,n,a,r,o,i,l,d,c){this.language=e,this.configuration=t,this.calendar=s,this.model=n,this.view=a,this.broadcast=r,this.cdRef=o,this.userpreferences=i,this.metadata=l,this.elementRef=d,this.renderer=c,this.eventChange=new core_1.EventEmitter,this.eventDrop=new core_1.EventEmitter,this.event={},this.sheetContainer={},this.oldDuration=0,this.color="",this.hasDarkColor=!0,this.subscriptions=new rxjs_1.Subscription,this.subscribeToColorChange(),this.subscribeToModelSave(),this.view.displayLabels=!1}var e,t,s;return Object.defineProperty(CalendarSheetEvent.prototype,"startHour",{get:function(){return this.model.data.date_start?moment(this.model.data.date_start).tz(this.calendar.timeZone).format(this.userpreferences.getTimeFormat()):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"textClass",{get:function(){return"Schedule"!=this.calendar.sheetType&&this.hasDarkColor?"spice-calendar-event-has-dark-color":""},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"isAbsence",{get:function(){return"absence"==this.event.type||"UserAbsences"==this.event.module},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"isDraggable",{get:function(){return this.canEdit&&!this.event.isMulti&&"Month"!=this.calendar.sheetType},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"canEdit",{get:function(){return this.model.data.acl&&this.model.checkAccess("edit")&&"Schedule"!=this.calendar.sheetType&&("event"==this.event.type||"absence"==this.event.type)&&!this.calendar.asPicker&&!this.calendar.isMobileView&&!this.calendar.isDashlet},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"owner",{get:function(){return this.calendar.owner},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"lockAxis",{get:function(){return"Day"==this.calendar.sheetType?"y":void 0},enumerable:!1,configurable:!0}),CalendarSheetEvent.prototype.ngOnInit=function(){this.setModelDataFromEvent(),this.loadFieldset(),this.setEventColor()},CalendarSheetEvent.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},CalendarSheetEvent.prototype.onDrop=function(e){var t=this,s=this.event.end.diff(this.event.start,"minutes");e.day&&(this.event.start=moment(e.day.date)),this.event.start.hour(e.hour).minute(e.minutes).seconds(0),this.event.end=moment(this.event.start).add(s,"minutes"),this.event.data.duration_hours=Math.floor(s/60),this.event.data.duration_minutes=s-60*this.event.data.duration_hours;var n=this.calendar.modules.find(function(e){return e.name==t.event.module})||{},a=n.dateStartFieldName||"date_start",r=n.dateEndFieldName||"date_end";this.event.data[a]=moment(this.event.start.format()),this.event.data[r]=moment(this.event.end.format()),this.model.startEdit(!0,!0),this.model.data=__assign({},this.event.data),this.model.save(!1),this.eventChange.emit()},CalendarSheetEvent.prototype.isDarkColor=function(e){var t=-1<e.indexOf("#")?e.substring(1):e,s=parseInt(t,16);return.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(s>>0&255)<120},CalendarSheetEvent.prototype.emitDrop=function(e){this.elementRef.nativeElement.style.zIndex="initial",this.eventDrop.emit(e)},CalendarSheetEvent.prototype.onClick=function(){this.cdRef.detectChanges()},CalendarSheetEvent.prototype.onDragStart=function(){this.elementRef.nativeElement.style.zIndex=9999},CalendarSheetEvent.prototype.loadFieldset=function(){var e=this.metadata.getComponentConfig("CalendarSheetEvent",this.model.module);e&&e.header_fieldset&&(this.headerFieldset=e.header_fieldset),e&&e.sub_fieldset&&(this.subFieldset=e.sub_fieldset)},CalendarSheetEvent.prototype.subscribeToColorChange=function(){var t=this;this.subscriptions.add(this.calendar.otherCalendarsColor$.subscribe(function(e){t.event.data.assigned_user_id&&e.id==t.event.data.assigned_user_id&&(t.event.otherColor=e.color,t.cdRef.detectChanges())}))},CalendarSheetEvent.prototype.subscribeToModelSave=function(){var a=this;this.subscriptions.add(this.broadcast.message$.subscribe(function(e){var t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if(s==a.model.module)switch(e.messagetype){case"model.save":t==a.model.id&&(a.model.data=a.model.utils.backendModel2spice(a.model.module,n),a.setEventColor(),a.eventChange.emit())}}))},CalendarSheetEvent.prototype.setModelDataFromEvent=function(){this.model.module=this.event.module,this.model.id=this.event.data.id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.event.data)},CalendarSheetEvent.prototype.onMouseDown=function(e){var t=this;if(this.canEdit){this.cdRef.detach(),this.previewsPageY=e.pageY,this.currentPageY=e.pageY,this.oldDuration=this.event.end.diff(this.event.start,"minutes"),this.event.resizing=!0;var s=this.renderer.listen("document","mousemove",function(e){return t.onMouseMove(e)});this.mouseUpListener=this.renderer.listen("document","mouseup",function(){return t.onMouseUp(s)}),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}},CalendarSheetEvent.prototype.onMouseMove=function(e){this.currentPageY=e.pageY;var t=this.calendar.sheetHourHeight/4,s=this.currentPageY-this.previewsPageY>t,n=this.currentPageY-this.previewsPageY<-Math.abs(t),a=s?"add":n?"subtract":null;a&&(this.previewsPageY=this.currentPageY,this.event.end[a](15,"minutes"),this.eventChange.emit())},CalendarSheetEvent.prototype.onMouseUp=function(e){var t=this;this.cdRef.reattach(),this.mouseUpListener(),e();var s=this.event.end.diff(this.event.start,"minutes");if(this.oldDuration!=s){this.event.data.duration_hours=Math.floor(s/60),this.event.data.duration_minutes=s-60*this.event.data.duration_hours,this.model.startEdit(!0,!0),this.model.data.duration_minutes=this.event.data.duration_minutes,this.model.data.duration_hours=this.event.data.duration_hours;var n=(this.calendar.modules.find(function(e){return e.name==t.event.module})||{}).dateEndFieldName||"date_end";this.model.data[n]=moment(this.event.end.format()),this.event.saving=!0,this.model.save().subscribe(function(){t.event.saving=!1,t.cdRef.detectChanges()}),this.eventChange.emit()}this.previewsPageY=void 0,this.currentPageY=void 0,this.event.resizing=!1,this.oldDuration=0},CalendarSheetEvent.prototype.setEventColor=function(){var t=this;if("Schedule"==this.calendar.sheetType)return this.color="transparent";this.color=this.event.hasOwnProperty("color")?this.event.color:this.calendar.eventColor;var e=this.configuration.getData("calendarcolorconditions");if(e)for(var s=0,n=e=e.filter(function(e){return e.module==t.model.module}).sort(function(e,t){return+e.priority<+t.priority?1:-1});s<n.length;s++){var a=n[s];if(!(null!=a.module_filter&&0<a.module_filter.length)){this.color=-1<a.color_hex_code.indexOf("#")?a.color_hex_code:"#"+a.color_hex_code,this.hasDarkColor=this.isDarkColor(a.color_hex_code);break}if(this.model.checkModuleFilterMatch(a.module_filter)){this.color=-1<a.color_hex_code.indexOf("#")?a.color_hex_code:"#"+a.color_hex_code,this.hasDarkColor=this.isDarkColor(a.color_hex_code);break}}},__decorate([core_1.Output(),__metadata("design:type",Object)],CalendarSheetEvent.prototype,"eventChange",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CalendarSheetEvent.prototype,"eventDrop",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CalendarSheetEvent.prototype,"event",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CalendarSheetEvent.prototype,"sheetContainer",void 0),CalendarSheetEvent=__decorate([core_1.Component({selector:"calendar-sheet-event",template:'<div (click)="onClick()" cdkDrag [cdkDragData]="this" [cdkDragLockAxis]="lockAxis" (cdkDragEnded)="emitDrop($event)" (cdkDragStarted)="onDragStart()" [cdkDragDisabled]="!isDraggable" [class.slds-p-vertical--xx-small]="event.saving" [style.background-color]="color" cdkDragBoundary=".calendar-event-drag-boundary" class="slds-grid slds-m-around--xxx-small spice-free-drag-preview" style="height: 100%;border-radius: 2px;"><abbr *ngIf="event.otherColor" [style.background-color]="event.otherColor" [title]="event.data.assigned_user_name" style="height: calc(100% - 2px); width: 8px; border-radius: 2px; margin: 1px; box-shadow: #4b4b4b 1px 0 1px 0;"></abbr><div [style.width]="event.otherColor ? \'calc(100% - 8px)\' : \'100%\'"><ng-container *ngIf="!event.saving; else saving"><div class="slds-grid slds-grid--align-spread slds-p-horizontal--xx-small" style="height: 100%;"><div class="slds-truncate" style="height: inherit; width: 100%"><object-record-fieldset-horizontal-list *ngIf="headerFieldset; else summaryContainer" [ngClass]="textClass" [fieldset]="headerFieldset"></object-record-fieldset-horizontal-list><ng-template #summaryContainer><span system-model-popover class="slds-text-link--reset" [ngClass]="textClass">{{model.data.summary_text}}</span> <span *ngIf="event.isMulti && startHour && !isAbsence" [ngClass]="textClass">, {{startHour}}</span></ng-template><object-record-fieldset-horizontal-list *ngIf="subFieldset && !event.isMulti" [ngClass]="textClass" [fieldset]="subFieldset"></object-record-fieldset-horizontal-list></div><object-action-menu [buttonsize]="\'xx-small\'"></object-action-menu></div><div *ngIf="!event.isMulti && calendar.sheetType != \'Month\'&& canEdit" draggable="false" class="slds-is-absolute" style="bottom: 0; left: calc(50% - 8px);cursor: ns-resize;" (mousedown)="onMouseDown($event)"><system-utility-icon colorclass="slds-icon-text-white" icon="threedots" size="x-small"></system-utility-icon></div></ng-container><ng-template #saving><system-spinner inverse="true" style="opacity: 0.5;"></system-spinner></ng-template></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.configurationService,calendar,services_1.model,services_1.view,services_1.broadcast,"function"==typeof(e=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?e:Object,services_1.userpreferences,services_1.metadata,"function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,"function"==typeof(s=void 0!==core_1.Renderer2&&core_1.Renderer2)?s:Object])],CalendarSheetEvent)}();exports.CalendarSheetEvent=CalendarSheetEvent;var CalendarSheetGoogleEvent=function(){function e(e,t,s,n,a,r,o,i){this.calendar=e,this.footer=t,this.metadata=s,this.zone=n,this.model=a,this.modal=r,this.injector=o,this.elementRef=i,this.sheetContainer={},this.popoverComponentRef=null,this.showPopoverTimeout={}}var t,s,n;return e.prototype.ngOnDestroy=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)},e.prototype.onMouseEnter=function(){var e=this;this.zone.runOutsideAngular(function(){e.showPopoverTimeout=window.setTimeout(function(){return e.renderPopover()},500)})},e.prototype.onMouseLeave=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()},e.prototype.renderPopover=function(){var t=this;this.footer.footercontainer&&this.zone.run(function(){t.metadata.addComponent("CalendarGoogleEventPopover",t.footer.footercontainer,t.injector).subscribe(function(e){e.instance.parentElementRef=t.elementRef,e.instance.event=t.event,t.popoverComponentRef=e.instance})})},e.prototype.onActionClick=function(){var o=this;this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe(function(e){e.instance.module$.pipe(operators_1.take(1)).subscribe(function(e){var t;if(e){o.model.module=e.name;var s=o.event.end.diff(o.event.start,"minutes"),n=Math.floor(s/60),a=s-60*n,r=((t={})[e.dateStartFieldName]=o.event.start,t[e.dateEndFieldName]=o.event.end,t.duration_minutes=a,t.duration_hours=n,t.name=o.event.summary,t.description=o.event.description,t.location=o.event.location,t.external_id=o.event.id,t);"UserAbsences"==e.name&&(r.user_id=o.calendar.owner,r.user_name=o.calendar.ownerName),o.model.addModel("",null,r).subscribe(function(){o.calendar.removeGoogleEvent(o.event.id)})}})})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"event",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"sheetContainer",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-google-event",template:'<div [style.background-color]="calendar.sheetType == \'Schedule\' ? \'0\' : calendar.googleColor" class="slds-grid slds-m-around--xxx-small spice-free-drag-preview slds-height_full" style="border-radius: 2px;"><div class="slds-size--1-of-1"><div class="slds-grid slds-grid--align-spread slds-p-horizontal--xx-small slds-height_full"><div class="slds-truncate slds-grid" style="height: inherit"><span (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()" [class.spice-calendar-event-has-dark-color]="calendar.sheetType != \'Schedule\'" class="slds-text-link--reset slds-truncate">{{event.summary}}</span></div></div></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[services_1.model]}),__metadata("design:paramtypes",[calendar,services_1.footer,services_1.metadata,"function"==typeof(t=void 0!==core_1.NgZone&&core_1.NgZone)?t:Object,services_1.model,services_1.modal,"function"==typeof(s=void 0!==core_1.Injector&&core_1.Injector)?s:Object,"function"==typeof(n=void 0!==core_1.ElementRef&&core_1.ElementRef)?n:Object])],e)}();exports.CalendarSheetGoogleEvent=CalendarSheetGoogleEvent;var CalendarSheetDay=function(){function e(e,t,s,n){this.language=e,this.cdRef=t,this.renderer=s,this.calendar=n,this.dayTextContainerClass="",this.dayTextClass="slds-text-body--regular",this.dateTextClass="slds-text-heading--large",this.sheetHours=[],this.ownerMultiEvents=[],this.googleMultiEvents=[],this.setdate={},this.googleIsVisible=!0,this.ownerEvents=[],this.userEvents=[],this.userMultiEvents=[],this.googleEvents=[],this.subscription=new rxjs_1.Subscription,this.buildHours(),this.subscribeToChanges()}var t,s,n,a;return e.prototype.subscribeToChanges=function(){var t=this;this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){"owner"==e.id?t.getOwnerEvents():t.getUserEvents(e)})),this.resizeListener=this.renderer.listen("window","resize",function(){return t.setEventsStyle()})},Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(this.calendar.timeZone).format("z Z")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(this.calendar.endHour-this.calendar.startHour,"h")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTodayStyle",{get:function(){var e=new moment;return{color:e.year()===this.setdate.year()&&e.month()===this.setdate.month()&&e.date()==this.setdate.date()?this.calendar.todayColor:"inherit"}},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(e){e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnInit=function(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe(),this.resizeListener&&this.resizeListener()},e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.trackByIndexFn=function(e,t){return e},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getOwnerEvents=function(){var t=this;if(this.ownerEvents=[],this.ownerMultiEvents=[],!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.setEventsStyle())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.setEventsStyle())})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),this.userMultiEvents=this.userMultiEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.isMulti?s.userMultiEvents.push(e):s.userEvents.push(e)}),s.setEventsStyle())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.userMultiEvents=[],this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),(e=t.filterEvents(e)).forEach(function(e){e.isMulti?t.userMultiEvents.push(e):t.userEvents.push(e)}),t.setEventsStyle())})},e.prototype.filterEvents=function(e){var t=this;return e.filter(function(e){return e.end.hour()>t.calendar.startHour||e.start.hour()<t.calendar.endHour||"absence"==e.type})},e.prototype.displayDate=function(e){switch(e){case"day":return this.setdate.format("ddd");case"date":return this.setdate.format(this.calendar.isDashlet?"D, MMMM":"D")}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.setEventsStyle=function(){var a=this;this.allEvents.forEach(function(e){var t=60*(e.start.hour()-a.calendar.startHour)+e.start.minute(),s=60*(e.end.hour()-a.calendar.startHour)+e.end.minute(),n=(a.sheetContainer.element.nativeElement.clientWidth-a.sheetTimeWidth)/(0<e.maxOverlay?e.maxOverlay:1);e.style={left:a.sheetTimeWidth+n*e.displayIndex+"px",width:n+"px",top:a.calendar.sheetHourHeight/60*t-1+"px",height:a.calendar.sheetHourHeight/60*(s-t)+"px","min-height":a.calendar.multiEventHeight+"px"}}),this.cdRef.detectChanges()},e.prototype.onEventDrop=function(e){this.calendar.onEventDrop(e,this.dropTargets)},__decorate([core_1.ViewChild("sheetContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(t=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?t:Object)],e.prototype,"sheetContainer",void 0),__decorate([core_1.ViewChildren(CalendarSheetDropTarget),__metadata("design:type","function"==typeof(s=void 0!==core_1.QueryList&&core_1.QueryList)?s:Object)],e.prototype,"dropTargets",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-day",template:'<div class="slds-grid slds-grid--vertical" style="height: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center slds-height_full" [style.width.px]="calendar.sheetTimeWidth">{{offset}}</div><div class="slds-border--left slds-p-top--xx-small slds-grow"><div class="slds-p-bottom--xx-small" [ngClass]="dayTextContainerClass" [ngStyle]="isTodayStyle"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextClass">{{displayDate(\'day\')}}</div><h1 class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextClass">{{displayDate(\'date\')}}</h1></div><div [style.min-height.px]="calendar.multiEventHeight" class="slds-text-align--center slds-border--top slds-p-around--xxx-small slds-text-body--small"><ng-container *ngFor="let event of ownerMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [style.height.px]="calendar.multiEventHeight" class="spice-calendar-multi-event-day"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [style.height.px]="calendar.multiEventHeight" class="spice-calendar-multi-event-day"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleMultiEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [style.height.px]="calendar.multiEventHeight" class="spice-calendar-multi-event-day"></calendar-sheet-google-event></ng-container></div></div></div><div #sheetContainer class="slds-scrollable--y slds-is-relative slds-grow calendar-event-drag-boundary"><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [style.width.px]="calendar.sheetTimeWidth" class="slds-height_full"><div class="slds-text-align--center slds-border--bottom" [style.height.px]="calendar.sheetHourHeight">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow" [style.height.px]="calendar.sheetHourHeight"><div class="slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div><ng-container *ngFor="let event of ownerEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,"function"==typeof(n=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?n:Object,"function"==typeof(a=void 0!==core_1.Renderer2&&core_1.Renderer2)?a:Object,calendar])],e)}();exports.CalendarSheetDay=CalendarSheetDay;var CalendarSheetWeek=function(){function e(e,t,s,n){this.language=e,this.cdRef=t,this.renderer=s,this.calendar=n,this.sheetDays=[],this.sheetHours=[],this.setdate={},this.googleIsVisible=!0,this.ownerMultiEvents=[],this.googleMultiEvents=[],this.ownerEvents=[],this.userEvents=[],this.userMultiEvents=[],this.googleEvents=[],this.subscription=new rxjs_1.Subscription,this.buildHours(),this.buildSheetDays(),this.subscribeToChanges()}var t,s,n,a,r;return Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(this.calendar.timeZone).format("z Z")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.googleMultiEvents)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).day(this.calendar.weekStartDay).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(this.calendar.weekDaysCount-1,"d")).hour(this.calendar.endHour)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dayWidthStyle",{get:function(){return{width:"calc(100% / "+this.calendar.weekDaysCount+")"}},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(e){this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.trackByIndexFn=function(e,t){return e},e.prototype.buildSheetDays=function(){this.sheetDays=[];for(var e=0,t=this.calendar.weekStartDay;e<this.calendar.weekDaysCount;){var s=new moment(this.setdate);s.day(t),this.sheetDays.push({index:e,date:moment(s),day:t,color:this.isToday(moment(s))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(s).format("ddd"),dateTextDayNumber:moment(s).format("D"),items:[]}),e++,t++}},e.prototype.setEventsStyle=function(){var t=this;this.allEvents.forEach(function(e){return t.setEventStyle(e)}),this.cdRef.detectChanges()},e.prototype.setEventStyle=function(e){var t=1==this.calendar.weekStartDay&&0==e.start.day()?6:e.start.day()-this.calendar.weekStartDay,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),a=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.sheetContainer.element.nativeElement.clientWidth-a,o=(r-this.sheetTimeWidth)/this.calendar.weekDaysCount/(0<e.maxOverlay?e.maxOverlay:1),i=this.sheetTimeWidth+(r-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+o*e.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);e.style={left:i+"px",width:o+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}},e.prototype.setMultiEventsStyle=function(){var t=this;this.allMultiEvents.forEach(function(e){return t.setMultiEventStyle(e)}),this.cdRef.detectChanges()},e.prototype.setMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth)/this.calendar.weekDaysCount,a=new moment(this.setdate).day(this.calendar.weekStartDay).hour(0).minute(0).second(0),r=new moment(a).add(moment.duration(this.calendar.weekDaysCount,"d")),o=0<+t.start.diff(a,"days")?+t.start.diff(a,"days"):0,i=0<+t.end.diff(r,"days")?0:Math.abs(+t.end.diff(r,"days")),l=o*n,d=(this.calendar.weekDaysCount-(o+i))*n;this.sheetDays.some(function(e){if(-1<e.events.indexOf(t))return s=e.events.indexOf(t),!0}),t.style={width:d+"px",left:l+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.displayDate=function(e,t){return t.format(e)},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.gotoDay=function(e){this.calendar.asPicker||this.calendar.gotToDayView(moment(e.format()))},e.prototype.isToday=function(e){var t=new moment;return t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()},e.prototype.subscribeToChanges=function(){var t=this;this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){"owner"==e.id?t.getOwnerEvents():t.getUserEvents(e)})),this.resizeListener=this.renderer.listen("window","resize",function(){t.setEventsStyle(),t.setMultiEventsStyle()})},e.prototype.arrangeMultiEvents=function(){var e=this;this.sheetDays.forEach(function(e){return e.events=[]});for(var t=function(t){for(var e=0,s=r.sheetDays;e<s.length;e++)for(var n=s[e],a=moment(t.start);a.diff(t.end)<=0;a.add(1,"days"))a.date()!=n.date.date()||n.events.some(function(e){return e.id==t.id})||n.events.push(t)},r=this,s=0,n=this.allMultiEvents;s<n.length;s++){t(n[s])}this.sheetDays.forEach(function(e){e.events=e.events.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),e.events.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}),this.allMultiEvents.forEach(function(n){var a=null;e.sheetDays.forEach(function(s){s.events.forEach(function(e,t){e.id==n.id&&(null!=a&&0<n.end.diff(n.start,"days")?(s.events.splice(t,1),s.events.splice(a,0,n)):a=t)})})})},e.prototype.correctHours=function(e){var n=this;return e.map(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getOwnerEvents=function(){var t=this;if(this.ownerEvents=[],this.ownerMultiEvents=[],this.arrangeMultiEvents(),!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents(),t.setEventsStyle(),t.setMultiEventsStyle())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.arrangeMultiEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents(),t.setEventsStyle(),t.setMultiEventsStyle())})},e.prototype.getUserEvents=function(t){var s=this;if(this.userEvents=this.userEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),this.userMultiEvents=this.userMultiEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),this.arrangeMultiEvents(),this.calendar.isMobileView||!t.visible)return this.cdRef.detectChanges();this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.isMulti?(s.userMultiEvents.push(e),s.arrangeMultiEvents()):s.userEvents.push(e)}),s.setEventsStyle(),s.setMultiEventsStyle())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.userMultiEvents=[],this.arrangeMultiEvents(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),(e=t.filterEvents(e)).forEach(function(e){e.isMulti?(t.userMultiEvents.push(e),t.arrangeMultiEvents()):t.userEvents.push(e)}),t.setEventsStyle(),t.setMultiEventsStyle())})},e.prototype.filterEvents=function(e){var t=this;return e.filter(function(e){return e.end.hour()>t.calendar.startHour||e.start.hour()<t.calendar.endHour||"absence"==e.type})},e.prototype.onEventDrop=function(e){this.calendar.onEventDrop(e,this.dropTargets)},__decorate([core_1.ViewChildren(CalendarSheetDropTarget),__metadata("design:type","function"==typeof(t=void 0!==core_1.QueryList&&core_1.QueryList)?t:Object)],e.prototype,"dropTargets",void 0),__decorate([core_1.ViewChild("sheetContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(s=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?s:Object)],e.prototype,"sheetContainer",void 0),__decorate([core_1.ViewChild("scrollContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(n=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?n:Object)],e.prototype,"scrollContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-week",template:'<div #sheetContainer class="slds-grid slds-grid--vertical" style="height: 100%; width: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [style.width.px]="calendar.sheetTimeWidth">{{offset}}</div><div class="slds-border--right slds-grow"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--left" [ngStyle]="dayWidthStyle"><div class="slds-p-top--xx-small" [style.color]="sheetDay.color"><div class="slds-text-body--regular slds-p-left--x-small">{{sheetDay.dateTextDayShort}}</div><div class="slds-p-left--x-small slds-p-bottom--xx-small slds-border--bottom slds-text-heading--large"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.date)">{{sheetDay.dateTextDayNumber}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of ownerMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleMultiEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" [ngStyle]="dayWidthStyle" [style.min-height.px]="calendar.multiEventHeight" class="slds-border--left"><div *ngFor="let event of sheetDay.events; trackBy: trackByItemFn" [style.height.px]="calendar.multiEventHeight"></div></div></div></div><div #scrollContainer class="slds-scrollable--y" aria-hidden="true" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div class="slds-scrollable--y slds-is-relative slds-grow calendar-event-drag-boundary" style="overflow-y: scroll;"><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [style.width.px]="calendar.sheetTimeWidth"><div class="slds-text-align--center slds-border--bottom" [style.height.px]="calendar.sheetHourHeight">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow slds-grid" [style.height.px]="calendar.sheetHourHeight"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--right" [ngStyle]="dayWidthStyle"><div style="height: 50%" class="slds-grid slds-grid--vertical"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div></div><ng-container *ngFor="let event of ownerEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,"function"==typeof(a=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?a:Object,"function"==typeof(r=void 0!==core_1.Renderer2&&core_1.Renderer2)?r:Object,calendar])],e)}(),CalendarSheetThreeDays=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dayTextContainerClass="",e.dayTextClass="slds-text-body--regular",e.dateTextClass="slds-text-heading--large",e}return __extends(e,t),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(2,"d")).hour(this.calendar.endHour)},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")},e.prototype.buildSheetDays=function(){this.sheetDays=[];for(var e=0;e<3;){var t=new moment(this.setdate);t=t.add(e,"days"),this.sheetDays.push({index:e,date:moment(t),day:moment(t).day(),color:this.isToday(moment(t))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(t).format("ddd"),dateTextDayNumber:moment(t).format("D"),items:[]}),e++}},e.prototype.setEventStyle=function(t){var e=this.sheetDays.find(function(e){return e.day==t.start.day()})||0,s=60*(t.start.hour()-this.calendar.startHour)+t.start.minute(),n=60*(t.end.hour()-this.calendar.startHour)+t.end.minute(),a=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.sheetContainer.element.nativeElement.clientWidth-a,o=(r-this.sheetTimeWidth)/3/(0<t.maxOverlay?t.maxOverlay:1),i=this.sheetTimeWidth+(r-this.sheetTimeWidth)/3*e.index+o*t.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);t.style={left:i+"px",width:o+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}},e.prototype.setMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth)/3,a=new moment(this.setdate).hour(0).minute(0).second(0),r=new moment(a).add(moment.duration(3,"d")),o=0<+t.start.diff(a,"days")?+t.start.diff(a,"days"):0,i=o*n,l=(3-(o+(0<+t.end.diff(r,"days")?0:Math.abs(+t.end.diff(r,"days")))))*n;this.sheetDays.some(function(e){if(-1<e.events.indexOf(t))return s=e.events.indexOf(t),!0}),t.style={width:l+"px",left:i+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.displayDate=function(e,t){switch(e){case"day":return t.format("ddd");case"date":return t.format(this.calendar.isDashlet?"D, MMM":"D")}},e=__decorate([core_1.Component({selector:"calendar-sheet-three-days",template:'<div #sheetContainer class="slds-grid slds-grid--vertical" style="height: 100%; width: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [style.width.px]="calendar.sheetTimeWidth">{{offset}}</div><div class="slds-border--right slds-grow"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--left" style="width: calc(100% / 3)"><div class="slds-p-vertical--xx-small slds-border--bottom" [ngClass]="dayTextContainerClass" [style.color]="sheetDay.color"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextClass">{{sheetDay.dateTextDayShort}}</div><div class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextClass"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.date)">{{sheetDay.dateTextDayNumber}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of ownerMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleMultiEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" style="width: calc(100% / 3)" [style.min-height.px]="calendar.multiEventHeight" class="slds-border--left"><div *ngFor="let event of sheetDay.events; trackBy: trackByItemFn" [style.height.px]="calendar.multiEventHeight"></div></div></div></div><div #scrollContainer aria-hidden="true" class="spice-scrollbar" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div class="slds-scrollable spice-scrollbar slds-is-relative slds-grow calendar-event-drag-boundary" style="overflow-y: scroll;"><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [style.width.px]="calendar.sheetTimeWidth"><div class="slds-text-align--center slds-border--bottom" [style.height.px]="calendar.sheetHourHeight">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow slds-grid" [style.height.px]="calendar.sheetHourHeight"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--right" style="width: calc(100% / 3)"><div style="height: 50%" class="slds-grid slds-grid--vertical"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div></div><ng-container *ngFor="let event of ownerEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of userEvents; trackBy: trackByItemFn"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container><ng-container *ngFor="let event of googleEvents; trackBy: trackByItemFn"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush})],e)}(exports.CalendarSheetWeek=CalendarSheetWeek);exports.CalendarSheetThreeDays=CalendarSheetThreeDays;var CalendarSheetMonth=function(){function e(e,t,s,n,a,r,o,i){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=a,this.renderer=r,this.cdRef=o,this.calendar=i,this.sheetDays=[],this.setdate={},this.googleIsVisible=!0,this.monthGrid=[],this.offsetHeight=20,this.ownerEvents=[],this.userEvents=[],this.googleEvents=[],this.subscription=new rxjs_1.Subscription,this.buildSheetDays(),this.subscribeToChanges()}var t,s,n,a;return e.prototype.subscribeToChanges=function(){var t=this;this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){"owner"==e.id?t.getOwnerEvents():t.getUserEvents(e)})),this.resizeListener=this.renderer.listen("window","resize",function(){return t.setEventsStyle()})},Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.ownerEvents.concat(this.userEvents,this.googleEvents)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eventHeight",{get:function(){return this.calendar.isMobileView?20:25},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxEventsPerDay",{get:function(){var e=this.sheetContainer?this.sheetContainer.element.nativeElement.clientHeight/this.monthGrid.length:void 0;return e?Math.floor((e-2*this.offsetHeight)/this.eventHeight):1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).date(1).hour(0).minute(0).second(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).endOf("month")},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.cdRef.detectChanges()},e.prototype.ngOnChanges=function(e){this.buildGrid(),this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.cdRef.detach(),this.subscription.unsubscribe()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.buildSheetDays=function(){this.sheetDays=[];for(var e=0,t=this.calendar.weekStartDay,s=moment.weekdaysShort();e<this.calendar.weekDaysCount;)this.sheetDays.push({index:e,text:s[t]}),e++,6<++t&&(t=0)},e.prototype.getOwnerEvents=function(){var t=this;if(this.ownerEvents=[],this.arrangeEvents(),!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(t.ownerEvents=e,t.arrangeEvents(),t.setEventsStyle())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.arrangeEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(t.googleEvents=e,t.arrangeEvents(),t.setEventsStyle())})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),this.arrangeEvents(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(s.userEvents=__spreadArray(__spreadArray([],s.userEvents),e),s.arrangeEvents(),s.setEventsStyle())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.arrangeEvents(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(t.userEvents=__spreadArray(__spreadArray([],t.userEvents),e),t.arrangeEvents(),t.setEventsStyle())})},e.prototype.arrangeEvents=function(){for(var o=this,e=function(r){a.monthGrid[r].forEach(function(e){return e.events=[]});for(var e=function(t){t.hasOwnProperty("weeksI")||(t.weeksI=[]);for(var e=0;e<a.monthGrid[r].length;e++){for(var s=a.monthGrid[r][e],n=moment(t.start);n.diff(t.end)<=0;n.add(1,"days"))n.date()==s.day&&s.month==n.month()&&(s.events.some(function(e){return e.id==t.id})||s.events.push(t),-1==t.weeksI.indexOf(r)&&t.weeksI.push(r));s.events=s.events.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),s.events.sort(function(e,t){return e.start.isSame(t.start,"day")&&(e.start.isAfter(t.start,"hour")||e.start.isSame(t.start,"hour")&&e.start.isAfter(t.start,"minute"))?1:-1})}},t=0,s=a.allEvents;t<s.length;t++){e(s[t])}a.allEvents.forEach(function(n){var a=null;o.monthGrid[r].forEach(function(s){s.events.forEach(function(e,t){e.id==n.id&&(null!=a&&0<n.end.diff(n.start,"days")?(s.events.splice(t,1),s.events.splice(a,0,n)):a=t)})})})},a=this,t=0;t<this.monthGrid.length;t++)e(t);return this.allEvents},e.prototype.gotoDay=function(e){var t=moment(this.setdate);t.month(e.month).date(e.day),this.calendar.gotToDayView(t)},e.prototype.getDayColStyle=function(e){var t=new moment,s=t.format("ddd"),n=this.calendar.calendarDate,a=n.year()==t.year()&&n.month()==t.month()&&s==e;return{width:"calc(100% / "+this.calendar.weekDaysCount+")",color:a?this.calendar.todayColor:"inherit","font-weight":a?"600":"inherit"}},e.prototype.getDayDividerStyle=function(e){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*e+"px",top:"0px",height:"100%"}},e.prototype.buildGrid=function(){this.monthGrid=[];var e=new moment(this.setdate);e.date(1),e.day(this.calendar.weekStartDay);for(var t=0;t<6;){var s=0,n=[];if(e.year()<this.setdate.year()||e.month()<=this.setdate.month()){for(;s<this.calendar.weekDaysCount;){n.push({day:e.date(),month:e.month(),items:[]});var a=7-this.calendar.weekDaysCount;s==this.calendar.weekDaysCount-1&&this.calendar.weekDaysCount<7&&e.add(a,"d"),e.add(1,"d"),s++}this.monthGrid.push(n)}t++}},e.prototype.notThisMonth=function(e){return e!==this.setdate.month()},e.prototype.getWeekDividerStyle=function(e){return{top:"calc((100% / "+this.monthGrid.length+") * "+e+" )"}},e.prototype.getDayStyle=function(e,t,s){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*t+"px",top:"calc((100% / "+this.monthGrid.length+") * "+e+")",color:this.notThisMonth(s)?"#9faab5":"inherit","background-color":this.notThisMonth(s)?"#f4f6f9":"transparent",width:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount+"px",height:"calc(100% / "+this.monthGrid.length+")"}},e.prototype.setEventsStyle=function(){var s=this;this.allEvents.forEach(function(t){return t.weeksI.forEach(function(e){return s.setEventStyle(t,e)})}),this.cdRef.detectChanges()},e.prototype.setEventStyle=function(s,e){var n=this,a=null,r=null,o=0,i="block",t=this.sheetContainer.element.nativeElement;this.monthGrid[e].forEach(function(e,t){-1<e.events.indexOf(s)&&(o++,a=null==a?t:a,t,r=r||e.events.indexOf(s),i=r>=n.maxEventsPerDay?"none":i)}),s.style={left:t.clientWidth/this.calendar.weekDaysCount*a+"px",width:t.clientWidth/this.calendar.weekDaysCount*o+"px",top:this.offsetHeight+t.clientHeight/this.monthGrid.length*e+this.eventHeight*r+"px",height:this.eventHeight+"px",display:i}},e.prototype.isTodayStyle=function(e,t){var s=this.calendar.calendarDate.year(),n=new moment,a=s===n.year()&&n.month()===t&&n.date()==e;return{"border-radius":"50%","line-height":"1rem","text-align":"center",width:"1.1rem",height:"1.1rem",display:"block",color:a?"#fff":"inherit","background-color":a?this.calendar.todayColor:"inherit"}},__decorate([core_1.ViewChild("sheetContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(t=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?t:Object)],e.prototype,"sheetContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-month",template:'<div class="slds-grid slds-grid_vertical" style="height: 100%"><div class="slds-border--bottom"><div class="slds-grid"><div class="slds-text-align--center slds-p-vertical--small slds-border--left" *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" [ngStyle]="getDayColStyle(sheetDay.text)">{{sheetDay.text}}</div></div></div><div #sheetContainer class="slds-scrollable slds-p-vertical--medium slds-is-relative slds-grow"><ng-container *ngFor="let sheetWeek of monthGrid; let weekIndex = index; let lastWeek = last trackBy: trackByFnDate"><div *ngFor="let sheetDay of sheetWeek; let dayIndex = index; trackBy: trackByFnDate" class="slds-is-absolute slds-truncate" [ngStyle]="getDayStyle(weekIndex, dayIndex, sheetDay.month)"><div class="slds-p-around--xx-small" [style.height.px]="offsetHeight"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay)" [ngStyle]="isTodayStyle(sheetDay.day, sheetDay.month)">{{sheetDay.day}}</a></div><div class="slds-grid slds-grid--align-center slds-is-absolute" style="bottom: 0;width: 100%" [style.height.px]="offsetHeight"><calendar-more-button *ngIf="sheetDay.events.length > 0 && sheetDay.events.length > maxEventsPerDay" [sheetday]="sheetDay" [moreevents]="sheetDay.events" [ismobileview]="calendar.isMobileView"></calendar-more-button></div></div><div *ngIf="!lastWeek" class="slds-is-absolute slds-border--bottom slds-size--1-of-1" [ngStyle]="getWeekDividerStyle(weekIndex)"></div></ng-container><ng-container *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle(sheetDay.index)"></div></ng-container><ng-container *ngFor="let event of ownerEvents; trackBy: trackByFn"><ng-container *ngFor="let week of event.weeksI; trackBy: trackByFnDate" [ngSwitch]="event.type"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" style="padding: 1px 0" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container><ng-container *ngFor="let event of userEvents; trackBy: trackByFn"><ng-container *ngFor="let week of event.weeksI; trackBy: trackByFnDate" [ngSwitch]="event.type"><calendar-sheet-event [event]="event" [ngStyle]="event.style" (eventChange)="setEventsStyle()" style="padding: 1px 0" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container><ng-container *ngFor="let event of googleEvents; trackBy: trackByFn"><ng-container *ngFor="let week of event.weeksI; trackBy: trackByFnDate" [ngSwitch]="event.type"><calendar-sheet-google-event [event]="event" [ngStyle]="event.style" style="padding: 1px 0" class="spice-calendar-event"></calendar-sheet-google-event></ng-container></ng-container></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,"function"==typeof(s=void 0!==core_1.ElementRef&&core_1.ElementRef)?s:Object,services_1.backend,"function"==typeof(n=void 0!==core_1.Renderer2&&core_1.Renderer2)?n:Object,"function"==typeof(a=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?a:Object,calendar])],e)}();exports.CalendarSheetMonth=CalendarSheetMonth;var CalendarSheetSchedule=function(){function e(e,t,s,n,a,r,o,i){var l=this;this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=a,this.session=r,this.cdRef=o,this.calendar=i,this.untildate$=new core_1.EventEmitter,this.eventDays=[],this.setdate={},this.googleIsVisible=!0,this.ownerEvents=[],this.userEvents=[],this.googleEvents=[],this.untilDate={},this.subscription=new rxjs_1.Subscription,this.untilDate=(new moment).hour(0).minute(0).second(0).add(1,"M"),this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){"owner"==e.id?l.getOwnerEvents():l.getUserEvents(e)}))}var t,s,n;return Object.defineProperty(e.prototype,"showNoRecordsMsg",{get:function(){return 0==this.eventDays.length&&this.calendar.isDashlet},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(0).minute(0).second(0)},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(e){e.setdate&&(this.setUntilDate(),this.getOwnerEvents(),this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.setEventDays=function(){var e=this.groupByDay(this.ownerEvents.concat(this.userEvents,this.googleEvents));e.forEach(function(e){return e.events.sort(function(e,t){return e.start-t.start})}),this.eventDays=e.sort(function(e,t){return e.date-t.date}),this.cdRef.detectChanges()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.setUntilDate=function(){this.untilDate=moment(this.setdate).add(1,"M"),this.untildate$.emit(this.untilDate)},e.prototype.groupByDay=function(e){for(var a=[],r=new moment(this.setdate).hour(0).minute(0).second(0),t=0,s=e;t<s.length;t++)for(var o=s[t],n=new moment(o.start).hour(0).minute(0).second(0),i=new moment(o.end).hour(0).minute(0).second(0),l=function(s){var e=r.year()==s.year()&&r.month()==s.month()&&r.date()==s.date();if(s.isAfter(r)||e){o.timeText=o.isMulti?"All Day":o.start.format("HH:mm")+" - "+o.end.format("HH:mm")+" ";var t={year:s.year(),month:s.month(),day:s.date(),date:moment(s),dateText:moment(s).format("MMM D, YYYY"),dayShortText:moment(s).format("ddd"),events:[o]},n=-1;a.some(function(e,t){if(e.year==s.year()&&e.month==s.month()&&e.day==s.date())return n=t,!0}),0<a.length&&-1<n?a[n].events.push(__assign({},o)):a.push(t)}},d=moment(n);d.diff(i,"days")<=0;d.add(1,"days"))l(d);return a},e.prototype.getOwnerEvents=function(){var t=this;if(this.ownerEvents=[],this.setEventDays(),!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.untilDate).subscribe(function(e){0<e.length&&(t.ownerEvents=e),t.setEventDays()})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleIsVisible&&!this.calendar.isMobileView?this.calendar.loadGoogleEvents(this.startDate,this.untilDate).subscribe(function(e){t.googleEvents=e,t.setEventDays()}):this.setEventDays()},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return!(e.data.assigned_user_id==t.id||e.data.meeting_user_status_accept&&e.data.meeting_user_status_accept.beans[t.id])}),this.setEventDays(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.untilDate,t.id).subscribe(function(e){0<e.length&&(s.userEvents=__spreadArray(__spreadArray([],s.userEvents),e),s.setEventDays())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.setEventDays(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.untilDate).subscribe(function(e){0<e.length&&(t.userEvents=e,t.setEventDays())})},e.prototype.goToDay=function(e){this.calendar.gotToDayView(e)},e.prototype.loadMore=function(){this.untilDate=moment(this.untilDate).add(1,"M"),this.untildate$.emit(this.untilDate),this.getOwnerEvents(),this.getGoogleEvents(),this.getUsersEvents()},__decorate([core_1.Output(),__metadata("design:type","function"==typeof(t=void 0!==core_1.EventEmitter&&core_1.EventEmitter)?t:Object)],e.prototype,"untildate$",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-schedule",template:'<div style="height: 100%" class="slds-scrollable--y"><div *ngFor="let day of eventDays; trackBy: trackByFnDate" class="slds-grid slds-border--bottom"><div class="slds-border--right slds-p-around--xx-small slds-size--1-of-4"><div>{{day.dayShortText}}</div><div><a style="cursor: pointer" class="slds-text-link" (click)="goToDay(day.date)">{{day.dateText}}</a></div></div><div class="slds-size--3-of-4"><div *ngFor="let event of day.events; trackBy: trackByFn; let last = last" [class.slds-border--bottom]="!last" class="slds-grid slds-p-horizontal--xx-small"><div class="slds-button slds-button--icon slds-m-right--x-small slds-p-top--xxx-small" style="height: 100%" [style.color]="event.color"><system-button-icon icon="user" size="small"></system-button-icon></div><div class="slds-truncate slds-size--1-of-4" style="height: 100%;" [title]="event.timeText">{{event.timeText}}</div><div class="slds-grow" [ngSwitch]="event.type"><calendar-sheet-google-event *ngSwitchCase="\'google\'" [event]="event" style="position: initial" class="spice-calendar-event"></calendar-sheet-google-event><calendar-sheet-event *ngSwitchDefault [event]="event" style="position: initial" class="spice-calendar-event"></calendar-sheet-event></div></div></div></div><div *ngIf="!showNoRecordsMsg" class="slds-grid slds-p-around--small"><system-label label="MSG_SHOWING_EVENTS_UNTIL"></system-label> {{untilDate.format(\'MMM D, Y\')}} <a style="cursor: pointer" class="slds-text-link slds-m-left--xx-small" (click)="loadMore()"><system-label label="LBL_MORE"></system-label></a></div><div *ngIf="showNoRecordsMsg" class="slds-align_absolute-center slds-m-top--medium"><system-label label="MSG_NO_RECORDS_FOUND"></system-label></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,"function"==typeof(s=void 0!==core_1.ElementRef&&core_1.ElementRef)?s:Object,services_1.backend,services_1.session,"function"==typeof(n=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?n:Object,calendar])],e)}();exports.CalendarSheetSchedule=CalendarSheetSchedule;var CalendarMorePopover=function(){function CalendarMorePopover(e,t,s,n,a){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=a,this.events=[],this.nubbinClass="",this.popoverStyle={},this.sheetDay={},this.isMobileView=!1,this.hidePopoverTimeout={}}var e,t,s;return Object.defineProperty(CalendarMorePopover.prototype,"shortDate",{get:function(){return this.calendar.calendarDate.month(this.sheetDay.month).date(this.sheetDay.day).format("D MMM,")},enumerable:!1,configurable:!0}),CalendarMorePopover.prototype.ngAfterViewInit=function(){this.setPopoverPosition(),this.cdr.detectChanges()},CalendarMorePopover.prototype.closePopover=function(e,t){var s=this;if(void 0===e&&(e=!1),e)if(t&&t.relatedTarget.classList.contains("slds-dropdown"))var n=this.renderer.listen(t.relatedTarget,"click",function(){n(),s.self.destroy()});else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout(function(){return s.self.destroy()},500)},CalendarMorePopover.prototype.setPopoverPosition=function(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};var e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&0<s.top-n.height+30?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t},CalendarMorePopover.prototype.trackByFn=function(e,t){return t.id},CalendarMorePopover.prototype.onMouseOver=function(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)},CalendarMorePopover.prototype.onMouseOut=function(e){this.closePopover(!0,e)},__decorate([core_1.ViewChild("popoverContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],CalendarMorePopover.prototype,"popoverContainer",void 0),CalendarMorePopover=__decorate([core_1.Component({template:'<div class="slds-popover slds-popover--panel slds-is-fixed" [ngStyle]="popoverStyle" [ngClass]="nubbinClass" role="dialog" (mouseenter)="onMouseOver()" (mouseleave)="onMouseOut($event)"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popoverContainer><div class="slds-popover__header" style="padding: .5rem"><header class="slds-text-heading--small slds-m-bottom--x-small">{{shortDate}} {{\'(\'+ events.length +\')\'}} <system-label label="LBL_EVENTS"></system-label></header><div class="slds-scrollable--y" style="height: 120px"><ng-container *ngFor="let event of events; trackBy: trackByFn" [ngSwitch]="event.type"><calendar-sheet-google-event *ngSwitchCase="\'google\'" [event]="event" [style.height.px]="calendar.multiEventHeight" class="spice-calendar-more-event"></calendar-sheet-google-event><calendar-sheet-event *ngSwitchDefault [event]="event" [style.height.px]="calendar.multiEventHeight" class="spice-calendar-more-event"></calendar-sheet-event></ng-container></div></div></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.metadata,calendar,services_1.language,"function"==typeof(t=void 0!==core_1.Renderer2&&core_1.Renderer2)?t:Object,"function"==typeof(s=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?s:Object])],CalendarMorePopover)}();exports.CalendarMorePopover=CalendarMorePopover;var CalendarGoogleEventPopover=function(){function CalendarGoogleEventPopover(e,t,s,n,a){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=a,this.event={},this.nubbinClass="",this.popoverStyle={},this.isMobileView=!1,this.hidePopoverTimeout={}}var e,t,s;return CalendarGoogleEventPopover.prototype.ngAfterViewInit=function(){this.setPopoverPosition(),this.cdr.detectChanges()},CalendarGoogleEventPopover.prototype.closePopover=function(e,t){var s=this;if(void 0===e&&(e=!1),e)if(t&&t.relatedTarget.classList.contains("slds-dropdown"))var n=this.renderer.listen(t.relatedTarget,"click",function(){n(),s.self.destroy()});else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout(function(){return s.self.destroy()},500)},CalendarGoogleEventPopover.prototype.setPopoverPosition=function(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};var e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&0<s.top-n.height+30?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t},CalendarGoogleEventPopover.prototype.onMouseEnter=function(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)},CalendarGoogleEventPopover.prototype.onMouseLeave=function(e){this.closePopover(!0,e)},__decorate([core_1.ViewChild("popoverContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],CalendarGoogleEventPopover.prototype,"popoverContainer",void 0),CalendarGoogleEventPopover=__decorate([core_1.Component({template:'<div class="slds-popover slds-popover--panel slds-is-fixed" [ngStyle]="popoverStyle" [ngClass]="nubbinClass" role="dialog" (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave($event)"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popoverContainer><div class="slds-popover__header" style="padding: .5rem"><header [system-title]="event.summary" class="slds-text-heading--small slds-m-bottom--x-small slds-truncate slds-has-divider--bottom-space">{{event.summary}}</header><div class="slds-scrollable--y" style="height: 120px"><dl class="slds-list_horizontal slds-wrap slds-text-body_small"><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_DESCRIPTION"></system-label></dt><dd [innerHTML]="event.description" class="slds-item_detail slds-m-bottom--x-small"></dd><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_LOCATION"></system-label></dt><dd [system-title]="event.location" class="slds-item_detail slds-m-bottom--x-small">{{event.location}}</dd></dl></div></div></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.metadata,calendar,services_1.language,"function"==typeof(t=void 0!==core_1.Renderer2&&core_1.Renderer2)?t:Object,"function"==typeof(s=void 0!==core_1.ChangeDetectorRef&&core_1.ChangeDetectorRef)?s:Object])],CalendarGoogleEventPopover)}();exports.CalendarGoogleEventPopover=CalendarGoogleEventPopover;var CalendarMoreButton=function(){function e(e,t,s,n,a){this.elementRef=e,this.language=t,this.footer=s,this.injector=n,this.metadata=a,this.events=[],this.isMobileView=!1,this.sheetDay={},this.popoverComponentRef=null,this.showPopoverTimeout={}}var t,s;return e.prototype.ngOnDestroy=function(){this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.renderPopover()},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()},e.prototype.renderPopover=function(){var t=this;this.metadata.addComponent("CalendarMorePopover",this.footer.modalcontainer,this.injector).subscribe(function(e){e.instance.events=t.events.slice().sort(function(e,t){return e.start.isAfter(t.start)?1:-1}),e.instance.isMobileView=t.isMobileView,e.instance.sheetDay=t.sheetDay,e.instance.parentElementRef=t.elementRef,t.popoverComponentRef=e.instance})},__decorate([core_1.Input("moreevents"),__metadata("design:type",Array)],e.prototype,"events",void 0),__decorate([core_1.Input("ismobileview"),__metadata("design:type",Boolean)],e.prototype,"isMobileView",void 0),__decorate([core_1.Input("sheetday"),__metadata("design:type",Object)],e.prototype,"sheetDay",void 0),__decorate([core_1.HostListener("mouseenter"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOver",null),__decorate([core_1.HostListener("mouseleave"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOut",null),e=__decorate([core_1.Component({selector:"calendar-more-button",template:'<span style="cursor: pointer"><system-label label="LBL_MORE"></system-label></span>'}),__metadata("design:paramtypes",["function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,services_1.language,services_1.footer,"function"==typeof(s=void 0!==core_1.Injector&&core_1.Injector)?s:Object,services_1.metadata])],e)}();exports.CalendarMoreButton=CalendarMoreButton;var CalendarAddCalendar=function(){function CalendarAddCalendar(e,t){this.language=e,this.backend=t,this.calendars=[],this.addCalendar=new core_1.EventEmitter,this.self={}}return CalendarAddCalendar.prototype.getIcon=function(e){return e&&e.split(":")[1]?e.split(":")[1]:e},CalendarAddCalendar.prototype.getSprite=function(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"},CalendarAddCalendar.prototype.close=function(){this.addCalendar.emit(!1),this.self.destroy()},CalendarAddCalendar.prototype.save=function(e){this.addCalendar.emit(e),this.self.destroy()},CalendarAddCalendar.prototype.trackByFn=function(e,t){return t.id},CalendarAddCalendar=__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()"><system-label label="LBL_ADD_CALENDAR"></system-label></system-modal-header><system-modal-content><div class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let calendar of calendars; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="save(calendar)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [icon]="getIcon(calendar.icon)" [sprite]="getSprite(calendar.icon)" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate"><system-label [label]="calendar.name"></system-label></h2></div></a></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.backend])],CalendarAddCalendar)}();exports.CalendarAddCalendar=CalendarAddCalendar;var CalendarAddModulesModal=function(){function CalendarAddModulesModal(e,t){this.language=e,this.calendar=t,this.module$=new core_1.EventEmitter,this.self={}}return CalendarAddModulesModal.prototype.close=function(){this.module$.emit(!1),this.self.destroy()},CalendarAddModulesModal.prototype.save=function(e){this.module$.emit(e),this.self.destroy()},CalendarAddModulesModal.prototype.trackByFn=function(e,t){return t.id},CalendarAddModulesModal=__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()"><system-label label="LBL_MODULES"></system-label></system-modal-header><system-modal-content><div class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let module of calendar.modules; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="save(module)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [module]="module.name" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate"><system-label-modulename [module]="module.name"></system-label-modulename></h2></div></a></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button></system-modal-footer></system-modal>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,calendar])],CalendarAddModulesModal)}();exports.CalendarAddModulesModal=CalendarAddModulesModal;var CalendarOtherCalendarsMonitor=function(){function e(e,t,s,n){this.language=e,this.recent=t,this.calendar=s,this.fts=n,this.usersCalendars=[],this.googleIsVisible$=new core_1.EventEmitter,this.searchterm="",this.searchopen=!1,this.resultsList=[],this.recentUsers=[],this.timeout=void 0,this.isLoading=!1,this.hovered="",this.googleIsVisible=!0,this.getRecent()}var t,s;return Object.defineProperty(e.prototype,"searchOpen",{get:function(){return this.searchopen},set:function(e){(this.searchopen=e)&&this.getRecent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookupMenuStyle",{get:function(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchTerm",{get:function(){return this.searchterm},set:function(e){var t=this;window.clearTimeout(this.timeout),e&&0!=e.length&&(this.timeout=window.setTimeout(function(){t.searchterm=e,t.isLoading=!0,t.fts.searchByModules({searchterm:t.searchterm,modules:["Users"],size:5,sortparams:{sortfield:"full_name",sortdirection:"asc"}}).subscribe(function(e){t.filterResultsList(e.Users.hits.map(function(e){return e._source})),t.isLoading=!1},function(e){return t.isLoading=!1})},500))},enumerable:!1,configurable:!0}),e.prototype.getRecent=function(){var t=this;this.recent.getModuleRecent("Users").subscribe(function(e){return t.filterRecent(e)})},e.prototype.filterRecent=function(e){var t=this;this.recentUsers=e.filter(function(e){return e.item_id!=t.calendar.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.item_id})})},e.prototype.filterResultsList=function(e){var t=this;this.resultsList=e.filter(function(e){return e.id!=t.calendar.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.id})})},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.addUserCalendar=function(e,t){this.calendar.addUserCalendar(e,t),this.filterRecent(this.recentUsers),this.filterResultsList(this.resultsList)},e.prototype.removeUserCalendar=function(e){this.calendar.removeUserCalendar(e)},e.prototype.toggleVisible=function(e,t){switch(t){case"Owner":this.calendar.toggleOwnerCalendarVisible();break;case"Users":this.calendar.toggleUserCalendarVisibility(e);break;case"Google":this.googleIsVisible=!this.googleIsVisible,this.googleIsVisible$.emit(this.googleIsVisible)}},e.prototype.setUserColor=function(e,t){this.calendar.setUserColor(e,t)},__decorate([core_1.Input(),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Output(),__metadata("design:type","function"==typeof(t=void 0!==core_1.EventEmitter&&core_1.EventEmitter)?t:Object)],e.prototype,"googleIsVisible$",void 0),__decorate([core_1.ViewChild("inputcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(s=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?s:Object)],e.prototype,"inputContainer",void 0),e=__decorate([core_1.Component({selector:"calendar-other-calendars-monitor",template:'<div class="slds-border--bottom"><label class="slds-form-element__label slds-text-heading--small slds-p-horizontal--small"><system-label label="LBL_OTHER_CALENDARS"></system-label></label><div class="slds-p-vertical--xx-small"><div class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = \'own\'" (mouseleave)="hovered = \'\'" [class.slds-theme--shade]="hovered == \'own\'"><div class="slds-grid" (click)="toggleVisible(null, \'Owner\')" style="cursor: pointer"><div class="slds-button slds-button--icon slds-m-right--xx-small slds-p-top--xxx-small" [style.color]="calendar.ownerCalendarVisible ? calendar.eventColor : \'#dddbda\'"><system-button-icon icon="user" size="small"></system-button-icon></div><a class="slds-text-body--regular slds-truncate" [style.color]="calendar.ownerCalendarVisible ? calendar.eventColor : \'#dddbda\'"><system-label label="LBL_MY_CALENDAR"></system-label></a></div></div><div *ngIf="calendar.loggedByGoogle" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = \'google\'" (mouseleave)="hovered = \'\'" [ngClass]="hovered == \'google\' ? \'slds-theme--shade\' : \'\'"><div class="slds-grid" (click)="toggleVisible(null, \'Google\')" style="cursor: pointer"><img src="https://developers.google.com/identity/images/g-logo.png" style="height: 13px;width:13px;margin-right: 2px; margin-top: 2px" alt="G" [ngStyle]="!googleIsVisible ? {\'-webkit-filter\': \'grayscale(1)\',\'filter\': \'grayscale(1)\'} : {}"> <a class="slds-text-body--regular slds-truncate" [style.color]="!googleIsVisible ? \'#dddbda\' : calendar.googleColor"><system-label label="MY_GOOGLE_CALENDAR"></system-label></a></div></div><div *ngFor="let usersCalendar of usersCalendars; trackBy: trackByFn" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = usersCalendar.id" (mouseleave)="hovered = \'\'" [class.slds-theme--shade]="hovered == usersCalendar.id"><div class="slds-grid" (click)="toggleVisible(usersCalendar.id, \'Users\')" style="cursor: pointer"><div class="slds-button slds-button--icon slds-m-right--xx-small slds-p-top--xxx-small" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'"><system-button-icon icon="user" size="small"></system-button-icon></div><a class="slds-text-body--regular slds-truncate" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'">{{usersCalendar.name}}</a></div><div><calendar-color-picker *ngIf="hovered == usersCalendar.id" (colorChange)="setUserColor(usersCalendar.id, $event)"></calendar-color-picker><button class="slds-button slds-button--icon" (click)="removeUserCalendar(usersCalendar.id)"><system-button-icon icon="clear" size="small"></system-button-icon></button></div></div></div></div><div class="slds-form-element__control slds-p-around--x-small slds-border--bottom slds-theme--default" style="height: 52px"><div #inputcontainer class="slds-form-element slds-lookup"><div class="slds-form-element__control slds-grid slds-box--border slds-m-vertical--xxx-small"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="searchTerm" (focus)="searchOpen = true" (blur)="searchOpen = false" [system-placeholder]="language.getLabel(\'LBL_ADD\') + \' \' + language.getLabel(\'LBL_USER\') + \' \' + language.getLabel(\'LBL_CALENDAR\')" role="combobox"></div></div></div><div *ngIf="searchopen" class="slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none" [ngStyle]="lookupMenuStyle"><div *ngIf="searchterm.length > 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom">{{resultsList.length}} <system-label label="LBL_USERS"></system-label> <system-label label="LBL_FOUND"></system-label></div><div *ngIf="searchterm.length == 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom"><system-label label="LBL_RECENTLYVIEWED"></system-label></div><ul class="slds-lookup__list" style="height: 175px" role="listbox"><ng-container *ngIf="searchterm.length > 0"><li *ngFor="let user of resultsList; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.id, user.summary_text)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.summary_text}}</span></div></li></ng-container><ng-container *ngIf="searchterm.length == 0"><li *ngFor="let user of recentUsers; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.item_id, user.item_summary)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.item_summary}}</span></div></li></ng-container></ul><system-spinner [size]="16" *ngIf="isLoading && resultsList.length == 0"></system-spinner></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[services_1.language,services_1.recent,calendar,services_1.fts])],e)}();exports.CalendarOtherCalendarsMonitor=CalendarOtherCalendarsMonitor;var CalendarColorPicker=function(){function e(e){this.calendar=e,this.colorChange=new core_1.EventEmitter,this.isOpen=!1}var t;return e.prototype.pickColor=function(e){this.colorChange.emit("#"+e),this.isOpen=!1},__decorate([core_1.Output(),__metadata("design:type","function"==typeof(t=void 0!==core_1.EventEmitter&&core_1.EventEmitter)?t:Object)],e.prototype,"colorChange",void 0),e=__decorate([core_1.Component({selector:"calendar-color-picker",template:'<div class="slds-dropdown-trigger slds-dropdown-trigger_click slds-m-right--x-small" [class.slds-is-open]="isOpen"><button class="slds-button slds-button--icon" aria-haspopup="true" (click)="isOpen = !isOpen"><system-button-icon icon="palette" size="small"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown_bottom"><div class="slds-color-picker slds-color-picker_swatches-only"><div class="slds-color-picker__selector"><ul class="slds-color-picker__swatches" role="menu"><li *ngFor="let color of calendar.colorPalette" class="slds-color-picker__swatch" role="presentation"><a class="slds-color-picker__swatch-trigger slds-is-selected" role="menuitem" (click)="pickColor(color)"><span class="slds-swatch" [style.background-color]="\'#\' + color"><span class="slds-assistive-text">#{{color}}</span></span></a></li></ul></div></div></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[calendar])],e)}();exports.CalendarColorPicker=CalendarColorPicker;var CalendarScheduleDashlet=function(){function CalendarScheduleDashlet(e,t,s,n,a){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=a,this.scheduleUntilDate={},this.calendar.isDashlet=!0,this.calendar.sheetType="Schedule",this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}var e,t,s;return Object.defineProperty(CalendarScheduleDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"contentStyle",{get:function(){return{height:this.headerContainer?"calc(100% - "+this.headerContainer.element.nativeElement.offsetHeight+"px)":"100px",width:"100%"}},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"title",{get:function(){return new moment(this.calendarDate).format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY")},enumerable:!1,configurable:!0}),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],CalendarScheduleDashlet.prototype,"headerContainer",void 0),CalendarScheduleDashlet=__decorate([core_1.Component({selector:"calendar-schedule-dashlet",template:'<div class="slds-height_full"><div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium slds-truncate">{{title}}</h2></div><div [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-schedule [setdate]="calendarDate" (untildate$)="scheduleUntilDate = $event"></calendar-sheet-schedule></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,"function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,"function"==typeof(s=void 0!==core_1.Renderer2&&core_1.Renderer2)?s:Object,calendar])],CalendarScheduleDashlet)}();exports.CalendarScheduleDashlet=CalendarScheduleDashlet;var CalendarDayDashlet=function(){function CalendarDayDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletLabel=null,this.calendar.isDashlet=!0,this.calendar.sheetType="Day",this.calendar.sheetHourHeight=50}var e,t;return Object.defineProperty(CalendarDayDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarDayDashlet.prototype,"contentStyle",{get:function(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}},enumerable:!1,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],CalendarDayDashlet.prototype,"calendarContent",void 0),CalendarDayDashlet=__decorate([core_1.Component({selector:"calendar-day-dashlet",template:'<div class="slds-height_full"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium"><system-label [label]="dashletLabel"></system-label></h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-day [setdate]="calendarDate"></calendar-sheet-day></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,"function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,calendar])],CalendarDayDashlet)}();exports.CalendarDayDashlet=CalendarDayDashlet;var CalendarThreeDaysDashlet=function(){function CalendarThreeDaysDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletLabel=null,this.setCalendarType()}var e,t;return Object.defineProperty(CalendarThreeDaysDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!1,configurable:!0}),Object.defineProperty(CalendarThreeDaysDashlet.prototype,"contentStyle",{get:function(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}},enumerable:!1,configurable:!0}),CalendarThreeDaysDashlet.prototype.setCalendarType=function(){this.calendar.isDashlet=!0,this.calendar.sheetType="Three_Days",this.calendar.sheetHourHeight=50},__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type","function"==typeof(e=void 0!==core_1.ViewContainerRef&&core_1.ViewContainerRef)?e:Object)],CalendarThreeDaysDashlet.prototype,"calendarContent",void 0),CalendarThreeDaysDashlet=__decorate([core_1.Component({selector:"calendar-three-days-dashlet",template:'<div class="slds-height_full"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium"><system-label [label]="dashletLabel"></system-label></h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-three-days [setdate]="calendarDate"></calendar-sheet-three-days></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,"function"==typeof(t=void 0!==core_1.ElementRef&&core_1.ElementRef)?t:Object,calendar])],CalendarThreeDaysDashlet)}();exports.CalendarThreeDaysDashlet=CalendarThreeDaysDashlet;var ModuleCalendar=function(){function ModuleCalendar(){}return ModuleCalendar=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule,drag_drop_1.DragDropModule],declarations:[Calendar,CalendarHeader,CalendarSheetDay,CalendarSheetThreeDays,CalendarSheetWeek,CalendarSheetMonth,CalendarSheetSchedule,CalendarSheetEvent,CalendarSheetGoogleEvent,CalendarSheetDropTarget,CalendarMorePopover,CalendarGoogleEventPopover,CalendarMoreButton,CalendarAddCalendar,CalendarAddModulesModal,CalendarOtherCalendarsMonitor,CalendarColorPicker,CalendarScheduleDashlet,CalendarDayDashlet,CalendarThreeDaysDashlet],providers:[services_1.userpreferences]})],ModuleCalendar)}();exports.ModuleCalendar=ModuleCalendar;