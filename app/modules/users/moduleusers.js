/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-16 09:05:07
 * build: 2021.02.001.1626419107136
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,s,t,o){var a,l=arguments.length,r=l<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,s,t,o);else for(var i=e.length-1;0<=i;i--)(a=e[i])&&(r=(l<3?a(r):3<l?a(s,t,r):a(s,t))||r);return 3<l&&r&&Object.defineProperty(s,t,r),r},__metadata=this&&this.__metadata||function(e,s){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,s)},__param=this&&this.__param||function(t,o){return function(e,s){o(e,s,t)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleUsers=exports.UserDeactivateSelectUser=exports.UserDeactivateModal=exports.UserDeactivateButton=exports.UserPopoverHeader=exports.UserAddModal=exports.UserAddButton=exports.UserRolesAddModal=exports.UserRoles=exports.UserPreferences=exports.UserResetPasswordButton=exports.UserResetPasswordModal=exports.UserChangePasswordModal=exports.UserChangePasswordButton=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),directives_1=require("../../directives/directives"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),services_1=require("../../services/services"),http_1=require("@angular/common/http"),rxjs_1=require("rxjs"),UserChangePasswordButton=function(){function UserChangePasswordButton(e,s,t){this.language=e,this.modal=s,this.model=t}return Object.defineProperty(UserChangePasswordButton.prototype,"disabled",{get:function(){return 0==this.model.getFieldValue("external_auth_only")},enumerable:!1,configurable:!0}),UserChangePasswordButton.prototype.execute=function(){this.modal.openModal("UserChangePasswordModal")},__decorate([core_1.Component({selector:"user-change-password-button",template:"<span>Change Password</span>"}),__metadata("design:paramtypes",[services_1.language,services_1.modal,services_1.model])],UserChangePasswordButton)}();exports.UserChangePasswordButton=UserChangePasswordButton;var UserChangePasswordModal=function(){function UserChangePasswordModal(e,s,t,o,a){this.http=e,this.language=s,this.session=t,this.toast=o,this.configuration=a,this.password="",this.newPassword="",this.repeatPassword="",this.pwdCheck=new RegExp("//"),this.pwdGuideline="",this.repFieldVisited=!1,this.self=void 0,this.posting=!1}return UserChangePasswordModal.prototype.ngOnInit=function(){this.getInfo()},Object.defineProperty(UserChangePasswordModal.prototype,"pwderror",{get:function(){return!(!this.newPassword||this.pwdCheck.test(this.newPassword))&&this.language.getLabel("MSG_PWD_NOT_LEGAL")},enumerable:!1,configurable:!0}),Object.defineProperty(UserChangePasswordModal.prototype,"pwdreperror",{get:function(){return this.newPassword!=this.repeatPassword&&this.language.getLabel("MSG_PWDS_DONT_MATCH")},enumerable:!1,configurable:!0}),UserChangePasswordModal.prototype.close=function(){this.self.destroy()},UserChangePasswordModal.prototype.canSave=function(){return this.password&&this.newPassword&&!1===this.pwderror&&this.newPassword!==this.password&&!1===this.pwdreperror},UserChangePasswordModal.prototype.save=function(){var s=this;this.canSave()&&this.http.post(this.configuration.getBackendUrl()+"/authentication/changepassword",{username:this.session.authData.userName,password:this.password,newPassword:this.newPassword}).subscribe(function(e){s.toast.sendToast(s.language.getLabel("MSG_PWD_CHANGED_SUCCESSFULLY"),"info"),s.close()},function(e){s.toast.sendToast(s.language.getLabel("ERR_CHANGING_PWD"),"error",null,10),s.posting=!1})},UserChangePasswordModal.prototype.getInfo=function(){var e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);var s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")},__decorate([core_1.Component({selector:"user-changepassword-modal",template:'<system-modal><system-modal-header (close)="close()"><system-label label="LBL_CHANGE_PWD"></system-label></system-modal-header><system-modal-content><div class="slds-form--stacked slds-text-align--left" (submit)="save()"><div class="slds-form-element"><label class="slds-form-element__label"><system-label label="LBL_OLD_PWD"></system-label></label><system-input-password tabindex="1" autocomplete="off" [disabled]="posting" [(ngModel)]="password"></system-input-password></div><div *ngIf="pwdGuideline" class="slds-m-vertical--medium"><system-label label="LBL_PWD_GUIDELINE"></system-label>: {{pwdGuideline}}<br></div><div class="slds-form-element" [ngClass]="{\'slds-has-error\':pwderror}"><label class="slds-form-element__label"><system-label label="LBL_NEW_PWD"></system-label></label><system-input-password tabindex="2" autocomplete="off" [(ngModel)]="newPassword"></system-input-password><div *ngIf="pwderror" class="slds-form-element__help">{{pwderror}}</div></div><div class="slds-form-element" [ngClass]="{\'slds-has-error\':repFieldVisited && pwdreperror}"><label class="slds-form-element__label"><system-label label="LBL_NEW_PWD_REPEATED"></system-label></label><system-input-password tabindex="3" autocomplete="off" [(ngModel)]="repeatPassword"></system-input-password></div><div *ngIf="pwdreperror" class="slds-form-element__help">{{pwdreperror}}</div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" [disabled]="!canSave()" (click)="save()"><system-label label="LBL_CHANGE_PASSWORD"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[http_1.HttpClient,services_1.language,services_1.session,services_1.toast,services_1.configurationService])],UserChangePasswordModal)}();exports.UserChangePasswordModal=UserChangePasswordModal;var UserResetPasswordModal=function(){function UserResetPasswordModal(e,s,t,o,a,l){this.model=e,this.language=s,this.toast=t,this.session=o,this.backend=a,this.configuration=l,this.self=void 0,this.password=void 0,this.repeatPassword=void 0,this.pwdCheck=new RegExp("//"),this.pwdGuideline=void 0,this.autogenerate=!1,this.sendByEmail=!1,this.showPassword=!1,this.forceReset=!0,this.autocompletebreaker="",this.updating=!1,this.getInfo()}return Object.defineProperty(UserResetPasswordModal.prototype,"passwordError",{get:function(){return this.password&&!this.pwdCheck.test(this.password)},enumerable:!1,configurable:!0}),Object.defineProperty(UserResetPasswordModal.prototype,"repeatPasswordError",{get:function(){return this.repeatPassword&&this.password!==this.repeatPassword},enumerable:!1,configurable:!0}),Object.defineProperty(UserResetPasswordModal.prototype,"autoGenerate",{get:function(){return this.autogenerate},set:function(e){this.autogenerate=e,this.password=e?this.generatePassword():void 0,this.repeatPassword=this.password},enumerable:!1,configurable:!0}),UserResetPasswordModal.prototype.toggleShowPassword=function(){this.showPassword=!this.showPassword},UserResetPasswordModal.prototype.copyPassword=function(){var e;this.autoGenerate&&((e=document.createElement("textarea")).style.position="fixed",e.style.left="0",e.style.top="0",e.style.opacity="0",e.value=this.password,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.toast.sendToast("Password copied","success"))},UserResetPasswordModal.prototype.getInfo=function(){var e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);var s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")},UserResetPasswordModal.prototype.generatePassword=function(){var e=[],s=this.configuration.getCapabilityConfig("userpassword");s.onelower&&e.push(this.randomLower()),s.oneupper&&e.push(this.randomUpper()),s.onenumber&&e.push(this.randomNumber());for(var t=s.minpwdlength?parseInt(s.minpwdlength,10):8;e.length<t;)e.push(this.randomLower());return(e=this.shuffle(e)).join("")},UserResetPasswordModal.prototype.shuffle=function(e){for(var s,t,o=e.length;0!==o;)t=Math.floor(Math.random()*o),s=e[--o],e[o]=e[t],e[t]=s;return e},UserResetPasswordModal.prototype.randomUpper=function(){return String.fromCharCode(Math.floor(26*Math.random())+65)},UserResetPasswordModal.prototype.randomLower=function(){return String.fromCharCode(Math.floor(26*Math.random())+97)},UserResetPasswordModal.prototype.randomNumber=function(){return String.fromCharCode(Math.floor(9*Math.random())+48)},Object.defineProperty(UserResetPasswordModal.prototype,"canSave",{get:function(){return!(this.updating||this.passwordError||this.repeatPasswordError||!this.session.isAdmin)},enumerable:!1,configurable:!0}),UserResetPasswordModal.prototype.setPassword=function(){var s=this;this.canSave&&(this.updating=!0,this.backend.postRequest("module/Users/"+this.model.id+"/password/reset",{},{newPassword:this.password,forceReset:this.autoGenerate,sendEmail:this.sendByEmail}).subscribe(function(e){s.close(),s.toast.sendToast("Password Reset!","info")},function(e){s.updating=!1,s.toast.sendToast("Error resetting the password","error")}))},UserResetPasswordModal.prototype.close=function(){this.self.destroy()},__decorate([core_1.Component({selector:"user-reset-password-modal",template:'<system-modal size="small"><system-modal-header (close)="close()"><system-label label="LBL_RESET_PASSWORD"></system-label></system-modal-header><system-modal-content [system-overlay-loading-spinner]="updating"><div class="slds-form--stacked slds-text-align--left"><div class="slds-form--stacked slds-text-align--left"><div *ngIf="pwdGuideline" class="slds-m-vertical--medium"><system-label label="LBL_PWD_GUIDELINE"></system-label>: {{pwdGuideline}}<br></div><div class="slds-grid"><div class="slds-grow"><div class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input #passField="ngModel" [autocomplete]="autocompletebreaker" [type]="showPassword ? \'text\' : \'password\'" [(ngModel)]="password" class="slds-input" system-placeholder="MSG_ENTER_NEW_PASSWORD" [disabled]="autoGenerate"></div><div *ngIf="passwordError" class="slds-form-element__help slds-text-color--error"><system-label label="LBL_PASSWORD_REQ_CHECK_ERR"></system-label></div></div><div class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input [autocomplete]="autocompletebreaker" [type]="showPassword ? \'text\' : \'password\'" #repPassField="ngModel" [(ngModel)]="repeatPassword" class="slds-input" system-placeholder="MSG_REPEAT_PASSWORD" [disabled]="autoGenerate"></div><div *ngIf="repeatPasswordError" class="slds-form-element__help slds-text-color--error"><system-label label="LBL_PASSWORDS_DONT_MATCH"></system-label></div></div></div><div class="slds-p-horizontal--xx-small slds-p-vertical--small"><button class="slds-button slds-button--icon-border slds-button--neutral" (click)="toggleShowPassword()"><system-button-icon [icon]="!showPassword ? \'preview\': \'hide\'" size="medium"></system-button-icon></button> <button [disabled]="!autoGenerate" class="slds-button slds-button--icon-border slds-button--neutral" (click)="copyPassword()"><system-button-icon icon="copy" size="medium"></system-button-icon></button></div></div></div><div class="slds-form-element"><div class="slds-form-element__control slds-grid"><system-checkbox class="slds-m-around--x-small" [(ngModel)]="autoGenerate"><system-label label="LBL_AUTO_GENERATE"></system-label></system-checkbox><system-checkbox class="slds-m-around--x-small" [(ngModel)]="sendByEmail"><system-label label="LBL_SEND_BY_EMAIL"></system-label></system-checkbox><system-checkbox class="slds-m-around--x-small" [(ngModel)]="forceReset"><system-label label="LBL_FORCE_RESET"></system-label></system-checkbox></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" [disabled]="!canSave" (click)="setPassword()"><system-label label="LBL_SET_PASSWORD"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.toast,services_1.session,services_1.backend,services_1.configurationService])],UserResetPasswordModal)}();exports.UserResetPasswordModal=UserResetPasswordModal;var UserResetPasswordButton=function(){function UserResetPasswordButton(e,s,t,o,a){this.modal=e,this.language=s,this.model=t,this.session=o,this.injector=a}return Object.defineProperty(UserResetPasswordButton.prototype,"disabled",{get:function(){return!this.session.isAdmin||"Active"!=this.model.getField("status")||0!=this.model.getFieldValue("external_auth_only")},enumerable:!1,configurable:!0}),UserResetPasswordButton.prototype.execute=function(){this.session.isAdmin&&this.modal.openModal("UserResetPasswordModal",!0,this.injector)},__decorate([core_1.Component({template:"<span>Reset Password</span>"}),__metadata("design:paramtypes",[services_1.modal,services_1.language,services_1.model,services_1.session,core_1.Injector])],UserResetPasswordButton)}();exports.UserResetPasswordButton=UserResetPasswordButton;var UserPreferences=function(){function UserPreferences(e,s,t,o,a,l,r,i,n,d,c){this.backend=e,this.view=s,this.toast=t,this.currency=o,this.language=a,this.preferencesService=l,this.session=r,this.model=i,this.broadcast=n,this.configuration=d,this.metadata=c,this.preferences={},this.names=["export_delimiter","default_export_charset","currency","default_currency_significant_digits","datef","timef","timezone","num_grp_sep","dec_sep","default_locale_name_format","week_day_start","week_days_count","calendar_day_start_hour","calendar_day_end_hour","reminder_time","home_dashboard","home_dashboardset","home_assistant","help_icon","navigation_paradigm","distance_unit_system"],this.dashboardSets=[],this.dashboardSetData={},this.homeDashboardData={},this.dashboards=[],this.loadedSubscription=new rxjs_1.Subject,this.isLoading=!0,this.loadInitialValues()}return UserPreferences.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},UserPreferences.prototype.loadInitialValues=function(){this.view.isEditable=!0,this.isCurrentUser=this.session.authData.userId==this.model.data.id;var e=this.configuration.getSystemParamater("aclcontroller");this.canEdit=e&&"spiceacl"!=e?this.isCurrentUser||this.session.isAdmin&&this.configuration.getSystemParamater("enableSettingUserPrefsByAdmin"):this.metadata.checkModuleAcl("UserPreferences","edit"),this.loadDashboardsLists(),this.loadPreferences()},UserPreferences.prototype.loadPreferences=function(){var s=this;this.isCurrentUser?(this.subscriptions=this.loadedSubscription.subscribe(function(){s.isLoading=!1,s.preferences=_.pick(s.preferencesService.unchangedPreferences.global,s.names),s.setDashboardSetData(s.preferences.home_dashboardset),s.setHomeDashboardData(s.preferences.home_dashboard)}),this.preferencesService.getPreferences(this.loadedSubscription)):this.canEdit&&this.backend.getRequest("module/Users/"+this.model.data.id+"/preferences/global",{}).subscribe(function(e){s.isLoading=!1,s.preferences=e,s.setDashboardSetData(e.home_dashboardset),s.setHomeDashboardData(s.preferences.home_dashboard)},function(e){s.toast.sendToast(s.language.getLabel("LBL_ERROR")+" "+e.status,"error",e.error.error.message),403===e.status&&(s.canEdit=!0)})},UserPreferences.prototype.loadDashboardsLists=function(){var s=this;this.backend.getList("Dashboards",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe(function(e){s.dashboards=e.list,s.setHomeDashboardData(s.preferences.home_dashboard)}),this.backend.getList("DashboardSets",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe(function(e){s.dashboardSets=e.list,s.setDashboardSetData(s.preferences.home_dashboardset)})},UserPreferences.prototype.setDashboardSetData=function(s){this.preferences.home_dashboardset=s,this.dashboardSetData=this.dashboardSets.find(function(e){return e.id==s})},UserPreferences.prototype.setHomeDashboardData=function(s){this.preferences.home_dashboard=s,this.homeDashboardData=this.dashboards.find(function(e){return e.id==s})},UserPreferences.prototype.cancel=function(){this.view.setViewMode()},UserPreferences.prototype.save=function(){var s=this;this.isCurrentUser?(this.preferencesService.setPreferences(this.preferences).subscribe(function(){s.toast.sendToast(s.language.getLabel("LBL_DATA_SAVED"),"success"),s.preferences=_.pick(s.preferencesService.unchangedPreferences.global,s.names),s.broadcast.broadcastMessage("userpreferences.save")}),this.view.setViewMode()):this.backend.postRequest("module/Users/"+this.model.data.id+"/preferences/global",{},this.preferences).subscribe(function(e){s.preferences=e,s.view.setViewMode()},function(e){s.toast.sendToast(s.language.getLabel("LBL_ERROR")+" "+e.status,"error",e.error.error.message)})},__decorate([core_1.Component({selector:"user-preferences",template:'<div *ngIf="!canEdit; else preferencesContainer" class="slds-text-align--center slds-m-top--x-large">The preferences of the user are only viewable/editable by himself.</div><ng-template #preferencesContainer><div [system-overlay-loading-spinner]="isLoading"><system-preferences-panel [preferences]="preferences"></system-preferences-panel><system-collapsable-tab [collapsible]="false" tabtitle="LBL_HOME_PREFERENCES"><div class="slds-grid"><system-preferences-panel-item class="slds-size--1-of-3" itemlabel="LBL_HOME_DASHBOARD"><field-container *ngIf="!preferences.home_dashboard" [system-model-provider]="{module: \'Dashboards\', id: preferences.home_dashboard, data: homeDashboardData}" field="name" [fieldconfig]="{link: true, hidelabel: true}"></field-container><system-preferences-panel-item-edit><div class="slds-select_container"><select class="slds-select" [ngModel]="preferences.home_dashboard" (ngModelChange)="setHomeDashboardData($event)"><option>-- Default Dashboard --</option><option *ngFor="let dashboard of dashboards" [value]="dashboard.id">{{dashboard.name}}</option></select></div></system-preferences-panel-item-edit></system-preferences-panel-item><system-preferences-panel-item class="slds-size--1-of-3" itemlabel="LBL_HOME_DASHBOARDSET"><field-container *ngIf="!!preferences.home_dashboardset" [system-model-provider]="{module: \'DashboardSets\', id: preferences.home_dashboardset, data: dashboardSetData}" field="name" [fieldconfig]="{link: true, hidelabel: true}"></field-container><system-preferences-panel-item-edit><div class="slds-select_container"><select class="slds-select" [ngModel]="preferences.home_dashboardset" (ngModelChange)="setDashboardSetData($event)"><option></option><option *ngFor="let option of dashboardSets" [value]="option.id">{{option.name}}</option></select></div></system-preferences-panel-item-edit></system-preferences-panel-item><system-preferences-panel-item class="slds-size--1-of-3" itemlabel="LBL_HOME_ASSISTANT"><system-preferences-panel-item-display>{{preferences.home_assistant}}</system-preferences-panel-item-display><system-preferences-panel-item-edit><div class="slds-select_container"><select class="slds-select" [(ngModel)]="preferences.home_assistant"><option></option><option value="visible"><system-label label="LBL_VISIBLE"></system-label></option><option value="hidden"><system-label label="LBL_HIDDEN"></system-label></option></select></div></system-preferences-panel-item-edit></system-preferences-panel-item></div></system-collapsable-tab><div *ngIf="view.isEditMode()" class="slds-p-around--small slds-align--absolute-center"><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand slds-button-space-left" (click)="save()"><system-label label="LBL_SAVE"></system-label></button></div></div></ng-template>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.backend,services_1.view,services_1.toast,services_1.currency,services_1.language,services_1.userpreferences,services_1.session,services_1.model,services_1.broadcast,services_1.configurationService,services_1.metadata])],UserPreferences)}();exports.UserPreferences=UserPreferences;var UserRoles=function(){function UserRoles(e,s,t,o,a,l){var r=this;this.backend=e,this.toast=s,this.modal=t,this.model=o,this.session=a,this.language=l,this.userRoles=[],this.noneUserRoles=[],this.loading=!0,this.componentId=_.uniqueId(),this.backend.getRequest("configuration/spiceui/core/roles/"+this.model.id).subscribe(function(a){r.userRoles=a.allRoles.filter(function(e){for(var s=0,t=a.userRoles;s<t.length;s++){var o=t[s];if(e.id==o.sysuirole_id)return e.defaultrole=o.defaultrole,!0}return!1}),r.userRoles=r.sortRoles(r.userRoles),r.noneUserRoles=a.allRoles.filter(function(e){for(var s=0,t=r.userRoles;s<t.length;s++){var o=t[s];if(e.id==o.id)return!1}return!0}),r.noneUserRoles=r.sortRoles(r.noneUserRoles),r.noneUserRoles.map(function(e){return e.defaultrole="0"}),r.loading=!1})}return UserRoles.prototype.sortRoles=function(e){var t=this;return e?e.sort(function(e,s){return t.language.getLabel(e.label).localeCompare(t.language.getLabel(s.label))}):[]},UserRoles.prototype.addRole=function(e){var t=this;this.session.authData.admin&&this.modal.openModal("UserRolesAddModal").subscribe(function(e){e.instance.user_id=t.model.data.id,e.instance.noneUserRoles=t.noneUserRoles,e.instance.response.subscribe(function(s){s&&"object"==typeof s&&(t.userRoles.push(s),1===t.userRoles.length&&t.setDefaultRole(s.id),t.userRoles=t.sortRoles(t.userRoles)),s&&"string"==typeof s&&(t.noneUserRoles=t.noneUserRoles.filter(function(e){return e.id!=s}))})})},UserRoles.prototype.deleteRole=function(s,t,e){var o=this;this.session.authData.admin&&!e&&this.modal.confirm(this.language.getLabel("MSG_DELETE_RECORD","","long"),this.language.getLabel("MSG_DELETE_RECORD")).subscribe(function(e){e&&o.backend.deleteRequest("configuration/spiceui/core/roles/"+t+"/"+o.model.data.id).subscribe(function(e){if("error"==e.status)return o.toast.sendToast(e.message,"error"),!1;e=o.userRoles.splice(s,1);o.noneUserRoles.push(e[0]),o.noneUserRoles=o.sortRoles(o.noneUserRoles),o.toast.sendToast(o.language.getLabel("MSG_SUCCESSFULLY_DELETED"),"success")},function(e){return o.toast.sendToast(o.language.getLabel("ERR_CANT_DELETE"),"error")})})},UserRoles.prototype.setDefaultRole=function(s){this.session.authData.admin&&(this.userRoles.every(function(e){return e.id==s?e.defaultrole="1":e.defaultrole="0",!0}),this.backend.postRequest("configuration/spiceui/core/roles/"+s+"/"+this.model.data.id+"/default"))},__decorate([core_1.Component({selector:"user-roles",template:'<div [system-overlay-loading-spinner]="loading" system-to-bottom><table class="slds-table slds-table_bordered slds-table_cell-buffer" style="box-shadow:0px 2px 5px 0 rgba(0,0,0,.1); border-radius: .15rem"><thead class="slds-table--bordered slds-text-align_center"><tr class="slds-text-title--caps"><th></th><th style="padding: .75rem 1rem"><system-label label="LBL_NAME"></system-label></th><th colspan="2"><system-label label="LBL_DEFAULT"></system-label></th></tr></thead><tbody><tr *ngFor="let role of userRoles; let roleIndex = index" class="slds-hint-parent"><ng-container><td style="padding-left: 1rem; padding-right: 0; width: 1.5rem"><span class="slds-avatar slds-avatar--small slds-align--absolute-center {{role.icon}}" style="margin: 0">{{ role.label ? language.getLabel(role.label,\'\', \'short\') : role.name.substring(0, 2) | uppercase }}</span></td><td style="padding: .75rem 1rem"><system-custom-icon *ngIf="role.custom" icon="custom" size="x-small" title="{{language.getLabel(\'LBL_CUSTOM_ROLE\')}}" style="display:inline-block"></system-custom-icon>{{ language.getAppLanglabel(role.label) || role.name }}</td><td class="slds-text-align_center" style="width: 5rem"><span class="slds-radio"><input type="radio" [name]="componentId+\'-radio-default-role\'" id="{{componentId}}-{{role.id}}" [disabled]="!session.authData.admin" [checked]="role.defaultrole == \'1\'" (change)="setDefaultRole(role.id)"> <label class="slds-radio__label" for="{{componentId}}-{{role.id}}"><span class="slds-radio_faux"></span></label></span></td><td *ngIf="session.authData.admin" style="padding-right: 1rem;width: 35px"><button [disabled]="role.defaultrole == \'1\'" class="slds-button slds-button--icon" (click)="deleteRole(roleIndex, role.id, (role.defaultrole == \'1\'))"><system-button-icon [icon]="\'delete\'"></system-button-icon></button></td></ng-container></tr></tbody></table><div *ngIf="noneUserRoles.length > 0 && session.authData.admin" class="slds-p-around--small slds-align--absolute-center"><button class="slds-button slds-button--brand slds-button-space-left" (click)="addRole($event)"><system-label label="LBL_ASSIGN_ROLE"></system-label> &hellip;</button></div></div>'}),__metadata("design:paramtypes",[services_1.backend,services_1.toast,services_1.modal,services_1.model,services_1.session,services_1.language])],UserRoles)}();exports.UserRoles=UserRoles;var UserRolesAddModal=function(){function UserRolesAddModal(e,s,t){this.language=e,this.toast=s,this.backend=t,this.user_id="",this.noneUserRoles=[],this.sysuirole_id="",this.response=null,this.responseSubject=null,this.responseSubject=new rxjs_1.Subject,this.response=this.responseSubject.asObservable()}return Object.defineProperty(UserRolesAddModal.prototype,"nonUserGlobalRoles",{get:function(){var s=[];return this.noneUserRoles.forEach(function(e){e.custom||s.push(e)}),s},enumerable:!1,configurable:!0}),Object.defineProperty(UserRolesAddModal.prototype,"nonUserCustomRoles",{get:function(){var s=[];return this.noneUserRoles.forEach(function(e){e.custom&&s.push(e)}),s},enumerable:!1,configurable:!0}),UserRolesAddModal.prototype.setRole=function(e){this.sysuirole_id=e},UserRolesAddModal.prototype.cancel=function(){this.responseSubject.next(!1),this.responseSubject.complete(),this.self.destroy()},UserRolesAddModal.prototype.onModalEscX=function(){this.cancel()},UserRolesAddModal.prototype.canSubmit=function(){return 0<this.sysuirole_id.length},UserRolesAddModal.prototype.add=function(){var t=this;this.backend.postRequest("configuration/spiceui/core/roles/"+this.sysuirole_id+"/"+this.user_id+"/new").subscribe(function(e){var s;"error"==e.status&&(t.toast.sendToast(e.message,"error"),t.responseSubject.complete(),t.self.destroy()),t.noneUserRoles.every(function(e){return e.id==t.sysuirole_id&&(s=e),!0}),t.responseSubject.next(s),t.responseSubject.next(t.sysuirole_id),t.responseSubject.complete(),t.self.destroy(),t.toast.sendToast(t.language.getLabel("MSG_SUCCESSFULLY_ADDED"),"success")},function(e){t.toast.sendToast("Error, try again later","error"),t.self.destroy()})},__decorate([core_1.Input(),__metadata("design:type",Object)],UserRolesAddModal.prototype,"user_id",void 0),__decorate([core_1.Input(),__metadata("design:type",Array)],UserRolesAddModal.prototype,"noneUserRoles",void 0),__decorate([core_1.Component({selector:"user-roles-add-modal",template:'<system-modal><system-modal-header (close)="cancel()"><system-label label="LBL_ASSIGN_ROLE"></system-label></system-modal-header><system-modal-content><div class="slds-grid--pull-padded"><div class="slds-form-element slds-m-vertical--xxx-small slds-m-horizontal--small"><label class="slds-form-element__label"><system-label label="LBL_ROLES"></system-label></label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" (change)="setRole($event.srcElement.value)"><option><system-label label="LBL_SELECT"></system-label> &hellip;</option><ng-container *ngIf="nonUserGlobalRoles.length"><option *ngFor="let role of nonUserGlobalRoles" [value]="role.id">{{ ( role.label ? language.getLabel(role.label, \'short\') : role.name.substring(0, 2) | uppercase ) +\' \'+ language.getLabel(role.label) }}</option></ng-container><optgroup *ngIf="nonUserCustomRoles.length" label="{{language.getLabel(\'LBL_CUSTOM_ROLES\')}}"><option *ngFor="let role of nonUserCustomRoles" [value]="role.id">{{ ( role.label ? language.getLabel(role.label, \'short\') : role.name.substring(0, 2) | uppercase ) +\' \'+ language.getLabel(role.label) }} (<system-label label="LBL_CUSTOM"></system-label>)</option></optgroup></select></div></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" (click)="add()" [disabled]="!canSubmit()"><system-label label="LBL_ASSIGN"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.toast,services_1.backend])],UserRolesAddModal)}();exports.UserRolesAddModal=UserRolesAddModal;var UserAddButton=function(){function UserAddButton(e,s,t,o,a,l,r){this.modal=e,this.language=s,this.model=t,this.session=o,this.metadata=a,this.injector=l,this.configurationService=r,this.disabled=!0;r=this.configurationService.getSystemParamater("aclcontroller");r&&"spiceacl"!=r?this.session.isAdmin&&(this.disabled=!1):this.metadata.checkModuleAcl("Users","create")&&(this.disabled=!1)}return UserAddButton.prototype.execute=function(){this.modal.openModal("UserAddModal",!0,this.injector)},__decorate([core_1.Component({selector:"user-add-button",template:'<span><system-label label="LBL_NEW"></system-label></span>'}),__metadata("design:paramtypes",[services_1.modal,services_1.language,services_1.model,services_1.session,services_1.metadata,core_1.Injector,services_1.configurationService])],UserAddButton)}();exports.UserAddButton=UserAddButton;var UserAddModal=function(){function UserAddModal(e,s,t,o,a,l,r,i,n,d){this.language=e,this.model=s,this.parent=t,this.modelutilities=o,this.toast=a,this.backend=l,this.view=r,this.cdr=i,this.metadata=n,this.configuration=d,this.informationFieldset=[],this.profileFieldset=[],this.response=null,this.responseSubject=null,this.pwdCheck=new RegExp("//"),this.userNameCheck=new RegExp("^(?![_.])(?!.*[_.]{2})[@a-zA-Z0-9._]{1,60}$"),this.autogenerate=!1,this.sendByEmail=!1,this.showPassword=!1,this.saveTriggered=!1,this.canSendByEmail=!0,this.model.module="Users",this.view.isEditable=!0,this.view.setEditMode(),this.responseSubject=new rxjs_1.Subject,this.response=this.responseSubject.asObservable()}return Object.defineProperty(UserAddModal.prototype,"PwdFieldType",{get:function(){return this.showPassword?"text":"password"},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"modelOptions",{get:function(){return{updateOn:"blur"}},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"passwordMsg",{get:function(){return this.pwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.pwdNotMatchGuide?[{type:"error",message:this.language.getLabel("MSG_PWD_NOT_LEGAL")}]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"rePasswordMsg",{get:function(){return this.rePwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.rePwdNotSame?[{type:"error",message:this.language.getLabel("MSG_PWDS_DONT_MATCH")}]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"pwdFieldEmpty",{get:function(){return this.saveTriggered&&!this.password},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"rePwdFieldEmpty",{get:function(){return this.saveTriggered&&!this.repeatPassword},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"pwdNotMatchGuide",{get:function(){return!this.autoGenerate&&this.password&&!this.pwdCheck.test(this.password)},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"rePwdNotSame",{get:function(){return!this.autoGenerate&&this.repeatPassword&&this.password!=this.repeatPassword},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"pwdFieldStyle",{get:function(){return this.pwdFieldEmpty||this.pwdNotMatchGuide?"slds-has-error":""},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"rePwdFieldStyle",{get:function(){return this.rePwdFieldEmpty||this.rePwdNotSame?"slds-has-error":""},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"hasError",{get:function(){var e=!0;!this.autoGenerate&&this.pwdGuideline&&this.pwdNotMatchGuide&&(e=!1),this.autoGenerate||this.password&&!this.rePwdNotSame||(e=!1),this.model.validate()||(e=!1);var s=this.model.getField("user_name");return s&&!this.userNameCheck.test(s)&&(this.model.setFieldMessage("error",this.language.getLabel("MSG_USERNAME_NOT_LEGAL"),"user_name","validation"),e=!1),!e},enumerable:!1,configurable:!0}),Object.defineProperty(UserAddModal.prototype,"autoGenerate",{get:function(){return this.autogenerate},set:function(e){this.autogenerate=e,this.password=e?Math.random().toString(36).slice(-8):"",this.repeatPassword=this.password},enumerable:!1,configurable:!0}),UserAddModal.prototype.ngOnInit=function(){this.model.initialize(this.parent),this.model.data.UserType="RegularUser",this.model.data.status="Active",this.getFieldSets(),this.getPassInfo()},UserAddModal.prototype.getFieldSets=function(){var e=this.metadata.getComponentConfig("UserAddModal","Users");this.profileFieldset=e&&e.profile?e.profile:this.profileFieldset,this.informationFieldset=e&&e.information?e.information:this.informationFieldset},UserAddModal.prototype.toggleShowPassword=function(){this.showPassword=!this.showPassword},UserAddModal.prototype.getPassInfo=function(){var e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);var s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")},UserAddModal.prototype.copyPassword=function(){var e=document.createElement("textarea");e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.opacity="0",e.value=this.password,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy")&&this.toast.sendToast(this.language.getLabel("MSG_PASSWORD_COPIED"),"success"),document.body.removeChild(e)},UserAddModal.prototype.cancel=function(){this.responseSubject.next(!1),this.responseSubject.complete(),this.self.destroy()},UserAddModal.prototype.save=function(t){var e,o=this;void 0===t&&(t=!1),this.saveTriggered=!0,this.hasError||(this.model.data.system_generated_password=this.autoGenerate,this.model.data.pwd_last_changed=new moment,e=this.modelutilities.spiceModel2backend("Users",this.model.data),this.backend.postRequest("module/Users/"+this.model.id,{},JSON.stringify(e)).subscribe(function(e){for(var s in e)e.hasOwnProperty(s)&&(e[s]=o.modelutilities.backend2spice("Users",s,e[s]));o.model.data=e,o.model.endEdit(),o.savePassword(t)},function(e){e.error.error.message&&(o.addcontainer.element.nativeElement.scrollTop=0,o.model.setFieldMessage("error",e.error.error.message,"email1","validation"))}))},UserAddModal.prototype.savePassword=function(s){var t=this,e={newPassword:this.password,forceReset:this.autoGenerate,sendEmail:!!this.canSendByEmail&&this.sendByEmail};this.backend.postRequest("module/Users/"+this.model.id+"/password/reset",{},e).subscribe(function(e){t.sendByEmail?t.toast.sendToast(t.language.getLabel("MSG_NEW_PASSWORD_EMAIL_SENT"),"success","",10):t.toast.sendToast(t.language.getLabel("LBL_DATA_SAVED"),"success"),s&&t.model.goDetail(),t.self.destroy()},function(e){t.sendByEmail=!1,t.canSendByEmail=!1,t.toast.sendToast(t.language.getLabel("MSG_PASSWORD_RESET_FAILED"),"error")})},__decorate([core_1.ViewChild("addcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],UserAddModal.prototype,"addcontainer",void 0),__decorate([core_1.Component({template:'<system-modal size="large"><system-modal-header (close)="cancel()">{{model.module}}</system-modal-header><system-modal-content #addcontainer><system-section titlelabel="LBL_USER_PROFILE"><object-record-fieldset [fieldset]="profileFieldset" [direction]="\'vertical\'"></object-record-fieldset></system-section><system-section titlelabel="LBL_USER_PASSWORD"><div class="slds-small-size--1-of-1 slds-medium-size--1-of-2"><div class="slds-p-around--x-small"><div class="slds-form--stacked slds-text-align--left"><div *ngIf="pwdGuideline" class="slds-m-vertical--medium"><system-label label="LBL_PWD_GUIDELINE"></system-label>:{{pwdGuideline}}<br></div><div class="slds-grid"><div class="slds-size--10-of-12"><div class="slds-form-element slds-m-vertical--small" [ngClass]="pwdFieldStyle"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input [type]="PwdFieldType" [(ngModel)]="password" class="slds-input" [placeholder]="language.getLabel(\'MSG_ENTER_NEW_PASSWORD\')" [disabled]="autoGenerate" [ngModelOptions]="modelOptions"></div><field-messages [messages]="passwordMsg"></field-messages></div><div class="slds-form-element slds-m-vertical--small" [ngClass]="rePwdFieldStyle"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input [type]="PwdFieldType" [(ngModel)]="repeatPassword" class="slds-input" [placeholder]="language.getLabel(\'LBL_REPEAT_PWD\')" [disabled]="autoGenerate" [ngModelOptions]="modelOptions"></div><field-messages [messages]="rePasswordMsg"></field-messages></div></div><div class="slds-size--2-of-12 slds-p-horizontal--xx-small slds-p-vertical--small"><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="toggleShowPassword()"><system-button-icon [icon]="!showPassword ? \'preview\': \'hide\'" size="medium"></system-button-icon></button> <button *ngIf="autoGenerate" class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="copyPassword()"><system-button-icon icon="copy" size="medium"></system-button-icon></button></div></div></div><system-checkbox [(ngModel)]="autoGenerate"><system-label label="LBL_AUTO_GENERATE"></system-label></system-checkbox><system-checkbox [(ngModel)]="sendByEmail"><system-label label="LBL_SEND_BY_EMAIL"></system-label></system-checkbox></div></div></system-section><system-section titlelabel="LBL_USER_INFORMATION"><object-record-fieldset [fieldset]="informationFieldset" [direction]="\'vertical\'"></object-record-fieldset></system-section></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" (click)="save()"><system-label label="LBL_SAVE"></system-label></button> <button class="slds-button slds-button--brand" (click)="save(true)"><system-label label="LBL_SAVE_AND_GO_TO_RECORD"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.model,services_1.view]}),__param(2,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.model,services_1.modelutilities,services_1.toast,services_1.backend,services_1.view,core_1.ChangeDetectorRef,services_1.metadata,services_1.configurationService])],UserAddModal)}();exports.UserAddModal=UserAddModal;var UserPopoverHeader=function(){function UserPopoverHeader(e,s,t){this.language=e,this.view=s,this.model=t,this.view.displayLabels=!1}return Object.defineProperty(UserPopoverHeader.prototype,"userimage",{get:function(){return this.model.getField("user_image")},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<header class="slds-media slds-media_center slds-m-bottom_small slds-p-vertical--x-small"><div class="slds-p-right--medium"><span *ngIf="!userimage" class="slds-icon_container slds-icon-standard-empty slds-icon_container--circle" style="width:40px;height:40px;"><system-utility-icon icon="user" size="small" addclasses="slds-icon" colorclass></system-utility-icon></span> <img style="height: 40px; width: 40px" *ngIf="userimage" [src]="userimage"></div><div class="slds-media__body"><h2 class="slds-text-heading_small slds-hyphenate"><field-container field="full_name" [fieldconfig]="{fieldtype: \'fullname\'}" fielddisplayclass="slds-truncate"></field-container></h2><ul class="slds-list_horizontal slds-has-dividers_right"><li class="slds-item"><field-container field="title" fielddisplayclass="slds-truncate"></field-container></li><li class="slds-item"><field-container field="department" fielddisplayclass="slds-truncate"></field-container></li></ul></div></header>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.view,services_1.model])],UserPopoverHeader)}();exports.UserPopoverHeader=UserPopoverHeader;var UserDeactivateButton=function(){function UserDeactivateButton(e,s,t,o,a,l,r){this.language=e,this.modal=s,this.model=t,this.session=o,this.injector=a,this.backend=l,this.toast=r}return Object.defineProperty(UserDeactivateButton.prototype,"disabled",{get:function(){return!this.session.isAdmin||"1"==this.model.id},enumerable:!1,configurable:!0}),UserDeactivateButton.prototype.execute=function(){var t=this;"Active"==this.model.getField("status")?this.modal.openModal("UserDeactivateModal",!0,this.injector):this.modal.prompt("confirm",this.language.getLabel("MSG_ACTIVATE_USER","","long"),this.language.getLabel("MSG_ACTIVATE_USER")).subscribe(function(e){var s;e&&(s=t.modal.await(t.language.getLabel("LBL_ACTIVATING")),t.backend.postRequest("module/Users/"+t.model.id+"/activate").subscribe(function(e){t.model.getData(),s.emit(!0)},function(e){s.emit(!0),t.toast.sendToast("an Error occured deactivating the User","error")}))})},Object.defineProperty(UserDeactivateButton.prototype,"actionLabel",{get:function(){return"Active"==this.model.getField("status")?"LBL_DEACTIVATE":"LBL_ACTIVATE"},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<span><system-label [label]="actionLabel"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.modal,services_1.model,services_1.session,core_1.Injector,services_1.backend,services_1.toast])],UserDeactivateButton)}();exports.UserDeactivateButton=UserDeactivateButton;var UserDeactivateModal=function(){function UserDeactivateModal(e,s,t,o,a){this.model=e,this.modal=s,this.language=t,this.backend=o,this.toast=a,this.objects=[],this.loading=!0,this.reassignRecords=!1,this.totalrecords=0,this.newuserid="",this.getUserObjects()}return UserDeactivateModal.prototype.getUserObjects=function(){var t=this;this.backend.getRequest("module/Users/"+this.model.id+"/deactivate").subscribe(function(e){for(var s in e)t.objects.push({sysmoduleid:s,count:parseInt(e[s].totalcount,10),reassign:0<parseInt(e[s].totalcount,10)}),t.totalrecords+=parseInt(e[s].totalcount,10);0<t.totalrecords&&(t.reassignRecords=!0),t.loading=!1},function(e){t.loading=!1})},Object.defineProperty(UserDeactivateModal.prototype,"canReassign",{get:function(){return 0<this.totalrecords},enumerable:!1,configurable:!0}),Object.defineProperty(UserDeactivateModal.prototype,"canSubmit",{get:function(){return!(this.reassignRecords&&!this.newuserid)},enumerable:!1,configurable:!0}),UserDeactivateModal.prototype.deactivate=function(){var s=this,e=[],t={};if(this.newuserid){t.modules=[];for(var o=0,a=this.objects.filter(function(e){return e.reassign});o<a.length;o++){var l=a[o];e.push(l.sysmoduleid)}t.newuserid=this.newuserid}var r=this.modal.await(this.language.getLabel("LBL_DEACTIVATING"));this.backend.postRequest("module/Users/"+this.model.id+"/deactivate",{},t).subscribe(function(e){s.model.getData(),r.emit(!0),s.close()},function(e){r.emit(!0),s.toast.sendToast("an Error occured deactivating the User","error")})},UserDeactivateModal.prototype.close=function(){this.self.destroy()},__decorate([core_1.Component({template:'<system-modal><system-modal-header (close)="close()"><system-label label="MSG_USER_DEACTIVATE"></system-label></system-modal-header><system-modal-content margin="none"><div class="slds-p-around--small"><system-label label="MSG_USER_DEACTIVATE" length="long"></system-label><div class="slds-p-top--small slds-grid slds-grid--vertical-align-center"><system-checkbox [disabled]="!canReassign" class="slds-p-right--small" [(ngModel)]="reassignRecords"><system-label label="MSG_REASSIGN_RECORDS"></system-label> ({{totalrecords}})</system-checkbox><user-deactivate-select-user style="min-width: 300px;" [ngClass]="{\'slds-hidden\': !reassignRecords}" (userid$)="newuserid = $event"></user-deactivate-select-user></div></div><table class="slds-table slds-table_cell-buffer slds-table_bordered"><thead><tr class="slds-line-height_reset"><th class="slds-text-align_right" scope="col" style="width:3.25rem"></th><th scope="col"><div class="slds-truncate" system-title="LBL_MODULE"><system-label label="LBL_MODULE"></system-label></div></th><th scope="col"><div class="slds-truncate" system-title="LBL_COUNT"><system-label label="LBL_COUNT"></system-label></div></th></tr></thead><tbody><tr class="slds-hint-parent" *ngFor="let object of objects"><td><system-checkbox [disabled]="!reassignRecords || object.count == 0" [(ngModel)]="object.reassign"></system-checkbox></td><td><div class="slds-truncate"><system-label-modulename [module]="object.sysmoduleid"></system-label-modulename></div></td><td><div class="slds-truncate">{{object.count}}</div></td></tr></tbody><tbody system-table-stencils columns="2" [select]="true" [tools]="false" rows="5" *ngIf="loading"></tbody></table></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button [disabled]="!canSubmit" class="slds-button slds-button--brand" (click)="deactivate()"><system-label label="LBL_DEACTIVATE"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.model,services_1.modal,services_1.language,services_1.backend,services_1.toast])],UserDeactivateModal)}();exports.UserDeactivateModal=UserDeactivateModal;var UserDeactivateSelectUser=function(){function e(e,s,t,o){this.language=e,this.metadata=s,this.model=t,this.modal=o,this.subscriptions=new rxjs_1.Subscription,this.userid$=new core_1.EventEmitter}return e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this.language.getModuleCombinedLabel("LBL_SEARCH","Users")},enumerable:!1,configurable:!0}),e.prototype.searchWithModal=function(){var s=this;this.modal.openModal("ObjectModalModuleLookup").subscribe(function(e){e.instance.module="Users",e.instance.multiselect=!1,s.subscriptions.add(e.instance.selectedItems.subscribe(function(e){e.length&&(s.selectedItem=e[0],s.userid$.emit(s.selectedItem.id))}))})},e.prototype.clearField=function(){this.selectedItem=void 0},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"userid$",void 0),__decorate([core_1.Component({selector:"user-deactivate-select-user",template:'<div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" aria-expanded="false" aria-haspopup="listbox" role="combobox"><div class="slds-form-element__control slds-box--border"><div *ngIf="selectedItem" class="slds-form-element__control"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon module="Users" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{selectedItem.full_name}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clearField()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!selectedItem" class="slds-input-has-icon slds-input-has-icon--right slds-grow"><input type="text" class="slds-lookup__search-input slds-input--bare" (click)="searchWithModal()" [placeholder]="placeholder" role="combobox"> <button (click)="searchWithModal()" class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"><system-button-icon [icon]="\'search\'"></system-button-icon></button></div></div></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modal])],e)}();exports.UserDeactivateSelectUser=UserDeactivateSelectUser;var ModuleUsers=function(){function ModuleUsers(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[UserChangePasswordButton,UserChangePasswordModal,UserResetPasswordModal,UserResetPasswordButton,UserPreferences,UserRoles,UserRolesAddModal,UserAddButton,UserAddModal,UserPopoverHeader,UserDeactivateButton,UserDeactivateModal,UserDeactivateSelectUser]})],ModuleUsers)}();exports.ModuleUsers=ModuleUsers;