/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-16 09:05:07
 * build: 2021.02.001.1626419107136
 **/
"use strict";var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__decorate=this&&this.__decorate||function(e,t,s,o){var n,i=arguments.length,l=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,s,o);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(l=(i<3?n(l):3<i?n(t,s,l):n(t,s))||l);return 3<i&&l&&Object.defineProperty(t,s,l),l},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleDocuments=exports.DocumentCreateRevisionModal=exports.DocumentCreateRevisionButton=exports.fieldDocumentRevisionStatus=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),directives_1=require("../../directives/directives"),forms_1=require("@angular/forms"),router_1=require("@angular/router"),services_1=require("../../services/services"),moduleoutputtemplates_1=require("../../modules/outputtemplates/moduleoutputtemplates"),rxjs_1=require("rxjs"),platform_browser_1=require("@angular/platform-browser"),fieldDocumentRevisionStatus=function(c){function fieldDocumentRevisionStatus(e,t,s,o,n,i,l,a,r){s=c.call(this,e,s,o,n,i)||this;return s.model=e,s.navigation=t,s.language=o,s.metadata=n,s.router=i,s.modal=l,s.relatedmodels=a,s.backend=r,s}return __extends(fieldDocumentRevisionStatus,c),fieldDocumentRevisionStatus.prototype.ngOnInit=function(){var t=this;c.prototype.ngOnInit.call(this),this.parent=this.navigation.getRegisteredModel(this.model.data.document_id,"Documents"),this.subscriptions.add(this.parent.observeFieldChanges("status_id").subscribe(function(e){"Expired"==e&&(t.value="a")}))},fieldDocumentRevisionStatus.prototype.getValue=function(){return this.language.getFieldDisplayOptionValue(this.model.module,this.fieldname,this.value)},Object.defineProperty(fieldDocumentRevisionStatus.prototype,"canActivate",{get:function(){return!this.model.isEditing&&"c"==this.value&&this.model.checkAccess("edit")&&"Expired"!=this.parent.getField("status_id")},enumerable:!1,configurable:!0}),fieldDocumentRevisionStatus.prototype.activateRevision=function(){var t=this;this.modal.prompt("confirm",this.language.getLabel("MSG_ACTIVATE_REVISION","","long")).subscribe(function(e){e&&(t.model.startEdit(),t.value="r",t.model.save().subscribe(function(e){t.parent&&t.parent.setField("revision",t.model.data.revision)}))})},__decorate([core_1.Component({template:'<field-label *ngIf="displayLabel" [fieldname]="fieldname" [fieldconfig]="fieldconfig"></field-label><field-generic-display [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><div class="slds-grid slds-grid--vertical-align-center"><span>{{getValue()}}</span> <button *ngIf="canActivate" class="slds-button slds-button--icon slds-theme--warning slds-m-left--x-small" (click)="activateRevision()"><system-button-icon icon="light_bulb"></system-button-icon></button></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.navigation,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.modal,services_1.relatedmodels,services_1.backend])],fieldDocumentRevisionStatus)}(objectfields_1.fieldGeneric);exports.fieldDocumentRevisionStatus=fieldDocumentRevisionStatus;var DocumentCreateRevisionButton=function(r){function DocumentCreateRevisionButton(e,t,s,o,n,i,l){var a=r.call(this,e,t,s,o,n,i)||this;return a.language=e,a.model=t,a.modal=s,a.backend=o,a.configuration=n,a.viewContainerRef=i,a.relatedmodels=l,a.subscriptions=new rxjs_1.Subscription,a}return __extends(DocumentCreateRevisionButton,r),DocumentCreateRevisionButton.prototype.openOutput=function(){var s=this;0<this.templates.length?(this.templates.sort(function(e,t){return e.name>t.name?1:-1}),this.modal.openModal("DocumentCreateRevisionModal",!0,this.viewContainerRef.injector).subscribe(function(e){var t=new core_1.EventEmitter;e.instance.templates=s.templates,e.instance.modalTitle="LBL_CREATE_REVISION",e.instance.handBack=t,s.subscriptions.add(t.subscribe(function(e){s.backend.postRequest("module/Documents/"+s.model.id+"/revisionfrombase64","",{file_name:e.name+".pdf",file:e.content,file_mime_type:"application/pdf",documentrevisionstatus:"r"}).subscribe(function(e){s.relatedmodels.getData()})}))})):this.modal.info("No Templates Found","there are no Output templates defined for the Module")},DocumentCreateRevisionButton.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},__decorate([core_1.Component({selector:"document-create-revision-button",template:'<system-label label="LBL_CREATE_REVISION"></system-label>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.backend,services_1.configurationService,core_1.ViewContainerRef,services_1.relatedmodels])],DocumentCreateRevisionButton)}(moduleoutputtemplates_1.ObjectActionOutputBeanButton);exports.DocumentCreateRevisionButton=DocumentCreateRevisionButton;var DocumentCreateRevisionModal=function(c){function DocumentCreateRevisionModal(e,t,s,o,n,i,l,a){var r=c.call(this,e,t,s,o,n,i,l,a)||this;return r.language=e,r.model=t,r.metadata=s,r.modal=o,r.view=n,r.backend=i,r.sanitizer=l,r.viewContainerRef=a,r}return __extends(DocumentCreateRevisionModal,c),DocumentCreateRevisionModal.prototype.create=function(){this.handBack.emit({name:this.selected_template.name,content:this.contentForHandBack}),this.close()},__decorate([core_1.Component({selector:"object-action-output-bean-modal",template:'<system-modal size="large"><system-modal-header (close)="close()">{{modalTitle}}</system-modal-header><system-modal-content margin="none"><div class="slds-modal__content"><div class="slds-form-element__control slds-grid slds-grid--vertical-align-center slds-p-around--small"><label class="slds-col slds-p-right--x-small"><system-label label="LBL_TEMPLATE"></system-label></label><select class="slds-col slds-select slds-grow" [(ngModel)]="selected_template" [disabled]="templates.length == 0"><option *ngFor="let templ of templates" [ngValue]="templ">{{templ.name}} ({{templ.language}})</option></select></div><div class="slds-grid" style="height: 70vh;"><div class="slds-p-around--small" style="height: 100%; width: 200%" [@slideInOut]="expanded? \'open\': \'closed\'"><div class="slds-m-top--small slds-border--top slds-border--right slds-border--left slds-border--bottom" style="width: 100%; height: calc(100% - 50px);"><iframe *ngIf="selected_format === \'html\' && !loading_output && selected_template" frameBorder="0" style="width: 100%;height: 100%;" [srcdoc]="sanitizedTemplated"></iframe><object *ngIf="selected_format === \'pdf\' && !loading_output && blobUrl" [data]="blobUrl" type="application/pdf" width="100%" height="100%"></object><div *ngIf="loading_output" class="slds-align--absolute-center" style="height: 100%;"><system-spinner></system-spinner></div><div *ngIf="!selected_template && !loading_output" class="slds-align--absolute-center" style="height: 100%;"><system-label label="LBL_SELECT_TEMPLATE"></system-label></div></div></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button [disabled]="!selected_template || loading_output" class="slds-button slds-button--brand" (click)="create()"><system-label label="LBL_CREATE"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.metadata,services_1.modal,services_1.view,services_1.backend,platform_browser_1.DomSanitizer,core_1.ViewContainerRef])],DocumentCreateRevisionModal)}(moduleoutputtemplates_1.ObjectActionOutputBeanModal);exports.DocumentCreateRevisionModal=DocumentCreateRevisionModal;var ModuleDocuments=function(){function ModuleDocuments(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[fieldDocumentRevisionStatus,DocumentCreateRevisionButton,DocumentCreateRevisionModal]})],ModuleDocuments)}();exports.ModuleDocuments=ModuleDocuments;