/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-15 08:42:29
 *
 *                     build: 2023.02.001.1692081749029
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_mediafiles_modulemediafiles_ts"],{1546:(e,i,t)=>{t.r(i),t.d(i,{ModuleMediaFiles:()=>Ge});var s=t(1180),l=t(4755),n=t(5030),a=t(3190),d=t(4826),o=t(6490),r=t(3735),c=t(4357),m=t(7579),h=t(2242),g=t(6550),u=t(3144),f=t(4505),p=t(6625),b=t(5920),v=t(4154),Z=t(3917),x=t(3278),y=t(5329),M=t(4044);let F=(()=>{var e;class mediafiles{constructor(e,i,t,l,n,a,d,o,r,c){(0,s.Z)(this,"sanitizer",void 0),(0,s.Z)(this,"http",void 0),(0,s.Z)(this,"backend",void 0),(0,s.Z)(this,"configurationService",void 0),(0,s.Z)(this,"session",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"footer",void 0),(0,s.Z)(this,"toast",void 0),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"modalservice",void 0),(0,s.Z)(this,"categoriesLoaded",!1),(0,s.Z)(this,"categories",{}),(0,s.Z)(this,"categoriesSorted",[]),this.sanitizer=e,this.http=i,this.backend=t,this.configurationService=l,this.session=n,this.metadata=a,this.footer=d,this.toast=o,this.language=r,this.modalservice=c}_getImage(e,i=""){let t=new m.x;return this.backend.getRawRequest("module/MediaFiles/"+e+"/file"+(""!=i?"/":"")+i,{},null,{}).subscribe((e=>{let i=URL.createObjectURL(e);t.next(this.sanitizer.bypassSecurityTrustUrl(i)),t.complete()})),t.asObservable()}_getImageBase64(e){let i=new m.x;return this.backend.getRequest("module/MediaFiles/"+e+"/base64").subscribe((e=>{i.next(e),i.complete()})),i.asObservable()}getImageVariant(e,i){return this._getImage(e,i)}getImage(e){return this._getImage(e,"")}getImageBase64(e){return this._getImageBase64(e)}getImageThumb(e,i){return this._getImage(e,"th/"+i)}getImageSquare(e,i){return this._getImage(e,"sq/"+i)}getMediaFile(e=!1,i=!1,t){let s=new m.x;return e?this.uploadMediaFile([],i,t).subscribe((e=>{e&&(s.next(e),s.complete())})):this.pickMediaFile().subscribe((e=>{e.id?(s.next(e.id),s.complete()):!0===e.upload&&this.uploadMediaFile([],i,t).subscribe((e=>{e&&(s.next(e),s.complete())}))})),s.asObservable()}pickMediaFile(){let e=new m.x;return this.modalservice.openModal("MediaFilePicker").subscribe((i=>{i.instance.answer.subscribe((i=>{e.next(i),e.complete()}))})),e.asObservable()}uploadMediaFile(e,i=!1,t){let s=new m.x;return this.modalservice.openModal("MediaFileUploader").subscribe((l=>{l.instance.acceptFileTypes=e,l.instance.noMetaData=i,l.instance.category=t,l.instance.answer.subscribe((e=>{s.next(e),s.complete()}))})),s.asObservable()}}return e=mediafiles,(0,s.Z)(mediafiles,"ɵfac",(function(i){return new(i||e)(h.LFG(g.H7),h.LFG(u.eN),h.LFG(f.y),h.LFG(p.C),h.LFG(b.n),h.LFG(v.Pu),h.LFG(Z.M),h.LFG(x.A),h.LFG(y.d),h.LFG(M.o))})),(0,s.Z)(mediafiles,"ɵprov",h.Yz7({token:e,factory:e.ɵfac})),mediafiles})();function I(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"img",2),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.openImagePreview())})),h.qZA()}if(2&e){const e=h.oxw();h.Tol(e.classImage),h.Q6J("src",e.imageUrl,h.LSH)("title",e.title)("alt",e.alttext)("ngStyle",e.styleImg)}}let w=(()=>{var e;class MediaFileImage{constructor(e,i,t){(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"elRef",void 0),(0,s.Z)(this,"modal",void 0),(0,s.Z)(this,"media_id",void 0),(0,s.Z)(this,"variant",void 0),(0,s.Z)(this,"size",null),(0,s.Z)(this,"width",null),(0,s.Z)(this,"height",null),(0,s.Z)(this,"classImage",""),(0,s.Z)(this,"classOuter",""),(0,s.Z)(this,"align",""),(0,s.Z)(this,"frameWidth",null),(0,s.Z)(this,"frameHeight",null),(0,s.Z)(this,"frameSize",null),(0,s.Z)(this,"displayInline",!1),(0,s.Z)(this,"title",""),(0,s.Z)(this,"alttext",""),(0,s.Z)(this,"imageUrl",void 0),(0,s.Z)(this,"dimensions",{width:void 0,height:void 0}),(0,s.Z)(this,"isFirstChange",!0),(0,s.Z)(this,"variantStatic",void 0),(0,s.Z)(this,"lastMediaId",""),(0,s.Z)(this,"withFrameHeight",!0),this.mediafiles=e,this.elRef=i,this.modal=t}ngOnChanges(){this.isFirstChange&&(this.isFirstChange=!1,this.variantStatic=this.variant),"mw"===this.variantStatic||"mwh"===this.variantStatic?(null!=this.width&&(this.dimensions.width=this.width),null!=this.height&&(this.dimensions.height=this.height),null===this.frameWidth&&(this.frameWidth=this.determineMaxWidthOfImage()),"mwh"===this.variantStatic&&null===this.frameHeight&&(this.frameHeight=this.determineMaxHeightOfImage()),"mw"===this.variantStatic&&(this.withFrameHeight=!1)):(null!=this.size&&(this.dimensions.height=this.dimensions.width=this.size),null===this.frameSize&&(this.frameSize=this.determineMaxWidthOfImage())),this.media_id&&(this.lastMediaId!==this.media_id?this.showImage():this.imageUrl="")}showImage(){let e;switch(this.variantStatic){case"mw":e=this.frameWidth;break;case"mwh":e=this.frameWidth+"/"+this.frameHeight;break;case"th":e=this.frameSize}this.mediafiles.getImageVariant(this.media_id,this.variantStatic+"/"+e).subscribe((e=>{this.imageUrl=e}))}get styleDisplay(){return this.displayInline?"inline-block":"block"}get styleOuter(){switch(this.align){case"left":return{"margin-left":0,"margin-right":"auto"};case"right":return{"margin-left":"auto","margin-right":0};case"center":return{"margin-left":"auto","margin-right":"auto"};default:return{}}}get styleImg(){let e={...this.dimensions};return this.withFrameHeight&&(e.position="absolute",e.top=e.left=e.bottom=e.right=0,e.margin="auto"),e}getWidthOfParent(){return Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).width.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).paddingLeft.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).paddingRight.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).borderLeftWidth.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).borderRightWidth.replace(/px$/,""))}determineMaxWidthOfImage(){return Math.round(this.getWidthOfParent())}getHeightOfParent(){return Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).height.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).paddingTop.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).paddingBottom.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).borderTopWidth.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement,null).borderBottomWidth.replace(/px$/,""))}determineMaxHeightOfImage(){return Math.round(this.getHeightOfParent())}openImagePreview(){this.modal.openModal("SystemImagePreviewModal").subscribe((e=>{this.mediafiles.getImageBase64(this.media_id).subscribe((i=>{e.instance.imgtype=i.filetype,e.instance.imgsrc="data:"+i.filetype+";base64,"+i.img}))}))}}return e=MediaFileImage,(0,s.Z)(MediaFileImage,"ɵfac",(function(i){return new(i||e)(h.Y36(F),h.Y36(h.SBq),h.Y36(M.o))})),(0,s.Z)(MediaFileImage,"ɵcmp",h.Xpm({type:e,selectors:[["media-file-image"]],inputs:{media_id:"media_id",variant:"variant",size:"size",width:"width",height:"height",classImage:"classImage",classOuter:"classOuter",align:"align",frameWidth:"frameWidth",frameHeight:"frameHeight",frameSize:"frameSize",displayInline:"displayInline",title:"title",alttext:"alttext"},features:[h._Bn([F]),h.TTD],decls:2,vars:9,consts:[[1,"slds-is-relative",3,"ngClass","ngStyle"],["style","max-width:100%;max-height:100%",3,"src","title","alt","ngStyle","class","click",4,"ngIf"],[2,"max-width","100%","max-height","100%",3,"src","title","alt","ngStyle","click"]],template:function(e,i){1&e&&(h.TgZ(0,"span",0),h.YNc(1,I,1,7,"img",1),h.qZA()),2&e&&(h.Udp("maxwidth",i.frameWidth)("height",i.frameHeight)("display",i.styleDisplay),h.Q6J("ngClass",i.classOuter)("ngStyle",i.styleOuter),h.xp6(1),h.Q6J("ngIf",i.imageUrl))},dependencies:[l.mk,l.O5,l.PC],styles:["img[_ngcontent-%COMP%]:hover{cursor:pointer}"]})),MediaFileImage})();var _=t(5710),E=t(2644),J=t(2294),S=t(9533),k=t(6163),C=t(6559),O=t(9866),Y=t(9624),N=t(4730),Q=t(3463),U=t(9621),L=t(3499),T=t(5767),z=t(1916),A=t(586),R=t(5931),q=t(2656),H=t(7693);function P(e,i){1&e&&h._UZ(0,"img",14)}function D(e,i){if(1&e&&h._UZ(0,"img",15),2&e){const e=h.oxw();h.Q6J("src",e.thumbnail,h.LSH)}}function G(e,i){1&e&&h._UZ(0,"object-action-menu",16)}let B=(()=>{var e;class MediaFilesTile{constructor(e,i,t,l,n,a){(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"view",void 0),(0,s.Z)(this,"sanitizer",void 0),(0,s.Z)(this,"modal",void 0),(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"data",void 0),(0,s.Z)(this,"selectbox",!1),(0,s.Z)(this,"fieldset",void 0),(0,s.Z)(this,"actionset",void 0),this.metadata=e,this.model=i,this.view=t,this.sanitizer=l,this.modal=n,this.mediafiles=a,this.getConfig()}ngOnInit(){this.initializeView(),this.initializeModel()}initializeView(){this.view.isEditable=!1,this.view.displayLabels=!1,1==this.selectbox&&(this.view.displayLinks=!1)}getConfig(){let e=this.metadata.getComponentConfig("MediaFilesTile","MediaFiles");this.fieldset=e.fieldset,this.actionset=e.actionset}initializeModel(){this.model.module="MediaFiles",this.model.id=this.data.id,this.model.setData(this.data)}get thumbnail(){let e=this.model.getField("thumbnail");return!!e&&this.sanitizer.bypassSecurityTrustResourceUrl("data:"+this.model.getField("filetype")+";base64,"+e)}expand(){this.modal.openModal("SystemImagePreviewModal").subscribe((e=>{e.instance.imgname=this.model.getFieldValue("name"),e.instance.imgtype=this.model.getFieldValue("filetype"),this.mediafiles.getImageBase64(this.model.id).subscribe((i=>{e.instance.imgsrc="data:"+this.model.getFieldValue("filetype")+";base64,"+i.img}))}))}}return e=MediaFilesTile,(0,s.Z)(MediaFilesTile,"ɵfac",(function(i){return new(i||e)(h.Y36(v.Pu),h.Y36(_.o),h.Y36(J.e),h.Y36(g.H7),h.Y36(M.o),h.Y36(F))})),(0,s.Z)(MediaFilesTile,"ɵcmp",h.Xpm({type:e,selectors:[["media-files-tile"]],inputs:{data:"data",selectbox:"selectbox"},features:[h._Bn([F,_.o,J.e])],decls:15,vars:6,consts:[[1,"slds-p-around--small",2,"width","20rem"],[1,"slds-file","slds-file_card","slds-has-title"],[1,"slds-align--absolute-center",2,"height","165px","width","294px"],["src","./vendor/sldassets/images/placeholder-img@16x9.jpg",4,"ngIf"],["style","max-height: 100%;max-width: 100%;","alt","Description of the image",3,"src",4,"ngIf"],[1,"slds-file__title","slds-is-relative","slds-file__title_card"],[1,"slds-grid","slds-grid--vertical-align-center","slds-size--1-of-1"],[1,"slds-p-right--xx-small"],["size","x-small","divClass","",3,"filename","filemimetype"],[1,"slds-media__body","slds-grow","slds-truncate"],[3,"fieldset"],[1,"slds-button","slds-button_icon","slds-button_icon-border-filled","slds-button_icon-small","slds-m-horizontal--xx-small",3,"click"],["icon","expand","size","small"],["buttonsize","small",4,"ngIf"],["src","./vendor/sldassets/images/placeholder-img@16x9.jpg"],["alt","Description of the image",2,"max-height","100%","max-width","100%",3,"src"],["buttonsize","small"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"figure")(3,"div",2),h.YNc(4,P,1,0,"img",3),h.YNc(5,D,1,1,"img",4),h.qZA(),h.TgZ(6,"figcaption",5)(7,"div",6)(8,"div",7),h._UZ(9,"system-file-icon",8),h.qZA(),h.TgZ(10,"div",9),h._UZ(11,"object-record-fieldset-horizontal-list",10),h.qZA(),h.TgZ(12,"button",11),h.NdJ("click",(function(){return i.expand()})),h._UZ(13,"system-button-icon",12),h.qZA(),h.YNc(14,G,1,0,"object-action-menu",13),h.qZA()()()()()),2&e&&(h.xp6(4),h.Q6J("ngIf",!i.thumbnail),h.xp6(1),h.Q6J("ngIf",i.thumbnail),h.xp6(4),h.Q6J("filename",i.model.getField("name"))("filemimetype",i.model.getField("filetype")),h.xp6(2),h.Q6J("fieldset",i.fieldset),h.xp6(3),h.Q6J("ngIf",!i.selectbox))},dependencies:[l.O5,A.g,R.Z,q.J,H.T],encapsulation:2,changeDetection:0})),MediaFilesTile})();function j(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"media-files-tile",12),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw();return h.KtG(t.pick(i.id))})),h.qZA()}if(2&e){const e=i.$implicit;h.Q6J("data",e)("selectbox",!0)}}function V(e,i){1&e&&(h.TgZ(0,"div",13)(1,"system-illustration-no-records"),h._UZ(2,"system-label",14),h.qZA()())}let W=(()=>{var e;class MediaFilePicker extends S.X{constructor(e,i,t,l,n,a,d){super(e,i,t,l,n,a),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"modellist",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"modelutilities",void 0),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"layout",void 0),(0,s.Z)(this,"elementRef",void 0),(0,s.Z)(this,"module","MediaFiles"),(0,s.Z)(this,"answer",new h.vpe),this.language=e,this.modellist=i,this.metadata=t,this.modelutilities=l,this.model=n,this.layout=a,this.elementRef=d}get containerStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect(),i=Math.floor((e.width-10)/320),t=Math.floor((e.width-10-320*i)/2);return{"padding-left":t+"px","padding-right":t+"px"}}pick(e){this.answer.emit({id:e}),this.self.destroy()}upload(){this.metadata.checkModuleAcl("MediaFiles","create")&&(this.model.module="MediaFiles",this.model.id=void 0,this.model.initialize(),this.model.addModel().subscribe((e=>{this.answer.emit({id:this.model.id}),this.self.destroy()})))}}return e=MediaFilePicker,(0,s.Z)(MediaFilePicker,"ɵfac",(function(i){return new(i||e)(h.Y36(y.d),h.Y36(E.t),h.Y36(v.Pu),h.Y36(k.A),h.Y36(_.o),h.Y36(C.b),h.Y36(h.SBq))})),(0,s.Z)(MediaFilePicker,"ɵcmp",h.Xpm({type:e,selectors:[["media-file-picker"]],outputs:{answer:"answer"},features:[h._Bn([J.e,E.t,_.o]),h.qOj],decls:17,vars:7,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],[1,"slds-height_full"],[1,"slds-is-relative",3,"ngStyle"],[1,"slds-grid","slds-wrap",3,"ngStyle"],[3,"data","selectbox","click",4,"ngFor","ngForOf"],["class","slds-align--absolute-center","style","height: calc(100% - 35px)",4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_UPLOAD_NEW_FILE"],[3,"data","selectbox","click"],[1,"slds-align--absolute-center",2,"height","calc(100% - 35px)"],["label","MSG_NO_RECORDS_FOUND"]],template:function(e,i){1&e&&(h.TgZ(0,"system-modal",0)(1,"system-modal-header",1),h.NdJ("close",(function(){return i.closePopup()})),h._uU(2),h.qZA(),h.TgZ(3,"system-modal-content",2)(4,"div",3),h._UZ(5,"object-modal-module-lookup-header"),h.TgZ(6,"div",4)(7,"div",5),h.YNc(8,j,1,2,"media-files-tile",6),h.qZA(),h.YNc(9,V,3,0,"div",7),h._UZ(10,"object-modal-module-lookup-aggregates"),h.qZA()()(),h.TgZ(11,"system-modal-footer")(12,"button",8),h.NdJ("click",(function(){return i.closePopup()})),h._UZ(13,"system-label",9),h.qZA(),h.TgZ(14,"button",10),h.NdJ("click",(function(){return i.upload()})),h._UZ(15,"system-label",11),h._uU(16," …"),h.qZA()()()),2&e&&(h.xp6(2),h.Oqu(i.language.getModuleCombinedLabel("LBL_SEARCH",i.modellist.module)),h.xp6(1),h.Q6J("grow",!0),h.xp6(3),h.Q6J("ngStyle",i.contentStyle()),h.xp6(1),h.Q6J("ngStyle",i.containerStyle),h.xp6(1),h.Q6J("ngForOf",i.modellist.listData.list),h.xp6(1),h.Q6J("ngIf",!i.modellist.isLoading&&0==i.modellist.listData.totalcount),h.xp6(5),h.Q6J("disabled",!i.metadata.checkModuleAcl("MediaFiles","create")))},dependencies:[l.sg,l.O5,l.PC,O.x,Y.D,N.C,Q._,U.j,L.x,T.p,z.y,B],encapsulation:2})),MediaFilePicker})();var $=t(2547),K=t(9062),X=t(8026);function ee(e,i){if(1&e&&(h.TgZ(0,"div",8),h._UZ(1,"object-record-fieldset",9),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("fieldset",e.fieldsetId)}}function ie(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div")(1,"button",10),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.save())})),h._UZ(2,"system-label",11),h.qZA(),h.TgZ(3,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.cancel())})),h._UZ(4,"system-label",13),h.qZA()()}if(2&e){const e=h.oxw();h.xp6(1),h.Q6J("disabled",!e.canSave)}}function te(e,i){if(1&e&&(h.TgZ(0,"div")(1,"system-progress-bar",14),h._UZ(2,"system-label",15),h.qZA()()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("progress",e.theProgress)}}const se=function(e,i){return{"slds-size--1-of-1":e,"slds-size--1-of-2":i}};let le=(()=>{var e;class MediaFileUploader{constructor(e,i,t,l,n,a,d){(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"backend",void 0),(0,s.Z)(this,"lang",void 0),(0,s.Z)(this,"toast",void 0),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"view",void 0),(0,s.Z)(this,"theProgress",0),(0,s.Z)(this,"noMetaData",!1),(0,s.Z)(this,"answer",null),(0,s.Z)(this,"answerSubject",null),(0,s.Z)(this,"self",void 0),(0,s.Z)(this,"isSaving",!1),(0,s.Z)(this,"isEditing",!0),(0,s.Z)(this,"inputMedia",void 0),(0,s.Z)(this,"mediaMetaData",void 0),(0,s.Z)(this,"fieldsetId",void 0),this.mediafiles=e,this.metadata=i,this.backend=t,this.lang=l,this.toast=n,this.model=a,this.view=d,this.answerSubject=new m.x,this.answer=this.answerSubject.asObservable(),this.model.module="MediaFiles",this.model.id=this.model.generateGuid(),this.model.initialize(),this.model.setField("id",this.model.id),this.view.isEditable=!0,this.view.setEditMode();let o=this.metadata.getComponentConfig("MediaFileUploader","MediaFiles");this.fieldsetId=o.fieldset}cancel(){this.model.cancelEdit(),this.answerSubject.next(!1),this.answerSubject.complete(),this.self.destroy()}get canSave(){return this.mediaMetaData&&!this.isSaving}get image(){let e=this.model.getField("file");return e?this.model.getField("filetype")+"|"+e:void 0}set image(e){let i=e.indexOf("|");this.model.setField("file",e.substring(i+1)),this.mediaMetaData=this.inputMedia.mediaMetaData,this.model.getField("name")||this.model.setField("name",this.mediaMetaData.filename.replace(/\.[^\.]+$/,"").replace(/_/," ")),this.model.setField("filetype",e.substring(0,i))}save(){this.canSave&&(this.isSaving=!0,this.model.savingProgress.subscribe((e=>this.theProgress=e)),this.model.validate()?(this.view.setViewMode(),this.isEditing=!1,this.model.save().subscribe((()=>{this.answerSubject.next(this.model.id),this.answerSubject.complete(),window.setTimeout((()=>this.self.destroy()),2e3)}))):this.isSaving=!1)}onModalEscX(){return this.isSaving||this.cancel(),!1}}return e=MediaFileUploader,(0,s.Z)(MediaFileUploader,"ɵfac",(function(i){return new(i||e)(h.Y36(F),h.Y36(v.Pu),h.Y36(f.y),h.Y36(y.d),h.Y36(x.A),h.Y36(_.o),h.Y36(J.e))})),(0,s.Z)(MediaFileUploader,"ɵcmp",h.Xpm({type:e,selectors:[["media-file-uploader"]],viewQuery:function(e,i){if(1&e&&h.Gf($.l,5),2&e){let e;h.iGM(e=h.CRH())&&(i.inputMedia=e.first)}},features:[h._Bn([F,_.o,J.e])],decls:11,vars:8,consts:[["size","large"],[3,"close"],["label","LBL_NEW_IMAGE"],[1,"slds-grid"],[1,"slds-box","slds-box_x-small","slds-size--1-of-2",3,"ngClass"],[1,"slds-height_full",3,"ngModel","ngModelChange"],["class","slds-p-left--medium slds-size--1-of-2",4,"ngIf"],[4,"ngIf"],[1,"slds-p-left--medium","slds-size--1-of-2"],["direction","vertical",3,"fieldset"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[3,"progress"],["label","LBL_UPLOADING_MEDIA_FILE"]],template:function(e,i){1&e&&(h.TgZ(0,"system-modal",0)(1,"system-modal-header",1),h.NdJ("close",(function(){return i.cancel()})),h._UZ(2,"system-label",2),h.qZA(),h.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4)(6,"system-input-media",5),h.NdJ("ngModelChange",(function(e){return i.image=e})),h.qZA()(),h.YNc(7,ee,2,1,"div",6),h.qZA()(),h.TgZ(8,"system-modal-footer"),h.YNc(9,ie,5,1,"div",7),h.YNc(10,te,3,1,"div",7),h.qZA()()),2&e&&(h.xp6(5),h.Q6J("ngClass",h.WLB(5,se,i.noMetaData,!i.noMetaData)),h.xp6(1),h.Q6J("ngModel",i.image),h.xp6(1),h.Q6J("ngIf",!i.noMetaData),h.xp6(2),h.Q6J("ngIf",!i.isSaving),h.xp6(1),h.Q6J("ngIf",i.isSaving))},dependencies:[l.mk,l.O5,n.JJ,n.On,K.d,Q._,U.j,L.x,T.p,z.y,X.J,$.l],encapsulation:2})),MediaFileUploader})();var ne=t(7228),ae=t(3348),de=t(1058);function oe(e,i){if(1&e&&h._UZ(0,"media-files-tile",4),2&e){const e=i.$implicit;h.Q6J("data",e)}}function re(e,i){1&e&&(h.TgZ(0,"div",5)(1,"system-illustration-no-records"),h._UZ(2,"system-label",6),h.qZA()())}let ce=(()=>{var e;class MediaFilesList extends ne.s{constructor(e,i,t,l,n,a,d,o,r,c){super(e,i,t,l,n,a,d,o),(0,s.Z)(this,"router",void 0),(0,s.Z)(this,"cdRef",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"modellist",void 0),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"injector",void 0),(0,s.Z)(this,"modal",void 0),(0,s.Z)(this,"layout",void 0),(0,s.Z)(this,"renderer",void 0),(0,s.Z)(this,"elementRef",void 0),(0,s.Z)(this,"resizeHandler",void 0),this.router=e,this.cdRef=i,this.metadata=t,this.modellist=l,this.language=n,this.injector=a,this.modal=d,this.layout=o,this.renderer=r,this.elementRef=c,this.resizeHandler=this.renderer.listen("window","resize",(()=>this.onResize()))}ngOnDestroy(){super.ngOnDestroy(),this.resizeHandler()}onResize(){this.cdRef.detectChanges()}get containerStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect(),i=Math.floor((e.width-10)/320),t=Math.floor((e.width-10-320*i)/2);return{"padding-left":t+"px","padding-right":t+"px"}}}return e=MediaFilesList,(0,s.Z)(MediaFilesList,"ɵfac",(function(i){return new(i||e)(h.Y36(ae.F0),h.Y36(h.sBO),h.Y36(v.Pu),h.Y36(E.t),h.Y36(y.d),h.Y36(h.zs3),h.Y36(M.o),h.Y36(C.b),h.Y36(h.Qsj),h.Y36(h.SBq))})),(0,s.Z)(MediaFilesList,"ɵcmp",h.Xpm({type:e,selectors:[["media-files-list"]],features:[h.qOj],decls:4,vars:3,consts:[[2,"min-height","250px",3,"system-to-bottom"],[1,"slds-grid","slds-wrap",3,"ngStyle"],[3,"data",4,"ngFor","ngForOf"],["class","slds-align--absolute-center","style","height: calc(100% - 35px)",4,"ngIf"],[3,"data"],[1,"slds-align--absolute-center",2,"height","calc(100% - 35px)"],["label","MSG_NO_RECORDS_FOUND"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h.NdJ("system-to-bottom",(function(){return i.onScroll()})),h.TgZ(1,"div",1),h.YNc(2,oe,1,1,"media-files-tile",2),h.qZA(),h.YNc(3,re,3,0,"div",3),h.qZA()),2&e&&(h.xp6(1),h.Q6J("ngStyle",i.containerStyle),h.xp6(1),h.Q6J("ngForOf",i.modellist.listData.list),h.xp6(1),h.Q6J("ngIf",!i.modellist.isLoading&&0==i.modellist.listData.totalcount))},dependencies:[l.sg,l.O5,l.PC,N.C,Q._,de.H,B],encapsulation:2,changeDetection:0})),MediaFilesList})();var me=t(7040),he=t(6367),ge=t(3208);function ue(e,i){if(1&e&&h._UZ(0,"field-label",3),2&e){const e=h.oxw();h.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function fe(e,i){if(1&e&&h._UZ(0,"img",6),2&e){const e=h.oxw(2);h.Q6J("src","data:image/jpg;base64,"+e.value,h.LSH)}}function pe(e,i){if(1&e&&(h.TgZ(0,"field-generic-display",4),h.YNc(1,fe,1,1,"img",5),h.qZA()),2&e){const e=h.oxw();h.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig)("title",e.value)("fieldid",e.fieldid),h.xp6(1),h.Q6J("ngIf",e.value)}}function be(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",7)(1,"system-input-media",8),h.NdJ("ngModelChange",(function(i){h.CHM(e);const t=h.oxw();return h.KtG(t.value=i)})),h.qZA()()}if(2&e){const e=h.oxw();h.Q6J("ngClass",e.css_classes),h.xp6(1),h.Q6J("ngModel",e.value)("mimetype","image/jpeg")}}let ve=(()=>{var e;class fieldMediaFilesImage extends me.O{constructor(e,i,t,l,n,a,d){super(e,t,l,n,a),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"modal",void 0),(0,s.Z)(this,"view",void 0),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"router",void 0),(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"systemInputMedia",void 0),(0,s.Z)(this,"_value",void 0),this.model=e,this.modal=i,this.view=t,this.language=l,this.metadata=n,this.router=a,this.mediafiles=d,this.initialize()}get value(){return this._value}set value(e){let i={};i.file=e,i.filetype=this.systemInputMedia.mediaMetaData.mimetype,this.model.getField("name")?this._value||this.modal.prompt("confirm",this.language.getLabel("MSG_OVERWRITE_FILENAME","","long"),this.language.getLabel("MSG_OVERWRITE_FILENAME")).subscribe((e=>{e&&(i.name=this.systemInputMedia.mediaMetaData.filename),this.model.setFields(i)})):(i.name=this.systemInputMedia.mediaMetaData.filename,this.model.setFields(i)),this._value=e}initialize(){this.model.isNew||(this.loadImage(),this.subscriptions.add(this.model.canceledit$.subscribe((e=>{this._value=null,this.loadImage()}))))}loadImage(){this.mediafiles.getImageBase64(this.model.id).subscribe((e=>{this._value=e.img}))}}return e=fieldMediaFilesImage,(0,s.Z)(fieldMediaFilesImage,"ɵfac",(function(i){return new(i||e)(h.Y36(_.o),h.Y36(M.o),h.Y36(J.e),h.Y36(y.d),h.Y36(v.Pu),h.Y36(ae.F0),h.Y36(F))})),(0,s.Z)(fieldMediaFilesImage,"ɵcmp",h.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(e,i){if(1&e&&h.Gf($.l,5),2&e){let e;h.iGM(e=h.CRH())&&(i.systemInputMedia=e.first)}},features:[h._Bn([F]),h.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","title","fieldid",4,"ngIf"],["class","slds-form-element__control slds-m-vertical--xx-small",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","title","fieldid"],[3,"src",4,"ngIf"],[3,"src"],[1,"slds-form-element__control","slds-m-vertical--xx-small",3,"ngClass"],[1,"slds-height_full",3,"ngModel","mimetype","ngModelChange"]],template:function(e,i){1&e&&(h.YNc(0,ue,1,2,"field-label",0),h.YNc(1,pe,2,6,"field-generic-display",1),h.YNc(2,be,2,3,"div",2)),2&e&&(h.Q6J("ngIf",i.displayLabel),h.xp6(1),h.Q6J("ngIf",!i.isEditMode()),h.xp6(1),h.Q6J("ngIf",i.isEditable()&&i.isEditMode()))},dependencies:[l.mk,l.O5,n.JJ,n.On,he.q,ge.D,$.l],encapsulation:2})),fieldMediaFilesImage})();var Ze=t(4664);const xe=["imgFrame"];function ye(e,i){1&e&&h._UZ(0,"system-spinner",5)}function Me(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"system-input-media",6),h.NdJ("ngModelChange",(function(i){h.CHM(e);const t=h.oxw(2);return h.KtG(t.imageUrlOriginal=i)})),h.qZA()}if(2&e){const e=h.oxw(2);h.Q6J("ngModel",e.imageUrlOriginal)}}function Fe(e,i){if(1&e&&(h.ynx(0),h.YNc(1,ye,1,0,"system-spinner",3),h.YNc(2,Me,1,1,"system-input-media",4),h.BQk()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("ngIf",e.isLoadingOriginal),h.xp6(1),h.Q6J("ngIf",!e.isLoadingOriginal)}}function Ie(e,i){if(1&e&&h._UZ(0,"img",14),2&e){const e=h.oxw(3);h.Q6J("src",e.imageUrlVariant,h.LSH)}}function we(e,i){if(1&e){const e=h.EpF();h.ynx(0),h.YNc(1,Ie,1,1,"img",10),h.TgZ(2,"button",11),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.openLightbox())})),h._UZ(3,"system-button-icon",12),h.qZA(),h.TgZ(4,"button",13),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.setEditMode())})),h._UZ(5,"system-button-icon",12),h.qZA(),h.BQk()}if(2&e){const e=h.oxw(2);h.xp6(1),h.Q6J("ngIf",e.imageUrlVariant),h.xp6(2),h.Q6J("icon","expand"),h.xp6(2),h.Q6J("icon","edit")}}function _e(e,i){1&e&&h._UZ(0,"system-spinner",5)}function Ee(e,i){if(1&e&&(h.TgZ(0,"div",7,8)(2,"div",9),h.YNc(3,we,6,3,"ng-container",1),h.YNc(4,_e,1,0,"system-spinner",3),h.qZA()()),2&e){const e=h.oxw();h.xp6(3),h.Q6J("ngIf",!e.isLoadingVariant),h.xp6(1),h.Q6J("ngIf",e.isLoadingVariant)}}let Je=(()=>{var e;class fieldMediaFile extends me.O{constructor(e,i,t,l,n,a,d,o,r,c,m){super(e,i,t,l,n),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"view",void 0),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"router",void 0),(0,s.Z)(this,"elementRef",void 0),(0,s.Z)(this,"renderer",void 0),(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"backend",void 0),(0,s.Z)(this,"elRef",void 0),(0,s.Z)(this,"modalservice",void 0),(0,s.Z)(this,"currentViewMode",void 0),(0,s.Z)(this,"imageUrlVariant",void 0),(0,s.Z)(this,"imageUrlOriginal",void 0),(0,s.Z)(this,"isLoadingVariant",!1),(0,s.Z)(this,"isLoadingOriginal",!1),(0,s.Z)(this,"widthOfImgFrame",void 0),(0,s.Z)(this,"heightOfImgFrame",void 0),(0,s.Z)(this,"allowR",void 0),(0,s.Z)(this,"imgFrame",void 0),this.model=e,this.view=i,this.language=t,this.metadata=l,this.router=n,this.elementRef=a,this.renderer=d,this.mediafiles=o,this.backend=r,this.elRef=c,this.modalservice=m}ngAfterViewInit(){this.widthOfImgFrame=this.getWidthOfImgFrame(),this.heightOfImgFrame=this.getHeightOfImgFrame(),this.view.mode$.subscribe((e=>{this.currentViewMode!==e&&("view"===e&&this.loadImageVariant(),"edit"===e&&this.loadImageOriginal(),this.currentViewMode=e)}))}loadImageVariant(){this.imageUrlVariant="",this.model.isNew||(this.isLoadingVariant=!0,this.mediafiles.getImageVariant(this.model.id,"mwh/"+this.widthOfImgFrame+"/"+this.heightOfImgFrame).subscribe((e=>{this.imageUrlVariant=e,this.isLoadingVariant=!1})))}loadImageOriginal(){this.imageUrlOriginal="",this.model.isNew||(this.isLoadingOriginal=!0,this.mediafiles.getImage(this.model.id).subscribe((e=>{this.imageUrlOriginal=e,this.isLoadingOriginal=!1}),(e=>{this.isLoadingOriginal=!1})))}getWidthOfImgFrame(){return this.imgFrame?Math.ceil(Number(getComputedStyle(this.imgFrame.nativeElement,null).width.replace(/px$/,""))):0}getHeightOfImgFrame(){return this.imgFrame?Math.ceil(Number(getComputedStyle(this.imgFrame.nativeElement,null).height.replace(/px$/,""))):0}openLightbox(){this.modalservice.openModal("SystemImagePreviewModal",!0).subscribe((e=>{e.instance.imgname=this.model.getField("name"),e.instance.imgtype=this.model.getField("filetype"),this.mediafiles.getImage(this.model.id).subscribe((i=>{e.instance.imgsrc=i}))}))}mediaChange(e){e.isDirty&&(this.model.setField(this.fieldname,e.image),this.fileformat=e.metaData.fileformat,e.isImported&&this.fieldconfig.copyFilenameToFieldName&&e.metaData.filename&&!this.model.getField(this.fieldForName)&&this.model.setField(this.fieldForName,e.metaData.filename.replace(/\.[^\.]+$/,"").replace(/_/," ")))}get fieldForFileformat(){return this.fieldconfig.fieldForFileformat?this.fieldconfig.fieldForFileformat:"filetype"}get fieldForName(){return this.fieldconfig.fieldForName?this.fieldconfig.fieldForName:"name"}set fileformat(e){this.model.setField(this.fieldForFileformat,e)}get fileformat(){return this.model.getField(this.fieldForFileformat)}}return e=fieldMediaFile,(0,s.Z)(fieldMediaFile,"ɵfac",(function(i){return new(i||e)(h.Y36(_.o),h.Y36(J.e),h.Y36(y.d),h.Y36(v.Pu),h.Y36(ae.F0),h.Y36(h.SBq),h.Y36(h.Qsj),h.Y36(F),h.Y36(f.y),h.Y36(h.SBq),h.Y36(M.o))})),(0,s.Z)(fieldMediaFile,"ɵcmp",h.Xpm({type:e,selectors:[["field-media-file"]],viewQuery:function(e,i){if(1&e&&h.Gf(xe,5),2&e){let e;h.iGM(e=h.CRH())&&(i.imgFrame=e.first)}},features:[h._Bn([F]),h.qOj],decls:3,vars:3,consts:[[2,"margin-right","-0.75rem","text-align","center","height","400px",3,"ngClass"],[4,"ngIf"],["class","slds-grid slds-grid--vertical","style","height:100%",4,"ngIf"],["size","large","class","spice-vertically-centered",4,"ngIf"],["style","height:100%",3,"ngModel","ngModelChange",4,"ngIf"],["size","large",1,"spice-vertically-centered"],[2,"height","100%",3,"ngModel","ngModelChange"],[1,"slds-grid","slds-grid--vertical",2,"height","100%"],["imgFrame",""],[1,"spice-vertically-centered",2,"max-height","100%","margin-right","auto","margin-left","auto"],["style","max-width:100%;max-height:100%",3,"src",4,"ngIf"],[1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled","toLightbox",2,"position","absolute","top","0.25rem","right","0.25rem","margin","0",3,"click"],[3,"icon"],[1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled","toLightbox",2,"position","absolute","bottom","0.25rem","right","0.25rem","margin","0",3,"click"],[2,"max-width","100%","max-height","100%",3,"src"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h.YNc(1,Fe,3,2,"ng-container",1),h.YNc(2,Ee,5,2,"div",2),h.qZA()),2&e&&(h.Q6J("ngClass",i.fielddisplayclass+" format-"+i.fieldconfig.format),h.xp6(1),h.Q6J("ngIf",i.isEditMode()),h.xp6(1),h.Q6J("ngIf",!i.isEditMode()))},dependencies:[l.mk,l.O5,n.JJ,n.On,q.J,Ze.W,$.l],encapsulation:2})),fieldMediaFile})();const Se=["buttonToEnlargement"],ke=["buttonToPicker"];function Ce(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",5,6),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.getImage())})),h._UZ(2,"system-button-icon",7),h.qZA()}if(2&e){const e=h.oxw(2);h.Q6J("disabled",!e.isEditMode()),h.xp6(2),h.Q6J("icon","image")}}function Oe(e,i){if(1&e&&h._UZ(0,"img",13),2&e){const e=h.oxw(3);h.Q6J("src",e.imageUrl,h.LSH)}}function Ye(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",8,9),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.openEnlarged())})),h.YNc(2,Oe,1,1,"img",10),h.TgZ(3,"span",11),h._UZ(4,"system-button-icon",12),h.qZA()()}if(2&e){const e=h.oxw(2);h.xp6(2),h.Q6J("ngIf",e.imageUrl),h.xp6(2),h.Q6J("icon","threedots")}}function Ne(e,i){if(1&e&&h._UZ(0,"img",20),2&e){const e=h.oxw(3);h.Q6J("src",e.imageUrlEnlarged,h.LSH)}}function Qe(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",21),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(3);return h.KtG(i.clearField4button())})),h._UZ(1,"system-button-icon",7),h.qZA()}2&e&&(h.xp6(1),h.Q6J("icon","delete"))}function Ue(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",14),h.YNc(1,Ne,1,1,"img",15),h.TgZ(2,"button",16,17),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.closeEnlarged())})),h._UZ(4,"system-button-icon",18),h.qZA(),h.YNc(5,Qe,2,1,"button",19),h._uU(6),h.qZA()}if(2&e){const e=h.MAs(3),i=h.oxw(2);h.xp6(1),h.Q6J("ngIf",i.imageUrlEnlarged),h.xp6(3),h.Q6J("icon","close")("size","small"),h.xp6(1),h.Q6J("ngIf",i.isEditMode()),h.xp6(1),h.hij(" ",e.focus()," ")}}function Le(e,i){if(1&e&&(h.ynx(0),h.YNc(1,Ce,3,2,"button",2),h.YNc(2,Ye,5,2,"button",3),h.YNc(3,Ue,7,5,"div",4),h.BQk()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("ngIf",e.fieldIsEmpty),h.xp6(1),h.Q6J("ngIf",!e.fieldIsEmpty),h.xp6(1),h.Q6J("ngIf",e.enlarged)}}function Te(e,i){if(1&e&&h._UZ(0,"img",24),2&e){const e=h.oxw(2);h.Q6J("src",e.imageUrl,h.LSH)}}function ze(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",27,6),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(4);return h.KtG(i.getImage())})),h._UZ(2,"system-button-icon",7),h.qZA()}if(2&e){const e=h.oxw(4);h.Q6J("disabled",!e.isEditMode()),h.xp6(2),h.Q6J("icon","image")}}function Ae(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",28)(1,"button",29),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(4);return h.KtG(i.clearField4image())})),h._UZ(2,"system-button-icon",7),h.qZA()()}2&e&&(h.xp6(2),h.Q6J("icon","delete"))}function Re(e,i){if(1&e&&(h.ynx(0),h.YNc(1,ze,3,2,"button",25),h.YNc(2,Ae,3,1,"div",26),h.BQk()),2&e){const e=h.oxw(3);h.xp6(1),h.Q6J("ngIf",e.fieldIsEmpty),h.xp6(1),h.Q6J("ngIf",!e.fieldIsEmpty)}}function qe(e,i){if(1&e){const e=h.EpF();h.ynx(0),h.TgZ(1,"button",30),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(3);return h.KtG(i.setEditMode())})),h._UZ(2,"system-button-icon",7),h.qZA(),h.BQk()}2&e&&(h.xp6(2),h.Q6J("icon","edit"))}function He(e,i){if(1&e&&(h.ynx(0),h.YNc(1,Re,3,2,"ng-container",1),h.YNc(2,qe,3,1,"ng-container",1),h.BQk()),2&e){const e=h.oxw(2);h.xp6(1),h.Q6J("ngIf",e.isEditMode()),h.xp6(1),h.Q6J("ngIf",!e.isEditMode())}}function Pe(e,i){if(1&e&&(h.ynx(0),h.TgZ(1,"div",22),h.YNc(2,Te,1,1,"img",23),h.YNc(3,He,3,2,"ng-container",1),h.qZA(),h.BQk()),2&e){const e=h.oxw();h.xp6(1),h.Q6J("ngStyle",e.imageStyle),h.xp6(1),h.Q6J("ngIf",!e.fieldIsEmpty&&e.imageUrl),h.xp6(1),h.Q6J("ngIf",!e.model.isLoading)}}let De=(()=>{var e;class fieldMediaFileImage extends me.O{constructor(e,i,t,l,n,a,d,o,r,c){super(e,i,t,l,n),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"view",void 0),(0,s.Z)(this,"language",void 0),(0,s.Z)(this,"metadata",void 0),(0,s.Z)(this,"router",void 0),(0,s.Z)(this,"elementRef",void 0),(0,s.Z)(this,"renderer",void 0),(0,s.Z)(this,"mediafiles",void 0),(0,s.Z)(this,"backend",void 0),(0,s.Z)(this,"elRef",void 0),(0,s.Z)(this,"thumbSize",void 0),(0,s.Z)(this,"unsubscribeClickListener",void 0),(0,s.Z)(this,"imageUrl",void 0),(0,s.Z)(this,"imageUrlEnlarged",void 0),(0,s.Z)(this,"enlarged",!1),(0,s.Z)(this,"fieldIsEmpty",!0),(0,s.Z)(this,"lastValue",""),(0,s.Z)(this,"height",""),(0,s.Z)(this,"buttonToEnlargement",void 0),(0,s.Z)(this,"buttonToPicker",void 0),(0,s.Z)(this,"size1rem",void 0),(0,s.Z)(this,"widthOfParent",void 0),this.model=e,this.view=i,this.language=t,this.metadata=l,this.router=n,this.elementRef=a,this.renderer=d,this.mediafiles=o,this.backend=r,this.elRef=c}ngOnInit(){"image"!==this.fieldconfig.format&&(this.fieldconfig.format="button")}ngAfterViewInit(){this.size1rem=this.getSize1rem(),this.thumbSize=2*this.size1rem-2,this.widthOfParent=this.getWidthOfParent(),this.fieldconfig.height&&(this.height="calc("+this.fieldconfig.height+" - 2px - 0.5rem )"),this.model.data$.subscribe((()=>{this.afterLoadingModel()}))}afterLoadingModel(){this.lastValue=this.model.getField(this.fieldname),this.loadImages(),this.model.data$.subscribe((()=>{this.model.getField(this.fieldname)!==this.lastValue&&(this.lastValue=this.model.getField(this.fieldname),this.loadImages())}))}onClick(e){this.elementRef.nativeElement.contains(e.target)||(this.enlarged=!1)}openEnlarged(){this.unsubscribeClickListener=this.renderer.listen("document","click",(e=>this.onClick(e))),this.enlarged=!0}closeEnlarged(){this.enlarged=!1,this.buttonToEnlargement&&this.buttonToEnlargement.nativeElement.focus(),this.unsubscribeClickListener()}loadImages(){this.model.getField(this.fieldname)?(this.fieldIsEmpty=!1,"button"===this.fieldconfig.format?(this.mediafiles.getImageVariant(this.model.getField(this.fieldname),"th/"+this.thumbSize).subscribe((e=>{this.imageUrl=e})),this.mediafiles.getImageVariant(this.model.getField(this.fieldname),"th/200").subscribe((e=>{this.imageUrlEnlarged=e}))):this.mediafiles.getImageVariant(this.model.getField(this.fieldname),"mw/"+this.determineWidthOfImage()).subscribe((e=>{this.imageUrl=e}))):this.fieldIsEmpty=!0}clearField4button(){this.imageUrl=this.imageUrlEnlarged=this.value="",this.enlarged=!1,this.buttonToPicker&&this.buttonToPicker.nativeElement.focus(),this.fieldIsEmpty=!0}clearField4image(){this.imageUrl="",this.model.setField(this.fieldname,""),this.fieldIsEmpty=!0}getImage(){this.mediafiles.getMediaFile(this.fieldconfig.noImagePicker||!1,this.fieldconfig.noMetaData||!1,this.fieldconfig.category).subscribe((e=>{e&&(this.value=e,this.loadImages())}))}editImage(){}getSize1rem(){return Math.ceil(Number(getComputedStyle(document.documentElement,null).fontSize.replace(/px$/,"")))}getWidthOfParent(){return Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).width.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).paddingLeft.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).paddingRight.replace(/px$/,""))}determineWidthOfImage(){return Math.round(this.widthOfParent)}get imageStyle(){return{height:this.height}}setEditMode(){this.isEditable()&&(this.model.startEdit(),this.view.setEditMode(this.fieldid))}isEditable(){return this.getStati(this.fieldname).editable&&!this.getStati(this.fieldname).readonly&&!this.getStati(this.fieldname).disabled&&!this.getStati(this.fieldname).hidden}ngOnDestroy(){this.unsubscribeClickListener&&this.unsubscribeClickListener(),super.ngOnDestroy()}}return e=fieldMediaFileImage,(0,s.Z)(fieldMediaFileImage,"ɵfac",(function(i){return new(i||e)(h.Y36(_.o),h.Y36(J.e),h.Y36(y.d),h.Y36(v.Pu),h.Y36(ae.F0),h.Y36(h.SBq),h.Y36(h.Qsj),h.Y36(F),h.Y36(f.y),h.Y36(h.SBq))})),(0,s.Z)(fieldMediaFileImage,"ɵcmp",h.Xpm({type:e,selectors:[["field-media-file-image"]],viewQuery:function(e,i){if(1&e&&(h.Gf(Se,7),h.Gf(ke,7)),2&e){let e;h.iGM(e=h.CRH())&&(i.buttonToEnlargement=e.first),h.iGM(e=h.CRH())&&(i.buttonToPicker=e.first)}},features:[h._Bn([F]),h.qOj],decls:3,vars:3,consts:[[1,"slds-is-relative",3,"ngClass"],[4,"ngIf"],["class","slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled",3,"disabled","click",4,"ngIf"],["class","slds-button slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-container","style","width:4rem",3,"click",4,"ngIf"],["class","slds-is-absolute","style","width:160px; height:160px; left: calc(50% - 80px); top: calc(50% - 80px); z-index: 1; background-color: #ccc; border-radius:0.25rem; background-color: #fdfdfd; box-shadow: 0 2px 3px 0 rgba(0,0,0,.16); border: 1px solid #d8dde6",4,"ngIf"],[1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled",3,"disabled","click"],["buttonToPicker",""],[3,"icon"],[1,"slds-button","slds-button","slds-button_icon","slds-button_icon-border-filled","slds-button_icon-container",2,"width","4rem",3,"click"],["buttonToEnlargement",""],["class","imgInButton","style","border-radius: 0.25rem 0 0 0.25rem; padding: 1px 0 1px 1px; height: calc(2rem - 2px); width: calc(2rem - 1px)",3,"src",4,"ngIf"],[1,"slds-text-align_center"],[2,"width","calc(2rem - 2px)",3,"icon"],[1,"imgInButton",2,"border-radius","0.25rem 0 0 0.25rem","padding","1px 0 1px 1px","height","calc(2rem - 2px)","width","calc(2rem - 1px)",3,"src"],[1,"slds-is-absolute",2,"width","160px","height","160px","left","calc(50% - 80px)","top","calc(50% - 80px)","z-index","1","background-color","#ccc","border-radius","0.25rem","background-color","#fdfdfd","box-shadow","0 2px 3px 0 rgba(0,0,0,.16)","border","1px solid #d8dde6"],["class","slds-image","style","border: 1px solid #999","width","160","height","160",3,"src",4,"ngIf"],["title","Close",1,"slds-button","slds-button_icon","slds-is-absolute",2,"top","0.25rem","right","0.25rem","cursor","pointer","margin","0","filter","drop-shadow( 0px 0px 3px #fff)",3,"click"],["closebutton",""],[3,"icon","size"],["class","slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled slds-is-absolute","title","Delete","style","bottom: 0.25rem; left: 0.25rem; margin: 0;",3,"click",4,"ngIf"],["width","160","height","160",1,"slds-image",2,"border","1px solid #999",3,"src"],["title","Delete",1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled","slds-is-absolute",2,"bottom","0.25rem","left","0.25rem","margin","0",3,"click"],[1,"slds-box--border","slds-align_absolute-center",3,"ngStyle"],["style","max-height:100%;padding:0.25rem",3,"src",4,"ngIf"],[2,"max-height","100%","padding","0.25rem",3,"src"],["class","slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled slds-align--absolute-center",3,"disabled","click",4,"ngIf"],["class","slds-is-absolute spice-button-group-vertical slds-is-absolute","style","bottom:1.25rem; right:0.75rem",4,"ngIf"],[1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled","slds-align--absolute-center",3,"disabled","click"],[1,"slds-is-absolute","spice-button-group-vertical","slds-is-absolute",2,"bottom","1.25rem","right","0.75rem"],["title","Delete",1,"slds-button","slds-button_icon","slds-button_icon-container","slds-button_icon-border-filled",3,"click"],[1,"slds-button","slds-button_icon","slds-is-absolute",2,"bottom","1.25rem","right","0.75rem",3,"click"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h.YNc(1,Le,4,3,"ng-container",1),h.YNc(2,Pe,4,3,"ng-container",1),h.qZA()),2&e&&(h.Q6J("ngClass",i.fielddisplayclass),h.xp6(1),h.Q6J("ngIf","button"===i.fieldconfig.format),h.xp6(1),h.Q6J("ngIf","button"!==i.fieldconfig.format))},dependencies:[l.mk,l.O5,l.PC,q.J],encapsulation:2})),fieldMediaFileImage})(),Ge=(()=>{var e;class ModuleMediaFiles{}return e=ModuleMediaFiles,(0,s.Z)(ModuleMediaFiles,"ɵfac",(function(i){return new(i||e)})),(0,s.Z)(ModuleMediaFiles,"ɵmod",h.oAB({type:e})),(0,s.Z)(ModuleMediaFiles,"ɵinj",h.cJS({imports:[l.ez,n.u5,a.ObjectFields,d.GlobalComponents,o.ObjectComponents,r.SystemComponents,c.o]})),ModuleMediaFiles})();("undefined"==typeof ngJitMode||ngJitMode)&&h.kYT(Ge,{declarations:[w,W,le,ce,B,ve,Je,De],imports:[l.ez,n.u5,a.ObjectFields,d.GlobalComponents,o.ObjectComponents,r.SystemComponents,c.o],exports:[w,W,le]})}}]);