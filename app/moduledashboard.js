/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_dashboard_moduledashboard_ts"],{76992:(t,s,e)=>{e.r(s),e.d(s,{ModuleDashboard:()=>ks});var i=e(60177),o=e(84341),a=e(71341),n=e(7745),d=e(70569),l=e(35911),r=e(75103),h=e(54438),c=e(49722),u=e(50531);let m=(()=>{class dashboardlayout{constructor(t,s,e){this.backend=t,this.model=s,this.modal=e,this.dashboardData={},this.dashboardGrid=[],this.dashboardId="",this.dashboardElements=[],this.boxMargin=5,this.columns=9,this.editmode=!1,this.editing="",this.isMoving=!1,this.isloading=!1,this.dashboardNotFound=!1}get bodyContainerRef(){return this.bodycontainerref.element.nativeElement}set bodyContainerRef(t){this.bodycontainerref=t}get editMode(){return this.editmode}set editMode(t){this.editmode=t,this.editmode&&setTimeout((()=>this.calculateGrid()),100)}get elementHeight(){return this.bodyContainerRef?this.bodyContainerRef.clientHeight/this.columns:100}get elementWidth(){return this.bodyContainerRef?this.bodyContainerRef.clientWidth/this.columns:100}get compactView(){return this.bodyContainerRef.clientWidth<768}calculateGrid(){if(!this.bodyContainerRef)return;this.dashboardGrid=[];let t=0,s=this.columns;for(let t of this.dashboardElements){let e=t.position.top+t.position.height;this.bodyContainerRef.clientHeight&&e>this.columns&&(s=e>s?e:s)}for(;t<s;){let s=0,e=[];for(;s<this.columns;)e.push({width:this.bodyContainerRef.clientWidth/this.columns-2*this.boxMargin,height:this.elementHeight-2*this.boxMargin,top:t*this.elementHeight+this.boxMargin,left:s*this.bodyContainerRef.clientWidth/this.columns+this.boxMargin}),s++;this.dashboardGrid.push(e),t++}this.dashboardGrid=this.dashboardGrid.slice()}getElementStyle(t,s,e,i){let o={};return o.top=t*this.elementHeight+this.boxMargin,o.left=s*this.elementWidth+this.boxMargin,o.width=this.compactView?"100%":e*this.elementWidth-2*this.boxMargin,o.height=i*this.elementHeight-2*this.boxMargin,o}dropElement(t,s,e,i,o){this.dashboardElements.some((a=>{if(a.id===t){let n=Math.round(s/this.elementWidth),d=Math.round(e/this.elementHeight);const l=this.canDrop(t,a,s,e,o,i);switch(i){case"content":l.left&&(a.position.left+=n),l.top&&(a.position.top+=d);break;case"left":l.left&&(a.position.width-=n,a.position.left+=n);break;case"right":l.left&&(a.position.width+=n);break;case"top":l.top&&(a.position.height-=d,a.position.top+=d);break;case"bottom":l.top&&(a.position.height+=d)}return window.dispatchEvent(new Event("resize")),!0}})),setTimeout((()=>this.calculateGrid()),100)}canDrop(t,s,e,i,o,a){let n=!0,d=!0,l=Math.round(e/this.elementWidth),r=Math.round(i/this.elementHeight),h=s.position.left,c=s.position.left+(s.position.width-1),u=s.position.top,m=s.position.top+(s.position.height-1),g=h,b=s.position.width,p=c,f=u,y=s.position.height,v=m;switch(a){case"content":v=m+r,p=c+l,g=h+l,f=u+r;break;case"left":b+=l,g=h+l;break;case"right":b+=l,p=c+l;break;case"top":y+=r,f=u+r;break;case"bottom":y+=r,v=m+r}for(let s of this.dashboardElements){let e=s.position.left,i=s.position.left+(s.position.width-1),o=s.position.top,l=s.position.top+(s.position.height-1),r=g>=e&&g<=i,h=p<=i&&p>=e,c=f>=o&&f<=l,u=v<=l&&v>=o,m=(h||r)&&(c||u)&&s.id!=t,b=(c||u)&&(r||h)&&s.id!=t,y=g<0||p>this.columns-1,k=f<0,D=f<o&&v>l&&g<=i&&p>=e&&s.id!=t,w=p>i&&g<e&&f<=l&&v>=o&&s.id!=t;switch(a){case"content":(m||b||w||D||y||k)&&(n=!1,d=!1);break;case"left":(m||w||y||g>p)&&(n=!1);break;case"right":(m||w||y||p<g)&&(n=!1);break;case"top":(b||D||k||f>v)&&(d=!1);break;case"bottom":(b||D||k||v<f)&&(d=!1)}}return{top:d,left:n}}applyMove(t,s,e,i){let o=t,a=this.bodyContainerRef,n=a.right-a.x,d=this.boxMargin,l=this.elementWidth-2*d,r=this.elementHeight-2*d,h=0,c=0;if(i&&e&&(h=i.pageX-e.pageX,c=i.pageY-e.pageY),e)switch(s){case"content":o.left=o.left+h,o.top=o.top+c,o.left<d&&(o.left=d),o.top<d&&(o.top=d),o.left+o.width>n&&(o.left=n-o.width-d);break;case"right":o.width=o.width+h,o.left+o.width>n&&(o.width=n-o.left-d,o.left=n-o.width-d),o.width<l&&(o.width=l);break;case"left":let t=o.width+o.left;o.width=o.width-h,o.left=o.left+h,o.left<d&&(o.left=d,o.width=t-d),o.width<l&&(o.width=l,o.left=t-o.width);break;case"bottom":o.height=o.height+c,o.height<r&&(o.height=r);break;case"top":let s=o.height+o.top;o.height=o.height-c,o.top=o.top+c,o.top<d&&(o.top=d,o.height=s-d),o.height<r&&(o.height=r,o.top=s-o.height)}return o}addDashlet(t){this.modal.openModal("DashboardAddElement").subscribe((s=>{s.instance.addDashlet.subscribe((s=>{if(!1!==s){this.editing=this.model.generateGuid();let e={id:this.editing,name:s.name,component:s.component,componentconfig:s.componentconfig,dashletconfig:s.dashletconfig,dashlet_id:s.dashlet_id,module:s.module,icon:s.icon,acl_action:s.acl_action,label:s.label,sysuidashboard_id:this.dashboardId,position:{top:Math.round(t.top/this.elementHeight),left:Math.round(t.left/this.elementWidth),width:Math.round(t.width/this.elementWidth),height:Math.round(t.height/this.elementHeight)},is_new:!0};this.dashboardElements=[...this.dashboardElements,e]}}))}))}deleteDashlet(t){this.dashboardElements.some(((s,e)=>{if(s.id===t)return this.dashboardElements.splice(e,1),!0}))}prepareStyle(t){let s=_.clone(t);for(let t in s)s.hasOwnProperty(t)&&"number"==typeof s[t]&&(s[t]=Math.round(s[t])+"px");return s}sortElements(){this.dashboardElements=this.dashboardElements.sort(((t,s)=>t.position.top==s.position.top?t.position.left>s.position.left?1:-1:t.position.top>s.position.top?1:-1))}static#t=this.ɵfac=function(t){return new(t||dashboardlayout)(h.KVO(c.H),h.KVO(l.g),h.KVO(u.y))};static#s=this.ɵprov=h.jDH({token:dashboardlayout,factory:dashboardlayout.ɵfac})}return dashboardlayout})();var g=e(41731),b=e(66031),p=e(69904),f=e(48849),y=e(83935),v=e(28933),k=e(25863),D=e(44985),w=e(32130);let R=(()=>{class DashboardSelectPanelAddButton{constructor(t,s,e){this.model=t,this.modellist=s,this.dashboardlayout=e,this.dashboardAdded=new h.bkB,this.model.module="Dashboards"}addDashboard(){this.model.reset(),this.model.module="Dashboards",this.model.addModel().subscribe((t=>{t&&(this.modellist.listData.list.push(t),this.dashboardAdded.emit({id:t.id}))}))}static#t=this.ɵfac=function(t){return new(t||DashboardSelectPanelAddButton)(h.rXU(l.g),h.rXU(r.K),h.rXU(m))};static#s=this.ɵcmp=h.VBU({type:DashboardSelectPanelAddButton,selectors:[["dashboard-select-panel-add-button"]],outputs:{dashboardAdded:"dashboardAdded"},features:[h.Jv_([l.g])],decls:2,vars:1,consts:[[1,"slds-show--large","slds-button","slds-button_icon","slds-button_icon-border",3,"click"],[3,"icon"]],template:function(t,s){1&t&&(h.j41(0,"button",0),h.bIt("click",(function(){return s.addDashboard()})),h.nrm(1,"system-button-icon",1),h.k0s()),2&t&&(h.R7$(),h.Y8G("icon","add"))},dependencies:[k.t],encapsulation:2})}return DashboardSelectPanelAddButton})();function G(t,s){if(1&t){const t=h.RV6();h.j41(0,"dashboard-select-panel-add-button",13),h.bIt("dashboardAdded",(function(s){h.eBV(t);const e=h.XpG();return h.Njj(e.setDashboard(s))})),h.k0s()}}function I(t,s){if(1&t){const t=h.RV6();h.j41(0,"li",14),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG();return h.Njj(e.setDashboard(s))})),h.j41(1,"div",15),h.EFF(2),h.k0s()()}if(2&t){const t=s.$implicit,e=h.XpG();h.Y8G("ngClass",e.getActiveClass(t.id)),h.R7$(2),h.JRh(t.name)}}let F=(()=>{class DashboardSelectPanel{constructor(t,s,e,i,o,a,n){this.vcr=t,this.metadata=s,this.userpreferences=e,this.language=i,this.model=o,this.modellist=a,this.dashboardlayout=n,this.dashboardFilter="",this.hide=new h.bkB,this.dashboardSelect=new h.bkB}get dashboards(){let t=[];for(let s of this.modellist.listData.list)(s.id==this.dashboardlayout.dashboardId||""==this.dashboardFilter||""!=this.dashboardFilter&&-1!=s.name.toLowerCase().indexOf(this.dashboardFilter.toLowerCase()))&&t.push(s);return t}get canAdd(){return this.metadata.checkModuleAcl("Dashboards","create")}getActiveClass(t){return t==this.dashboardlayout.dashboardId?"slds-is-active":""}setDashboard(t){this.userpreferences.setPreference("last_dashboard",t.id),this.dashboardSelect.emit(t.id),this.hidepanel()}hidepanel(){this.hide.emit(!0)}trackByFn(t,s){return s.id}static#t=this.ɵfac=function(t){return new(t||DashboardSelectPanel)(h.rXU(h.c1b),h.rXU(y.yu),h.rXU(f.S),h.rXU(p.B),h.rXU(l.g),h.rXU(r.K),h.rXU(m))};static#s=this.ɵcmp=h.VBU({type:DashboardSelectPanel,selectors:[["dashboard-select-panel"]],outputs:{hide:"hide",dashboardSelect:"dashboardSelect"},features:[h.Jv_([l.g])],decls:13,vars:6,consts:[["aria-label","Sub page",1,"slds-nav-vertical"],[1,"slds-nav-vertical__section"],[1,"slds-grid","slds-grid_align-spread","slds-grid--vertical-align-center","slds-p-horizontal--small","slds-p-vertical--x-small"],["id","entity-header",1,"slds-text-heading--small"],["module","Dashboards"],[3,"dashboardAdded",4,"ngIf"],[1,"slds-button","slds-button_icon",3,"click"],[3,"icon"],[1,"slds-form-element","slds-p-horizontal--small","slds-p-vertical--x-small"],[1,"slds-form-element__control"],["type","text",1,"slds-input",3,"ngModel","ngModelChange"],["system-to-bottom","",1,"spice-scrollbar",3,"system-overlay-loading-spinner"],["class","slds-nav-vertical__item",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"dashboardAdded"],[1,"slds-nav-vertical__item",3,"ngClass","click"],[1,"slds-nav-vertical__action","slds-text-link_reset"]],template:function(t,s){1&t&&(h.j41(0,"nav",0)(1,"div",1)(2,"div",2)(3,"h2",3),h.nrm(4,"system-label-modulename",4),h.k0s(),h.DNE(5,G,1,0,"dashboard-select-panel-add-button",5),h.j41(6,"button",6),h.bIt("click",(function(){return s.hidepanel()})),h.nrm(7,"system-button-icon",7),h.k0s()(),h.j41(8,"div",8)(9,"div",9)(10,"input",10),h.mxI("ngModelChange",(function(t){return h.DH7(s.dashboardFilter,t)||(s.dashboardFilter=t),t})),h.k0s()()(),h.j41(11,"ul",11),h.DNE(12,I,3,2,"li",12),h.k0s()()()),2&t&&(h.R7$(5),h.Y8G("ngIf",s.canAdd),h.R7$(2),h.Y8G("icon","arrow_left"),h.R7$(3),h.R50("ngModel",s.dashboardFilter),h.R7$(),h.Y8G("system-overlay-loading-spinner",s.modellist.isLoading),h.R7$(),h.Y8G("ngForOf",s.dashboards)("ngForTrackBy",s.trackByFn))},dependencies:[i.YU,i.Sq,i.bT,o.me,o.BC,o.vS,k.t,D.r,v.b,w.M,R],encapsulation:2})}return DashboardSelectPanel})();var x=e(32062),S=e(48717);function E(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",8)(1,"button",9),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.showpanel())})),h.nrm(2,"system-button-icon",10),h.k0s()()}}function j(t,s){1&t&&h.nrm(0,"system-spinner",11)}function B(t,s){if(1&t){const t=h.RV6();h.j41(0,"button",12),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.editModal())})),h.nrm(1,"system-button-icon",13),h.k0s()}}function $(t,s){if(1&t){const t=h.RV6();h.j41(0,"button",12),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.deleteDashboard())})),h.nrm(1,"system-button-icon",14),h.k0s()}}function M(t,s){1&t&&h.nrm(0,"system-button-icon",21)}function C(t,s){if(1&t){const t=h.RV6();h.j41(0,"button",16),h.bIt("click",(function(){h.eBV(t);const s=h.XpG(2);return h.Njj(s.toggleEditContent())})),h.nrm(1,"system-label",22),h.k0s()}}function T(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",15)(1,"button",16),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.toggleHomeDashboard())})),h.DNE(2,M,1,0,"system-button-icon",17),h.j41(3,"span",18),h.nrm(4,"system-label",19),h.k0s()(),h.DNE(5,C,2,0,"button",20),h.k0s()}if(2&t){const t=h.XpG();h.R7$(2),h.Y8G("ngIf",t.isHomeDashboard),h.R7$(3),h.Y8G("ngIf",t.editable&&!t.view.isEditMode())}}function X(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",15)(1,"button",16),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.cancel())})),h.nrm(2,"system-label",23),h.k0s(),h.j41(3,"button",24),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.saveComponents())})),h.nrm(4,"system-label",25),h.k0s()()}}let Y=(()=>{class DashboardContainerHeader{constructor(t,s,e,i,o,a,n,d){this.dashboardlayout=t,this.language=s,this.userpreferences=e,this.metadata=i,this.modal=o,this.backend=a,this.view=n,this.model=d,this.showdashboardselector=!1,this.showselect=new h.bkB}get deletable(){return this.metadata.checkModuleAcl(this.model.module,"delete")}get editable(){return this.metadata.checkModuleAcl(this.model.module,"edit")}get isHomeDashboard(){return this.userpreferences.toUse.home_dashboard==this.model.id}toggleEditContent(){this.view.isEditMode()?this.cancel():(this.dashboardlayout.dashboardElements=JSON.parse(JSON.stringify(this.dashboardlayout.dashboardElements)),this.view.setEditMode(),this.model.startEdit(),this.dashboardlayout.calculateGrid())}toggleHomeDashboard(){this.userpreferences.setPreference("home_dashboard",this.isHomeDashboard?"":this.model.id,!0)}editModal(){this.model.edit()}deleteDashboard(){this.modal.confirmDeleteRecord().subscribe((t=>{t&&this.model.delete().subscribe((()=>{this.dashboardlayout.dashboardId=void 0,this.model.reset(),this.model.module="Dashboards"}))}))}showpanel(){this.showselect.emit(!0)}saveComponents(){this.backend.postRequest("module/Dashboards/"+this.model.id+"/components",{},this.dashboardlayout.dashboardElements).subscribe((()=>{this.view.setViewMode(),this.model.endEdit()}))}cancel(){this.view.setViewMode(),this.model.cancelEdit(),this.dashboardlayout.dashboardElements=this.model.getField("components")}static#t=this.ɵfac=function(t){return new(t||DashboardContainerHeader)(h.rXU(m),h.rXU(p.B),h.rXU(f.S),h.rXU(y.yu),h.rXU(u.y),h.rXU(c.H),h.rXU(g.U),h.rXU(l.g))};static#s=this.ɵcmp=h.VBU({type:DashboardContainerHeader,selectors:[["dashboard-container-header"]],inputs:{showdashboardselector:"showdashboardselector"},outputs:{showselect:"showselect"},decls:11,vars:7,consts:[[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--small"],["class","slds-p-right--small",4,"ngIf"],[1,"slds-col","slds-has-flexi-truncate","slds-grid","slds-grid--vertical-align-center"],["size","16","class","slds-p-right--small",4,"ngIf"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],["class","slds-button slds-show--large",3,"click",4,"ngIf"],[1,"slds-col","slds-no-flex","slds-grid","slds-align-top","slds-show--large"],["class","slds-button-group","role","group",4,"ngIf"],[1,"slds-p-right--small"],[1,"slds-button","slds-button--icon",3,"click"],["icon","rows"],["size","16",1,"slds-p-right--small"],[1,"slds-button","slds-show--large",3,"click"],["icon","edit"],["icon","delete"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["class","slds-m-right--xx-small","icon","check",4,"ngIf"],[1,"slds-truncate"],["label","LBL_AS_HOME_DASHBOARD"],["class","slds-button slds-button--neutral",3,"click",4,"ngIf"],["icon","check",1,"slds-m-right--xx-small"],["label","LBL_EDIT"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(t,s){1&t&&(h.j41(0,"div",0),h.DNE(1,E,3,0,"div",1),h.j41(2,"div",2),h.DNE(3,j,1,0,"system-spinner",3),h.j41(4,"h1",4),h.EFF(5),h.k0s(),h.DNE(6,B,2,0,"button",5)(7,$,2,0,"button",5),h.k0s(),h.j41(8,"div",6),h.DNE(9,T,6,2,"div",7)(10,X,5,0,"div",7),h.k0s()()),2&t&&(h.R7$(),h.Y8G("ngIf",s.showdashboardselector),h.R7$(2),h.Y8G("ngIf",s.dashboardlayout.isloading),h.R7$(2),h.SpI(" ",s.model.data.name," "),h.R7$(),h.Y8G("ngIf",s.editable&&s.model.id),h.R7$(),h.Y8G("ngIf",s.deletable&&s.model.id),h.R7$(2),h.Y8G("ngIf",!s.dashboardlayout.isloading&&s.model.id),h.R7$(),h.Y8G("ngIf",s.view.isEditMode()))},dependencies:[i.bT,k.t,x.W,S.P],encapsulation:2})}return DashboardContainerHeader})();var L=e(13269),U=e(58461),N=e(18521);const V=["containerelement"];function O(t,s){1&t&&h.nrm(0,"div",null,5)}function H(t,s){1&t&&(h.j41(0,"div",6),h.nrm(1,"system-illustration-no-access"),h.k0s())}function z(t,s){1&t&&h.nrm(0,"div",7)}function A(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",10)(1,"system-utility-icon",11),h.bIt("click",(function(){h.eBV(t);const s=h.XpG(2);return h.Njj(s.dashboardlayout.deleteDashlet(s.item.id))})),h.k0s()()}2&t&&(h.R7$(),h.Y8G("icon","close")("size","xx-small"))}function P(t,s){if(1&t){const t=h.RV6();h.qex(0),h.DNE(1,A,2,2,"div",8),h.j41(2,"div",9),h.bIt("mousedown",(function(s){h.eBV(t);const e=h.XpG();return h.Njj(e.onMousedown("top",s))})),h.k0s(),h.j41(3,"div",9),h.bIt("mousedown",(function(s){h.eBV(t);const e=h.XpG();return h.Njj(e.onMousedown("right",s))})),h.k0s(),h.j41(4,"div",9),h.bIt("mousedown",(function(s){h.eBV(t);const e=h.XpG();return h.Njj(e.onMousedown("bottom",s))})),h.k0s(),h.j41(5,"div",9),h.bIt("mousedown",(function(s){h.eBV(t);const e=h.XpG();return h.Njj(e.onMousedown("left",s))})),h.k0s(),h.bVm()}if(2&t){const t=h.XpG();h.R7$(),h.Y8G("ngIf",t.isEditing()),h.R7$(),h.Y8G("ngStyle",t.getBoundingBoxStyle("top")),h.R7$(),h.Y8G("ngStyle",t.getBoundingBoxStyle("right")),h.R7$(),h.Y8G("ngStyle",t.getBoundingBoxStyle("bottom")),h.R7$(),h.Y8G("ngStyle",t.getBoundingBoxStyle("left"))}}let W=(()=>{class DashboardContainerElement{constructor(t,s,e,i,o){this.dashboardlayout=t,this.metadata=s,this.renderer=e,this.model=i,this.view=o,this.componentRefs=[],this.isAuthorized=!0,this.item={},this.mouseMoveListener=void 0,this.mouseUpListener=void 0,this.mouseLast=null,this.mouseStart=null,this.mouseTarget="",this.isMoving=!1}get containerClass(){return{"slds-scrollable--y":!this.view.isEditMode(),"slds-is-absolute":!this.dashboardlayout.compactView,"slds-m-vertical_xx-small":this.dashboardlayout.compactView}}ngAfterViewInit(){this.renderDashlet()}renderDashlet(){for(let t of this.componentRefs)t.destroy();window.setTimeout((()=>this.isAuthorized=!this.item.module||this.metadata.checkModuleAcl(this.item.module,this.item.acl_action?this.item.acl_action:"list"))),this.item.component&&this.isAuthorized&&this.metadata.addComponent(this.item.component,this.containerelement).subscribe((t=>{t.instance.dashletconfig=this.item.dashletconfig,t.instance.acl_action=this.item.acl_action,t.instance.icon=this.item.icon,t.instance.dashlet_id=this.item.dashlet_id,t.instance.componentconfig=this.item.componentconfig,t.instance.dashletModule=this.item.module,t.instance.dashletLabel=this.item.label,this.componentRefs.push(t)}))}isEditing(){return this.view.isEditMode()&&this.item.id===this.dashboardlayout.editing}getBoxStyle(){let t=this.item.position,s=this.dashboardlayout.getElementStyle(t.top,t.left,t.width,t.height),e=this.dashboardlayout.applyMove(s,this.mouseTarget,this.mouseStart,this.mouseLast);return this.isEditing()&&(e.border="1px dashed #ca1b21",e.cursor="move",this.isMoving&&(e.opacity=".5",e["z-index"]="9999")),this.dashboardlayout.prepareStyle(e)}getBoundingBoxStyle(t){let s=this.item.position,e=this.dashboardlayout.getElementStyle(s.top,s.left,s.width,s.height),i=this.dashboardlayout.applyMove(e,this.mouseTarget,this.mouseStart,this.mouseLast),o={};switch(t){case"top":o={top:-4,left:i.width/2-4,cursor:"n-resize"};break;case"bottom":o={top:i.height-5,left:i.width/2-4,cursor:"s-resize"};break;case"left":o={top:i.height/2-4,left:"-4px",cursor:"w-resize"};break;case"right":o={left:i.width-5,top:i.height/2-4,cursor:"e-resize"}}return o["background-color"]="#fff",o.position="absolute",o.border="1px solid #ca1b21",o.width="8px",o.height="8px",this.dashboardlayout.prepareStyle(o)}onMousedown(t,s){this.view.isEditMode()&&(this.mouseTarget=t,this.dashboardlayout.editing=this.item.id,this.mouseStart=s,this.mouseLast=s,this.mouseUpListener=this.renderer.listen("document","mouseup",(t=>this.onMouseUp())),this.mouseMoveListener=this.renderer.listen("document","mousemove",(t=>this.onMouseMove(t))),this.isMoving=!0,s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault(),s.cancelBubble=!0,s.returnValue=!1)}onMouseMove(t){this.view.isEditMode()&&(this.mouseLast=t),this.handleScrolling()}onMouseUp(){this.mouseUpListener(),this.mouseMoveListener(),this.dropItem(),this.mouseStart=null,this.mouseLast=null,this.mouseTarget="",this.isMoving=!1}handleScrolling(){if(!this.view.isEditMode()||!this.isMoving)return;let t=this.mouseLast.pageY-this.mouseStart.pageY,s=this.item.position;s=this.dashboardlayout.getElementStyle(s.top,s.left,s.width,s.height);let e="bottom"==this.mouseTarget?s.height+t:s.height,i="content"==this.mouseTarget?s.top+t+e:s.top+e,o=this.dashboardlayout.bodyContainerRef;i>o.getBoundingClientRect().bottom-o.offsetTop-50&&(o.scrollTop+=5)}dropItem(){if(!this.mouseLast||!this.mouseStart)return!1;let t=this.mouseLast.pageY-this.mouseStart.pageY,s=this.mouseLast.pageX-this.mouseStart.pageX;this.dashboardlayout.dropElement(this.item.id,s,t,this.mouseTarget,this.mouseLast)}static#t=this.ɵfac=function(t){return new(t||DashboardContainerElement)(h.rXU(m),h.rXU(y.yu),h.rXU(h.sFG),h.rXU(l.g),h.rXU(g.U))};static#s=this.ɵcmp=h.VBU({type:DashboardContainerElement,selectors:[["dashboard-container-element"]],viewQuery:function(t,s){if(1&t&&h.GBs(V,5,h.c1b),2&t){let t;h.mGM(t=h.lsd())&&(s.containerelement=t.first)}},inputs:{item:"item"},decls:6,vars:8,consts:[[1,"slds-box--border","slds-theme--default","spice-scrollbar-thin",3,"ngStyle","ngClass","mousedown"],[2,"width","100%","height","100%"],[4,"ngIf"],["class","slds-align_absolute-center","style","height: 100%",4,"ngIf"],["style","width: 100%; height: 100%; position: absolute;top: 0; left: 0;",4,"ngIf"],["containerelement",""],[1,"slds-align_absolute-center",2,"height","100%"],[2,"width","100%","height","100%","position","absolute","top","0","left","0"],["class","slds-is-absolute slds-m-around--x-small slds-align_absolute-center","style","top:0;right:0",4,"ngIf"],[3,"ngStyle","mousedown"],[1,"slds-is-absolute","slds-m-around--x-small","slds-align_absolute-center",2,"top","0","right","0"],[2,"cursor","pointer",3,"icon","size","click"]],template:function(t,s){1&t&&(h.j41(0,"div",0),h.bIt("mousedown",(function(t){return s.onMousedown("content",t)})),h.j41(1,"div",1),h.DNE(2,O,2,0,"div",2)(3,H,2,0,"div",3),h.k0s(),h.DNE(4,z,1,0,"div",4)(5,P,6,5,"ng-container",2),h.k0s()),2&t&&(h.Y8G("ngStyle",s.getBoxStyle())("ngClass",s.containerClass),h.R7$(),h.xc7("overflow",s.view.isEditMode()?"hidden":"initial"),h.R7$(),h.Y8G("ngIf",s.isAuthorized),h.R7$(),h.Y8G("ngIf",!s.isAuthorized),h.R7$(),h.Y8G("ngIf",s.view.isEditMode()),h.R7$(),h.Y8G("ngIf",s.isEditing()))},dependencies:[i.YU,i.bT,i.B3,L.r,N.B],encapsulation:2})}return DashboardContainerElement})();const K=["bodycontainer"];function q(t,s){if(1&t){const t=h.RV6();h.qex(0),h.j41(1,"div",8)(2,"button",9),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG(3);return h.Njj(e.addDashlet(s))})),h.nrm(3,"system-button-icon",10),h.k0s()(),h.bVm()}if(2&t){const t=s.$implicit,e=h.XpG(3);h.R7$(),h.Y8G("ngStyle",e.dashboardlayout.prepareStyle(t)),h.R7$(2),h.Y8G("icon","add")("size","medium")}}function J(t,s){if(1&t&&(h.qex(0),h.DNE(1,q,4,3,"ng-container",7),h.bVm()),2&t){const t=s.$implicit;h.R7$(),h.Y8G("ngForOf",t)}}function Q(t,s){if(1&t&&(h.qex(0),h.DNE(1,J,2,1,"ng-container",6),h.bVm()),2&t){const t=h.XpG();h.R7$(),h.Y8G("ngForOf",t.dashboardGrid)("ngForTrackBy",t.trackByGridFn)}}function Z(t,s){if(1&t&&h.nrm(0,"dashboard-container-element",11),2&t){const t=s.$implicit;h.Y8G("item",t)}}function tt(t,s){1&t&&(h.j41(0,"div",12),h.nrm(1,"system-spinner"),h.j41(2,"div",13),h.nrm(3,"system-label",14),h.k0s()())}function st(t,s){1&t&&(h.j41(0,"div",15),h.nrm(1,"system-illustration-no-access"),h.k0s())}function et(t,s){1&t&&(h.j41(0,"div",15)(1,"system-illustration-no-records"),h.nrm(2,"system-label",16),h.k0s()())}let it=(()=>{class DashboardContainerBody{constructor(t,s,e,i,o){this.dashboardlayout=t,this.language=s,this.renderer=e,this.view=i,this.model=o,this.resizeListener=this.renderer.listen("window","resize",(()=>this.calculateGrid()))}get isLoading(){return this.model.isLoading}get dashboardGrid(){return this.dashboardlayout.dashboardGrid}get dashboardElements(){return this.dashboardlayout.dashboardElements}get isEditMode(){return this.view.isEditMode()}get bodyContainerStyle(){return{border:this.view.isEditMode()?"1px dashed #ca1b21":"0",width:"100%"}}ngAfterViewInit(){this.dashboardlayout.bodyContainerRef=this.bodycontainer}ngOnDestroy(){this.resizeListener&&this.resizeListener()}trackByGridFn(t,s){return t}trackByItemFn(t,s){return s.id}calculateGrid(){window.innerWidth<1024&&(this.view.setViewMode(),this.model.cancelEdit()),this.isEditMode&&this.dashboardlayout.calculateGrid()}addDashlet(t){this.dashboardlayout.addDashlet(t)}static#t=this.ɵfac=function(t){return new(t||DashboardContainerBody)(h.rXU(m),h.rXU(p.B),h.rXU(h.sFG),h.rXU(g.U),h.rXU(l.g))};static#s=this.ɵcmp=h.VBU({type:DashboardContainerBody,selectors:[["dashboard-container-body"]],viewQuery:function(t,s){if(1&t&&h.GBs(K,7,h.c1b),2&t){let t;h.mGM(t=h.lsd())&&(s.bodycontainer=t.first)}},decls:7,vars:7,consts:[["system-to-bottom","",1,"slds-is-relative","spice-scrollbar",3,"ngStyle"],["bodycontainer",""],[4,"ngIf"],[3,"item",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-align--absolute-center slds-grid slds-grid--vertical","system-to-bottom","",4,"ngIf"],["class","slds-align--absolute-center slds-grid slds-grid--vertical","style","height: 100%",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf"],[2,"padding","10px","border","1px solid #ddd","position","absolute",3,"ngStyle"],[1,"slds-button","slds-button--icon","slds-align--absolute-center",2,"height","100%","width","100%",3,"click"],[2,"height","100%","width","100%",3,"icon","size"],[3,"item"],["system-to-bottom","",1,"slds-align--absolute-center","slds-grid","slds-grid--vertical"],[1,"slds-m-around--medium","slds-text-heading--small"],["label","MSG_LOADING_DASHBOARDS"],[1,"slds-align--absolute-center","slds-grid","slds-grid--vertical",2,"height","100%"],["label","MSG_NO_RECORDS_FOUND"]],template:function(t,s){1&t&&(h.j41(0,"div",0,1),h.DNE(2,Q,2,2,"ng-container",2)(3,Z,1,1,"dashboard-container-element",3)(4,tt,4,0,"div",4)(5,st,2,0,"div",5)(6,et,3,0,"div",5),h.k0s()),2&t&&(h.Y8G("ngStyle",s.bodyContainerStyle),h.R7$(2),h.Y8G("ngIf",s.isEditMode),h.R7$(),h.Y8G("ngForOf",s.dashboardElements)("ngForTrackBy",s.trackByItemFn),h.R7$(),h.Y8G("ngIf",s.isLoading),h.R7$(),h.Y8G("ngIf",!s.isLoading&&s.dashboardlayout.dashboardNotFound),h.R7$(),h.Y8G("ngIf",!s.isLoading&&0==s.dashboardElements.length&&!s.dashboardlayout.dashboardNotFound&&!s.isEditMode))},dependencies:[i.Sq,i.bT,i.B3,k.t,L.r,U.b,x.W,S.P,v.b,W],encapsulation:2})}return DashboardContainerBody})();function ot(t,s){1&t&&h.nrm(0,"dashboard-container-body")}function at(t,s){1&t&&(h.j41(0,"div",7)(1,"span",8),h.EFF(2,"Please Select a Dashboard"),h.k0s()())}const nt=t=>({"slds-is-absolute":t});let dt=(()=>{class DashboardView{constructor(t,s,e,i,o,a,n,d){this.navigationTab=t,this.language=s,this.dashboardlayout=e,this.userpreferences=i,this.model=o,this.view=a,this.modellist=n,this.metadata=d,this.panelwidth=250,this.showpanel=!0}get ismobile(){return window.innerWidth<1024}get dashboardstyle(){return{width:"calc(100% - "+(this.ismobile||!this.showpanel?0:this.panelwidth)+"px)"}}get panelstyle(){return{width:(this.showpanel?this.panelwidth:0)+"px","z-index":1,display:this.showpanel||this.ismobile?"block":"none",left:this.ismobile&&!this.showpanel?"-250px":"0px"}}ngOnInit(){this.loadDashboards(),this.navigationTab.setTabInfo({displaymodule:"Dashboards",displayname:this.metadata.getModuleDefs("Dashboards").module_label})}loadDashboards(){let t=this.userpreferences.getPreference("last_dashboard");this.model.module="Dashboards",this.modellist.initialize("Dashboards"),this.modellist.loadlimit=250,this.modellist.getListData().subscribe((()=>{t&&this.modellist.listData.list.some((s=>{if(s.id==t)return this.loadDashboard(t),!0}))}))}loadDashboard(t){t!=this.dashboardlayout.dashboardId&&(this.view.setViewMode(),this.dashboardlayout.dashboardId=t,this.model.id=t,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData().subscribe((()=>{this.dashboardlayout.dashboardElements=this.model.getField("components"),this.dashboardlayout.sortElements()}),(t=>{404==t.status&&(this.dashboardlayout.dashboardNotFound=!0)})))}static#t=this.ɵfac=function(t){return new(t||DashboardView)(h.rXU(b._),h.rXU(p.B),h.rXU(m),h.rXU(f.S),h.rXU(l.g),h.rXU(g.U),h.rXU(r.K),h.rXU(y.yu))};static#s=this.ɵcmp=h.VBU({type:DashboardView,selectors:[["dashboard-view"]],features:[h.Jv_([l.g,r.K,m,g.U])],decls:7,vars:8,consts:[[1,"slds-grid"],[1,"slds-theme--shade",2,"transition","left 1s",3,"ngClass","ngStyle"],[3,"hide","dashboardSelect"],[1,"slds-theme--default",3,"ngStyle"],[3,"showdashboardselector","showselect"],[4,"ngIf"],["system-to-bottom","","class","slds-align--absolute-center",4,"ngIf"],["system-to-bottom","",1,"slds-align--absolute-center"],[1,"slds-text-heading--small"]],template:function(t,s){1&t&&(h.j41(0,"div",0)(1,"div",1)(2,"dashboard-select-panel",2),h.bIt("hide",(function(){return s.showpanel=!1}))("dashboardSelect",(function(t){return s.loadDashboard(t)})),h.k0s()(),h.j41(3,"div",3)(4,"dashboard-container-header",4),h.bIt("showselect",(function(){return s.showpanel=!0})),h.k0s(),h.DNE(5,ot,1,0,"dashboard-container-body",5)(6,at,3,0,"div",6),h.k0s()()),2&t&&(h.R7$(),h.Y8G("ngClass",h.eq3(6,nt,s.ismobile))("ngStyle",s.panelstyle),h.R7$(2),h.Y8G("ngStyle",s.dashboardstyle),h.R7$(),h.Y8G("showdashboardselector",!s.showpanel),h.R7$(),h.Y8G("ngIf",s.dashboardlayout.dashboardId),h.R7$(),h.Y8G("ngIf",!s.dashboardlayout.dashboardId))},dependencies:[i.YU,i.bT,i.B3,v.b,F,Y,it],encapsulation:2})}return DashboardView})();var lt=e(57363);function rt(t,s){1&t&&h.nrm(0,"dashboard-container-body")}function ht(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",2)(1,"span"),h.nrm(2,"system-label",3),h.k0s(),h.j41(3,"a",4),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.navigate())})),h.nrm(4,"system-label",5),h.k0s()()}}let ct=(()=>{class DashboardContainer{constructor(t,s,e,i){this.dashboardlayout=t,this.language=s,this.router=e,this.model=i,this.dashboardid="",this.context="Dashboard"}loadDashboard(){this.dashboardid!=this.dashboardlayout.dashboardId&&(this.model.initialize(),this.model.module="Dashboards",this.dashboardlayout.dashboardId=this.dashboardid,this.model.id=this.dashboardid,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData(!1).subscribe((()=>{this.dashboardlayout.dashboardElements=this.model.getField("components"),this.dashboardlayout.sortElements()}),(t=>{404==t.status&&(this.dashboardlayout.dashboardNotFound=!0)})))}ngOnInit(){this.loadDashboard()}ngOnChanges(){this.loadDashboard()}navigate(){this.router.navigate(["/module/Dashboards"])}static#t=this.ɵfac=function(t){return new(t||DashboardContainer)(h.rXU(m),h.rXU(p.B),h.rXU(lt.Ix),h.rXU(l.g))};static#s=this.ɵcmp=h.VBU({type:DashboardContainer,selectors:[["dashboard-container"]],inputs:{dashboardid:"dashboardid",context:"context"},features:[h.Jv_([l.g,g.U,m]),h.OA$],decls:2,vars:2,consts:[[4,"ngIf"],["class","slds-align--absolute-center slds-text-heading--small","system-to-bottom","",4,"ngIf"],["system-to-bottom","",1,"slds-align--absolute-center","slds-text-heading--small"],["label","MSG_NO_DASHBOARD_SELECTED"],[1,"slds-m-left--xx-small","slds-text-link",2,"cursor","pointer",3,"click"],["label","LBL_SELECT_DASHBOARD"]],template:function(t,s){1&t&&h.DNE(0,rt,1,0,"dashboard-container-body",0)(1,ht,5,0,"div",1),2&t&&(h.Y8G("ngIf",s.dashboardid.length>0),h.R7$(),h.Y8G("ngIf",0==s.dashboardid.length))},dependencies:[i.bT,x.W,v.b,it],encapsulation:2})}return DashboardContainer})();var ut=e(43308);function mt(t,s){1&t&&h.nrm(0,"system-stencil")}let gt=(()=>{class DashboardContainerHomeHeader{constructor(t,s,e){this.dashboardlayout=t,this.language=s,this.router=e,this.dashboardid=""}get dashboardname(){return this.dashboardlayout.model.getFieldValue("name")}goDashboards(){this.router.navigate(["/module/Dashboards"])}static#t=this.ɵfac=function(t){return new(t||DashboardContainerHomeHeader)(h.rXU(m),h.rXU(p.B),h.rXU(lt.Ix))};static#s=this.ɵcmp=h.VBU({type:DashboardContainerHomeHeader,selectors:[["dashboard-container-homeheader"]],inputs:{dashboardid:"dashboardid"},decls:8,vars:2,consts:[[1,"slds-grid","slds-p-around--small"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[1,"slds-col","slds-no-flex","slds-grid","slds-align-top"],[1,"slds-button","slds-button--neutral",3,"click"],["module","Dashboards"]],template:function(t,s){1&t&&(h.j41(0,"div",0)(1,"div",1)(2,"h1",2),h.DNE(3,mt,1,0,"system-stencil",3),h.EFF(4),h.k0s()(),h.j41(5,"div",4)(6,"button",5),h.bIt("click",(function(){return s.goDashboards()})),h.nrm(7,"system-label-modulename",6),h.k0s()()()),2&t&&(h.R7$(3),h.Y8G("ngIf",!s.dashboardname),h.R7$(),h.JRh(s.dashboardname))},dependencies:[i.bT,D.r,ut.O],encapsulation:2})}return DashboardContainerHomeHeader})();var bt=e(68823),pt=e(40713),ft=e(25028),yt=e(88418),vt=e(83524);function kt(t,s){if(1&t&&(h.j41(0,"option",34),h.EFF(1),h.k0s()),2&t){const t=s.$implicit;h.Y8G("value",t),h.R7$(),h.SpI(" ",t," ")}}function Dt(t,s){1&t&&h.nrm(0,"system-utility-icon",35)}function wt(t,s){if(1&t){const t=h.RV6();h.j41(0,"button",36),h.bIt("click",(function(){h.eBV(t);const s=h.XpG();return h.Njj(s.searchKey="")})),h.nrm(1,"system-button-icon",37),h.k0s()}}function Rt(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",41)(1,"a",42),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG(2);return h.Njj(e.add(s))})),h.nrm(2,"system-icon",43),h.j41(3,"div",44)(4,"h2",45),h.nrm(5,"system-label",46),h.k0s(),h.j41(6,"p",47),h.nrm(7,"system-label",48),h.k0s()()()()}if(2&t){const t=s.$implicit,e=h.XpG(2);h.R7$(2),h.Y8G("icon",e.getIcon(t.icon))("sprite",e.getSprite(t.icon))("module",t.module?t.module:"Dashboards"),h.R7$(2),h.Y8G("title",t.label?t.label:t.name),h.R7$(),h.Y8G("label",t.label?t.label:t.name),h.R7$(2),h.Y8G("label",t.label?t.label:t.description)}}function Gt(t,s){if(1&t&&(h.j41(0,"div",38)(1,"div",39),h.DNE(2,Rt,8,6,"div",40),h.k0s()()),2&t){const t=h.XpG();h.R7$(2),h.Y8G("ngForOf",t.dashboardDashlets)("ngForTrackBy",t.trackByFn)}}function _t(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",41)(1,"a",42),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG(2);return h.Njj(e.add(s))})),h.nrm(2,"system-icon",51),h.j41(3,"div",44)(4,"h2",45),h.EFF(5),h.k0s(),h.j41(6,"p",47),h.EFF(7),h.k0s()()()()}if(2&t){const t=s.$implicit;h.R7$(2),h.Y8G("module",t.report_module),h.R7$(2),h.Y8G("title",t.name),h.R7$(),h.SpI(" ",t.name," "),h.R7$(2),h.SpI(" ",t.description," ")}}function It(t,s){if(1&t&&(h.j41(0,"div",49)(1,"div",39),h.DNE(2,_t,8,4,"div",50),h.k0s()()),2&t){const t=h.XpG();h.R7$(2),h.Y8G("ngForOf",t.kReports)("ngForTrackBy",t.trackByFn)}}function Ft(t,s){1&t&&h.nrm(0,"system-spinner")}let xt=(()=>{class DashboardAddElement{constructor(t,s,e){this.language=t,this.metadata=s,this.backend=e,this.self={},this.kreports=[],this.dashboarddashlets=[],this.dashletName="",this.searchKey="",this.dashlettype="Generic",this.dashletModule="*",this.isLoading=!1,this.canLoadMore=!0,this.loadLimit=40,this.addDashlet=new h.bkB,this.modules=[]}get kReports(){return"*"==this.dashletModule?this.kreports:this.kreports.filter((t=>t.report_module==this.dashletModule))}get dashboardDashlets(){return this.dashboarddashlets.filter((t=>("*"==this.dashletModule||t.module==this.dashletModule)&&(0==this.searchKey.length||this.language.getLabel(t.label).toLowerCase().indexOf(this.searchKey.toLowerCase())>-1)&&this.metadata.checkModuleAcl(t.module,"list")))}get dashletType(){return this.dashlettype}set dashletType(t){this.dashlettype=t,this.resetValues(),"Generic"===t?this.getDashlets():this.getKReports()}ngOnInit(){this.getDashlets(),this.modules=this.metadata.getModules().sort()}resetValues(){this.dashletModule="*",this.searchKey="",this.canLoadMore=!0}search(){"Generic"!==this.dashletType&&(this.searchTimeout&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout((()=>this.getKReports()),600))}trackByFn(t,s){return t}getDashlets(){this.isLoading=!0,this.dashboarddashlets=[],this.backend.getRequest("module/Dashboards/dashlets").subscribe((t=>{this.dashboarddashlets=t,this.isLoading=!1}))}getKReports(){this.isLoading=!0,this.kreports=[];let t={offset:0,limit:this.loadLimit,searchKey:this.searchKey};this.backend.getRequest("module/KReports/published/"+this.dashletType,t).subscribe((t=>{this.kreports=t,this.isLoading=!1}))}getMoreKReports(){if(!this.canLoadMore||this.isLoading)return;this.isLoading=!0;let t={offset:this.kReports.length,limit:this.loadLimit};this.backend.getRequest("module/KReports/published/"+this.dashletType,t).subscribe((t=>{this.kreports=this.kReports.concat(t),this.canLoadMore=t.length==this.loadLimit,this.isLoading=!1}))}getIcon(t){return t&&t.split(":")[1]?t.split(":")[1]:t}getSprite(t){return t&&t.split(":")[1]?t.split(":")[0]:"standard"}onScroll(t){t.scrollTop+t.clientHeight>=t.scrollHeight&&this.getMoreKReports()}add(t){if(!t)return;let s=this.dashletName,e="",i={},o={},a="",n="",d="",l="",r="";switch(this.dashletType){case"dashletVisualization":e="ReporterVisualizationDashlet",i={reportid:t.id},a="KReports";break;case"dashletPresentation":e="ReporterPresentationDashlet",i={reportid:t.id},a="KReports";break;case"Generic":e=t.component,l=t.id,o=t.componentconfig?JSON.parse(t.componentconfig):"",a=t.module,r=t.label,n=t.icon,d=t.acl_action}this.addDashlet.emit({name:s,label:r,module:a,component:e,componentconfig:i,dashletconfig:o,icon:n,acl_action:d,dashlet_id:l}),this.self.destroy()}close(){this.addDashlet.emit(!1),this.self.destroy()}static#t=this.ɵfac=function(t){return new(t||DashboardAddElement)(h.rXU(p.B),h.rXU(y.yu),h.rXU(c.H))};static#s=this.ɵcmp=h.VBU({type:DashboardAddElement,selectors:[["dashboard-add-element"]],decls:43,vars:10,consts:[["size","large"],[3,"close"],["label","LBL_ADD_DASHLET"],[2,"overflow-y","hidden",3,"grow"],[1,"slds-grid",2,"height","80px"],[1,"slds-form-element","slds-size--1-of-3"],[1,"slds-form-element__label"],["label","LBL_TYPE"],[1,"slds-form-element__control"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","Generic"],["label","LBL_DASHLET"],["value","dashletVisualization"],["label","LBL_REPORT_CHART"],["value","dashletPresentation"],["label","LBL_REPORT_LIST"],[1,"slds-form-element","slds-size--1-of-3","slds-p-left--small"],["label","LBL_MODULE"],["value","*"],[3,"value",4,"ngFor","ngForOf"],["label","LBL_SEARCH"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["type","text",1,"slds-lookup__search-input","slds-input",3,"ngModel","ngModelChange","keyup"],["icon","search","addclasses","slds-input__icon",4,"ngIf"],["class","slds-button slds-input__icon slds-input__icon_right",3,"click",4,"ngIf"],[2,"height","calc(100% - 80px)"],[1,"slds-scrollable--y",2,"height","100%",3,"scroll"],["scrollElement",""],["class","slds-form-element",4,"ngIf"],["class","slds-form-element slds-lookup",4,"ngIf"],[4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[3,"value"],["icon","search","addclasses","slds-input__icon"],[1,"slds-button","slds-input__icon","slds-input__icon_right",3,"click"],["icon","clear"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"icon","sprite","module"],[1,"slds-media__body","slds-border_left","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate",3,"title"],[3,"label"],[1,"slds-m-top_small","slds-truncate"],["length","long",3,"label"],[1,"slds-form-element","slds-lookup"],["class","slds-size--1-of-3 slds-p-around--xx-small",4,"ngFor","ngForOf","ngForTrackBy"],["size","large",1,"slds-align_absolute-center",3,"module"]],template:function(t,s){if(1&t){const t=h.RV6();h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",2),h.k0s(),h.j41(3,"system-modal-content",3)(4,"div",4)(5,"div",5)(6,"label",6),h.nrm(7,"system-label",7),h.k0s(),h.j41(8,"div",8)(9,"div",9)(10,"select",10),h.mxI("ngModelChange",(function(t){return h.DH7(s.dashletType,t)||(s.dashletType=t),t})),h.j41(11,"option",11),h.nrm(12,"system-label",12),h.k0s(),h.j41(13,"option",13),h.nrm(14,"system-label",14),h.k0s(),h.j41(15,"option",15),h.nrm(16,"system-label",16),h.k0s()()()()(),h.j41(17,"div",17)(18,"label",6),h.nrm(19,"system-label",18),h.k0s(),h.j41(20,"div",8)(21,"div",9)(22,"select",10),h.mxI("ngModelChange",(function(t){return h.DH7(s.dashletModule,t)||(s.dashletModule=t),t})),h.j41(23,"option",19),h.EFF(24,"All"),h.k0s(),h.DNE(25,kt,2,2,"option",20),h.k0s()()()(),h.j41(26,"div",17)(27,"label",6),h.nrm(28,"system-label",21),h.k0s(),h.j41(29,"div",8)(30,"div",22)(31,"input",23),h.mxI("ngModelChange",(function(t){return h.DH7(s.searchKey,t)||(s.searchKey=t),t})),h.bIt("keyup",(function(){return s.search()})),h.k0s(),h.DNE(32,Dt,1,0,"system-utility-icon",24)(33,wt,2,0,"button",25),h.k0s()()()(),h.j41(34,"div",26)(35,"div",27,28),h.bIt("scroll",(function(){h.eBV(t);const e=h.sdS(36);return h.Njj(s.onScroll(e))})),h.DNE(37,Gt,3,2,"div",29)(38,It,3,2,"div",30)(39,Ft,1,0,"system-spinner",31),h.k0s()()(),h.j41(40,"system-modal-footer")(41,"button",32),h.bIt("click",(function(){return s.close()})),h.nrm(42,"system-label",33),h.k0s()()()}2&t&&(h.R7$(3),h.Y8G("grow",!0),h.R7$(7),h.R50("ngModel",s.dashletType),h.R7$(12),h.R50("ngModel",s.dashletModule),h.R7$(3),h.Y8G("ngForOf",s.modules),h.R7$(6),h.R50("ngModel",s.searchKey),h.R7$(),h.Y8G("ngIf",0==s.searchKey.length),h.R7$(),h.Y8G("ngIf",s.searchKey.length>0),h.R7$(4),h.Y8G("ngIf","Generic"===s.dashletType),h.R7$(),h.Y8G("ngIf","Generic"!==s.dashletType),h.R7$(),h.Y8G("ngIf",s.isLoading))},dependencies:[i.Sq,i.bT,o.xH,o.y7,o.me,o.wz,o.BC,o.vS,k.t,bt.J,x.W,pt.D,ft.I,yt.Q,vt.C,S.P,N.B],encapsulation:2})}return DashboardAddElement})();var St=e(21626);function Et(t,s){if(1&t&&(h.j41(0,"h2",9),h.EFF(1),h.k0s()),2&t){const t=h.XpG(2);h.R7$(),h.SpI("Weather in ",t.cityName,"")}}function jt(t,s){if(1&t&&(h.j41(0,"span"),h.EFF(1),h.k0s()),2&t){const t=h.XpG(3);h.R7$(),h.SpI(", ",t.description,"")}}function Bt(t,s){if(1&t&&(h.j41(0,"span",14),h.EFF(1),h.k0s()),2&t){const t=h.XpG(3);h.R7$(),h.JRh(t.getHour(t.dayHourToShow.dt))}}function $t(t,s){if(1&t&&(h.j41(0,"div",11),h.EFF(1),h.k0s()),2&t){const t=h.XpG(3);h.R7$(),h.JRh(t.description)}}function Mt(t,s){if(1&t&&(h.j41(0,"div",10)(1,"div",11)(2,"span"),h.EFF(3),h.DNE(4,jt,2,1,"span",8),h.k0s(),h.DNE(5,Bt,2,1,"span",12),h.k0s(),h.DNE(6,$t,2,1,"div",13),h.k0s()),2&t){const t=h.XpG(2);h.Y8G("ngClass",t.todayOnly?"slds-border--bottom slds-p-bottom--xxx-small":""),h.R7$(3),h.SpI(" ",t.getDayName(t.dayHourToShow.dt)," "),h.R7$(),h.Y8G("ngIf",t.todayOnly),h.R7$(),h.Y8G("ngIf",!t.todayOnly),h.R7$(),h.Y8G("ngIf",!t.todayOnly)}}function Ct(t,s){if(1&t&&(h.j41(0,"div",15)(1,"div",16),h.nrm(2,"img",17),h.j41(3,"div",18),h.EFF(4),h.k0s()(),h.j41(5,"div",19)(6,"div",11),h.EFF(7),h.k0s(),h.j41(8,"div",11),h.EFF(9),h.k0s(),h.j41(10,"div",11),h.EFF(11),h.k0s()()()),2&t){const t=h.XpG(2);h.R7$(2),h.Y8G("src",t.getWeatherIconUrl(t.dayHourToShow.weather[0].icon),h.B4B),h.R7$(2),h.SpI("",t.getTemperature(t.dayHourToShow.main.temp),"°C"),h.R7$(3),h.SpI("Clouds: ",t.dayHourToShow.clouds.all,"%"),h.R7$(2),h.SpI("Humidity: ",t.dayHourToShow.main.humidity,"%"),h.R7$(2),h.SpI("Wind: ",t.getWind(t.dayHourToShow.wind),"km/h")}}function Tt(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",24),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG(3);return h.Njj(e.setDayHourToShow(s))})),h.EFF(1),h.k0s()}if(2&t){const t=s.$implicit,e=h.XpG(3);h.Y8G("ngClass",t.dt==e.dayHourToShow.dt?"slds-text-color--error":""),h.R7$(),h.SpI(" ",e.getHour(t.dt)," ")}}const Xt=()=>({"background-color":"#faf7f7",border:"1px solid #e0dfdf"}),Yt=()=>({});function Lt(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",25),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG(3);return h.Njj(e.setDayToShow(s))})),h.j41(1,"div",26),h.EFF(2),h.k0s(),h.j41(3,"div",27),h.nrm(4,"img",28),h.k0s(),h.j41(5,"div",26)(6,"span"),h.EFF(7),h.k0s(),h.nrm(8,"span",29),h.k0s()()}if(2&t){const t=s.$implicit,e=s.first,i=h.XpG(3);h.Y8G("ngStyle",i.getDayName(e?t[0].dt:t[4].dt)==i.getDayName(i.dayHourToShow.dt)?h.lJ4(4,Xt):h.lJ4(5,Yt)),h.R7$(2),h.JRh(i.getDayName(t[0].dt,!0)),h.R7$(2),h.Y8G("src",i.getWeatherIconUrl(e?t[0].weather[0].icon:t[4].weather[0].icon),h.B4B),h.R7$(3),h.SpI("",i.getTemperature(e?t[0].main.temp_max:t[4].main.temp_max),"°")}}function Ut(t,s){if(1&t&&(h.qex(0),h.j41(1,"div",20),h.DNE(2,Tt,2,2,"div",21),h.k0s(),h.j41(3,"div",22),h.DNE(4,Lt,9,6,"div",23),h.k0s(),h.bVm()),2&t){const t=h.XpG(2);h.R7$(2),h.Y8G("ngForOf",t.dayToShow)("ngForTrackBy",t.trackByFn),h.R7$(2),h.Y8G("ngForOf",t.sortedDays)("ngForTrackBy",t.trackByFn)}}function Nt(t,s){if(1&t&&(h.j41(0,"div",3)(1,"div",4),h.DNE(2,Et,2,1,"h2",5)(3,Mt,7,5,"div",6),h.k0s(),h.DNE(4,Ct,12,5,"div",7)(5,Ut,5,4,"ng-container",8),h.k0s()),2&t){const t=h.XpG();h.R7$(2),h.Y8G("ngIf",t.cityName),h.R7$(),h.Y8G("ngIf",t.dayHourToShow),h.R7$(),h.Y8G("ngIf",t.dayHourToShow),h.R7$(),h.Y8G("ngIf",!t.todayOnly)}}function Vt(t,s){1&t&&(h.j41(0,"div",30),h.nrm(1,"system-spinner"),h.k0s())}function Ot(t,s){1&t&&(h.j41(0,"div",31),h.EFF(1," Weather forecast is currently unavailable\n"),h.k0s())}let Ht=(()=>{class DashboardWeatherDashlet{constructor(t,s,e){this.http=t,this.language=s,this.metadata=e,this.sortedDays=void 0,this.cityName=void 0,this.daytoshow=void 0,this.dayHourToShow=void 0,this.todayOnly=!1,this.forecastCity="Vienna",this.apiId="ba76af382fdb47888b5a080d6c7122b5",this.isLoading=!1}get dayToShow(){return this.daytoshow}set dayToShow(t){this.daytoshow=t,this.dayHourToShow=8==t.length?t[4]:t[0]}get description(){if(this.dayHourToShow){let t=this.dayHourToShow.weather[0].description.split(" "),s=[];for(let e of t)s.push(e.replace(/\S/,(t=>t.toUpperCase())));return s.join(" ")}}ngOnInit(){let t=this.metadata.getComponentConfig("DashboardWeatherDashlet","Dashboards");t.hasOwnProperty("apiid")&&(this.apiId=t.apiid),t.hasOwnProperty("city")&&""!=t.city?this.getForecastData("q="+t.city):navigator.geolocation&&(this.isLoading=!0,navigator.geolocation.getCurrentPosition((t=>{let s=`lat=${t.coords.latitude}&lon=${t.coords.longitude}`;this.getForecastData(s)}),(t=>{t.code==t.PERMISSION_DENIED&&this.getForecastData("q="+this.forecastCity),this.isLoading=!1}))),this.todayOnly=!!t.hasOwnProperty("todayonly")&&t.todayonly}getForecastData(t){this.isLoading=!0,this.http.get(`https://api.openweathermap.org/data/2.5/forecast?${t}&APPID=${this.apiId}`).subscribe((t=>{t.city&&(this.cityName=t.city.name),t.list&&this.resortDays(t.list)})),this.isLoading=!1}resortDays(t){if(t){let s=[],e=[],i=t.sort(((t,s)=>t.dt-s.dt)),o=new Date(1e3*i[0].dt).getDay();for(let t of i){let i=new Date(1e3*t.dt).getDay();o==i||(o=i,s.push(e),e=[]),e.push(t)}this.sortedDays=s,this.dayToShow=s[0]}}setDayToShow(t){this.dayToShow=t}setDayHourToShow(t){this.dayHourToShow=t}getHour(t){return moment.unix(t).format("H")+":00"}getDayName(t,s=!1){let e=new Date(1e3*t).getDay();return s?moment.weekdaysShort(e):moment.weekdays(e)}getTemperature(t){return Math.round(parseInt(t,10)-273.15)}getWind(t){return Math.round(3.6*t.speed)}getWeatherIconUrl(t){return`https://openweathermap.org/img/w/${t}.png`}trackByFn(t,s){return t}static#t=this.ɵfac=function(t){return new(t||DashboardWeatherDashlet)(h.rXU(St.Qq),h.rXU(p.B),h.rXU(y.yu))};static#s=this.ɵcmp=h.VBU({type:DashboardWeatherDashlet,selectors:[["ng-component"]],decls:3,vars:3,consts:[["style","height: 100%",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%",4,"ngIf"],["class","slds-align--absolute-center slds-text-heading--small","style","height: 100%",4,"ngIf"],[2,"height","100%"],[1,"slds-p-around--x-small"],["class","slds-text-heading--medium",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","slds-grid slds-p-horizontal--x-small",4,"ngIf"],[4,"ngIf"],[1,"slds-text-heading--medium"],[3,"ngClass"],[1,"slds-text-body--regular"],["class","slds-p-left--x-small",4,"ngIf"],["class","slds-text-body--regular",4,"ngIf"],[1,"slds-p-left--x-small"],[1,"slds-grid","slds-p-horizontal--x-small"],[1,"slds-grid","slds-size--1-2","slds-grid--vertical-align-center"],["width","50px","height","50px",3,"src"],[1,"slds-text-heading--large","slds-grid","slds-grid--vertical-align-center"],[1,"slds-size--2-of-2","slds-p-left--medium"],[1,"slds-grid","slds-m-top--small","slds-m-bottom--xx-small","slds-p-horizontal--x-small","slds-p-vertical--small","slds-border--top","slds-border--bottom"],["class","slds-size--1-of-5 slds-text-body--small","style","cursor: pointer; max-width: 2.2rem",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid","slds-m-horizontal--xx-small"],["class","slds-size--1-of-5 slds-p-vertical--xx-small","style","cursor: pointer; max-width: 4.3rem",3,"ngStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-size--1-of-5","slds-text-body--small",2,"cursor","pointer","max-width","2.2rem",3,"ngClass","click"],[1,"slds-size--1-of-5","slds-p-vertical--xx-small",2,"cursor","pointer","max-width","4.3rem",3,"ngStyle","click"],[1,"slds-text-body--regular","slds-text-align--center"],[1,"slds-text-align--center"],[3,"src"],["c",""],[1,"slds-align--absolute-center",2,"height","100%"],[1,"slds-align--absolute-center","slds-text-heading--small",2,"height","100%"]],template:function(t,s){1&t&&h.DNE(0,Nt,6,4,"div",0)(1,Vt,2,0,"div",1)(2,Ot,2,0,"div",2),2&t&&(h.Y8G("ngIf",s.sortedDays&&s.sortedDays[0]),h.R7$(),h.Y8G("ngIf",s.isLoading&&!s.sortedDays),h.R7$(),h.Y8G("ngIf",!s.sortedDays&&!s.isLoading))},dependencies:[i.YU,i.Sq,i.bT,i.B3,S.P],encapsulation:2})}return DashboardWeatherDashlet})();var zt=e(18359),At=e(71692),Pt=e(40553),Wt=e(766),Kt=e(50859),qt=e(42205),Jt=e(87395),Qt=e(22465),Zt=e(92462),ts=e(15091);const ss=["dashboard-generic-dashlet-row",""];function es(t,s){if(1&t&&(h.qex(0),h.j41(1,"td",1),h.nrm(2,"field-container",2),h.k0s(),h.bVm()),2&t){const t=s.$implicit,e=h.XpG();h.R7$(),h.Y8G("ngClass",e.model.alert),h.BMQ("data-label",e.language.getFieldDisplayName(e.module,t.field)),h.R7$(),h.Y8G("field",t.field)("fieldconfig",t.fieldconfig)("fielddisplayclass","slds-truncate")}}let is=(()=>{class DashboardGenericDashletRow{constructor(t,s,e,i,o){this.language=t,this.metadata=s,this.model=e,this.view=i,this.modelutilities=o,this.fieldsetfields=[],this.module="",this.fieldset="",this.data={},this.view.isEditable=!1,this.view.displayLabels=!1}ngOnInit(){this.model.module=this.module,this.model.id=this.data.id,this.model.setData(this.data),this.fieldsetfields=this.metadata.getFieldSetFields(this.fieldset),this.model.evaluateValidationRules(null,"initialize"),this.model.initializeFieldsAlertStyles(this.data)}trackByFn(t,s){return s.id}static#t=this.ɵfac=function(t){return new(t||DashboardGenericDashletRow)(h.rXU(p.B),h.rXU(y.yu),h.rXU(l.g),h.rXU(g.U),h.rXU(Zt.g))};static#s=this.ɵcmp=h.VBU({type:DashboardGenericDashletRow,selectors:[["","dashboard-generic-dashlet-row",""]],inputs:{module:"module",fieldset:"fieldset",data:"data"},features:[h.Jv_([l.g,g.U])],attrs:ss,decls:1,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[2,"min-width","8rem","display","table-cell",3,"ngClass"],[3,"field","fieldconfig","fielddisplayclass"]],template:function(t,s){1&t&&h.DNE(0,es,3,5,"ng-container",0),2&t&&h.Y8G("ngForOf",s.fieldsetfields)("ngForTrackBy",s.trackByFn)},dependencies:[i.YU,i.Sq,ts.y],encapsulation:2})}return DashboardGenericDashletRow})();function os(t,s){if(1&t){const t=h.RV6();h.qex(0),h.j41(1,"a",21),h.bIt("click",(function(){h.eBV(t);const s=h.XpG().$implicit,e=h.XpG(2);return h.Njj(e.setSortField(s))})),h.nrm(2,"field-label",22)(3,"system-utility-icon",23),h.k0s(),h.bVm()}if(2&t){const t=h.XpG().$implicit;h.R7$(2),h.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}function as(t,s){if(1&t&&h.nrm(0,"field-label",24),2&t){const t=h.XpG().$implicit;h.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}const ns=(t,s,e,i)=>({"slds-is-sortable":t,"slds-is-sorted":s,"slds-is-sorted_desc":e,"slds-is-sorted_asc":i});function ds(t,s){if(1&t&&(h.j41(0,"th",17)(1,"div",18),h.DNE(2,os,4,2,"ng-container",19)(3,as,1,2,"ng-template",null,20,h.C5r),h.k0s()()),2&t){const t=s.$implicit,e=h.sdS(4),i=h.XpG(2);h.Y8G("ngClass",h.ziG(3,ns,null==t.fieldconfig?null:t.fieldconfig.sortable,t.field==i.sortparams.sortfield,"DESC"==i.sortparams.sortdirection,"ASC"==i.sortparams.sortdirection)),h.R7$(2),h.Y8G("ngIf",null==t.fieldconfig?null:t.fieldconfig.sortable)("ngIfElse",e)}}function ls(t,s){if(1&t&&(h.j41(0,"thead")(1,"tr",15),h.DNE(2,ds,5,8,"th",16),h.k0s()()),2&t){const t=h.XpG();h.R7$(2),h.Y8G("ngForOf",t.dashletFields)("ngForTrackBy",t.trackByFn)}}function rs(t,s){if(1&t&&(h.qex(0),h.j41(1,"div",25),h.EFF(2),h.k0s(),h.nrm(3,"tr",26),h.bVm()),2&t){const t=s.$implicit,e=h.XpG();h.R7$(2),h.SpI(" ",t.summary_text," "),h.R7$(),h.Y8G("module",e.dashletModule)("fieldset",e.dashletFieldSet)("data",t)}}function hs(t,s){if(1&t&&h.nrm(0,"tbody",27),2&t){const t=h.XpG();h.Y8G("columns",null==t.dashletFields?null:t.dashletFields.length)("select",!1)("tools",!1)("rows",5)}}function cs(t,s){1&t&&(h.j41(0,"div",28)(1,"system-illustration-no-records"),h.nrm(2,"system-label",29),h.k0s()())}function us(t,s){1&t&&(h.j41(0,"div",28)(1,"system-illustration-page-not-available"),h.nrm(2,"system-label",30),h.k0s()())}let ms=(()=>{class DashboardGenericDashlet{constructor(t,s,e,i,o,a){this.language=t,this.metadata=s,this.backend=e,this.model=i,this.layout=o,this.broadcast=a,this.dashletFields=[],this.loading=!0,this.failedToLoad=!1,this.records=[],this.recordCount=0,this.recordTotal=0,this.sortparams={sortdirection:"",sortfield:""},this.dashletconfig=null,this.subscriptions=new zt.yU}ngOnInit(){this.subscribeToBroadcast(),this.setInitialValues(),this.loadRecords()}ngOnDestroy(){this.subscriptions.unsubscribe()}onScroll(t){t.scrollTop+t.clientHeight>=t.scrollHeight-5&&this.loadMore()}trackByFn(t,s){return s.id}subscribeToBroadcast(){this.subscriptions.add(this.broadcast.message$.subscribe((t=>{if(t.messagedata.module===this.dashletModule)switch(t.messagetype){case"model.delete":const s=this.records.findIndex((s=>s.id==t.messagedata.id));s>=0&&(this.records.splice(s,1),this.recordCount--,this.recordTotal--);break;case"model.save":this.records.findIndex((s=>s.id==t.messagedata.id))>=0&&(this.records=[],this.loadRecords())}})))}setInitialValues(){this.model.module=this.dashletModule,this.sortparams.sortfield=this.dashletconfig.sortfield,this.sortparams.sortdirection=this.dashletconfig.sortdirection,this.dashletconfig.fieldset&&(this.dashletFields=this.metadata.getFieldSetFields(this.dashletconfig.fieldset),this.dashletFieldSet=this.dashletconfig.fieldset)}loadRecords(){this.records=[],this.loading=!0;const t={limit:isNaN(this.dashletconfig?.limit)?50:this.dashletconfig.limit,resolvelinks:!isNaN(this.dashletconfig?.resolvelinks)&&this.dashletconfig.resolvelinks,modulefilter:this.dashletconfig.modulefilter,sortfields:[{sortfield:this.sortparams.sortfield,sortdirection:this.sortparams.sortdirection}]};this.dashletModule&&this.backend.getRequest("module/"+this.dashletModule,t).subscribe((t=>{this.records=t.list,this.recordCount=+t.list.length,this.recordTotal=t.totalcount,this.loading=!1,this.failedToLoad=!1}),(()=>{this.loading=!1,this.failedToLoad=!0}))}loadMore(){if(!(this.recordTotal>this.records.length)||this.loading)return;this.loading=!0;const t={limit:isNaN(this.dashletconfig?.limit)?50:this.dashletconfig.limit,resolvelinks:!isNaN(this.dashletconfig?.resolvelinks)&&this.dashletconfig.resolvelinks,offset:this.records.length,modulefilter:this.dashletconfig?.modulefilter,sortfields:[{sortfield:this.sortparams.sortfield,sortdirection:this.sortparams.sortdirection}]};this.backend.getRequest("module/"+this.dashletModule,t).subscribe((t=>{this.records=this.records.concat(t.list),this.recordCount+=+t.list.length,this.loading=!1,this.failedToLoad=!1}),(()=>{this.loading=!1,this.failedToLoad=!0}))}isSortable(t){return!0===t.fieldconfig?.sortable}setSortField(t){this.isSortable(t)&&(this.sortparams.sortfield&&this.sortparams.sortfield==t.field?"ASC"==this.sortparams.sortdirection?this.sortparams.sortdirection="DESC":(this.sortparams.sortfield="",this.sortparams.sortdirection=""):(this.sortparams.sortfield=t.field,this.sortparams.sortdirection="ASC"),this.loadRecords())}static#t=this.ɵfac=function(t){return new(t||DashboardGenericDashlet)(h.rXU(p.B),h.rXU(y.yu),h.rXU(c.H),h.rXU(l.g),h.rXU(At.Z),h.rXU(Pt.m))};static#s=this.ɵcmp=h.VBU({type:DashboardGenericDashlet,selectors:[["dashboard-generic-dashlet"]],features:[h.Jv_([l.g,g.U])],decls:19,vars:11,consts:[[1,"slds-grid","slds-grid--vertical","slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["size","small",3,"module"],[1,"slds-truncate","slds-grow","slds-text-heading--medium","slds-p-bottom--xx-small"],[3,"label"],["label","LBL_OF"],["system-title","LBL_RELOAD",1,"slds-button","slds-button--icon","slds-button--icon-border","slds-m-horizontal--xxx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-scrollable--y","slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0",3,"scroll"],["tableContainer",""],[1,"slds-table","slds-table--bordered","slds-table--fixed-layout","slds-max-medium-table--stacked-horizontal","slds-table--header-fixed"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["system-table-stencils","",3,"columns","select","tools","rows",4,"ngIf"],["class","slds-align_absolute-center slds-grow","style","min-height: 0",4,"ngIf"],[1,"slds-text-title_caps"],["scope","col","system-resize","","class","slds-resizable",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["scope","col","system-resize","",1,"slds-resizable",3,"ngClass"],[1,"slds-truncate"],[4,"ngIf","ngIfElse"],["nosort",""],["href","javascript:void(0);",1,"slds-th__action","slds-text-link--reset",3,"click"],["addclasses","slds-truncate",1,"slds-truncate",3,"fieldname","fieldconfig"],["icon","arrowdown","addclasses","slds-is-sortable__icon","size","x-small"],["addclasses","slds-truncate slds-p-vertical--xx-small slds-p-horizontal--x-small",3,"fieldname","fieldconfig"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small","slds-hide--medium","slds-text-title_bold"],["dashboard-generic-dashlet-row","",3,"module","fieldset","data"],["system-table-stencils","",3,"columns","select","tools","rows"],[1,"slds-align_absolute-center","slds-grow",2,"min-height","0"],["label","MSG_NO_RECORDS_FOUND"],["label","ERR_LOADING_RECORDS"]],template:function(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",0)(1,"div",1),h.nrm(2,"system-icon",2),h.j41(3,"h2",3),h.nrm(4,"system-label",4),h.EFF(5),h.nrm(6,"system-label",5),h.EFF(7),h.k0s(),h.j41(8,"button",6),h.bIt("click",(function(){return s.loadRecords()})),h.nrm(9,"system-button-icon",7),h.k0s()(),h.j41(10,"div",8,9),h.bIt("scroll",(function(){h.eBV(t);const e=h.sdS(11);return h.Njj(s.onScroll(e))})),h.j41(12,"table",10),h.DNE(13,ls,3,2,"thead",11),h.j41(14,"tbody"),h.DNE(15,rs,4,4,"ng-container",12),h.k0s(),h.DNE(16,hs,1,4,"tbody",13),h.k0s(),h.DNE(17,cs,3,0,"div",14)(18,us,3,0,"div",14),h.k0s()()}2&t&&(h.R7$(2),h.Y8G("module",s.dashletModule),h.R7$(2),h.Y8G("label",s.dashletLabel),h.R7$(),h.SpI(" (",s.recordCount," "),h.R7$(2),h.SpI(" ",s.recordTotal,")"),h.R7$(),h.Y8G("disabled",s.loading),h.R7$(5),h.Y8G("ngIf","small"!=s.layout.screenwidth),h.R7$(2),h.Y8G("ngForOf",s.records)("ngForTrackBy",s.trackByFn),h.R7$(),h.Y8G("ngIf",s.loading),h.R7$(),h.Y8G("ngIf",!s.loading&&0==s.records.length&&!s.failedToLoad),h.R7$(),h.Y8G("ngIf",!s.loading&&s.failedToLoad))},dependencies:[i.YU,i.Sq,i.bT,Wt.b,k.t,bt.J,U.b,Kt.L,x.W,qt.t,N.B,Jt.T,Qt.L,is],encapsulation:2})}return DashboardGenericDashlet})();var gs=e(18396);const bs=t=>({"slds-text-color_error":t});function ps(t,s){if(1&t){const t=h.RV6();h.j41(0,"div",5)(1,"div",6)(2,"div",7),h.nrm(3,"system-icon",8),h.k0s(),h.j41(4,"div",9)(5,"div",10),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG();return h.Njj(e.goRecord(s.module_name,s.item_id))})),h.EFF(6),h.k0s(),h.j41(7,"div",11),h.EFF(8),h.k0s()()(),h.j41(9,"system-utility-icon",12),h.bIt("click",(function(){const s=h.eBV(t).$implicit,e=h.XpG();return h.Njj(e.deleteRecord(s.module_name,s.item_id))})),h.k0s()()}if(2&t){const t=s.$implicit,e=h.XpG();h.R7$(3),h.Y8G("module",t.module_name)("size","small"),h.R7$(3),h.JRh(t.item_summary),h.R7$(),h.Y8G("ngClass",h.eq3(7,bs,e.isOverdue(t.reminder_date))),h.R7$(),h.JRh(e.getReminderDate(t.reminder_date)),h.R7$(),h.Y8G("icon","delete")("size","x-small")}}let fs=(()=>{class DashboardRemindersDashlet{constructor(t,s,e,i){this.language=t,this.metadata=s,this.reminder=e,this.router=i,this.dashletLabel=void 0}get recordcount(){return this.reminder.reminders.length}get dashletTitle(){return this.language.getLabel(this.dashletLabel)}get reminders(){return this.reminder.reminders.map((t=>(t.reminder_date=new moment(t.reminder_date),t))).sort(((t,s)=>t.reminder_date-s.reminder_date))}trackByFn(t,s){return s.item_id}goRecord(t,s){this.router.navigate(["/module/"+t+"/"+s])}deleteRecord(t,s){this.reminder.deleteReminder(t,s)}getReminderDate(t){return t.format("DD.MM.YYYY")}isOverdue(t){return t<new moment}static#t=this.ɵfac=function(t){return new(t||DashboardRemindersDashlet)(h.rXU(p.B),h.rXU(y.yu),h.rXU(gs.z),h.rXU(lt.Ix))};static#s=this.ɵcmp=h.VBU({type:DashboardRemindersDashlet,selectors:[["dashboard-reminders-dashlet"]],decls:6,vars:7,consts:[[2,"height","100%","overflow","hidden"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],[3,"icon","sprite","size"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],["class","slds-p-around--x-small slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-p-around--x-small","slds-grid"],[1,"slds-media"],[1,"slds-media__figure"],[3,"module","size"],[1,"slds-media__body"],[1,"slds-text-title_caps","slds-text-link_reset",3,"click"],[1,"slds-text-body_small","slds-line-height_reset",3,"ngClass"],[1,"slds-col_bump-left",2,"cursor","pointer",3,"icon","size","click"]],template:function(t,s){1&t&&(h.j41(0,"div",0)(1,"div",1),h.nrm(2,"system-icon",2),h.j41(3,"h2",3),h.EFF(4),h.k0s()(),h.DNE(5,ps,10,9,"div",4),h.k0s()),2&t&&(h.R7$(2),h.Y8G("icon","clock")("sprite","utility")("size","small"),h.R7$(2),h.Lme("",s.dashletTitle," (",s.recordcount,")"),h.R7$(),h.Y8G("ngForOf",s.reminders)("ngForTrackBy",s.trackByFn))},dependencies:[i.YU,i.Sq,bt.J,N.B],encapsulation:2})}return DashboardRemindersDashlet})();const ys=["componentcontainer"];let vs=(()=>{class DashboardComponentset{constructor(t){this.metadata=t,this.componentRefs=[]}ngAfterViewInit(){this.renderComnponentset()}ngOnDestroy(){for(let t of this.componentRefs)t.destroy()}renderComnponentset(){if(this.dashletconfig&&this.dashletconfig.componentset)for(let t of this.metadata.getComponentSetObjects(this.dashletconfig.componentset))this.metadata.addComponent(t.component,this.componentcontainer).subscribe((s=>{s.instance.componentconfig=t.componentconfig,this.componentRefs.push(s)}))}static#t=this.ɵfac=function(t){return new(t||DashboardComponentset)(h.rXU(y.yu))};static#s=this.ɵcmp=h.VBU({type:DashboardComponentset,selectors:[["dashboard-componentset"]],viewQuery:function(t,s){if(1&t&&h.GBs(ys,7,h.c1b),2&t){let t;h.mGM(t=h.lsd())&&(s.componentcontainer=t.first)}},decls:2,vars:0,consts:[["componentcontainer",""]],template:function(t,s){1&t&&h.nrm(0,"div",null,0)},encapsulation:2})}return DashboardComponentset})(),ks=(()=>{class ModuleDashboard{static#t=this.ɵfac=function(t){return new(t||ModuleDashboard)};static#s=this.ɵmod=h.$C({type:ModuleDashboard});static#e=this.ɵinj=h.G2t({imports:[i.MD,o.YN,n.ObjectFields,d.SystemComponents,a.h]})}return ModuleDashboard})();("undefined"==typeof ngJitMode||ngJitMode)&&h.Obh(ks,{declarations:[dt,F,ct,Y,gt,it,W,xt,Ht,ms,is,fs,vs,R],imports:[i.MD,o.YN,n.ObjectFields,d.SystemComponents,a.h],exports:[ct]})}}]);