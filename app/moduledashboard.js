/*!
 * 
 *                     aacService
 *
 *                     release: 2022.02.001
 *
 *                     date: 2022-09-03 11:05:02
 *
 *                     build: 2022.02.001.1662195902704
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_dashboard_moduledashboard_ts"],{4023:(t,e,s)=>{s.r(e),s.d(e,{ModuleDashboard:()=>we});var i=s(6895),o=s(433),a=s(4357),d=s(3121),n=s(5478),l=s(5710),r=s(2644),h=s(1571),c=s(4505),u=s(4044);let g=(()=>{class dashboardlayout{constructor(t,e,s){this.backend=t,this.model=e,this.modal=s,this.dashboardData={},this.dashboardGrid=[],this.dashboardId="",this.dashboardElements=[],this.boxMargin=5,this.columns=9,this.editmode=!1,this.editing="",this.isMoving=!1,this.isloading=!1,this.dashboardNotFound=!1}get bodyContainerRef(){return this.bodycontainerref.element.nativeElement}set bodyContainerRef(t){this.bodycontainerref=t}get editMode(){return this.editmode}set editMode(t){this.editmode=t,this.editmode&&setTimeout((()=>this.calculateGrid()),100)}get elementHeight(){return this.bodyContainerRef?this.bodyContainerRef.clientHeight/this.columns:100}get elementWidth(){return this.bodyContainerRef?this.bodyContainerRef.clientWidth/this.columns:100}get compactView(){return this.bodyContainerRef.clientWidth<768}calculateGrid(){if(!this.bodyContainerRef)return;this.dashboardGrid=[];let t=0,e=this.columns;for(let t of this.dashboardElements){let s=t.position.top+t.position.height;this.bodyContainerRef.clientHeight&&s>this.columns&&(e=s>e?s:e)}for(;t<e;){let e=0,s=[];for(;e<this.columns;)s.push({width:this.bodyContainerRef.clientWidth/this.columns-2*this.boxMargin,height:this.elementHeight-2*this.boxMargin,top:t*this.elementHeight+this.boxMargin,left:e*this.bodyContainerRef.clientWidth/this.columns+this.boxMargin}),e++;this.dashboardGrid.push(s),t++}this.dashboardGrid=this.dashboardGrid.slice()}getElementStyle(t,e,s,i){let o={};return o.top=t*this.elementHeight+this.boxMargin,o.left=e*this.elementWidth+this.boxMargin,o.width=this.compactView?"100%":s*this.elementWidth-2*this.boxMargin,o.height=i*this.elementHeight-2*this.boxMargin,o}dropElement(t,e,s,i,o){this.dashboardElements.some((a=>{if(a.id===t){let d=Math.round(e/this.elementWidth),n=Math.round(s/this.elementHeight);const l=this.canDrop(t,a,e,s,o,i);switch(i){case"content":l.left&&(a.position.left+=d),l.top&&(a.position.top+=n);break;case"left":l.left&&(a.position.width-=d,a.position.left+=d);break;case"right":l.left&&(a.position.width+=d);break;case"top":l.top&&(a.position.height-=n,a.position.top+=n);break;case"bottom":l.top&&(a.position.height+=n)}return window.dispatchEvent(new Event("resize")),!0}})),setTimeout((()=>this.calculateGrid()),100)}canDrop(t,e,s,i,o,a){let d=!0,n=!0,l=Math.round(s/this.elementWidth),r=Math.round(i/this.elementHeight),h=e.position.left,c=e.position.left+(e.position.width-1),u=e.position.top,g=e.position.top+(e.position.height-1),m=h,p=e.position.width,b=c,f=u,y=e.position.height,x=g;switch(a){case"content":x=g+r,b=c+l,m=h+l,f=u+r;break;case"left":p+=l,m=h+l;break;case"right":p+=l,b=c+l;break;case"top":y+=r,f=u+r;break;case"bottom":y+=r,x=g+r}for(let e of this.dashboardElements){let s=e.position.left,i=e.position.left+(e.position.width-1),o=e.position.top,l=e.position.top+(e.position.height-1),r=m>=s&&m<=i,h=b<=i&&b>=s,c=f>=o&&f<=l,u=x<=l&&x>=o,g=(h||r)&&(c||u)&&e.id!=t,p=(c||u)&&(r||h)&&e.id!=t,y=m<0||b>this.columns-1,w=f<0,v=f<o&&x>l&&m<=i&&b>=s&&e.id!=t,Z=b>i&&m<s&&f<=l&&x>=o&&e.id!=t;switch(a){case"content":(g||p||Z||v||y||w)&&(d=!1,n=!1);break;case"left":(g||Z||y||m>b)&&(d=!1);break;case"right":(g||Z||y||b<m)&&(d=!1);break;case"top":(p||v||w||f>x)&&(n=!1);break;case"bottom":(p||v||w||x<f)&&(n=!1)}}return{top:n,left:d}}applyMove(t,e,s,i){let o=t,a=this.bodyContainerRef,d=a.right-a.x,n=this.boxMargin,l=this.elementWidth-2*n,r=this.elementHeight-2*n,h=0,c=0;if(i&&s&&(h=i.pageX-s.pageX,c=i.pageY-s.pageY),s)switch(e){case"content":o.left=o.left+h,o.top=o.top+c,o.left<n&&(o.left=n),o.top<n&&(o.top=n),o.left+o.width>d&&(o.left=d-o.width-n);break;case"right":o.width=o.width+h,o.left+o.width>d&&(o.width=d-o.left-n,o.left=d-o.width-n),o.width<l&&(o.width=l);break;case"left":let t=o.width+o.left;o.width=o.width-h,o.left=o.left+h,o.left<n&&(o.left=n,o.width=t-n),o.width<l&&(o.width=l,o.left=t-o.width);break;case"bottom":o.height=o.height+c,o.height<r&&(o.height=r);break;case"top":let e=o.height+o.top;o.height=o.height-c,o.top=o.top+c,o.top<n&&(o.top=n,o.height=e-n),o.height<r&&(o.height=r,o.top=e-o.height)}return o}addDashlet(t){this.modal.openModal("DashboardAddElement").subscribe((e=>{e.instance.addDashlet.subscribe((e=>{if(!1!==e){this.editing=this.model.generateGuid();let s={id:this.editing,name:e.name,component:e.component,componentconfig:e.componentconfig,dashletconfig:e.dashletconfig,dashlet_id:e.dashlet_id,module:e.module,icon:e.icon,acl_action:e.acl_action,label:e.label,sysuidashboard_id:this.dashboardId,position:{top:Math.round(t.top/this.elementHeight),left:Math.round(t.left/this.elementWidth),width:Math.round(t.width/this.elementWidth),height:Math.round(t.height/this.elementHeight)},is_new:!0};this.dashboardElements=[...this.dashboardElements,s]}}))}))}deleteDashlet(t){this.dashboardElements.some(((e,s)=>{if(e.id===t)return this.dashboardElements.splice(s,1),!0}))}prepareStyle(t){let e=_.clone(t);for(let t in e)e.hasOwnProperty(t)&&"number"==typeof e[t]&&(e[t]=Math.round(e[t])+"px");return e}sortElements(){this.dashboardElements=this.dashboardElements.sort(((t,e)=>t.position.top==e.position.top?t.position.left>e.position.left?1:-1:t.position.top>e.position.top?1:-1))}}return dashboardlayout.ɵfac=function(t){return new(t||dashboardlayout)(h.LFG(c.y),h.LFG(l.o),h.LFG(u.o))},dashboardlayout.ɵprov=h.Yz7({token:dashboardlayout,factory:dashboardlayout.ɵfac}),dashboardlayout})();var m=s(2294),p=s(2032),b=s(5329),f=s(2422),y=s(1058),x=s(4154),w=s(2656),v=s(3333),Z=s(4021);let D=(()=>{class DashboardSelectPanelAddButton{constructor(t,e,s){this.model=t,this.modellist=e,this.dashboardlayout=s,this.dashboardAdded=new h.vpe,this.model.module="Dashboards"}addDashboard(){this.model.reset(),this.model.module="Dashboards",this.model.addModel().subscribe((t=>{t&&(this.modellist.listData.list.push(t),this.dashboardAdded.emit({id:t.id}))}))}}return DashboardSelectPanelAddButton.ɵfac=function(t){return new(t||DashboardSelectPanelAddButton)(h.Y36(l.o),h.Y36(r.t),h.Y36(g))},DashboardSelectPanelAddButton.ɵcmp=h.Xpm({type:DashboardSelectPanelAddButton,selectors:[["dashboard-select-panel-add-button"]],outputs:{dashboardAdded:"dashboardAdded"},features:[h._Bn([l.o])],decls:2,vars:1,consts:[[1,"slds-show--large","slds-button","slds-button_icon","slds-button_icon-border",3,"click"],[3,"icon"]],template:function(t,e){1&t&&(h.TgZ(0,"button",0),h.NdJ("click",(function(){return e.addDashboard()})),h._UZ(1,"system-button-icon",1),h.qZA()),2&t&&(h.xp6(1),h.Q6J("icon","add"))},dependencies:[w.J],encapsulation:2}),DashboardSelectPanelAddButton})();function T(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"dashboard-select-panel-add-button",13),h.NdJ("dashboardAdded",(function(e){h.CHM(t);const s=h.oxw();return h.KtG(s.setDashboard(e))})),h.qZA()}}function k(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"li",14),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw();return h.KtG(s.setDashboard(e))})),h.TgZ(1,"div",15),h._uU(2),h.qZA()()}if(2&t){const t=e.$implicit,s=h.oxw();h.Q6J("ngClass",s.getActiveClass(t.id)),h.xp6(2),h.Oqu(t.name)}}let M=(()=>{class DashboardSelectPanel{constructor(t,e,s,i,o,a,d,n){this.vcr=t,this.metadata=e,this.userpreferences=s,this.language=i,this.model=o,this.modellist=a,this.dashboardlayout=d,this.cfr=n,this.dashboardFilter="",this.hide=new h.vpe,this.dashboardSelect=new h.vpe}get dashboards(){let t=[];for(let e of this.modellist.listData.list)(e.id==this.dashboardlayout.dashboardId||""==this.dashboardFilter||""!=this.dashboardFilter&&-1!=e.name.toLowerCase().indexOf(this.dashboardFilter.toLowerCase()))&&t.push(e);return t}get canAdd(){return this.metadata.checkModuleAcl("Dashboards","create")}getActiveClass(t){return t==this.dashboardlayout.dashboardId?"slds-is-active":""}setDashboard(t){this.userpreferences.setPreference("last_dashboard",t.id),this.dashboardSelect.emit(t.id),this.hidepanel()}hidepanel(){this.hide.emit(!0)}trackByFn(t,e){return e.id}}return DashboardSelectPanel.ɵfac=function(t){return new(t||DashboardSelectPanel)(h.Y36(h.s_b),h.Y36(x.Pu),h.Y36(f.z),h.Y36(b.d),h.Y36(l.o),h.Y36(r.t),h.Y36(g),h.Y36(h._Vd))},DashboardSelectPanel.ɵcmp=h.Xpm({type:DashboardSelectPanel,selectors:[["dashboard-select-panel"]],outputs:{hide:"hide",dashboardSelect:"dashboardSelect"},features:[h._Bn([l.o])],decls:13,vars:6,consts:[["aria-label","Sub page",1,"slds-nav-vertical"],[1,"slds-nav-vertical__section"],[1,"slds-grid","slds-grid_align-spread","slds-grid--vertical-align-center","slds-p-horizontal--small","slds-p-vertical--x-small"],["id","entity-header",1,"slds-text-heading--small"],["module","Dashboards"],[3,"dashboardAdded",4,"ngIf"],[1,"slds-hide--large","slds-button","slds-button_icon",3,"click"],[3,"icon"],[1,"slds-form-element","slds-p-horizontal--small","slds-p-vertical--x-small"],[1,"slds-form-element__control"],["type","text",1,"slds-input",3,"ngModel","ngModelChange"],["system-to-bottom","",1,"spice-scrollbar",3,"system-overlay-loading-spinner"],["class","slds-nav-vertical__item",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"dashboardAdded"],[1,"slds-nav-vertical__item",3,"ngClass","click"],[1,"slds-nav-vertical__action","slds-text-link_reset"]],template:function(t,e){1&t&&(h.TgZ(0,"nav",0)(1,"div",1)(2,"div",2)(3,"h2",3),h._UZ(4,"system-label-modulename",4),h.qZA(),h.YNc(5,T,1,0,"dashboard-select-panel-add-button",5),h.TgZ(6,"button",6),h.NdJ("click",(function(){return e.hidepanel()})),h._UZ(7,"system-button-icon",7),h.qZA()(),h.TgZ(8,"div",8)(9,"div",9)(10,"input",10),h.NdJ("ngModelChange",(function(t){return e.dashboardFilter=t})),h.qZA()()(),h.TgZ(11,"ul",11),h.YNc(12,k,3,2,"li",12),h.qZA()()()),2&t&&(h.xp6(5),h.Q6J("ngIf",e.canAdd),h.xp6(2),h.Q6J("icon","close"),h.xp6(3),h.Q6J("ngModel",e.dashboardFilter),h.xp6(1),h.Q6J("system-overlay-loading-spinner",e.modellist.isLoading),h.xp6(1),h.Q6J("ngForOf",e.dashboards)("ngForTrackBy",e.trackByFn))},dependencies:[i.mk,i.sg,i.O5,o.Fj,o.JJ,o.On,w.J,v.M,y.H,Z._,D],encapsulation:2}),DashboardSelectPanel})();var A=s(3463),C=s(4664);function J(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",8)(1,"button",9),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.showpanel())})),h._UZ(2,"system-button-icon",10),h.qZA()()}}function F(t,e){1&t&&h._UZ(0,"system-spinner",11)}function S(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.editModal())})),h._UZ(1,"system-button-icon",13),h.qZA()}}function Y(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.deleteDashboard())})),h._UZ(1,"system-button-icon",14),h.qZA()}}function N(t,e){1&t&&h._UZ(0,"system-button-icon",21)}function E(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"button",16),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw(2);return h.KtG(e.toggleEditContent())})),h._UZ(1,"system-label",22),h.qZA()}}function I(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",15)(1,"button",16),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.toggleHomeDashboard())})),h.YNc(2,N,1,0,"system-button-icon",17),h.TgZ(3,"span",18),h._UZ(4,"system-label",19),h.qZA()(),h.YNc(5,E,2,0,"button",20),h.qZA()}if(2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngIf",t.isHomeDashboard),h.xp6(3),h.Q6J("ngIf",t.editable&&!t.view.isEditMode())}}function q(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",15)(1,"button",16),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.cancel())})),h._UZ(2,"system-label",23),h.qZA(),h.TgZ(3,"button",24),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.saveComponents())})),h._UZ(4,"system-label",25),h.qZA()()}}let Q=(()=>{class DashboardContainerHeader{constructor(t,e,s,i,o,a,d,n){this.dashboardlayout=t,this.language=e,this.userpreferences=s,this.metadata=i,this.modal=o,this.backend=a,this.view=d,this.model=n,this.showdashboardselector=!1,this.showselect=new h.vpe}get deletable(){return this.metadata.checkModuleAcl(this.model.module,"delete")}get editable(){return this.metadata.checkModuleAcl(this.model.module,"edit")}get isHomeDashboard(){return this.userpreferences.toUse.home_dashboard==this.model.id}toggleEditContent(){this.view.isEditMode()?this.cancel():(this.dashboardlayout.dashboardElements=JSON.parse(JSON.stringify(this.dashboardlayout.dashboardElements)),this.view.setEditMode(),this.model.startEdit(),this.dashboardlayout.calculateGrid())}toggleHomeDashboard(){this.userpreferences.setPreference("home_dashboard",this.isHomeDashboard?"":this.model.id,!0)}editModal(){this.model.edit()}deleteDashboard(){this.modal.confirmDeleteRecord().subscribe((t=>{t&&this.model.delete().subscribe((()=>{this.dashboardlayout.dashboardId=void 0,this.model.reset(),this.model.module="Dashboards"}))}))}showpanel(){this.showselect.emit(!0)}saveComponents(){this.backend.postRequest("module/Dashboards/"+this.model.id+"/components",{},this.dashboardlayout.dashboardElements).subscribe((()=>{this.view.setViewMode(),this.model.endEdit()}))}cancel(){this.view.setViewMode(),this.model.cancelEdit(),this.dashboardlayout.dashboardElements=this.model.getField("components")}}return DashboardContainerHeader.ɵfac=function(t){return new(t||DashboardContainerHeader)(h.Y36(g),h.Y36(b.d),h.Y36(f.z),h.Y36(x.Pu),h.Y36(u.o),h.Y36(c.y),h.Y36(m.e),h.Y36(l.o))},DashboardContainerHeader.ɵcmp=h.Xpm({type:DashboardContainerHeader,selectors:[["dashboard-container-header"]],inputs:{showdashboardselector:"showdashboardselector"},outputs:{showselect:"showselect"},decls:11,vars:7,consts:[[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--small"],["class","slds-p-right--small",4,"ngIf"],[1,"slds-col","slds-has-flexi-truncate","slds-grid","slds-grid--vertical-align-center"],["size","16","class","slds-p-right--small",4,"ngIf"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],["class","slds-button slds-show--large",3,"click",4,"ngIf"],[1,"slds-col","slds-no-flex","slds-grid","slds-align-top","slds-show--large"],["class","slds-button-group","role","group",4,"ngIf"],[1,"slds-p-right--small"],[1,"slds-button","slds-button--icon",3,"click"],["icon","rows"],["size","16",1,"slds-p-right--small"],[1,"slds-button","slds-show--large",3,"click"],["icon","edit"],["icon","delete"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["class","slds-m-right--xx-small","icon","check",4,"ngIf"],[1,"slds-truncate"],["label","LBL_AS_HOME_DASHBOARD"],["class","slds-button slds-button--neutral",3,"click",4,"ngIf"],["icon","check",1,"slds-m-right--xx-small"],["label","LBL_EDIT"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0),h.YNc(1,J,3,0,"div",1),h.TgZ(2,"div",2),h.YNc(3,F,1,0,"system-spinner",3),h.TgZ(4,"h1",4),h._uU(5),h.qZA(),h.YNc(6,S,2,0,"button",5),h.YNc(7,Y,2,0,"button",5),h.qZA(),h.TgZ(8,"div",6),h.YNc(9,I,6,2,"div",7),h.YNc(10,q,5,0,"div",7),h.qZA()()),2&t&&(h.xp6(1),h.Q6J("ngIf",e.showdashboardselector),h.xp6(2),h.Q6J("ngIf",e.dashboardlayout.isloading),h.xp6(2),h.hij(" ",e.model.data.name," "),h.xp6(1),h.Q6J("ngIf",e.editable&&e.model.id),h.xp6(1),h.Q6J("ngIf",e.deletable&&e.model.id),h.xp6(2),h.Q6J("ngIf",!e.dashboardlayout.isloading&&e.model.id),h.xp6(1),h.Q6J("ngIf",e.view.isEditMode()))},dependencies:[i.O5,w.J,A._,C.W],encapsulation:2}),DashboardContainerHeader})();var L=s(4567),H=s(4730),B=s(8859);const U=["containerelement"];function O(t,e){1&t&&h._UZ(0,"div",null,5)}function R(t,e){1&t&&(h.TgZ(0,"div",6),h._UZ(1,"system-illustration-no-access"),h.qZA())}function G(t,e){1&t&&h._UZ(0,"div",7)}function z(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",10)(1,"system-utility-icon",11),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw(2);return h.KtG(e.dashboardlayout.deleteDashlet(e.item.id))})),h.qZA()()}2&t&&(h.xp6(1),h.Q6J("icon","close")("size","xx-small"))}function K(t,e){if(1&t){const t=h.EpF();h.ynx(0),h.YNc(1,z,2,2,"div",8),h.TgZ(2,"div",9),h.NdJ("mousedown",(function(e){h.CHM(t);const s=h.oxw();return h.KtG(s.onMousedown("top",e))})),h.qZA(),h.TgZ(3,"div",9),h.NdJ("mousedown",(function(e){h.CHM(t);const s=h.oxw();return h.KtG(s.onMousedown("right",e))})),h.qZA(),h.TgZ(4,"div",9),h.NdJ("mousedown",(function(e){h.CHM(t);const s=h.oxw();return h.KtG(s.onMousedown("bottom",e))})),h.qZA(),h.TgZ(5,"div",9),h.NdJ("mousedown",(function(e){h.CHM(t);const s=h.oxw();return h.KtG(s.onMousedown("left",e))})),h.qZA(),h.BQk()}if(2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngIf",t.isEditing()),h.xp6(1),h.Q6J("ngStyle",t.getBoundingBoxStyle("top")),h.xp6(1),h.Q6J("ngStyle",t.getBoundingBoxStyle("right")),h.xp6(1),h.Q6J("ngStyle",t.getBoundingBoxStyle("bottom")),h.xp6(1),h.Q6J("ngStyle",t.getBoundingBoxStyle("left"))}}let P=(()=>{class DashboardContainerElement{constructor(t,e,s,i,o){this.dashboardlayout=t,this.metadata=e,this.renderer=s,this.model=i,this.view=o,this.componentRefs=[],this.isAuthorized=!0,this.item={},this.mouseMoveListener=void 0,this.mouseUpListener=void 0,this.mouseLast=null,this.mouseStart=null,this.mouseTarget="",this.isMoving=!1}get containerClass(){return{"slds-scrollable--y":!this.view.isEditMode(),"slds-is-absolute":!this.dashboardlayout.compactView,"slds-m-vertical_xx-small":this.dashboardlayout.compactView}}ngAfterViewInit(){this.renderDashlet()}renderDashlet(){for(let t of this.componentRefs)t.destroy();window.setTimeout((()=>this.isAuthorized=!this.item.module||this.metadata.checkModuleAcl(this.item.module,this.item.acl_action?this.item.acl_action:"list"))),this.item.component&&this.isAuthorized&&this.metadata.addComponent(this.item.component,this.containerelement).subscribe((t=>{t.instance.dashletconfig=this.item.dashletconfig,t.instance.acl_action=this.item.acl_action,t.instance.icon=this.item.icon,t.instance.dashlet_id=this.item.dashlet_id,t.instance.componentconfig=this.item.componentconfig,t.instance.dashletModule=this.item.module,t.instance.dashletLabel=this.item.label,this.componentRefs.push(t)}))}isEditing(){return this.view.isEditMode()&&this.item.id===this.dashboardlayout.editing}getBoxStyle(){let t=this.item.position,e=this.dashboardlayout.getElementStyle(t.top,t.left,t.width,t.height),s=this.dashboardlayout.applyMove(e,this.mouseTarget,this.mouseStart,this.mouseLast);return this.isEditing()&&(s.border="1px dashed #ca1b21",s.cursor="move",this.isMoving&&(s.opacity=".5",s["z-index"]="9999")),this.dashboardlayout.prepareStyle(s)}getBoundingBoxStyle(t){let e=this.item.position,s=this.dashboardlayout.getElementStyle(e.top,e.left,e.width,e.height),i=this.dashboardlayout.applyMove(s,this.mouseTarget,this.mouseStart,this.mouseLast),o={};switch(t){case"top":o={top:-4,left:i.width/2-4,cursor:"n-resize"};break;case"bottom":o={top:i.height-5,left:i.width/2-4,cursor:"s-resize"};break;case"left":o={top:i.height/2-4,left:"-4px",cursor:"w-resize"};break;case"right":o={left:i.width-5,top:i.height/2-4,cursor:"e-resize"}}return o["background-color"]="#fff",o.position="absolute",o.border="1px solid #ca1b21",o.width="8px",o.height="8px",this.dashboardlayout.prepareStyle(o)}onMousedown(t,e){this.view.isEditMode()&&(this.mouseTarget=t,this.dashboardlayout.editing=this.item.id,this.mouseStart=e,this.mouseLast=e,this.mouseUpListener=this.renderer.listen("document","mouseup",(t=>this.onMouseUp())),this.mouseMoveListener=this.renderer.listen("document","mousemove",(t=>this.onMouseMove(t))),this.isMoving=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1)}onMouseMove(t){this.view.isEditMode()&&(this.mouseLast=t),this.handleScrolling()}onMouseUp(){this.mouseUpListener(),this.mouseMoveListener(),this.dropItem(),this.mouseStart=null,this.mouseLast=null,this.mouseTarget="",this.isMoving=!1}handleScrolling(){if(!this.view.isEditMode()||!this.isMoving)return;let t=this.mouseLast.pageY-this.mouseStart.pageY,e=this.item.position;e=this.dashboardlayout.getElementStyle(e.top,e.left,e.width,e.height);let s="bottom"==this.mouseTarget?e.height+t:e.height,i="content"==this.mouseTarget?e.top+t+s:e.top+s,o=this.dashboardlayout.bodyContainerRef;i>o.getBoundingClientRect().bottom-o.offsetTop-50&&(o.scrollTop+=5)}dropItem(){if(!this.mouseLast||!this.mouseStart)return!1;let t=this.mouseLast.pageY-this.mouseStart.pageY,e=this.mouseLast.pageX-this.mouseStart.pageX;this.dashboardlayout.dropElement(this.item.id,e,t,this.mouseTarget,this.mouseLast)}}return DashboardContainerElement.ɵfac=function(t){return new(t||DashboardContainerElement)(h.Y36(g),h.Y36(x.Pu),h.Y36(h.Qsj),h.Y36(l.o),h.Y36(m.e))},DashboardContainerElement.ɵcmp=h.Xpm({type:DashboardContainerElement,selectors:[["dashboard-container-element"]],viewQuery:function(t,e){if(1&t&&h.Gf(U,5,h.s_b),2&t){let t;h.iGM(t=h.CRH())&&(e.containerelement=t.first)}},inputs:{item:"item"},decls:6,vars:8,consts:[[1,"slds-box--border","slds-theme--default","spice-scrollbar-thin",3,"ngStyle","ngClass","mousedown"],[2,"width","100%","height","100%"],[4,"ngIf"],["class","slds-align_absolute-center","style","height: 100%",4,"ngIf"],["style","width: 100%; height: 100%; position: absolute;top: 0; left: 0;",4,"ngIf"],["containerelement",""],[1,"slds-align_absolute-center",2,"height","100%"],[2,"width","100%","height","100%","position","absolute","top","0","left","0"],["class","slds-is-absolute slds-m-around--x-small slds-align_absolute-center","style","top:0;right:0",4,"ngIf"],[3,"ngStyle","mousedown"],[1,"slds-is-absolute","slds-m-around--x-small","slds-align_absolute-center",2,"top","0","right","0"],[2,"cursor","pointer",3,"icon","size","click"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0),h.NdJ("mousedown",(function(t){return e.onMousedown("content",t)})),h.TgZ(1,"div",1),h.YNc(2,O,2,0,"div",2),h.YNc(3,R,2,0,"div",3),h.qZA(),h.YNc(4,G,1,0,"div",4),h.YNc(5,K,6,5,"ng-container",2),h.qZA()),2&t&&(h.Q6J("ngStyle",e.getBoxStyle())("ngClass",e.containerClass),h.xp6(1),h.Udp("overflow",e.view.isEditMode()?"hidden":"initial"),h.xp6(1),h.Q6J("ngIf",e.isAuthorized),h.xp6(1),h.Q6J("ngIf",!e.isAuthorized),h.xp6(1),h.Q6J("ngIf",e.view.isEditMode()),h.xp6(1),h.Q6J("ngIf",e.isEditing()))},dependencies:[i.mk,i.O5,i.PC,L.s,B.r],encapsulation:2}),DashboardContainerElement})();const W=["bodycontainer"];function V(t,e){if(1&t){const t=h.EpF();h.ynx(0),h.TgZ(1,"div",8)(2,"button",9),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw(3);return h.KtG(s.addDashlet(e))})),h._UZ(3,"system-button-icon",10),h.qZA()(),h.BQk()}if(2&t){const t=e.$implicit,s=h.oxw(3);h.xp6(1),h.Q6J("ngStyle",s.dashboardlayout.prepareStyle(t)),h.xp6(2),h.Q6J("icon","add")("size","medium")}}function $(t,e){if(1&t&&(h.ynx(0),h.YNc(1,V,4,3,"ng-container",7),h.BQk()),2&t){const t=e.$implicit;h.xp6(1),h.Q6J("ngForOf",t)}}function j(t,e){if(1&t&&(h.ynx(0),h.YNc(1,$,2,1,"ng-container",6),h.BQk()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.dashboardGrid)("ngForTrackBy",t.trackByGridFn)}}function X(t,e){if(1&t&&h._UZ(0,"dashboard-container-element",11),2&t){const t=e.$implicit;h.Q6J("item",t)}}function tt(t,e){1&t&&(h.TgZ(0,"div",12),h._UZ(1,"system-spinner"),h.TgZ(2,"div",13),h._UZ(3,"system-label",14),h.qZA()())}function et(t,e){1&t&&(h.TgZ(0,"div",15),h._UZ(1,"system-illustration-no-access"),h.qZA())}function st(t,e){1&t&&(h.TgZ(0,"div",15)(1,"system-illustration-no-records"),h._UZ(2,"system-label",16),h.qZA()())}let it=(()=>{class DashboardContainerBody{constructor(t,e,s,i,o){this.dashboardlayout=t,this.language=e,this.renderer=s,this.view=i,this.model=o,this.resizeListener=this.renderer.listen("window","resize",(()=>this.calculateGrid()))}get isLoading(){return this.model.isLoading}get dashboardGrid(){return this.dashboardlayout.dashboardGrid}get dashboardElements(){return this.dashboardlayout.dashboardElements}get isEditMode(){return this.view.isEditMode()}get bodyContainerStyle(){return{border:this.view.isEditMode()?"1px dashed #ca1b21":"0",width:"100%"}}ngAfterViewInit(){this.dashboardlayout.bodyContainerRef=this.bodycontainer}ngOnDestroy(){this.resizeListener&&this.resizeListener()}trackByGridFn(t,e){return t}trackByItemFn(t,e){return e.id}calculateGrid(){window.innerWidth<1024&&(this.view.setViewMode(),this.model.cancelEdit()),this.isEditMode&&this.dashboardlayout.calculateGrid()}addDashlet(t){this.dashboardlayout.addDashlet(t)}}return DashboardContainerBody.ɵfac=function(t){return new(t||DashboardContainerBody)(h.Y36(g),h.Y36(b.d),h.Y36(h.Qsj),h.Y36(m.e),h.Y36(l.o))},DashboardContainerBody.ɵcmp=h.Xpm({type:DashboardContainerBody,selectors:[["dashboard-container-body"]],viewQuery:function(t,e){if(1&t&&h.Gf(W,7,h.s_b),2&t){let t;h.iGM(t=h.CRH())&&(e.bodycontainer=t.first)}},decls:7,vars:7,consts:[["system-to-bottom","",1,"slds-is-relative","spice-scrollbar",3,"ngStyle"],["bodycontainer",""],[4,"ngIf"],[3,"item",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-align--absolute-center slds-grid slds-grid--vertical","system-to-bottom","",4,"ngIf"],["class","slds-align--absolute-center slds-grid slds-grid--vertical","style","height: 100%",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf"],[2,"padding","10px","border","1px solid #ddd","position","absolute",3,"ngStyle"],[1,"slds-button","slds-button--icon","slds-align--absolute-center",2,"height","100%","width","100%",3,"click"],[2,"height","100%","width","100%",3,"icon","size"],[3,"item"],["system-to-bottom","",1,"slds-align--absolute-center","slds-grid","slds-grid--vertical"],[1,"slds-m-around--medium","slds-text-heading--small"],["label","MSG_LOADING_DASHBOARDS"],[1,"slds-align--absolute-center","slds-grid","slds-grid--vertical",2,"height","100%"],["label","MSG_NO_RECORDS_FOUND"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0,1),h.YNc(2,j,2,2,"ng-container",2),h.YNc(3,X,1,1,"dashboard-container-element",3),h.YNc(4,tt,4,0,"div",4),h.YNc(5,et,2,0,"div",5),h.YNc(6,st,3,0,"div",5),h.qZA()),2&t&&(h.Q6J("ngStyle",e.bodyContainerStyle),h.xp6(2),h.Q6J("ngIf",e.isEditMode),h.xp6(1),h.Q6J("ngForOf",e.dashboardElements)("ngForTrackBy",e.trackByItemFn),h.xp6(1),h.Q6J("ngIf",e.isLoading),h.xp6(1),h.Q6J("ngIf",!e.isLoading&&e.dashboardlayout.dashboardNotFound),h.xp6(1),h.Q6J("ngIf",!e.isLoading&&0==e.dashboardElements.length&&!e.dashboardlayout.dashboardNotFound&&!e.isEditMode))},dependencies:[i.sg,i.O5,i.PC,w.J,L.s,H.C,A._,C.W,y.H,P],encapsulation:2}),DashboardContainerBody})();function ot(t,e){1&t&&h._UZ(0,"dashboard-container-body")}function at(t,e){1&t&&(h.TgZ(0,"div",7)(1,"span",8),h._uU(2,"Please Select a Dashboard"),h.qZA()())}const dt=function(t){return{"slds-is-absolute":t}};let nt=(()=>{class DashboardView{constructor(t,e,s,i,o,a,d){this.navigation=t,this.language=e,this.dashboardlayout=s,this.userpreferences=i,this.model=o,this.view=a,this.modellist=d,this.panelwidth=250,this.showpanel=!1}get ismobile(){return window.innerWidth<1024}get dashboardstyle(){return{width:"calc(100% - "+(this.ismobile?0:this.panelwidth)+"px)"}}get panelstyle(){return{width:this.panelwidth+"px","z-index":1,left:this.ismobile&&!this.showpanel?"-250px":"0px"}}ngOnInit(){this.loadDashboards(),this.navigation.setActiveModule("Dashboards")}loadDashboards(){let t=this.userpreferences.getPreference("last_dashboard");this.model.module="Dashboards",this.modellist.initialize("Dashboards"),this.modellist.loadlimit=250,this.modellist.getListData().subscribe((()=>{t&&this.modellist.listData.list.some((e=>{if(e.id==t)return this.loadDashboard(t),!0}))}))}loadDashboard(t){t!=this.dashboardlayout.dashboardId&&(this.view.setViewMode(),this.dashboardlayout.dashboardId=t,this.model.id=t,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData().subscribe((()=>{this.dashboardlayout.dashboardElements=this.model.getField("components"),this.dashboardlayout.sortElements()}),(t=>{404==t.status&&(this.dashboardlayout.dashboardNotFound=!0)})))}}return DashboardView.ɵfac=function(t){return new(t||DashboardView)(h.Y36(p.G),h.Y36(b.d),h.Y36(g),h.Y36(f.z),h.Y36(l.o),h.Y36(m.e),h.Y36(r.t))},DashboardView.ɵcmp=h.Xpm({type:DashboardView,selectors:[["dashboard-view"]],features:[h._Bn([l.o,r.t,g,m.e])],decls:7,vars:8,consts:[[1,"slds-grid"],[1,"slds-theme--shade",2,"transition","left 1s",3,"ngClass","ngStyle"],[3,"hide","dashboardSelect"],[1,"slds-theme--default",3,"ngStyle"],[3,"showdashboardselector","showselect"],[4,"ngIf"],["system-to-bottom","","class","slds-align--absolute-center",4,"ngIf"],["system-to-bottom","",1,"slds-align--absolute-center"],[1,"slds-text-heading--small"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0)(1,"div",1)(2,"dashboard-select-panel",2),h.NdJ("hide",(function(){return e.showpanel=!1}))("dashboardSelect",(function(t){return e.loadDashboard(t)})),h.qZA()(),h.TgZ(3,"div",3)(4,"dashboard-container-header",4),h.NdJ("showselect",(function(){return e.showpanel=!0})),h.qZA(),h.YNc(5,ot,1,0,"dashboard-container-body",5),h.YNc(6,at,3,0,"div",6),h.qZA()()),2&t&&(h.xp6(1),h.Q6J("ngClass",h.VKq(6,dt,e.ismobile))("ngStyle",e.panelstyle),h.xp6(2),h.Q6J("ngStyle",e.dashboardstyle),h.xp6(1),h.Q6J("showdashboardselector",e.ismobile),h.xp6(1),h.Q6J("ngIf",e.dashboardlayout.dashboardId),h.xp6(1),h.Q6J("ngIf",!e.dashboardlayout.dashboardId))},dependencies:[i.mk,i.O5,i.PC,y.H,M,Q,it],encapsulation:2}),DashboardView})();var lt=s(7774);function rt(t,e){1&t&&h._UZ(0,"dashboard-container-body")}function ht(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",2)(1,"span"),h._UZ(2,"system-label",3),h.qZA(),h.TgZ(3,"a",4),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.navigate())})),h._UZ(4,"system-label",5),h.qZA()()}}let ct=(()=>{class DashboardContainer{constructor(t,e,s,i){this.dashboardlayout=t,this.language=e,this.router=s,this.model=i,this.dashboardid="",this.context="Dashboard"}loadDashboard(){this.dashboardid!=this.dashboardlayout.dashboardId&&(this.model.initialize(),this.model.module="Dashboards",this.dashboardlayout.dashboardId=this.dashboardid,this.model.id=this.dashboardid,this.dashboardlayout.dashboardElements=[],this.dashboardlayout.dashboardNotFound=!1,this.model.getData(!1).subscribe((()=>{this.dashboardlayout.dashboardElements=this.model.getField("components"),this.dashboardlayout.sortElements()}),(t=>{404==t.status&&(this.dashboardlayout.dashboardNotFound=!0)})))}ngOnInit(){this.loadDashboard()}ngOnChanges(){this.loadDashboard()}navigate(){this.router.navigate(["/module/Dashboards"])}}return DashboardContainer.ɵfac=function(t){return new(t||DashboardContainer)(h.Y36(g),h.Y36(b.d),h.Y36(lt.F0),h.Y36(l.o))},DashboardContainer.ɵcmp=h.Xpm({type:DashboardContainer,selectors:[["dashboard-container"]],inputs:{dashboardid:"dashboardid",context:"context"},features:[h._Bn([l.o,m.e,g]),h.TTD],decls:2,vars:2,consts:[[4,"ngIf"],["class","slds-align--absolute-center slds-text-heading--small","system-to-bottom","",4,"ngIf"],["system-to-bottom","",1,"slds-align--absolute-center","slds-text-heading--small"],["label","MSG_NO_DASHBOARD_SELECTED"],[1,"slds-m-left--xx-small","slds-text-link",2,"cursor","pointer",3,"click"],["label","LBL_SELECT_DASHBOARD"]],template:function(t,e){1&t&&(h.YNc(0,rt,1,0,"dashboard-container-body",0),h.YNc(1,ht,5,0,"div",1)),2&t&&(h.Q6J("ngIf",e.dashboardid.length>0),h.xp6(1),h.Q6J("ngIf",0==e.dashboardid.length))},dependencies:[i.O5,A._,y.H,it],encapsulation:2}),DashboardContainer})();var ut=s(2803);function gt(t,e){1&t&&h._UZ(0,"system-stencil")}let mt=(()=>{class DashboardContainerHomeHeader{constructor(t,e,s){this.dashboardlayout=t,this.language=e,this.router=s,this.dashboardid=""}get dashboardname(){return this.dashboardlayout.model.getFieldValue("name")}goDashboards(){this.router.navigate(["/module/Dashboards"])}}return DashboardContainerHomeHeader.ɵfac=function(t){return new(t||DashboardContainerHomeHeader)(h.Y36(g),h.Y36(b.d),h.Y36(lt.F0))},DashboardContainerHomeHeader.ɵcmp=h.Xpm({type:DashboardContainerHomeHeader,selectors:[["dashboard-container-homeheader"]],inputs:{dashboardid:"dashboardid"},decls:8,vars:2,consts:[[1,"slds-grid","slds-p-around--small"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[1,"slds-col","slds-no-flex","slds-grid","slds-align-top"],[1,"slds-button","slds-button--neutral",3,"click"],["module","Dashboards"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),h.YNc(3,gt,1,0,"system-stencil",3),h._uU(4),h.qZA()(),h.TgZ(5,"div",4)(6,"button",5),h.NdJ("click",(function(){return e.goDashboards()})),h._UZ(7,"system-label-modulename",6),h.qZA()()()),2&t&&(h.xp6(3),h.Q6J("ngIf",!e.dashboardname),h.xp6(1),h.Oqu(e.dashboardname))},dependencies:[i.O5,v.M,ut.B],encapsulation:2}),DashboardContainerHomeHeader})();var pt=s(4561),bt=s(9621),ft=s(3499),yt=s(5767),xt=s(1916);function wt(t,e){if(1&t&&(h.TgZ(0,"option",34),h._uU(1),h.qZA()),2&t){const t=e.$implicit;h.Q6J("value",t),h.xp6(1),h.hij(" ",t," ")}}function vt(t,e){1&t&&h._UZ(0,"system-utility-icon",35)}function Zt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"button",36),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw();return h.KtG(e.searchKey="")})),h._UZ(1,"system-button-icon",37),h.qZA()}}function Dt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",41)(1,"a",42),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw(2);return h.KtG(s.add(e))})),h._UZ(2,"system-icon",43),h.TgZ(3,"div",44)(4,"h2",45),h._UZ(5,"system-label",46),h.qZA(),h.TgZ(6,"p",47),h._UZ(7,"system-label",48),h.qZA()()()()}if(2&t){const t=e.$implicit,s=h.oxw(2);h.xp6(2),h.Q6J("icon",s.getIcon(t.icon))("sprite",s.getSprite(t.icon))("module",t.module?t.module:"Dashboards"),h.xp6(2),h.Q6J("title",t.label),h.xp6(1),h.Q6J("label",t.label),h.xp6(2),h.Q6J("label",t.label)}}function _t(t,e){if(1&t&&(h.TgZ(0,"div",38)(1,"div",39),h.YNc(2,Dt,8,6,"div",40),h.qZA()()),2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngForOf",t.dashboardDashlets)("ngForTrackBy",t.trackByFn)}}function Tt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",41)(1,"a",42),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw(2);return h.KtG(s.add(e))})),h._UZ(2,"system-icon",51),h.TgZ(3,"div",44)(4,"h2",45),h._uU(5),h.qZA(),h.TgZ(6,"p",47),h._uU(7),h.qZA()()()()}if(2&t){const t=e.$implicit;h.xp6(2),h.Q6J("module",t.report_module),h.xp6(2),h.Q6J("title",t.name),h.xp6(1),h.hij(" ",t.name," "),h.xp6(2),h.hij(" ",t.description," ")}}function kt(t,e){if(1&t&&(h.TgZ(0,"div",49)(1,"div",39),h.YNc(2,Tt,8,4,"div",50),h.qZA()()),2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngForOf",t.kReports)("ngForTrackBy",t.trackByFn)}}function Mt(t,e){1&t&&h._UZ(0,"system-spinner")}let At=(()=>{class DashboardAddElement{constructor(t,e,s){this.language=t,this.metadata=e,this.backend=s,this.self={},this.kreports=[],this.dashboarddashlets=[],this.dashletName="",this.searchKey="",this.dashlettype="Generic",this.dashletModule="*",this.isLoading=!1,this.canLoadMore=!0,this.loadLimit=40,this.addDashlet=new h.vpe,this.modules=[]}get kReports(){return"*"==this.dashletModule?this.kreports:this.kreports.filter((t=>t.report_module==this.dashletModule))}get dashboardDashlets(){return this.dashboarddashlets.filter((t=>("*"==this.dashletModule||t.module==this.dashletModule)&&(0==this.searchKey.length||this.language.getLabel(t.label).toLowerCase().indexOf(this.searchKey.toLowerCase())>-1)&&this.metadata.checkModuleAcl(t.module,"list")))}get dashletType(){return this.dashlettype}set dashletType(t){this.dashlettype=t,this.resetValues(),"Generic"===t?this.getDashlets():this.getKReports()}ngOnInit(){this.getDashlets(),this.modules=this.metadata.getModules().sort()}resetValues(){this.dashletModule="*",this.searchKey="",this.canLoadMore=!0}search(){"Generic"!==this.dashletType&&(this.searchTimeout&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout((()=>this.getKReports()),600))}trackByFn(t,e){return t}getDashlets(){this.isLoading=!0,this.dashboarddashlets=[],this.backend.getRequest("module/Dashboards/dashlets").subscribe((t=>{this.dashboarddashlets=t,this.isLoading=!1}))}getKReports(){this.isLoading=!0,this.kreports=[];let t={offset:0,limit:this.loadLimit,searchKey:this.searchKey};this.backend.getRequest("module/KReports/published/"+this.dashletType,t).subscribe((t=>{this.kreports=t,this.isLoading=!1}))}getMoreKReports(){if(!this.canLoadMore||this.isLoading)return;this.isLoading=!0;let t={offset:this.kReports.length,limit:this.loadLimit};this.backend.getRequest("module/KReports/published/"+this.dashletType,t).subscribe((t=>{this.kreports=this.kReports.concat(t),this.canLoadMore=t.length==this.loadLimit,this.isLoading=!1}))}getIcon(t){return t&&t.split(":")[1]?t.split(":")[1]:t}getSprite(t){return t&&t.split(":")[1]?t.split(":")[0]:"standard"}onScroll(t){t.scrollTop+t.clientHeight>=t.scrollHeight&&this.getMoreKReports()}add(t){if(!t)return;let e=this.dashletName,s="",i={},o={},a="",d="",n="",l="",r="";switch(this.dashletType){case"dashletVisualization":s="ReporterVisualizationDashlet",i={reportid:t.id},a="KReports";break;case"dashletPresentation":s="ReporterPresentationDashlet",i={reportid:t.id},a="KReports";break;case"Generic":s=t.component,l=t.id,o=t.componentconfig?JSON.parse(t.componentconfig):"",a=t.module,r=t.label,d=t.icon,n=t.acl_action}this.addDashlet.emit({name:e,label:r,module:a,component:s,componentconfig:i,dashletconfig:o,icon:d,acl_action:n,dashlet_id:l}),this.self.destroy()}close(){this.addDashlet.emit(!1),this.self.destroy()}}return DashboardAddElement.ɵfac=function(t){return new(t||DashboardAddElement)(h.Y36(b.d),h.Y36(x.Pu),h.Y36(c.y))},DashboardAddElement.ɵcmp=h.Xpm({type:DashboardAddElement,selectors:[["dashboard-add-element"]],decls:43,vars:10,consts:[["size","large"],[3,"close"],["label","LBL_ADD_DASHLET"],[2,"overflow-y","hidden",3,"grow"],[1,"slds-grid",2,"height","80px"],[1,"slds-form-element","slds-size--1-of-3"],[1,"slds-form-element__label"],["label","LBL_TYPE"],[1,"slds-form-element__control"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","Generic"],["label","LBL_DASHLET"],["value","dashletVisualization"],["label","LBL_REPORT_CHART"],["value","dashletPresentation"],["label","LBL_REPORT_LIST"],[1,"slds-form-element","slds-size--1-of-3","slds-p-left--small"],["label","LBL_MODULE"],["value","*"],[3,"value",4,"ngFor","ngForOf"],["label","LBL_SEARCH"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["type","text",1,"slds-lookup__search-input","slds-input",3,"ngModel","ngModelChange","keyup"],["icon","search","addclasses","slds-input__icon",4,"ngIf"],["class","slds-button slds-input__icon slds-input__icon_right",3,"click",4,"ngIf"],[2,"height","calc(100% - 80px)"],[1,"slds-scrollable--y",2,"height","100%",3,"scroll"],["scrollElement",""],["class","slds-form-element",4,"ngIf"],["class","slds-form-element slds-lookup",4,"ngIf"],[4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[3,"value"],["icon","search","addclasses","slds-input__icon"],[1,"slds-button","slds-input__icon","slds-input__icon_right",3,"click"],["icon","clear"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"icon","sprite","module"],[1,"slds-media__body","slds-border_left","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate",3,"title"],[3,"label"],[1,"slds-m-top_small","slds-truncate"],["length","long",3,"label"],[1,"slds-form-element","slds-lookup"],["class","slds-size--1-of-3 slds-p-around--xx-small",4,"ngFor","ngForOf","ngForTrackBy"],["size","large",1,"slds-align_absolute-center",3,"module"]],template:function(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"system-modal",0)(1,"system-modal-header",1),h.NdJ("close",(function(){return e.close()})),h._UZ(2,"system-label",2),h.qZA(),h.TgZ(3,"system-modal-content",3)(4,"div",4)(5,"div",5)(6,"label",6),h._UZ(7,"system-label",7),h.qZA(),h.TgZ(8,"div",8)(9,"div",9)(10,"select",10),h.NdJ("ngModelChange",(function(t){return e.dashletType=t})),h.TgZ(11,"option",11),h._UZ(12,"system-label",12),h.qZA(),h.TgZ(13,"option",13),h._UZ(14,"system-label",14),h.qZA(),h.TgZ(15,"option",15),h._UZ(16,"system-label",16),h.qZA()()()()(),h.TgZ(17,"div",17)(18,"label",6),h._UZ(19,"system-label",18),h.qZA(),h.TgZ(20,"div",8)(21,"div",9)(22,"select",10),h.NdJ("ngModelChange",(function(t){return e.dashletModule=t})),h.TgZ(23,"option",19),h._uU(24,"All"),h.qZA(),h.YNc(25,wt,2,2,"option",20),h.qZA()()()(),h.TgZ(26,"div",17)(27,"label",6),h._UZ(28,"system-label",21),h.qZA(),h.TgZ(29,"div",8)(30,"div",22)(31,"input",23),h.NdJ("ngModelChange",(function(t){return e.searchKey=t}))("keyup",(function(){return e.search()})),h.qZA(),h.YNc(32,vt,1,0,"system-utility-icon",24),h.YNc(33,Zt,2,0,"button",25),h.qZA()()()(),h.TgZ(34,"div",26)(35,"div",27,28),h.NdJ("scroll",(function(){h.CHM(t);const s=h.MAs(36);return h.KtG(e.onScroll(s))})),h.YNc(37,_t,3,2,"div",29),h.YNc(38,kt,3,2,"div",30),h.YNc(39,Mt,1,0,"system-spinner",31),h.qZA()()(),h.TgZ(40,"system-modal-footer")(41,"button",32),h.NdJ("click",(function(){return e.close()})),h._UZ(42,"system-label",33),h.qZA()()()}2&t&&(h.xp6(3),h.Q6J("grow",!0),h.xp6(7),h.Q6J("ngModel",e.dashletType),h.xp6(12),h.Q6J("ngModel",e.dashletModule),h.xp6(3),h.Q6J("ngForOf",e.modules),h.xp6(6),h.Q6J("ngModel",e.searchKey),h.xp6(1),h.Q6J("ngIf",0==e.searchKey.length),h.xp6(1),h.Q6J("ngIf",e.searchKey.length>0),h.xp6(4),h.Q6J("ngIf","Generic"===e.dashletType),h.xp6(1),h.Q6J("ngIf","Generic"!==e.dashletType),h.xp6(1),h.Q6J("ngIf",e.isLoading))},dependencies:[i.sg,i.O5,o.YN,o.Kr,o.Fj,o.EJ,o.JJ,o.On,w.J,pt.f,A._,bt.j,ft.x,yt.p,xt.y,C.W,B.r],encapsulation:2}),DashboardAddElement})();var Ct=s(529);function Jt(t,e){if(1&t&&(h.TgZ(0,"h2",9),h._uU(1),h.qZA()),2&t){const t=h.oxw(2);h.xp6(1),h.hij("Weather in ",t.cityName,"")}}function Ft(t,e){if(1&t&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&t){const t=h.oxw(3);h.xp6(1),h.hij(", ",t.description,"")}}function St(t,e){if(1&t&&(h.TgZ(0,"span",14),h._uU(1),h.qZA()),2&t){const t=h.oxw(3);h.xp6(1),h.Oqu(t.getHour(t.dayHourToShow.dt))}}function Yt(t,e){if(1&t&&(h.TgZ(0,"div",11),h._uU(1),h.qZA()),2&t){const t=h.oxw(3);h.xp6(1),h.Oqu(t.description)}}function Nt(t,e){if(1&t&&(h.TgZ(0,"div",10)(1,"div",11)(2,"span"),h._uU(3),h.YNc(4,Ft,2,1,"span",8),h.qZA(),h.YNc(5,St,2,1,"span",12),h.qZA(),h.YNc(6,Yt,2,1,"div",13),h.qZA()),2&t){const t=h.oxw(2);h.Q6J("ngClass",t.todayOnly?"slds-border--bottom slds-p-bottom--xxx-small":""),h.xp6(3),h.hij(" ",t.getDayName(t.dayHourToShow.dt)," "),h.xp6(1),h.Q6J("ngIf",t.todayOnly),h.xp6(1),h.Q6J("ngIf",!t.todayOnly),h.xp6(1),h.Q6J("ngIf",!t.todayOnly)}}function Et(t,e){if(1&t&&(h.TgZ(0,"div",15)(1,"div",16),h._UZ(2,"img",17),h.TgZ(3,"div",18),h._uU(4),h.qZA()(),h.TgZ(5,"div",19)(6,"div",11),h._uU(7),h.qZA(),h.TgZ(8,"div",11),h._uU(9),h.qZA(),h.TgZ(10,"div",11),h._uU(11),h.qZA()()()),2&t){const t=h.oxw(2);h.xp6(2),h.Q6J("src",t.getWeatherIconUrl(t.dayHourToShow.weather[0].icon),h.LSH),h.xp6(2),h.hij("",t.getTemperature(t.dayHourToShow.main.temp),"°C"),h.xp6(3),h.hij("Clouds: ",t.dayHourToShow.clouds.all,"%"),h.xp6(2),h.hij("Humidity: ",t.dayHourToShow.main.humidity,"%"),h.xp6(2),h.hij("Wind: ",t.getWind(t.dayHourToShow.wind),"km/h")}}function It(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",24),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw(3);return h.KtG(s.setDayHourToShow(e))})),h._uU(1),h.qZA()}if(2&t){const t=e.$implicit,s=h.oxw(3);h.Q6J("ngClass",t.dt==s.dayHourToShow.dt?"slds-text-color--error":""),h.xp6(1),h.hij(" ",s.getHour(t.dt)," ")}}const qt=function(){return{"background-color":"#faf7f7",border:"1px solid #e0dfdf"}},Qt=function(){return{}};function Lt(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",25),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw(3);return h.KtG(s.setDayToShow(e))})),h.TgZ(1,"div",26),h._uU(2),h.qZA(),h.TgZ(3,"div",27),h._UZ(4,"img",28),h.qZA(),h.TgZ(5,"div",26)(6,"span"),h._uU(7),h.qZA(),h._UZ(8,"span",29),h.qZA()()}if(2&t){const t=e.$implicit,s=e.first,i=h.oxw(3);h.Q6J("ngStyle",i.getDayName(s?t[0].dt:t[4].dt)==i.getDayName(i.dayHourToShow.dt)?h.DdM(4,qt):h.DdM(5,Qt)),h.xp6(2),h.Oqu(i.getDayName(t[0].dt,!0)),h.xp6(2),h.Q6J("src",i.getWeatherIconUrl(s?t[0].weather[0].icon:t[4].weather[0].icon),h.LSH),h.xp6(3),h.hij("",i.getTemperature(s?t[0].main.temp_max:t[4].main.temp_max),"°")}}function Ht(t,e){if(1&t&&(h.ynx(0),h.TgZ(1,"div",20),h.YNc(2,It,2,2,"div",21),h.qZA(),h.TgZ(3,"div",22),h.YNc(4,Lt,9,6,"div",23),h.qZA(),h.BQk()),2&t){const t=h.oxw(2);h.xp6(2),h.Q6J("ngForOf",t.dayToShow)("ngForTrackBy",t.trackByFn),h.xp6(2),h.Q6J("ngForOf",t.sortedDays)("ngForTrackBy",t.trackByFn)}}function Bt(t,e){if(1&t&&(h.TgZ(0,"div",3)(1,"div",4),h.YNc(2,Jt,2,1,"h2",5),h.YNc(3,Nt,7,5,"div",6),h.qZA(),h.YNc(4,Et,12,5,"div",7),h.YNc(5,Ht,5,4,"ng-container",8),h.qZA()),2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngIf",t.cityName),h.xp6(1),h.Q6J("ngIf",t.dayHourToShow),h.xp6(1),h.Q6J("ngIf",t.dayHourToShow),h.xp6(1),h.Q6J("ngIf",!t.todayOnly)}}function Ut(t,e){1&t&&(h.TgZ(0,"div",30),h._UZ(1,"system-spinner"),h.qZA())}function Ot(t,e){1&t&&(h.TgZ(0,"div",31),h._uU(1," Weather forecast is currently unavailable\n"),h.qZA())}let Rt=(()=>{class DashboardWeatherDashlet{constructor(t,e,s){this.http=t,this.language=e,this.metadata=s,this.sortedDays=void 0,this.cityName=void 0,this.daytoshow=void 0,this.dayHourToShow=void 0,this.todayOnly=!1,this.forecastCity="Vienna",this.apiId="ba76af382fdb47888b5a080d6c7122b5",this.isLoading=!1}get dayToShow(){return this.daytoshow}set dayToShow(t){this.daytoshow=t,this.dayHourToShow=8==t.length?t[4]:t[0]}get description(){if(this.dayHourToShow){let t=this.dayHourToShow.weather[0].description.split(" "),e=[];for(let s of t)e.push(s.replace(/\S/,(t=>t.toUpperCase())));return e.join(" ")}}ngOnInit(){let t=this.metadata.getComponentConfig("DashboardWeatherDashlet","Dashboards");t.hasOwnProperty("apiid")&&(this.apiId=t.apiid),t.hasOwnProperty("city")&&""!=t.city?this.getForecastData("q="+t.city):navigator.geolocation&&(this.isLoading=!0,navigator.geolocation.getCurrentPosition((t=>{let e=`lat=${t.coords.latitude}&lon=${t.coords.longitude}`;this.getForecastData(e)}),(t=>{t.code==t.PERMISSION_DENIED&&this.getForecastData("q="+this.forecastCity),this.isLoading=!1}))),this.todayOnly=!!t.hasOwnProperty("todayonly")&&t.todayonly}getForecastData(t){this.isLoading=!0,this.http.get("proxy/?useurl="+btoa(`http://api.openweathermap.org/data/2.5/forecast?${t}&APPID=${this.apiId}`)).subscribe((t=>{t.city&&(this.cityName=t.city.name),t.list&&this.resortDays(t.list)})),this.isLoading=!1}resortDays(t){if(t){let e=[],s=[],i=t.sort(((t,e)=>t.dt-e.dt)),o=new Date(1e3*i[0].dt).getDay();for(let t of i){let i=new Date(1e3*t.dt).getDay();o==i||(o=i,e.push(s),s=[]),s.push(t)}this.sortedDays=e,this.dayToShow=e[0]}}setDayToShow(t){this.dayToShow=t}setDayHourToShow(t){this.dayHourToShow=t}getHour(t){return moment.unix(t).format("H")+":00"}getDayName(t,e=!1){let s=new Date(1e3*t).getDay();return e?moment.weekdaysShort(s):moment.weekdays(s)}getTemperature(t){return Math.round(parseInt(t,10)-273.15)}getWind(t){return Math.round(3.6*t.speed)}getWeatherIconUrl(t){return"proxy/?useurl="+btoa(`http://openweathermap.org/img/w/${t}.png`)}trackByFn(t,e){return t}}return DashboardWeatherDashlet.ɵfac=function(t){return new(t||DashboardWeatherDashlet)(h.Y36(Ct.eN),h.Y36(b.d),h.Y36(x.Pu))},DashboardWeatherDashlet.ɵcmp=h.Xpm({type:DashboardWeatherDashlet,selectors:[["ng-component"]],decls:3,vars:3,consts:[["style","height: 100%",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%",4,"ngIf"],["class","slds-align--absolute-center slds-text-heading--small","style","height: 100%",4,"ngIf"],[2,"height","100%"],[1,"slds-p-around--x-small"],["class","slds-text-heading--medium",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","slds-grid slds-p-horizontal--x-small",4,"ngIf"],[4,"ngIf"],[1,"slds-text-heading--medium"],[3,"ngClass"],[1,"slds-text-body--regular"],["class","slds-p-left--x-small",4,"ngIf"],["class","slds-text-body--regular",4,"ngIf"],[1,"slds-p-left--x-small"],[1,"slds-grid","slds-p-horizontal--x-small"],[1,"slds-grid","slds-size--1-2","slds-grid--vertical-align-center"],["width","50px","height","50px",3,"src"],[1,"slds-text-heading--large","slds-grid","slds-grid--vertical-align-center"],[1,"slds-size--2-of-2","slds-p-left--medium"],[1,"slds-grid","slds-m-top--small","slds-m-bottom--xx-small","slds-p-horizontal--x-small","slds-p-vertical--small","slds-border--top","slds-border--bottom"],["class","slds-size--1-of-5 slds-text-body--small","style","cursor: pointer; max-width: 2.2rem",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid","slds-m-horizontal--xx-small"],["class","slds-size--1-of-5 slds-p-vertical--xx-small","style","cursor: pointer; max-width: 4.3rem",3,"ngStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-size--1-of-5","slds-text-body--small",2,"cursor","pointer","max-width","2.2rem",3,"ngClass","click"],[1,"slds-size--1-of-5","slds-p-vertical--xx-small",2,"cursor","pointer","max-width","4.3rem",3,"ngStyle","click"],[1,"slds-text-body--regular","slds-text-align--center"],[1,"slds-text-align--center"],[3,"src"],["c",""],[1,"slds-align--absolute-center",2,"height","100%"],[1,"slds-align--absolute-center","slds-text-heading--small",2,"height","100%"]],template:function(t,e){1&t&&(h.YNc(0,Bt,6,4,"div",0),h.YNc(1,Ut,2,0,"div",1),h.YNc(2,Ot,2,0,"div",2)),2&t&&(h.Q6J("ngIf",e.sortedDays&&e.sortedDays[0]),h.xp6(1),h.Q6J("ngIf",e.isLoading&&!e.sortedDays),h.xp6(1),h.Q6J("ngIf",!e.sortedDays&&!e.isLoading))},dependencies:[i.mk,i.sg,i.O5,i.PC,C.W],encapsulation:2}),DashboardWeatherDashlet})();var Gt=s(727),zt=s(6559),Kt=s(3369),Pt=s(6367),Wt=s(9574),Vt=s(2161),$t=s(7982),jt=s(151),Xt=s(6163),te=s(3634);const ee=["dashboard-generic-dashlet-row",""];function se(t,e){if(1&t&&(h.ynx(0),h.TgZ(1,"td",1),h._UZ(2,"field-container",2),h.qZA(),h.BQk()),2&t){const t=e.$implicit,s=h.oxw();h.xp6(1),h.uIk("data-label",s.language.getFieldDisplayName(s.module,t.field)),h.xp6(1),h.Q6J("field",t.field)("fieldconfig",t.fieldconfig)("fielddisplayclass","slds-truncate")}}let ie=(()=>{class DashboardGenericDashletRow{constructor(t,e,s,i,o){this.language=t,this.metadata=e,this.model=s,this.view=i,this.modelutilities=o,this.fieldsetfields=[],this.module="",this.fieldset="",this.data={},this.view.isEditable=!1,this.view.displayLabels=!1}ngOnInit(){this.model.module=this.module,this.model.id=this.data.id,this.model.setData(this.data),this.fieldsetfields=this.metadata.getFieldSetFields(this.fieldset)}trackByFn(t,e){return e.id}}return DashboardGenericDashletRow.ɵfac=function(t){return new(t||DashboardGenericDashletRow)(h.Y36(b.d),h.Y36(x.Pu),h.Y36(l.o),h.Y36(m.e),h.Y36(Xt.A))},DashboardGenericDashletRow.ɵcmp=h.Xpm({type:DashboardGenericDashletRow,selectors:[["","dashboard-generic-dashlet-row",""]],inputs:{module:"module",fieldset:"fieldset",data:"data"},features:[h._Bn([l.o,m.e])],attrs:ee,decls:1,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[2,"min-width","8rem"],[3,"field","fieldconfig","fielddisplayclass"]],template:function(t,e){1&t&&h.YNc(0,se,3,4,"ng-container",0),2&t&&h.Q6J("ngForOf",e.fieldsetfields)("ngForTrackBy",e.trackByFn)},dependencies:[i.sg,te.j],encapsulation:2}),DashboardGenericDashletRow})();function oe(t,e){if(1&t){const t=h.EpF();h.ynx(0),h.TgZ(1,"a",21),h.NdJ("click",(function(){h.CHM(t);const e=h.oxw().$implicit,s=h.oxw(2);return h.KtG(s.setSortField(e))})),h._UZ(2,"field-label",22)(3,"system-utility-icon",23),h.qZA(),h.BQk()}if(2&t){const t=h.oxw().$implicit;h.xp6(2),h.Q6J("fieldname",t.field)("fieldconfig",t.fieldconfig)}}function ae(t,e){if(1&t&&h._UZ(0,"field-label",24),2&t){const t=h.oxw().$implicit;h.Q6J("fieldname",t.field)("fieldconfig",t.fieldconfig)}}const de=function(t,e,s,i){return{"slds-is-sortable":t,"slds-is-sorted":e,"slds-is-sorted_desc":s,"slds-is-sorted_asc":i}};function ne(t,e){if(1&t&&(h.TgZ(0,"th",17)(1,"div",18),h.YNc(2,oe,4,2,"ng-container",19),h.YNc(3,ae,1,2,"ng-template",null,20,h.W1O),h.qZA()()),2&t){const t=e.$implicit,s=h.MAs(4),i=h.oxw(2);h.Q6J("ngClass",h.l5B(3,de,null==t.fieldconfig?null:t.fieldconfig.sortable,t.field==i.sortparams.sortfield,"DESC"==i.sortparams.sortdirection,"ASC"==i.sortparams.sortdirection)),h.xp6(2),h.Q6J("ngIf",null==t.fieldconfig?null:t.fieldconfig.sortable)("ngIfElse",s)}}function le(t,e){if(1&t&&(h.TgZ(0,"thead")(1,"tr",15),h.YNc(2,ne,5,8,"th",16),h.qZA()()),2&t){const t=h.oxw();h.xp6(2),h.Q6J("ngForOf",t.dashletFields)("ngForTrackBy",t.trackByFn)}}function re(t,e){if(1&t&&(h.ynx(0),h.TgZ(1,"div",25),h._uU(2),h.qZA(),h._UZ(3,"tr",26),h.BQk()),2&t){const t=e.$implicit,s=h.oxw();h.xp6(2),h.hij(" ",t.summary_text," "),h.xp6(1),h.Q6J("module",s.dashletModule)("fieldset",s.dashletFieldSet)("data",t)}}function he(t,e){if(1&t&&h._UZ(0,"tbody",27),2&t){const t=h.oxw();h.Q6J("columns",null==t.dashletFields?null:t.dashletFields.length)("select",!1)("tools",!1)("rows",5)}}function ce(t,e){1&t&&(h.TgZ(0,"div",28)(1,"system-illustration-no-records"),h._UZ(2,"system-label",29),h.qZA()())}function ue(t,e){1&t&&(h.TgZ(0,"div",28)(1,"system-illustration-page-not-available"),h._UZ(2,"system-label",30),h.qZA()())}let ge=(()=>{class DashboardGenericDashlet{constructor(t,e,s,i,o,a){this.language=t,this.metadata=e,this.backend=s,this.model=i,this.layout=o,this.broadcast=a,this.dashletFields=[],this.loading=!0,this.failedToLoad=!1,this.records=[],this.recordCount=0,this.recordTotal=0,this.sortparams={sortdirection:"",sortfield:""},this.dashletconfig=null,this.subscriptions=new Gt.w0}ngOnInit(){this.subscribeToBroadcast(),this.setInitialValues(),this.loadRecords()}ngOnDestroy(){this.subscriptions.unsubscribe()}onScroll(t){t.scrollTop+t.clientHeight>=t.scrollHeight-5&&this.loadMore()}trackByFn(t,e){return e.id}subscribeToBroadcast(){this.subscriptions.add(this.broadcast.message$.subscribe((t=>{if(t.messagedata.module===this.dashletModule)switch(t.messagetype){case"model.delete":const e=this.records.findIndex((e=>e.id==t.messagedata.id));e>=0&&(this.records.splice(e,1),this.recordCount--,this.recordTotal--);break;case"model.save":this.records.findIndex((e=>e.id==t.messagedata.id))>=0&&(this.records=[],this.loadRecords())}})))}setInitialValues(){this.model.module=this.dashletModule,this.sortparams.sortfield=this.dashletconfig.sortfield,this.sortparams.sortdirection=this.dashletconfig.sortdirection,this.dashletconfig.fieldset&&(this.dashletFields=this.metadata.getFieldSetFields(this.dashletconfig.fieldset),this.dashletFieldSet=this.dashletconfig.fieldset)}loadRecords(){this.records=[],this.loading=!0;const t={limit:isNaN(this.dashletconfig?.limit)?50:this.dashletconfig.limit,modulefilter:this.dashletconfig.modulefilter,sortfields:[{sortfield:this.sortparams.sortfield,sortdirection:this.sortparams.sortdirection}]};this.dashletModule&&this.backend.getRequest("module/"+this.dashletModule,t).subscribe((t=>{this.records=t.list,this.recordCount=+t.list.length,this.recordTotal=t.totalcount,this.loading=!1,this.failedToLoad=!1}),(()=>{this.loading=!1,this.failedToLoad=!0}))}loadMore(){if(!(this.recordTotal>this.records.length)||this.loading)return;this.loading=!0;const t={limit:isNaN(this.dashletconfig?.limit)?50:this.dashletconfig.limit,offset:this.records.length,modulefilter:this.dashletconfig?.modulefilter,sortfields:[{sortfield:this.sortparams.sortfield,sortdirection:this.sortparams.sortdirection}]};this.backend.getRequest("module/"+this.dashletModule,t).subscribe((t=>{this.records=this.records.concat(t.list),this.recordCount+=+t.list.length,this.loading=!1,this.failedToLoad=!1}),(()=>{this.loading=!1,this.failedToLoad=!0}))}isSortable(t){return!0===t.fieldconfig?.sortable}setSortField(t){this.isSortable(t)&&(this.sortparams.sortfield&&this.sortparams.sortfield==t.field?"ASC"==this.sortparams.sortdirection?this.sortparams.sortdirection="DESC":(this.sortparams.sortfield="",this.sortparams.sortdirection=""):(this.sortparams.sortfield=t.field,this.sortparams.sortdirection="ASC"),this.loadRecords())}}return DashboardGenericDashlet.ɵfac=function(t){return new(t||DashboardGenericDashlet)(h.Y36(b.d),h.Y36(x.Pu),h.Y36(c.y),h.Y36(l.o),h.Y36(zt.b),h.Y36(Kt.f))},DashboardGenericDashlet.ɵcmp=h.Xpm({type:DashboardGenericDashlet,selectors:[["dashboard-generic-dashlet"]],features:[h._Bn([l.o,m.e])],decls:19,vars:11,consts:[[1,"slds-grid","slds-grid--vertical","slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["size","small",3,"module"],[1,"slds-truncate","slds-grow","slds-text-heading--medium","slds-p-bottom--xx-small"],[3,"label"],["label","LBL_OF"],["system-title","LBL_RELOAD",1,"slds-button","slds-button--icon","slds-button--icon-border","slds-m-horizontal--xxx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-scrollable--y","slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0",3,"scroll"],["tableContainer",""],[1,"slds-table","slds-table--bordered","slds-table--fixed-layout","slds-max-medium-table--stacked-horizontal","slds-table--header-fixed"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["system-table-stencils","",3,"columns","select","tools","rows",4,"ngIf"],["class","slds-align_absolute-center slds-grow","style","min-height: 0",4,"ngIf"],[1,"slds-text-title_caps"],["scope","col","system-resize","","class","slds-resizable",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["scope","col","system-resize","",1,"slds-resizable",3,"ngClass"],[1,"slds-truncate"],[4,"ngIf","ngIfElse"],["nosort",""],["href","javascript:void(0);",1,"slds-th__action","slds-text-link--reset",3,"click"],["addclasses","slds-truncate",1,"slds-truncate",3,"fieldname","fieldconfig"],["icon","arrowdown","addclasses","slds-is-sortable__icon","size","x-small"],["addclasses","slds-truncate slds-p-vertical--xx-small slds-p-horizontal--x-small",3,"fieldname","fieldconfig"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small","slds-hide--medium","slds-text-title_bold"],["dashboard-generic-dashlet-row","",3,"module","fieldset","data"],["system-table-stencils","",3,"columns","select","tools","rows"],[1,"slds-align_absolute-center","slds-grow",2,"min-height","0"],["label","MSG_NO_RECORDS_FOUND"],["label","ERR_LOADING_RECORDS"]],template:function(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",0)(1,"div",1),h._UZ(2,"system-icon",2),h.TgZ(3,"h2",3),h._UZ(4,"system-label",4),h._uU(5),h._UZ(6,"system-label",5),h._uU(7),h.qZA(),h.TgZ(8,"button",6),h.NdJ("click",(function(){return e.loadRecords()})),h._UZ(9,"system-button-icon",7),h.qZA()(),h.TgZ(10,"div",8,9),h.NdJ("scroll",(function(){h.CHM(t);const s=h.MAs(11);return h.KtG(e.onScroll(s))})),h.TgZ(12,"table",10),h.YNc(13,le,3,2,"thead",11),h.TgZ(14,"tbody"),h.YNc(15,re,4,4,"ng-container",12),h.qZA(),h.YNc(16,he,1,4,"tbody",13),h.qZA(),h.YNc(17,ce,3,0,"div",14),h.YNc(18,ue,3,0,"div",14),h.qZA()()}2&t&&(h.xp6(2),h.Q6J("module",e.dashletModule),h.xp6(2),h.Q6J("label",e.dashletLabel),h.xp6(1),h.hij(" (",e.recordCount," "),h.xp6(2),h.hij(" ",e.recordTotal,")"),h.xp6(1),h.Q6J("disabled",e.loading),h.xp6(5),h.Q6J("ngIf","small"!=e.layout.screenwidth),h.xp6(2),h.Q6J("ngForOf",e.records)("ngForTrackBy",e.trackByFn),h.xp6(1),h.Q6J("ngIf",e.loading),h.xp6(1),h.Q6J("ngIf",!e.loading&&0==e.records.length&&!e.failedToLoad),h.xp6(1),h.Q6J("ngIf",!e.loading&&e.failedToLoad))},dependencies:[i.mk,i.sg,i.O5,Pt.q,w.J,pt.f,H.C,Wt.k,A._,Vt.x,B.r,$t.h,jt.S,ie],encapsulation:2}),DashboardGenericDashlet})();var me=s(2057);const pe=function(t){return{"slds-text-color_error":t}};function be(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",5)(1,"div",6)(2,"div",7),h._UZ(3,"system-icon",8),h.qZA(),h.TgZ(4,"div",9)(5,"div",10),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw();return h.KtG(s.goRecord(e.module_name,e.item_id))})),h._uU(6),h.qZA(),h.TgZ(7,"div",11),h._uU(8),h.qZA()()(),h.TgZ(9,"system-utility-icon",12),h.NdJ("click",(function(){const e=h.CHM(t).$implicit,s=h.oxw();return h.KtG(s.deleteRecord(e.module_name,e.item_id))})),h.qZA()()}if(2&t){const t=e.$implicit,s=h.oxw();h.xp6(3),h.Q6J("module",t.module_name)("size","small"),h.xp6(3),h.Oqu(t.item_summary),h.xp6(1),h.Q6J("ngClass",h.VKq(7,pe,s.isOverdue(t.reminder_date))),h.xp6(1),h.Oqu(s.getReminderDate(t.reminder_date)),h.xp6(1),h.Q6J("icon","delete")("size","x-small")}}let fe=(()=>{class DashboardRemindersDashlet{constructor(t,e,s,i){this.language=t,this.metadata=e,this.reminder=s,this.router=i,this.dashletLabel=void 0}get recordcount(){return this.reminder.reminders.length}get dashletTitle(){return this.language.getLabel(this.dashletLabel)}get reminders(){return this.reminder.reminders.map((t=>(t.reminder_date=new moment(t.reminder_date),t))).sort(((t,e)=>t.reminder_date-e.reminder_date))}trackByFn(t,e){return e.item_id}goRecord(t,e){this.router.navigate(["/module/"+t+"/"+e])}deleteRecord(t,e){this.reminder.deleteReminder(t,e)}getReminderDate(t){return t.format("DD.MM.YYYY")}isOverdue(t){return t<new moment}}return DashboardRemindersDashlet.ɵfac=function(t){return new(t||DashboardRemindersDashlet)(h.Y36(b.d),h.Y36(x.Pu),h.Y36(me.U),h.Y36(lt.F0))},DashboardRemindersDashlet.ɵcmp=h.Xpm({type:DashboardRemindersDashlet,selectors:[["dashboard-reminders-dashlet"]],decls:6,vars:7,consts:[[2,"height","100%","overflow","hidden"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],[3,"icon","sprite","size"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],["class","slds-p-around--x-small slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-p-around--x-small","slds-grid"],[1,"slds-media"],[1,"slds-media__figure"],[3,"module","size"],[1,"slds-media__body"],[1,"slds-text-title_caps","slds-text-link_reset",3,"click"],[1,"slds-text-body_small","slds-line-height_reset",3,"ngClass"],[1,"slds-col_bump-left",2,"cursor","pointer",3,"icon","size","click"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0)(1,"div",1),h._UZ(2,"system-icon",2),h.TgZ(3,"h2",3),h._uU(4),h.qZA()(),h.YNc(5,be,10,9,"div",4),h.qZA()),2&t&&(h.xp6(2),h.Q6J("icon","clock")("sprite","utility")("size","small"),h.xp6(2),h.AsE("",e.dashletTitle," (",e.recordcount,")"),h.xp6(1),h.Q6J("ngForOf",e.reminders)("ngForTrackBy",e.trackByFn))},dependencies:[i.mk,i.sg,pt.f,B.r],encapsulation:2}),DashboardRemindersDashlet})();const ye=["componentcontainer"];let xe=(()=>{class DashboardComponentset{constructor(t){this.metadata=t,this.componentRefs=[]}ngAfterViewInit(){this.renderComnponentset()}ngOnDestroy(){for(let t of this.componentRefs)t.destroy()}renderComnponentset(){if(this.dashletconfig&&this.dashletconfig.componentset)for(let t of this.metadata.getComponentSetObjects(this.dashletconfig.componentset))this.metadata.addComponent(t.component,this.componentcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}}return DashboardComponentset.ɵfac=function(t){return new(t||DashboardComponentset)(h.Y36(x.Pu))},DashboardComponentset.ɵcmp=h.Xpm({type:DashboardComponentset,selectors:[["dashboard-componentset"]],viewQuery:function(t,e){if(1&t&&h.Gf(ye,7,h.s_b),2&t){let t;h.iGM(t=h.CRH())&&(e.componentcontainer=t.first)}},decls:2,vars:0,consts:[["componentcontainer",""]],template:function(t,e){1&t&&h._UZ(0,"div",null,0)},encapsulation:2}),DashboardComponentset})(),we=(()=>{class ModuleDashboard{}return ModuleDashboard.ɵfac=function(t){return new(t||ModuleDashboard)},ModuleDashboard.ɵmod=h.oAB({type:ModuleDashboard}),ModuleDashboard.ɵinj=h.cJS({imports:[i.ez,o.u5,d.ObjectFields,n.SystemComponents,a.o]}),ModuleDashboard})();("undefined"==typeof ngJitMode||ngJitMode)&&h.kYT(we,{declarations:[nt,M,ct,Q,mt,it,P,At,Rt,ge,ie,fe,xe,D],imports:[i.ez,o.u5,d.ObjectFields,n.SystemComponents,a.o],exports:[ct]})}}]);