/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-15 08:39:15
 *
 *                     build: 2023.02.001.1692081555935
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_mailboxes_modulemailboxes_ts"],{9028:(e,s,i)=>{i.r(s),i.d(s,{ModuleMailboxes:()=>os});var t=i(1180),l=i(4755),a=i(5030),o=i(4357),n=i(4826),d=i(6490),c=i(3190),r=i(3735),m=i(2242),u=i(727),h=i(1135),g=i(7579),b=i(4505),p=i(3369);let x=(()=>{var e;class mailboxesEmails{constructor(e,s){(0,t.Z)(this,"backend",void 0),(0,t.Z)(this,"broadcast",void 0),(0,t.Z)(this,"mailboxesLoaded$",void 0),(0,t.Z)(this,"activeSplitType",{name:"noSplit",icon:"picklist_type",label:"LBL_NO_SPLIT"}),(0,t.Z)(this,"limit",50),(0,t.Z)(this,"mailboxes",[]),(0,t.Z)(this,"emails",[]),(0,t.Z)(this,"totalcount",0),(0,t.Z)(this,"source","fts"),(0,t.Z)(this,"_activeMailBox",void 0),(0,t.Z)(this,"_activeMessage",void 0),(0,t.Z)(this,"activeMessage$",new m.vpe),(0,t.Z)(this,"_unreadonly",!0),(0,t.Z)(this,"isLoading",!1),(0,t.Z)(this,"emailopenness",""),(0,t.Z)(this,"serviceSubscriptions",new u.w0),(0,t.Z)(this,"searchTerm",void 0),this.backend=e,this.broadcast=s,this.mailboxesLoaded$=new h.X(!1),this.getMailboxes(),this.serviceSubscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleMessage(e)})))}ngOnDestroy(){this.serviceSubscriptions.unsubscribe()}get activeMessage(){return this._activeMessage}set activeMessage(e){this._activeMessage=e,this.activeMessage$.emit(e)}get activeMailBox(){return this._activeMailBox}set activeMailBox(e){this._activeMailBox=e,this.emails=[],this.totalcount=0}get unreadonly(){return this._unreadonly}set unreadonly(e){this._unreadonly=e,this.loadMessages()}getMailboxes(){this.backend.getRequest("module/Mailboxes/scope",{scope:"inbound"}).subscribe((e=>{for(let s of e)this.mailboxes.push({actionset:s.actionset,id:s.value,name:s.display,type:s.type});this.mailboxesLoaded$.next(!0)}))}handleMessage(e){if("Emails"===e.messagedata.module)switch(e.messagetype){case"model.delete":let s=this.emails.findIndex((s=>s.id==e.messagedata.id));s>=0&&(this.activeMessage.id==e.messagedata.id&&(this.activeMessage=void 0),this.emails.splice(s,1),this.totalcount--);break;case"model.save":let i=this.emails.findIndex((s=>s.id==e.messagedata.id));i>=0&&(this.emails[i]=e.messagedata.data)}}fetchEmails(){let e=new g.x;return this.backend.getRequest("module/Mailboxes/"+this.activeMailBox.id+"/fetchemails").subscribe((s=>{s.new_mail_count>0&&this.loadMessages(),e.next({status:"success",newmailcount:s.new_mail_count}),e.complete()}),(s=>{e.error({status:"error",error:s}),e.complete()})),e.asObservable()}generateFilters(){let e={logicaloperator:"and",groupscope:"all",conditions:[{field:"mailbox_id",filtervalue:this.activeMailBox.id,operator:"equals"}]};return"sms"==this.activeMailBox.type?e.conditions.push({field:"direction",filtervalue:"i",operator:"equals"}):(e.conditions.push({field:"type",filtervalue:"inbound",operator:"equals"}),this.emailopenness&&e.conditions.push({field:"openness",filtervalue:this.emailopenness,operator:"equals"}),this.unreadonly&&e.conditions.push({field:"status",filtervalue:"unread",operator:"equals"})),e}get endpoint(){return"sms"==this.activeMailBox.type?"module/TextMessages":"module/Emails"}get requestFields(){return"sms"==this.activeMailBox.type?["name","id","msisdn_e164","date_sent","description"]:["name","id","from_addr_name","date_sent","status","openness","sentiment","magnitude"]}loadMessages(){if(!this.activeMailBox||this.activeMailBox&&!this.activeMailBox.id)return!1;this.activeMessage=void 0,this.emails=[];this.activeMailBox.id;let e={filter:this.generateFilters(),sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}],fields:JSON.stringify(this.requestFields),limit:this.limit,searchterm:this.searchTerm};this.isLoading=!0,this.backend.getRequest(this.endpoint,e).subscribe((e=>{this.emails=e.list,this.source=e.source,this.totalcount=e.totalcount,this.isLoading=!1}))}loadMore(){if(this.isLoading||this.emails.length>=this.totalcount)return!1;this.isLoading=!0;let e={fields:JSON.stringify(this.requestFields),filter:this.generateFilters(),limit:this.limit,offset:this.emails.length,sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}]};this.backend.getRequest(this.endpoint,e).subscribe((e=>{e.list.length>0&&(this.emails=this.emails.concat(e.list),this.source=e.source,this.totalcount=e.totalcount),this.isLoading=!1}))}}return e=mailboxesEmails,(0,t.Z)(mailboxesEmails,"ɵfac",(function(s){return new(s||e)(m.LFG(b.y),m.LFG(p.f))})),(0,t.Z)(mailboxesEmails,"ɵprov",m.Yz7({token:e,factory:e.ɵfac})),mailboxesEmails})();var f=i(2032),v=i(7017),Z=i(3194),M=i(5329),y=i(4154),E=i(6625),T=i(2656),L=i(7514),w=i(6271),C=i(3463),k=i(8859),J=i(5982);function A(e,s){if(1&e&&(m.TgZ(0,"option",34),m._uU(1),m.qZA()),2&e){const e=s.$implicit;m.s9C("value",e.id),m.xp6(1),m.hij(" ",e.name," ")}}const S=function(e){return{"slds-has-error":e}};function B(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"div",35)(1,"div",36),m._UZ(2,"system-utility-icon",37),m.TgZ(3,"input",38),m.NdJ("ngModelChange",(function(s){m.CHM(e);const i=m.oxw();return m.KtG(i.searchTerm=s)}))("keyup.enter",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.reloadList())})),m.qZA(),m.TgZ(4,"button",39),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.clearSearchTerm())})),m._UZ(5,"system-button-icon",40),m.qZA()()()}if(2&e){const e=m.oxw();m.Q6J("ngClass",m.VKq(4,S,e.searchTermError)),m.xp6(3),m.Q6J("placeholder",e.language.getModuleCombinedLabel("LBL_SEARCH","Mailboxes"))("ngModel",e.searchTerm),m.xp6(1),m.Q6J("disabled",!e.mailboxesEmails.searchTerm)}}let Y=(()=>{var e;class MailboxManagerHeader{constructor(e,s,i,l,a){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"mailboxesEmails",void 0),(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"navigationtab",void 0),(0,t.Z)(this,"configuration",void 0),(0,t.Z)(this,"splitTypeOptions",[{value:"noSplit",icon:"picklist_type",title:"LBL_NO_SPLIT"},{value:"verticalSplit",icon:"side_list",title:"LBL_VERTICAL_SPLIT"},{value:"horizontalSplit",icon:"inspector_panel",title:"LBL_HORIZONTAL_SPLIT"}]),(0,t.Z)(this,"searchTermError",!1),(0,t.Z)(this,"isFetching",!1),(0,t.Z)(this,"searchTimeOut",void 0),(0,t.Z)(this,"_mailbox",void 0),this.language=e,this.mailboxesEmails=s,this.metadata=i,this.navigationtab=l,this.configuration=a;let o=this.metadata.getComponentConfig("MailboxManagerHeader");this.emailopenness=o.selectionstatus?o.selectionstatus:"",this.mailboxesEmails.unreadonly=!!o.unreadonly&&o.unreadonly}get mailbox(){return this._mailbox}set mailbox(e){this._mailbox=e,e?(this.mailboxesEmails.activeMailBox=this.mailboxesEmails.mailboxes.find((s=>s.id==e)),this.mailboxesEmails.loadMessages(),this.navigationtab.setTabInfo({displayname:this.mailboxesEmails.activeMailBox.name,displaymodule:"Mailboxes"})):this.mailboxesEmails.activeMailBox={}}get emailopenness(){return""==this.mailboxesEmails.emailopenness?"all":this.mailboxesEmails.emailopenness}set emailopenness(e){this.mailboxesEmails.emailopenness="all"==e?"":e,this.mailboxesEmails.loadMessages()}get buttonenabled(){return this.mailboxesEmails.activeMailBox&&!this.mailboxesEmails.isLoading&&!this.isFetching}get searchTerm(){return this.mailboxesEmails.searchTerm}set searchTerm(e){e!=this.mailboxesEmails.searchTerm&&(this.mailboxesEmails.searchTerm=e,""==e||this.searchTermsValid(e)?(this.searchTermError=!1,this.reloadList()):(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTermError=!0))}ngOnInit(){this.loadOneMailbox(),this.navigationtab.activeRoute.params.id&&this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&(this.mailbox=this.navigationtab.activeRoute.params.id)}))}loadOneMailbox(){this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&1==this.mailboxesEmails.mailboxes.length&&(this.mailbox=this.mailboxesEmails.mailboxes[0].id)}))}clearSearchTerm(){this.mailboxesEmails.searchTerm=void 0,this.reloadList()}searchTermsValid(e){let s=this.configuration.getCapabilityConfig("search"),i=s.min_ngram?parseInt(s.min_ngram,10):3,t=s.max_ngram?parseInt(s.max_ngram,10):20;return 0==e.split(" ").filter((e=>e.length<i||e.length>t)).length}reloadList(){this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.mailboxesEmails.loadMessages()),1e3)}fetchEmails(){this.isFetching=!0,this.mailboxesEmails.fetchEmails().subscribe((e=>{this.isFetching=!1}),(e=>{this.isFetching=!1}))}setActiveSplitType(e){const s={name:e};switch(e){case"noSplit":this.mailboxesEmails.activeMessage=null,s.icon="picklist_type",s.label="LBL_NO_SPLIT";break;case"verticalSplit":s.icon="side_list",s.label="LBL_VERTICAL_SPLIT";break;case"horizontalSplit":s.icon="inspector_panel",s.label="LBL_HORIZONTAL_SPLIT"}this.mailboxesEmails.activeSplitType=s}}return e=MailboxManagerHeader,(0,t.Z)(MailboxManagerHeader,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(x),m.Y36(y.Pu),m.Y36(v.d),m.Y36(E.C))})),(0,t.Z)(MailboxManagerHeader,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-header"]],decls:43,vars:13,consts:[[1,"slds-grid","slds-form--inline","slds-p-around--small","slds-border--bottom"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-p-right--xx-small"],[1,"slds-select_container"],[1,"slds-select",2,"min-width","250px",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__control","slds-p-horizontal--xx-small"],[3,"ngModel","ngModelChange"],["label","LBL_UNREAD_ONLY"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","all"],["label","LBL_EMAILS_ALL"],["value","open"],["label","LBL_EMAILS_OPEN"],["value","user_closed"],["label","LBL_EMAILS_USER_CLOSED"],["value","system_closed"],["label","LBL_EMAILS_SYSTEM_CLOSED"],[1,"slds-p-horizontal--xx-small"],[1,"slds-list_horizontal","slds-has-dividers_left","slds-has-block-links_space"],[1,"slds-item"],["label","LBL_OF"],["label","LBL_ITEMS"],["size","xx-small",3,"icon"],["class","slds-form-element slds-p-right--small slds-m-left--small","style","width: 400px",3,"ngClass",4,"ngIf"],[1,"slds-col--bump-left","slds-grid"],[1,"slds-m-horizontal--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","refresh",1,"slds-button__icon--left"],["label","LBL_REFRESH"],["icon","email",1,"slds-button__icon--left"],["label","LBL_FETCH_EMAILS"],[3,"value"],[1,"slds-form-element","slds-p-right--small","slds-m-left--small",2,"width","400px",3,"ngClass"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--left-right","slds-size--1-of-1"],["icon","search","size","x-small","addclasses","slds-icon slds-input__icon slds-input__icon_left"],["system-autofocus","","type","search",1,"slds-input","slds-lookup__search-input",2,"max-width","400px",3,"placeholder","ngModel","ngModelChange","keyup.enter"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled","click"],["icon","clear"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"select",4),m.NdJ("ngModelChange",(function(e){return s.mailbox=e})),m.YNc(5,A,2,2,"option",5),m.qZA()()(),m.TgZ(6,"div",6)(7,"system-checkbox",7),m.NdJ("ngModelChange",(function(e){return s.mailboxesEmails.unreadonly=e})),m._UZ(8,"system-label",8),m.qZA()(),m.TgZ(9,"div",6)(10,"div",3)(11,"select",9),m.NdJ("ngModelChange",(function(e){return s.emailopenness=e})),m.TgZ(12,"option",10),m._UZ(13,"system-label",11),m.qZA(),m.TgZ(14,"option",12),m._UZ(15,"system-label",13),m.qZA(),m.TgZ(16,"option",14),m._UZ(17,"system-label",15),m.qZA(),m.TgZ(18,"option",16),m._UZ(19,"system-label",17),m.qZA()()()(),m.TgZ(20,"div",18)(21,"ul",19)(22,"li",20)(23,"span"),m._uU(24),m._UZ(25,"system-label",21),m._uU(26),m._UZ(27,"system-label",22),m.qZA()(),m.TgZ(28,"li",20),m._UZ(29,"system-utility-icon",23),m.qZA()()(),m.YNc(30,B,6,6,"div",24),m.qZA(),m.TgZ(31,"div",25)(32,"div",26)(33,"system-input-radio-button-group",27),m.NdJ("ngModelChange",(function(e){return s.setActiveSplitType(e)})),m.qZA()(),m.TgZ(34,"div",28)(35,"button",29),m.NdJ("click",(function(){return s.reloadList()})),m._UZ(36,"system-button-icon",30),m.TgZ(37,"span"),m._UZ(38,"system-label",31),m.qZA()(),m.TgZ(39,"button",29),m.NdJ("click",(function(){return s.fetchEmails()})),m._UZ(40,"system-button-icon",32),m.TgZ(41,"span"),m._UZ(42,"system-label",33),m.qZA()()()()()),2&e&&(m.xp6(4),m.Q6J("ngModel",s.mailbox)("disabled",0==s.mailboxesEmails.mailboxes.length||s.isFetching),m.xp6(1),m.Q6J("ngForOf",s.mailboxesEmails.mailboxes),m.xp6(2),m.Q6J("ngModel",s.mailboxesEmails.unreadonly),m.xp6(4),m.Q6J("ngModel",s.emailopenness),m.xp6(13),m.hij("",s.mailboxesEmails.emails.length," "),m.xp6(2),m.hij(" ",s.mailboxesEmails.totalcount," "),m.xp6(3),m.Q6J("icon","db"==s.mailboxesEmails.source?"database":"feed"),m.xp6(1),m.Q6J("ngIf",!!s.mailbox),m.xp6(3),m.Q6J("ngModel",s.mailboxesEmails.activeSplitType.name)("inputOptions",s.splitTypeOptions),m.xp6(2),m.Q6J("disabled",!s.buttonenabled),m.xp6(4),m.Q6J("disabled",!s.buttonenabled))},dependencies:[l.mk,l.sg,l.O5,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.On,T.J,L.U,w.p,C._,k.r,J.m],encapsulation:2})),MailboxManagerHeader})();var q=i(4664),F=i(5710),I=i(2294),Q=i(6163),N=i(3634);function O(e,s){1&e&&m._UZ(0,"system-utility-icon",9)}const U=function(e){return{"slds-theme_default":e}},R=function(){return{fieldtype:"emailsubject"}},D=function(){return{fieldtype:"activitydate"}};let H=(()=>{var e;class MailboxManagerEmail{constructor(e,s,i,l,a,o){(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"mailboxesEmails",void 0),(0,t.Z)(this,"view",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"modelutilities",void 0),(0,t.Z)(this,"email",{}),(0,t.Z)(this,"fieldset",void 0),this.metadata=e,this.language=s,this.mailboxesEmails=i,this.view=l,this.model=a,this.modelutilities=o,this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerEmail").fieldset}ngOnInit(){this.model.module="Emails",this.model.id=this.email.id,this.model.setData(this.email)}selectMail(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.email.status&&(e["font-weight"]="bold"),this.email.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}}return e=MailboxManagerEmail,(0,t.Z)(MailboxManagerEmail,"ɵfac",(function(s){return new(s||e)(m.Y36(y.Pu),m.Y36(M.d),m.Y36(x),m.Y36(I.e),m.Y36(F.o),m.Y36(Q.A))})),(0,t.Z)(MailboxManagerEmail,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-email"]],inputs:{email:"email"},features:[m._Bn([F.o,I.e])],decls:9,vars:10,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--xx-small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid"],[1,"slds-grow","slds-truncate"],["field","name","fielddisplayclass","",1,"slds-grow","slds-truncate","slds-p-right--xx-small","spice-display-block",3,"fieldconfig"],["field","from_addr","fielddisplayclass","",1,"slds-truncate","spice-display-block",2,"min-width","220px","width","220px"],[1,"slds-p-left--xx-small","slds-truncate","slds-grid","slds-grid--align-spread",2,"min-width","100px","width","100px"],[2,"width","22px"],["icon","attach","size","xx-small","class","slds-p-right--x-small",4,"ngIf"],["field","date_sent","fielddisplayclass","",1,"slds-truncate",3,"fieldconfig"],["icon","attach","size","xx-small",1,"slds-p-right--x-small"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0),m.NdJ("click",(function(){return s.selectMail(s.email)})),m.TgZ(1,"div",1)(2,"div",2),m._UZ(3,"field-container",3)(4,"field-container",4),m.qZA(),m.TgZ(5,"div",5)(6,"div",6),m.YNc(7,O,1,0,"system-utility-icon",7),m.qZA(),m._UZ(8,"field-container",8),m.qZA()()()),2&e&&(m.Q6J("ngClass",m.VKq(6,U,s.isSelected)),m.xp6(2),m.ekj("slds-grid","verticalSplit"!=(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),m.xp6(1),m.Q6J("fieldconfig",m.DdM(8,R)),m.xp6(4),m.Q6J("ngIf",s.email.attachments_count>0),m.xp6(1),m.Q6J("fieldconfig",m.DdM(9,D)))},dependencies:[l.mk,l.O5,N.j,k.r],encapsulation:2})),MailboxManagerEmail})();function j(e,s){if(1&e&&m._UZ(0,"mailbox-manager-email",4),2&e){const e=s.$implicit;m.Q6J("email",e)}}function z(e,s){1&e&&(m.TgZ(0,"div",5),m._UZ(1,"system-spinner"),m.qZA())}let G=(()=>{var e;class MailboxManagerEmails{constructor(e){(0,t.Z)(this,"mailboxesEmails",void 0),this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}}return e=MailboxManagerEmails,(0,t.Z)(MailboxManagerEmails,"ɵfac",(function(s){return new(s||e)(m.Y36(x))})),(0,t.Z)(MailboxManagerEmails,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-emails"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-height_full","slds-border--right",3,"scroll"],["scrollContainer",""],[3,"email",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium slds-align--absolute-center",4,"ngIf"],[3,"email"],[1,"slds-p-around--medium","slds-align--absolute-center"]],template:function(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"div",0,1),m.NdJ("scroll",(function(){m.CHM(e);const i=m.MAs(1);return m.KtG(s.loadmore(i))})),m.YNc(2,j,1,1,"mailbox-manager-email",2),m.YNc(3,z,2,0,"div",3),m.qZA()}2&e&&(m.xp6(2),m.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),m.xp6(1),m.Q6J("ngIf",s.mailboxesEmails.isLoading))},dependencies:[l.sg,l.O5,q.W,H],encapsulation:2})),MailboxManagerEmails})();var K=i(3278),P=i(4044),$=i(8861),X=i(5931),V=i(4561),W=i(151);const ee=["detailscontent"];function se(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"button",9),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.goBack())})),m._UZ(1,"system-button-icon",10),m.qZA()}}function ie(e,s){if(1&e&&(m.ynx(0),m._uU(1),m.BQk()),2&e){const e=m.oxw(2);m.xp6(1),m.Oqu(e.model.data.summary_text)}}function te(e,s){if(1&e&&m._UZ(0,"object-record-fieldset-horizontal-list",32),2&e){const e=m.oxw(2);m.Q6J("fieldset",e.fieldset)}}function le(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"button",26),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw(2);return m.KtG(s.delete())})),m._UZ(1,"system-button-icon",33),m.qZA()}if(2&e){const e=m.oxw(2);m.Q6J("title",e.language.getLabel("LBL_DELETE"))}}function ae(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"button",34),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw(2);return m.KtG(s.markUnread())})),m._UZ(1,"system-button-icon",35),m.qZA()}if(2&e){const e=m.oxw(2);m.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_UNREAD"))}}function oe(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"button",34),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw(2);return m.KtG(s.completeMail())})),m._UZ(1,"system-button-icon",36),m.qZA()}if(2&e){const e=m.oxw(2);m.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function ne(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"button",34),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw(2);return m.KtG(s.reopen())})),m._UZ(1,"system-button-icon",37),m.qZA()}if(2&e){const e=m.oxw(2);m.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}function de(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14),m._UZ(4,"system-icon",15),m.TgZ(5,"div",16)(6,"ul",17)(7,"li",18),m._UZ(8,"field-container",19),m.qZA(),m.TgZ(9,"li",18),m._UZ(10,"field-container",20),m.qZA()(),m.TgZ(11,"h1",21),m.YNc(12,ie,2,1,"ng-container",22),m.YNc(13,te,1,1,"object-record-fieldset-horizontal-list",23),m.qZA()()()(),m.TgZ(14,"object-action-container",24),m.NdJ("actionemitter",(function(s){m.CHM(e);const i=m.oxw();return m.KtG(i.handleAction(s))})),m.qZA(),m.TgZ(15,"div",25)(16,"button",26),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.replyToAll())})),m._UZ(17,"system-button-icon",27),m.qZA(),m.TgZ(18,"button",26),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.reply())})),m._UZ(19,"system-button-icon",28),m.qZA(),m.TgZ(20,"button",26),m.NdJ("click",(function(){m.CHM(e);const s=m.oxw();return m.KtG(s.forward())})),m._UZ(21,"system-button-icon",29),m.qZA(),m.YNc(22,le,2,1,"button",30),m.YNc(23,ae,2,2,"button",31),m.YNc(24,oe,2,2,"button",31),m.YNc(25,ne,2,2,"button",31),m.qZA()()()}if(2&e){const e=m.oxw();m.xp6(4),m.Q6J("module",e.model.module),m.xp6(8),m.Q6J("ngIf",!e.fieldset),m.xp6(1),m.Q6J("ngIf",e.fieldset),m.xp6(1),m.Q6J("actionset",e.actionSet),m.xp6(2),m.Q6J("title",e.language.getLabel("LBL_REPLY_ALL")),m.xp6(2),m.Q6J("title",e.language.getLabel("LBL_REPLY")),m.xp6(2),m.Q6J("title",e.language.getLabel("LBL_FORWARD")),m.xp6(2),m.Q6J("ngIf",e.model.checkAccess("delete")),m.xp6(1),m.Q6J("ngIf",e.isRead),m.xp6(1),m.Q6J("ngIf",!e.isUserClosed),m.xp6(1),m.Q6J("ngIf",e.isUserClosed)}}function ce(e,s){1&e&&(m.TgZ(0,"div",38),m._UZ(1,"system-label",39),m.qZA())}const re=function(e){return{"slds-hide":e}};let me=(()=>{var e;class MailboxmanagerEmailDetails{constructor(e,s,i,l,a,o,n,d,c){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"mailboxesEmails",void 0),(0,t.Z)(this,"backend",void 0),(0,t.Z)(this,"toast",void 0),(0,t.Z)(this,"view",void 0),(0,t.Z)(this,"modal",void 0),(0,t.Z)(this,"injector",void 0),(0,t.Z)(this,"detailscontent",void 0),(0,t.Z)(this,"containerComponents",[]),(0,t.Z)(this,"fieldset",""),(0,t.Z)(this,"mailboxSubscription",void 0),this.language=e,this.metadata=s,this.model=i,this.mailboxesEmails=l,this.backend=a,this.toast=o,this.view=n,this.modal=d,this.injector=c,this.mailboxSubscription=this.mailboxesEmails.activeMessage$.subscribe((e=>{this.loadEmail(e)})),this.view.displayLabels=!1}ngOnDestroy(){this.mailboxSubscription.unsubscribe()}loadEmail(e){this.mailboxesEmails.activeMailBox&&("sms"==this.mailboxesEmails.activeMailBox.type?this.model.module="TextMessages":"email"==this.mailboxesEmails.activeMailBox.type&&(this.model.module="Emails")),this.model.initialize(),e?(this.model.id=e.id,this.buildContainer(),this.model.getData(!1,"").subscribe((e=>{"unread"==this.model.getFieldValue("status")&&this.setStatus("read")}))):this.model.id=void 0}destroyContainer(){for(let e of this.containerComponents)e.destroy();this.containerComponents=[]}handleAction(e){if("save"===e)this.buildContainer()}buildContainer(){this.destroyContainer();let e=this.metadata.getComponentConfig("MailboxmanagerEmailDetails",this.model.module),s="horizontalSplit"==this.mailboxesEmails.activeSplitType.name?e.horizontalComponentset:e.componentset;for(let e of this.metadata.getComponentSetObjects(s))this.metadata.addComponent(e.component,this.detailscontent).subscribe((s=>{s.instance.componentconfig=e.componentconfig?e.componentconfig:{},this.containerComponents.push(s)}));this.fieldset=e.fieldset}get isUserClosed(){return"user_closed"==this.model.getField("openness")}get isRead(){return"read"==this.model.getField("status")}get actionSet(){return this.mailboxesEmails.activeMailBox.actionset?this.mailboxesEmails.activeMailBox.actionset:""}completeMail(){this.setOpenness("user_closed")}markUnread(){this.setStatus("unread")}reopen(){this.setOpenness("open")}setStatus(e){this.model.setField("status",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/status",null,{status:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.status=e}),(s=>{this.toast.sendAlert("Cannot change status to "+e)}))}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/openness",null,{openness:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.openness=e}),(s=>{this.toast.sendAlert("Cannot change openness to "+e)}))}replyToAll(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{e.instance.mode="replyall"}))}reply(){this.modal.openModal("EmailReplyModal",!0,this.injector)}forward(){this.modal.openModal("EmailForwardModal",!0,this.injector)}delete(){this.model.delete()}goBack(){this.mailboxesEmails.activeMessage=null}}return e=MailboxmanagerEmailDetails,(0,t.Z)(MailboxmanagerEmailDetails,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(y.Pu),m.Y36(F.o),m.Y36(x),m.Y36(b.y),m.Y36(K.A),m.Y36(I.e),m.Y36(P.o),m.Y36(m.zs3))})),(0,t.Z)(MailboxmanagerEmailDetails,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-email-details"]],viewQuery:function(e,s){if(1&e&&m.Gf(ee,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(s.detailscontent=e.first)}},features:[m._Bn([F.o,I.e])],decls:10,vars:8,consts:[[1,"slds-theme--shade","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"ngClass"],[1,"slds-grid","slds-border--bottom"],[1,"slds-grid","slds-grid--align-end","slds-p-vertical--medium",2,"width","3rem"],["system-title","LBL_BACK","class","slds-button slds-button--icon slds-button_icon-border-filled",3,"click",4,"ngIf"],["class","slds-p-around--medium slds-border--bottom slds-grow",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small","slds-theme--default","slds-scrollable--y","slds-grow",2,"min-height","0"],["detailscontent",""],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],["system-title","LBL_BACK",1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"click"],["icon","back"],[1,"slds-p-around--medium","slds-border--bottom","slds-grow"],[1,"slds-grid"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-list_horizontal","slds-has-dividers_left"],[1,"slds-item"],["field","date_sent","fielddisplayclass","slds-truncate"],["field","status","fielddisplayclass","slds-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[3,"fieldset",4,"ngIf"],[3,"actionset","actionemitter"],[1,"slds-p-left--small","slds-button-group"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"title","click"],["icon","reply_all"],["icon","reply"],["icon","forward"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"title","click",4,"ngIf"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"disabled","title","click",4,"ngIf"],[3,"fieldset"],["icon","delete"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"disabled","title","click"],["icon","email"],["icon","unlock"],["icon","lock"],[1,"slds-align--absolute-center","slds-height_full"],["label","LBL_SELECT_EMAIL"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m.YNc(4,se,2,0,"button",4),m.qZA(),m.YNc(5,de,26,11,"div",5),m.qZA(),m.TgZ(6,"div",6),m._UZ(7,"div",null,7),m.qZA()(),m.YNc(9,ce,2,0,"div",8),m.qZA()),2&e&&(m.xp6(1),m.Q6J("ngClass",m.VKq(6,re,!s.model.id)),m.xp6(3),m.Q6J("ngIf","noSplit"==s.mailboxesEmails.activeSplitType.name),m.xp6(1),m.Q6J("ngIf",s.model.id),m.xp6(1),m.Udp("padding-left","noSplit"==s.mailboxesEmails.activeSplitType.name?3:.5,"rem"),m.xp6(3),m.Q6J("ngIf",!s.model.id))},dependencies:[l.mk,l.O5,N.j,$.S,X.Z,T.J,V.f,C._,W.S],encapsulation:2})),MailboxmanagerEmailDetails})();var ue=i(9062);const he=function(e){return{"slds-theme_default":e}};let ge=(()=>{var e;class MailboxManagerTextMessage{constructor(e,s,i,l,a,o){(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"mailboxesEmails",void 0),(0,t.Z)(this,"view",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"modelutilities",void 0),(0,t.Z)(this,"message",{}),(0,t.Z)(this,"fieldset",void 0),this.metadata=e,this.language=s,this.mailboxesEmails=i,this.view=l,this.model=a,this.modelutilities=o,this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerTextMessage").fieldset}ngOnInit(){this.model.module="TextMessages",this.model.id=this.message.id,this.model.setData(this.message)}selectTextmessage(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.message.status&&(e["font-weight"]="bold"),this.message.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}}return e=MailboxManagerTextMessage,(0,t.Z)(MailboxManagerTextMessage,"ɵfac",(function(s){return new(s||e)(m.Y36(y.Pu),m.Y36(M.d),m.Y36(x),m.Y36(I.e),m.Y36(F.o),m.Y36(Q.A))})),(0,t.Z)(MailboxManagerTextMessage,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-textmessage"]],inputs:{message:"message"},features:[m._Bn([F.o,I.e])],decls:7,vars:6,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-text-title_caps","slds-truncate",3,"ngStyle"],[1,"slds-col--bump-left","slds-p-left--xx-small"],["field","date_sent","fielddisplayclass","slds-truncate"],["fielddisplayclass","",3,"fieldset"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0),m.NdJ("click",(function(){return s.selectTextmessage(s.message)})),m.TgZ(1,"div",1)(2,"div",2),m._uU(3),m.qZA(),m.TgZ(4,"div",3),m._UZ(5,"field-container",4),m.qZA()(),m._UZ(6,"object-record-fieldset",5),m.qZA()),2&e&&(m.Q6J("ngClass",m.VKq(4,he,s.isSelected)),m.xp6(2),m.Q6J("ngStyle",s.nameStyle),m.xp6(1),m.Oqu(s.message.description),m.xp6(3),m.Q6J("fieldset",s.fieldset))},dependencies:[l.mk,l.PC,N.j,ue.d],encapsulation:2})),MailboxManagerTextMessage})();function be(e,s){if(1&e&&m._UZ(0,"mailbox-manager-textmessage",4),2&e){const e=s.$implicit;m.Q6J("message",e)}}function pe(e,s){1&e&&(m.TgZ(0,"div",5),m._UZ(1,"system-spinner"),m.qZA())}let xe=(()=>{var e;class MailboxManagerTextMessages{constructor(e){(0,t.Z)(this,"mailboxesEmails",void 0),this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}}return e=MailboxManagerTextMessages,(0,t.Z)(MailboxManagerTextMessages,"ɵfac",(function(s){return new(s||e)(m.Y36(x))})),(0,t.Z)(MailboxManagerTextMessages,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager-textmessages"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-border--right","slds-height_full",3,"scroll"],["scrollContainer",""],[3,"message",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium",4,"ngIf"],[3,"message"],[1,"slds-p-around--medium"]],template:function(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"div",0,1),m.NdJ("scroll",(function(){m.CHM(e);const i=m.MAs(1);return m.KtG(s.loadmore(i))})),m.YNc(2,be,1,1,"mailbox-manager-textmessage",2),m.YNc(3,pe,2,0,"div",3),m.qZA()}2&e&&(m.xp6(2),m.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),m.xp6(1),m.Q6J("ngIf",s.mailboxesEmails.isLoading))},dependencies:[l.sg,l.O5,q.W,ge],encapsulation:2})),MailboxManagerTextMessages})();function fe(e,s){if(1&e&&m._UZ(0,"mailbox-manager-emails",6),2&e){const e=m.oxw(2);m.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function ve(e,s){if(1&e&&m._UZ(0,"mailbox-manager-textmessages",6),2&e){const e=m.oxw(2);m.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function Ze(e,s){if(1&e&&(m.TgZ(0,"div",4),m.YNc(1,fe,1,2,"mailbox-manager-emails",5),m.YNc(2,ve,1,2,"mailbox-manager-textmessages",5),m._UZ(3,"mailbox-manager-email-details",6),m.qZA()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngIf",e.isEmailMailbox),m.xp6(1),m.Q6J("ngIf",!e.isEmailMailbox),m.xp6(1),m.ekj("slds-hide",!e.mailboxesEmails.activeMessage)}}function Me(e,s){1&e&&m._UZ(0,"mailbox-manager-emails",9)}function _e(e,s){1&e&&m._UZ(0,"mailbox-manager-textmessages",9)}function ye(e,s){if(1&e&&(m.TgZ(0,"div",4),m.YNc(1,Me,1,0,"mailbox-manager-emails",7),m.YNc(2,_e,1,0,"mailbox-manager-textmessages",7),m._UZ(3,"mailbox-manager-email-details",8),m.qZA()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngIf",e.isEmailMailbox),m.xp6(1),m.Q6J("ngIf",!e.isEmailMailbox)}}function Ee(e,s){1&e&&m._UZ(0,"mailbox-manager-emails",13)}function Te(e,s){1&e&&m._UZ(0,"mailbox-manager-textmessages",13)}function Le(e,s){if(1&e&&(m.TgZ(0,"div",10),m.YNc(1,Ee,1,0,"mailbox-manager-emails",11),m.YNc(2,Te,1,0,"mailbox-manager-textmessages",11),m._UZ(3,"mailbox-manager-email-details",12),m.qZA()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngIf",e.isEmailMailbox),m.xp6(1),m.Q6J("ngIf",!e.isEmailMailbox)}}let we=(()=>{var e;class MailboxManager{constructor(e,s,i){(0,t.Z)(this,"navigation",void 0),(0,t.Z)(this,"navigationtab",void 0),(0,t.Z)(this,"mailboxesEmails",void 0),this.navigation=e,this.navigationtab=s,this.mailboxesEmails=i,this.navigationtab.setTabInfo({displayname:"Mailboxes",displaymodule:"Mailboxes"})}get isEmailMailbox(){return!(!this.mailboxesEmails.activeMailBox||"email"!=this.mailboxesEmails.activeMailBox.type)}}return e=MailboxManager,(0,t.Z)(MailboxManager,"ɵfac",(function(s){return new(s||e)(m.Y36(f.G),m.Y36(v.d),m.Y36(x))})),(0,t.Z)(MailboxManager,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-manager"]],features:[m._Bn([x])],decls:6,vars:6,consts:[["system-to-bottom-noscroll","",1,"slds-grid","slds-grid--vertical"],[3,"ngSwitch"],["class","slds-grid slds-grow","style","min-height: 0;",4,"ngSwitchCase"],["class","slds-grid slds-grid--vertical slds-grow","style","min-height: 0;",4,"ngSwitchCase"],[1,"slds-grid","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1 slds-height_full",3,"slds-hide",4,"ngIf"],[1,"slds-size--1-of-1","slds-height_full"],["class","slds-size--2-of-5",4,"ngIf"],[1,"slds-size--3-of-5"],[1,"slds-size--2-of-5"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1","style","height: 50%",4,"ngIf"],[1,"slds-size--1-of-1","slds-border--top",2,"height","50%"],[1,"slds-size--1-of-1",2,"height","50%"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0),m._UZ(1,"mailbox-manager-header"),m.ynx(2,1),m.YNc(3,Ze,4,4,"div",2),m.YNc(4,ye,4,2,"div",2),m.YNc(5,Le,4,2,"div",3),m.BQk(),m.qZA()),2&e&&(m.xp6(1),m.ekj("slds-hide",!!s.mailboxesEmails.activeMessage&&"noSplit"==(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),m.xp6(1),m.Q6J("ngSwitch",null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name),m.xp6(1),m.Q6J("ngSwitchCase","noSplit"),m.xp6(1),m.Q6J("ngSwitchCase","verticalSplit"),m.xp6(1),m.Q6J("ngSwitchCase","horizontalSplit"))},dependencies:[l.O5,l.RF,l.n9,Z.t,Y,G,me,xe],encapsulation:2})),MailboxManager})(),Ce=(()=>{var e;class MailboxEmailToLeadButton{constructor(e,s,i,l,a){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"modal",void 0),(0,t.Z)(this,"toast",void 0),this.language=e,this.metadata=s,this.model=i,this.modal=l,this.toast=a}execute(){this.modal.openModal("MailboxEmailToLeadModal").subscribe((e=>{e.instance.email=this.model}))}}return e=MailboxEmailToLeadButton,(0,t.Z)(MailboxEmailToLeadButton,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(y.Pu),m.Y36(F.o),m.Y36(P.o),m.Y36(K.A))})),(0,t.Z)(MailboxEmailToLeadButton,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-email-to-lead-emailbutton"]],decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,s){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[C._],encapsulation:2})),MailboxEmailToLeadButton})();var ke=i(9621),Je=i(3499),Ae=i(5767),Se=i(1916),Be=i(7674);const Ye=["contextMenu"];function qe(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"li",7)(1,"a",8),m.NdJ("click",(function(){const s=m.CHM(e).$implicit,i=m.oxw(2);return m.KtG(i.setField(s))})),m.TgZ(2,"span",9),m._UZ(3,"system-label-fieldname",10),m.qZA()()()}if(2&e){const e=s.$implicit,i=m.oxw(2);m.xp6(3),m.Q6J("module",i.emailmodule)("field",e)}}function Fe(e,s){if(1&e&&(m.TgZ(0,"div",3,4)(2,"ul",5),m.YNc(3,qe,4,2,"li",6),m.qZA()()),2&e){const e=m.oxw();m.Q6J("ngStyle",e.contextMenuStyle),m.xp6(3),m.Q6J("ngForOf",e.emailfields)}}let Ie=(()=>{var e;class MailboxEmailToLeadEmailText{constructor(e,s,i){(0,t.Z)(this,"elementRef",void 0),(0,t.Z)(this,"renderer",void 0),(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"contextMenu",void 0),(0,t.Z)(this,"emailtext",""),(0,t.Z)(this,"emailhtml",""),(0,t.Z)(this,"emailmodule",""),(0,t.Z)(this,"emailfields",["first_name","last_name"]),(0,t.Z)(this,"setfield",new m.vpe),(0,t.Z)(this,"clickListener",null),(0,t.Z)(this,"displayContextMenu",!1),(0,t.Z)(this,"displayContextCoordinates",{top:0,left:0}),this.elementRef=e,this.renderer=s,this.language=i}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{left:this.displayContextCoordinates.left-e.left+"px",top:this.displayContextCoordinates.top-e.top+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return e=MailboxEmailToLeadEmailText,(0,t.Z)(MailboxEmailToLeadEmailText,"ɵfac",(function(s){return new(s||e)(m.Y36(m.SBq),m.Y36(m.Qsj),m.Y36(M.d))})),(0,t.Z)(MailboxEmailToLeadEmailText,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-email-to-lead-emailtext"]],viewQuery:function(e,s){if(1&e&&m.Gf(Ye,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(s.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0)(1,"div",1),m.NdJ("contextmenu",(function(e){return s.showContextMenu(e)})),m.qZA(),m.YNc(2,Fe,4,2,"div",2),m.qZA()),2&e&&(m.xp6(1),m.Q6J("innerHTML",s.content,m.oJD),m.xp6(1),m.Q6J("ngIf",s.displayContextMenu))},dependencies:[l.sg,l.O5,l.PC,Be.h],encapsulation:2})),MailboxEmailToLeadEmailText})();const Qe=["detailcontainer"];let Ne=(()=>{var e;class MailboxEmailToLeadModal{constructor(e,s,i,l){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"view",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"detailcontainer",void 0),(0,t.Z)(this,"email",null),(0,t.Z)(this,"self",null),(0,t.Z)(this,"componentRefs",[]),(0,t.Z)(this,"leadFields",["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"]),this.language=e,this.metadata=s,this.view=i,this.model=l,this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let s of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(s.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=s.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}}return e=MailboxEmailToLeadModal,(0,t.Z)(MailboxEmailToLeadModal,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(y.Pu),m.Y36(I.e),m.Y36(F.o))})),(0,t.Z)(MailboxEmailToLeadModal,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(e,s){if(1&e&&m.Gf(Qe,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(s.detailcontainer=e.first)}},features:[m._Bn([F.o,I.e])],decls:15,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-grid",2,"height","70vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return s.closeModal()})),m._UZ(2,"system-label",2),m.qZA(),m.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4)(6,"mailbox-email-to-lead-emailtext",5),m.NdJ("setfield",(function(e){return s.setField(e)})),m.qZA()(),m.TgZ(7,"div",6),m._UZ(8,"div",null,7),m.qZA()()(),m.TgZ(10,"system-modal-footer")(11,"button",8),m.NdJ("click",(function(){return s.closeModal()})),m._UZ(12,"system-label",9),m.qZA(),m.TgZ(13,"button",10),m.NdJ("click",(function(){return s.saveLead()})),m._UZ(14,"system-label",11),m.qZA()()()),2&e&&(m.xp6(6),m.Q6J("emailmodule",s.model.module)("emailtext",s.email.data.description)("emailhtml",s.email.data.body)("emailfields",s.leadFields))},dependencies:[C._,ke.j,Je.x,Ae.p,Se.y,Ie],encapsulation:2})),MailboxEmailToLeadModal})();var Oe=i(3348),Ue=i(2161);const Re=["tablecontainer"];function De(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"tr",16),m.NdJ("click",(function(){const s=m.CHM(e).$implicit,i=m.oxw(2);return m.KtG(i.goToRecord(s.id))})),m.TgZ(1,"td",17)(2,"div",18),m._uU(3),m.qZA()(),m.TgZ(4,"td",19)(5,"div",20),m._uU(6),m.qZA()(),m.TgZ(7,"td",19)(8,"div",18),m._uU(9),m.qZA()()()}if(2&e){const e=s.$implicit;m.xp6(3),m.hij(" ",e.name," "),m.xp6(2),m.ekj("slds-p-horizontal--xx-small",(null==e?null:e.emailsunread)>9),m.Q6J("ngClass",(null==e?null:e.emailsunread)>0?"slds-badge slds-theme--success":""),m.xp6(1),m.hij(" ",e.emailsunread," "),m.xp6(3),m.hij(" ",e.emailsread," ")}}function He(e,s){if(1&e&&(m.TgZ(0,"tbody"),m.YNc(1,De,10,6,"tr",15),m.qZA()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngForOf",e.mailboxes)("ngForTrackBy",e.trackByFn)}}function je(e,s){1&e&&m._UZ(0,"tbody",21),2&e&&m.Q6J("columns",3)}let ze=(()=>{var e;class MailboxesDashlet{constructor(e,s,i,l){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"backend",void 0),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"router",void 0),(0,t.Z)(this,"isLoading",!1),(0,t.Z)(this,"mailboxes",[]),(0,t.Z)(this,"canLoadMore",!0),(0,t.Z)(this,"loadLimit",20),(0,t.Z)(this,"getMailBoxesInterval",void 0),(0,t.Z)(this,"tablecontainer",void 0),this.language=e,this.backend=s,this.model=i,this.router=l}ngOnInit(){this.model.module="Mailboxes",this.getMailboxes(),this.getMailBoxesInterval=this.getMailboxesInterval()}ngOnDestroy(){this.getMailBoxesInterval&&window.clearInterval(this.getMailBoxesInterval)}trackByFn(e,s){return s.id}getMailboxes(e){this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((s=>{if(!s||0==s.length)return this.isLoading=!1;s.map((e=>e.emailsread=e.emailsread-e.emailsclosed)),e?this.mailboxes.every((e=>(s.some((s=>{if(s.id==e.id)return e.emailsread=s.emailsread,e.emailsunread=s.emailsunread,!0})),!0))):this.mailboxes=s,s.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1}))}getMailboxesInterval(){return window.setInterval((()=>this.getMailboxes(!0)),6e4)}onScroll(){let e=this.tablecontainer.element.nativeElement;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}goToRecord(e){this.router.navigate([`/module/${this.model.module}/${e}`])}loadMore(){this.canLoadMore&&(this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((e=>{this.mailboxes=this.mailboxes.concat(e),e.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1})))}}return e=MailboxesDashlet,(0,t.Z)(MailboxesDashlet,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(b.y),m.Y36(F.o),m.Y36(Oe.F0))})),(0,t.Z)(MailboxesDashlet,"ɵcmp",m.Xpm({type:e,selectors:[["dashboard-mailboxes-dashlet"]],viewQuery:function(e,s){if(1&e&&m.Gf(Re,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(s.tablecontainer=e.first)}},features:[m._Bn([F.o,I.e])],decls:21,vars:2,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Mailboxes","size","small"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],[1,"slds-scrollable--y","slds-grow",2,"width","100%",3,"scroll"],["tablecontainer",""],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered","slds-table--fixed-layout","spice-table_header-fixed",2,"border-top","0"],[1,"slds-text-title_caps"],["scope","col"],[1,"slds-truncate","slds-text-align--center"],["label","LBL_NAME"],["label","LBL_UNREAD"],["label","LBL_READ"],[4,"ngIf"],["system-table-stencils","",3,"columns",4,"ngIf"],["style","cursor: pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click"],[1,"slds-truncate",2,"min-width","120px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"width","fit-content","height","fit-content"],[1,"slds-truncate",2,"min-width","100px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"border-radius","50%","width","fit-content","height","fit-content",3,"ngClass"],["system-table-stencils","",3,"columns"]],template:function(e,s){1&e&&(m.TgZ(0,"div",0)(1,"div",1),m._UZ(2,"system-icon",2),m.TgZ(3,"h2",3),m._uU(4,"Mailboxes"),m.qZA()(),m.TgZ(5,"div",4,5),m.NdJ("scroll",(function(){return s.onScroll()})),m.TgZ(7,"table",6)(8,"thead")(9,"tr",7)(10,"th",8)(11,"div",9),m._UZ(12,"system-label",10),m.qZA()(),m.TgZ(13,"th",8)(14,"div",9),m._UZ(15,"system-label",11),m.qZA()(),m.TgZ(16,"th",8)(17,"div",9),m._UZ(18,"system-label",12),m.qZA()()()(),m.YNc(19,He,2,2,"tbody",13),m.YNc(20,je,1,1,"tbody",14),m.qZA()()()),2&e&&(m.xp6(19),m.Q6J("ngIf",!s.isLoading&&s.mailboxes.length>0),m.xp6(1),m.Q6J("ngIf",s.isLoading))},dependencies:[l.mk,l.sg,l.O5,V.f,C._,Ue.x],encapsulation:2})),MailboxesDashlet})(),Ge=(()=>{var e;class MailboxSetDefaultButton{constructor(e,s,i,l){(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"backend",void 0),(0,t.Z)(this,"toast",void 0),(0,t.Z)(this,"model",void 0),this.language=e,this.backend=s,this.toast=i,this.model=l}get disabled(){return null==this.model.data.id||this.model.getFieldValue("is_default")}execute(){this.backend.postRequest("module/Mailboxes/default",null,{mailbox_id:this.model.data.id}).subscribe((e=>{this.toast.sendToast("success","success"),this.model.setField("is_default",!0)}),(e=>{this.toast.sendToast(e.message,"error")}))}}return e=MailboxSetDefaultButton,(0,t.Z)(MailboxSetDefaultButton,"ɵfac",(function(s){return new(s||e)(m.Y36(M.d),m.Y36(b.y),m.Y36(K.A),m.Y36(F.o))})),(0,t.Z)(MailboxSetDefaultButton,"ɵcmp",m.Xpm({type:e,selectors:[["mailbox-set-default-button"]],decls:2,vars:0,consts:[["label","LBL_SET_DEFAULT"]],template:function(e,s){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[C._],encapsulation:2})),MailboxSetDefaultButton})();var Ke=i(7040),Pe=i(2422),$e=i(6367),Xe=i(3208),Ve=i(5638);function We(e,s){if(1&e&&m._UZ(0,"field-label",3),2&e){const e=m.oxw();m.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function es(e,s){if(1&e&&(m.ynx(0),m._uU(1),m.BQk()),2&e){const e=m.oxw().$implicit;m.xp6(1),m.hij(" ",e.display," ")}}function ss(e,s){if(1&e&&(m.ynx(0),m.YNc(1,es,2,1,"ng-container",6),m.BQk()),2&e){const e=s.$implicit,i=m.oxw(2);m.xp6(1),m.Q6J("ngIf",e.value==i.value)}}function is(e,s){if(1&e&&(m.TgZ(0,"field-generic-display",4),m.YNc(1,ss,2,1,"ng-container",5),m.qZA()),2&e){const e=m.oxw();m.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig),m.xp6(1),m.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn)}}function ts(e,s){if(1&e&&(m.ynx(0),m.TgZ(1,"option",12),m._uU(2),m.qZA(),m.BQk()),2&e){const e=s.$implicit;m.xp6(1),m.Q6J("value",e.value),m.xp6(1),m.Oqu(e.display)}}function ls(e,s){if(1&e){const e=m.EpF();m.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"select",10),m.NdJ("ngModelChange",(function(s){m.CHM(e);const i=m.oxw();return m.KtG(i.value=s)}))("ngModelChange",(function(s){m.CHM(e);const i=m.oxw();return m.KtG(i.setToPreferences(s))})),m.YNc(4,ts,3,2,"ng-container",5),m.qZA()(),m._UZ(5,"field-messages",11),m.qZA()()}if(2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngClass",e.getFieldClass()),m.xp6(2),m.Q6J("disabled",0==e.options.length)("ngModel",e.value),m.xp6(1),m.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn),m.xp6(1),m.Q6J("fieldname",e.fieldname)}}let as=(()=>{var e;class fieldMailboxes extends Ke.O{constructor(e,s,i,l,a,o,n,d,c){super(e,s,i,l,a),(0,t.Z)(this,"model",void 0),(0,t.Z)(this,"view",void 0),(0,t.Z)(this,"language",void 0),(0,t.Z)(this,"metadata",void 0),(0,t.Z)(this,"router",void 0),(0,t.Z)(this,"backend",void 0),(0,t.Z)(this,"configuration",void 0),(0,t.Z)(this,"userpreferences",void 0),(0,t.Z)(this,"cdRef",void 0),(0,t.Z)(this,"options",[]),this.model=e,this.view=s,this.language=i,this.metadata=l,this.router=a,this.backend=o,this.configuration=n,this.userpreferences=d,this.cdRef=c}get value(){return this.model.getField(this.fieldname)}set value(e){this.model.setField(this.fieldname,e)}get scope(){return this.fieldconfig.scope?this.fieldconfig.scope:"outboundsingle"}ngOnInit(){super.ngOnInit(),this.setValueFromPreferences(),this.getOptions()}getOptions(){const e=this.configuration.getData(`mailboxes${this.scope}`);_.isEmpty(e)?this.backend.getRequest("module/Mailboxes/scope",{scope:this.scope}).subscribe((e=>{this.options=e.sort(((e,s)=>e.display.localeCompare(s.display))),this.configuration.setData(`mailboxes${this.scope}`,this.options),this.cdRef.detectChanges()})):this.options=e}trackByFn(e,s){return s.value}setValueFromPreferences(){if(this.value||this.fieldconfig.disableCache)return;const e=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);e&&this.isEditMode()&&this.model.setField(this.fieldname,e),this.subscriptions.add(this.model.mode$.subscribe((e=>{if("edit"!=e||this.value)return;const s=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);s&&this.model.setField(this.fieldname,s)})))}setToPreferences(e){this.fieldconfig.disableCache||this.userpreferences.setPreference(`defaultmailbox_${this.scope}`,e)}}return e=fieldMailboxes,(0,t.Z)(fieldMailboxes,"ɵfac",(function(s){return new(s||e)(m.Y36(F.o),m.Y36(I.e),m.Y36(M.d),m.Y36(y.Pu),m.Y36(Oe.F0),m.Y36(b.y),m.Y36(E.C),m.Y36(Pe.z),m.Y36(m.sBO))})),(0,t.Z)(fieldMailboxes,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],features:[m.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"fieldname"],[3,"value"]],template:function(e,s){1&e&&(m.YNc(0,We,1,2,"field-label",0),m.YNc(1,is,2,5,"field-generic-display",1),m.YNc(2,ls,6,6,"div",2)),2&e&&(m.Q6J("ngIf",s.displayLabel),m.xp6(1),m.Q6J("ngIf",!s.isEditMode()),m.xp6(1),m.Q6J("ngIf",s.isEditMode()))},dependencies:[l.mk,l.sg,l.O5,a.YN,a.Kr,a.EJ,a.JJ,a.On,$e.q,Xe.D,Ve.a],encapsulation:2})),fieldMailboxes})(),os=(()=>{var e;class ModuleMailboxes{}return e=ModuleMailboxes,(0,t.Z)(ModuleMailboxes,"ɵfac",(function(s){return new(s||e)})),(0,t.Z)(ModuleMailboxes,"ɵmod",m.oAB({type:e})),(0,t.Z)(ModuleMailboxes,"ɵinj",m.cJS({imports:[l.ez,a.u5,c.ObjectFields,n.GlobalComponents,d.ObjectComponents,r.SystemComponents,o.o]})),ModuleMailboxes})();("undefined"==typeof ngJitMode||ngJitMode)&&m.kYT(os,{declarations:[we,Y,G,H,me,ge,xe,Ce,Ne,Ie,ze,Ge,as],imports:[l.ez,a.u5,c.ObjectFields,n.GlobalComponents,d.ObjectComponents,r.SystemComponents,o.o]})}}]);