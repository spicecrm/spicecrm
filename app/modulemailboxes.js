/*!
 * 
 *                     aacService
 *
 *                     release: 2023.03.001
 *
 *                     date: 2024-01-09 16:51:03
 *
 *                     build: 2023.03.001.1704815463270
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_mailboxes_modulemailboxes_ts"],{89028:(e,s,t)=>{t.r(s),t.d(s,{ModuleMailboxes:()=>ls});var i=t(44755),l=t(95030),a=t(84357),o=t(34826),n=t(19784),d=t(53190),c=t(57239),r=t(62242),m=t(50727),u=t(61135),g=t(77579),h=t(14505),b=t(33369);let p=(()=>{class mailboxesEmails{backend;broadcast;mailboxesLoaded$;activeSplitType={name:"noSplit",icon:"picklist_type",label:"LBL_NO_SPLIT"};limit=50;mailboxes=[];emails=[];totalcount=0;source="fts";_activeMailBox;_activeMessage;activeMessage$=new r.vpe;_unreadonly=!0;isLoading=!1;emailopenness="";serviceSubscriptions=new m.w0;searchTerm;constructor(e,s){this.backend=e,this.broadcast=s,this.mailboxesLoaded$=new u.X(!1),this.getMailboxes(),this.serviceSubscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleMessage(e)})))}ngOnDestroy(){this.serviceSubscriptions.unsubscribe()}get activeMessage(){return this._activeMessage}set activeMessage(e){this._activeMessage=e,this.activeMessage$.emit(e)}get activeMailBox(){return this._activeMailBox}set activeMailBox(e){this._activeMailBox=e,this.emails=[],this.totalcount=0}get unreadonly(){return this._unreadonly}set unreadonly(e){this._unreadonly=e,this.loadMessages()}getMailboxes(){this.backend.getRequest("module/Mailboxes/scope",{scope:"inbound"}).subscribe((e=>{for(let s of e)this.mailboxes.push({actionset:s.actionset,id:s.value,name:s.display,type:s.type});this.mailboxesLoaded$.next(!0)}))}handleMessage(e){if("Emails"===e.messagedata.module)switch(e.messagetype){case"model.delete":let s=this.emails.findIndex((s=>s.id==e.messagedata.id));s>=0&&(this.activeMessage.id==e.messagedata.id&&(this.activeMessage=void 0),this.emails.splice(s,1),this.totalcount--);break;case"model.save":let t=this.emails.findIndex((s=>s.id==e.messagedata.id));t>=0&&(this.emails[t]=e.messagedata.data)}}fetchEmails(){let e=new g.x;return this.backend.getRequest("module/Mailboxes/"+this.activeMailBox.id+"/fetchemails").subscribe((s=>{s.new_mail_count>0&&this.loadMessages(),e.next({status:"success",newmailcount:s.new_mail_count}),e.complete()}),(s=>{e.error({status:"error",error:s}),e.complete()})),e.asObservable()}generateFilters(){let e={logicaloperator:"and",groupscope:"all",conditions:[{field:"mailbox_id",filtervalue:this.activeMailBox.id,operator:"equals"}]};return"sms"==this.activeMailBox.type?e.conditions.push({field:"direction",filtervalue:"i",operator:"equals"}):(e.conditions.push({field:"type",filtervalue:"inbound",operator:"equals"}),this.emailopenness&&e.conditions.push({field:"openness",filtervalue:this.emailopenness,operator:"equals"}),this.unreadonly&&e.conditions.push({field:"status",filtervalue:"unread",operator:"equals"})),e}get endpoint(){return"sms"==this.activeMailBox.type?"module/TextMessages":"module/Emails"}get requestFields(){return"sms"==this.activeMailBox.type?["name","id","msisdn_e164","date_sent","description"]:["name","id","from_addr_name","date_sent","status","openness","sentiment","magnitude"]}loadMessages(){if(!this.activeMailBox||this.activeMailBox&&!this.activeMailBox.id)return!1;this.activeMessage=void 0,this.emails=[];this.activeMailBox.id;let e={filter:this.generateFilters(),sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}],fields:JSON.stringify(this.requestFields),limit:this.limit,searchterm:this.searchTerm};this.isLoading=!0,this.backend.getRequest(this.endpoint,e).subscribe((e=>{this.emails=e.list,this.source=e.source,this.totalcount=e.totalcount,this.isLoading=!1}))}loadMore(){if(this.isLoading||this.emails.length>=this.totalcount)return!1;this.isLoading=!0;let e={fields:JSON.stringify(this.requestFields),filter:this.generateFilters(),limit:this.limit,offset:this.emails.length,sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}]};this.backend.getRequest(this.endpoint,e).subscribe((e=>{e.list.length>0&&(this.emails=this.emails.concat(e.list),this.source=e.source,this.totalcount=e.totalcount),this.isLoading=!1}))}static ɵfac=function(e){return new(e||mailboxesEmails)(r.LFG(h.y),r.LFG(b.f))};static ɵprov=r.Yz7({token:mailboxesEmails,factory:mailboxesEmails.ɵfac})}return mailboxesEmails})();var f=t(82032),x=t(17017),M=t(73194),v=t(55329),y=t(4154),E=t(26625),Z=t(72656),T=t(7514),L=t(6271),w=t(83463),C=t(78859),k=t(79641);function J(e,s){if(1&e&&(r.TgZ(0,"option",34),r._uU(1),r.qZA()),2&e){const e=s.$implicit;r.s9C("value",e.id),r.xp6(1),r.hij(" ",e.name," ")}}function A(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"div",35)(1,"system-input-search-term",36),r.NdJ("ngModelChange",(function(s){r.CHM(e);const t=r.oxw();return r.KtG(t.searchTerm=s)}))("onEnterPress",(function(){r.CHM(e);const s=r.oxw();return r.KtG(s.reloadList())})),r.qZA()()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngModel",e.searchTerm)("placeholder",e.language.getModuleCombinedLabel("LBL_SEARCH","Mailboxes"))}}let S=(()=>{class MailboxManagerHeader{language;mailboxesEmails;metadata;navigationtab;configuration;splitTypeOptions=[{value:"noSplit",icon:"picklist_type",title:"LBL_NO_SPLIT"},{value:"verticalSplit",icon:"side_list",title:"LBL_VERTICAL_SPLIT"},{value:"horizontalSplit",icon:"inspector_panel",title:"LBL_HORIZONTAL_SPLIT"}];searchTermError=!1;isFetching=!1;searchTimeOut;constructor(e,s,t,i,l){this.language=e,this.mailboxesEmails=s,this.metadata=t,this.navigationtab=i,this.configuration=l;let a=this.metadata.getComponentConfig("MailboxManagerHeader");this.emailopenness=a.selectionstatus?a.selectionstatus:"",this.mailboxesEmails.unreadonly=!!a.unreadonly&&a.unreadonly}_mailbox;get mailbox(){return this._mailbox}set mailbox(e){this._mailbox=e,e?(this.mailboxesEmails.activeMailBox=this.mailboxesEmails.mailboxes.find((s=>s.id==e)),this.mailboxesEmails.loadMessages(),this.navigationtab.setTabInfo({displayname:this.mailboxesEmails.activeMailBox.name,displaymodule:"Mailboxes"})):this.mailboxesEmails.activeMailBox={}}get emailopenness(){return""==this.mailboxesEmails.emailopenness?"all":this.mailboxesEmails.emailopenness}set emailopenness(e){this.mailboxesEmails.emailopenness="all"==e?"":e,this.mailboxesEmails.loadMessages()}get buttonenabled(){return this.mailboxesEmails.activeMailBox&&!this.mailboxesEmails.isLoading&&!this.isFetching}get searchTerm(){return this.mailboxesEmails.searchTerm}set searchTerm(e){e!=this.mailboxesEmails.searchTerm&&(this.mailboxesEmails.searchTerm=e,""==e||this.searchTermsValid(e)?(this.searchTermError=!1,this.reloadList()):(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTermError=!0))}ngOnInit(){this.loadOneMailbox(),this.navigationtab.activeRoute.params.id&&this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&(this.mailbox=this.navigationtab.activeRoute.params.id)}))}loadOneMailbox(){this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&1==this.mailboxesEmails.mailboxes.length&&(this.mailbox=this.mailboxesEmails.mailboxes[0].id)}))}clearSearchTerm(){this.mailboxesEmails.searchTerm=void 0,this.reloadList()}searchTermsValid(e){let s=this.configuration.getCapabilityConfig("search"),t=s.min_ngram?parseInt(s.min_ngram,10):3;return 0==e.split(" ").filter((e=>e.length<t)).length}reloadList(){this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.mailboxesEmails.loadMessages()),1e3)}fetchEmails(){this.isFetching=!0,this.mailboxesEmails.fetchEmails().subscribe((e=>{this.isFetching=!1}),(e=>{this.isFetching=!1}))}setActiveSplitType(e){const s={name:e};switch(e){case"noSplit":this.mailboxesEmails.activeMessage=null,s.icon="picklist_type",s.label="LBL_NO_SPLIT";break;case"verticalSplit":s.icon="side_list",s.label="LBL_VERTICAL_SPLIT";break;case"horizontalSplit":s.icon="inspector_panel",s.label="LBL_HORIZONTAL_SPLIT"}this.mailboxesEmails.activeSplitType=s}static ɵfac=function(e){return new(e||MailboxManagerHeader)(r.Y36(v.d),r.Y36(p),r.Y36(y.Pu),r.Y36(x.d),r.Y36(E.C))};static ɵcmp=r.Xpm({type:MailboxManagerHeader,selectors:[["mailbox-manager-header"]],decls:43,vars:13,consts:[[1,"slds-grid","slds-form--inline","slds-p-around--small","slds-border--bottom"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-p-right--xx-small"],[1,"slds-select_container"],[1,"slds-select",2,"min-width","250px",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__control","slds-p-horizontal--xx-small"],[3,"ngModel","ngModelChange"],["label","LBL_UNREAD_ONLY"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","all"],["label","LBL_EMAILS_ALL"],["value","open"],["label","LBL_EMAILS_OPEN"],["value","user_closed"],["label","LBL_EMAILS_USER_CLOSED"],["value","system_closed"],["label","LBL_EMAILS_SYSTEM_CLOSED"],[1,"slds-p-horizontal--xx-small"],[1,"slds-list_horizontal","slds-has-dividers_left","slds-has-block-links_space"],[1,"slds-item"],["label","LBL_OF"],["label","LBL_ITEMS"],["size","xx-small",3,"icon"],["class","slds-p-right--small slds-m-left--small","style","width: 400px",4,"ngIf"],[1,"slds-col--bump-left","slds-grid"],[1,"slds-m-horizontal--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","refresh",1,"slds-button__icon--left"],["label","LBL_REFRESH"],["icon","email",1,"slds-button__icon--left"],["label","LBL_FETCH_EMAILS"],[3,"value"],[1,"slds-p-right--small","slds-m-left--small",2,"width","400px"],[1,"slds-grow",3,"ngModel","placeholder","ngModelChange","onEnterPress"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"select",4),r.NdJ("ngModelChange",(function(e){return s.mailbox=e})),r.YNc(5,J,2,2,"option",5),r.qZA()()(),r.TgZ(6,"div",6)(7,"system-checkbox",7),r.NdJ("ngModelChange",(function(e){return s.mailboxesEmails.unreadonly=e})),r._UZ(8,"system-label",8),r.qZA()(),r.TgZ(9,"div",6)(10,"div",3)(11,"select",9),r.NdJ("ngModelChange",(function(e){return s.emailopenness=e})),r.TgZ(12,"option",10),r._UZ(13,"system-label",11),r.qZA(),r.TgZ(14,"option",12),r._UZ(15,"system-label",13),r.qZA(),r.TgZ(16,"option",14),r._UZ(17,"system-label",15),r.qZA(),r.TgZ(18,"option",16),r._UZ(19,"system-label",17),r.qZA()()()(),r.TgZ(20,"div",18)(21,"ul",19)(22,"li",20)(23,"span"),r._uU(24),r._UZ(25,"system-label",21),r._uU(26),r._UZ(27,"system-label",22),r.qZA()(),r.TgZ(28,"li",20),r._UZ(29,"system-utility-icon",23),r.qZA()()(),r.YNc(30,A,2,2,"div",24),r.qZA(),r.TgZ(31,"div",25)(32,"div",26)(33,"system-input-radio-button-group",27),r.NdJ("ngModelChange",(function(e){return s.setActiveSplitType(e)})),r.qZA()(),r.TgZ(34,"div",28)(35,"button",29),r.NdJ("click",(function(){return s.reloadList()})),r._UZ(36,"system-button-icon",30),r.TgZ(37,"span"),r._UZ(38,"system-label",31),r.qZA()(),r.TgZ(39,"button",29),r.NdJ("click",(function(){return s.fetchEmails()})),r._UZ(40,"system-button-icon",32),r.TgZ(41,"span"),r._UZ(42,"system-label",33),r.qZA()()()()()),2&e&&(r.xp6(4),r.Q6J("ngModel",s.mailbox)("disabled",0==s.mailboxesEmails.mailboxes.length||s.isFetching),r.xp6(1),r.Q6J("ngForOf",s.mailboxesEmails.mailboxes),r.xp6(2),r.Q6J("ngModel",s.mailboxesEmails.unreadonly),r.xp6(4),r.Q6J("ngModel",s.emailopenness),r.xp6(13),r.hij("",s.mailboxesEmails.emails.length," "),r.xp6(2),r.hij(" ",s.mailboxesEmails.totalcount," "),r.xp6(3),r.Q6J("icon","db"==s.mailboxesEmails.source?"database":"feed"),r.xp6(1),r.Q6J("ngIf",!!s.mailbox),r.xp6(3),r.Q6J("ngModel",s.mailboxesEmails.activeSplitType.name)("inputOptions",s.splitTypeOptions),r.xp6(2),r.Q6J("disabled",!s.buttonenabled),r.xp6(4),r.Q6J("disabled",!s.buttonenabled))},dependencies:[i.sg,i.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Z.J,T.U,L.p,w._,C.r,k.g],encapsulation:2})}return MailboxManagerHeader})();var B=t(94664),Y=t(55710),q=t(32294),F=t(29266),I=t(33634);function Q(e,s){1&e&&r._UZ(0,"system-utility-icon",9)}const O=function(e){return{"slds-theme_default":e}},N=function(){return{fieldtype:"emailsubject"}},U=function(){return{fieldtype:"activitydate"}};let R=(()=>{class MailboxManagerEmail{metadata;language;mailboxesEmails;view;model;modelutilities;email={};fieldset;constructor(e,s,t,i,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=t,this.view=i,this.model=l,this.modelutilities=a,this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerEmail").fieldset}ngOnInit(){this.model.module="Emails",this.model.id=this.email.id,this.model.setData(this.email)}selectMail(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.email.status&&(e["font-weight"]="bold"),this.email.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}static ɵfac=function(e){return new(e||MailboxManagerEmail)(r.Y36(y.Pu),r.Y36(v.d),r.Y36(p),r.Y36(q.e),r.Y36(Y.o),r.Y36(F.A))};static ɵcmp=r.Xpm({type:MailboxManagerEmail,selectors:[["mailbox-manager-email"]],inputs:{email:"email"},features:[r._Bn([Y.o,q.e])],decls:9,vars:10,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--xx-small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid"],[1,"slds-grow","slds-truncate"],["field","name","fielddisplayclass","",1,"slds-grow","slds-truncate","slds-p-right--xx-small","spice-display-block",3,"fieldconfig"],["field","from_addr","fielddisplayclass","",1,"slds-truncate","spice-display-block",2,"min-width","220px","width","220px"],[1,"slds-p-left--xx-small","slds-truncate","slds-grid","slds-grid--align-spread",2,"min-width","100px","width","100px"],[2,"width","22px"],["icon","attach","size","xx-small","class","slds-p-right--x-small",4,"ngIf"],["field","date_sent","fielddisplayclass","",1,"slds-truncate",3,"fieldconfig"],["icon","attach","size","xx-small",1,"slds-p-right--x-small"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0),r.NdJ("click",(function(){return s.selectMail(s.email)})),r.TgZ(1,"div",1)(2,"div",2),r._UZ(3,"field-container",3)(4,"field-container",4),r.qZA(),r.TgZ(5,"div",5)(6,"div",6),r.YNc(7,Q,1,0,"system-utility-icon",7),r.qZA(),r._UZ(8,"field-container",8),r.qZA()()()),2&e&&(r.Q6J("ngClass",r.VKq(6,O,s.isSelected)),r.xp6(2),r.ekj("slds-grid","verticalSplit"!=(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),r.xp6(1),r.Q6J("fieldconfig",r.DdM(8,N)),r.xp6(4),r.Q6J("ngIf",s.email.attachments_count>0),r.xp6(1),r.Q6J("fieldconfig",r.DdM(9,U)))},dependencies:[i.mk,i.O5,I.j,C.r],encapsulation:2})}return MailboxManagerEmail})();function D(e,s){if(1&e&&r._UZ(0,"mailbox-manager-email",4),2&e){const e=s.$implicit;r.Q6J("email",e)}}function H(e,s){1&e&&(r.TgZ(0,"div",5),r._UZ(1,"system-spinner"),r.qZA())}let j=(()=>{class MailboxManagerEmails{mailboxesEmails;constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}static ɵfac=function(e){return new(e||MailboxManagerEmails)(r.Y36(p))};static ɵcmp=r.Xpm({type:MailboxManagerEmails,selectors:[["mailbox-manager-emails"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-height_full","slds-border--right",3,"scroll"],["scrollContainer",""],[3,"email",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium slds-align--absolute-center",4,"ngIf"],[3,"email"],[1,"slds-p-around--medium","slds-align--absolute-center"]],template:function(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"div",0,1),r.NdJ("scroll",(function(){r.CHM(e);const t=r.MAs(1);return r.KtG(s.loadmore(t))})),r.YNc(2,D,1,1,"mailbox-manager-email",2),r.YNc(3,H,2,0,"div",3),r.qZA()}2&e&&(r.xp6(2),r.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),r.xp6(1),r.Q6J("ngIf",s.mailboxesEmails.isLoading))},dependencies:[i.sg,i.O5,B.W,R],encapsulation:2})}return MailboxManagerEmails})();var z=t(13278),G=t(44044),P=t(2294),$=t(55931),K=t(44561),X=t(50151);const V=["detailscontent"];function W(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"button",9),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw();return r.KtG(s.goBack())})),r._UZ(1,"system-button-icon",10),r.qZA()}}function ee(e,s){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw(2);r.xp6(1),r.Oqu(e.model.data.summary_text)}}function se(e,s){if(1&e&&r._UZ(0,"object-record-fieldset-horizontal-list",32),2&e){const e=r.oxw(2);r.Q6J("fieldset",e.fieldset)}}function te(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"button",26),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw(2);return r.KtG(s.delete())})),r._UZ(1,"system-button-icon",33),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("title",e.language.getLabel("LBL_DELETE"))}}function ie(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"button",34),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw(2);return r.KtG(s.markUnread())})),r._UZ(1,"system-button-icon",35),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_UNREAD"))}}function le(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"button",34),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw(2);return r.KtG(s.completeMail())})),r._UZ(1,"system-button-icon",36),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function ae(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"button",34),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw(2);return r.KtG(s.reopen())})),r._UZ(1,"system-button-icon",37),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}function oe(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14),r._UZ(4,"system-icon",15),r.TgZ(5,"div",16)(6,"ul",17)(7,"li",18),r._UZ(8,"field-container",19),r.qZA(),r.TgZ(9,"li",18),r._UZ(10,"field-container",20),r.qZA()(),r.TgZ(11,"h1",21),r.YNc(12,ee,2,1,"ng-container",22),r.YNc(13,se,1,1,"object-record-fieldset-horizontal-list",23),r.qZA()()()(),r.TgZ(14,"object-action-container",24),r.NdJ("actionemitter",(function(s){r.CHM(e);const t=r.oxw();return r.KtG(t.handleAction(s))})),r.qZA(),r.TgZ(15,"div",25)(16,"button",26),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw();return r.KtG(s.replyToAll())})),r._UZ(17,"system-button-icon",27),r.qZA(),r.TgZ(18,"button",26),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw();return r.KtG(s.reply())})),r._UZ(19,"system-button-icon",28),r.qZA(),r.TgZ(20,"button",26),r.NdJ("click",(function(){r.CHM(e);const s=r.oxw();return r.KtG(s.forward())})),r._UZ(21,"system-button-icon",29),r.qZA(),r.YNc(22,te,2,1,"button",30),r.YNc(23,ie,2,2,"button",31),r.YNc(24,le,2,2,"button",31),r.YNc(25,ae,2,2,"button",31),r.qZA()()()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("module",e.model.module),r.xp6(8),r.Q6J("ngIf",!e.fieldset),r.xp6(1),r.Q6J("ngIf",e.fieldset),r.xp6(1),r.Q6J("actionset",e.actionSet),r.xp6(2),r.Q6J("title",e.language.getLabel("LBL_REPLY_ALL")),r.xp6(2),r.Q6J("title",e.language.getLabel("LBL_REPLY")),r.xp6(2),r.Q6J("title",e.language.getLabel("LBL_FORWARD")),r.xp6(2),r.Q6J("ngIf",e.model.checkAccess("delete")),r.xp6(1),r.Q6J("ngIf",e.isRead),r.xp6(1),r.Q6J("ngIf",!e.isUserClosed),r.xp6(1),r.Q6J("ngIf",e.isUserClosed)}}function ne(e,s){1&e&&(r.TgZ(0,"div",38),r._UZ(1,"system-label",39),r.qZA())}const de=function(e){return{"slds-hide":e}};let ce=(()=>{class MailboxmanagerEmailDetails{language;metadata;model;mailboxesEmails;backend;toast;view;modal;injector;detailscontent;containerComponents=[];fieldset="";mailboxSubscription;constructor(e,s,t,i,l,a,o,n,d){this.language=e,this.metadata=s,this.model=t,this.mailboxesEmails=i,this.backend=l,this.toast=a,this.view=o,this.modal=n,this.injector=d,this.mailboxSubscription=this.mailboxesEmails.activeMessage$.subscribe((e=>{this.loadEmail(e)})),this.view.displayLabels=!1}ngOnDestroy(){this.mailboxSubscription.unsubscribe()}loadEmail(e){this.mailboxesEmails.activeMailBox&&("sms"==this.mailboxesEmails.activeMailBox.type?this.model.module="TextMessages":"email"==this.mailboxesEmails.activeMailBox.type&&(this.model.module="Emails")),this.model.initialize(),e?(this.model.id=e.id,this.buildContainer(),this.model.getData(!1,"").subscribe((e=>{"unread"==this.model.getFieldValue("status")&&this.setStatus("read")}))):this.model.id=void 0}destroyContainer(){for(let e of this.containerComponents)e.destroy();this.containerComponents=[]}handleAction(e){if("save"===e)this.buildContainer()}buildContainer(){this.destroyContainer();let e=this.metadata.getComponentConfig("MailboxmanagerEmailDetails",this.model.module),s="horizontalSplit"==this.mailboxesEmails.activeSplitType.name?e.horizontalComponentset:e.componentset;for(let e of this.metadata.getComponentSetObjects(s))this.metadata.addComponent(e.component,this.detailscontent).subscribe((s=>{s.instance.componentconfig=e.componentconfig?e.componentconfig:{},this.containerComponents.push(s)}));this.fieldset=e.fieldset}get isUserClosed(){return"user_closed"==this.model.getField("openness")}get isRead(){return"read"==this.model.getField("status")}get actionSet(){return this.mailboxesEmails.activeMailBox.actionset?this.mailboxesEmails.activeMailBox.actionset:""}completeMail(){this.setOpenness("user_closed")}markUnread(){this.setStatus("unread")}reopen(){this.setOpenness("open")}setStatus(e){this.model.setField("status",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/status",null,{status:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.status=e}),(s=>{this.toast.sendAlert("Cannot change status to "+e)}))}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/openness",null,{openness:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.openness=e}),(s=>{this.toast.sendAlert("Cannot change openness to "+e)}))}replyToAll(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{e.instance.mode="replyall"}))}reply(){this.modal.openModal("EmailReplyModal",!0,this.injector)}forward(){this.modal.openModal("EmailForwardModal",!0,this.injector)}delete(){this.model.delete()}goBack(){this.mailboxesEmails.activeMessage=null}static ɵfac=function(e){return new(e||MailboxmanagerEmailDetails)(r.Y36(v.d),r.Y36(y.Pu),r.Y36(Y.o),r.Y36(p),r.Y36(h.y),r.Y36(z.A),r.Y36(q.e),r.Y36(G.o),r.Y36(r.zs3))};static ɵcmp=r.Xpm({type:MailboxmanagerEmailDetails,selectors:[["mailbox-manager-email-details"]],viewQuery:function(e,s){if(1&e&&r.Gf(V,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(s.detailscontent=e.first)}},features:[r._Bn([Y.o,q.e])],decls:10,vars:8,consts:[[1,"slds-theme--shade","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"ngClass"],[1,"slds-grid","slds-border--bottom"],[1,"slds-grid","slds-grid--align-end","slds-p-vertical--medium",2,"width","3rem"],["system-title","LBL_BACK","class","slds-button slds-button--icon slds-button_icon-border-filled",3,"click",4,"ngIf"],["class","slds-p-around--medium slds-border--bottom slds-grow",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small","slds-theme--default","slds-scrollable--y","slds-grow",2,"min-height","0"],["detailscontent",""],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],["system-title","LBL_BACK",1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"click"],["icon","back"],[1,"slds-p-around--medium","slds-border--bottom","slds-grow"],[1,"slds-grid"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-list_horizontal","slds-has-dividers_left"],[1,"slds-item"],["field","date_sent","fielddisplayclass","slds-truncate"],["field","status","fielddisplayclass","slds-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[3,"fieldset",4,"ngIf"],[3,"actionset","actionemitter"],[1,"slds-p-left--small","slds-button-group"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"title","click"],["icon","reply_all"],["icon","reply"],["icon","forward"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"title","click",4,"ngIf"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"disabled","title","click",4,"ngIf"],[3,"fieldset"],["icon","delete"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"disabled","title","click"],["icon","email"],["icon","unlock"],["icon","lock"],[1,"slds-align--absolute-center","slds-height_full"],["label","LBL_SELECT_EMAIL"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),r.YNc(4,W,2,0,"button",4),r.qZA(),r.YNc(5,oe,26,11,"div",5),r.qZA(),r.TgZ(6,"div",6),r._UZ(7,"div",null,7),r.qZA()(),r.YNc(9,ne,2,0,"div",8),r.qZA()),2&e&&(r.xp6(1),r.Q6J("ngClass",r.VKq(6,de,!s.model.id)),r.xp6(3),r.Q6J("ngIf","noSplit"==s.mailboxesEmails.activeSplitType.name),r.xp6(1),r.Q6J("ngIf",s.model.id),r.xp6(1),r.Udp("padding-left","noSplit"==s.mailboxesEmails.activeSplitType.name?3:.5,"rem"),r.xp6(3),r.Q6J("ngIf",!s.model.id))},dependencies:[i.mk,i.O5,I.j,P.S,$.Z,Z.J,K.f,w._,X.S],encapsulation:2})}return MailboxmanagerEmailDetails})();var re=t(9062);const me=function(e){return{"slds-theme_default":e}};let ue=(()=>{class MailboxManagerTextMessage{metadata;language;mailboxesEmails;view;model;modelutilities;message={};fieldset;constructor(e,s,t,i,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=t,this.view=i,this.model=l,this.modelutilities=a,this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerTextMessage").fieldset}ngOnInit(){this.model.module="TextMessages",this.model.id=this.message.id,this.model.setData(this.message)}selectTextmessage(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.message.status&&(e["font-weight"]="bold"),this.message.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}static ɵfac=function(e){return new(e||MailboxManagerTextMessage)(r.Y36(y.Pu),r.Y36(v.d),r.Y36(p),r.Y36(q.e),r.Y36(Y.o),r.Y36(F.A))};static ɵcmp=r.Xpm({type:MailboxManagerTextMessage,selectors:[["mailbox-manager-textmessage"]],inputs:{message:"message"},features:[r._Bn([Y.o,q.e])],decls:7,vars:6,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-text-title_caps","slds-truncate",3,"ngStyle"],[1,"slds-col--bump-left","slds-p-left--xx-small"],["field","date_sent","fielddisplayclass","slds-truncate"],["fielddisplayclass","",3,"fieldset"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0),r.NdJ("click",(function(){return s.selectTextmessage(s.message)})),r.TgZ(1,"div",1)(2,"div",2),r._uU(3),r.qZA(),r.TgZ(4,"div",3),r._UZ(5,"field-container",4),r.qZA()(),r._UZ(6,"object-record-fieldset",5),r.qZA()),2&e&&(r.Q6J("ngClass",r.VKq(4,me,s.isSelected)),r.xp6(2),r.Q6J("ngStyle",s.nameStyle),r.xp6(1),r.Oqu(s.message.description),r.xp6(3),r.Q6J("fieldset",s.fieldset))},dependencies:[i.mk,i.PC,I.j,re.d],encapsulation:2})}return MailboxManagerTextMessage})();function ge(e,s){if(1&e&&r._UZ(0,"mailbox-manager-textmessage",4),2&e){const e=s.$implicit;r.Q6J("message",e)}}function he(e,s){1&e&&(r.TgZ(0,"div",5),r._UZ(1,"system-spinner"),r.qZA())}let be=(()=>{class MailboxManagerTextMessages{mailboxesEmails;constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}static ɵfac=function(e){return new(e||MailboxManagerTextMessages)(r.Y36(p))};static ɵcmp=r.Xpm({type:MailboxManagerTextMessages,selectors:[["mailbox-manager-textmessages"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-border--right","slds-height_full",3,"scroll"],["scrollContainer",""],[3,"message",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium",4,"ngIf"],[3,"message"],[1,"slds-p-around--medium"]],template:function(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"div",0,1),r.NdJ("scroll",(function(){r.CHM(e);const t=r.MAs(1);return r.KtG(s.loadmore(t))})),r.YNc(2,ge,1,1,"mailbox-manager-textmessage",2),r.YNc(3,he,2,0,"div",3),r.qZA()}2&e&&(r.xp6(2),r.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),r.xp6(1),r.Q6J("ngIf",s.mailboxesEmails.isLoading))},dependencies:[i.sg,i.O5,B.W,ue],encapsulation:2})}return MailboxManagerTextMessages})();function pe(e,s){if(1&e&&r._UZ(0,"mailbox-manager-emails",6),2&e){const e=r.oxw(2);r.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function fe(e,s){if(1&e&&r._UZ(0,"mailbox-manager-textmessages",6),2&e){const e=r.oxw(2);r.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function xe(e,s){if(1&e&&(r.TgZ(0,"div",4),r.YNc(1,pe,1,2,"mailbox-manager-emails",5),r.YNc(2,fe,1,2,"mailbox-manager-textmessages",5),r._UZ(3,"mailbox-manager-email-details",6),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.isEmailMailbox),r.xp6(1),r.Q6J("ngIf",!e.isEmailMailbox),r.xp6(1),r.ekj("slds-hide",!e.mailboxesEmails.activeMessage)}}function Me(e,s){1&e&&r._UZ(0,"mailbox-manager-emails",9)}function ve(e,s){1&e&&r._UZ(0,"mailbox-manager-textmessages",9)}function _e(e,s){if(1&e&&(r.TgZ(0,"div",4),r.YNc(1,Me,1,0,"mailbox-manager-emails",7),r.YNc(2,ve,1,0,"mailbox-manager-textmessages",7),r._UZ(3,"mailbox-manager-email-details",8),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.isEmailMailbox),r.xp6(1),r.Q6J("ngIf",!e.isEmailMailbox)}}function ye(e,s){1&e&&r._UZ(0,"mailbox-manager-emails",13)}function Ee(e,s){1&e&&r._UZ(0,"mailbox-manager-textmessages",13)}function Ze(e,s){if(1&e&&(r.TgZ(0,"div",10),r.YNc(1,ye,1,0,"mailbox-manager-emails",11),r.YNc(2,Ee,1,0,"mailbox-manager-textmessages",11),r._UZ(3,"mailbox-manager-email-details",12),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.isEmailMailbox),r.xp6(1),r.Q6J("ngIf",!e.isEmailMailbox)}}let Te=(()=>{class MailboxManager{navigation;navigationtab;mailboxesEmails;constructor(e,s,t){this.navigation=e,this.navigationtab=s,this.mailboxesEmails=t,this.navigationtab.setTabInfo({displayname:"Mailboxes",displaymodule:"Mailboxes"})}get isEmailMailbox(){return!(!this.mailboxesEmails.activeMailBox||"email"!=this.mailboxesEmails.activeMailBox.type)}static ɵfac=function(e){return new(e||MailboxManager)(r.Y36(f.G),r.Y36(x.d),r.Y36(p))};static ɵcmp=r.Xpm({type:MailboxManager,selectors:[["mailbox-manager"]],features:[r._Bn([p])],decls:6,vars:6,consts:[["system-to-bottom-noscroll","",1,"slds-grid","slds-grid--vertical"],[3,"ngSwitch"],["class","slds-grid slds-grow","style","min-height: 0;",4,"ngSwitchCase"],["class","slds-grid slds-grid--vertical slds-grow","style","min-height: 0;",4,"ngSwitchCase"],[1,"slds-grid","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1 slds-height_full",3,"slds-hide",4,"ngIf"],[1,"slds-size--1-of-1","slds-height_full"],["class","slds-size--2-of-5",4,"ngIf"],[1,"slds-size--3-of-5"],[1,"slds-size--2-of-5"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1","style","height: 50%",4,"ngIf"],[1,"slds-size--1-of-1","slds-border--top",2,"height","50%"],[1,"slds-size--1-of-1",2,"height","50%"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0),r._UZ(1,"mailbox-manager-header"),r.ynx(2,1),r.YNc(3,xe,4,4,"div",2),r.YNc(4,_e,4,2,"div",2),r.YNc(5,Ze,4,2,"div",3),r.BQk(),r.qZA()),2&e&&(r.xp6(1),r.ekj("slds-hide",!!s.mailboxesEmails.activeMessage&&"noSplit"==(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),r.xp6(1),r.Q6J("ngSwitch",null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name),r.xp6(1),r.Q6J("ngSwitchCase","noSplit"),r.xp6(1),r.Q6J("ngSwitchCase","verticalSplit"),r.xp6(1),r.Q6J("ngSwitchCase","horizontalSplit"))},dependencies:[i.O5,i.RF,i.n9,M.t,S,j,ce,be],encapsulation:2})}return MailboxManager})(),Le=(()=>{class MailboxEmailToLeadButton{language;metadata;model;modal;toast;constructor(e,s,t,i,l){this.language=e,this.metadata=s,this.model=t,this.modal=i,this.toast=l}execute(){this.modal.openModal("MailboxEmailToLeadModal").subscribe((e=>{e.instance.email=this.model}))}static ɵfac=function(e){return new(e||MailboxEmailToLeadButton)(r.Y36(v.d),r.Y36(y.Pu),r.Y36(Y.o),r.Y36(G.o),r.Y36(z.A))};static ɵcmp=r.Xpm({type:MailboxEmailToLeadButton,selectors:[["mailbox-email-to-lead-emailbutton"]],decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,s){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[w._],encapsulation:2})}return MailboxEmailToLeadButton})();var we=t(59621),Ce=t(83499),ke=t(75767),Je=t(1916),Ae=t(7674);const Se=["contextMenu"];function Be(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"li",7)(1,"a",8),r.NdJ("click",(function(){const s=r.CHM(e).$implicit,t=r.oxw(2);return r.KtG(t.setField(s))})),r.TgZ(2,"span",9),r._UZ(3,"system-label-fieldname",10),r.qZA()()()}if(2&e){const e=s.$implicit,t=r.oxw(2);r.xp6(3),r.Q6J("module",t.emailmodule)("field",e)}}function Ye(e,s){if(1&e&&(r.TgZ(0,"div",3,4)(2,"ul",5),r.YNc(3,Be,4,2,"li",6),r.qZA()()),2&e){const e=r.oxw();r.Q6J("ngStyle",e.contextMenuStyle),r.xp6(3),r.Q6J("ngForOf",e.emailfields)}}let qe=(()=>{class MailboxEmailToLeadEmailText{elementRef;renderer;language;contextMenu;emailtext="";emailhtml="";emailmodule="";emailfields=["first_name","last_name"];setfield=new r.vpe;clickListener=null;displayContextMenu=!1;displayContextCoordinates={top:0,left:0};constructor(e,s,t){this.elementRef=e,this.renderer=s,this.language=t}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{left:this.displayContextCoordinates.left-e.left+"px",top:this.displayContextCoordinates.top-e.top+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static ɵfac=function(e){return new(e||MailboxEmailToLeadEmailText)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(v.d))};static ɵcmp=r.Xpm({type:MailboxEmailToLeadEmailText,selectors:[["mailbox-email-to-lead-emailtext"]],viewQuery:function(e,s){if(1&e&&r.Gf(Se,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(s.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.NdJ("contextmenu",(function(e){return s.showContextMenu(e)})),r.qZA(),r.YNc(2,Ye,4,2,"div",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("innerHTML",s.content,r.oJD),r.xp6(1),r.Q6J("ngIf",s.displayContextMenu))},dependencies:[i.sg,i.O5,i.PC,Ae.h],encapsulation:2})}return MailboxEmailToLeadEmailText})();const Fe=["detailcontainer"];let Ie=(()=>{class MailboxEmailToLeadModal{language;metadata;view;model;detailcontainer;email=null;self=null;componentRefs=[];leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"];constructor(e,s,t,i){this.language=e,this.metadata=s,this.view=t,this.model=i,this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let s of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(s.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=s.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}static ɵfac=function(e){return new(e||MailboxEmailToLeadModal)(r.Y36(v.d),r.Y36(y.Pu),r.Y36(q.e),r.Y36(Y.o))};static ɵcmp=r.Xpm({type:MailboxEmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,s){if(1&e&&r.Gf(Fe,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(s.detailcontainer=e.first)}},features:[r._Bn([Y.o,q.e])],decls:15,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-grid",2,"height","70vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return s.closeModal()})),r._UZ(2,"system-label",2),r.qZA(),r.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4)(6,"mailbox-email-to-lead-emailtext",5),r.NdJ("setfield",(function(e){return s.setField(e)})),r.qZA()(),r.TgZ(7,"div",6),r._UZ(8,"div",null,7),r.qZA()()(),r.TgZ(10,"system-modal-footer")(11,"button",8),r.NdJ("click",(function(){return s.closeModal()})),r._UZ(12,"system-label",9),r.qZA(),r.TgZ(13,"button",10),r.NdJ("click",(function(){return s.saveLead()})),r._UZ(14,"system-label",11),r.qZA()()()),2&e&&(r.xp6(6),r.Q6J("emailmodule",s.model.module)("emailtext",s.email.data.description)("emailhtml",s.email.data.body)("emailfields",s.leadFields))},dependencies:[w._,we.j,Ce.x,ke.p,Je.y,qe],encapsulation:2})}return MailboxEmailToLeadModal})();var Qe=t(83348),Oe=t(42161);const Ne=["tablecontainer"];function Ue(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"tr",16),r.NdJ("click",(function(){const s=r.CHM(e).$implicit,t=r.oxw(2);return r.KtG(t.goToRecord(s.id))})),r.TgZ(1,"td",17)(2,"div",18),r._uU(3),r.qZA()(),r.TgZ(4,"td",19)(5,"div",20),r._uU(6),r.qZA()(),r.TgZ(7,"td",19)(8,"div",18),r._uU(9),r.qZA()()()}if(2&e){const e=s.$implicit;r.xp6(3),r.hij(" ",e.name," "),r.xp6(2),r.ekj("slds-p-horizontal--xx-small",(null==e?null:e.emailsunread)>9),r.Q6J("ngClass",(null==e?null:e.emailsunread)>0?"slds-badge slds-theme--success":""),r.xp6(1),r.hij(" ",e.emailsunread," "),r.xp6(3),r.hij(" ",e.emailsread," ")}}function Re(e,s){if(1&e&&(r.TgZ(0,"tbody"),r.YNc(1,Ue,10,6,"tr",15),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngForOf",e.mailboxes)("ngForTrackBy",e.trackByFn)}}function De(e,s){1&e&&r._UZ(0,"tbody",21),2&e&&r.Q6J("columns",3)}let He=(()=>{class MailboxesDashlet{language;backend;model;router;isLoading=!1;mailboxes=[];canLoadMore=!0;loadLimit=20;getMailBoxesInterval=void 0;tablecontainer;constructor(e,s,t,i){this.language=e,this.backend=s,this.model=t,this.router=i}ngOnInit(){this.model.module="Mailboxes",this.getMailboxes(),this.getMailBoxesInterval=this.getMailboxesInterval()}ngOnDestroy(){this.getMailBoxesInterval&&window.clearInterval(this.getMailBoxesInterval)}trackByFn(e,s){return s.id}getMailboxes(e){this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((s=>{if(!s||0==s.length)return this.isLoading=!1;s.map((e=>e.emailsread=e.emailsread-e.emailsclosed)),e?this.mailboxes.every((e=>(s.some((s=>{if(s.id==e.id)return e.emailsread=s.emailsread,e.emailsunread=s.emailsunread,!0})),!0))):this.mailboxes=s,s.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1}))}getMailboxesInterval(){return window.setInterval((()=>this.getMailboxes(!0)),6e4)}onScroll(){let e=this.tablecontainer.element.nativeElement;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}goToRecord(e){this.router.navigate([`/module/${this.model.module}/${e}`])}loadMore(){this.canLoadMore&&(this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((e=>{this.mailboxes=this.mailboxes.concat(e),e.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1})))}static ɵfac=function(e){return new(e||MailboxesDashlet)(r.Y36(v.d),r.Y36(h.y),r.Y36(Y.o),r.Y36(Qe.F0))};static ɵcmp=r.Xpm({type:MailboxesDashlet,selectors:[["dashboard-mailboxes-dashlet"]],viewQuery:function(e,s){if(1&e&&r.Gf(Ne,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(s.tablecontainer=e.first)}},features:[r._Bn([Y.o,q.e])],decls:21,vars:2,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Mailboxes","size","small"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],[1,"slds-scrollable--y","slds-grow",2,"width","100%",3,"scroll"],["tablecontainer",""],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered","slds-table--fixed-layout","spice-table_header-fixed",2,"border-top","0"],[1,"slds-text-title_caps"],["scope","col"],[1,"slds-truncate","slds-text-align--center"],["label","LBL_NAME"],["label","LBL_UNREAD"],["label","LBL_READ"],[4,"ngIf"],["system-table-stencils","",3,"columns",4,"ngIf"],["style","cursor: pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click"],[1,"slds-truncate",2,"min-width","120px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"width","fit-content","height","fit-content"],[1,"slds-truncate",2,"min-width","100px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"border-radius","50%","width","fit-content","height","fit-content",3,"ngClass"],["system-table-stencils","",3,"columns"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r._UZ(2,"system-icon",2),r.TgZ(3,"h2",3),r._uU(4,"Mailboxes"),r.qZA()(),r.TgZ(5,"div",4,5),r.NdJ("scroll",(function(){return s.onScroll()})),r.TgZ(7,"table",6)(8,"thead")(9,"tr",7)(10,"th",8)(11,"div",9),r._UZ(12,"system-label",10),r.qZA()(),r.TgZ(13,"th",8)(14,"div",9),r._UZ(15,"system-label",11),r.qZA()(),r.TgZ(16,"th",8)(17,"div",9),r._UZ(18,"system-label",12),r.qZA()()()(),r.YNc(19,Re,2,2,"tbody",13),r.YNc(20,De,1,1,"tbody",14),r.qZA()()()),2&e&&(r.xp6(19),r.Q6J("ngIf",!s.isLoading&&s.mailboxes.length>0),r.xp6(1),r.Q6J("ngIf",s.isLoading))},dependencies:[i.mk,i.sg,i.O5,K.f,w._,Oe.x],encapsulation:2})}return MailboxesDashlet})(),je=(()=>{class MailboxSetDefaultButton{language;backend;toast;model;constructor(e,s,t,i){this.language=e,this.backend=s,this.toast=t,this.model=i}get disabled(){return null==this.model.data.id||this.model.getFieldValue("is_default")}execute(){this.backend.postRequest("module/Mailboxes/default",null,{mailbox_id:this.model.data.id}).subscribe((e=>{this.toast.sendToast("success","success"),this.model.setField("is_default",!0)}),(e=>{this.toast.sendToast(e.message,"error")}))}static ɵfac=function(e){return new(e||MailboxSetDefaultButton)(r.Y36(v.d),r.Y36(h.y),r.Y36(z.A),r.Y36(Y.o))};static ɵcmp=r.Xpm({type:MailboxSetDefaultButton,selectors:[["mailbox-set-default-button"]],decls:2,vars:0,consts:[["label","LBL_SET_DEFAULT"]],template:function(e,s){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[w._],encapsulation:2})}return MailboxSetDefaultButton})();var ze=t(61810),Ge=t(62422),Pe=t(66367),$e=t(73208),Ke=t(55638);function Xe(e,s){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Ve(e,s){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.hij(" ",e.display," ")}}function We(e,s){if(1&e&&(r.ynx(0),r.YNc(1,Ve,2,1,"ng-container",6),r.BQk()),2&e){const e=s.$implicit,t=r.oxw(2);r.xp6(1),r.Q6J("ngIf",e.value==t.value)}}function es(e,s){if(1&e&&(r.TgZ(0,"field-generic-display",4),r.YNc(1,We,2,1,"ng-container",5),r.qZA()),2&e){const e=r.oxw();r.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig),r.xp6(1),r.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn)}}function ss(e,s){if(1&e&&(r.ynx(0),r.TgZ(1,"option",12),r._uU(2),r.qZA(),r.BQk()),2&e){const e=s.$implicit;r.xp6(1),r.Q6J("value",e.value),r.xp6(1),r.Oqu(e.display)}}function ts(e,s){if(1&e){const e=r.EpF();r.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"select",10),r.NdJ("ngModelChange",(function(s){r.CHM(e);const t=r.oxw();return r.KtG(t.value=s)}))("ngModelChange",(function(s){r.CHM(e);const t=r.oxw();return r.KtG(t.setToPreferences(s))})),r.YNc(4,ss,3,2,"ng-container",5),r.qZA()(),r._UZ(5,"field-messages",11),r.qZA()()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngClass",e.getFieldClass()),r.xp6(2),r.Q6J("disabled",0==e.options.length)("ngModel",e.value),r.xp6(1),r.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn),r.xp6(1),r.Q6J("fieldname",e.fieldname)}}let is=(()=>{class fieldMailboxes extends ze.O{model;view;language;metadata;router;backend;configuration;userpreferences;cdRef;options=[];constructor(e,s,t,i,l,a,o,n,d){super(e,s,t,i,l),this.model=e,this.view=s,this.language=t,this.metadata=i,this.router=l,this.backend=a,this.configuration=o,this.userpreferences=n,this.cdRef=d}get value(){return this.model.getField(this.fieldname)}set value(e){this.model.setField(this.fieldname,e)}get scope(){return this.fieldconfig.scope?this.fieldconfig.scope:"outboundsingle"}ngOnInit(){super.ngOnInit(),this.setValueFromPreferences(),this.getOptions()}getOptions(){const e=this.configuration.getData(`mailboxes${this.scope}`);_.isEmpty(e)?this.backend.getRequest("module/Mailboxes/scope",{scope:this.scope}).subscribe((e=>{this.options=e.sort(((e,s)=>e.display.localeCompare(s.display))),this.configuration.setData(`mailboxes${this.scope}`,this.options),this.cdRef.detectChanges()})):this.options=e}trackByFn(e,s){return s.value}setValueFromPreferences(){if(this.value||this.fieldconfig.disableCache)return;const e=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);e&&this.isEditMode()&&this.model.setField(this.fieldname,e),this.subscriptions.add(this.model.mode$.subscribe((e=>{if("edit"!=e||this.value)return;const s=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);s&&this.model.setField(this.fieldname,s)})))}setToPreferences(e){this.fieldconfig.disableCache||this.userpreferences.setPreference(`defaultmailbox_${this.scope}`,e)}static ɵfac=function(e){return new(e||fieldMailboxes)(r.Y36(Y.o),r.Y36(q.e),r.Y36(v.d),r.Y36(y.Pu),r.Y36(Qe.F0),r.Y36(h.y),r.Y36(E.C),r.Y36(Ge.z),r.Y36(r.sBO))};static ɵcmp=r.Xpm({type:fieldMailboxes,selectors:[["ng-component"]],features:[r.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"fieldname"],[3,"value"]],template:function(e,s){1&e&&(r.YNc(0,Xe,1,2,"field-label",0),r.YNc(1,es,2,5,"field-generic-display",1),r.YNc(2,ts,6,6,"div",2)),2&e&&(r.Q6J("ngIf",s.displayLabel),r.xp6(1),r.Q6J("ngIf",!s.isEditMode()),r.xp6(1),r.Q6J("ngIf",s.isEditMode()))},dependencies:[i.mk,i.sg,i.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Pe.q,$e.D,Ke.a],encapsulation:2})}return fieldMailboxes})(),ls=(()=>{class ModuleMailboxes{static ɵfac=function(e){return new(e||ModuleMailboxes)};static ɵmod=r.oAB({type:ModuleMailboxes});static ɵinj=r.cJS({imports:[i.ez,l.u5,d.ObjectFields,o.GlobalComponents,n.ObjectComponents,c.SystemComponents,a.o]})}return ModuleMailboxes})();("undefined"==typeof ngJitMode||ngJitMode)&&r.kYT(ls,{declarations:[Te,S,j,R,ce,ue,be,Le,Ie,qe,He,je,is],imports:[i.ez,l.u5,d.ObjectFields,o.GlobalComponents,n.ObjectComponents,c.SystemComponents,a.o]})}}]);