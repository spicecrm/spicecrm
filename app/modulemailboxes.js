/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-05-28 17:40:40
 *
 *                     build: 2024.01.001.1716910840504
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_mailboxes_modulemailboxes_ts"],{70065:(e,s,t)=>{t.r(s),t.d(s,{ModuleMailboxes:()=>as});var i=t(60177),l=t(84341),a=t(71341),n=t(12948),o=t(37328),d=t(7745),r=t(70569),c=t(54438),m=t(18359),u=t(84412),h=t(21413),b=t(49722),g=t(40553);let f=(()=>{class mailboxesEmails{constructor(e,s){this.backend=e,this.broadcast=s,this.activeSplitType={name:"noSplit",icon:"picklist_type",label:"LBL_NO_SPLIT"},this.limit=50,this.mailboxes=[],this.emails=[],this.totalcount=0,this.source="fts",this.activeMessage$=new c.bkB,this._unreadonly=!0,this.isLoading=!1,this.emailopenness="",this.serviceSubscriptions=new m.yU,this.mailboxesLoaded$=new u.t(!1),this.getMailboxes(),this.serviceSubscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleMessage(e)})))}ngOnDestroy(){this.serviceSubscriptions.unsubscribe()}get activeMessage(){return this._activeMessage}set activeMessage(e){this._activeMessage=e,this.activeMessage$.emit(e)}get activeMailBox(){return this._activeMailBox}set activeMailBox(e){this._activeMailBox=e,this.emails=[],this.totalcount=0}get unreadonly(){return this._unreadonly}set unreadonly(e){this._unreadonly=e,this.loadMessages()}getMailboxes(){this.backend.getRequest("module/Mailboxes/scope",{scope:"inbound"}).subscribe((e=>{for(let s of e)this.mailboxes.push({actionset:s.actionset,id:s.value,name:s.display,type:s.type});this.mailboxesLoaded$.next(!0)}))}handleMessage(e){if("Emails"===e.messagedata.module)switch(e.messagetype){case"model.delete":let s=this.emails.findIndex((s=>s.id==e.messagedata.id));s>=0&&(this.activeMessage.id==e.messagedata.id&&(this.activeMessage=void 0),this.emails.splice(s,1),this.totalcount--);break;case"model.save":let t=this.emails.findIndex((s=>s.id==e.messagedata.id));t>=0&&(this.emails[t]=e.messagedata.data)}}fetchEmails(){let e=new h.B;return this.backend.getRequest("module/Mailboxes/"+this.activeMailBox.id+"/fetchemails").subscribe((s=>{s.new_mail_count>0&&this.loadMessages(),e.next({status:"success",newmailcount:s.new_mail_count}),e.complete()}),(s=>{e.error({status:"error",error:s}),e.complete()})),e.asObservable()}generateFilters(){let e={logicaloperator:"and",groupscope:"all",conditions:[{field:"mailbox_id",filtervalue:this.activeMailBox.id,operator:"equals"}]};return"sms"==this.activeMailBox.type?e.conditions.push({field:"direction",filtervalue:"i",operator:"equals"}):(e.conditions.push({field:"type",filtervalue:"inbound",operator:"equals"}),this.emailopenness&&e.conditions.push({field:"openness",filtervalue:this.emailopenness,operator:"equals"}),this.unreadonly&&e.conditions.push({field:"status",filtervalue:"unread",operator:"equals"})),e}get endpoint(){return"sms"==this.activeMailBox.type?"module/TextMessages":"module/Emails"}get requestFields(){return"sms"==this.activeMailBox.type?["name","id","msisdn_e164","date_sent","description"]:["name","id","from_addr_name","date_sent","status","openness","sentiment","magnitude"]}loadMessages(){if(!this.activeMailBox||this.activeMailBox&&!this.activeMailBox.id)return!1;this.activeMessage=void 0,this.emails=[];this.activeMailBox.id;let e={filter:this.generateFilters(),sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}],fields:JSON.stringify(this.requestFields),limit:this.limit,searchterm:this.searchTerm};this.isLoading=!0,this.backend.getRequest(this.endpoint,e).subscribe((e=>{this.emails=e.list,this.source=e.source,this.totalcount=e.totalcount,this.isLoading=!1}))}loadMore(){if(this.isLoading||this.emails.length>=this.totalcount)return!1;this.isLoading=!0;let e={fields:JSON.stringify(this.requestFields),filter:this.generateFilters(),limit:this.limit,offset:this.emails.length,sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}]};this.backend.getRequest(this.endpoint,e).subscribe((e=>{e.list.length>0&&(this.emails=this.emails.concat(e.list),this.source=e.source,this.totalcount=e.totalcount),this.isLoading=!1}))}static#e=this.ɵfac=function(e){return new(e||mailboxesEmails)(c.KVO(b.H),c.KVO(g.m))};static#s=this.ɵprov=c.jDH({token:mailboxesEmails,factory:mailboxesEmails.ɵfac})}return mailboxesEmails})();var p=t(60968),x=t(66031),M=t(69139),v=t(69904),y=t(83935),E=t(53584),L=t(25863),k=t(84359),R=t(39554),B=t(32062),T=t(18521),I=t(24834);function j(e,s){if(1&e&&(c.j41(0,"option",34),c.EFF(1),c.k0s()),2&e){const e=s.$implicit;c.FS9("value",e.id),c.R7$(),c.SpI(" ",e.name," ")}}function G(e,s){if(1&e){const e=c.RV6();c.j41(0,"div",35)(1,"system-input-search-term",36),c.mxI("ngModelChange",(function(s){c.eBV(e);const t=c.XpG();return c.DH7(t.searchTerm,s)||(t.searchTerm=s),c.Njj(s)})),c.bIt("onEnterPress",(function(){c.eBV(e);const s=c.XpG();return c.Njj(s.reloadList())})),c.k0s()()}if(2&e){const e=c.XpG();c.R7$(),c.R50("ngModel",e.searchTerm),c.Y8G("placeholder",e.language.getModuleCombinedLabel("LBL_SEARCH","Mailboxes"))}}let S=(()=>{class MailboxManagerHeader{constructor(e,s,t,i,l){this.language=e,this.mailboxesEmails=s,this.metadata=t,this.navigationtab=i,this.configuration=l,this.splitTypeOptions=[{value:"noSplit",icon:"picklist_type",title:"LBL_NO_SPLIT"},{value:"verticalSplit",icon:"side_list",title:"LBL_VERTICAL_SPLIT"},{value:"horizontalSplit",icon:"inspector_panel",title:"LBL_HORIZONTAL_SPLIT"}],this.searchTermError=!1,this.isFetching=!1;let a=this.metadata.getComponentConfig("MailboxManagerHeader");this.emailopenness=a.selectionstatus?a.selectionstatus:"",this.mailboxesEmails.unreadonly=!!a.unreadonly&&a.unreadonly}get mailbox(){return this._mailbox}set mailbox(e){this._mailbox=e,e?(this.mailboxesEmails.activeMailBox=this.mailboxesEmails.mailboxes.find((s=>s.id==e)),this.mailboxesEmails.loadMessages(),this.navigationtab.setTabInfo({displayname:this.mailboxesEmails.activeMailBox.name,displaymodule:"Mailboxes"})):this.mailboxesEmails.activeMailBox={}}get emailopenness(){return""==this.mailboxesEmails.emailopenness?"all":this.mailboxesEmails.emailopenness}set emailopenness(e){this.mailboxesEmails.emailopenness="all"==e?"":e,this.mailboxesEmails.loadMessages()}get buttonenabled(){return this.mailboxesEmails.activeMailBox&&!this.mailboxesEmails.isLoading&&!this.isFetching}get searchTerm(){return this.mailboxesEmails.searchTerm}set searchTerm(e){e!=this.mailboxesEmails.searchTerm&&(this.mailboxesEmails.searchTerm=e,""==e||this.searchTermsValid(e)?(this.searchTermError=!1,this.reloadList()):(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTermError=!0))}ngOnInit(){this.loadOneMailbox(),this.navigationtab.activeRoute.params.id&&this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&(this.mailbox=this.navigationtab.activeRoute.params.id)}))}loadOneMailbox(){this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&1==this.mailboxesEmails.mailboxes.length&&(this.mailbox=this.mailboxesEmails.mailboxes[0].id)}))}clearSearchTerm(){this.mailboxesEmails.searchTerm=void 0,this.reloadList()}searchTermsValid(e){let s=this.configuration.getCapabilityConfig("search"),t=s.min_ngram?parseInt(s.min_ngram,10):3;return 0==e.split(" ").filter((e=>e.length<t)).length}reloadList(){this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.mailboxesEmails.loadMessages()),1e3)}fetchEmails(){this.isFetching=!0,this.mailboxesEmails.fetchEmails().subscribe((e=>{this.isFetching=!1}),(e=>{this.isFetching=!1}))}setActiveSplitType(e){const s={name:e};switch(e){case"noSplit":this.mailboxesEmails.activeMessage=null,s.icon="picklist_type",s.label="LBL_NO_SPLIT";break;case"verticalSplit":s.icon="side_list",s.label="LBL_VERTICAL_SPLIT";break;case"horizontalSplit":s.icon="inspector_panel",s.label="LBL_HORIZONTAL_SPLIT"}this.mailboxesEmails.activeSplitType=s}static#e=this.ɵfac=function(e){return new(e||MailboxManagerHeader)(c.rXU(v.B),c.rXU(f),c.rXU(y.yu),c.rXU(x._),c.rXU(E.i))};static#s=this.ɵcmp=c.VBU({type:MailboxManagerHeader,selectors:[["mailbox-manager-header"]],decls:43,vars:13,consts:[[1,"slds-grid","slds-form--inline","slds-p-around--small","slds-border--bottom"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-p-right--xx-small"],[1,"slds-select_container"],[1,"slds-select",2,"min-width","250px",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__control","slds-p-horizontal--xx-small"],[3,"ngModel","ngModelChange"],["label","LBL_UNREAD_ONLY"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","all"],["label","LBL_EMAILS_ALL"],["value","open"],["label","LBL_EMAILS_OPEN"],["value","user_closed"],["label","LBL_EMAILS_USER_CLOSED"],["value","system_closed"],["label","LBL_EMAILS_SYSTEM_CLOSED"],[1,"slds-p-horizontal--xx-small"],[1,"slds-list_horizontal","slds-has-dividers_left","slds-has-block-links_space"],[1,"slds-item"],["label","LBL_OF"],["label","LBL_ITEMS"],["size","xx-small",3,"icon"],["class","slds-p-right--small slds-m-left--small","style","width: 400px",4,"ngIf"],[1,"slds-col--bump-left","slds-grid"],[1,"slds-m-horizontal--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","refresh",1,"slds-button__icon--left"],["label","LBL_REFRESH"],["icon","email",1,"slds-button__icon--left"],["label","LBL_FETCH_EMAILS"],[3,"value"],[1,"slds-p-right--small","slds-m-left--small",2,"width","400px"],[1,"slds-grow",3,"ngModel","placeholder","ngModelChange","onEnterPress"]],template:function(e,s){1&e&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"select",4),c.mxI("ngModelChange",(function(e){return c.DH7(s.mailbox,e)||(s.mailbox=e),e})),c.DNE(5,j,2,2,"option",5),c.k0s()()(),c.j41(6,"div",6)(7,"system-checkbox",7),c.mxI("ngModelChange",(function(e){return c.DH7(s.mailboxesEmails.unreadonly,e)||(s.mailboxesEmails.unreadonly=e),e})),c.nrm(8,"system-label",8),c.k0s()(),c.j41(9,"div",6)(10,"div",3)(11,"select",9),c.mxI("ngModelChange",(function(e){return c.DH7(s.emailopenness,e)||(s.emailopenness=e),e})),c.j41(12,"option",10),c.nrm(13,"system-label",11),c.k0s(),c.j41(14,"option",12),c.nrm(15,"system-label",13),c.k0s(),c.j41(16,"option",14),c.nrm(17,"system-label",15),c.k0s(),c.j41(18,"option",16),c.nrm(19,"system-label",17),c.k0s()()()(),c.j41(20,"div",18)(21,"ul",19)(22,"li",20)(23,"span"),c.EFF(24),c.nrm(25,"system-label",21),c.EFF(26),c.nrm(27,"system-label",22),c.k0s()(),c.j41(28,"li",20),c.nrm(29,"system-utility-icon",23),c.k0s()()(),c.DNE(30,G,2,2,"div",24),c.k0s(),c.j41(31,"div",25)(32,"div",26)(33,"system-input-radio-button-group",27),c.bIt("ngModelChange",(function(e){return s.setActiveSplitType(e)})),c.k0s()(),c.j41(34,"div",28)(35,"button",29),c.bIt("click",(function(){return s.reloadList()})),c.nrm(36,"system-button-icon",30),c.j41(37,"span"),c.nrm(38,"system-label",31),c.k0s()(),c.j41(39,"button",29),c.bIt("click",(function(){return s.fetchEmails()})),c.nrm(40,"system-button-icon",32),c.j41(41,"span"),c.nrm(42,"system-label",33),c.k0s()()()()()),2&e&&(c.R7$(4),c.R50("ngModel",s.mailbox),c.Y8G("disabled",0==s.mailboxesEmails.mailboxes.length||s.isFetching),c.R7$(),c.Y8G("ngForOf",s.mailboxesEmails.mailboxes),c.R7$(2),c.R50("ngModel",s.mailboxesEmails.unreadonly),c.R7$(4),c.R50("ngModel",s.emailopenness),c.R7$(13),c.SpI("",s.mailboxesEmails.emails.length," "),c.R7$(2),c.SpI(" ",s.mailboxesEmails.totalcount," "),c.R7$(3),c.Y8G("icon","db"==s.mailboxesEmails.source?"database":"feed"),c.R7$(),c.Y8G("ngIf",!!s.mailbox),c.R7$(3),c.Y8G("ngModel",s.mailboxesEmails.activeSplitType.name)("inputOptions",s.splitTypeOptions),c.R7$(2),c.Y8G("disabled",!s.buttonenabled),c.R7$(4),c.Y8G("disabled",!s.buttonenabled))},dependencies:[i.Sq,i.bT,l.xH,l.y7,l.wz,l.BC,l.vS,L.t,k.f,R.s,B.W,T.B,I.w],encapsulation:2})}return MailboxManagerHeader})();var C=t(48717),w=t(35911),$=t(41731),U=t(92462),F=t(15091);function X(e,s){1&e&&c.nrm(0,"system-utility-icon",9)}const Y=e=>({"slds-theme_default":e}),O=()=>({fieldtype:"emailsubject"}),D=()=>({fieldtype:"activitydate"});let V=(()=>{class MailboxManagerEmail{constructor(e,s,t,i,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=t,this.view=i,this.model=l,this.modelutilities=a,this.email={},this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerEmail").fieldset}ngOnInit(){this.model.module="Emails",this.model.id=this.email.id,this.model.setData(this.email)}selectMail(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.email.status&&(e["font-weight"]="bold"),this.email.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}static#e=this.ɵfac=function(e){return new(e||MailboxManagerEmail)(c.rXU(y.yu),c.rXU(v.B),c.rXU(f),c.rXU($.U),c.rXU(w.g),c.rXU(U.g))};static#s=this.ɵcmp=c.VBU({type:MailboxManagerEmail,selectors:[["mailbox-manager-email"]],inputs:{email:"email"},features:[c.Jv_([w.g,$.U])],decls:9,vars:10,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--xx-small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid"],[1,"slds-grow","slds-truncate"],["field","name","fielddisplayclass","",1,"slds-grow","slds-truncate","slds-p-right--xx-small","spice-display-block",3,"fieldconfig"],["field","from_addr","fielddisplayclass","",1,"slds-truncate","spice-display-block",2,"min-width","220px","width","220px"],[1,"slds-p-left--xx-small","slds-truncate","slds-grid","slds-grid--align-spread",2,"min-width","100px","width","100px"],[2,"width","22px"],["icon","attach","size","xx-small","class","slds-p-right--x-small",4,"ngIf"],["field","date_sent","fielddisplayclass","",1,"slds-truncate",3,"fieldconfig"],["icon","attach","size","xx-small",1,"slds-p-right--x-small"]],template:function(e,s){1&e&&(c.j41(0,"div",0),c.bIt("click",(function(){return s.selectMail(s.email)})),c.j41(1,"div",1)(2,"div",2),c.nrm(3,"field-container",3)(4,"field-container",4),c.k0s(),c.j41(5,"div",5)(6,"div",6),c.DNE(7,X,1,0,"system-utility-icon",7),c.k0s(),c.nrm(8,"field-container",8),c.k0s()()()),2&e&&(c.Y8G("ngClass",c.eq3(6,Y,s.isSelected)),c.R7$(2),c.AVh("slds-grid","verticalSplit"!=(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),c.R7$(),c.Y8G("fieldconfig",c.lJ4(8,O)),c.R7$(4),c.Y8G("ngIf",s.email.attachments_count>0),c.R7$(),c.Y8G("fieldconfig",c.lJ4(9,D)))},dependencies:[i.YU,i.bT,F.y,T.B],encapsulation:2})}return MailboxManagerEmail})();function N(e,s){if(1&e&&c.nrm(0,"mailbox-manager-email",4),2&e){const e=s.$implicit;c.Y8G("email",e)}}function A(e,s){1&e&&(c.j41(0,"div",5),c.nrm(1,"system-spinner"),c.k0s())}let z=(()=>{class MailboxManagerEmails{constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}static#e=this.ɵfac=function(e){return new(e||MailboxManagerEmails)(c.rXU(f))};static#s=this.ɵcmp=c.VBU({type:MailboxManagerEmails,selectors:[["mailbox-manager-emails"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-height_full","slds-border--right",3,"scroll"],["scrollContainer",""],[3,"email",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium slds-align--absolute-center",4,"ngIf"],[3,"email"],[1,"slds-p-around--medium","slds-align--absolute-center"]],template:function(e,s){if(1&e){const e=c.RV6();c.j41(0,"div",0,1),c.bIt("scroll",(function(){c.eBV(e);const t=c.sdS(1);return c.Njj(s.loadmore(t))})),c.DNE(2,N,1,1,"mailbox-manager-email",2)(3,A,2,0,"div",3),c.k0s()}2&e&&(c.R7$(2),c.Y8G("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),c.R7$(),c.Y8G("ngIf",s.mailboxesEmails.isLoading))},dependencies:[i.Sq,i.bT,C.P,V],encapsulation:2})}return MailboxManagerEmails})();var q=t(41081),H=t(50531),P=t(44261),J=t(29895),K=t(68823),W=t(22465);const Q=["detailscontent"];function Z(e,s){if(1&e){const e=c.RV6();c.j41(0,"button",9),c.bIt("click",(function(){c.eBV(e);const s=c.XpG();return c.Njj(s.goBack())})),c.nrm(1,"system-button-icon",10),c.k0s()}}function ee(e,s){if(1&e&&(c.qex(0),c.EFF(1),c.bVm()),2&e){const e=c.XpG(2);c.R7$(),c.JRh(e.model.data.summary_text)}}function se(e,s){if(1&e&&c.nrm(0,"object-record-fieldset-horizontal-list",32),2&e){const e=c.XpG(2);c.Y8G("fieldset",e.fieldset)}}function te(e,s){if(1&e){const e=c.RV6();c.j41(0,"button",26),c.bIt("click",(function(){c.eBV(e);const s=c.XpG(2);return c.Njj(s.delete())})),c.nrm(1,"system-button-icon",33),c.k0s()}if(2&e){const e=c.XpG(2);c.Y8G("title",e.language.getLabel("LBL_DELETE"))}}function ie(e,s){if(1&e){const e=c.RV6();c.j41(0,"button",34),c.bIt("click",(function(){c.eBV(e);const s=c.XpG(2);return c.Njj(s.markUnread())})),c.nrm(1,"system-button-icon",35),c.k0s()}if(2&e){const e=c.XpG(2);c.Y8G("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_UNREAD"))}}function le(e,s){if(1&e){const e=c.RV6();c.j41(0,"button",34),c.bIt("click",(function(){c.eBV(e);const s=c.XpG(2);return c.Njj(s.completeMail())})),c.nrm(1,"system-button-icon",36),c.k0s()}if(2&e){const e=c.XpG(2);c.Y8G("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function ae(e,s){if(1&e){const e=c.RV6();c.j41(0,"button",34),c.bIt("click",(function(){c.eBV(e);const s=c.XpG(2);return c.Njj(s.reopen())})),c.nrm(1,"system-button-icon",37),c.k0s()}if(2&e){const e=c.XpG(2);c.Y8G("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}function ne(e,s){if(1&e){const e=c.RV6();c.j41(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14),c.nrm(4,"system-icon",15),c.j41(5,"div",16)(6,"ul",17)(7,"li",18),c.nrm(8,"field-container",19),c.k0s(),c.j41(9,"li",18),c.nrm(10,"field-container",20),c.k0s()(),c.j41(11,"h1",21),c.DNE(12,ee,2,1,"ng-container",22)(13,se,1,1,"object-record-fieldset-horizontal-list",23),c.k0s()()()(),c.j41(14,"object-action-container",24),c.bIt("actionemitter",(function(s){c.eBV(e);const t=c.XpG();return c.Njj(t.handleAction(s))})),c.k0s(),c.j41(15,"div",25)(16,"button",26),c.bIt("click",(function(){c.eBV(e);const s=c.XpG();return c.Njj(s.replyToAll())})),c.nrm(17,"system-button-icon",27),c.k0s(),c.j41(18,"button",26),c.bIt("click",(function(){c.eBV(e);const s=c.XpG();return c.Njj(s.reply())})),c.nrm(19,"system-button-icon",28),c.k0s(),c.j41(20,"button",26),c.bIt("click",(function(){c.eBV(e);const s=c.XpG();return c.Njj(s.forward())})),c.nrm(21,"system-button-icon",29),c.k0s(),c.DNE(22,te,2,1,"button",30)(23,ie,2,2,"button",31)(24,le,2,2,"button",31)(25,ae,2,2,"button",31),c.k0s()()()}if(2&e){const e=c.XpG();c.R7$(4),c.Y8G("module",e.model.module),c.R7$(8),c.Y8G("ngIf",!e.fieldset),c.R7$(),c.Y8G("ngIf",e.fieldset),c.R7$(),c.Y8G("actionset",e.actionSet),c.R7$(2),c.Y8G("title",e.language.getLabel("LBL_REPLY_ALL")),c.R7$(2),c.Y8G("title",e.language.getLabel("LBL_REPLY")),c.R7$(2),c.Y8G("title",e.language.getLabel("LBL_FORWARD")),c.R7$(2),c.Y8G("ngIf",e.model.checkAccess("delete")),c.R7$(),c.Y8G("ngIf",e.isRead),c.R7$(),c.Y8G("ngIf",!e.isUserClosed),c.R7$(),c.Y8G("ngIf",e.isUserClosed)}}function oe(e,s){1&e&&(c.j41(0,"div",38),c.nrm(1,"system-label",39),c.k0s())}const de=e=>({"slds-hide":e});let re=(()=>{class MailboxmanagerEmailDetails{constructor(e,s,t,i,l,a,n,o,d){this.language=e,this.metadata=s,this.model=t,this.mailboxesEmails=i,this.backend=l,this.toast=a,this.view=n,this.modal=o,this.injector=d,this.containerComponents=[],this.fieldset="",this.mailboxSubscription=this.mailboxesEmails.activeMessage$.subscribe((e=>{this.loadEmail(e)})),this.view.displayLabels=!1}ngOnDestroy(){this.mailboxSubscription.unsubscribe()}loadEmail(e){this.mailboxesEmails.activeMailBox&&("sms"==this.mailboxesEmails.activeMailBox.type?this.model.module="TextMessages":"email"==this.mailboxesEmails.activeMailBox.type&&(this.model.module="Emails")),this.model.initialize(),e?(this.model.id=e.id,this.buildContainer(),this.model.getData(!1,"").subscribe((e=>{"unread"==this.model.getFieldValue("status")&&this.setStatus("read")}))):this.model.id=void 0}destroyContainer(){for(let e of this.containerComponents)e.destroy();this.containerComponents=[]}handleAction(e){if("save"===e)this.buildContainer()}buildContainer(){this.destroyContainer();let e=this.metadata.getComponentConfig("MailboxmanagerEmailDetails",this.model.module),s="horizontalSplit"==this.mailboxesEmails.activeSplitType.name?e.horizontalComponentset:e.componentset;for(let e of this.metadata.getComponentSetObjects(s))this.metadata.addComponent(e.component,this.detailscontent).subscribe((s=>{s.instance.componentconfig=e.componentconfig?e.componentconfig:{},this.containerComponents.push(s)}));this.fieldset=e.fieldset}get isUserClosed(){return"user_closed"==this.model.getField("openness")}get isRead(){return"read"==this.model.getField("status")}get actionSet(){return this.mailboxesEmails.activeMailBox.actionset?this.mailboxesEmails.activeMailBox.actionset:""}completeMail(){this.setOpenness("user_closed")}markUnread(){this.setStatus("unread")}reopen(){this.setOpenness("open")}setStatus(e){this.model.setField("status",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/status",null,{status:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.status=e}),(s=>{this.toast.sendAlert("Cannot change status to "+e)}))}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/openness",null,{openness:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.openness=e}),(s=>{this.toast.sendAlert("Cannot change openness to "+e)}))}replyToAll(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{e.instance.mode="replyall"}))}reply(){this.modal.openModal("EmailReplyModal",!0,this.injector)}forward(){this.modal.openModal("EmailForwardModal",!0,this.injector)}delete(){this.model.delete()}goBack(){this.mailboxesEmails.activeMessage=null}static#e=this.ɵfac=function(e){return new(e||MailboxmanagerEmailDetails)(c.rXU(v.B),c.rXU(y.yu),c.rXU(w.g),c.rXU(f),c.rXU(b.H),c.rXU(q.o),c.rXU($.U),c.rXU(H.y),c.rXU(c.zZn))};static#s=this.ɵcmp=c.VBU({type:MailboxmanagerEmailDetails,selectors:[["mailbox-manager-email-details"]],viewQuery:function(e,s){if(1&e&&c.GBs(Q,7,c.c1b),2&e){let e;c.mGM(e=c.lsd())&&(s.detailscontent=e.first)}},features:[c.Jv_([w.g,$.U])],decls:10,vars:8,consts:[[1,"slds-theme--shade","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"ngClass"],[1,"slds-grid","slds-border--bottom"],[1,"slds-grid","slds-grid--align-end","slds-p-vertical--medium",2,"width","3rem"],["system-title","LBL_BACK","class","slds-button slds-button--icon slds-button_icon-border-filled",3,"click",4,"ngIf"],["class","slds-p-around--medium slds-border--bottom slds-grow",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small","slds-theme--default","slds-scrollable--y","slds-grow",2,"min-height","0"],["detailscontent",""],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],["system-title","LBL_BACK",1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"click"],["icon","back"],[1,"slds-p-around--medium","slds-border--bottom","slds-grow"],[1,"slds-grid"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-list_horizontal","slds-has-dividers_left"],[1,"slds-item"],["field","date_sent","fielddisplayclass","slds-truncate"],["field","status","fielddisplayclass","slds-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[3,"fieldset",4,"ngIf"],[3,"actionset","actionemitter"],[1,"slds-p-left--small","slds-button-group"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"title","click"],["icon","reply_all"],["icon","reply"],["icon","forward"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"title","click",4,"ngIf"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"disabled","title","click",4,"ngIf"],[3,"fieldset"],["icon","delete"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"disabled","title","click"],["icon","email"],["icon","unlock"],["icon","lock"],[1,"slds-align--absolute-center","slds-height_full"],["label","LBL_SELECT_EMAIL"]],template:function(e,s){1&e&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c.DNE(4,Z,2,0,"button",4),c.k0s(),c.DNE(5,ne,26,11,"div",5),c.k0s(),c.j41(6,"div",6),c.nrm(7,"div",null,7),c.k0s()(),c.DNE(9,oe,2,0,"div",8),c.k0s()),2&e&&(c.R7$(),c.Y8G("ngClass",c.eq3(6,de,!s.model.id)),c.R7$(3),c.Y8G("ngIf","noSplit"==s.mailboxesEmails.activeSplitType.name),c.R7$(),c.Y8G("ngIf",s.model.id),c.R7$(),c.xc7("padding-left","noSplit"==s.mailboxesEmails.activeSplitType.name?3:.5,"rem"),c.R7$(3),c.Y8G("ngIf",!s.model.id))},dependencies:[i.YU,i.bT,F.y,P.l,J.b,L.t,K.J,B.W,W.L],encapsulation:2})}return MailboxmanagerEmailDetails})();var ce=t(3719);const me=e=>({"slds-theme_default":e});let ue=(()=>{class MailboxManagerTextMessage{constructor(e,s,t,i,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=t,this.view=i,this.model=l,this.modelutilities=a,this.message={},this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerTextMessage").fieldset}ngOnInit(){this.model.module="TextMessages",this.model.id=this.message.id,this.model.setData(this.message)}selectTextmessage(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.message.status&&(e["font-weight"]="bold"),this.message.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}static#e=this.ɵfac=function(e){return new(e||MailboxManagerTextMessage)(c.rXU(y.yu),c.rXU(v.B),c.rXU(f),c.rXU($.U),c.rXU(w.g),c.rXU(U.g))};static#s=this.ɵcmp=c.VBU({type:MailboxManagerTextMessage,selectors:[["mailbox-manager-textmessage"]],inputs:{message:"message"},features:[c.Jv_([w.g,$.U])],decls:7,vars:6,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-text-title_caps","slds-truncate",3,"ngStyle"],[1,"slds-col--bump-left","slds-p-left--xx-small"],["field","date_sent","fielddisplayclass","slds-truncate"],["fielddisplayclass","",3,"fieldset"]],template:function(e,s){1&e&&(c.j41(0,"div",0),c.bIt("click",(function(){return s.selectTextmessage(s.message)})),c.j41(1,"div",1)(2,"div",2),c.EFF(3),c.k0s(),c.j41(4,"div",3),c.nrm(5,"field-container",4),c.k0s()(),c.nrm(6,"object-record-fieldset",5),c.k0s()),2&e&&(c.Y8G("ngClass",c.eq3(4,me,s.isSelected)),c.R7$(2),c.Y8G("ngStyle",s.nameStyle),c.R7$(),c.JRh(s.message.description),c.R7$(3),c.Y8G("fieldset",s.fieldset))},dependencies:[i.YU,i.B3,F.y,ce.D],encapsulation:2})}return MailboxManagerTextMessage})();function he(e,s){if(1&e&&c.nrm(0,"mailbox-manager-textmessage",4),2&e){const e=s.$implicit;c.Y8G("message",e)}}function be(e,s){1&e&&(c.j41(0,"div",5),c.nrm(1,"system-spinner"),c.k0s())}let ge=(()=>{class MailboxManagerTextMessages{constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}static#e=this.ɵfac=function(e){return new(e||MailboxManagerTextMessages)(c.rXU(f))};static#s=this.ɵcmp=c.VBU({type:MailboxManagerTextMessages,selectors:[["mailbox-manager-textmessages"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-border--right","slds-height_full",3,"scroll"],["scrollContainer",""],[3,"message",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium",4,"ngIf"],[3,"message"],[1,"slds-p-around--medium"]],template:function(e,s){if(1&e){const e=c.RV6();c.j41(0,"div",0,1),c.bIt("scroll",(function(){c.eBV(e);const t=c.sdS(1);return c.Njj(s.loadmore(t))})),c.DNE(2,he,1,1,"mailbox-manager-textmessage",2)(3,be,2,0,"div",3),c.k0s()}2&e&&(c.R7$(2),c.Y8G("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),c.R7$(),c.Y8G("ngIf",s.mailboxesEmails.isLoading))},dependencies:[i.Sq,i.bT,C.P,ue],encapsulation:2})}return MailboxManagerTextMessages})();function fe(e,s){if(1&e&&c.nrm(0,"mailbox-manager-emails",6),2&e){const e=c.XpG(2);c.AVh("slds-hide",e.mailboxesEmails.activeMessage)}}function pe(e,s){if(1&e&&c.nrm(0,"mailbox-manager-textmessages",6),2&e){const e=c.XpG(2);c.AVh("slds-hide",e.mailboxesEmails.activeMessage)}}function xe(e,s){if(1&e&&(c.j41(0,"div",4),c.DNE(1,fe,1,2,"mailbox-manager-emails",5)(2,pe,1,2,"mailbox-manager-textmessages",5),c.nrm(3,"mailbox-manager-email-details",6),c.k0s()),2&e){const e=c.XpG();c.R7$(),c.Y8G("ngIf",e.isEmailMailbox),c.R7$(),c.Y8G("ngIf",!e.isEmailMailbox),c.R7$(),c.AVh("slds-hide",!e.mailboxesEmails.activeMessage)}}function Me(e,s){1&e&&c.nrm(0,"mailbox-manager-emails",9)}function ve(e,s){1&e&&c.nrm(0,"mailbox-manager-textmessages",9)}function ye(e,s){if(1&e&&(c.j41(0,"div",4),c.DNE(1,Me,1,0,"mailbox-manager-emails",7)(2,ve,1,0,"mailbox-manager-textmessages",7),c.nrm(3,"mailbox-manager-email-details",8),c.k0s()),2&e){const e=c.XpG();c.R7$(),c.Y8G("ngIf",e.isEmailMailbox),c.R7$(),c.Y8G("ngIf",!e.isEmailMailbox)}}function Ee(e,s){1&e&&c.nrm(0,"mailbox-manager-emails",13)}function _e(e,s){1&e&&c.nrm(0,"mailbox-manager-textmessages",13)}function Le(e,s){if(1&e&&(c.j41(0,"div",10),c.DNE(1,Ee,1,0,"mailbox-manager-emails",11)(2,_e,1,0,"mailbox-manager-textmessages",11),c.nrm(3,"mailbox-manager-email-details",12),c.k0s()),2&e){const e=c.XpG();c.R7$(),c.Y8G("ngIf",e.isEmailMailbox),c.R7$(),c.Y8G("ngIf",!e.isEmailMailbox)}}let ke=(()=>{class MailboxManager{constructor(e,s,t){this.navigation=e,this.navigationtab=s,this.mailboxesEmails=t,this.navigationtab.setTabInfo({displayname:"Mailboxes",displaymodule:"Mailboxes"})}get isEmailMailbox(){return!(!this.mailboxesEmails.activeMailBox||"email"!=this.mailboxesEmails.activeMailBox.type)}static#e=this.ɵfac=function(e){return new(e||MailboxManager)(c.rXU(p.L),c.rXU(x._),c.rXU(f))};static#s=this.ɵcmp=c.VBU({type:MailboxManager,selectors:[["mailbox-manager"]],features:[c.Jv_([f])],decls:6,vars:6,consts:[["system-to-bottom-noscroll","",1,"slds-grid","slds-grid--vertical"],[3,"ngSwitch"],["class","slds-grid slds-grow","style","min-height: 0;",4,"ngSwitchCase"],["class","slds-grid slds-grid--vertical slds-grow","style","min-height: 0;",4,"ngSwitchCase"],[1,"slds-grid","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1 slds-height_full",3,"slds-hide",4,"ngIf"],[1,"slds-size--1-of-1","slds-height_full"],["class","slds-size--2-of-5",4,"ngIf"],[1,"slds-size--3-of-5"],[1,"slds-size--2-of-5"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1","style","height: 50%",4,"ngIf"],[1,"slds-size--1-of-1","slds-border--top",2,"height","50%"],[1,"slds-size--1-of-1",2,"height","50%"]],template:function(e,s){1&e&&(c.j41(0,"div",0),c.nrm(1,"mailbox-manager-header"),c.qex(2,1),c.DNE(3,xe,4,4,"div",2)(4,ye,4,2,"div",2)(5,Le,4,2,"div",3),c.bVm(),c.k0s()),2&e&&(c.R7$(),c.AVh("slds-hide",!!s.mailboxesEmails.activeMessage&&"noSplit"==(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),c.R7$(),c.Y8G("ngSwitch",null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name),c.R7$(),c.Y8G("ngSwitchCase","noSplit"),c.R7$(),c.Y8G("ngSwitchCase","verticalSplit"),c.R7$(),c.Y8G("ngSwitchCase","horizontalSplit"))},dependencies:[i.bT,i.ux,i.e1,M.p,S,z,re,ge],encapsulation:2})}return MailboxManager})(),Re=(()=>{class MailboxEmailToLeadButton{constructor(e,s,t,i,l){this.language=e,this.metadata=s,this.model=t,this.modal=i,this.toast=l}execute(){this.modal.openModal("MailboxEmailToLeadModal").subscribe((e=>{e.instance.email=this.model}))}static#e=this.ɵfac=function(e){return new(e||MailboxEmailToLeadButton)(c.rXU(v.B),c.rXU(y.yu),c.rXU(w.g),c.rXU(H.y),c.rXU(q.o))};static#s=this.ɵcmp=c.VBU({type:MailboxEmailToLeadButton,selectors:[["mailbox-email-to-lead-emailbutton"]],decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,s){1&e&&(c.j41(0,"span"),c.nrm(1,"system-label",0),c.k0s())},dependencies:[B.W],encapsulation:2})}return MailboxEmailToLeadButton})();var Be=t(40713),Te=t(25028),Ie=t(88418),je=t(83524),Ge=t(45915);const Se=["contextMenu"];function Ce(e,s){if(1&e){const e=c.RV6();c.j41(0,"li",7)(1,"a",8),c.bIt("click",(function(){const s=c.eBV(e).$implicit,t=c.XpG(2);return c.Njj(t.setField(s))})),c.j41(2,"span",9),c.nrm(3,"system-label-fieldname",10),c.k0s()()()}if(2&e){const e=s.$implicit,t=c.XpG(2);c.R7$(3),c.Y8G("module",t.emailmodule)("field",e)}}function we(e,s){if(1&e&&(c.j41(0,"div",3,4)(2,"ul",5),c.DNE(3,Ce,4,2,"li",6),c.k0s()()),2&e){const e=c.XpG();c.Y8G("ngStyle",e.contextMenuStyle),c.R7$(3),c.Y8G("ngForOf",e.emailfields)}}let $e=(()=>{class MailboxEmailToLeadEmailText{constructor(e,s,t){this.elementRef=e,this.renderer=s,this.language=t,this.emailtext="",this.emailhtml="",this.emailmodule="",this.emailfields=["first_name","last_name"],this.setfield=new c.bkB,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{left:this.displayContextCoordinates.left-e.left+"px",top:this.displayContextCoordinates.top-e.top+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static#e=this.ɵfac=function(e){return new(e||MailboxEmailToLeadEmailText)(c.rXU(c.aKT),c.rXU(c.sFG),c.rXU(v.B))};static#s=this.ɵcmp=c.VBU({type:MailboxEmailToLeadEmailText,selectors:[["mailbox-email-to-lead-emailtext"]],viewQuery:function(e,s){if(1&e&&c.GBs(Se,7,c.c1b),2&e){let e;c.mGM(e=c.lsd())&&(s.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,s){1&e&&(c.j41(0,"div",0)(1,"div",1),c.bIt("contextmenu",(function(e){return s.showContextMenu(e)})),c.k0s(),c.DNE(2,we,4,2,"div",2),c.k0s()),2&e&&(c.R7$(),c.Y8G("innerHTML",s.content,c.npT),c.R7$(),c.Y8G("ngIf",s.displayContextMenu))},dependencies:[i.Sq,i.bT,i.B3,Ge.P],encapsulation:2})}return MailboxEmailToLeadEmailText})();const Ue=["detailcontainer"];let Fe=(()=>{class MailboxEmailToLeadModal{constructor(e,s,t,i){this.language=e,this.metadata=s,this.view=t,this.model=i,this.email=null,this.self=null,this.componentRefs=[],this.leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"],this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let s of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(s.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=s.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}static#e=this.ɵfac=function(e){return new(e||MailboxEmailToLeadModal)(c.rXU(v.B),c.rXU(y.yu),c.rXU($.U),c.rXU(w.g))};static#s=this.ɵcmp=c.VBU({type:MailboxEmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,s){if(1&e&&c.GBs(Ue,7,c.c1b),2&e){let e;c.mGM(e=c.lsd())&&(s.detailcontainer=e.first)}},features:[c.Jv_([w.g,$.U])],decls:15,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-grid",2,"height","70vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(c.j41(0,"system-modal",0)(1,"system-modal-header",1),c.bIt("close",(function(){return s.closeModal()})),c.nrm(2,"system-label",2),c.k0s(),c.j41(3,"system-modal-content")(4,"div",3)(5,"div",4)(6,"mailbox-email-to-lead-emailtext",5),c.bIt("setfield",(function(e){return s.setField(e)})),c.k0s()(),c.j41(7,"div",6),c.nrm(8,"div",null,7),c.k0s()()(),c.j41(10,"system-modal-footer")(11,"button",8),c.bIt("click",(function(){return s.closeModal()})),c.nrm(12,"system-label",9),c.k0s(),c.j41(13,"button",10),c.bIt("click",(function(){return s.saveLead()})),c.nrm(14,"system-label",11),c.k0s()()()),2&e&&(c.R7$(6),c.Y8G("emailmodule",s.model.module)("emailtext",s.email.data.description)("emailhtml",s.email.data.body)("emailfields",s.leadFields))},dependencies:[B.W,Be.D,Te.I,Ie.Q,je.C,$e],encapsulation:2})}return MailboxEmailToLeadModal})();var Xe=t(57363),Ye=t(42205);const Oe=["tablecontainer"];function De(e,s){if(1&e){const e=c.RV6();c.j41(0,"tr",16),c.bIt("click",(function(){const s=c.eBV(e).$implicit,t=c.XpG(2);return c.Njj(t.goToRecord(s.id))})),c.j41(1,"td",17)(2,"div",18),c.EFF(3),c.k0s()(),c.j41(4,"td",19)(5,"div",20),c.EFF(6),c.k0s()(),c.j41(7,"td",19)(8,"div",18),c.EFF(9),c.k0s()()()}if(2&e){const e=s.$implicit;c.R7$(3),c.SpI(" ",e.name," "),c.R7$(2),c.AVh("slds-p-horizontal--xx-small",(null==e?null:e.emailsunread)>9),c.Y8G("ngClass",(null==e?null:e.emailsunread)>0?"slds-badge slds-theme--success":""),c.R7$(),c.SpI(" ",e.emailsunread," "),c.R7$(3),c.SpI(" ",e.emailsread," ")}}function Ve(e,s){if(1&e&&(c.j41(0,"tbody"),c.DNE(1,De,10,6,"tr",15),c.k0s()),2&e){const e=c.XpG();c.R7$(),c.Y8G("ngForOf",e.mailboxes)("ngForTrackBy",e.trackByFn)}}function Ne(e,s){1&e&&c.nrm(0,"tbody",21),2&e&&c.Y8G("columns",3)}let Ae=(()=>{class MailboxesDashlet{constructor(e,s,t,i){this.language=e,this.backend=s,this.model=t,this.router=i,this.isLoading=!1,this.mailboxes=[],this.canLoadMore=!0,this.loadLimit=20,this.getMailBoxesInterval=void 0}ngOnInit(){this.model.module="Mailboxes",this.getMailboxes(),this.getMailBoxesInterval=this.getMailboxesInterval()}ngOnDestroy(){this.getMailBoxesInterval&&window.clearInterval(this.getMailBoxesInterval)}trackByFn(e,s){return s.id}getMailboxes(e){this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((s=>{if(!s||0==s.length)return this.isLoading=!1;s.map((e=>e.emailsread=e.emailsread-e.emailsclosed)),e?this.mailboxes.every((e=>(s.some((s=>{if(s.id==e.id)return e.emailsread=s.emailsread,e.emailsunread=s.emailsunread,!0})),!0))):this.mailboxes=s,s.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1}))}getMailboxesInterval(){return window.setInterval((()=>this.getMailboxes(!0)),6e4)}onScroll(){let e=this.tablecontainer.element.nativeElement;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}goToRecord(e){this.router.navigate([`/module/${this.model.module}/${e}`])}loadMore(){this.canLoadMore&&(this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((e=>{this.mailboxes=this.mailboxes.concat(e),e.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1})))}static#e=this.ɵfac=function(e){return new(e||MailboxesDashlet)(c.rXU(v.B),c.rXU(b.H),c.rXU(w.g),c.rXU(Xe.Ix))};static#s=this.ɵcmp=c.VBU({type:MailboxesDashlet,selectors:[["dashboard-mailboxes-dashlet"]],viewQuery:function(e,s){if(1&e&&c.GBs(Oe,7,c.c1b),2&e){let e;c.mGM(e=c.lsd())&&(s.tablecontainer=e.first)}},features:[c.Jv_([w.g,$.U])],decls:21,vars:2,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Mailboxes","size","small"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],[1,"slds-scrollable--y","slds-grow",2,"width","100%",3,"scroll"],["tablecontainer",""],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered","slds-table--fixed-layout","spice-table_header-fixed",2,"border-top","0"],[1,"slds-text-title_caps"],["scope","col"],[1,"slds-truncate","slds-text-align--center"],["label","LBL_NAME"],["label","LBL_UNREAD"],["label","LBL_READ"],[4,"ngIf"],["system-table-stencils","",3,"columns",4,"ngIf"],["style","cursor: pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click"],[1,"slds-truncate",2,"min-width","120px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"width","fit-content","height","fit-content"],[1,"slds-truncate",2,"min-width","100px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"border-radius","50%","width","fit-content","height","fit-content",3,"ngClass"],["system-table-stencils","",3,"columns"]],template:function(e,s){1&e&&(c.j41(0,"div",0)(1,"div",1),c.nrm(2,"system-icon",2),c.j41(3,"h2",3),c.EFF(4,"Mailboxes"),c.k0s()(),c.j41(5,"div",4,5),c.bIt("scroll",(function(){return s.onScroll()})),c.j41(7,"table",6)(8,"thead")(9,"tr",7)(10,"th",8)(11,"div",9),c.nrm(12,"system-label",10),c.k0s()(),c.j41(13,"th",8)(14,"div",9),c.nrm(15,"system-label",11),c.k0s()(),c.j41(16,"th",8)(17,"div",9),c.nrm(18,"system-label",12),c.k0s()()()(),c.DNE(19,Ve,2,2,"tbody",13)(20,Ne,1,1,"tbody",14),c.k0s()()()),2&e&&(c.R7$(19),c.Y8G("ngIf",!s.isLoading&&s.mailboxes.length>0),c.R7$(),c.Y8G("ngIf",s.isLoading))},dependencies:[i.YU,i.Sq,i.bT,K.J,B.W,Ye.t],encapsulation:2})}return MailboxesDashlet})();var ze=t(75103);let qe=(()=>{class MailboxSetDefaultButton{constructor(e,s,t,i,l){this.language=e,this.backend=s,this.toast=t,this.modellist=i,this.model=l}get disabled(){return null==this.model.data.id||this.model.getFieldValue("is_default")}execute(){this.backend.postRequest("module/Mailboxes/default",null,{mailbox_id:this.model.data.id}).subscribe({next:e=>{this.toast.sendToast("success","success"),this.model.setField("is_default",!0),this.modellist.reLoadList(!0)},error:e=>{this.toast.sendToast(e.message,"error")}})}static#e=this.ɵfac=function(e){return new(e||MailboxSetDefaultButton)(c.rXU(v.B),c.rXU(b.H),c.rXU(q.o),c.rXU(ze.K),c.rXU(w.g))};static#s=this.ɵcmp=c.VBU({type:MailboxSetDefaultButton,selectors:[["mailbox-set-default-button"]],decls:2,vars:0,consts:[["label","LBL_SET_DEFAULT"]],template:function(e,s){1&e&&(c.j41(0,"span"),c.nrm(1,"system-label",0),c.k0s())},dependencies:[B.W],encapsulation:2})}return MailboxSetDefaultButton})();var He=t(13921),Pe=t(48849),Je=t(766),Ke=t(66935),We=t(89166);function Qe(e,s){if(1&e&&c.nrm(0,"field-label",3),2&e){const e=c.XpG();c.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Ze(e,s){if(1&e&&(c.qex(0),c.EFF(1),c.bVm()),2&e){const e=c.XpG().$implicit;c.R7$(),c.SpI(" ",e.display," ")}}function es(e,s){if(1&e&&(c.qex(0),c.DNE(1,Ze,2,1,"ng-container",6),c.bVm()),2&e){const e=s.$implicit,t=c.XpG(2);c.R7$(),c.Y8G("ngIf",e.value==t.value)}}function ss(e,s){if(1&e&&(c.j41(0,"field-generic-display",4),c.DNE(1,es,2,1,"ng-container",5),c.k0s()),2&e){const e=c.XpG();c.Y8G("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig),c.R7$(),c.Y8G("ngForOf",e.options)("ngForTrackBy",e.trackByFn)}}function ts(e,s){if(1&e&&(c.qex(0),c.j41(1,"option",12),c.EFF(2),c.k0s(),c.bVm()),2&e){const e=s.$implicit;c.R7$(),c.Y8G("value",e.value),c.R7$(),c.JRh(e.display)}}function is(e,s){if(1&e){const e=c.RV6();c.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"select",10),c.mxI("ngModelChange",(function(s){c.eBV(e);const t=c.XpG();return c.DH7(t.value,s)||(t.value=s),c.Njj(s)})),c.bIt("ngModelChange",(function(s){c.eBV(e);const t=c.XpG();return c.Njj(t.setToPreferences(s))})),c.DNE(4,ts,3,2,"ng-container",5),c.k0s()(),c.nrm(5,"field-messages",11),c.k0s()()}if(2&e){const e=c.XpG();c.R7$(),c.Y8G("ngClass",e.getFieldClass()),c.R7$(2),c.Y8G("disabled",0==e.options.length),c.R50("ngModel",e.value),c.R7$(),c.Y8G("ngForOf",e.options)("ngForTrackBy",e.trackByFn),c.R7$(),c.Y8G("fieldname",e.fieldname)}}let ls=(()=>{class fieldMailboxes extends He.s{constructor(e,s,t,i,l,a,n,o,d){super(e,s,t,i,l),this.model=e,this.view=s,this.language=t,this.metadata=i,this.router=l,this.backend=a,this.configuration=n,this.userpreferences=o,this.cdRef=d,this.options=[]}get value(){return this.model.getField(this.fieldname)}set value(e){this.model.setField(this.fieldname,e)}get scope(){return this.fieldconfig.scope?this.fieldconfig.scope:"outboundsingle"}ngOnInit(){super.ngOnInit(),this.setValueFromPreferences(),this.getOptions()}getOptions(){const e=this.configuration.getData(`mailboxes${this.scope}`);_.isEmpty(e)?this.backend.getRequest("module/Mailboxes/scope",{scope:this.scope}).subscribe((e=>{this.options=e.sort(((e,s)=>e.display.localeCompare(s.display))),this.configuration.setData(`mailboxes${this.scope}`,this.options),this.cdRef.detectChanges()})):this.options=e}trackByFn(e,s){return s.value}setValueFromPreferences(){if(this.value||this.fieldconfig.disableCache)return;const e=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);e&&this.isEditMode()&&this.model.setField(this.fieldname,e),this.subscriptions.add(this.model.mode$.subscribe((e=>{if("edit"!=e||this.value)return;const s=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);s&&this.model.setField(this.fieldname,s)})))}setToPreferences(e){this.fieldconfig.disableCache||this.userpreferences.setPreference(`defaultmailbox_${this.scope}`,e)}static#e=this.ɵfac=function(e){return new(e||fieldMailboxes)(c.rXU(w.g),c.rXU($.U),c.rXU(v.B),c.rXU(y.yu),c.rXU(Xe.Ix),c.rXU(b.H),c.rXU(E.i),c.rXU(Pe.S),c.rXU(c.gRc))};static#s=this.ɵcmp=c.VBU({type:fieldMailboxes,selectors:[["field-mailboxes"]],features:[c.Vt3],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"fieldname"],[3,"value"]],template:function(e,s){1&e&&c.DNE(0,Qe,1,2,"field-label",0)(1,ss,2,5,"field-generic-display",1)(2,is,6,6,"div",2),2&e&&(c.Y8G("ngIf",s.displayLabel),c.R7$(),c.Y8G("ngIf",!s.isEditMode()),c.R7$(),c.Y8G("ngIf",s.isEditMode()))},dependencies:[i.YU,i.Sq,i.bT,l.xH,l.y7,l.wz,l.BC,l.vS,Je.b,Ke.K,We.A],encapsulation:2})}return fieldMailboxes})(),as=(()=>{class ModuleMailboxes{static#e=this.ɵfac=function(e){return new(e||ModuleMailboxes)};static#s=this.ɵmod=c.$C({type:ModuleMailboxes});static#t=this.ɵinj=c.G2t({imports:[i.MD,l.YN,d.ObjectFields,n.GlobalComponents,o.ObjectComponents,r.SystemComponents,a.h]})}return ModuleMailboxes})();("undefined"==typeof ngJitMode||ngJitMode)&&c.Obh(as,{declarations:[ke,S,z,V,re,ue,ge,Re,Fe,$e,Ae,qe,ls],imports:[i.MD,l.YN,d.ObjectFields,n.GlobalComponents,o.ObjectComponents,r.SystemComponents,a.h]})}}]);