/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_spicepath_spicepath_ts"],{48970:(t,s,e)=>{e.r(s),e.d(s,{ModuleSpicePath:()=>Yt});var i=e(60177),a=e(84341),l=e(18039),n=e(71341),o=e(7745),d=e(12948),c=e(37328),r=e(70569),g=e(54438),m=e(53584),h=e(75103);let u=(()=>{class SpiceKanbanStagePipe{constructor(t,s){this.configuration=t,this.modellist=s}transform(t,s){let e=[],i=this.getStageData(s);for(let a of t)a[i.statusfield]&&a[i.statusfield]==s&&e.push(a);return e}get stages(){return this.configuration.getData("spicebeanguides")?this.configuration.getData("spicebeanguides")[this.modellist.module].stages:[]}getStageData(t){let s=[];return this.stages.some((e=>{t!=e.stage||(s=e.stagedata)})),s}static#t=this.ɵfac=function(t){return new(t||SpiceKanbanStagePipe)(g.rXU(m.i,16),g.rXU(h.K,16))};static#s=this.ɵpipe=g.EJ8({name:"spicekanbanstagepipe",type:SpiceKanbanStagePipe,pure:!1})}return SpiceKanbanStagePipe})();var p=e(35911),f=e(69904),b=e(18521);function k(t,s){if(1&t){const t=g.RV6();g.j41(0,"li",5)(1,"a",6),g.bIt("click",(function(){const s=g.eBV(t).$implicit,e=g.XpG();return g.Njj(e.setActiveStage(s.stage))})),g.j41(2,"span",7),g.nrm(3,"system-utility-icon",8),g.k0s(),g.j41(4,"span",9),g.EFF(5),g.k0s()()()}if(2&t){const t=s.$implicit,e=g.XpG();g.Y8G("ngClass",e.stageClass(t)),g.R7$(5),g.JRh(e.getStageLabel(t.stagedata))}}let v=(()=>{class SpicePathTrack{constructor(t,s,e){this.configuration=t,this.model=s,this.language=e,this.beanGuideStatus="open",this._stages=[],this.activeStage$=new g.bkB}ngOnInit(){this.model.data$.subscribe((t=>{this.buildstages(),this._modelstage!=this.model.getField(this.statusfield)&&(this._modelstage=this.model.getField(this.statusfield),this.activeStage=this._modelstage,this.activeStage$.emit(this._modelstage))}))}buildstages(){let t=[],s=this.configuration.getData("spicebeanguides")?this.configuration.getData("spicebeanguides")[this.model.module].stages:[],e=this.model.getField(this.statusfield);this.beanGuideStatus="open";for(let i of s)if(i.stagedata.stage_bucket){let s=t.findIndex((t=>t.stagedata.stage_bucket==i.stagedata.stage_bucket));if(s>=0)i.stage==e&&(t[s]={stage:i.stage,stagedata:_.clone(i.stagedata)},i.stagedata.spicebeanguide_status&&(this.beanGuideStatus=i.stagedata.spicebeanguide_status));else if(i.stage==e)t.push({stage:i.stage,stagedata:_.clone(i.stagedata)}),i.stagedata.spicebeanguide_status&&(this.beanGuideStatus=i.stagedata.spicebeanguide_status);else{let s={stage:i.stage,stagedata:_.clone(i.stagedata)};s.stagedata.stage_label=i.stagedata.stage_bucket,t.push(s)}}else t.push({stage:i.stage,stagedata:_.clone(i.stagedata)});this._stages=t}get stages(){return this._stages}get statusfield(){return this.configuration.getData("spicebeanguides")[this.model.module].statusfield}stageClass(t){let s=[],e=this.model.getField(this.statusfield);if("won"==this.beanGuideStatus&&"won"==t.stagedata.spicebeanguide_status?s.push("slds-is-won"):"won"==this.beanGuideStatus&&s.push("slds-is-complete"),"lost"==this.beanGuideStatus&&"lost"==t.stagedata.spicebeanguide_status?s.push("slds-is-lost"):"lost"==this.beanGuideStatus&&s.push("slds-is-incomplete"),(this.activeStage&&this.activeStage==t.stage||!this.activeStage&&e==t.stage)&&("lost"==this.beanGuideStatus?s.push("slds-is-current"):s.push("slds-is-active")),"open"==this.beanGuideStatus&&e){let i=this.stages.findIndex((s=>s.stage==t.stage)),a=this.stages.findIndex((t=>t.stage==e));i<a&&s.push("slds-is-complete"),i>a&&s.push("slds-is-incomplete"),i==a&&-1==s.indexOf("slds-is-active")&&s.push("slds-is-current")}return e||s.push("slds-is-incomplete"),s.join(" ")}setActiveStage(t){this.activeStage=t,this.activeStage$.emit(t)}getStageLabel(t){return t.stage_label?this.language.getLabel(t.stage_label):t.stage_name}static#t=this.ɵfac=function(t){return new(t||SpicePathTrack)(g.rXU(m.i),g.rXU(p.g),g.rXU(f.B))};static#s=this.ɵcmp=g.VBU({type:SpicePathTrack,selectors:[["spice-path-track"]],outputs:{activeStage$:"activeStage$"},decls:5,vars:1,consts:[[1,"slds-grid","slds-path__scroller-container"],["role","application",1,"slds-path__scroller"],[1,"slds-path__scroller_inner"],["role","listbox","aria-orientation","horizontal",1,"slds-path__nav"],["class","slds-path__item","role","presentation",3,"ngClass",4,"ngFor","ngForOf"],["role","presentation",1,"slds-path__item",3,"ngClass"],["aria-selected","false","href","javascript:void(0);","role","option",1,"slds-path__link",3,"click"],[1,"slds-path__stage"],["icon","check","size","x-small"],[1,"slds-path__title"]],template:function(t,s){1&t&&(g.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3),g.DNE(4,k,6,2,"li",4),g.k0s()()()()),2&t&&(g.R7$(4),g.Y8G("ngForOf",s.stages))},dependencies:[i.YU,i.Sq,b.B],encapsulation:2})}return SpicePathTrack})(),S=(()=>{class SpicePathModel{static#t=this.ɵfac=function(t){return new(t||SpicePathModel)};static#s=this.ɵcmp=g.VBU({type:SpicePathModel,selectors:[["spice-path-model"]],decls:2,vars:0,consts:[[1,"slds-path","slds-p-vertical--small","slds-scrollable--x"]],template:function(t,s){1&t&&(g.j41(0,"div",0),g.nrm(1,"spice-path-track"),g.k0s())},dependencies:[v],encapsulation:2})}return SpicePathModel})();var y=e(49969),D=e(49722),G=e(83935),x=e(25863),F=e(60595),R=e(32062);function C(t,s){if(1&t&&(g.qex(0),g.j41(1,"dt",18),g.nrm(2,"system-utility-icon",19),g.k0s(),g.j41(3,"dd",20),g.EFF(4),g.k0s(),g.bVm()),2&t){const t=s.$implicit,e=g.XpG(3);g.R7$(2),g.Y8G("icon",t.result?"check":"warning")("size","x-small"),g.R7$(2),g.JRh(t.label?e.language.getLabel(t.label):t.name)}}function $(t,s){if(1&t&&(g.qex(0),g.j41(1,"h2",14),g.nrm(2,"system-label",15),g.k0s(),g.j41(3,"dl",16),g.DNE(4,C,5,3,"ng-container",17),g.k0s(),g.bVm()),2&t){const t=g.XpG(2);g.R7$(4),g.Y8G("ngForOf",t.checks)}}function j(t,s){1&t&&(g.j41(0,"div",21),g.nrm(1,"system-label",22),g.k0s())}function L(t,s){if(1&t&&g.nrm(0,"system-componentset",23),2&t){const t=g.XpG(2);g.Y8G("componentset",t.stageComponentset)}}function I(t,s){if(1&t&&(g.j41(0,"div",6)(1,"div",7),g.DNE(2,$,5,1,"ng-container",8)(3,j,2,0,"ng-template",null,9,g.C5r),g.k0s(),g.j41(5,"div",7)(6,"h2",10),g.nrm(7,"system-label",11),g.k0s(),g.nrm(8,"div",12),g.DNE(9,L,1,1,"system-componentset",13),g.k0s()()),2&t){const t=g.sdS(4),s=g.XpG();g.Y8G("@displaycoaching",void 0),g.R7$(2),g.Y8G("ngIf",s.checks.length>0)("ngIfElse",t),g.R7$(6),g.Y8G("innerHtml",s.stageDescription,g.npT),g.R7$(),g.Y8G("ngIf",s.stageComponentset)}}let Y=(()=>{class SpicePathWithCoaching{constructor(t,s,e,i,a){this.configuration=t,this.model=s,this.language=e,this.backend=i,this.metadata=a,this.coachingVisible=!1,this.componentconfig={},this.componentconfig=this.metadata.getComponentConfig("SpicePathWithCoaching",this.model.module),this.componentconfig&&this.componentconfig.coachingVisible&&(this.coachingVisible=this.componentconfig.coachingVisible)}ngOnInit(){this.backend.getRequest("common/spicebeanguide/"+this.model.module+"/"+this.model.id).subscribe((t=>{this.beanStagesChecksResults=t}))}get coachingIconStyle(){return this.coachingVisible?{transform:"rotate(90deg)"}:{}}get stages(){return this.configuration.getData("spicebeanguides")[this.model.module].stages}get statusfield(){return this.configuration.getData("spicebeanguides")[this.model.module].statusfield}get currentStage(){return this.model.getField(this.statusfield)}toggleCoaching(){this.coachingVisible=!this.coachingVisible}setActiveStage(t){this.activeStage=t}get displayStage(){return this.activeStage?this.activeStage:this.currentStage}get checks(){let t=[];return this.beanStagesChecksResults.some((s=>{if(s.stage===this.displayStage)return t=s.stagedata.checks,!0})),t}get stageDescription(){let t=this.stages.find((t=>t.stage==this.displayStage));return t?t.stagedata.stage_label?this.language.getLabel(t.stagedata.stage_label,"","long"):t.stagedata.stage_description:""}get stageComponentset(){let t=this.stages.find((t=>t.stage==this.displayStage));return t?t.stagedata.stage_componentset:""}static#t=this.ɵfac=function(t){return new(t||SpicePathWithCoaching)(g.rXU(m.i),g.rXU(p.g),g.rXU(f.B),g.rXU(D.H),g.rXU(G.yu))};static#s=this.ɵcmp=g.VBU({type:SpicePathWithCoaching,selectors:[["spice-path-with-coaching"]],decls:6,vars:2,consts:[[1,"slds-path","slds-path_has-coaching","slds-p-around--small"],[1,"slds-grid","slds-path__scroller-container"],["aria-expanded","false",1,"slds-button","slds-button_icon","slds-button_icon-border-filled","slds-path__trigger",2,"box-shadow","none","border-radius","20px",3,"click"],["icon","chevronright"],[1,"slds-grow",3,"activeStage$"],["class","slds-grid slds-grid--align-spread slds-gutters_direct-xx-small slds-p-top--medium slds-p-horizontal--xxx-small",4,"ngIf"],[1,"slds-grid","slds-grid--align-spread","slds-gutters_direct-xx-small","slds-p-top--medium","slds-p-horizontal--xxx-small"],[1,"slds-col","slds-size--1-of-2"],[4,"ngIf","ngIfElse"],["nochecks",""],[1,"slds-text-title--caps","slds-p-bottom--small","slds-has-divider--bottom"],["label","LBL_DETAILS"],[1,"slds-has-divider--bottom","slds-p-vertical--xx-small","slds-text-align--justify",3,"innerHtml"],[3,"componentset",4,"ngIf"],[1,"slds-text-title--caps","slds-p-bottom--small"],["label","LBL_CHECKS"],[1,"slds-dl--horizontal"],[4,"ngFor","ngForOf"],[1,"slds-coach__item","slds-dl--horizontal__label"],[3,"icon","size"],[1,"slds-coach__value","slds-dl--horizontal__detail"],[1,"slds-height_full","slds-align--absolute-center"],["label","LBL_NO_CHECKS_DEFINED"],[3,"componentset"]],template:function(t,s){1&t&&(g.j41(0,"div",0)(1,"div",1)(2,"button",2),g.bIt("click",(function(){return s.toggleCoaching()})),g.nrm(3,"system-button-icon",3),g.k0s(),g.j41(4,"spice-path-track",4),g.bIt("activeStage$",(function(t){return s.setActiveStage(t)})),g.k0s()(),g.DNE(5,I,10,5,"div",5),g.k0s()),2&t&&(g.R7$(2),g.Y8G("@coachingicon",s.coachingVisible?"open":"closed"),g.R7$(3),g.Y8G("ngIf",s.coachingVisible))},dependencies:[i.Sq,i.bT,x.t,F.F,R.W,b.B,v],encapsulation:2,data:{animation:[(0,y.hZ)("displaycoaching",[(0,y.kY)(":enter",[(0,y.iF)({opacity:0,height:"0px",overflow:"hidden"}),(0,y.i0)(".5s",(0,y.iF)({height:"*",opacity:1})),(0,y.iF)({overflow:"unset"})]),(0,y.kY)(":leave",[(0,y.iF)({overflow:"hidden"}),(0,y.i0)(".5s",(0,y.iF)({height:"0px",opacity:0}))])]),(0,y.hZ)("coachingicon",[(0,y.wk)("open",(0,y.iF)({transform:"rotate(90deg)"})),(0,y.wk)("closed",(0,y.iF)({transform:"rotate(0deg)"})),(0,y.kY)("open => closed",[(0,y.i0)(".5s")]),(0,y.kY)("closed => open",[(0,y.i0)(".5s")])])]}})}return SpicePathWithCoaching})();var E=e(6179),X=e(91107),U=e(57949),N=e(13269),w=e(41731),B=e(23855),O=e(68823),T=e(33325);function z(t,s){if(1&t&&g.nrm(0,"system-componentset",10),2&t){const t=g.XpG();g.Y8G("componentset",t.componentset)}}let P=(()=>{class SpicePathRelatedListTile{constructor(t,s,e,i,a){this.model=t,this.relatedmodels=s,this.view=e,this.language=i,this.metadata=a,this.module="",this.data={},this.componentset="",this.componentconfig={}}ngOnInit(){this.model.module=this.module,this.model.id=this.data.id,this.model.setData(this.data),this.componentconfig=this.metadata.getComponentConfig("SpicePathRelatedListTile",this.module)}get actionset(){return this.componentconfig.actionset}get componentSetLeft(){return this.componentconfig.left}get componentSetRight(){return this.componentconfig.right}static#t=this.ɵfac=function(t){return new(t||SpicePathRelatedListTile)(g.rXU(p.g),g.rXU(X.K),g.rXU(w.U),g.rXU(f.B),g.rXU(G.yu))};static#s=this.ɵcmp=g.VBU({type:SpicePathRelatedListTile,selectors:[["spice-path-related-list-tile"]],inputs:{module:"module",data:"data",componentset:"componentset"},features:[g.Jv_([p.g,w.U])],decls:12,vars:8,consts:[[3,"module","size"],[1,"slds-media__body"],[1,"slds-grid","slds-grid--align-spread","slds-has-flexi-truncate"],["system-model-popover","",1,"slds-truncate","slds-text-heading--small","slds-p-top--xxx-small","slds-m-bottom--small"],[1,"slds-shrink-none","slds-show--medium"],[3,"buttonsize","actionset"],[1,"slds-tile__detail",2,"margin-left","-2rem"],[1,"slds-text-body--small"],[3,"componentset",4,"ngIf"],[1,"slds-hide--medium",3,"buttonsize","actionset"],[3,"componentset"]],template:function(t,s){1&t&&(g.nrm(0,"system-icon",0),g.j41(1,"div",1)(2,"div",2)(3,"h3",3),g.EFF(4),g.k0s(),g.j41(5,"div",4),g.nrm(6,"object-action-menu",5),g.k0s()(),g.j41(7,"div",6),g.nrm(8,"spice-path-model"),g.j41(9,"div",7),g.DNE(10,z,1,1,"system-componentset",8),g.k0s()(),g.nrm(11,"object-action-menu",9),g.k0s()),2&t&&(g.Y8G("module",s.module)("size","small"),g.R7$(4),g.SpI(" ",s.data.summary_text," "),g.R7$(2),g.Y8G("buttonsize","x-small")("actionset",s.actionset),g.R7$(4),g.Y8G("ngIf",s.componentset),g.R7$(),g.Y8G("buttonsize","x-small")("actionset",s.actionset))},dependencies:[i.bT,B.P,F.F,O.J,T.j,S],encapsulation:2})}return SpicePathRelatedListTile})();function V(t,s){if(1&t&&(g.j41(0,"div",4),g.nrm(1,"spice-path-related-list-tile",5),g.k0s()),2&t){const t=s.$implicit,e=g.XpG(2);g.R7$(),g.Y8G("componentset",e.componentconfig.componentset)("data",t)("module",e.relatedmodels.relatedModule)}}function M(t,s){if(1&t&&(g.qex(0),g.DNE(1,V,2,3,"div",3),g.bVm()),2&t){const t=g.XpG();g.R7$(),g.Y8G("ngForOf",t.relatedmodels.items)}}function K(t,s){1&t&&g.nrm(0,"system-illustration-no-access")}let A=(()=>{class SpicePathRelatedListTiles extends E.F{static#t=this.ɵfac=(()=>{let t;return function(s){return(t||(t=g.xGo(SpicePathRelatedListTiles)))(s||SpicePathRelatedListTiles)}})();static#s=this.ɵcmp=g.VBU({type:SpicePathRelatedListTiles,selectors:[["ng-component"]],features:[g.Jv_([X.K]),g.Vt3],decls:4,vars:3,consts:[[3,"componentconfig"],[4,"ngIf","ngIfElse"],["noaccess",""],["class","slds-p-around--xx-small slds-size--1-of-1",4,"ngFor","ngForOf"],[1,"slds-p-around--xx-small","slds-size--1-of-1"],[1,"slds-box","slds-box--x-small","slds-media","slds-card__tile",3,"componentset","data","module"]],template:function(t,s){if(1&t&&(g.j41(0,"object-related-card",0),g.DNE(1,M,2,1,"ng-container",1)(2,K,1,0,"ng-template",null,2,g.C5r),g.k0s()),2&t){const t=g.sdS(3);g.Y8G("componentconfig",s.componentconfig),g.R7$(),g.Y8G("ngIf",s.aclAccess)("ngIfElse",t)}},dependencies:[i.Sq,i.bT,U.B,N.r,P],encapsulation:2})}return SpicePathRelatedListTiles})();var q=e(50910);let H=(()=>{class SpiceKanbanSumField{get displayValue(){return!this.value||isNaN(this.value)?0:this.value}static#t=this.ɵfac=function(t){return new(t||SpiceKanbanSumField)};static#s=this.ɵcmp=g.VBU({type:SpiceKanbanSumField,selectors:[["spice-kanban-sumfield"]],inputs:{value:"value",title:"title",symbol:"symbol"},decls:3,vars:3,consts:[[2,"cursor","default",3,"title","value"]],template:function(t,s){1&t&&(g.j41(0,"span"),g.EFF(1),g.k0s(),g.nrm(2,"system-number-spinner",0)),2&t&&(g.R7$(),g.JRh(s.symbol),g.R7$(),g.Y8G("title",s.title)("value",s.displayValue))},dependencies:[q.Y],encapsulation:2})}return SpiceKanbanSumField})();var J=e(65245),W=e(40553),Z=e(48849),Q=e(88421),tt=e(58461),st=e(45915),et=e(48717),it=e(28933),at=e(18359),lt=e(766),nt=e(15091),ot=e(29895),dt=e(32130);function ct(t,s){1&t&&(g.j41(0,"div",10),g.nrm(1,"system-utility-icon",11),g.k0s())}function rt(t,s){if(1&t&&(g.qex(0),g.nrm(1,"object-record-fieldset-horizontal-list",12),g.bVm()),2&t){const t=g.XpG();g.R7$(),g.Y8G("fieldset",t.headerFieldset)}}function gt(t,s){if(1&t){const t=g.RV6();g.j41(0,"h3",13),g.bIt("click",(function(){g.eBV(t);const s=g.XpG();return g.Njj(s.goDetail())})),g.j41(1,"a",14),g.EFF(2),g.k0s()()}if(2&t){const t=g.XpG();g.R7$(2),g.JRh(t.model.getField("summary_text"))}}function mt(t,s){if(1&t&&(g.j41(0,"div",15),g.nrm(1,"field-container",16),g.k0s()),2&t){const t=g.XpG();g.R7$(),g.Y8G("field",t.componentconfig.amount)("fielddisplayclass","slds-text-heading--medium")}}function ht(t,s){if(1&t&&g.nrm(0,"field-label",20),2&t){const t=g.XpG().$implicit;g.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}const ut=t=>({"slds-size--1-of-1":t});function pt(t,s){if(1&t&&(g.j41(0,"div",17),g.DNE(1,ht,1,2,"field-label",18),g.nrm(2,"field-container",19),g.k0s()),2&t){const t=s.$implicit;g.R7$(),g.Y8G("ngIf",!t.fieldconfig.hidelabel),g.R7$(),g.Y8G("ngClass",g.eq3(5,ut,t.fieldconfig.hidelabel))("field",t.field)("fieldconfig",t.fieldconfig)("fielddisplayclass","slds-truncate")}}let ft=(()=>{class SpiceKanbanTile{constructor(t,s,e,i,a,l){this.modellist=t,this.model=s,this.view=e,this.metadata=i,this.broadcast=a,this.changeDetectorRef=l,this.item={},this.componentconfig={},this.componentFields={},this.subscriptions=new at.yU,this.componentconfig=this.metadata.getComponentConfig("SpiceKanbanTile",this.modellist.module),this.componentFields=this.metadata.getFieldSetFields(this.componentconfig.fieldset),this.view.labels="short",this.view.displayLabels=!1}ngOnInit(){this.model.module=this.modellist.module,this.model.id=this.item.id,this.model.setData(_.clone(this.item)),this.model.initializeFieldsStati(),this.item._KanbanDrop?(this.model.setField(this.modellist.bucketfield,this.item._KanbanDrop.from),this.model.startEdit(),this.model.setField(this.modellist.bucketfield,this.item._KanbanDrop.to),this.model.validate()?this.model.save().subscribe((t=>{delete this.item._KanbanDrop,this.subscribeToSave()})):(this.model.edit().subscribe((t=>{!1===t&&(this.item[this.modellist.bucketfield]=this.item._KanbanDrop.from),delete this.item._KanbanDrop})),this.subscribeToSave())):this.subscribeToSave(),this.model.evaluateValidationRules(null,"initialize"),this.model.initializeFieldsAlertStyles(this.item),this.subscriptions.add(this.model.data$.subscribe((t=>{this.changeDetectorRef.detectChanges()})))}get hasNotification(){return this.model.getField("has_notification")}get headerFieldset(){return this.componentconfig.headerfieldset}subscribeToSave(){this.modelSubscription=this.model.saved$.subscribe((t=>{this.changeDetectorRef.detectChanges()}))}subscribeToBroadcast(){this.modelSubscription=this.model.saved$.subscribe((t=>{this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.modelSubscription&&this.modelSubscription.unsubscribe()}goDetail(){this.model.goDetail()}static#t=this.ɵfac=function(t){return new(t||SpiceKanbanTile)(g.rXU(h.K),g.rXU(p.g),g.rXU(w.U),g.rXU(G.yu),g.rXU(W.m),g.rXU(g.gRc))};static#s=this.ɵcmp=g.VBU({type:SpiceKanbanTile,selectors:[["spice-kanban-tile"]],hostVars:2,hostBindings:function(t,s){2&t&&g.HbH("slds-item")},inputs:{item:"item"},features:[g.Jv_([p.g,w.U])],decls:11,vars:7,consts:[[1,"slds-tile","slds-box--border","slds-theme--default"],[1,"slds-p-around--x-small",3,"system-overlay-loading-spinner"],[1,"slds-grid","slds-grid--vertical-align-center",2,"border-radius","0.25rem",3,"ngClass"],["class","slds-p-right--xx-small",4,"ngIf"],[4,"ngIf","ngIfElse"],["noheaderfieldset",""],["buttonsize","x-small",1,"slds-col_bump-left"],[1,"slds-tile__detail","slds-text-body--small"],["class","slds-p-vertical--x-small",4,"ngIf"],["class","slds-grid",4,"ngFor","ngForOf"],[1,"slds-p-right--xx-small"],["icon","warning","addclasses","slds-icon-text-warning","size","x-small"],[1,"slds-truncate",3,"fieldset"],[1,"slds-truncate",3,"click"],["href","javascript:void(0);"],[1,"slds-p-vertical--x-small"],[3,"field","fielddisplayclass"],[1,"slds-grid"],["class","slds-truncate",3,"fieldname","fieldconfig",4,"ngIf"],[1,"slds-col--bump-left","slds-truncate",3,"ngClass","field","fieldconfig","fielddisplayclass"],[1,"slds-truncate",3,"fieldname","fieldconfig"]],template:function(t,s){if(1&t&&(g.j41(0,"div",0)(1,"div",1)(2,"div",2),g.DNE(3,ct,2,0,"div",3)(4,rt,2,1,"ng-container",4)(5,gt,3,1,"ng-template",null,5,g.C5r),g.nrm(7,"object-action-menu",6),g.k0s(),g.j41(8,"div",7),g.DNE(9,mt,2,2,"div",8)(10,pt,3,7,"div",9),g.k0s()()()),2&t){const t=g.sdS(6);g.R7$(),g.Y8G("system-overlay-loading-spinner",s.model.isSaving),g.R7$(),g.Y8G("ngClass",s.model.alert),g.R7$(),g.Y8G("ngIf",s.hasNotification),g.R7$(),g.Y8G("ngIf",s.headerFieldset)("ngIfElse",t),g.R7$(5),g.Y8G("ngIf",s.componentconfig.amount),g.R7$(),g.Y8G("ngForOf",s.componentFields)}},dependencies:[i.YU,i.Sq,i.bT,lt.b,nt.y,B.P,ot.b,b.B,dt.M],encapsulation:2,changeDetection:0})}return SpiceKanbanTile})();const bt=["kanbanUtilityBar"];function kt(t,s){if(1&t&&(g.qex(0),g.j41(1,"li",12)(2,"a",13)(3,"span",14),g.nrm(4,"system-utility-icon",15),g.k0s(),g.j41(5,"span",16),g.nrm(6,"system-label",17),g.EFF(7),g.k0s()()(),g.bVm()),2&t){const t=s.$implicit,e=g.XpG();g.R7$(6),g.Y8G("label",e.getStageLabel(t.stagedata)),g.R7$(),g.SpI(" (",e.getStageCount(t.stagedata),")")}}function _t(t,s){if(1&t&&(g.j41(0,"li",24),g.nrm(1,"spice-kanban-sumfield",25),g.k0s()),2&t){const t=s.$implicit,e=g.XpG().$implicit,i=g.XpG(2);g.R7$(),g.Y8G("symbol",i.getCurrencySymbol(t))("title",i.getTitle(t))("value",i.getStageSum(e.stagedata,t))}}const vt=t=>({"slds-text-color--inverse-weak":t});function St(t,s){if(1&t&&(g.j41(0,"div",20)(1,"div",21)(2,"ul",22),g.DNE(3,_t,2,3,"li",23),g.k0s()()()),2&t){const t=g.XpG(2);g.Y8G("ngClass",t.sizeClass),g.R7$(),g.Y8G("ngClass",g.eq3(3,vt,t.modellist.isLoading)),g.R7$(2),g.Y8G("ngForOf",t.sumfields)}}function yt(t,s){if(1&t&&(g.j41(0,"div",18),g.DNE(1,St,4,5,"div",19),g.k0s()),2&t){const t=g.XpG();g.R7$(),g.Y8G("ngForOf",t.stages)}}function Dt(t,s){if(1&t&&(g.j41(0,"div",28),g.nrm(1,"spice-kanban-tile",29),g.k0s()),2&t){const t=s.$implicit,e=g.XpG(2);g.Y8G("cdkDragDisabled",!e.allowDrag(t))("cdkDragData",t),g.R7$(),g.Y8G("item",t)}}function Gt(t,s){if(1&t){const t=g.RV6();g.j41(0,"div",26),g.bIt("cdkDropListDropped",(function(s){g.eBV(t);const e=g.XpG();return g.Njj(e.handleDrop(s))})),g.DNE(1,Dt,2,3,"div",27),g.nI1(2,"spicekanbanstagepipe"),g.k0s()}if(2&t){const t=s.$implicit,e=g.XpG();g.Y8G("cdkDropListData",t)("cdkDropListEnterPredicate",e.dropEnterAllowed(t))("ngClass",e.sizeClass),g.R7$(),g.Y8G("ngForOf",g.i5U(2,5,e.modellist.listData.list,t.stage))("ngForTrackBy",e.trackbyfn)}}function xt(t,s){1&t&&g.nrm(0,"system-spinner")}function Ft(t,s){1&t&&(g.j41(0,"div",30)(1,"system-illustration-no-records"),g.nrm(2,"system-label",31),g.k0s()())}function Rt(t,s){if(1&t&&(g.j41(0,"option",51),g.nrm(1,"system-label-fieldname",52),g.k0s()),2&t){const t=s.$implicit,e=g.XpG(2);g.Y8G("value",t),g.R7$(),g.Y8G("module",e.modellist.module)("field",t)}}function Ct(t,s){if(1&t&&(g.j41(0,"li",24),g.nrm(1,"spice-kanban-sumfield",25),g.k0s()),2&t){const t=s.$implicit,e=g.XpG().$implicit,i=g.XpG(2);g.R7$(),g.Y8G("symbol",i.getCurrencySymbol(t))("title",i.getTitle(t))("value",i.getStageSum(e.stagedata,t))}}const $t=t=>({"slds-has-divider--right":t});function jt(t,s){if(1&t){const t=g.RV6();g.j41(0,"div",53),g.bIt("cdkDropListDropped",(function(s){g.eBV(t);const e=g.XpG(2);return g.Njj(e.handleHiddenDrop(s))})),g.j41(1,"div",54)(2,"div",55),g.nrm(3,"system-label",17),g.EFF(4),g.k0s(),g.j41(5,"ul",22),g.DNE(6,Ct,2,3,"li",23),g.k0s()()()}if(2&t){const t=s.$implicit,e=g.XpG(2);g.Y8G("cdkDropListData",t)("cdkDropListEnterPredicate",e.dropEnterAllowed(t)),g.R7$(2),g.Y8G("ngClass",g.eq3(6,$t,e.sumfields.length>0)),g.R7$(),g.Y8G("label",e.getStageLabel(t.stagedata)),g.R7$(),g.SpI(" (",e.getStageCount(t.stagedata),")"),g.R7$(2),g.Y8G("ngForOf",e.sumfields)}}function Lt(t,s){if(1&t){const t=g.RV6();g.j41(0,"div",32)(1,"div",33,34)(3,"div",35)(4,"div",36)(5,"div",37)(6,"div",38)(7,"select",39),g.mxI("ngModelChange",(function(s){g.eBV(t);const e=g.XpG();return g.DH7(e.sortField,s)||(e.sortField=s),g.Njj(s)})),g.bIt("ngModelChange",(function(){g.eBV(t);const s=g.XpG();return g.Njj(s.modellist.reLoadList())})),g.j41(8,"option",40),g.nrm(9,"system-label",41),g.k0s(),g.DNE(10,Rt,2,3,"option",42),g.k0s()()(),g.j41(11,"div",43)(12,"div",38)(13,"select",44),g.mxI("ngModelChange",(function(s){g.eBV(t);const e=g.XpG();return g.DH7(e.sortDirection,s)||(e.sortDirection=s),g.Njj(s)})),g.bIt("ngModelChange",(function(){g.eBV(t);const s=g.XpG();return g.Njj(s.modellist.reLoadList())})),g.j41(14,"option",45),g.nrm(15,"system-label",46),g.k0s(),g.j41(16,"option",47),g.nrm(17,"system-label",48),g.k0s()()()()(),g.j41(18,"div",49),g.DNE(19,jt,7,8,"div",50),g.k0s()()()()}if(2&t){const t=g.XpG();g.R7$(7),g.R50("ngModel",t.sortField),g.R7$(),g.Y8G("selected",t.isDisabled)("hidden",""!=t.sortField),g.R7$(2),g.Y8G("ngForOf",t.sortfields),g.R7$(3),g.Y8G("disabled",t.isDisabled),g.R50("ngModel",t.sortDirection),g.R7$(6),g.Y8G("ngForOf",t.hiddenstages)}}let It=(()=>{class SpiceKanban{constructor(t,s,e,i,a,l,n,o,d){this.backend=t,this.broadcast=s,this.model=e,this.modellist=i,this.configuration=a,this.metadata=l,this.userpreferences=n,this.language=o,this.currency=d,this.componentconfig={},this.modellistsubscribe=void 0,this.stages=[],this.sumfields=[],this.hiddenstages=[],this.currencies=[],this.sortfields=[],this.loadLabel=!1,this.statusNetworkItems=[],this.statusField="",this.statusNetworkManaged=!1,this.componentconfig=this.metadata.getComponentConfig("SpiceKanban",this.modellist.module),this.currencies=this.currency.getCurrencies(),this.loadSortFields()}get sortField(){return _.isEmpty(this.modellist.sortArray)?"select":this.modellist.sortArray[0].sortfield}set sortField(t){_.isEmpty(this.modellist.sortArray)?this.modellist.sortArray.push({sortfield:t,sortdirection:this.sortDirection}):this.modellist.sortArray[0].sortfield=t}get isDisabled(){return"select"==this.sortField}get sortDirection(){return _.isEmpty(this.modellist.sortArray)?"ASC":this.modellist.sortArray[0].sortdirection}set sortDirection(t){this.modellist.sortArray[0].sortdirection=t}loadSortFields(){let t=this.metadata.getModuleDefs(this.modellist.module);t.ftssortable&&(this.sortfields=t.ftssortable.map((t=>t.field)))}loadStatusNetwork(){const t=this.metadata.checkStatusManaged(this.modellist.module);0!=t&&(this.statusField=t.statusField,this.statusNetworkItems=t.statusNetwork,this.statusNetworkManaged=!0)}ngOnInit(){this.loadStatusNetwork(),this.confdata=this.configuration.getData("spicebeanguides")[this.modellist.module];let t=this.confdata.stages,s=[];for(let e of t)"1"==e.stagedata.not_in_kanban?this.hiddenstages.push(e):this.stages.push(e),s.push({bucket:e.stagedata.secondary_stage?e.stagedata.stage+" "+e.stagedata.secondary_stage:e.stage,values:{},items:0,hidden:"1"==e.stagedata.not_in_kanban});if(this.componentconfig.sumfield){let t=this.componentconfig.sumfield.split(",");for(let s of t)s=s.trim(),s.includes(":")?this.sumfields.push({name:s.substring(0,s.indexOf(":")),function:s.substring(s.indexOf(":")+1)}):this.sumfields.push({name:s,function:"sum"})}this.modellist.loadlimit=this.componentconfig.limit?parseInt(this.componentconfig.limit):25,_.isEmpty(this.modellist.buckets)&&(this.modellist.buckets={bucketfield:this.confdata.statusfield,buckettotal:this.sumfields,bucketitems:s},this.modellist.getListData()),this.modellistsubscribe=this.modellist.listType$.pipe((0,J.i)(1)).subscribe((t=>this.handleListTypeChange(t)))}ngOnDestroy(){this.modellistsubscribe.unsubscribe(),this.modellist.buckets={},this.modellist.setToSession()}handleListTypeChange(t){"SpiceKanban"==t.listcomponent&&this.modellist.reLoadList()}get draganddropenabled(){return!!this.componentconfig.draganddrop}trackbyfn(t,s){return s.id}getStageData(t){return this.stages.find((s=>t==s.stage)).stagedata}get sizeClass(){return"slds-size--1-of-"+this.stages.length}getStageCount(t){try{let s=t.secondary_stage?t.stage+" "+t.secondary_stage:t.stage,e=this.modellist.buckets.bucketitems.find((t=>t.bucket==s));return e?e.total:0}catch(t){return 0}}getStageSum(t,s){try{let e="_bucket_agg_"+s.name,i=t.secondary_stage?t.stage+" "+t.secondary_stage:t.stage,a=this.modellist.buckets.bucketitems.find((t=>t.bucket==i));for(let t in a.values){let s=a.values[t];if(t==e)return a.values?s:0}}catch(t){return 0}}getStageItems(t){let s=this.getStageData(t),e=[];for(let i of this.modellist.listData.list)i[s.statusfield]&&0==i[s.statusfield].indexOf(t)&&e.push(i);return e}getMoney(t){return this.userpreferences.formatMoney(parseFloat(t),0)}get hasVisibleItems(){let t=!1;if(this.modellist.buckets&&this.modellist.buckets.bucketitems)for(let s of this.modellist.buckets.bucketitems)if(this.stages.findIndex((t=>t.stage==s.bucket))>=0&&s.items>0){t=!0;break}return t}loadmore(){if(this.modellist.isLoading)return!1;let t=!1;for(let s of this.modellist.buckets.bucketitems)if(this.stages.findIndex((t=>t.stage==s.bucket))>=0&&s.total>s.items){t=!0;break}t&&this.modellist.loadMoreList()}getStageLabel(t){return t.stage_label?t.stage_label:t.stage_name}getCurrencySymbol(t){if("currency"==this.metadata.getFieldType(this.modellist.module,t.name)){let t,s=-99;return this.currencies.some((e=>{if(e.id==s)return t=e.symbol,!0})),t}}handleDrop(t){t.item.data[this.confdata.statusfield]!=t.container.data.stage&&(t.item.data._KanbanDrop={from:t.item.data[this.confdata.statusfield],to:t.container.data.stage},t.item.data[this.confdata.statusfield]=t.container.data.stage)}handleHiddenDrop(t){t.item.data[this.confdata.statusfield]!=t.container.data.stage&&(this.model.module=this.modellist.module,this.model.initialize(),this.model.id=t.item.data.id,this.model.setData(_.clone(t.item.data)),this.model.initializeFieldsStati(),this.model.startEdit(),this.model.setField(this.confdata.statusfield,t.container.data.stage),this.model.validate()?this.model.save():this.model.edit(),t.item.data[this.confdata.statusfield]=t.container.data.stage)}allowDrag(t){return this.draganddropenabled&&t.acl.edit&&(!this.statusNetworkManaged||this.statusNetworkItems.some((s=>t[this.statusField]==s.status_from)))}get containerStyle(){if(this.kanbanUtilityBar){return{"margin-bottom":this.kanbanUtilityBar.element.nativeElement.getBoundingClientRect().height+"px"}}return{}}getTitle(t){return this.language.getLabel("LBL_"+t.name.toUpperCase())}dropEnterAllowed(t){return s=>!this.statusNetworkManaged||this.statusNetworkItems.filter((s=>s.status_to==t.stage)).some((t=>t.status_from==s.data[this.statusField]))}static#t=this.ɵfac=function(t){return new(t||SpiceKanban)(g.rXU(D.H),g.rXU(W.m),g.rXU(p.g),g.rXU(h.K),g.rXU(m.i),g.rXU(G.yu),g.rXU(Z.S),g.rXU(f.B),g.rXU(Q.G))};static#s=this.ɵcmp=g.VBU({type:SpiceKanban,selectors:[["spice-kanban"]],viewQuery:function(t,s){if(1&t&&g.GBs(bt,5,g.c1b),2&t){let t;g.mGM(t=g.lsd())&&(s.kanbanUtilityBar=t.first)}},features:[g.Jv_([p.g])],decls:12,vars:7,consts:[[1,"slds-m-top--small","slds-m-horizontal--small"],["role","application",1,"slds-tabs--path"],["role","tablist",1,"slds-tabs--path__nav"],[4,"ngFor","ngForOf"],["class","slds-grid slds-border--bottom",4,"ngIf"],["cdkDropListGroup","",1,"slds-scrollable--y","kanbancontainer",3,"ngStyle","system-to-bottom"],[1,"slds-grid"],["cdkDropList","","class","slds-col slds-p-horizontal--xx-small slds-m-top--x-small",3,"cdkDropListData","cdkDropListEnterPredicate","ngClass","cdkDropListDropped",4,"ngFor","ngForOf"],[1,"slds-p-around--small"],[4,"ngIf"],["class","slds-height_full slds-align--absolute-center",4,"ngIf"],["class","slds-utility-bar_container","aria-label","Utility Bar",4,"ngIf"],["role","presentation",1,"slds-tabs--path__item","slds-is-incomplete"],["aria-selected","false","role","tab","href","javascript:void(0);","aria-live","assertive",1,"slds-tabs--path__link"],[1,"slds-tabs--path__stage"],["icon","check","size","x-small"],[1,"slds-tabs--path__title"],[3,"label"],[1,"slds-grid","slds-border--bottom"],["class","slds-col slds-p-horizontal--xx-small slds-m-top--x-small",3,"ngClass",4,"ngFor","ngForOf"],[1,"slds-col","slds-p-horizontal--xx-small","slds-m-top--x-small",3,"ngClass"],[1,"slds-text-heading--medium","slds-p-vertical--x-small",3,"ngClass"],[1,"slds-list_horizontal","slds-has-dividers_right","slds-align_absolute-center"],["class","slds-item",4,"ngFor","ngForOf"],[1,"slds-item"],[3,"symbol","title","value"],["cdkDropList","",1,"slds-col","slds-p-horizontal--xx-small","slds-m-top--x-small",3,"cdkDropListData","cdkDropListEnterPredicate","ngClass","cdkDropListDropped"],["cdkDrag","","class"," slds-m-vertical--xx-small slds-kanban-drag--preview ",3,"cdkDragDisabled","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"slds-m-vertical--xx-small","slds-kanban-drag--preview",3,"cdkDragDisabled","cdkDragData"],[3,"item"],[1,"slds-height_full","slds-align--absolute-center"],["label","MSG_NO_RECORDS_FOUND"],["aria-label","Utility Bar",1,"slds-utility-bar_container"],[1,"slds-utility-bar",2,"height","3rem"],["kanbanUtilityBar",""],[1,"slds-grid","slds-size--1-of-1","slds-grid--align-spread"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-left--x-small"],[1,"slds-form-element__control","slds-col"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","select",3,"selected","hidden"],["label","LBL_SELECT"],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__control","slds-col","slds-p-left--x-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],["value","ASC"],["label","LBL_ASCENDING"],["value","DESC"],["label","LBL_DESCENDING"],[1,"slds-utility-bar__item","slds-p-horizontal--x-small"],["cdkDropList","","class","slds-box--border slds-m-around--xxx-small slds-align--absolute-center slds-theme--info",3,"cdkDropListData","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],[3,"value"],[3,"module","field"],["cdkDropList","",1,"slds-box--border","slds-m-around--xxx-small","slds-align--absolute-center","slds-theme--info",3,"cdkDropListData","cdkDropListEnterPredicate","cdkDropListDropped"],[1,"slds-p-horizontal--medium","slds-p-vertical--small","slds-grid"],[1,"slds-p-right--xx-small",3,"ngClass"]],template:function(t,s){1&t&&(g.j41(0,"div",0)(1,"div",1)(2,"ul",2),g.DNE(3,kt,8,2,"ng-container",3),g.k0s()(),g.DNE(4,yt,2,1,"div",4),g.j41(5,"div",5),g.bIt("system-to-bottom",(function(){return s.loadmore()})),g.j41(6,"div",6),g.DNE(7,Gt,3,8,"div",7),g.k0s(),g.j41(8,"div",8),g.DNE(9,xt,1,0,"system-spinner",9),g.k0s(),g.DNE(10,Ft,3,0,"div",10)(11,Lt,20,7,"div",11),g.k0s()()),2&t&&(g.R7$(3),g.Y8G("ngForOf",s.stages),g.R7$(),g.Y8G("ngIf",s.componentconfig.sumfield),g.R7$(),g.Y8G("ngStyle",s.containerStyle),g.R7$(2),g.Y8G("ngForOf",s.stages),g.R7$(2),g.Y8G("ngIf",s.modellist.isLoading),g.R7$(),g.Y8G("ngIf",!s.modellist.isLoading&&!s.hasVisibleItems),g.R7$(),g.Y8G("ngIf",s.hiddenstages.length>0))},dependencies:[i.YU,i.Sq,i.bT,i.B3,a.xH,a.y7,a.wz,a.BC,a.vS,tt.b,R.W,st.P,et.P,b.B,it.b,l.O7,l.RK,l.T1,H,ft,u],encapsulation:2})}return SpiceKanban})(),Yt=(()=>{class ModuleSpicePath{static#t=this.ɵfac=function(t){return new(t||ModuleSpicePath)};static#s=this.ɵmod=g.$C({type:ModuleSpicePath});static#e=this.ɵinj=g.G2t({imports:[i.MD,a.YN,o.ObjectFields,d.GlobalComponents,c.ObjectComponents,r.SystemComponents,n.h,l.ad]})}return ModuleSpicePath})();("undefined"==typeof ngJitMode||ngJitMode)&&g.Obh(Yt,{declarations:[v,S,Y,A,P,u,H,It,ft],imports:[i.MD,a.YN,o.ObjectFields,d.GlobalComponents,c.ObjectComponents,r.SystemComponents,n.h,l.ad]})}}]);