/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-05-28 17:40:40
 *
 *                     build: 2024.01.001.1716910840504
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_calendar_modulecalendar_ts"],{28060:(e,t,s)=>{s.r(t),s.d(t,{ModuleCalendar:()=>Ls});var n=s(60177),i=s(84341),r=s(18039),a=s(48849),o=s(7745),l=s(12948),d=s(37328),c=s(70569),h=s(71341),u=s(54438),m=s(69904),g=s(60968),p=s(92462),f=s(53584),v=s(18359),y=s(7673),b=s(21413),w=s(96354),E=s(96697),D=s(49722),k=s(29994),C=s(40553),x=s(50531),G=s(83935);let S=(()=>{class calendar{constructor(e,t,s,n,i,r,a,o,l,d){this.backend=e,this.session=t,this.broadcast=s,this.modal=n,this.language=i,this.configuration=r,this.modelutilities=a,this.metadata=o,this.cdRef=l,this.userPreferences=d,this.userCalendarChange$=new u.bkB,this.searchTerm="",this.addingEvent$=new u.bkB,this.pickerDate$=new u.bkB,this.otherCalendarsColor$=new u.bkB,this.layoutChange$=new u.bkB,this.modules=[],this.ownerCalendarVisible=!0,this.usersCalendars=[],this.otherCalendars=[],this.calendars={},this.currentStart={},this.currentEnd={},this.sheetTimeWidth=50,this.sheetHourHeight=80,this.weekstartday=0,this.weekDaysCount=7,this.startHour=0,this.endHour=23,this.multiEventHeight=25,this.todayColor="#eb7092",this.absenceColor="#727272",this.eventColor="#039be5",this.groupwareColor="#db4437",this.asPicker=!1,this.isMobileView=!1,this.isDashlet=!1,this.isLoading=!1,this.userPreferencesLoaded=!1,this.duration={Day:"d",Three_Days:"d",Week:"w",Month:"M",Schedule:"M"},this.colorPalette=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"],this.subscriptions=new v.yU,this._sidebarWidth=360,this._calendarDate=moment(),this._sheetType="Week",this.loadCalendarModules(),this.loadPreferences(),this.subscribeToLanguage(),this.getCalendarPreferences(),this.broadcastSubscriber()}get sidebarWidth(){return this.isMobileView||this.isDashlet?0:this._sidebarWidth}get calendarDate(){return this._calendarDate}set calendarDate(e){this._calendarDate=new moment(e).locale(this.language.currentlanguage.substring(0,2)),this.session.setSessionData("calendarDate",this._calendarDate)}get sheetType(){return this._sheetType}set sheetType(e){this._sheetType=e,this.isDashlet||this.userPreferences.setPreference("sheetType",e,!0,"Calendar")}get owner(){return this.customOwner??this.session.authData.userId}get ownerName(){return this.session.authData.userName}get weekStartDay(){return this.weekstartday}set weekStartDay(e){this.weekstartday=e}refresh(e){this.currentStart={},this.currentEnd={},this.triggerSheetReload(e)}shiftPlus(){let e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this._calendarDate=new moment(this._calendarDate.add(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.add(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))}shiftMinus(){let e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay&&(this._calendarDate=new moment(this._calendarDate.subtract(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.subtract(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))}doReload(e,t,s){let n=!this.calendars[s]||this.calendars[s]&&0==this.calendars[s].length,i=!(this.currentStart[s]&&this.currentEnd[s]&&this.currentStart[s].isSame(e)&&this.currentEnd[s].isSame(t));return n||i}loadUserEvents(e,t,s){return this.loadEvents(e,t,this.owner,[s],!0).pipe((0,w.T)((e=>e.map((e=>(e.id=s+e.id,e.otherColor=this.usersCalendars.find((e=>e.id==s)).color,e))))))}loadUsersEvents(e,t){const s=this.usersCalendars.filter((e=>!!e.visible)),n=s.map((e=>e.id)),i=_.object(n,s);return 0==s.length?(0,y.of)([]):this.loadEvents(e,t,this.owner,n).pipe((0,w.T)((e=>{const t=[];return e.forEach((e=>{if(i[e.data.assigned_user_id])e.otherColor=i[e.data.assigned_user_id].color,t.push(e);else if(e.data.meeting_user_status_accept){const s=n.find((t=>!!e.data.meeting_user_status_accept.beans[t]));if(!s)return;e.id=s+e.id,e.otherColor=i[s].color,t.push(e)}})),t})))}loadEvents(e,t,s=this.owner,n=[],i){let r=n.length>0?"users":s;if(i||this.doReload(e,t,r)){this.isLoading=!0,this.cdRef.detectChanges();let i=new b.B,a="YYYY-MM-DD HH:mm:ss",o={start:e.tz("utc").format(a),end:t.tz("utc").format(a),users:n,searchTerm:this.searchTerm},l=n.length>0?"module/Calendar/users/":"module/Calendar/";return this.currentEnd[r]=t,this.currentStart[r]=e,this.backend.getRequest(l+s,o).subscribe((t=>{this.calendars[r]=[];for(let s of t){if(r==this.owner&&s.data.external_id&&this.calendars.google&&this.calendars.google.some((e=>e.id==s.data.external_id))||this.otherCalendars.some((e=>e.name==s.module&&!e.visible)))continue;switch(s.type){case"event":s.start=moment.utc(s.start).tz(this.timeZone).second(0),s.end=moment.utc(s.end).tz(this.timeZone).second(0),s.isMulti=+s.end.diff(s.start,"days",!0)>=1,s.color=this.eventColor;break;case"absence":s.start=moment(s.start).second(0),s.end=moment(s.end).second(0),s.isMulti=!0,s.isAllDay=!0,s.color=this.absenceColor;break;case"other":s.start=moment(s.start).year(e.year()).second(0),s.end=moment(s.end).year(e.year()).second(0),s.isMulti=!0}const t=s.start.date()!=s.end.date()||s.start.hour()>=this.startHour&&s.start.hour()<=this.endHour||s.end.hour()>=this.startHour&&s.end.hour()<=this.endHour;["Day","Three_Days","Week"].some((e=>e==this.sheetType))&&!t||("UserAbsences"==s.module&&("other"==s.type&&(s.data.summary_text=s.data.user_name,s.id=s.id+"-other",s.data.id=s.data.id+"-other"),this.absenceExists(s))||this.calendars[r].push(s))}this.isLoading=!1,this.cdRef.detectChanges(),i.next(this.calendars[r]),i.complete()})),i.asObservable()}{let s=[];for(let n of this.calendars[r])this.otherCalendars.some((e=>e.name==n.module&&!e.visible))||n.start<t&&n.end>e&&(n.start=moment(n.start).tz(this.timeZone).second(0),n.end=moment(n.end).tz(this.timeZone).second(0),s.push(n));return(0,y.of)(s)}}loadGroupwareEvents(e,t){switch(this.activeGroupware){case"google":return this.loadGoogleEvents(e,t);case"microsoft":return this.loadMicrosoftEvents(e,t);default:return(0,y.of)([])}}loadGoogleEvents(e,t){if(this.doReload(e,t,"google")){this.isLoading=!0,this.cdRef.detectChanges();let s=new b.B,n="YYYY-MM-DD HH:mm:ss",i={startdate:e.format(n),enddate:t.format(n),searchTerm:this.searchTerm};return this.calendars.google=[],this.currentEnd.google=t,this.currentStart.google=e,this.backend.getRequest("channels/groupware/gsuite/calendar/events",i).subscribe((e=>{if(e.events&&e.events.length>0)for(let t of e.events)this.calendars[this.owner]&&this.calendars[this.owner].some((e=>e.data.external_id==t.id))||(t.start=moment(moment(t.start.dateTime??t.start.date).format(!t.start.dateTime&&t.start.date?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:00")),t.end=moment(moment(t.end.dateTime??t.end.date).format(!t.end.dateTime&&t.end.date?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:00")),t.isMulti=+t.end.diff(t.start,"days",!0)>=1,t.color=this.groupwareColor,t.type="google",this.calendars.google.push(t));this.isLoading=!1,this.cdRef.detectChanges(),s.next(this.calendars.google),s.complete()})),s.asObservable()}{let s=[];for(let n of this.calendars.google)n.start<t&&n.end>e&&s.push(n);return(0,y.of)(s)}}loadMicrosoftEvents(e,t){if(this.doReload(e,t,"microsoft")){this.isLoading=!0,this.cdRef.detectChanges();let s=new b.B,n="YYYY-MM-DD HH:mm:ss",i={startdate:e.format(n),enddate:t.format(n),searchTerm:this.searchTerm};return this.calendars.microsoft=[],this.currentEnd.microsoft=t,this.currentStart.microsoft=e,this.backend.getRequest(`channels/groupware/microsoft/calendar/events/${this.owner}`,i).subscribe((e=>{if(e.events&&e.events.length>0)for(let t of e.events)this.calendars[this.owner]&&this.calendars[this.owner].some((e=>e.data.external_id==t.id))||(t.start=moment(moment.utc(t.start.dateTime).tz(this.timeZone).format("YYYY-MM-DD HH:mm:00")),t.end=moment(moment.utc(t.end.dateTime).tz(this.timeZone).format("YYYY-MM-DD HH:mm:00")),t.isMulti=+t.end.diff(t.start,"days",!0)>=1,t.color=this.groupwareColor,t.type="microsoft",this.calendars.microsoft.push(t));this.isLoading=!1,this.cdRef.detectChanges(),s.next(this.calendars.microsoft),s.complete()})),s.asObservable()}{let s=[];for(let n of this.calendars.microsoft)n.start<t&&n.end>e&&s.push(n);return(0,y.of)(s)}}getEvents(e=this.owner){return this.calendars[e]?this.calendars[e]:[]}setOtherCalendars(e,t=!0){e&&(this.otherCalendars=e,t&&(this.userPreferences.setPreference("Other",this.otherCalendars,!0,"Calendar"),this.triggerSheetReload()))}addUserCalendar(e,t){if(this.isMobileView||this.isDashlet)return;let s=this.usersCalendars;const n={id:e,name:t,visible:!0,color:"#"+this.colorPalette[Math.floor(this.colorPalette.length*Math.random())]};s.push(n),this.userCalendarChange$.emit(n),this.setUserCalendars(s.slice())}removeUserCalendar(e){if(this.isMobileView||this.isDashlet)return;const t=this.usersCalendars.find((t=>t.id==e));t.visible=!1,this.userCalendarChange$.emit(t);let s=this.usersCalendars.filter((t=>t.id!=e));this.setUserCalendars(s)}toggleUserCalendarVisibility(e){this.usersCalendars.some((t=>{if(t.id==e)return t.visible=!t.visible,this.userCalendarChange$.emit(t),this.setUserCalendars(this.usersCalendars.slice()),!0}))}toggleOwnerCalendarVisible(){this.ownerCalendarVisible=!this.ownerCalendarVisible,this.userCalendarChange$.emit({id:"owner"}),this.userPreferences.setPreference("ownerVisible",this.ownerCalendarVisible,!0,"Calendar")}setUserCalendars(e,t=!0){e&&(this.usersCalendars=e,t&&this.userPreferences.setPreference("Users",this.usersCalendars,!0,"Calendar"))}setUserColor(e,t){this.usersCalendars.some((s=>{if(s.id==e)return s.color=t,this.setUserCalendars(this.usersCalendars),this.otherCalendarsColor$.emit({id:e,color:t}),!0}))}arrangeEvents(e){e.sort(((e,t)=>e.start<t.start||e.start===t.start&&e.end>t.end?-1:1));let t={};for(let s of e){let n=[];for(let t of e)s.id!==t.id&&t.start<s.end&&t.end>s.start&&n.push({id:t.id,start:t.start,end:t.end});let i=0;if(n.length>0){for(let e of n){let t=0;for(let s of n)s.start<e.end&&s.end>e.start&&t++;t>i&&(i=t)}i++}t[s.id]={maxOverlay:i,elementsOverlaid:n}}let s=[];for(let n of e){let i=0,r=[];for(let a of e)if(-1!==s.indexOf(a.id)&&a.start<n.end&&a.end>n.start)for(-1===r.indexOf(t[a.id].displayIndex)&&r.push(t[a.id].displayIndex);-1!==r.indexOf(i);)i++;t[n.id].displayIndex=i,s.push(n.id)}for(let e in t)for(let s of t[e].elementsOverlaid)t[e].maxOverlay<t[s.id].maxOverlay&&(t[e].maxOverlay=t[s.id].maxOverlay);for(let s of e)s.displayIndex=t[s.id].displayIndex,s.maxOverlay=t[s.id].maxOverlay;return e}ngOnDestroy(){this.subscriptions.unsubscribe()}onEventDrop(e,t){t.some((t=>{const s=t.elementRef.nativeElement.getBoundingClientRect(),n=e.source.element.nativeElement.getBoundingClientRect();if(n.top>=s.top&&n.top<=s.bottom&&n.left>=s.left&&n.left<=s.right)return e.source.data.onDrop({day:t.day,hour:t.hour,minutes:t.minutes}),!0})),e.source.reset()}gotToDayView(e){this.refresh(e),this.sheetType="Day"}removeGoogleEvent(e){this.calendars.google.some(((t,s)=>{if(t.id==e)return this.calendars.google.splice(s,1),this.cdRef.detectChanges(),!0}))}removeMicrosoftEvent(e){this.calendars.microsoft.some(((t,s)=>{if(t.id==e)return this.calendars.microsoft.splice(s,1),this.refresh(),!0}))}setIsMobileView(e){this.isMobileView=e,this.multiEventHeight=e?20:25,this.cdRef.detectChanges()}isValid(e){return e&&"object"==typeof e&&e.isValid()}loadCalendarModules(){this.backend.getRequest("module/Calendar/modules").subscribe((e=>{e&&(this.modules=e,this.cdRef.detectChanges())}))}absenceExists(e){let t=!1;for(let s in this.calendars)if(this.calendars.hasOwnProperty(s)&&this.calendars[s].some((t=>t.id==e.id&&t.type==e.type))){t=!0;break}return!!t}broadcastSubscriber(){let e=this.broadcast.message$.subscribe((e=>{let t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if("timezone.changed"==e.messagetype&&(this.timeZone=e.messagedata,this.triggerSheetReload()),this.modules.some((e=>e.name==s)))switch(e.messagetype){case"model.save":let e=n.assigned_user_id,i=this.calendars.users&&this.calendars.users.some((t=>t.id==e));if(!this.calendars[e]&&!i)return;i&&(e="users");!this.modifyEvent(t,s,n,e)&&this.isValid(n.date_end)&&this.isValid(n.date_start)&&this.calendars[e].push({id:t,module:s,type:"event",start:n.date_start,end:n.date_end,isMulti:+n.date_end.diff(n.date_start,"days",!0)>=1,data:n}),this.triggerSheetReload(),this.cdRef.markForCheck();break;case"model.delete":if(!this.calendars[this.owner])return;this.removeEvent(t,s)}}));this.subscriptions.add(e)}modifyEvent(e,t,s,n){if(!this.isValid(s.date_start)||!this.isValid(s.date_end))return!0;if(s.date_start>this.currentEnd&&s.date_end<this.currentStart)return this.removeEvent(e,t),!0;let i=this.calendars[n].find((t=>t.data.id==e));return!!i&&(i.start=s.date_start,i.end=s.date_end,i.isMulti=+s.date_end.diff(s.date_start,"days",!0)>=1,!0)}removeEvent(e,t){this.calendars[this.owner].some(((s,n)=>{if(s.data.id==e&&t==s.module)return this.calendars[this.owner].splice(n,1),this.triggerSheetReload(),this.cdRef.markForCheck(),!0}))}loadPreferences(){this.timeZone=this.session.getSessionData("timezone")||moment.tz.guess();let e=this.userPreferences.toUse;this.weekStartDay="Monday"==e.week_day_start?1:this.weekStartDay,this.weekDaysCount=+e.week_days_count||this.weekDaysCount,this.startHour=+e.calendar_day_start_hour||this.startHour,this.endHour=+e.calendar_day_end_hour||this.endHour;let t=this.session.getSessionData("calendarDate",!1),s=this.session.getSessionData("sheetType",!1);s&&(this._sheetType=s),t&&(this._calendarDate=new moment(t)),this.triggerSheetReload()}getCalendarPreferences(){if(this.isMobileView||this.isDashlet)return;this.userPreferences.loadPreferences("Calendar").pipe((0,E.s)(1)).subscribe((e=>{this.ownerCalendarVisible=!e?.hasOwnProperty("ownerVisible")||e?.ownerVisible,e&&(this._sheetType=e.sheetType??"Week",this.setUserCalendars(e.Users,!1),this.setOtherCalendars(e.Other,!1)),this.userPreferencesLoaded=!0}));const e=this.metadata.getComponentConfig("Calendar").groupwareDisabled;!e&&(this.session.authData.googleToken||this.configuration.checkCapability("google_oauth")&&this.configuration.getCapabilityConfig("google_oauth").serviceaccess)&&(this.activeGroupware="google"),!e&&this.configuration.getCapabilityConfig("msgraphconfig").isActive&&(this.activeGroupware="microsoft")}subscribeToLanguage(){let e=this.language.currentlanguage$.subscribe((()=>this.triggerSheetReload()));this.subscriptions.add(e)}triggerSheetReload(e){this._calendarDate=moment(e||this._calendarDate)}weekdayLong(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.weekdays(e)}weekdayShort(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.weekdaysShort(e)}monthShort(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.monthsShort("-MMM-",e)}static#e=this.ɵfac=function(e){return new(e||calendar)(u.KVO(D.H),u.KVO(k.d),u.KVO(C.m),u.KVO(x.y),u.KVO(m.B),u.KVO(f.i),u.KVO(p.g),u.KVO(G.yu),u.KVO(u.gRc),u.KVO(a.S))};static#t=this.ɵprov=u.jDH({token:calendar,factory:calendar.ɵfac})}return calendar})();var R=s(25863),$=s(68823),M=s(1626),T=s(32062),B=s(44985),j=s(18521),F=s(24834);function Y(e,t){if(1&e&&(u.j41(0,"span",21),u.EFF(1),u.k0s()),2&e){const e=u.XpG(2);u.R7$(),u.SpI(" ",e.weekNumberDisplay," ")}}function V(e,t){if(1&e&&(u.j41(0,"div")(1,"div",14),u.nrm(2,"system-icon",15),u.j41(3,"div",16)(4,"p",17),u.nrm(5,"system-label-modulename",18),u.k0s(),u.j41(6,"h1",19),u.EFF(7),u.DNE(8,Y,2,1,"span",20),u.k0s()()()()),2&e){const e=u.XpG();u.AVh("slds-m-bottom--xx-small",e.calendar.isMobileView),u.R7$(2),u.Y8G("module","Calendar"),u.R7$(5),u.SpI(" ",e.calendarHeader," "),u.R7$(),u.Y8G("ngIf","Week"==e.calendar.sheetType)}}function I(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",22)(1,"system-input-search-term",23),u.mxI("ngModelChange",(function(t){u.eBV(e);const s=u.XpG();return u.DH7(s.searchTerm,t)||(s.searchTerm=t),u.Njj(t)})),u.bIt("onSearchTermClear",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.clearSearchTerm())}))("onEnterPress",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.reloadList())})),u.k0s()()}if(2&e){const e=u.XpG();u.R7$(),u.R50("ngModel",e.searchTerm)}}function X(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",24)(1,"button",25,26),u.bIt("click",(function(){u.eBV(e);const t=u.sdS(2),s=u.XpG(),n=u.sdS(12);return u.Njj(s.toggleOpenPicker(n,t))})),u.nrm(3,"system-utility-icon",27),u.k0s(),u.j41(4,"div",28),u.EFF(5),u.k0s()()}if(2&e){const e=u.XpG();u.R7$(5),u.JRh(e.compactCalendarHeader)}}function U(e,t){if(1&e){const e=u.RV6();u.j41(0,"system-icon",29),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.toggleVisibleModule(t.name))})),u.k0s()}if(2&e){const e=t.$implicit,s=u.XpG();u.Y8G("module",e.name)("ngStyle",s.getIconStyle(e.name))}}function O(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",30)(1,"button",25),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.shiftMinus())})),u.nrm(2,"system-button-icon",31),u.k0s(),u.j41(3,"button",25),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.shiftPlus())})),u.nrm(4,"system-button-icon",31),u.k0s()()}2&e&&(u.R7$(2),u.Y8G("icon","chevronleft"),u.R7$(2),u.Y8G("icon","chevronright"))}function P(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"button",25),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.calendar.refresh())})),u.nrm(2,"system-button-icon",31),u.k0s(),u.j41(3,"div",32)(4,"button",33),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.zoomOut())})),u.nrm(5,"system-button-icon",31),u.k0s(),u.j41(6,"button",33),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.resetZoom())})),u.nrm(7,"system-button-icon",31),u.k0s(),u.j41(8,"button",33),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.zoomIn())})),u.nrm(9,"system-button-icon",31),u.k0s()(),u.j41(10,"button",34),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.goToday())})),u.nrm(11,"system-label",35),u.k0s(),u.bVm()}if(2&e){const e=u.XpG();u.R7$(2),u.Y8G("icon","refresh"),u.R7$(2),u.Y8G("disabled",e.calendar.sheetHourHeight<=30||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.R7$(),u.Y8G("icon","zoomout"),u.R7$(),u.Y8G("disabled",80==e.calendar.sheetHourHeight||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.R7$(),u.Y8G("icon","undo"),u.R7$(),u.Y8G("disabled",e.calendar.sheetHourHeight>=140||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.R7$(),u.Y8G("icon","zoomin")}}function N(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",36)(1,"button",34),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.toggleTypeSelector())})),u.nrm(2,"system-label",37),u.nI1(3,"uppercase"),u.nrm(4,"system-button-icon",31),u.k0s(),u.j41(5,"div",38)(6,"ul",39)(7,"li",40)(8,"a",41),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setType("Day"))})),u.j41(9,"span",42),u.nrm(10,"system-label",43),u.k0s()()(),u.j41(11,"li",44),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setType("Three_Days"))})),u.j41(12,"a",45)(13,"span",42),u.nrm(14,"system-label",46),u.k0s()()(),u.j41(15,"li",44),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setType("Week"))})),u.j41(16,"a",45)(17,"span",42),u.nrm(18,"system-label",47),u.k0s()()(),u.j41(19,"li",44),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setType("Month"))})),u.j41(20,"a",45)(21,"span",42),u.nrm(22,"system-label",48),u.k0s()()(),u.j41(23,"li",44),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setType("Schedule"))})),u.j41(24,"a",45)(25,"span",42),u.nrm(26,"system-label",49),u.k0s()()()()()()}if(2&e){const e=u.XpG();u.AVh("slds-is-open",e.showTypeSelector),u.R7$(2),u.Y8G("label",u.bMT(3,4,"LBL_"+e.calendar.sheetType)),u.R7$(2),u.Y8G("icon","down")}}function H(e,t){if(1&e){const e=u.RV6();u.j41(0,"system-input-date-picker",50),u.bIt("datePicked",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.handleDatePicked(t))})),u.k0s()}if(2&e){const e=u.XpG();u.Y8G("setDate",e.calendar.calendarDate)("weekStartDay",e.calendar.weekStartDay)}}let L=(()=>{class CalendarHeader{constructor(e,t,s,n,i,r,a){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modelUtils=i,this.configuration=r,this.calendar=a,this.openPicker=!1,this.searchTermError=!1,this.scheduleUntilDate={},this.showTypeSelector=!1,this.modules=[],this.datePicked=new u.bkB,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}ngOnDestroy(){this.clickListener&&this.clickListener()}toggleClosed(){this.openPicker=!1,this.clickListener&&this.clickListener()}handleDatePicked(e){this.datePicked.emit(e)}shiftPlus(){this.calendar.shiftPlus()}shiftMinus(){this.calendar.shiftMinus()}get calendarHeader(){const e=new moment(this.calendar.calendarDate);switch(this.calendar.sheetType){case"Week":return`${this.getFirstDayOfWeek()} - ${this.getLastDayOfWeek()}`;case"Month":return e.format("MMMM YYYY");case"Day":return e.format("MMMM D");case"Schedule":return e.format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY");case"Three_Days":return e.format("MMM D")+" - "+moment(e.add(2,"d")).format("MMM D")}}get compactCalendarHeader(){return new moment(this.calendar.calendarDate).format("MMM, YYYY")}get weekNumberDisplay(){let e=new moment(this.calendar.calendarDate);return`${this.language.getLabel("LBL_WEEK")} ${e.format("w")}`}getFirstDayOfWeek(){let e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekStartDay),e.format("MMM D")}getLastDayOfWeek(){let e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekDaysCount),e.format("MMM D")}toggleTypeSelector(){this.showTypeSelector=!this.showTypeSelector}setType(e){this.calendar.sheetType=e,this.calendar.refresh(),this.showTypeSelector=!1}goToday(){this.calendar.calendarDate=new moment}zoomIn(){this.calendar.sheetHourHeight+=10,this.calendar.layoutChange$.next()}zoomOut(){this.calendar.sheetHourHeight-=10,this.calendar.layoutChange$.next()}resetZoom(){this.calendar.sheetHourHeight=80,this.calendar.layoutChange$.next()}toggleOpenPicker(e,t){this.openPicker=!this.openPicker,this.openPicker&&(this.clickListener=this.renderer.listen("document","click",(s=>this.onDocumentClick(s,e,t))))}onDocumentClick(e,t,s){!this.openPicker||t.contains(e.target)||s.contains(e.target)||(this.openPicker=!1,this.clickListener())}toggleVisibleModule(e){let t=this.calendar.otherCalendars.some((t=>{if(t.name==e)return t.visible=!t.visible,this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()),!0}));t||(this.calendar.otherCalendars.push({id:this.modelUtils.generateGuid(),name:e,visible:!1}),this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()))}getIconStyle(e){return this.calendar.otherCalendars.some((t=>e==t.name&&!t.visible))?{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}:{}}get searchTerm(){return this.calendar.searchTerm}set searchTerm(e){e!=this.calendar.searchTerm&&(this.calendar.searchTerm=e,this.reloadList())}clearSearchTerm(){this.searchTerm=""}reloadList(){this.calendar.refresh(),this.calendar.cdRef.detectChanges()}static#e=this.ɵfac=function(e){return new(e||CalendarHeader)(u.rXU(m.B),u.rXU(g.L),u.rXU(u.aKT),u.rXU(u.sFG),u.rXU(p.g),u.rXU(f.i),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarHeader,selectors:[["calendar-header"]],inputs:{modules:"modules"},outputs:{datePicked:"datePicked"},decls:14,vars:12,consts:[[1,"slds-page-header",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"slds-grid"],[3,"slds-m-bottom--xx-small",4,"ngIf"],["class","slds-p-right--small slds-align-bottom","style","width: 400px",4,"ngIf"],["class","slds-col slds-grid",4,"ngIf"],[1,"slds-align-top","slds-col","slds-grid","slds-no-flex","slds-col--bump-left"],[1,"slds-m-right--medium","slds-grid"],["size","medium","divClass","slds-m-right--xx-small","style","cursor: pointer",3,"module","ngStyle","click",4,"ngFor","ngForOf"],["class","slds-button-group","role","group",4,"ngIf"],[4,"ngIf"],["class"," slds-dropdown-trigger slds-dropdown-trigger--click slds-m-left--xx-small",3,"slds-is-open",4,"ngIf"],["aria-hidden","false","role","dialog",1,"slds-datepicker","slds-dropdown","slds-dropdown_left"],["pickerontainer",""],[3,"setDate","weekStartDay","datePicked",4,"ngIf"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-text-title--caps","slds-line-height--reset"],["module","Calendar"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],["class","slds-p-horizontal--x-small slds-p-vertical--xx-small slds-pill slds-text-body--small",4,"ngIf"],[1,"slds-p-horizontal--x-small","slds-p-vertical--xx-small","slds-pill","slds-text-body--small"],[1,"slds-p-right--small","slds-align-bottom",2,"width","400px"],[3,"ngModel","ngModelChange","onSearchTermClear","onEnterPress"],[1,"slds-col","slds-grid"],[1,"slds-button","slds-button--icon-border",3,"click"],["pickerbuttoncontainer",""],["icon","event","size","x-small"],[1,"slds-page-header__title","slds-m-horizontal--x-small","slds-align-middle","slds-truncate"],["size","medium","divClass","slds-m-right--xx-small",2,"cursor","pointer",3,"module","ngStyle","click"],["role","group",1,"slds-button-group"],[3,"icon"],["role","group",1,"slds-button-group","slds-m-left--x-small"],[1,"slds-button","slds-button--icon-border",3,"disabled","click"],[1,"slds-button","slds-button--neutral","slds-p-horizontal--x-small",3,"click"],["label","LBL_TODAY"],[1,"slds-dropdown-trigger","slds-dropdown-trigger--click","slds-m-left--xx-small"],[3,"label"],[1,"slds-dropdown","slds-dropdown--right","slds-dropdown--x-small"],["role","menu",1,"slds-dropdown__list"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem",3,"click"],[1,"slds-truncate"],["label","LBL_DAY"],["role","presentation",1,"slds-dropdown__item",3,"click"],["href","javascript:void(0);","role","menuitem"],["label","LBL_THREE_DAYS"],["label","LBL_WEEK"],["label","LBL_MONTH"],["label","LBL_SCHEDULE"],[3,"setDate","weekStartDay","datePicked"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1),u.DNE(2,V,9,5,"div",2)(3,I,2,1,"div",3)(4,X,6,1,"div",4),u.j41(5,"div",5)(6,"div",6),u.DNE(7,U,1,2,"system-icon",7),u.k0s(),u.DNE(8,O,5,2,"div",8)(9,P,12,7,"ng-container",9)(10,N,27,6,"div",10),u.k0s()()(),u.j41(11,"div",11,12),u.DNE(13,H,1,2,"system-input-date-picker",13),u.k0s()),2&e&&(u.AVh("slds-p-around--x-small",t.calendar.isMobileView),u.R7$(2),u.Y8G("ngIf",!t.calendar.isMobileView),u.R7$(),u.Y8G("ngIf",!t.calendar.isMobileView),u.R7$(),u.Y8G("ngIf",t.calendar.isMobileView),u.R7$(3),u.Y8G("ngForOf",t.modules),u.R7$(),u.Y8G("ngIf",!t.calendar.isMobileView||t.calendar.asPicker),u.R7$(),u.Y8G("ngIf",!t.calendar.isMobileView&&!t.calendar.asPicker),u.R7$(),u.Y8G("ngIf",!t.calendar.asPicker),u.R7$(),u.AVh("slds-hidden",!t.openPicker||!t.calendar.isMobileView),u.R7$(2),u.Y8G("ngIf",t.openPicker))},dependencies:[n.Sq,n.bT,n.B3,i.BC,i.vS,R.t,$.J,M.Q,T.W,B.r,j.B,F.w,n.Pc],encapsulation:2,changeDetection:0})}return CalendarHeader})();function A(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",1),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.addEvent())})),u.EFF(1),u.k0s()}if(2&e){const e=u.XpG();u.R7$(),u.Lme(" ",e.hour,":",0==e.minutes?"00":e.minutes,"\n")}}let z=(()=>{class CalendarSheetDropTarget{constructor(e,t,s){this.calendar=e,this.cdr=t,this.elementRef=s,this.hour=0,this.minutes=0}get date(){return this.day?moment(this.day.date):this.calendar.calendarDate}set hourPart(e){this.minutes=e?15*e:0}ngAfterViewInit(){this.cdr.detach()}addEvent(){const e=moment(this.date);e.hour(this.hour).minute(this.minutes).second(0),this.calendar.asPicker?this.calendar.pickerDate$.emit(e):this.calendar.addingEvent$.emit(e)}static#e=this.ɵfac=function(e){return new(e||CalendarSheetDropTarget)(u.rXU(S),u.rXU(u.gRc),u.rXU(u.aKT))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetDropTarget,selectors:[["calendar-sheet-drop-target"]],inputs:{day:"day",hour:"hour",hourPart:"hourPart"},decls:1,vars:1,consts:[[3,"click",4,"ngIf"],[3,"click"]],template:function(e,t){1&e&&u.DNE(0,A,2,2,"div",0),2&e&&u.Y8G("ngIf",!t.calendar.isDashlet)},dependencies:[n.bT],encapsulation:2,changeDetection:0})}return CalendarSheetDropTarget})();var W=s(35911),q=s(66031),J=s(69139),K=s(32130),Q=s(41731),Z=s(23855),ee=s(29895),te=s(48717),se=s(33325);function ne(e,t){if(1&e&&u.nrm(0,"abbr",4),2&e){const e=u.XpG();u.xc7("background-color",e.event.otherColor),u.Y8G("title",e.event.data.assigned_user_name)}}function ie(e,t){if(1&e&&u.nrm(0,"object-record-fieldset-horizontal-list",12),2&e){const e=u.XpG(2);u.Y8G("ngClass",e.textClass)("fieldset",e.headerFieldset)}}function re(e,t){if(1&e&&(u.j41(0,"span",15),u.EFF(1),u.k0s()),2&e){const e=u.XpG(3);u.Y8G("ngClass",e.textClass),u.R7$(),u.SpI(", ",e.startHour,"")}}function ae(e,t){if(1&e&&(u.j41(0,"span",13),u.EFF(1),u.k0s(),u.DNE(2,re,2,2,"span",14)),2&e){const e=u.XpG(2);u.Y8G("ngClass",e.textClass),u.R7$(),u.JRh(e.model.data.summary_text),u.R7$(),u.Y8G("ngIf",e.event.isMulti&&e.startHour&&!e.isAbsence)}}function oe(e,t){if(1&e&&u.nrm(0,"object-record-fieldset-horizontal-list",12),2&e){const e=u.XpG(2);u.Y8G("ngClass",e.textClass)("fieldset",e.subFieldset)}}function le(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",16),u.bIt("mousedown",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.onMouseDown(t))})),u.nrm(1,"system-utility-icon",17),u.k0s()}}function de(e,t){if(1&e&&(u.qex(0),u.j41(1,"div",5)(2,"div",6),u.DNE(3,ie,1,2,"object-record-fieldset-horizontal-list",7)(4,ae,3,3,"ng-template",null,8,u.C5r)(6,oe,1,2,"object-record-fieldset-horizontal-list",9),u.k0s(),u.nrm(7,"object-action-menu",10),u.k0s(),u.DNE(8,le,2,0,"div",11),u.bVm()),2&e){const e=u.sdS(5),t=u.XpG();u.R7$(3),u.Y8G("ngIf",t.headerFieldset)("ngIfElse",e),u.R7$(3),u.Y8G("ngIf",t.subFieldset&&!t.event.isMulti),u.R7$(),u.Y8G("buttonsize","xx-small"),u.R7$(),u.Y8G("ngIf",!t.event.isMulti&&"Month"!=t.calendar.sheetType&&t.canEdit)}}function ce(e,t){1&e&&u.nrm(0,"system-spinner",18)}let he=(()=>{class CalendarSheetEvent{constructor(e,t,s,n,i,r,a,o,l,d,c){this.language=e,this.configuration=t,this.calendar=s,this.model=n,this.view=i,this.broadcast=r,this.cdRef=a,this.userpreferences=o,this.metadata=l,this.elementRef=d,this.renderer=c,this.eventChange=new u.bkB,this.eventDrop=new u.bkB,this.event={},this.sheetContainer={},this.oldDuration=0,this.color="",this.hasDarkColor=!0,this.subscriptions=new v.yU,this.subscribeToColorChange(),this.subscribeToModelSave(),this.view.displayLabels=!1}get startHour(){return this.model.getField("date_start")?moment(this.model.getField("date_start")).tz(this.calendar.timeZone).format(this.userpreferences.getTimeFormat()):void 0}get textClass(){return"Schedule"!=this.calendar.sheetType&&this.hasDarkColor?"spice-calendar-event-has-dark-color":""}get isAbsence(){return"absence"==this.event.type||"UserAbsences"==this.event.module}get isDraggable(){return this.canEdit&&!this.event.isMulti&&"Month"!=this.calendar.sheetType}get canEdit(){return this.model.checkAccess("edit")&&"Schedule"!=this.calendar.sheetType&&("event"==this.event.type||"absence"==this.event.type)&&!this.calendar.asPicker&&!this.calendar.isMobileView&&!this.calendar.isDashlet}get owner(){return this.calendar.owner}get lockAxis(){return"Day"==this.calendar.sheetType?"y":void 0}ngOnInit(){this.setModelDataFromEvent(),this.loadFieldset(),this.setEventColor()}ngOnDestroy(){this.subscriptions.unsubscribe()}onDrop(e){const t=this.event.end.diff(this.event.start,"minutes");e.day&&(this.event.start=moment(e.day.date)),this.event.start.hour(e.hour).minute(e.minutes).seconds(0),this.event.end=moment(this.event.start).add(t,"minutes"),this.event.data.duration_hours=Math.floor(t/60),this.event.data.duration_minutes=t-60*this.event.data.duration_hours;const s=this.calendar.modules.find((e=>e.name==this.event.module))||{},n=s.dateStartFieldName||"date_start",i=s.dateEndFieldName||"date_end";this.event.data[n]=moment(this.event.start.format()),this.event.data[i]=moment(this.event.end.format()),this.model.startEdit(!0,!0),this.event.saving=!0,this.model.setData({...this.event.data},!0,!0),this.model.save(!1).subscribe((()=>{this.event.saving=!1,this.cdRef.detectChanges()})),this.eventChange.emit()}isDarkColor(e){let t=e.indexOf("#")>-1?e.substring(1):e,s=parseInt(t,16);return.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(255&s)<120}emitDrop(e){this.elementRef.nativeElement.style.zIndex="initial",this.eventDrop.emit(e)}onClick(){this.cdRef.detectChanges()}onDragStart(){this.elementRef.nativeElement.style.zIndex=9999}loadFieldset(){let e=this.metadata.getComponentConfig("CalendarSheetEvent",this.model.module);e&&e.header_fieldset&&(this.headerFieldset=e.header_fieldset),e&&e.sub_fieldset&&(this.subFieldset=e.sub_fieldset)}subscribeToColorChange(){this.subscriptions.add(this.calendar.otherCalendarsColor$.subscribe((e=>{this.event.data.assigned_user_id&&e.id==this.event.data.assigned_user_id&&(this.event.otherColor=e.color,this.cdRef.detectChanges())})))}subscribeToModelSave(){this.subscriptions.add(this.broadcast.message$.subscribe((e=>{let t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if(s==this.model.module&&"model.save"===e.messagetype)t==this.model.id&&(this.model.setData(n,!0),this.updateEventData(n),this.setEventColor(),this.eventChange.emit())})))}updateEventData(e){this.event.data=e}setModelDataFromEvent(){this.model.module=this.event.module,this.model.id=this.event.data.id,this.model.setData({...this.event.data},!0)}onMouseDown(e){if(!this.canEdit)return;this.cdRef.detach(),this.previewsPageY=e.pageY,this.currentPageY=e.pageY,this.oldDuration=this.event.end.diff(this.event.start,"minutes"),this.event.resizing=!0;const t=this.renderer.listen("document","mousemove",(e=>this.onMouseMove(e)));this.mouseUpListener=this.renderer.listen("document","mouseup",(()=>this.onMouseUp(t))),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}onMouseMove(e){this.currentPageY=e.pageY;const t=this.calendar.sheetHourHeight/4,s=this.currentPageY-this.previewsPageY>t,n=this.currentPageY-this.previewsPageY<-Math.abs(t),i=s?"add":n?"subtract":null;i&&(this.previewsPageY=this.currentPageY,this.event.end[i](15,"minutes"),this.eventChange.emit())}onMouseUp(e){this.cdRef.reattach(),this.mouseUpListener(),e();const t=this.event.end.diff(this.event.start,"minutes");if(this.oldDuration!=t){this.event.data.duration_hours=Math.floor(t/60),this.event.data.duration_minutes=t-60*this.event.data.duration_hours,this.model.startEdit(!0,!0);let e={duration_minutes:this.event.data.duration_minutes,duration_hours:this.event.data.duration_hours};e[(this.calendar.modules.find((e=>e.name==this.event.module))||{}).dateEndFieldName||"date_end"]=moment(this.event.end.format()),this.model.setFields(e),this.event.saving=!0,this.model.save().subscribe((()=>{this.event.saving=!1,this.cdRef.detectChanges()})),this.eventChange.emit()}this.previewsPageY=void 0,this.currentPageY=void 0,this.event.resizing=!1,this.oldDuration=0}setEventColor(){if("Schedule"==this.calendar.sheetType)return this.color="transparent";this.color=this.event.hasOwnProperty("color")?this.event.color:this.calendar.eventColor;let e=this.configuration.getData("calendarcolorconditions");if(e){e=e.filter((e=>e.module==this.model.module)).sort(((e,t)=>+e.priority<+t.priority?1:-1));for(let t of e){if(!(null!=t.module_filter&&t.module_filter.length>0)){this.color=t.color_hex_code.indexOf("#")>-1?t.color_hex_code:"#"+t.color_hex_code,this.hasDarkColor=this.isDarkColor(t.color_hex_code);break}if(this.model.checkModuleFilterMatch(t.module_filter)){this.color=t.color_hex_code.indexOf("#")>-1?t.color_hex_code:"#"+t.color_hex_code,this.hasDarkColor=this.isDarkColor(t.color_hex_code);break}}}}static#e=this.ɵfac=function(e){return new(e||CalendarSheetEvent)(u.rXU(m.B),u.rXU(f.i),u.rXU(S),u.rXU(W.g),u.rXU(Q.U),u.rXU(C.m),u.rXU(u.gRc),u.rXU(a.S),u.rXU(G.yu),u.rXU(u.aKT),u.rXU(u.sFG))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetEvent,selectors:[["calendar-sheet-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},outputs:{eventChange:"eventChange",eventDrop:"eventDrop"},features:[u.Jv_([W.g,Q.U])],decls:6,vars:12,consts:[["cdkDrag","","cdkDragBoundary",".calendar-event-drag-boundary",1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview",2,"height","100%","border-radius","2px",3,"cdkDragData","cdkDragLockAxis","cdkDragDisabled","click","cdkDragEnded","cdkDragStarted"],["style","height: calc(100% - 2px); width: 8px; border-radius: 2px; margin: 1px; box-shadow: #4b4b4b 1px 0 1px 0;",3,"background-color","title",4,"ngIf"],[4,"ngIf","ngIfElse"],["saving",""],[2,"height","calc(100% - 2px)","width","8px","border-radius","2px","margin","1px","box-shadow","#4b4b4b 1px 0 1px 0",3,"title"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small",2,"height","100%"],[1,"slds-truncate",2,"height","inherit","width","100%"],[3,"ngClass","fieldset",4,"ngIf","ngIfElse"],["summaryContainer",""],[3,"ngClass","fieldset",4,"ngIf"],[1,"slds-p-top--xxx-small",3,"buttonsize"],["draggable","false","class","slds-is-absolute","style","bottom: 0; left: calc(50% - 8px);cursor: ns-resize;",3,"mousedown",4,"ngIf"],[3,"ngClass","fieldset"],["system-model-popover","",1,"slds-text-link--reset",3,"ngClass"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],["draggable","false",1,"slds-is-absolute",2,"bottom","0","left","calc(50% - 8px)","cursor","ns-resize",3,"mousedown"],["colorclass","slds-icon-text-white","icon","threedots","size","x-small"],["inverse","true",2,"opacity","0.5"]],template:function(e,t){if(1&e&&(u.j41(0,"div",0),u.bIt("click",(function(){return t.onClick()}))("cdkDragEnded",(function(e){return t.emitDrop(e)}))("cdkDragStarted",(function(){return t.onDragStart()})),u.DNE(1,ne,1,3,"abbr",1),u.j41(2,"div"),u.DNE(3,de,9,5,"ng-container",2)(4,ce,1,0,"ng-template",null,3,u.C5r),u.k0s()()),2&e){const e=u.sdS(5);u.xc7("background-color",t.color),u.AVh("slds-p-vertical--xx-small",t.event.saving),u.Y8G("cdkDragData",t)("cdkDragLockAxis",t.lockAxis)("cdkDragDisabled",!t.isDraggable),u.R7$(),u.Y8G("ngIf",t.event.otherColor),u.R7$(),u.xc7("width",t.event.otherColor?"calc(100% - 8px)":"100%"),u.R7$(),u.Y8G("ngIf",!t.event.saving)("ngIfElse",e)}},dependencies:[n.YU,n.bT,Z.P,ee.b,te.P,j.B,se.j,r.T1],encapsulation:2,changeDetection:0})}return CalendarSheetEvent})();var ue=s(4921);let me=(()=>{class CalendarSheetGoogleEvent{constructor(e,t,s,n,i,r,a,o){this.calendar=e,this.footer=t,this.metadata=s,this.zone=n,this.model=i,this.modal=r,this.injector=a,this.elementRef=o,this.sheetContainer={},this.popoverComponentRef=null,this.showPopoverTimeout={}}ngOnDestroy(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseEnter(){this.zone.runOutsideAngular((()=>{this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}))}onMouseLeave(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.footer.footercontainer&&this.zone.run((()=>{this.metadata.addComponent("CalendarGoogleEventPopover",this.footer.footercontainer,this.injector).subscribe((e=>{e.instance.parentElementRef=this.elementRef,e.instance.event=this.event,this.popoverComponentRef=e.instance}))}))}onActionClick(){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((e=>{e.instance.module$.pipe((0,E.s)(1)).subscribe((e=>{if(e){this.model.module=e.name;const t=this.event.end.diff(this.event.start,"minutes"),s=Math.floor(t/60),n=t-60*s;let i={[e.dateStartFieldName]:this.event.start,[e.dateEndFieldName]:this.event.end,duration_minutes:n,duration_hours:s,name:this.event.summary,description:this.event.description,location:this.event.location,external_id:this.event.id};"UserAbsences"==e.name&&(i.user_id=this.calendar.owner,i.user_name=this.calendar.ownerName),this.model.addModel("",null,i).subscribe((()=>{this.calendar.removeGoogleEvent(this.event.id)}))}}))}))}static#e=this.ɵfac=function(e){return new(e||CalendarSheetGoogleEvent)(u.rXU(S),u.rXU(ue.q),u.rXU(G.yu),u.rXU(u.SKi),u.rXU(W.g),u.rXU(x.y),u.rXU(u.zZn),u.rXU(u.aKT))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetGoogleEvent,selectors:[["calendar-sheet-google-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},features:[u.Jv_([W.g])],decls:6,vars:5,consts:[[1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview","slds-height_full",2,"border-radius","2px"],[1,"slds-size--1-of-1"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small","slds-height_full"],[1,"slds-truncate","slds-grid",2,"height","inherit"],[1,"slds-text-link--reset","slds-truncate",3,"mouseenter","mouseleave"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),u.bIt("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(){return t.onMouseLeave()})),u.EFF(5),u.k0s()()()()()),2&e&&(u.xc7("background-color","Schedule"==t.calendar.sheetType?"0":t.calendar.groupwareColor),u.R7$(4),u.AVh("spice-calendar-event-has-dark-color","Schedule"!=t.calendar.sheetType),u.R7$(),u.SpI(" ",t.event.summary," "))},encapsulation:2,changeDetection:0})}return CalendarSheetGoogleEvent})();var ge=s(80256);let pe=(()=>{class CalendarSheetMicrosoftEvent{constructor(e,t,s,n,i,r,a,o){this.calendar=e,this.footer=t,this.metadata=s,this.zone=n,this.model=i,this.modal=r,this.injector=a,this.elementRef=o,this.sheetContainer={},this.popoverComponentRef=null,this.showPopoverTimeout={}}ngOnDestroy(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseEnter(){this.zone.runOutsideAngular((()=>{this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}))}onMouseLeave(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.footer.footercontainer&&this.zone.run((()=>{this.metadata.addComponent("CalendarMicrosoftEventPopover",this.footer.footercontainer,this.injector).subscribe((e=>{e.instance.parentElementRef=this.elementRef,e.instance.event=this.event,this.popoverComponentRef=e.instance}))}))}onActionClick(){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((e=>{e.instance.module$.pipe((0,E.s)(1)).subscribe((e=>{if(e){this.model.module=e.name;const t=this.event.end.diff(this.event.start,"minutes"),s=Math.floor(t/60),n=t-60*s;let i={[e.dateStartFieldName]:this.event.start,[e.dateEndFieldName]:this.event.end,duration_minutes:n,duration_hours:s,name:this.event.subject,description:this.event.body?.content,location:this.event.location?.displayName,external_id:this.event.id};"UserAbsences"==e.name&&(i.user_id=this.calendar.owner,i.user_name=this.calendar.ownerName),this.model.addModel("",null,i).subscribe((()=>{this.calendar.removeMicrosoftEvent(this.event.id)}))}}))}))}static#e=this.ɵfac=function(e){return new(e||CalendarSheetMicrosoftEvent)(u.rXU(S),u.rXU(ue.q),u.rXU(G.yu),u.rXU(u.SKi),u.rXU(W.g),u.rXU(x.y),u.rXU(u.zZn),u.rXU(u.aKT))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetMicrosoftEvent,selectors:[["calendar-sheet-microsoft-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},features:[u.Jv_([W.g])],decls:15,vars:5,consts:[[1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview","slds-height_full",2,"border-radius","2px"],[1,"slds-size--1-of-1"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small","slds-height_full"],[1,"slds-truncate","slds-grid",2,"height","inherit"],[1,"slds-text-link--reset","slds-truncate",3,"mouseenter","mouseleave"],["system-dropdown-trigger","",1,"slds-dropdown-trigger","slds-dropdown-trigger--click","slds-p-top--xxx-small",2,"height","fit-content"],["aria-haspopup","true",1,"slds-button","slds-button--icon-border-filled","slds-button--icon-xx-small"],["icon","down","size","xx-small"],[1,"slds-dropdown"],["role","menu",1,"slds-dropdown__list"],["role","presentation",1,"slds-dropdown__item",3,"click"],["href","javascript:void(0);","role","menuitem","tabindex","-1"],[1,"slds-truncate"],["label","LBL_SAVE_TO_CRM"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),u.bIt("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(){return t.onMouseLeave()})),u.EFF(5),u.k0s()(),u.j41(6,"div",5)(7,"button",6),u.nrm(8,"system-button-icon",7),u.k0s(),u.j41(9,"div",8)(10,"ul",9)(11,"li",10),u.bIt("click",(function(){return t.onActionClick()})),u.j41(12,"a",11)(13,"div",12),u.nrm(14,"system-label",13),u.k0s()()()()()()()()()),2&e&&(u.xc7("background-color","Schedule"==t.calendar.sheetType?"0":t.calendar.groupwareColor),u.R7$(4),u.AVh("spice-calendar-event-has-dark-color","Schedule"!=t.calendar.sheetType),u.R7$(),u.SpI(" ",t.event.subject," "))},dependencies:[R.t,T.W,ge.q],encapsulation:2,changeDetection:0})}return CalendarSheetMicrosoftEvent})();const fe=["sheetContainer"];function ve(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",11),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("height",s.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function ye(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",11),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("height",s.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function be(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",11),2&e){const e=u.XpG().$implicit,t=u.XpG();u.xc7("height",t.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function we(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",11),2&e){const e=u.XpG().$implicit,t=u.XpG();u.xc7("height",t.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function Ee(e,t){if(1&e&&(u.qex(0),u.DNE(1,be,1,3,"calendar-sheet-google-event",12)(2,we,1,3,"calendar-sheet-microsoft-event",12),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type)}}function De(e,t){if(1&e&&(u.j41(0,"div",13)(1,"div",14)(2,"div",15),u.EFF(3),u.k0s()(),u.j41(4,"div",16)(5,"div",17),u.nrm(6,"calendar-sheet-drop-target",18)(7,"calendar-sheet-drop-target",18),u.k0s(),u.j41(8,"div",19),u.nrm(9,"calendar-sheet-drop-target",18)(10,"calendar-sheet-drop-target",18),u.k0s()()()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("width",s.calendar.sheetTimeWidth,"px"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(),u.SpI("",e,":00"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(2),u.Y8G("hour",e)("hourPart",0),u.R7$(),u.Y8G("hour",e)("hourPart",1),u.R7$(2),u.Y8G("hour",e)("hourPart",2),u.R7$(),u.Y8G("hour",e)("hourPart",3)}}function ke(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",20),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.bVm()}if(2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function Ce(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",20),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.bVm()}if(2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function xe(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",22),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function Ge(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",22),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function Se(e,t){if(1&e&&(u.qex(0),u.DNE(1,xe,1,2,"calendar-sheet-google-event",21)(2,Ge,1,2,"calendar-sheet-microsoft-event",21),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type)}}let Re=(()=>{class CalendarSheetDay{constructor(e,t,s,n){this.language=e,this.cdRef=t,this.renderer=s,this.calendar=n,this.dayTextContainerClass="",this.dayTextClass="slds-text-body--regular",this.dateTextClass="slds-text-heading--large",this.sheetHours=[],this.ownerMultiEvents=[],this.groupwareMultiEvents=[],this.setdate={},this.groupwareVisible=!0,this.ownerEvents=[],this.userEvents=[],this.userMultiEvents=[],this.groupwareEvents=[],this.subscription=new v.yU,this.buildHours(),this.subscribeToChanges()}subscribeToChanges(){this.subscription.add(this.calendar.layoutChange$.subscribe((()=>{this.setEventsStyle()}))),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>this.setEventsStyle()))}get allEvents(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.groupwareEvents))}get offset(){return moment.tz(this.calendar.timeZone).format("z Z")}get sheetTimeWidth(){return this.calendar.sheetTimeWidth}get startDate(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(this.calendar.endHour-this.calendar.startHour,"h")}get isTodayStyle(){let e=new moment;return{color:e.year()===this.setdate.year()&&e.month()===this.setdate.month()&&e.date()==this.setdate.date()?this.calendar.todayColor:"inherit"}}ngOnChanges(e){e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnInit(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")}ngOnDestroy(){this.subscription.unsubscribe(),this.resizeListener&&this.resizeListener()}trackByItemFn(e,t){return t.id}trackByIndexFn(e,t){return e}correctHours(e){return e.forEach((e=>{if(!e.isMulti){let t=e.end.hour()>this.calendar.startHour&&e.start.hour()<this.calendar.startHour,s=e.start.hour()<this.calendar.endHour&&e.end.hour()>this.calendar.endHour;t&&(e.start=e.start.hour(this.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(this.calendar.endHour).minute(59))}})),e}getOwnerEvents(){if(this.ownerEvents=[],this.ownerMultiEvents=[],!this.calendar.ownerCalendarVisible)return this.setEventsStyle();this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),e=this.filterEvents(e),this.ownerEvents=e.filter((e=>!e.isMulti)),this.ownerMultiEvents=e.filter((e=>e.isMulti)),this.setEventsStyle())}))}getGroupwareEvents(){if(this.groupwareEvents=[],this.groupwareMultiEvents=[],!this.groupwareVisible||this.calendar.isMobileView)return this.setEventsStyle();this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),e=this.filterEvents(e),this.groupwareEvents=e.filter((e=>!e.isMulti)),this.groupwareMultiEvents=e.filter((e=>e.isMulti)),this.setEventsStyle())}))}getUserEvents(e){if(this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.userMultiEvents=this.userMultiEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.calendar.isMobileView||!e.visible)return this.setEventsStyle();this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(e=this.correctHours(e),(e=this.filterEvents(e)).forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.setEventsStyle())}))}getUsersEvents(){if(this.userEvents=[],this.userMultiEvents=[],this.calendar.isMobileView)return this.setEventsStyle();this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),(e=this.filterEvents(e)).forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.setEventsStyle())}))}filterEvents(e){return e.filter((e=>e.end.hour()>this.calendar.startHour||e.start.hour()<this.calendar.endHour||"absence"==e.type))}displayDate(e){switch(e){case"weekday":return"string"==typeof this.setdate.format("d")?parseInt(this.setdate.format("d"),10):this.setdate.format("d");case"day":return this.setdate.format("ddd");case"date":return this.setdate.format(this.calendar.isDashlet?"D, MMMM":"D")}}buildHours(){this.sheetHours=[];let e=this.calendar.startHour;for(;e<=this.calendar.endHour;)this.sheetHours.push(e),e++}setEventsStyle(){this.allEvents.forEach((e=>{const t=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),s=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),n=(this.sheetContainer.element.nativeElement.clientWidth-this.sheetTimeWidth)/(e.maxOverlay>0?e.maxOverlay:1);e.style={left:this.sheetTimeWidth+n*e.displayIndex+"px",width:n+"px",top:this.calendar.sheetHourHeight/60*t-1+"px",height:this.calendar.sheetHourHeight/60*(s-t)+"px","min-height":this.calendar.multiEventHeight+"px"}})),this.cdRef.detectChanges()}onEventDrop(e){this.calendar.onEventDrop(e,this.dropTargets)}static#e=this.ɵfac=function(e){return new(e||CalendarSheetDay)(u.rXU(m.B),u.rXU(u.gRc),u.rXU(u.sFG),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetDay,selectors:[["calendar-sheet-day"]],viewQuery:function(e,t){if(1&e&&(u.GBs(fe,7,u.c1b),u.GBs(z,5)),2&e){let e;u.mGM(e=u.lsd())&&(t.sheetContainer=e.first),u.mGM(e=u.lsd())&&(t.dropTargets=e)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.OA$],decls:20,vars:25,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center","slds-height_full"],[1,"slds-border--left","slds-p-top--xx-small","slds-grow"],[1,"slds-p-bottom--xx-small",3,"ngClass","ngStyle"],[1,"slds-p-left--x-small","slds-truncate",3,"ngClass"],[1,"slds-text-align--center","slds-border--top","slds-p-around--xxx-small","slds-text-body--small"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-scrollable--y","slds-is-relative","slds-grow","calendar-event-drag-boundary"],["sheetContainer",""],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"spice-calendar-multi-event-day",3,"event"],["class","spice-calendar-multi-event-day",3,"event","height",4,"ngIf"],[1,"slds-grid"],[1,"slds-height_full"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[1,"spice-calendar-event",3,"event","ngStyle"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1)(2,"div",2),u.EFF(3),u.k0s(),u.j41(4,"div",3)(5,"div",4)(6,"div",5),u.EFF(7),u.k0s(),u.j41(8,"h1",5),u.EFF(9),u.k0s()(),u.j41(10,"div",6),u.DNE(11,ve,2,3,"ng-container",7)(12,ye,2,3,"ng-container",7)(13,Ee,3,2,"ng-container",7),u.k0s()()(),u.j41(14,"div",8,9),u.DNE(16,De,11,15,"div",10)(17,ke,2,2,"ng-container",7)(18,Ce,2,2,"ng-container",7)(19,Se,3,2,"ng-container",7),u.k0s()()),2&e&&(u.R7$(2),u.xc7("width",t.calendar.sheetTimeWidth,"px"),u.R7$(),u.SpI(" ",t.offset," "),u.R7$(2),u.Y8G("ngClass",t.dayTextContainerClass)("ngStyle",t.isTodayStyle),u.R7$(),u.Y8G("ngClass",t.dayTextClass),u.R7$(),u.JRh(t.calendar.weekdayShort(t.displayDate("weekday"))),u.R7$(),u.Y8G("ngClass",t.dateTextClass),u.R7$(),u.JRh(t.displayDate("date")),u.R7$(),u.xc7("min-height",t.calendar.multiEventHeight,"px"),u.R7$(),u.Y8G("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(3),u.Y8G("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.R7$(),u.Y8G("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.YU,n.Sq,n.bT,n.B3,he,me,z,pe],encapsulation:2,changeDetection:0})}return CalendarSheetDay})();var _e=s(25007);const $e=["sheetContainer"],Me=["scrollContainer"];function Te(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",15)(1,"div",16)(2,"div",17),u.EFF(3),u.k0s(),u.j41(4,"div",18)(5,"a",19),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.gotoDay(t.date))})),u.EFF(6),u.k0s()()()()}if(2&e){const e=t.$implicit,s=u.XpG();u.Y8G("ngStyle",s.dayWidthStyle),u.R7$(),u.xc7("color",e.color),u.R7$(2),u.SpI(" ",s.calendar.weekdayShort(e.day)," "),u.R7$(3),u.SpI(" ",e.dateTextDayNumber," ")}}function Be(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",20),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function je(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",20),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function Fe(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function Ye(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function Ve(e,t){if(1&e&&(u.qex(0),u.DNE(1,Fe,1,2,"calendar-sheet-google-event",21)(2,Ye,1,2,"calendar-sheet-microsoft-event",21),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type)}}function Ie(e,t){if(1&e&&u.nrm(0,"div"),2&e){const e=u.XpG(2);u.xc7("height",e.calendar.multiEventHeight,"px")}}function Xe(e,t){if(1&e&&(u.j41(0,"div",15),u.DNE(1,Ie,1,2,"div",22),u.k0s()),2&e){const e=t.$implicit,s=u.XpG();u.xc7("min-height",s.calendar.multiEventHeight,"px"),u.Y8G("ngStyle",s.dayWidthStyle),u.R7$(),u.Y8G("ngForOf",e.events)("ngForTrackBy",s.trackByItemFn)}}function Ue(e,t){if(1&e&&(u.j41(0,"div",26)(1,"div",27),u.nrm(2,"calendar-sheet-drop-target",28)(3,"calendar-sheet-drop-target",28),u.k0s(),u.j41(4,"div",29),u.nrm(5,"calendar-sheet-drop-target",28)(6,"calendar-sheet-drop-target",28),u.k0s()()),2&e){const e=t.$implicit,s=u.XpG().$implicit,n=u.XpG();u.Y8G("ngStyle",n.dayWidthStyle),u.R7$(2),u.Y8G("day",e)("hour",s)("hourPart",0),u.R7$(),u.Y8G("day",e)("hour",s)("hourPart",1),u.R7$(2),u.Y8G("day",e)("hour",s)("hourPart",2),u.R7$(),u.Y8G("day",e)("hour",s)("hourPart",3)}}function Oe(e,t){if(1&e&&(u.j41(0,"div",5)(1,"div")(2,"div",23),u.EFF(3),u.k0s()(),u.j41(4,"div",24),u.DNE(5,Ue,7,13,"div",25),u.k0s()()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("width",s.calendar.sheetTimeWidth,"px"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(),u.SpI("",e,":00"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(),u.Y8G("ngForOf",s.sheetDays)("ngForTrackBy",s.trackByIndexFn)}}function Pe(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-sheet-event",30),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG(2);return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.onEventDrop(t))})),u.k0s()}if(2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.ownerEvents[e.id+"_next"].style)}}function Ne(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",30),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.DNE(2,Pe,1,2,"calendar-sheet-event",31),u.bVm()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("event",e)("ngStyle",e.style),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.ownerEvents[e.id+"_next"])}}function He(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-sheet-event",30),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG(2);return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.onEventDrop(t))})),u.k0s()}if(2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.userEvents[e.id+"_next"].style)}}function Le(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",30),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.DNE(2,He,1,2,"calendar-sheet-event",31),u.bVm()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("event",e)("ngStyle",e.style),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"])}}function Ae(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function ze(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",20),2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id+"_next"])}}function We(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function qe(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id+"_next"])}}function Je(e,t){if(1&e&&(u.qex(0),u.DNE(1,Ae,1,2,"calendar-sheet-google-event",21)(2,ze,1,2,"calendar-sheet-google-event",21)(3,We,1,2,"calendar-sheet-microsoft-event",21)(4,qe,1,2,"calendar-sheet-microsoft-event",21),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"]&&"google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"]&&"microsoft"==e.type)}}let Ke=(()=>{class CalendarSheetWeek{constructor(e,t,s,n,i,r){this.language=e,this.cdRef=t,this.renderer=s,this.navigation=n,this.navigationTab=i,this.calendar=r,this.sheetDays=[],this.sheetHours=[],this.setdate={},this.groupwareVisible=!0,this.ownerMultiEvents=[],this.groupwareMultiEvents=[],this.ownerEvents=[],this.userEvents=[],this.userMultiEvents=[],this.groupwareEvents=[],this.nextDaySingleEvents={ownerEvents:{},userEvents:{},groupwareEvents:{}},this.subscription=new v.yU,this.buildHours(),this.buildSheetDays(),this.subscribeToChanges()}get offset(){return moment.tz(this.calendar.timeZone).format("z Z")}get allMultiEvents(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.groupwareMultiEvents)}get sheetTimeWidth(){return this.calendar.sheetTimeWidth}get startDate(){return new moment(this.setdate).day(this.calendar.weekStartDay).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(moment.duration(this.calendar.weekDaysCount-1,"d")).hour(this.calendar.endHour)}get dayWidthStyle(){return{width:`calc(100% / ${this.calendar.weekDaysCount})`}}ngOnChanges(e){this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.subscription.unsubscribe()}trackByItemFn(e,t){return t.id}trackByIndexFn(e,t){return e}buildSheetDays(){this.sheetDays=[];let e=0,t=this.calendar.weekStartDay;for(;e<this.calendar.weekDaysCount;){let s=new moment(this.setdate);s.day(t),this.sheetDays.push({index:e,date:moment(s),day:t,color:this.isToday(moment(s))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(s).format("ddd"),dateTextDayNumber:moment(s).format("D"),items:[]}),e++,t++}}setSingleEventsStyle(){this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.groupwareEvents,Object.values(this.nextDaySingleEvents.ownerEvents),Object.values(this.nextDaySingleEvents.userEvents),Object.values(this.nextDaySingleEvents.groupwareEvents))).forEach((e=>this.setSingleEventStyle(e))),this.cdRef.detectChanges()}setSingleEventStyle(e){const t=1==this.calendar.weekStartDay&&0==e.start.day()?6:e.start.day()-this.calendar.weekStartDay,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),i=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.sheetContainer.element.nativeElement.clientWidth-i,a=(r-this.sheetTimeWidth)/this.calendar.weekDaysCount/(e.maxOverlay>0?e.maxOverlay:1),o=this.sheetTimeWidth+(r-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+a*e.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);e.style={left:o+"px",width:a+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}}setMultiEventsStyle(){this.allMultiEvents.forEach((e=>this.setMultiEventStyle(e))),this.cdRef.detectChanges()}setMultiEventStyle(e){let t=e.sequence-1;const s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-s-this.sheetTimeWidth)/this.calendar.weekDaysCount,i=moment(moment(this.setdate).day(this.calendar.weekStartDay).hour(0).format("YYYY-MM-DD HH:00:00")),r=moment(moment(i).add(moment.duration(this.calendar.weekDaysCount,"d")).hour(this.calendar.endHour)),a=e.start.isBefore(i)?i:e.start,o=e.end.isAfter(r)?r:e.end,l=+e.start.diff(i,"days")>0?+e.start.diff(i,"days"):0,d=l*n,c=this.calendar.weekDaysCount-l,h=Math.abs(o.diff(a,"days"))+(o.hour()>a.hour()||o.minute()>a.minute()?1:0),u=(h>c?c:h)*n;e.style={width:u+"px",left:d+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*t+"px"}}displayDate(e,t){return t.format(e)}buildHours(){this.sheetHours=[];let e=this.calendar.startHour;for(;e<=this.calendar.endHour;)this.sheetHours.push(e),e++}gotoDay(e){this.calendar.asPicker||this.calendar.gotToDayView(moment(e.format()))}isToday(e){let t=new moment;return t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()}subscribeToChanges(){this.subscription.add(this.calendar.layoutChange$.subscribe((()=>{this.buildSheetDays(),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle()}))),this.subscription.add(this.navigation.activeTab$.subscribe((e=>{this.navigationTab.objecttab.id==e&&_e.$.schedule((()=>{this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle()}),100)}))),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>{this.setSingleEventsStyle(),this.setMultiEventsStyle()}))}getDaysDiff(e,t,s){let n=Math.ceil(t.diff(e,"day",!0).toFixed(1));return!s&&n>0&&0==t.hour()&&0==t.minute()&&n--,n}arrangeMultiEvents(){const e={};this.sheetDays.forEach((t=>e[t.date.date()]=t.index));const t=this.allMultiEvents.sort(((e,t)=>e.start.isBefore(t.start)?-1:1)).sort(((e,t)=>e.end.diff(e.start,"day")>t.end.diff(t.start,"day")&&e.start.isSameOrBefore(t.start,"day")?-1:1));this.sheetDays.forEach((e=>e.events=[])),t.forEach((t=>{delete t.sequence;const s=this.getDaysDiff(t.start,t.end,t.isAllDay);Array.from({length:s+1},((e,s)=>moment(t.start).add(s,"days"))).forEach((s=>{const n=this.sheetDays[e[s.date()]];n&&(isNaN(t.sequence)&&(t.sequence=n.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1),n.events.push(t))}));for(let e of this.sheetDays)for(let s=moment(t.start);s.diff(t.end,"days")<=-1;s.add(1,"days"))s.date()!=e.date.date()||e.events.some((e=>e.id==t.id))||e.events.push(t)})),this.cdRef.detectChanges()}generateNextDaySingleEvents(e){this[e].forEach((t=>{if(t.isMulti||t.start.date()==t.end.date())return;const s=moment(t.end);t.start.isBefore(this.sheetDays[0].date,"day")?t.start.date(this.sheetDays[0].date.date()).hour(this.calendar.startHour).minute(0):t.end.date(t.start.date()).hour(this.calendar.endHour+1).minute(0),this.nextDaySingleEvents[e][t.id+"_next"]={id:t.id+"_next",start:moment(t.start).add(1,"day").hour(this.calendar.startHour).minute(0),end:s}}))}getOwnerEvents(){if(this.ownerEvents=[],this.ownerMultiEvents=[],this.nextDaySingleEvents.ownerEvents=[],this.arrangeMultiEvents(),!this.calendar.ownerCalendarVisible)return this.setSingleEventsStyle();this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e.filter((e=>!e.isMulti)),this.ownerMultiEvents=e.filter((e=>e.isMulti)),this.generateNextDaySingleEvents("ownerEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getGroupwareEvents(){if(this.groupwareEvents=[],this.nextDaySingleEvents.groupwareEvents=[],this.groupwareMultiEvents=[],this.arrangeMultiEvents(),!this.groupwareVisible||this.calendar.isMobileView)return this.setSingleEventsStyle();this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.groupwareEvents=e.filter((e=>!e.isMulti)),this.groupwareMultiEvents=e.filter((e=>e.isMulti)),this.generateNextDaySingleEvents("groupwareEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getUserEvents(e){if(this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.nextDaySingleEvents.userEvents={},this.generateNextDaySingleEvents("userEvents"),this.userMultiEvents=this.userMultiEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.arrangeMultiEvents(),this.calendar.isMobileView||!e.visible)return this.setSingleEventsStyle();this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(e.forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.generateNextDaySingleEvents("userEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getUsersEvents(){if(this.userEvents=[],this.nextDaySingleEvents.userEvents={},this.userMultiEvents=[],this.arrangeMultiEvents(),this.calendar.isMobileView)return this.setSingleEventsStyle();this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e.forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.generateNextDaySingleEvents("userEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}onEventDrop(e){this.calendar.onEventDrop(e,this.dropTargets)}static#e=this.ɵfac=function(e){return new(e||CalendarSheetWeek)(u.rXU(m.B),u.rXU(u.gRc),u.rXU(u.sFG),u.rXU(g.L),u.rXU(q._),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetWeek,selectors:[["calendar-sheet-week"]],viewQuery:function(e,t){if(1&e&&(u.GBs($e,7,u.c1b),u.GBs(Me,7,u.c1b),u.GBs(z,5)),2&e){let e;u.mGM(e=u.lsd())&&(t.sheetContainer=e.first),u.mGM(e=u.lsd())&&(t.scrollContainer=e.first),u.mGM(e=u.lsd())&&(t.dropTargets=e)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.OA$],decls:21,vars:21,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%","width","100%"],["sheetContainer",""],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center"],[1,"slds-border--right","slds-grow"],[1,"slds-grid"],["class","slds-border--left",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-is-relative"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid",2,"box-shadow","0 2px var(--color-grey-7)"],["class","slds-border--left",3,"ngStyle","min-height",4,"ngFor","ngForOf","ngForTrackBy"],["aria-hidden","true",1,"slds-scrollable--y",2,"overflow","scroll","visibility","hidden","flex","none"],["scrollContainer",""],[1,"slds-scrollable--y","slds-is-relative","slds-grow","calendar-event-drag-boundary",2,"overflow-y","scroll"],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--left",3,"ngStyle"],[1,"slds-p-top--xx-small"],[1,"slds-text-body--regular","slds-p-left--x-small"],[1,"slds-p-left--x-small","slds-p-bottom--xx-small","slds-border--bottom","slds-text-heading--large"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"click"],[1,"spice-calendar-event",3,"event","ngStyle"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[3,"height",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow","slds-grid"],["class","slds-border--right",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--right",3,"ngStyle"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"day","hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop",4,"ngIf"]],template:function(e,t){1&e&&(u.j41(0,"div",0,1)(2,"div",2)(3,"div",3),u.EFF(4),u.k0s(),u.j41(5,"div",4)(6,"div",5),u.DNE(7,Te,7,5,"div",6),u.k0s(),u.j41(8,"div",7),u.DNE(9,Be,2,2,"ng-container",8)(10,je,2,2,"ng-container",8)(11,Ve,3,2,"ng-container",8),u.k0s(),u.j41(12,"div",9),u.DNE(13,Xe,2,5,"div",10),u.k0s()(),u.nrm(14,"div",11,12),u.k0s(),u.j41(16,"div",13),u.DNE(17,Oe,6,9,"div",14)(18,Ne,3,3,"ng-container",8)(19,Le,3,3,"ng-container",8)(20,Je,5,4,"ng-container",8),u.k0s()()),2&e&&(u.R7$(3),u.xc7("width",t.calendar.sheetTimeWidth,"px"),u.R7$(),u.SpI(" ",t.offset," "),u.R7$(3),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.R7$(2),u.Y8G("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(2),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.R7$(4),u.Y8G("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.R7$(),u.Y8G("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.Sq,n.bT,n.B3,he,me,z,pe],encapsulation:2,changeDetection:0})}return CalendarSheetWeek})();function Qe(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",15)(1,"div",16)(2,"div",17),u.EFF(3),u.k0s(),u.j41(4,"div",17)(5,"a",18),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.gotoDay(t.date))})),u.EFF(6),u.k0s()()()()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("color",e.color),u.Y8G("ngClass",s.dayTextContainerClass),u.R7$(),u.Y8G("ngClass",s.dayTextClass),u.R7$(),u.SpI(" ",s.calendar.weekdayShort(e.day)," "),u.R7$(),u.Y8G("ngClass",s.dateTextClass),u.R7$(2),u.SpI(" ",e.dateTextDayNumber," ")}}function Ze(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",19),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function et(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",19),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("event",e)("ngStyle",e.style)}}function tt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",19),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function st(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function nt(e,t){if(1&e&&(u.qex(0),u.DNE(1,tt,1,2,"calendar-sheet-google-event",20)(2,st,1,2,"calendar-sheet-microsoft-event",20),u.bVm()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type)}}function it(e,t){if(1&e&&u.nrm(0,"div"),2&e){const e=u.XpG(2);u.xc7("height",e.calendar.multiEventHeight,"px")}}function rt(e,t){if(1&e&&(u.j41(0,"div",15),u.DNE(1,it,1,2,"div",21),u.k0s()),2&e){const e=t.$implicit,s=u.XpG();u.xc7("min-height",s.calendar.multiEventHeight,"px"),u.R7$(),u.Y8G("ngForOf",e.events)("ngForTrackBy",s.trackByItemFn)}}function at(e,t){if(1&e&&(u.j41(0,"div",25)(1,"div",26),u.nrm(2,"calendar-sheet-drop-target",27)(3,"calendar-sheet-drop-target",27),u.k0s(),u.j41(4,"div",28),u.nrm(5,"calendar-sheet-drop-target",27)(6,"calendar-sheet-drop-target",27),u.k0s()()),2&e){const e=t.$implicit,s=u.XpG().$implicit;u.R7$(2),u.Y8G("day",e)("hour",s)("hourPart",0),u.R7$(),u.Y8G("day",e)("hour",s)("hourPart",1),u.R7$(2),u.Y8G("day",e)("hour",s)("hourPart",2),u.R7$(),u.Y8G("day",e)("hour",s)("hourPart",3)}}function ot(e,t){if(1&e&&(u.j41(0,"div",5)(1,"div")(2,"div",22),u.EFF(3),u.k0s()(),u.j41(4,"div",23),u.DNE(5,at,7,12,"div",24),u.k0s()()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.xc7("width",s.calendar.sheetTimeWidth,"px"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(),u.SpI("",e,":00"),u.R7$(),u.xc7("height",s.calendar.sheetHourHeight,"px"),u.R7$(),u.Y8G("ngForOf",s.sheetDays)("ngForTrackBy",s.trackByIndexFn)}}function lt(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-sheet-event",29),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG(2);return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.onEventDrop(t))})),u.k0s()}if(2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.ownerEvents[e.id].style)}}function dt(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",29),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.DNE(2,lt,1,2,"calendar-sheet-event",30),u.bVm()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("event",e)("ngStyle",e.style),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.ownerEvents[e.id])}}function ct(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-sheet-event",29),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG(2);return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.onEventDrop(t))})),u.k0s()}if(2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.userEvents[e.id].style)}}function ht(e,t){if(1&e){const e=u.RV6();u.qex(0),u.j41(1,"calendar-sheet-event",29),u.bIt("eventChange",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.onEventDrop(t))})),u.k0s(),u.DNE(2,ct,1,2,"calendar-sheet-event",30),u.bVm()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("event",e)("ngStyle",e.style),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.userEvents[e.id])}}function ut(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",19),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function mt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",19),2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id].style)}}function gt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)("ngStyle",e.style)}}function pt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.XpG().$implicit,t=u.XpG();u.Y8G("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id].style)}}function ft(e,t){if(1&e&&(u.qex(0),u.DNE(1,ut,1,2,"calendar-sheet-google-event",20)(2,mt,1,2,"calendar-sheet-google-event",20)(3,gt,1,2,"calendar-sheet-microsoft-event",20)(4,pt,1,2,"calendar-sheet-microsoft-event",20),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.groupwareEvents[e.id]&&"google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type),u.R7$(),u.Y8G("ngIf",s.nextDaySingleEvents.groupwareEvents[e.id]&&"microsoft"==e.type)}}let vt=(()=>{class CalendarSheetThreeDays extends Ke{constructor(){super(...arguments),this.dayTextContainerClass="",this.dayTextClass="slds-text-body--regular",this.dateTextClass="slds-text-heading--large"}get startDate(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(moment.duration(2,"d")).hour(this.calendar.endHour)}ngOnInit(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")}buildSheetDays(){this.sheetDays=[];let e=0;for(;e<3;){let t=new moment(this.setdate);t=t.add(e,"days"),this.sheetDays.push({index:e,date:moment(t),day:moment(t).day(),color:this.isToday(moment(t))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(t).format("ddd"),dateTextDayNumber:moment(t).format("D"),items:[]}),e++}}setSingleEventStyle(e){const t=this.sheetDays.find((t=>t.day==e.start.day()))||0,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),i=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.sheetContainer.element.nativeElement.clientWidth-i,a=(r-this.sheetTimeWidth)/3/(e.maxOverlay>0?e.maxOverlay:1),o=this.sheetTimeWidth+(r-this.sheetTimeWidth)/3*t.index+a*e.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);e.style={left:o+"px",width:a+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}}setMultiEventStyle(e){let t=null;const s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-s-this.sheetTimeWidth)/3,i=moment(moment(this.setdate).hour(0).format("YYYY-MM-DD HH:00:00")),r=moment(moment(i).add(moment.duration(3,"d")).hour(this.calendar.endHour)),a=e.start.isBefore(i)?i:e.start,o=e.end.isAfter(r)?r:e.end,l=+e.start.diff(i,"days")>0?+e.start.diff(i,"days"):0,d=l*n,c=3-l,h=Math.abs(o.diff(a,"days"))+(o.hour()>a.hour()||o.minute()>a.minute()?1:0),u=(h>c?c:h)*n;this.sheetDays.some((s=>{if(s.events.indexOf(e)>-1)return t=s.events.indexOf(e),!0})),e.style={width:u+"px",left:d+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*t+"px"}}displayDate(e,t){switch(e){case"day":return t.format("ddd");case"date":return t.format(this.calendar.isDashlet?"D, MMM":"D")}}static#e=this.ɵfac=(()=>{let e;return function(t){return(e||(e=u.xGo(CalendarSheetThreeDays)))(t||CalendarSheetThreeDays)}})();static#t=this.ɵcmp=u.VBU({type:CalendarSheetThreeDays,selectors:[["calendar-sheet-three-days"]],features:[u.Vt3],decls:21,vars:21,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%","width","100%"],["sheetContainer",""],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center"],[1,"slds-border--right","slds-grow"],[1,"slds-grid"],["class","slds-border--left","style","width: calc(100% / 3)",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-is-relative"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid",2,"box-shadow","0 2px var(--color-grey-7)"],["style","width: calc(100% / 3)","class","slds-border--left",3,"min-height",4,"ngFor","ngForOf","ngForTrackBy"],["aria-hidden","true",1,"spice-scrollbar",2,"overflow","scroll","visibility","hidden","flex","none"],["scrollContainer",""],[1,"slds-scrollable","spice-scrollbar","slds-is-relative","slds-grow","calendar-event-drag-boundary",2,"overflow-y","scroll"],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--left",2,"width","calc(100% / 3)"],[1,"slds-p-vertical--xx-small","slds-border--bottom",3,"ngClass"],[1,"slds-p-left--x-small","slds-truncate",3,"ngClass"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"click"],[1,"spice-calendar-event",3,"event","ngStyle"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[3,"height",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow","slds-grid"],["class","slds-border--right","style","width: calc(100% / 3)",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--right",2,"width","calc(100% / 3)"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"day","hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop",4,"ngIf"]],template:function(e,t){1&e&&(u.j41(0,"div",0,1)(2,"div",2)(3,"div",3),u.EFF(4),u.k0s(),u.j41(5,"div",4)(6,"div",5),u.DNE(7,Qe,7,7,"div",6),u.k0s(),u.j41(8,"div",7),u.DNE(9,Ze,2,2,"ng-container",8)(10,et,2,2,"ng-container",8)(11,nt,3,2,"ng-container",8),u.k0s(),u.j41(12,"div",9),u.DNE(13,rt,2,4,"div",10),u.k0s()(),u.nrm(14,"div",11,12),u.k0s(),u.j41(16,"div",13),u.DNE(17,ot,6,9,"div",14)(18,dt,3,3,"ng-container",8)(19,ht,3,3,"ng-container",8)(20,ft,5,4,"ng-container",8),u.k0s()()),2&e&&(u.R7$(3),u.xc7("width",t.calendar.sheetTimeWidth,"px"),u.R7$(),u.SpI(" ",t.offset," "),u.R7$(3),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.R7$(2),u.Y8G("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(2),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.R7$(4),u.Y8G("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.R7$(),u.Y8G("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.R7$(),u.Y8G("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.YU,n.Sq,n.bT,n.B3,he,me,z,pe],encapsulation:2,changeDetection:0})}return CalendarSheetThreeDays})(),yt=(()=>{class CalendarMoreButton{constructor(e,t,s,n,i){this.elementRef=e,this.language=t,this.footer=s,this.injector=n,this.metadata=i,this.events=[],this.isMobileView=!1,this.sheetDay={},this.popoverComponentRef=null,this.showPopoverTimeout={}}ngOnDestroy(){this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseOver(){this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}onMouseOut(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.metadata.addComponent("CalendarMorePopover",this.footer.modalcontainer,this.injector).subscribe((e=>{e.instance.events=this.events,e.instance.isMobileView=this.isMobileView,e.instance.sheetDay=this.sheetDay,e.instance.parentElementRef=this.elementRef,this.popoverComponentRef=e.instance}))}static#e=this.ɵfac=function(e){return new(e||CalendarMoreButton)(u.rXU(u.aKT),u.rXU(m.B),u.rXU(ue.q),u.rXU(u.zZn),u.rXU(G.yu))};static#t=this.ɵcmp=u.VBU({type:CalendarMoreButton,selectors:[["calendar-more-button"]],hostBindings:function(e,t){1&e&&u.bIt("mouseenter",(function(){return t.onMouseOver()}))("mouseleave",(function(){return t.onMouseOut()}))},inputs:{events:[u.Mj6.None,"moreevents","events"],isMobileView:[u.Mj6.None,"ismobileview","isMobileView"],sheetDay:[u.Mj6.None,"sheetday","sheetDay"]},decls:2,vars:0,consts:[[2,"cursor","pointer"],["label","LBL_MORE"]],template:function(e,t){1&e&&(u.j41(0,"span",0),u.nrm(1,"system-label",1),u.k0s())},dependencies:[T.W],encapsulation:2})}return CalendarMoreButton})();const bt=["sheetContainer"];function wt(e,t){if(1&e&&(u.j41(0,"div",8),u.EFF(1),u.k0s()),2&e){const e=t.$implicit,s=u.XpG();u.Y8G("ngStyle",s.getDayColStyle(e.text)),u.R7$(),u.SpI("",s.calendar.weekdayShort(e.day)," ")}}function Et(e,t){if(1&e&&u.nrm(0,"calendar-more-button",16),2&e){const e=u.XpG().$implicit,t=u.XpG(2);u.Y8G("sheetday",e)("moreevents",e.events)("ismobileview",t.calendar.isMobileView)}}function Dt(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",11),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG(2);return u.Njj(s.openAddModal(t.date))})),u.j41(1,"div",12)(2,"a",13),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG(2);return u.Njj(s.gotoDay(t))})),u.EFF(3),u.k0s()(),u.j41(4,"div",14),u.DNE(5,Et,1,3,"calendar-more-button",15),u.k0s()()}if(2&e){const e=t.$implicit,s=t.index,n=u.XpG().index,i=u.XpG();u.Y8G("ngStyle",i.getDayStyle(n,s,e.month)),u.R7$(),u.xc7("height",i.offsetHeight,"px"),u.R7$(),u.Y8G("ngStyle",i.isTodayStyle(e.day,e.month)),u.R7$(),u.JRh(e.day),u.R7$(),u.xc7("height",i.offsetHeight,"px"),u.R7$(),u.Y8G("ngIf",e.events.length>0&&e.events.length>i.maxEventsPerDay)}}function kt(e,t){if(1&e&&u.nrm(0,"div",17),2&e){const e=u.XpG().index,t=u.XpG();u.Y8G("ngStyle",t.getWeekDividerStyle(e+1))}}function Ct(e,t){if(1&e&&(u.qex(0),u.DNE(1,Dt,6,8,"div",9)(2,kt,1,1,"div",10),u.bVm()),2&e){const e=t.$implicit,s=t.last,n=u.XpG();u.R7$(),u.Y8G("ngForOf",e)("ngForTrackBy",n.trackByFnDate),u.R7$(),u.Y8G("ngIf",!s)}}function xt(e,t){if(1&e&&(u.qex(0),u.nrm(1,"div",18),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngStyle",s.getDayDividerStyle(e.index))}}function Gt(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",19),u.bVm()),2&e){const e=t.$implicit,s=u.XpG().$implicit;u.R7$(),u.Y8G("event",s)("ngStyle",s.existsInRanges[e.key].style)}}function St(e,t){if(1&e&&(u.qex(0),u.DNE(1,Gt,2,2,"ng-container",7),u.nI1(2,"keyvalue"),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngForOf",u.bMT(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}function Rt(e,t){if(1&e&&(u.qex(0),u.nrm(1,"calendar-sheet-event",19),u.bVm()),2&e){const e=t.$implicit,s=u.XpG().$implicit;u.R7$(),u.Y8G("event",s)("ngStyle",s.existsInRanges[e.key].style)}}function _t(e,t){if(1&e&&(u.qex(0),u.DNE(1,Rt,2,2,"ng-container",7),u.nI1(2,"keyvalue"),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngForOf",u.bMT(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}function $t(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",19),2&e){const e=u.XpG().$implicit,t=u.XpG().$implicit;u.Y8G("event",t)("ngStyle",t.existsInRanges[e.key].style)}}function Mt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.XpG().$implicit,t=u.XpG().$implicit;u.Y8G("event",t)("ngStyle",t.existsInRanges[e.key].style)}}function Tt(e,t){if(1&e&&(u.qex(0),u.DNE(1,$t,1,2,"calendar-sheet-google-event",20)(2,Mt,1,2,"calendar-sheet-microsoft-event",20),u.bVm()),2&e){const e=u.XpG().$implicit;u.R7$(),u.Y8G("ngIf","google"==e.type),u.R7$(),u.Y8G("ngIf","microsoft"==e.type)}}function Bt(e,t){if(1&e&&(u.qex(0),u.DNE(1,Tt,3,2,"ng-container",7),u.nI1(2,"keyvalue"),u.bVm()),2&e){const e=t.$implicit,s=u.XpG();u.R7$(),u.Y8G("ngForOf",u.bMT(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}let jt=(()=>{class CalendarSheetMonth{constructor(e,t,s,n,i,r,a,o,l){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=i,this.renderer=r,this.navigationTab=a,this.cdRef=o,this.calendar=l,this.sheetDays=[],this.setdate={},this.groupwareVisible=!0,this.monthGrid=[],this.weeksIndices={},this.daysIndices={},this.offsetHeight=20,this.ownerEvents=[],this.userEvents=[],this.groupwareEvents=[],this.subscription=new v.yU,this.maxEventsPerDay=1,this.buildSheetDays(),this.subscribeToChanges()}get allEvents(){return this.ownerEvents.concat(this.userEvents,this.groupwareEvents)}get eventHeight(){return this.calendar.isMobileView?20:25}setMaxEventsPerDay(){const e=this.sheetContainer?this.sheetContainer.element.nativeElement.clientHeight/5:void 0;this.maxEventsPerDay=e?Math.floor((e-2*this.offsetHeight)/this.eventHeight):1,this.cdRef.detectChanges()}get startDate(){return new moment(this.setdate).date(1).hour(0).minute(0).second(0)}get endDate(){return new moment(this.startDate).endOf("month")}ngAfterViewInit(){this.setMaxEventsPerDay()}ngOnChanges(e){this.buildGrid(),this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.cdRef.detach(),this.subscription.unsubscribe()}subscribeToChanges(){this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>{this.setMaxEventsPerDay(),this.setEventsStyle()})),this.subscription.add(this.navigation.activeTab$.subscribe((e=>{this.navigationTab.objecttab.id==e&&_e.$.schedule((()=>{this.setMaxEventsPerDay(),this.setEventsStyle()}),100)})))}trackByFn(e,t){return t.id}trackByFnDate(e,t){return e}buildSheetDays(){this.sheetDays=[];let e=0,t=this.calendar.weekStartDay,s=moment.weekdaysShort();for(;e<this.calendar.weekDaysCount;)this.sheetDays.push({index:e,text:s[t],day:t}),e++,t++,t>6&&(t=0)}getOwnerEvents(){this.ownerEvents=[],this.handleEventsChanges(),this.calendar.ownerCalendarVisible&&this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e,this.handleEventsChanges())}))}getGroupwareEvents(){this.groupwareEvents=[],this.handleEventsChanges(),this.groupwareVisible&&!this.calendar.isMobileView&&this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.groupwareEvents=e,this.handleEventsChanges())}))}getUserEvents(e){this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.handleEventsChanges(),!this.calendar.isMobileView&&e.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.handleEventsChanges())}))}getUsersEvents(){this.userEvents=[],this.handleEventsChanges(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.handleEventsChanges())}))}handleEventsChanges(){this.monthGrid.forEach((e=>e.forEach((e=>{e.events=[]})))),this.spreadEvents(),this.setEventsStyle()}spreadEvents(){this.allEvents.sort(((e,t)=>e.start.isBefore(t.start)?-1:1)).sort(((e,t)=>e.end.diff(e.start,"day")>t.end.diff(t.start,"day")&&e.start.isSameOrBefore(t.start,"day")?-1:1)).forEach((e=>{if(delete e.sequence,e.existsInRanges={},e.isMulti)this.spreadEventIntoRanges(e);else{const t=this.monthGrid[this.weeksIndices[e.start.week()]][this.daysIndices[`${e.start.month()}${e.start.date()}`]];if(!t)return;e.existsInRanges[t.date.week()]={from:t.date.format(),to:t.date.format()},e.sequence=t.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1,t.events.push(e)}})),this.cdRef.detectChanges()}getDaysDiff(e,t,s){let n=Math.ceil(t.diff(e,"day",!0).toFixed(1));return!s&&n>0&&0==t.hour()&&0==t.minute()&&n--,n}spreadEventIntoRanges(e){const t=this.getDaysDiff(e.start,e.end,e.isAllDay);Array.from({length:t+1},((t,s)=>moment(e.start).add(s,"days"))).forEach((s=>{const n=this.monthGrid[this.weeksIndices[s.week()]][this.daysIndices[`${s.month()}${s.date()}`]];if(!n)return;const i=this.monthGrid[this.weeksIndices[n.date.week()]][this.monthGrid[this.weeksIndices[n.date.week()]].length-1].date;e.existsInRanges[n.date.week()]?!e.existsInRanges[n.date.week()].to&&e.end.isBefore(i)?e.existsInRanges[n.date.week()].to=e.end.format():e.existsInRanges[n.date.week()].to||(e.existsInRanges[n.date.week()].to=i.format()):(e.existsInRanges[n.date.week()]={from:n.date.format()},n.date.isSame(i,"days")&&(e.existsInRanges[n.date.week()].to=i.format()),(n.date.isSame(e.end,"days")||0==t)&&(e.existsInRanges[n.date.week()].to=n.date.format())),isNaN(e.sequence)&&(e.sequence=n.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1),n.events.push(e)}))}gotoDay(e){let t=moment(this.setdate);t.month(e.month).date(e.day),this.calendar.gotToDayView(t)}getDayColStyle(e){let t=new moment,s=t.format("ddd"),n=this.calendar.calendarDate,i=n.year()==t.year()&&n.month()==t.month()&&s==e;return{width:`calc(100% / ${this.calendar.weekDaysCount})`,color:i?this.calendar.todayColor:"inherit","font-weight":i?"600":"inherit"}}getDayDividerStyle(e){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*e+"px",top:"0px",height:"100%"}}buildGrid(){this.monthGrid=[],this.weeksIndices={},this.daysIndices={};const e=moment(this.setdate.format()).date(1).day(this.calendar.weekStartDay).format();this.monthGrid=Array.from({length:5},((t,s)=>moment(moment(e).add(s,"weeks")))).map((e=>Array.from({length:this.calendar.weekDaysCount},((t,s)=>{const n=moment(moment(e).day(this.calendar.weekStartDay+s).format());return{date:n,day:n.date(),month:n.month(),events:[]}})))),this.monthGrid.forEach(((e,t)=>{e.forEach(((e,t)=>{this.daysIndices[`${e.month}${e.day}`]||(this.daysIndices[`${e.month}${e.day}`]=t)})),this.weeksIndices[e[0].date.week()]=t}))}notThisMonth(e){return e!==this.setdate.month()}getWeekDividerStyle(e){return{top:"calc((100% / "+this.monthGrid.length+") * "+e+" )"}}getDayStyle(e,t,s){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*t+"px",top:`calc((100% / ${this.monthGrid.length}) * ${e})`,color:this.notThisMonth(s)?"#9faab5":"inherit","background-color":this.notThisMonth(s)?"#f4f6f9":"transparent",width:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount+"px",height:"calc(100% / "+this.monthGrid.length+")","min-height":"70px"}}setEventsStyle(){this.allEvents.forEach((e=>{Object.keys(e.existsInRanges).forEach((t=>e.existsInRanges[t].style=this.getEventStyle(e,e.existsInRanges[t],t)))})),this.cdRef.detectChanges()}getEventStyle(e,t,s){const n=e.sequence-1;if(n>=this.maxEventsPerDay)return{display:"none"};const i=moment(t.from),r=this.getDaysDiff(i,moment(t.to),e.isAllDay)+1,a=this.sheetContainer.element.nativeElement;return{left:a.clientWidth/this.calendar.weekDaysCount*this.daysIndices[`${i.month()}${i.date()}`]+"px",width:a.clientWidth/this.calendar.weekDaysCount*r+"px",top:this.offsetHeight+a.clientHeight/this.monthGrid.length*this.weeksIndices[s]+this.eventHeight*n+"px",height:this.eventHeight+"px",display:"block"}}isTodayStyle(e,t){let s=this.calendar.calendarDate.year(),n=new moment,i=s===n.year()&&n.month()===t&&n.date()==e;return{"border-radius":"50%","line-height":"1rem","text-align":"center",width:"1.1rem",height:"1.1rem",display:"block",color:i?"#fff":"inherit","background-color":i?this.calendar.todayColor:"inherit"}}openAddModal(e){this.calendar.addingEvent$.emit(e)}static#e=this.ɵfac=function(e){return new(e||CalendarSheetMonth)(u.rXU(m.B),u.rXU(C.m),u.rXU(g.L),u.rXU(u.aKT),u.rXU(D.H),u.rXU(u.sFG),u.rXU(q._),u.rXU(u.gRc),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetMonth,selectors:[["calendar-sheet-month"]],viewQuery:function(e,t){if(1&e&&u.GBs(bt,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.sheetContainer=e.first)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.OA$],decls:12,vars:12,consts:[[1,"slds-grid","slds-grid_vertical",2,"height","100%"],[1,"slds-border--bottom"],[1,"slds-grid"],["class","slds-text-align--center slds-p-vertical--small slds-border--left",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-scrollable","slds-grow"],[1,"slds-p-vertical--medium","slds-is-relative","slds-height_full",2,"min-height","375px"],["sheetContainer",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-p-vertical--small","slds-border--left",3,"ngStyle"],["class","slds-is-absolute slds-truncate",3,"ngStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-is-absolute slds-border--bottom slds-size--1-of-1",3,"ngStyle",4,"ngIf"],[1,"slds-is-absolute","slds-truncate",3,"ngStyle","click"],[1,"slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"ngStyle","click"],[1,"slds-grid","slds-grid--align-center","slds-is-absolute",2,"bottom","0","width","100%"],[3,"sheetday","moreevents","ismobileview",4,"ngIf"],[3,"sheetday","moreevents","ismobileview"],[1,"slds-is-absolute","slds-border--bottom","slds-size--1-of-1",3,"ngStyle"],[1,"slds-is-absolute","slds-border--left",3,"ngStyle"],[1,"spice-calendar-event",2,"padding","1px 0",3,"event","ngStyle"],["style","padding: 1px 0","class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1)(2,"div",2),u.DNE(3,wt,2,2,"div",3),u.k0s()(),u.j41(4,"div",4)(5,"div",5,6),u.DNE(7,Ct,3,3,"ng-container",7)(8,xt,2,1,"ng-container",7)(9,St,3,4,"ng-container",7)(10,_t,3,4,"ng-container",7)(11,Bt,3,4,"ng-container",7),u.k0s()()()),2&e&&(u.R7$(3),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByFnDate),u.R7$(4),u.Y8G("ngForOf",t.monthGrid)("ngForTrackBy",t.trackByFnDate),u.R7$(),u.Y8G("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByFnDate),u.R7$(),u.Y8G("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByFn),u.R7$(),u.Y8G("ngForOf",t.userEvents)("ngForTrackBy",t.trackByFn),u.R7$(),u.Y8G("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByFn))},dependencies:[n.Sq,n.bT,n.B3,he,me,yt,pe,n.lG],encapsulation:2,changeDetection:0})}return CalendarSheetMonth})();function Ft(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)}}function Yt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)}}function Vt(e,t){if(1&e&&u.nrm(0,"calendar-sheet-event",20),2&e){const e=u.XpG().$implicit;u.Y8G("event",e)}}function It(e,t){if(1&e&&(u.j41(0,"div",13)(1,"div",14),u.nrm(2,"system-button-icon",15),u.k0s(),u.j41(3,"div",16),u.EFF(4),u.k0s(),u.j41(5,"div",17),u.DNE(6,Ft,1,1,"calendar-sheet-google-event",18)(7,Yt,1,1,"calendar-sheet-microsoft-event",18)(8,Vt,1,1,"calendar-sheet-event",19),u.k0s()()),2&e){const e=t.$implicit,s=t.last;u.AVh("slds-border--bottom",!s),u.R7$(),u.xc7("color",e.color),u.R7$(2),u.Y8G("title",e.timeText),u.R7$(),u.SpI(" ",e.timeText," "),u.R7$(),u.Y8G("ngSwitch",e.type),u.R7$(),u.Y8G("ngSwitchCase","google"),u.R7$(),u.Y8G("ngSwitchCase","microsoft")}}function Xt(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",8)(1,"div",9)(2,"div"),u.EFF(3),u.k0s(),u.j41(4,"div")(5,"a",10),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.goToDay(t.date))})),u.EFF(6),u.k0s()()(),u.j41(7,"div",11),u.DNE(8,It,9,9,"div",12),u.k0s()()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(3),u.JRh(e.dayShortText),u.R7$(3),u.SpI(" ",e.dateText," "),u.R7$(2),u.Y8G("ngForOf",e.events)("ngForTrackBy",s.trackByFn)}}function Ut(e,t){1&e&&(u.j41(0,"div",21),u.nrm(1,"system-label",22),u.k0s())}let Ot=(()=>{class CalendarSheetSchedule{constructor(e,t,s,n,i,r,a,o){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=i,this.session=r,this.cdRef=a,this.calendar=o,this.untildate$=new u.bkB,this.eventDays=[],this.setdate={},this.groupwareVisible=!0,this.ownerEvents=[],this.userEvents=[],this.groupwareEvents=[],this.untilDate={},this.subscription=new v.yU,this.untilDate=(new moment).hour(0).minute(0).second(0).add(1,"M"),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)})))}get showNoRecordsMsg(){return 0==this.eventDays.length&&this.calendar.isDashlet}get startDate(){return new moment(this.setdate).hour(0).minute(0).second(0)}ngOnChanges(e){e.setdate&&(this.setUntilDate(),this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.subscription.unsubscribe()}setEventDays(){let e=this.groupByDay(this.ownerEvents.concat(this.userEvents,this.groupwareEvents));e.forEach((e=>e.events.sort(((e,t)=>e.start-t.start)))),this.eventDays=e.sort(((e,t)=>e.date-t.date)),this.cdRef.detectChanges()}trackByFn(e,t){return t.id}trackByFnDate(e,t){return e}setUntilDate(){this.untilDate=moment(this.setdate).add(1,"M"),this.untildate$.emit(this.untilDate)}groupByDay(e){let t=[],s=new moment(this.setdate).hour(0).minute(0).second(0);for(let n of e){let e=new moment(n.start).hour(0).minute(0).second(0),i=new moment(n.end).hour(0).minute(0).second(0);for(let r=moment(e);r.diff(i,"days")<=0;r.add(1,"days")){let e=s.year()==r.year()&&s.month()==r.month()&&s.date()==r.date();if(r.isAfter(s)||e){n.timeText=n.isMulti?"All Day":`${n.start.format("HH:mm")} - ${n.end.format("HH:mm")} `;let e={year:r.year(),month:r.month(),day:r.date(),date:moment(r),dateText:moment(r).format("MMM D, YYYY"),dayShortText:moment(r).format("ddd"),events:[n]},s=-1;t.some(((e,t)=>{if(e.year==r.year()&&e.month==r.month()&&e.day==r.date())return s=t,!0})),t.length>0&&s>-1?t[s].events.push({...n}):t.push(e)}}}return t}getOwnerEvents(){if(this.ownerEvents=[],this.setEventDays(),!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.untilDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e),this.setEventDays()}))}getGroupwareEvents(){this.groupwareEvents=[],this.groupwareVisible&&!this.calendar.isMobileView?this.calendar.loadGroupwareEvents(this.startDate,this.untilDate).subscribe((e=>{this.groupwareEvents=e,this.setEventDays()})):this.setEventDays()}getUserEvents(e){this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.setEventDays(),!this.calendar.isMobileView&&e.visible&&this.calendar.loadUserEvents(this.startDate,this.untilDate,e.id).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.setEventDays())}))}getUsersEvents(){this.userEvents=[],this.setEventDays(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.untilDate).subscribe((e=>{e.length>0&&(this.userEvents=e,this.setEventDays())}))}goToDay(e){this.calendar.gotToDayView(e)}loadMore(){this.untilDate=moment(this.untilDate).add(1,"M"),this.untildate$.emit(this.untilDate),this.getOwnerEvents(),this.getGroupwareEvents(),this.getUsersEvents()}static#e=this.ɵfac=function(e){return new(e||CalendarSheetSchedule)(u.rXU(m.B),u.rXU(C.m),u.rXU(g.L),u.rXU(u.aKT),u.rXU(D.H),u.rXU(k.d),u.rXU(u.gRc),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarSheetSchedule,selectors:[["calendar-sheet-schedule"]],inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},outputs:{untildate$:"untildate$"},features:[u.OA$],decls:9,vars:5,consts:[[1,"slds-scrollable--y",2,"height","100%"],["class","slds-grid slds-border--bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid","slds-p-around--small"],["label","MSG_SHOWING_EVENTS_UNTIL"],[1,"slds-m-left--xx-small"],[1,"slds-text-link","slds-m-left--xx-small",2,"cursor","pointer",3,"click"],["label","LBL_MORE"],["class","slds-align_absolute-center slds-m-top--medium",4,"ngIf"],[1,"slds-grid","slds-border--bottom"],[1,"slds-border--right","slds-p-around--xx-small","slds-size--1-of-4"],[1,"slds-text-link",2,"cursor","pointer",3,"click"],[1,"slds-size--3-of-4"],["class","slds-grid slds-p-horizontal--xx-small",3,"slds-border--bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid","slds-p-horizontal--xx-small"],[1,"slds-button","slds-button--icon","slds-m-right--x-small","slds-p-top--xxx-small",2,"height","100%"],["icon","user","size","small"],[1,"slds-truncate","slds-size--1-of-4",2,"height","100%",3,"title"],[1,"slds-grow",3,"ngSwitch"],["style","position: initial","class","spice-calendar-event",3,"event",4,"ngSwitchCase"],["style","position: initial","class","spice-calendar-event",3,"event",4,"ngSwitchDefault"],[1,"spice-calendar-event",2,"position","initial",3,"event"],[1,"slds-align_absolute-center","slds-m-top--medium"],["label","MSG_NO_RECORDS_FOUND"]],template:function(e,t){1&e&&(u.j41(0,"div",0),u.DNE(1,Xt,9,4,"div",1),u.j41(2,"div",2),u.nrm(3,"system-label",3),u.j41(4,"span",4),u.EFF(5),u.k0s(),u.j41(6,"a",5),u.bIt("click",(function(){return t.loadMore()})),u.nrm(7,"system-label",6),u.k0s()(),u.DNE(8,Ut,2,0,"div",7),u.k0s()),2&e&&(u.R7$(),u.Y8G("ngForOf",t.eventDays)("ngForTrackBy",t.trackByFnDate),u.R7$(4),u.Lme("",t.calendar.monthShort(t.untilDate.month()),"",t.untilDate.format("D, Y"),""),u.R7$(3),u.Y8G("ngIf",t.showNoRecordsMsg))},dependencies:[n.Sq,n.bT,n.ux,n.e1,n.fG,R.t,T.W,he,me,pe],encapsulation:2,changeDetection:0})}return CalendarSheetSchedule})();var Pt=s(72541),Nt=s(65029),Ht=s(90154);function Lt(e,t){if(1&e){const e=u.RV6();u.j41(0,"li",8)(1,"a",9),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.pickColor(t))})),u.j41(2,"span",10)(3,"span",11),u.EFF(4),u.k0s()()()()}if(2&e){const e=t.$implicit;u.R7$(2),u.xc7("background-color","#"+e),u.R7$(2),u.SpI("#",e,"")}}let At=(()=>{class CalendarColorPicker{constructor(e){this.calendar=e,this.colorChange=new u.bkB,this.isOpen=!1}pickColor(e){this.colorChange.emit("#"+e),this.isOpen=!1}static#e=this.ɵfac=function(e){return new(e||CalendarColorPicker)(u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarColorPicker,selectors:[["calendar-color-picker"]],outputs:{colorChange:"colorChange"},decls:8,vars:3,consts:[[1,"slds-dropdown-trigger","slds-dropdown-trigger_click","slds-m-right--x-small"],["aria-haspopup","true",1,"slds-button","slds-button--icon",3,"click"],["icon","palette","size","small"],[1,"slds-dropdown","slds-dropdown--right","slds-dropdown_bottom"],[1,"slds-color-picker","slds-color-picker_swatches-only"],[1,"slds-color-picker__selector"],["role","menu",1,"slds-color-picker__swatches"],["class","slds-color-picker__swatch","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-color-picker__swatch"],["role","menuitem",1,"slds-color-picker__swatch-trigger","slds-is-selected",3,"click"],[1,"slds-swatch"],[1,"slds-assistive-text"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"button",1),u.bIt("click",(function(){return t.isOpen=!t.isOpen})),u.nrm(2,"system-button-icon",2),u.k0s(),u.j41(3,"div",3)(4,"div",4)(5,"div",5)(6,"ul",6),u.DNE(7,Lt,5,3,"li",7),u.k0s()()()()()),2&e&&(u.AVh("slds-is-open",t.isOpen),u.R7$(7),u.Y8G("ngForOf",t.calendar.colorPalette))},dependencies:[n.Sq,R.t],encapsulation:2,changeDetection:0})}return CalendarColorPicker})();const zt=["inputcontainer"],Wt=()=>({"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}),qt=()=>({});function Jt(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",20),u.bIt("mouseenter",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.hovered="google")}))("mouseleave",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.hovered="")})),u.j41(1,"div",5),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.toggleVisible(null,"Google"))})),u.nrm(2,"img",21),u.j41(3,"a",8),u.nrm(4,"system-label",22),u.k0s()()()}if(2&e){const e=u.XpG();u.Y8G("ngClass","google"==e.hovered?"slds-theme--shade":""),u.R7$(2),u.Y8G("ngStyle",e.groupwareVisible?u.lJ4(5,qt):u.lJ4(4,Wt)),u.R7$(),u.xc7("color",e.groupwareVisible?e.calendar.groupwareColor:"#dddbda")}}function Kt(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",20),u.bIt("mouseenter",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.hovered="microsoft")}))("mouseleave",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.hovered="")})),u.j41(1,"div",5),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.toggleVisible(null,"Google"))})),u.nrm(2,"img",23),u.j41(3,"a",8),u.nrm(4,"system-label",24),u.k0s()()()}if(2&e){const e=u.XpG();u.Y8G("ngClass","microsoft"==e.hovered?"slds-theme--shade":""),u.R7$(2),u.Y8G("ngStyle",e.groupwareVisible?u.lJ4(5,qt):u.lJ4(4,Wt)),u.R7$(),u.xc7("color",e.groupwareVisible?e.calendar.groupwareColor:"#dddbda")}}function Qt(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-color-picker",28),u.bIt("colorChange",(function(t){u.eBV(e);const s=u.XpG().$implicit,n=u.XpG();return u.Njj(n.setUserColor(s.id,t))})),u.k0s()}}function Zt(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",4),u.bIt("mouseenter",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.hovered=t.id)}))("mouseleave",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.hovered="")})),u.j41(1,"div",5),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.toggleVisible(t.id,"Users"))})),u.j41(2,"div",6),u.nrm(3,"system-button-icon",7),u.k0s(),u.j41(4,"a",8),u.EFF(5),u.k0s()(),u.j41(6,"div"),u.DNE(7,Qt,1,0,"calendar-color-picker",25),u.j41(8,"button",26),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.removeUserCalendar(t.id))})),u.nrm(9,"system-button-icon",27),u.k0s()()()}if(2&e){const e=t.$implicit,s=u.XpG();u.AVh("slds-theme--shade",s.hovered==e.id),u.R7$(2),u.xc7("color",e.visible?e.color:"#dddbda"),u.R7$(2),u.xc7("color",e.visible?e.color:"#dddbda"),u.R7$(),u.JRh(e.name),u.R7$(2),u.Y8G("ngIf",s.hovered==e.id)}}function es(e,t){if(1&e&&(u.j41(0,"div",34),u.EFF(1),u.nrm(2,"system-label",35)(3,"system-label",36),u.k0s()),2&e){const e=u.XpG(2);u.R7$(),u.SpI(" ",e.resultsList.length," ")}}function ts(e,t){1&e&&(u.j41(0,"div",34),u.nrm(1,"system-label",37),u.k0s())}function ss(e,t){if(1&e){const e=u.RV6();u.j41(0,"li",39),u.bIt("mousedown",(function(){const t=u.eBV(e).$implicit,s=u.XpG(3);return u.Njj(s.addUserCalendar(t.id,t.summary_text))})),u.j41(1,"div",40),u.nrm(2,"system-icon",41),u.j41(3,"span",42),u.EFF(4),u.k0s()()()}if(2&e){const e=t.$implicit;u.R7$(4),u.JRh(e.summary_text)}}function ns(e,t){if(1&e&&(u.qex(0),u.DNE(1,ss,5,1,"li",38),u.bVm()),2&e){const e=u.XpG(2);u.R7$(),u.Y8G("ngForOf",e.resultsList)("ngForTrackBy",e.trackByFn)}}function is(e,t){if(1&e){const e=u.RV6();u.j41(0,"li",39),u.bIt("mousedown",(function(){const t=u.eBV(e).$implicit,s=u.XpG(3);return u.Njj(s.addUserCalendar(t.item_id,t.item_summary))})),u.j41(1,"div",40),u.nrm(2,"system-icon",41),u.j41(3,"span",42),u.EFF(4),u.k0s()()()}if(2&e){const e=t.$implicit;u.R7$(4),u.JRh(e.item_summary)}}function rs(e,t){if(1&e&&(u.qex(0),u.DNE(1,is,5,1,"li",38),u.bVm()),2&e){const e=u.XpG(2);u.R7$(),u.Y8G("ngForOf",e.recentUsers)("ngForTrackBy",e.trackByFn)}}function as(e,t){1&e&&u.nrm(0,"system-spinner",43),2&e&&u.Y8G("size",16)}function os(e,t){if(1&e&&(u.j41(0,"div",29),u.DNE(1,es,4,1,"div",30)(2,ts,2,0,"div",30),u.j41(3,"ul",31),u.DNE(4,ns,2,2,"ng-container",32)(5,rs,2,2,"ng-container",32),u.k0s(),u.DNE(6,as,1,1,"system-spinner",33),u.k0s()),2&e){const e=u.XpG();u.Y8G("ngStyle",e.lookupMenuStyle),u.R7$(),u.Y8G("ngIf",e.searchterm.length>0),u.R7$(),u.Y8G("ngIf",0==e.searchterm.length),u.R7$(2),u.Y8G("ngIf",e.searchterm.length>0),u.R7$(),u.Y8G("ngIf",0==e.searchterm.length),u.R7$(),u.Y8G("ngIf",e.isLoading&&0==e.resultsList.length)}}let ls=(()=>{class CalendarOtherCalendarsMonitor{constructor(e,t,s,n){this.language=e,this.recent=t,this.calendar=s,this.fts=n,this.usersCalendars=[],this.groupwareVisible$=new u.bkB,this.searchterm="",this.searchopen=!1,this.resultsList=[],this.recentUsers=[],this.timeout=void 0,this.isLoading=!1,this.hovered="",this.groupwareVisible=!0,this.getRecent()}get searchOpen(){return this.searchopen}set searchOpen(e){this.searchopen=e,e&&this.getRecent()}get lookupMenuStyle(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}}get searchTerm(){return this.searchterm}set searchTerm(e){window.clearTimeout(this.timeout),e&&0!=e.length&&(this.timeout=window.setTimeout((()=>{this.searchterm=e,this.isLoading=!0,this.fts.searchByModules({searchterm:this.searchterm,modules:["Users"],size:5,sortparams:{sortfield:"full_name",sortdirection:"asc"}}).subscribe((e=>{this.filterResultsList(e.Users.hits.map((e=>e._source))),this.isLoading=!1}),(e=>this.isLoading=!1))}),500))}getRecent(){this.recent.getModuleRecent("Users").subscribe((e=>this.filterRecent(e)))}filterRecent(e){this.recentUsers=e.filter((e=>e.item_id!=this.calendar.owner&&null==_.findWhere(this.calendar.usersCalendars,{id:e.item_id})))}filterResultsList(e){this.resultsList=e.filter((e=>e.id!=this.calendar.owner&&null==_.findWhere(this.calendar.usersCalendars,{id:e.id})))}trackByFn(e,t){return t.id}addUserCalendar(e,t){this.calendar.addUserCalendar(e,t),this.filterRecent(this.recentUsers),this.filterResultsList(this.resultsList)}removeUserCalendar(e){this.calendar.removeUserCalendar(e)}toggleVisible(e,t){switch(t){case"Owner":this.calendar.toggleOwnerCalendarVisible();break;case"Users":this.calendar.toggleUserCalendarVisibility(e);break;case"Google":this.groupwareVisible=!this.groupwareVisible,this.groupwareVisible$.emit(this.groupwareVisible)}}setUserColor(e,t){this.calendar.setUserColor(e,t)}static#e=this.ɵfac=function(e){return new(e||CalendarOtherCalendarsMonitor)(u.rXU(m.B),u.rXU(Pt._),u.rXU(S),u.rXU(Nt.s))};static#t=this.ɵcmp=u.VBU({type:CalendarOtherCalendarsMonitor,selectors:[["calendar-other-calendars-monitor"]],viewQuery:function(e,t){if(1&e&&u.GBs(zt,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.inputContainer=e.first)}},inputs:{usersCalendars:"usersCalendars"},outputs:{groupwareVisible$:"groupwareVisible$"},decls:21,vars:15,consts:[[1,"slds-border--bottom"],[1,"slds-form-element__label","slds-text-heading--small","slds-p-horizontal--small"],["label","LBL_OTHER_CALENDARS"],[1,"slds-p-vertical--xx-small"],[1,"slds-form-element","slds-grid","slds-grid--align-spread","slds-p-horizontal--small","slds-p-vertical--xxx-small",3,"mouseenter","mouseleave"],[1,"slds-grid",2,"cursor","pointer",3,"click"],[1,"slds-button","slds-button--icon","slds-m-right--xx-small","slds-p-top--xxx-small"],["icon","user","size","small"],[1,"slds-text-body--regular","slds-truncate"],["label","LBL_MY_CALENDAR"],["class","slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small",3,"ngClass","mouseenter","mouseleave",4,"ngIf"],["class","slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small",3,"slds-theme--shade","mouseenter","mouseleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-form-element__control","slds-p-around--x-small","slds-border--bottom","slds-theme--default",2,"height","52px"],[1,"slds-form-element","slds-lookup"],["inputcontainer",""],[1,"slds-form-element__control","slds-grid","slds-box--border","slds-m-vertical--xxx-small"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],[3,"icon","addclasses"],["type","search","role","combobox",1,"slds-lookup__search-input","slds-input--bare",3,"ngModel","system-placeholder","ngModelChange","focus","blur"],["class","slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none",3,"ngStyle",4,"ngIf"],[1,"slds-form-element","slds-grid","slds-grid--align-spread","slds-p-horizontal--small","slds-p-vertical--xxx-small",3,"ngClass","mouseenter","mouseleave"],["src","https://developers.google.com/identity/images/g-logo.png","alt","G",2,"height","13px","width","13px","margin-right","2px","margin-top","2px",3,"ngStyle"],["label","MY_GOOGLE_CALENDAR"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsSAAALEgHS3X78AAAAVElEQVQ4jWP8//8/A7UBC8i8z4HKBE3mXX+XsWE3I0F1Da7/GZmo7kwGBoZRQ0cNpTKgXY5iXPqBoMn/owUYGXYRzlEMbqM5atTQoWEo9XMUAwMDAGSOGCOVddy/AAAAAElFTkSuQmCC","alt","G",2,"height","13px","width","13px","margin-right","2px","margin-top","2px",3,"ngStyle"],["label","LBL_MY_MICROSOFT_CALENDAR"],[3,"colorChange",4,"ngIf"],[1,"slds-button","slds-button--icon",3,"click"],["icon","clear","size","small"],[3,"colorChange"],[1,"slds-lookup__menu","slds-size--1-of-4","slds-p-vertical--none",3,"ngStyle"],["class","slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom",4,"ngIf"],["role","listbox",1,"slds-lookup__list",2,"height","175px"],[4,"ngIf"],[3,"size",4,"ngIf"],[1,"slds-theme--shade","slds-p-around--xx-small","slds-text-body--small","slds-text-title--caps","slds-border--bottom"],["label","LBL_USERS"],["label","LBL_FOUND"],["label","LBL_RECENTLYVIEWED"],["role","presentation",3,"mousedown",4,"ngFor","ngForOf","ngForTrackBy"],["role","presentation",3,"mousedown"],["role","option",1,"slds-lookup__item-action","slds-media"],["icon","user","size","x-small","divClass","slds-p-around--xxx-small slds-m-right--xxx-small"],[1,"slds-lookup__result-text"],[3,"size"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"label",1),u.nrm(2,"system-label",2),u.k0s(),u.j41(3,"div",3)(4,"div",4),u.bIt("mouseenter",(function(){return t.hovered="own"}))("mouseleave",(function(){return t.hovered=""})),u.j41(5,"div",5),u.bIt("click",(function(){return t.toggleVisible(null,"Owner")})),u.j41(6,"div",6),u.nrm(7,"system-button-icon",7),u.k0s(),u.j41(8,"a",8),u.nrm(9,"system-label",9),u.k0s()()(),u.DNE(10,Jt,5,6,"div",10)(11,Kt,5,6,"div",10)(12,Zt,10,8,"div",11),u.k0s()(),u.j41(13,"div",12)(14,"div",13,14)(16,"div",15)(17,"div",16),u.nrm(18,"system-utility-icon",17),u.j41(19,"input",18),u.mxI("ngModelChange",(function(e){return u.DH7(t.searchTerm,e)||(t.searchTerm=e),e})),u.bIt("focus",(function(){return t.searchOpen=!0}))("blur",(function(){return t.searchOpen=!1})),u.k0s()()()(),u.DNE(20,os,7,6,"div",19),u.k0s()),2&e&&(u.R7$(4),u.AVh("slds-theme--shade","own"==t.hovered),u.R7$(2),u.xc7("color",t.calendar.ownerCalendarVisible?t.calendar.eventColor:"#dddbda"),u.R7$(2),u.xc7("color",t.calendar.ownerCalendarVisible?t.calendar.eventColor:"#dddbda"),u.R7$(2),u.Y8G("ngIf","google"==t.calendar.activeGroupware),u.R7$(),u.Y8G("ngIf","microsoft"==t.calendar.activeGroupware),u.R7$(),u.Y8G("ngForOf",t.usersCalendars)("ngForTrackBy",t.trackByFn),u.R7$(6),u.Y8G("icon","search")("addclasses","slds-input__icon"),u.R7$(),u.R50("ngModel",t.searchTerm),u.Y8G("system-placeholder",t.language.getLabel("LBL_ADD")+" "+t.language.getLabel("LBL_USER")+" "+t.language.getLabel("LBL_CALENDAR")),u.R7$(),u.Y8G("ngIf",t.searchopen))},dependencies:[n.YU,n.Sq,n.bT,n.B3,i.me,i.BC,i.vS,R.t,$.J,T.W,te.P,j.B,Ht.m,At],encapsulation:2,changeDetection:0})}return CalendarOtherCalendarsMonitor})();const ds=["calendarContainer"];function cs(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-other-calendars-monitor",13),u.bIt("groupwareVisible$",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.handleGoogleIsVisible(t))})),u.k0s()}if(2&e){const e=u.XpG(2);u.Y8G("usersCalendars",e.calendar.usersCalendars)}}function hs(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",10)(1,"system-input-date-picker",11),u.bIt("datePicked",(function(t){u.eBV(e);const s=u.XpG();return u.Njj(s.setDateChanged(t))})),u.k0s(),u.DNE(2,cs,1,1,"calendar-other-calendars-monitor",12),u.k0s()}if(2&e){const e=u.XpG();u.xc7("width",e.calendar.sidebarWidth,"px"),u.R7$(),u.Y8G("setDate",e.calendar.calendarDate)("dual",e.componentconfig.pickerDualMode)("showTodayButton",!1)("weekStartDay",e.calendar.weekStartDay),u.R7$(),u.Y8G("ngIf",e.calendar.userPreferencesLoaded)}}function us(e,t){if(1&e&&u.nrm(0,"calendar-sheet-day",16),2&e){const e=u.XpG(2);u.Y8G("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function ms(e,t){if(1&e&&u.nrm(0,"calendar-sheet-three-days",16),2&e){const e=u.XpG(2);u.Y8G("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function gs(e,t){if(1&e&&u.nrm(0,"calendar-sheet-week",16),2&e){const e=u.XpG(2);u.Y8G("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function ps(e,t){if(1&e&&u.nrm(0,"calendar-sheet-month",16),2&e){const e=u.XpG(2);u.Y8G("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function fs(e,t){if(1&e){const e=u.RV6();u.j41(0,"calendar-sheet-schedule",17),u.bIt("untildate$",(function(t){u.eBV(e);const s=u.XpG(2);return u.Njj(s.handleUntilDate(t))})),u.k0s()}if(2&e){const e=u.XpG(2);u.Y8G("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function vs(e,t){1&e&&(u.qex(0),u.DNE(1,us,1,2,"calendar-sheet-day",14)(2,ms,1,2,"calendar-sheet-three-days",14)(3,gs,1,2,"calendar-sheet-week",14)(4,ps,1,2,"calendar-sheet-month",14)(5,fs,1,2,"calendar-sheet-schedule",15),u.bVm()),2&e&&(u.R7$(),u.Y8G("ngSwitchCase","Day"),u.R7$(),u.Y8G("ngSwitchCase","Three_Days"),u.R7$(),u.Y8G("ngSwitchCase","Week"),u.R7$(),u.Y8G("ngSwitchCase","Month"),u.R7$(),u.Y8G("ngSwitchCase","Schedule"))}function ys(e,t){if(1&e){const e=u.RV6();u.j41(0,"footer",18)(1,"button",19),u.bIt("click",(function(){u.eBV(e);const t=u.XpG();return u.Njj(t.closeModal())})),u.nrm(2,"system-label",20),u.k0s()()}}let bs=(()=>{class Calendar{constructor(e,t,s,n,i,r,a,o,l,d){this.language=e,this.navigationTab=t,this.elementRef=s,this.renderer=n,this.modal=i,this.cdr=r,this.model=a,this.metadata=o,this.injector=l,this.calendar=d,this.componentconfig={},this.groupwareVisible=!0,this.subscriptions=new v.yU,this.xDown=null,this.mainContainerClass="slds-theme--default",this.yDown=null,this.self={},this.navigationTab.setTabInfo({displaymodule:"Calendar",displayname:this.metadata.getModuleDefs("Calendar").module_label})}get sidebarWidth(){return this.calendar.sidebarWidth}get sheetStyle(){return{width:`calc(100% - ${this.sidebarWidth}px)`,height:"100%"}}ngAfterViewInit(){this.calendar.asPicker&&(this.mainContainerClass="slds-modal slds-fade-in-open slds-modal_large"),this.touchStartListener=this.renderer.listen("document","touchstart",(e=>this.handleTouchStart(e))),this.handleMobileView(),this.subscriptions.add(this.calendar.addingEvent$.subscribe((e=>this.addEvent(e))))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.resizeListener&&this.resizeListener(),this.touchStartListener&&this.touchStartListener()}handleMobileView(){this.resizeListener=this.renderer.listen("window","resize",(()=>{this.calendar.setIsMobileView(this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)})),this.calendar.setIsMobileView(this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)}handleUntilDate(e){this.calendarHeader.scheduleUntilDate=e}setDateChanged(e){this.calendarHeader.toggleClosed(),this.calendar.refresh(e)}handleGoogleIsVisible(e){this.groupwareVisible=e}closeModal(){this.self.destroy()}handleTouchStart(e){const t=e.touches||e.originalEvent.touches;this.xDown=t[0].clientX,this.yDown=t[0].clientY,this.touchMoveListener=this.renderer.listen("document","touchmove",(e=>this.handleTouchMove(e)))}handleTouchMove(e){if(this.touchMoveListener(),!this.xDown||!this.yDown)return;let t=this.xDown-e.touches[0].clientX;Math.abs(t)>Math.abs(this.yDown-e.touches[0].clientY)&&(t<0?this.calendar.shiftMinus():this.calendar.shiftPlus()),this.xDown=null,this.yDown=null}addEvent(e){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((t=>{t.instance.module$.pipe((0,E.s)(1)).subscribe((t=>{if(t){this.model.module=t.name;let s={[t.dateStartFieldName]:e};if(t.dateEndFieldName){let n=moment(e).add(30,"m");s[t.dateEndFieldName]=n}"UserAbsences"==t.name&&(s.user_id=this.calendar.owner,s.user_name=this.calendar.ownerName),this.model.addModel("",null,s)}}))}))}static#e=this.ɵfac=function(e){return new(e||Calendar)(u.rXU(m.B),u.rXU(q._),u.rXU(u.aKT),u.rXU(u.sFG),u.rXU(x.y),u.rXU(u.gRc),u.rXU(W.g),u.rXU(G.yu),u.rXU(u.zZn),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:Calendar,selectors:[["calendar"]],viewQuery:function(e,t){if(1&e&&(u.GBs(ds,7,u.c1b),u.GBs(L,7)),2&e){let e;u.mGM(e=u.lsd())&&(t.calendarContainer=e.first),u.mGM(e=u.lsd())&&(t.calendarHeader=e.first)}},features:[u.Jv_([S,W.g])],decls:11,vars:14,consts:[[2,"height","100%",3,"ngClass","system-to-bottom-noscroll"],["calendarContainer",""],[2,"height","inherit"],[1,"slds-grid","slds-grid--vertical",2,"height","inherit"],[2,"display","block",3,"modules","datePicked"],[1,"slds-grid","slds-theme_default","slds-border--right","slds-grow",2,"min-height","100px"],["class","slds-border--right slds-p-around--xx-small slds-scrollable--y slds-size--1-of-1 slds-theme--default","style","height: 100%; z-index: 1",3,"width",4,"ngIf"],[3,"ngSwitch","system-overlay-loading-spinner","ngStyle"],[4,"ngIf"],["class","slds-modal__footer",4,"ngIf"],[1,"slds-border--right","slds-p-around--xx-small","slds-scrollable--y","slds-size--1-of-1","slds-theme--default",2,"height","100%","z-index","1"],[3,"setDate","dual","showTodayButton","weekStartDay","datePicked"],[3,"usersCalendars","groupwareVisible$",4,"ngIf"],[3,"usersCalendars","groupwareVisible$"],["style","display: block; height: inherit",3,"groupwareVisible","setdate",4,"ngSwitchCase"],["style","display: block; height: inherit",3,"groupwareVisible","setdate","untildate$",4,"ngSwitchCase"],[2,"display","block","height","inherit",3,"groupwareVisible","setdate"],[2,"display","block","height","inherit",3,"groupwareVisible","setdate","untildate$"],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CLOSE"]],template:function(e,t){1&e&&(u.j41(0,"div",0,1)(2,"div",2)(3,"div",3)(4,"calendar-header",4),u.bIt("datePicked",(function(e){return t.setDateChanged(e)})),u.k0s(),u.j41(5,"div",5),u.DNE(6,hs,3,7,"div",6),u.j41(7,"div",7),u.DNE(8,vs,6,5,"ng-container",8),u.k0s()(),u.j41(9,"div"),u.DNE(10,ys,3,0,"footer",9),u.k0s()()()()),2&e&&(u.AVh("slds-text-body--small",t.calendar.isMobileView),u.Y8G("ngClass",t.mainContainerClass)("system-to-bottom-noscroll",!t.calendar.asPicker),u.BMQ("role",t.calendar.asPicker?"dialog":"none"),u.R7$(2),u.AVh("slds-modal__container",t.calendar.asPicker),u.R7$(2),u.Y8G("modules",t.calendar.modules),u.R7$(2),u.Y8G("ngIf",!t.calendar.isMobileView),u.R7$(),u.Y8G("ngSwitch",t.calendar.sheetType)("system-overlay-loading-spinner",t.calendar.isLoading||!t.calendar.userPreferencesLoaded)("ngStyle",t.sheetStyle),u.R7$(),u.Y8G("ngIf",t.calendar.userPreferencesLoaded),u.R7$(2),u.Y8G("ngIf",t.calendar.asPicker))},dependencies:[n.YU,n.bT,n.B3,n.ux,n.e1,M.Q,T.W,J.p,K.M,L,Re,vt,Ke,jt,Ot,ls],encapsulation:2,changeDetection:0})}return Calendar})();const ws=["popoverContainer"];function Es(e,t){if(1&e&&u.nrm(0,"calendar-sheet-google-event",12),2&e){const e=u.XpG().$implicit,t=u.XpG();u.xc7("height",t.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function Ds(e,t){if(1&e&&u.nrm(0,"calendar-sheet-microsoft-event",12),2&e){const e=u.XpG().$implicit,t=u.XpG();u.xc7("height",t.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function ks(e,t){if(1&e&&u.nrm(0,"calendar-sheet-event",12),2&e){const e=u.XpG().$implicit,t=u.XpG();u.xc7("height",t.calendar.multiEventHeight,"px"),u.Y8G("event",e)}}function Cs(e,t){if(1&e&&(u.qex(0,9),u.DNE(1,Es,1,3,"calendar-sheet-google-event",10)(2,Ds,1,3,"calendar-sheet-microsoft-event",10)(3,ks,1,3,"calendar-sheet-event",11),u.bVm()),2&e){const e=t.$implicit;u.Y8G("ngSwitch",e.type),u.R7$(),u.Y8G("ngSwitchCase","google"),u.R7$(),u.Y8G("ngSwitchCase","microsoft")}}let xs=(()=>{class CalendarMorePopover{constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i,this.events=[],this.nubbinClass="",this.popoverStyle={},this.sheetDay={},this.isMobileView=!1,this.hidePopoverTimeout={}}get shortDate(){return this.calendar.calendarDate.month(this.sheetDay.month).date(this.sheetDay.day).format("D MMM,")}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}trackByFn(e,t){return t.id}onMouseOver(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseOut(e){this.closePopover(!0,e)}static#e=this.ɵfac=function(e){return new(e||CalendarMorePopover)(u.rXU(G.yu),u.rXU(S),u.rXU(m.B),u.rXU(u.sFG),u.rXU(u.gRc))};static#t=this.ɵcmp=u.VBU({type:CalendarMorePopover,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&u.GBs(ws,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.popoverContainer=e.first)}},decls:11,vars:6,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small"],["label","LBL_EVENTS"],[1,"slds-scrollable--y",2,"height","120px"],[3,"ngSwitch",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],["class","spice-calendar-more-event",3,"event","height",4,"ngSwitchCase"],["class","spice-calendar-more-event",3,"event","height",4,"ngSwitchDefault"],[1,"spice-calendar-more-event",3,"event"]],template:function(e,t){1&e&&(u.j41(0,"div",0),u.bIt("mouseenter",(function(){return t.onMouseOver()}))("mouseleave",(function(e){return t.onMouseOut(e)})),u.j41(1,"button",1),u.bIt("click",(function(){return t.closePopover(!0)})),u.nrm(2,"system-button-icon",2),u.k0s(),u.j41(3,"div",null,3)(5,"div",4)(6,"header",5),u.EFF(7),u.nrm(8,"system-label",6),u.k0s(),u.j41(9,"div",7),u.DNE(10,Cs,4,3,"ng-container",8),u.k0s()()()()),2&e&&(u.Y8G("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.R7$(7),u.Lme("",t.shortDate," ","("+t.events.length+")"," "),u.R7$(3),u.Y8G("ngForOf",t.events)("ngForTrackBy",t.trackByFn))},dependencies:[n.YU,n.Sq,n.B3,n.ux,n.e1,n.fG,R.t,T.W,he,me,pe],encapsulation:2,changeDetection:0})}return CalendarMorePopover})();var Gs=s(22465);const Ss=["popoverContainer"];let Rs=(()=>{class CalendarGoogleEventPopover{constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i,this.event={},this.nubbinClass="",this.popoverStyle={},this.isMobileView=!1,this.hidePopoverTimeout={}}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}onMouseEnter(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseLeave(e){this.closePopover(!0,e)}static#e=this.ɵfac=function(e){return new(e||CalendarGoogleEventPopover)(u.rXU(G.yu),u.rXU(S),u.rXU(m.B),u.rXU(u.sFG),u.rXU(u.gRc))};static#t=this.ɵcmp=u.VBU({type:CalendarGoogleEventPopover,selectors:[["calendar-google-event-popover"]],viewQuery:function(e,t){if(1&e&&u.GBs(Ss,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.popoverContainer=e.first)}},decls:17,vars:7,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small","slds-truncate","slds-has-divider--bottom-space",3,"system-title"],[1,"slds-scrollable--y",2,"height","120px"],[1,"slds-list_horizontal","slds-wrap","slds-text-body_small"],[1,"slds-item_label","slds-text-color_weak","slds-truncate","slds-m-bottom--x-small"],["label","LBL_DESCRIPTION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"innerHTML"],["label","LBL_LOCATION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"system-title"]],template:function(e,t){1&e&&(u.j41(0,"div",0),u.bIt("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(e){return t.onMouseLeave(e)})),u.j41(1,"button",1),u.bIt("click",(function(){return t.closePopover(!0)})),u.nrm(2,"system-button-icon",2),u.k0s(),u.j41(3,"div",null,3)(5,"div",4)(6,"header",5),u.EFF(7),u.k0s(),u.j41(8,"div",6)(9,"dl",7)(10,"dt",8),u.nrm(11,"system-label",9),u.k0s(),u.nrm(12,"dd",10),u.j41(13,"dt",8),u.nrm(14,"system-label",11),u.k0s(),u.j41(15,"dd",12),u.EFF(16),u.k0s()()()()()()),2&e&&(u.Y8G("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.R7$(6),u.Y8G("system-title",t.event.summary),u.R7$(),u.SpI(" ",t.event.summary," "),u.R7$(5),u.Y8G("innerHTML",t.event.description,u.npT),u.R7$(3),u.Y8G("system-title",t.event.location),u.R7$(),u.SpI(" ",t.event.location," "))},dependencies:[n.YU,n.B3,R.t,T.W,Gs.L],encapsulation:2,changeDetection:0})}return CalendarGoogleEventPopover})();var _s=s(40713),$s=s(25028),Ms=s(88418),Ts=s(83524);function Bs(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",8)(1,"a",9),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.save(t))})),u.nrm(2,"system-icon",10),u.j41(3,"div",11)(4,"h2",12),u.nrm(5,"system-label",13),u.k0s()()()()}if(2&e){const e=t.$implicit,s=u.XpG();u.R7$(2),u.Y8G("icon",s.getIcon(e.icon))("sprite",s.getSprite(e.icon)),u.R7$(3),u.Y8G("label",e.name)}}let js=(()=>{class CalendarAddCalendar{constructor(e,t){this.language=e,this.backend=t,this.calendars=[],this.addCalendar=new u.bkB,this.self={}}getIcon(e){return e&&e.split(":")[1]?e.split(":")[1]:e}getSprite(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"}close(){this.addCalendar.emit(!1),this.self.destroy()}save(e){this.addCalendar.emit(e),this.self.destroy()}trackByFn(e,t){return t.id}static#e=this.ɵfac=function(e){return new(e||CalendarAddCalendar)(u.rXU(m.B),u.rXU(D.H))};static#t=this.ɵcmp=u.VBU({type:CalendarAddCalendar,selectors:[["ng-component"]],decls:10,vars:2,consts:[["size","small"],[3,"close"],["label","LBL_ADD_CALENDAR"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"icon","sprite"],[1,"slds-media__body","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate"],[3,"label"]],template:function(e,t){1&e&&(u.j41(0,"system-modal",0)(1,"system-modal-header",1),u.bIt("close",(function(){return t.close()})),u.nrm(2,"system-label",2),u.k0s(),u.j41(3,"system-modal-content")(4,"div",3)(5,"div",4),u.DNE(6,Bs,6,3,"div",5),u.k0s()()(),u.j41(7,"system-modal-footer")(8,"button",6),u.bIt("click",(function(){return t.close()})),u.nrm(9,"system-label",7),u.k0s()()()),2&e&&(u.R7$(6),u.Y8G("ngForOf",t.calendars)("ngForTrackBy",t.trackByFn))},dependencies:[n.Sq,$.J,T.W,_s.D,$s.I,Ms.Q,Ts.C],encapsulation:2})}return CalendarAddCalendar})();function Fs(e,t){if(1&e){const e=u.RV6();u.j41(0,"div",8)(1,"a",9),u.bIt("click",(function(){const t=u.eBV(e).$implicit,s=u.XpG();return u.Njj(s.save(t))})),u.nrm(2,"system-icon",10),u.j41(3,"div",11)(4,"h2",12),u.nrm(5,"system-label-modulename",13),u.k0s()()()()}if(2&e){const e=t.$implicit;u.R7$(2),u.Y8G("module",e.name),u.R7$(3),u.Y8G("module",e.name)}}let Ys=(()=>{class CalendarAddModulesModal{constructor(e,t){this.language=e,this.calendar=t,this.module$=new u.bkB,this.self={}}close(){this.module$.emit(!1),this.self.destroy()}save(e){this.module$.emit(e),this.self.destroy()}trackByFn(e,t){return t.id}static#e=this.ɵfac=function(e){return new(e||CalendarAddModulesModal)(u.rXU(m.B),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarAddModulesModal,selectors:[["ng-component"]],decls:10,vars:2,consts:[["size","small"],[3,"close"],["label","LBL_MODULES"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"module"],[1,"slds-media__body","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate"],[3,"module"]],template:function(e,t){1&e&&(u.j41(0,"system-modal",0)(1,"system-modal-header",1),u.bIt("close",(function(){return t.close()})),u.nrm(2,"system-label",2),u.k0s(),u.j41(3,"system-modal-content")(4,"div",3)(5,"div",4),u.DNE(6,Fs,6,2,"div",5),u.k0s()()(),u.j41(7,"system-modal-footer")(8,"button",6),u.bIt("click",(function(){return t.close()})),u.nrm(9,"system-label",7),u.k0s()()()),2&e&&(u.R7$(6),u.Y8G("ngForOf",t.calendar.modules)("ngForTrackBy",t.trackByFn))},dependencies:[n.Sq,$.J,T.W,B.r,_s.D,$s.I,Ms.Q,Ts.C],encapsulation:2,changeDetection:0})}return CalendarAddModulesModal})();const Vs=["headercontainer"];let Is=(()=>{class CalendarScheduleDashlet{constructor(e,t,s,n,i){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=i,this.dashletconfig=null,this.scheduleUntilDate={},this.calendar.isDashlet=!0,this.calendar.sheetType="Schedule",this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:this.headerContainer?`calc(100% - ${this.headerContainer.element.nativeElement.offsetHeight}px)`:"100px",width:"100%"}}get title(){return new moment(this.calendarDate).format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY")}ngOnInit(){this.calendar.customOwner=this.dashletconfig.userId}static#e=this.ɵfac=function(e){return new(e||CalendarScheduleDashlet)(u.rXU(m.B),u.rXU(g.L),u.rXU(u.aKT),u.rXU(u.sFG),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarScheduleDashlet,selectors:[["calendar-schedule-dashlet"]],viewQuery:function(e,t){if(1&e&&u.GBs(Vs,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.headerContainer=e.first)}},features:[u.Jv_([S])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["headercontainer",""],["module","Calendar","size","small"],[1,"slds-text-heading--medium","slds-truncate"],[1,"slds-size--1-of-1",3,"ngStyle"],[3,"setdate","untildate$"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1,2),u.nrm(3,"system-icon",3),u.j41(4,"h2",4),u.EFF(5),u.k0s()(),u.j41(6,"div",5)(7,"calendar-sheet-schedule",6),u.bIt("untildate$",(function(e){return t.scheduleUntilDate=e})),u.k0s()()()),2&e&&(u.R7$(5),u.JRh(t.title),u.R7$(),u.Y8G("ngStyle",t.contentStyle),u.R7$(),u.Y8G("setdate",t.calendarDate))},dependencies:[n.B3,$.J,Ot],encapsulation:2})}return CalendarScheduleDashlet})();const Xs=["calendarcontent"];let Us=(()=>{class CalendarDayDashlet{constructor(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletconfig=null,this.dashletLabel=null,this.calendar.isDashlet=!0,this.calendar.sheetType="Day",this.calendar.sheetHourHeight=50}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}}ngOnInit(){this.calendar.customOwner=this.dashletconfig.userId}static#e=this.ɵfac=function(e){return new(e||CalendarDayDashlet)(u.rXU(m.B),u.rXU(u.aKT),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarDayDashlet,selectors:[["calendar-day-dashlet"]],viewQuery:function(e,t){if(1&e&&u.GBs(Xs,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.calendarContent=e.first)}},features:[u.Jv_([S])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Calendar","size","small"],[1,"slds-text-heading--medium"],[3,"label"],[1,"slds-size--1-of-1",3,"ngStyle"],["calendarcontent",""],[3,"setdate"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1),u.nrm(2,"system-icon",2),u.j41(3,"h2",3),u.nrm(4,"system-label",4),u.k0s()(),u.j41(5,"div",5,6),u.nrm(7,"calendar-sheet-day",7),u.k0s()()),2&e&&(u.R7$(4),u.Y8G("label",t.dashletLabel),u.R7$(),u.Y8G("ngStyle",t.contentStyle),u.R7$(2),u.Y8G("setdate",t.calendarDate))},dependencies:[n.B3,$.J,T.W,Re],encapsulation:2,changeDetection:0})}return CalendarDayDashlet})();const Os=["calendarcontent"];let Ps=(()=>{class CalendarThreeDaysDashlet{constructor(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletconfig=null,this.dashletLabel=null,this.setCalendarType()}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}}ngOnInit(){this.calendar.customOwner=this.dashletconfig?.userId}setCalendarType(){this.calendar.isDashlet=!0,this.calendar.sheetType="Three_Days",this.calendar.sheetHourHeight=50}static#e=this.ɵfac=function(e){return new(e||CalendarThreeDaysDashlet)(u.rXU(m.B),u.rXU(u.aKT),u.rXU(S))};static#t=this.ɵcmp=u.VBU({type:CalendarThreeDaysDashlet,selectors:[["calendar-three-days-dashlet"]],viewQuery:function(e,t){if(1&e&&u.GBs(Os,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.calendarContent=e.first)}},features:[u.Jv_([S])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Calendar","size","small"],[1,"slds-text-heading--medium"],[3,"label"],[1,"slds-size--1-of-1",3,"ngStyle"],["calendarcontent",""],[3,"setdate"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"div",1),u.nrm(2,"system-icon",2),u.j41(3,"h2",3),u.nrm(4,"system-label",4),u.k0s()(),u.j41(5,"div",5,6),u.nrm(7,"calendar-sheet-three-days",7),u.k0s()()),2&e&&(u.R7$(4),u.Y8G("label",t.dashletLabel),u.R7$(),u.Y8G("ngStyle",t.contentStyle),u.R7$(2),u.Y8G("setdate",t.calendarDate))},dependencies:[n.B3,$.J,T.W,vt],encapsulation:2})}return CalendarThreeDaysDashlet})();const Ns=["popoverContainer"];let Hs=(()=>{class CalendarMicrosoftEventPopover{constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i,this.event={},this.nubbinClass="",this.popoverStyle={},this.isMobileView=!1,this.hidePopoverTimeout={}}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}onMouseEnter(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseLeave(e){this.closePopover(!0,e)}static#e=this.ɵfac=function(e){return new(e||CalendarMicrosoftEventPopover)(u.rXU(G.yu),u.rXU(S),u.rXU(m.B),u.rXU(u.sFG),u.rXU(u.gRc))};static#t=this.ɵcmp=u.VBU({type:CalendarMicrosoftEventPopover,selectors:[["calendar-microsoft-event-popover"]],viewQuery:function(e,t){if(1&e&&u.GBs(Ns,7,u.c1b),2&e){let e;u.mGM(e=u.lsd())&&(t.popoverContainer=e.first)}},decls:17,vars:7,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small","slds-truncate","slds-has-divider--bottom-space",3,"system-title"],[1,"slds-scrollable--y",2,"height","120px"],[1,"slds-list_horizontal","slds-wrap","slds-text-body_small"],[1,"slds-item_label","slds-text-color_weak","slds-truncate","slds-m-bottom--x-small"],["label","LBL_DESCRIPTION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"innerHTML"],["label","LBL_LOCATION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"system-title"]],template:function(e,t){1&e&&(u.j41(0,"div",0),u.bIt("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(e){return t.onMouseLeave(e)})),u.j41(1,"button",1),u.bIt("click",(function(){return t.closePopover(!0)})),u.nrm(2,"system-button-icon",2),u.k0s(),u.j41(3,"div",null,3)(5,"div",4)(6,"header",5),u.EFF(7),u.k0s(),u.j41(8,"div",6)(9,"dl",7)(10,"dt",8),u.nrm(11,"system-label",9),u.k0s(),u.nrm(12,"dd",10),u.j41(13,"dt",8),u.nrm(14,"system-label",11),u.k0s(),u.j41(15,"dd",12),u.EFF(16),u.k0s()()()()()()),2&e&&(u.Y8G("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.R7$(6),u.Y8G("system-title",t.event.subject),u.R7$(),u.SpI(" ",t.event.subject," "),u.R7$(5),u.Y8G("innerHTML",null==t.event.body?null:t.event.body.content,u.npT),u.R7$(3),u.Y8G("system-title",null==t.event.location?null:t.event.location.displayName),u.R7$(),u.SpI(" ",null==t.event.location?null:t.event.location.displayName," "))},dependencies:[n.YU,n.B3,R.t,T.W,Gs.L],encapsulation:2,changeDetection:0})}return CalendarMicrosoftEventPopover})(),Ls=(()=>{class ModuleCalendar{static#e=this.ɵfac=function(e){return new(e||ModuleCalendar)};static#t=this.ɵmod=u.$C({type:ModuleCalendar});static#s=this.ɵinj=u.G2t({providers:[a.S],imports:[n.MD,i.YN,o.ObjectFields,l.GlobalComponents,d.ObjectComponents,c.SystemComponents,h.h,r.ad]})}return ModuleCalendar})();("undefined"==typeof ngJitMode||ngJitMode)&&u.Obh(Ls,{declarations:[bs,L,Re,vt,Ke,jt,Ot,he,me,z,xs,Rs,yt,js,Ys,ls,At,Is,Us,Ps,pe,Hs],imports:[n.MD,i.YN,o.ObjectFields,l.GlobalComponents,d.ObjectComponents,c.SystemComponents,h.h,r.ad]})}}]);