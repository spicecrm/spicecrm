/*!
 * 
 *                     aacService
 *
 *                     release: 2023.03.001
 *
 *                     date: 2024-01-09 16:51:03
 *
 *                     build: 2023.03.001.1704815463270
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_calendar_modulecalendar_ts"],{22114:(e,t,s)=>{s.r(t),s.d(t,{ModuleCalendar:()=>Gs});var n=s(44755),i=s(95030),a=s(13418),r=s(62422),o=s(53190),l=s(34826),d=s(19784),c=s(57239),h=s(84357),u=s(62242),g=s(55329),m=s(82032),p=s(29266),f=s(26625),v=s(50727),y=s(39646),x=s(77579),w=s(54004),b=s(95698),C=s(14505),E=s(75920),D=s(33369),k=s(44044),T=s(4154);let M=(()=>{class calendar{backend;session;broadcast;modal;language;configuration;modelutilities;metadata;cdRef;userPreferences;userCalendarChange$=new u.vpe;searchTerm="";addingEvent$=new u.vpe;pickerDate$=new u.vpe;otherCalendarsColor$=new u.vpe;layoutChange$=new u.vpe;modules=[];ownerCalendarVisible=!0;usersCalendars=[];otherCalendars=[];calendars={};currentStart={};currentEnd={};sheetTimeWidth=50;sheetHourHeight=80;weekstartday=0;weekDaysCount=7;startHour=0;endHour=23;multiEventHeight=25;todayColor="#eb7092";absenceColor="#727272";eventColor="#039be5";groupwareColor="#db4437";activeGroupware;asPicker=!1;isMobileView=!1;isDashlet=!1;customOwner;isLoading=!1;userPreferencesLoaded=!1;timeZone;duration={Day:"d",Three_Days:"d",Week:"w",Month:"M",Schedule:"M"};colorPalette=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"];subscriptions=new v.w0;constructor(e,t,s,n,i,a,r,o,l,d){this.backend=e,this.session=t,this.broadcast=s,this.modal=n,this.language=i,this.configuration=a,this.modelutilities=r,this.metadata=o,this.cdRef=l,this.userPreferences=d,this.loadCalendarModules(),this.loadPreferences(),this.subscribeToLanguage(),this.getCalendarPreferences(),this.broadcastSubscriber()}_sidebarWidth=360;get sidebarWidth(){return this.isMobileView||this.isDashlet?0:this._sidebarWidth}_calendarDate=moment();get calendarDate(){return this._calendarDate}set calendarDate(e){this._calendarDate=new moment(e).locale(this.language.currentlanguage.substring(0,2)),this.session.setSessionData("calendarDate",this._calendarDate)}_sheetType="Week";get sheetType(){return this._sheetType}set sheetType(e){this._sheetType=e,this.session.setSessionData("sheetType",e)}get owner(){return this.customOwner??this.session.authData.userId}get ownerName(){return this.session.authData.userName}get weekStartDay(){return this.weekstartday}set weekStartDay(e){this.weekstartday=e}refresh(e){this.currentStart={},this.currentEnd={},this.triggerSheetReload(e)}shiftPlus(){let e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this._calendarDate=new moment(this._calendarDate.add(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.add(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))}shiftMinus(){let e=7-this.weekDaysCount;"Day"==this.sheetType&&this._calendarDate.day()==this.weekStartDay&&(this._calendarDate=new moment(this._calendarDate.subtract(moment.duration(e,"d")))),this._calendarDate=new moment(this._calendarDate.subtract(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))}doReload(e,t,s){let n=!this.calendars[s]||this.calendars[s]&&0==this.calendars[s].length,i=!(this.currentStart[s]&&this.currentEnd[s]&&this.currentStart[s].isSame(e)&&this.currentEnd[s].isSame(t));return n||i}loadUserEvents(e,t,s){return this.loadEvents(e,t,this.owner,[s],!0).pipe((0,w.U)((e=>e.map((e=>(e.id=s+e.id,e.otherColor=this.usersCalendars.find((e=>e.id==s)).color,e))))))}loadUsersEvents(e,t){const s=this.usersCalendars.filter((e=>!!e.visible)),n=s.map((e=>e.id)),i=_.object(n,s);return 0==s.length?(0,y.of)([]):this.loadEvents(e,t,this.owner,n).pipe((0,w.U)((e=>{const t=[];return e.forEach((e=>{if(i[e.data.assigned_user_id])e.otherColor=i[e.data.assigned_user_id].color,t.push(e);else if(e.data.meeting_user_status_accept){const s=n.find((t=>!!e.data.meeting_user_status_accept.beans[t]));if(!s)return;e.id=s+e.id,e.otherColor=i[s].color,t.push(e)}})),t})))}loadEvents(e,t,s=this.owner,n=[],i){let a=n.length>0?"users":s;if(i||this.doReload(e,t,a)){this.isLoading=!0,this.cdRef.detectChanges();let i=new x.x,r="YYYY-MM-DD HH:mm:ss",o={start:e.tz("utc").format(r),end:t.tz("utc").format(r),users:n,searchTerm:this.searchTerm},l=n.length>0?"module/Calendar/users/":"module/Calendar/";return this.currentEnd[a]=t,this.currentStart[a]=e,this.backend.getRequest(l+s,o).subscribe((t=>{this.calendars[a]=[];for(let s of t){if(a==this.owner&&s.data.external_id&&this.calendars.google&&this.calendars.google.some((e=>e.id==s.data.external_id))||this.otherCalendars.some((e=>e.name==s.module&&!e.visible)))continue;switch(s.type){case"event":s.start=moment.utc(s.start).tz(this.timeZone).second(0),s.end=moment.utc(s.end).tz(this.timeZone).second(0),s.isMulti=+s.end.diff(s.start,"days",!0)>=1,s.color=this.eventColor;break;case"absence":s.start=moment(s.start).second(0),s.end=moment(s.end).second(0),s.isMulti=!0,s.isAllDay=!0,s.color=this.absenceColor;break;case"other":s.start=moment(s.start).year(e.year()).second(0),s.end=moment(s.end).year(e.year()).second(0),s.isMulti=!0}const t=s.start.date()!=s.end.date()||s.start.hour()>=this.startHour&&s.start.hour()<=this.endHour||s.end.hour()>=this.startHour&&s.end.hour()<=this.endHour;["Day","Three_Days","Week"].some((e=>e==this.sheetType))&&!t||("UserAbsences"==s.module&&("other"==s.type&&(s.data.summary_text=s.data.user_name,s.id=s.id+"-other",s.data.id=s.data.id+"-other"),this.absenceExists(s))||this.calendars[a].push(s))}this.isLoading=!1,this.cdRef.detectChanges(),i.next(this.calendars[a]),i.complete()})),i.asObservable()}{let s=[];for(let n of this.calendars[a])this.otherCalendars.some((e=>e.name==n.module&&!e.visible))||n.start<t&&n.end>e&&(n.start=moment(n.start).tz(this.timeZone).second(0),n.end=moment(n.end).tz(this.timeZone).second(0),s.push(n));return(0,y.of)(s)}}loadGroupwareEvents(e,t){switch(this.activeGroupware){case"google":return this.loadGoogleEvents(e,t);case"microsoft":return this.loadMicrosoftEvents(e,t);default:return(0,y.of)([])}}loadGoogleEvents(e,t){if(this.doReload(e,t,"google")){this.isLoading=!0,this.cdRef.detectChanges();let s=new x.x,n="YYYY-MM-DD HH:mm:ss",i={startdate:e.format(n),enddate:t.format(n),searchTerm:this.searchTerm};return this.calendars.google=[],this.currentEnd.google=t,this.currentStart.google=e,this.backend.getRequest("channels/groupware/gsuite/calendar/events",i).subscribe((e=>{if(e.events&&e.events.length>0)for(let t of e.events)this.calendars[this.owner]&&this.calendars[this.owner].some((e=>e.data.external_id==t.id))||(t.start=moment(moment(t.start.dateTime??t.start.date).format(!t.start.dateTime&&t.start.date?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:00")),t.end=moment(moment(t.end.dateTime??t.end.date).format(!t.end.dateTime&&t.end.date?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:00")),t.isMulti=+t.end.diff(t.start,"days",!0)>=1,t.color=this.groupwareColor,t.type="google",this.calendars.google.push(t));this.isLoading=!1,this.cdRef.detectChanges(),s.next(this.calendars.google),s.complete()})),s.asObservable()}{let s=[];for(let n of this.calendars.google)n.start<t&&n.end>e&&s.push(n);return(0,y.of)(s)}}loadMicrosoftEvents(e,t){if(this.doReload(e,t,"microsoft")){this.isLoading=!0,this.cdRef.detectChanges();let s=new x.x,n="YYYY-MM-DD HH:mm:ss",i={startdate:e.format(n),enddate:t.format(n),searchTerm:this.searchTerm};return this.calendars.microsoft=[],this.currentEnd.microsoft=t,this.currentStart.microsoft=e,this.backend.getRequest(`channels/groupware/microsoft/calendar/events/${this.owner}`,i).subscribe((e=>{if(e.events&&e.events.length>0)for(let t of e.events)this.calendars[this.owner]&&this.calendars[this.owner].some((e=>e.data.external_id==t.id))||(t.start=moment(moment.utc(t.start.dateTime).tz(this.timeZone).format("YYYY-MM-DD HH:mm:00")),t.end=moment(moment.utc(t.end.dateTime).tz(this.timeZone).format("YYYY-MM-DD HH:mm:00")),t.isMulti=+t.end.diff(t.start,"days",!0)>=1,t.color=this.groupwareColor,t.type="microsoft",this.calendars.microsoft.push(t));this.isLoading=!1,this.cdRef.detectChanges(),s.next(this.calendars.microsoft),s.complete()})),s.asObservable()}{let s=[];for(let n of this.calendars.microsoft)n.start<t&&n.end>e&&s.push(n);return(0,y.of)(s)}}getEvents(e=this.owner){return this.calendars[e]?this.calendars[e]:[]}setOtherCalendars(e,t=!0){e&&(this.otherCalendars=e,t&&(this.userPreferences.setPreference("Other",this.otherCalendars,!0,"Calendar"),this.triggerSheetReload()))}addUserCalendar(e,t){if(this.isMobileView||this.isDashlet)return;let s=this.usersCalendars;const n={id:e,name:t,visible:!0,color:"#"+this.colorPalette[Math.floor(this.colorPalette.length*Math.random())]};s.push(n),this.userCalendarChange$.emit(n),this.setUserCalendars(s.slice())}removeUserCalendar(e){if(this.isMobileView||this.isDashlet)return;const t=this.usersCalendars.find((t=>t.id==e));t.visible=!1,this.userCalendarChange$.emit(t);let s=this.usersCalendars.filter((t=>t.id!=e));this.setUserCalendars(s)}toggleUserCalendarVisibility(e){this.usersCalendars.some((t=>{if(t.id==e)return t.visible=!t.visible,this.userCalendarChange$.emit(t),this.setUserCalendars(this.usersCalendars.slice()),!0}))}toggleOwnerCalendarVisible(){this.ownerCalendarVisible=!this.ownerCalendarVisible,this.userCalendarChange$.emit({id:"owner"}),this.userPreferences.setPreference("ownerVisible",this.ownerCalendarVisible,!0,"Calendar")}setUserCalendars(e,t=!0){e&&(this.usersCalendars=e,t&&this.userPreferences.setPreference("Users",this.usersCalendars,!0,"Calendar"))}setUserColor(e,t){this.usersCalendars.some((s=>{if(s.id==e)return s.color=t,this.setUserCalendars(this.usersCalendars),this.otherCalendarsColor$.emit({id:e,color:t}),!0}))}arrangeEvents(e){e.sort(((e,t)=>e.start<t.start||e.start===t.start&&e.end>t.end?-1:1));let t={};for(let s of e){let n=[];for(let t of e)s.id!==t.id&&t.start<s.end&&t.end>s.start&&n.push({id:t.id,start:t.start,end:t.end});let i=0;if(n.length>0){for(let e of n){let t=0;for(let s of n)s.start<e.end&&s.end>e.start&&t++;t>i&&(i=t)}i++}t[s.id]={maxOverlay:i,elementsOverlaid:n}}let s=[];for(let n of e){let i=0,a=[];for(let r of e)if(-1!==s.indexOf(r.id)&&r.start<n.end&&r.end>n.start)for(-1===a.indexOf(t[r.id].displayIndex)&&a.push(t[r.id].displayIndex);-1!==a.indexOf(i);)i++;t[n.id].displayIndex=i,s.push(n.id)}for(let e in t)for(let s of t[e].elementsOverlaid)t[e].maxOverlay<t[s.id].maxOverlay&&(t[e].maxOverlay=t[s.id].maxOverlay);for(let s of e)s.displayIndex=t[s.id].displayIndex,s.maxOverlay=t[s.id].maxOverlay;return e}ngOnDestroy(){this.subscriptions.unsubscribe()}onEventDrop(e,t){t.some((t=>{const s=t.elementRef.nativeElement.getBoundingClientRect(),n=e.source.element.nativeElement.getBoundingClientRect();if(n.top>=s.top&&n.top<=s.bottom&&n.left>=s.left&&n.left<=s.right)return e.source.data.onDrop({day:t.day,hour:t.hour,minutes:t.minutes}),!0})),e.source.reset()}gotToDayView(e){this.refresh(e),this.sheetType="Day"}removeGoogleEvent(e){this.calendars.google.some(((t,s)=>{if(t.id==e)return this.calendars.google.splice(s,1),this.cdRef.detectChanges(),!0}))}removeMicrosoftEvent(e){this.calendars.microsoft.some(((t,s)=>{if(t.id==e)return this.calendars.microsoft.splice(s,1),this.refresh(),!0}))}setIsMobileView(e){this.isMobileView=e,this.multiEventHeight=e?20:25,this.cdRef.detectChanges()}isValid(e){return e&&"object"==typeof e&&e.isValid()}loadCalendarModules(){this.backend.getRequest("module/Calendar/modules").subscribe((e=>{e&&(this.modules=e,this.cdRef.detectChanges())}))}absenceExists(e){let t=!1;for(let s in this.calendars)if(this.calendars.hasOwnProperty(s)&&this.calendars[s].some((t=>t.id==e.id&&t.type==e.type))){t=!0;break}return!!t}broadcastSubscriber(){let e=this.broadcast.message$.subscribe((e=>{let t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if("timezone.changed"==e.messagetype&&(this.timeZone=e.messagedata,this.triggerSheetReload()),this.modules.some((e=>e.name==s)))switch(e.messagetype){case"model.save":let e=n.assigned_user_id,i=this.calendars.users&&this.calendars.users.some((t=>t.id==e));if(!this.calendars[e]&&!i)return;i&&(e="users");!this.modifyEvent(t,s,n,e)&&this.isValid(n.date_end)&&this.isValid(n.date_start)&&this.calendars[e].push({id:t,module:s,type:"event",start:n.date_start,end:n.date_end,isMulti:+n.date_end.diff(n.date_start,"days",!0)>=1,data:n}),this.triggerSheetReload(),this.cdRef.markForCheck();break;case"model.delete":if(!this.calendars[this.owner])return;this.removeEvent(t,s)}}));this.subscriptions.add(e)}modifyEvent(e,t,s,n){if(!this.isValid(s.date_start)||!this.isValid(s.date_end))return!0;if(s.date_start>this.currentEnd&&s.date_end<this.currentStart)return this.removeEvent(e,t),!0;let i=this.calendars[n].find((t=>t.data.id==e));return!!i&&(i.start=s.date_start,i.end=s.date_end,i.isMulti=+s.date_end.diff(s.date_start,"days",!0)>=1,!0)}removeEvent(e,t){this.calendars[this.owner].some(((s,n)=>{if(s.data.id==e&&t==s.module)return this.calendars[this.owner].splice(n,1),this.triggerSheetReload(),this.cdRef.markForCheck(),!0}))}loadPreferences(){this.timeZone=this.session.getSessionData("timezone")||moment.tz.guess();let e=this.userPreferences.toUse;this.weekStartDay="Monday"==e.week_day_start?1:this.weekStartDay,this.weekDaysCount=+e.week_days_count||this.weekDaysCount,this.startHour=+e.calendar_day_start_hour||this.startHour,this.endHour=+e.calendar_day_end_hour||this.endHour;let t=this.session.getSessionData("calendarDate",!1),s=this.session.getSessionData("sheetType",!1);s&&(this._sheetType=s),t&&(this._calendarDate=new moment(t)),this.triggerSheetReload()}getCalendarPreferences(){if(this.isMobileView||this.isDashlet)return;this.userPreferences.loadPreferences("Calendar").pipe((0,b.q)(1)).subscribe((e=>{this.ownerCalendarVisible=!e?.hasOwnProperty("ownerVisible")||e?.ownerVisible,e&&(this.setUserCalendars(e.Users,!1),this.setOtherCalendars(e.Other,!1)),this.userPreferencesLoaded=!0}));const e=this.metadata.getComponentConfig("Calendar").groupwareDisabled;!e&&(this.session.authData.googleToken||this.configuration.checkCapability("google_oauth")&&this.configuration.getCapabilityConfig("google_oauth").serviceaccess)&&(this.activeGroupware="google"),!e&&this.configuration.getCapabilityConfig("msgraphconfig").isActive&&(this.activeGroupware="microsoft")}subscribeToLanguage(){let e=this.language.currentlanguage$.subscribe((()=>this.triggerSheetReload()));this.subscriptions.add(e)}triggerSheetReload(e){this._calendarDate=moment(e||this._calendarDate)}weekdayLong(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.weekdays(e)}weekdayShort(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.weekdaysShort(e)}monthShort(e){let t=this.language.currentlanguage.substring(0,2);return moment.locale(t),moment.monthsShort("-MMM-",e)}static ɵfac=function(e){return new(e||calendar)(u.LFG(C.y),u.LFG(E.n),u.LFG(D.f),u.LFG(k.o),u.LFG(g.d),u.LFG(f.C),u.LFG(p.A),u.LFG(T.Pu),u.LFG(u.sBO),u.LFG(r.z))};static ɵprov=u.Yz7({token:calendar,factory:calendar.ɵfac})}return calendar})();var Z=s(72656),S=s(44561),J=s(24114),Y=s(83463),F=s(93333),Q=s(78859),U=s(79641);function A(e,t){if(1&e&&(u.TgZ(0,"span",21),u._uU(1),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.hij(" ",e.weekNumberDisplay," ")}}function H(e,t){if(1&e&&(u.TgZ(0,"div")(1,"div",14),u._UZ(2,"system-icon",15),u.TgZ(3,"div",16)(4,"p",17),u._UZ(5,"system-label-modulename",18),u.qZA(),u.TgZ(6,"h1",19),u._uU(7),u.YNc(8,A,2,1,"span",20),u.qZA()()()()),2&e){const e=u.oxw();u.ekj("slds-m-bottom--xx-small",e.calendar.isMobileView),u.xp6(2),u.Q6J("module","Calendar"),u.xp6(5),u.hij(" ",e.calendarHeader," "),u.xp6(1),u.Q6J("ngIf","Week"==e.calendar.sheetType)}}function B(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",22)(1,"system-input-search-term",23),u.NdJ("ngModelChange",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.searchTerm=t)}))("onSearchTermClear",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.clearSearchTerm())}))("onEnterPress",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.reloadList())})),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(1),u.Q6J("ngModel",e.searchTerm)}}function O(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",24)(1,"button",25,26),u.NdJ("click",(function(){u.CHM(e);const t=u.MAs(2),s=u.oxw(),n=u.MAs(12);return u.KtG(s.toggleOpenPicker(n,t))})),u._UZ(3,"system-utility-icon",27),u.qZA(),u.TgZ(4,"div",28),u._uU(5),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(5),u.Oqu(e.compactCalendarHeader)}}function N(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"system-icon",29),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.toggleVisibleModule(t.name))})),u.qZA()}if(2&e){const e=t.$implicit,s=u.oxw();u.Q6J("module",e.name)("ngStyle",s.getIconStyle(e.name))}}function I(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",30)(1,"button",25),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.shiftMinus())})),u._UZ(2,"system-button-icon",31),u.qZA(),u.TgZ(3,"button",25),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.shiftPlus())})),u._UZ(4,"system-button-icon",31),u.qZA()()}2&e&&(u.xp6(2),u.Q6J("icon","chevronleft"),u.xp6(2),u.Q6J("icon","chevronright"))}function P(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"button",25),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.calendar.refresh())})),u._UZ(2,"system-button-icon",31),u.qZA(),u.TgZ(3,"div",32)(4,"button",33),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.zoomOut())})),u._UZ(5,"system-button-icon",31),u.qZA(),u.TgZ(6,"button",33),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.resetZoom())})),u._UZ(7,"system-button-icon",31),u.qZA(),u.TgZ(8,"button",33),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.zoomIn())})),u._UZ(9,"system-button-icon",31),u.qZA()(),u.TgZ(10,"button",34),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.goToday())})),u._UZ(11,"system-label",35),u.qZA(),u.BQk()}if(2&e){const e=u.oxw();u.xp6(2),u.Q6J("icon","refresh"),u.xp6(2),u.Q6J("disabled",e.calendar.sheetHourHeight<=30||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.xp6(1),u.Q6J("icon","zoomout"),u.xp6(1),u.Q6J("disabled",80==e.calendar.sheetHourHeight||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.xp6(1),u.Q6J("icon","undo"),u.xp6(1),u.Q6J("disabled",e.calendar.sheetHourHeight>=140||"Month"==e.calendar.sheetType||"Schedule"==e.calendar.sheetType),u.xp6(1),u.Q6J("icon","zoomin")}}function R(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",36)(1,"button",34),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.toggleTypeSelector())})),u._UZ(2,"system-label",37),u.ALo(3,"uppercase"),u._UZ(4,"system-button-icon",31),u.qZA(),u.TgZ(5,"div",38)(6,"ul",39)(7,"li",40)(8,"a",41),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setType("Day"))})),u.TgZ(9,"span",42),u._UZ(10,"system-label",43),u.qZA()()(),u.TgZ(11,"li",44),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setType("Three_Days"))})),u.TgZ(12,"a",45)(13,"span",42),u._UZ(14,"system-label",46),u.qZA()()(),u.TgZ(15,"li",44),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setType("Week"))})),u.TgZ(16,"a",45)(17,"span",42),u._UZ(18,"system-label",47),u.qZA()()(),u.TgZ(19,"li",44),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setType("Month"))})),u.TgZ(20,"a",45)(21,"span",42),u._UZ(22,"system-label",48),u.qZA()()(),u.TgZ(23,"li",44),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setType("Schedule"))})),u.TgZ(24,"a",45)(25,"span",42),u._UZ(26,"system-label",49),u.qZA()()()()()()}if(2&e){const e=u.oxw();u.ekj("slds-is-open",e.showTypeSelector),u.xp6(2),u.Q6J("label",u.lcZ(3,4,"LBL_"+e.calendar.sheetType)),u.xp6(2),u.Q6J("icon","down")}}function q(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"system-input-date-picker",50),u.NdJ("datePicked",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.handleDatePicked(t))})),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("setDate",e.calendar.calendarDate)("weekStartDay",e.calendar.weekStartDay)}}let G=(()=>{class CalendarHeader{language;navigation;elementRef;renderer;modelUtils;configuration;calendar;openPicker=!1;searchTermError=!1;searchTimeOut;scheduleUntilDate={};clickListener;showTypeSelector=!1;modules=[];datePicked=new u.vpe;constructor(e,t,s,n,i,a,r){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modelUtils=i,this.configuration=a,this.calendar=r,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}ngOnDestroy(){this.clickListener&&this.clickListener()}toggleClosed(){this.openPicker=!1,this.clickListener&&this.clickListener()}handleDatePicked(e){this.datePicked.emit(e)}shiftPlus(){this.calendar.shiftPlus()}shiftMinus(){this.calendar.shiftMinus()}get calendarHeader(){const e=new moment(this.calendar.calendarDate);switch(this.calendar.sheetType){case"Week":return`${this.getFirstDayOfWeek()} - ${this.getLastDayOfWeek()}`;case"Month":return e.format("MMMM YYYY");case"Day":return e.format("MMMM D");case"Schedule":return e.format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY");case"Three_Days":return e.format("MMM D")+" - "+moment(e.add(2,"d")).format("MMM D")}}get compactCalendarHeader(){return new moment(this.calendar.calendarDate).format("MMM, YYYY")}get weekNumberDisplay(){let e=new moment(this.calendar.calendarDate);return`${this.language.getLabel("LBL_WEEK")} ${e.format("w")}`}getFirstDayOfWeek(){let e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekStartDay),e.format("MMM D")}getLastDayOfWeek(){let e=new moment(this.calendar.calendarDate);return e.day(this.calendar.weekDaysCount),e.format("MMM D")}toggleTypeSelector(){this.showTypeSelector=!this.showTypeSelector}setType(e){this.calendar.sheetType=e,this.calendar.refresh(),this.showTypeSelector=!1}goToday(){this.calendar.calendarDate=new moment}zoomIn(){this.calendar.sheetHourHeight+=10,this.calendar.layoutChange$.next()}zoomOut(){this.calendar.sheetHourHeight-=10,this.calendar.layoutChange$.next()}resetZoom(){this.calendar.sheetHourHeight=80,this.calendar.layoutChange$.next()}toggleOpenPicker(e,t){this.openPicker=!this.openPicker,this.openPicker&&(this.clickListener=this.renderer.listen("document","click",(s=>this.onDocumentClick(s,e,t))))}onDocumentClick(e,t,s){!this.openPicker||t.contains(e.target)||s.contains(e.target)||(this.openPicker=!1,this.clickListener())}toggleVisibleModule(e){let t=this.calendar.otherCalendars.some((t=>{if(t.name==e)return t.visible=!t.visible,this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()),!0}));t||(this.calendar.otherCalendars.push({id:this.modelUtils.generateGuid(),name:e,visible:!1}),this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()))}getIconStyle(e){return this.calendar.otherCalendars.some((t=>e==t.name&&!t.visible))?{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}:{}}get searchTerm(){return this.calendar.searchTerm}set searchTerm(e){e!=this.calendar.searchTerm&&(this.calendar.searchTerm=e,this.reloadList())}clearSearchTerm(){this.searchTerm=""}reloadList(){this.calendar.refresh(),this.calendar.cdRef.detectChanges()}static ɵfac=function(e){return new(e||CalendarHeader)(u.Y36(g.d),u.Y36(m.G),u.Y36(u.SBq),u.Y36(u.Qsj),u.Y36(p.A),u.Y36(f.C),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarHeader,selectors:[["calendar-header"]],inputs:{modules:"modules"},outputs:{datePicked:"datePicked"},decls:14,vars:12,consts:[[1,"slds-page-header",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"slds-grid"],[3,"slds-m-bottom--xx-small",4,"ngIf"],["class","slds-p-right--small slds-align-bottom","style","width: 400px",4,"ngIf"],["class","slds-col slds-grid",4,"ngIf"],[1,"slds-align-top","slds-col","slds-grid","slds-no-flex","slds-col--bump-left"],[1,"slds-m-right--medium","slds-grid"],["size","medium","divClass","slds-m-right--xx-small","style","cursor: pointer",3,"module","ngStyle","click",4,"ngFor","ngForOf"],["class","slds-button-group","role","group",4,"ngIf"],[4,"ngIf"],["class"," slds-dropdown-trigger slds-dropdown-trigger--click slds-m-left--xx-small",3,"slds-is-open",4,"ngIf"],["aria-hidden","false","role","dialog",1,"slds-datepicker","slds-dropdown","slds-dropdown_left"],["pickerontainer",""],[3,"setDate","weekStartDay","datePicked",4,"ngIf"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-text-title--caps","slds-line-height--reset"],["module","Calendar"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],["class","slds-p-horizontal--x-small slds-p-vertical--xx-small slds-pill slds-text-body--small",4,"ngIf"],[1,"slds-p-horizontal--x-small","slds-p-vertical--xx-small","slds-pill","slds-text-body--small"],[1,"slds-p-right--small","slds-align-bottom",2,"width","400px"],[3,"ngModel","ngModelChange","onSearchTermClear","onEnterPress"],[1,"slds-col","slds-grid"],[1,"slds-button","slds-button--icon-border",3,"click"],["pickerbuttoncontainer",""],["icon","event","size","x-small"],[1,"slds-page-header__title","slds-m-horizontal--x-small","slds-align-middle","slds-truncate"],["size","medium","divClass","slds-m-right--xx-small",2,"cursor","pointer",3,"module","ngStyle","click"],["role","group",1,"slds-button-group"],[3,"icon"],["role","group",1,"slds-button-group","slds-m-left--x-small"],[1,"slds-button","slds-button--icon-border",3,"disabled","click"],[1,"slds-button","slds-button--neutral","slds-p-horizontal--x-small",3,"click"],["label","LBL_TODAY"],[1,"slds-dropdown-trigger","slds-dropdown-trigger--click","slds-m-left--xx-small"],[3,"label"],[1,"slds-dropdown","slds-dropdown--right","slds-dropdown--x-small"],["role","menu",1,"slds-dropdown__list"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem",3,"click"],[1,"slds-truncate"],["label","LBL_DAY"],["role","presentation",1,"slds-dropdown__item",3,"click"],["href","javascript:void(0);","role","menuitem"],["label","LBL_THREE_DAYS"],["label","LBL_WEEK"],["label","LBL_MONTH"],["label","LBL_SCHEDULE"],[3,"setDate","weekStartDay","datePicked"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1),u.YNc(2,H,9,5,"div",2),u.YNc(3,B,2,1,"div",3),u.YNc(4,O,6,1,"div",4),u.TgZ(5,"div",5)(6,"div",6),u.YNc(7,N,1,2,"system-icon",7),u.qZA(),u.YNc(8,I,5,2,"div",8),u.YNc(9,P,12,7,"ng-container",9),u.YNc(10,R,27,6,"div",10),u.qZA()()(),u.TgZ(11,"div",11,12),u.YNc(13,q,1,2,"system-input-date-picker",13),u.qZA()),2&e&&(u.ekj("slds-p-around--x-small",t.calendar.isMobileView),u.xp6(2),u.Q6J("ngIf",!t.calendar.isMobileView),u.xp6(1),u.Q6J("ngIf",!t.calendar.isMobileView),u.xp6(1),u.Q6J("ngIf",t.calendar.isMobileView),u.xp6(3),u.Q6J("ngForOf",t.modules),u.xp6(1),u.Q6J("ngIf",!t.calendar.isMobileView||t.calendar.asPicker),u.xp6(1),u.Q6J("ngIf",!t.calendar.isMobileView&&!t.calendar.asPicker),u.xp6(1),u.Q6J("ngIf",!t.calendar.asPicker),u.xp6(1),u.ekj("slds-hidden",!t.openPicker||!t.calendar.isMobileView),u.xp6(2),u.Q6J("ngIf",t.openPicker))},dependencies:[n.sg,n.O5,n.PC,i.JJ,i.On,Z.J,S.f,J.e,Y._,F.M,Q.r,U.g,n.gd],encapsulation:2,changeDetection:0})}return CalendarHeader})();function L(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",1),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.addEvent())})),u._uU(1),u.qZA()}if(2&e){const e=u.oxw();u.xp6(1),u.AsE(" ",e.hour,":",0==e.minutes?"00":e.minutes,"\n")}}let $=(()=>{class CalendarSheetDropTarget{calendar;cdr;elementRef;day;hour=0;minutes=0;constructor(e,t,s){this.calendar=e,this.cdr=t,this.elementRef=s}get date(){return this.day?moment(this.day.date):this.calendar.calendarDate}set hourPart(e){this.minutes=e?15*e:0}ngAfterViewInit(){this.cdr.detach()}addEvent(){const e=moment(this.date);e.hour(this.hour).minute(this.minutes).second(0),this.calendar.asPicker?this.calendar.pickerDate$.emit(e):this.calendar.addingEvent$.emit(e)}static ɵfac=function(e){return new(e||CalendarSheetDropTarget)(u.Y36(M),u.Y36(u.sBO),u.Y36(u.SBq))};static ɵcmp=u.Xpm({type:CalendarSheetDropTarget,selectors:[["calendar-sheet-drop-target"]],inputs:{day:"day",hour:"hour",hourPart:"hourPart"},decls:1,vars:1,consts:[[3,"click",4,"ngIf"],[3,"click"]],template:function(e,t){1&e&&u.YNc(0,L,2,2,"div",0),2&e&&u.Q6J("ngIf",!t.calendar.isDashlet)},dependencies:[n.O5],encapsulation:2,changeDetection:0})}return CalendarSheetDropTarget})();var V=s(55710),z=s(17017),j=s(73194),W=s(54021),K=s(32294),X=s(20586),ee=s(55931),te=s(94664),se=s(31790);function ne(e,t){if(1&e&&u._UZ(0,"abbr",4),2&e){const e=u.oxw();u.Udp("background-color",e.event.otherColor),u.Q6J("title",e.event.data.assigned_user_name)}}function ie(e,t){if(1&e&&u._UZ(0,"object-record-fieldset-horizontal-list",12),2&e){const e=u.oxw(2);u.Q6J("ngClass",e.textClass)("fieldset",e.headerFieldset)}}function ae(e,t){if(1&e&&(u.TgZ(0,"span",15),u._uU(1),u.qZA()),2&e){const e=u.oxw(3);u.Q6J("ngClass",e.textClass),u.xp6(1),u.hij(", ",e.startHour,"")}}function re(e,t){if(1&e&&(u.TgZ(0,"span",13),u._uU(1),u.qZA(),u.YNc(2,ae,2,2,"span",14)),2&e){const e=u.oxw(2);u.Q6J("ngClass",e.textClass),u.xp6(1),u.Oqu(e.model.data.summary_text),u.xp6(1),u.Q6J("ngIf",e.event.isMulti&&e.startHour&&!e.isAbsence)}}function oe(e,t){if(1&e&&u._UZ(0,"object-record-fieldset-horizontal-list",12),2&e){const e=u.oxw(2);u.Q6J("ngClass",e.textClass)("fieldset",e.subFieldset)}}function le(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",16),u.NdJ("mousedown",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.onMouseDown(t))})),u._UZ(1,"system-utility-icon",17),u.qZA()}}function de(e,t){if(1&e&&(u.ynx(0),u.TgZ(1,"div",5)(2,"div",6),u.YNc(3,ie,1,2,"object-record-fieldset-horizontal-list",7),u.YNc(4,re,3,3,"ng-template",null,8,u.W1O),u.YNc(6,oe,1,2,"object-record-fieldset-horizontal-list",9),u.qZA(),u._UZ(7,"object-action-menu",10),u.qZA(),u.YNc(8,le,2,0,"div",11),u.BQk()),2&e){const e=u.MAs(5),t=u.oxw();u.xp6(3),u.Q6J("ngIf",t.headerFieldset)("ngIfElse",e),u.xp6(3),u.Q6J("ngIf",t.subFieldset&&!t.event.isMulti),u.xp6(1),u.Q6J("buttonsize","xx-small"),u.xp6(1),u.Q6J("ngIf",!t.event.isMulti&&"Month"!=t.calendar.sheetType&&t.canEdit)}}function ce(e,t){1&e&&u._UZ(0,"system-spinner",18)}let he=(()=>{class CalendarSheetEvent{language;configuration;calendar;model;view;broadcast;cdRef;userpreferences;metadata;elementRef;renderer;eventChange=new u.vpe;eventDrop=new u.vpe;event={};sheetContainer={};mouseUpListener;previewsPageY;currentPageY;oldDuration=0;color="";hasDarkColor=!0;headerFieldset;subFieldset;subscriptions=new v.w0;constructor(e,t,s,n,i,a,r,o,l,d,c){this.language=e,this.configuration=t,this.calendar=s,this.model=n,this.view=i,this.broadcast=a,this.cdRef=r,this.userpreferences=o,this.metadata=l,this.elementRef=d,this.renderer=c,this.subscribeToColorChange(),this.subscribeToModelSave(),this.view.displayLabels=!1}get startHour(){return this.model.getField("date_start")?moment(this.model.getField("date_start")).tz(this.calendar.timeZone).format(this.userpreferences.getTimeFormat()):void 0}get textClass(){return"Schedule"!=this.calendar.sheetType&&this.hasDarkColor?"spice-calendar-event-has-dark-color":""}get isAbsence(){return"absence"==this.event.type||"UserAbsences"==this.event.module}get isDraggable(){return this.canEdit&&!this.event.isMulti&&"Month"!=this.calendar.sheetType}get canEdit(){return this.model.checkAccess("edit")&&"Schedule"!=this.calendar.sheetType&&("event"==this.event.type||"absence"==this.event.type)&&!this.calendar.asPicker&&!this.calendar.isMobileView&&!this.calendar.isDashlet}get owner(){return this.calendar.owner}get lockAxis(){return"Day"==this.calendar.sheetType?"y":void 0}ngOnInit(){this.setModelDataFromEvent(),this.loadFieldset(),this.setEventColor()}ngOnDestroy(){this.subscriptions.unsubscribe()}onDrop(e){const t=this.event.end.diff(this.event.start,"minutes");e.day&&(this.event.start=moment(e.day.date)),this.event.start.hour(e.hour).minute(e.minutes).seconds(0),this.event.end=moment(this.event.start).add(t,"minutes"),this.event.data.duration_hours=Math.floor(t/60),this.event.data.duration_minutes=t-60*this.event.data.duration_hours;const s=this.calendar.modules.find((e=>e.name==this.event.module))||{},n=s.dateStartFieldName||"date_start",i=s.dateEndFieldName||"date_end";this.event.data[n]=moment(this.event.start.format()),this.event.data[i]=moment(this.event.end.format()),this.model.startEdit(!0,!0),this.event.saving=!0,this.model.setData({...this.event.data},!0,!0),this.model.save(!1).subscribe((()=>{this.event.saving=!1,this.cdRef.detectChanges()})),this.eventChange.emit()}isDarkColor(e){let t=e.indexOf("#")>-1?e.substring(1):e,s=parseInt(t,16);return.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(s>>0&255)<120}emitDrop(e){this.elementRef.nativeElement.style.zIndex="initial",this.eventDrop.emit(e)}onClick(){this.cdRef.detectChanges()}onDragStart(){this.elementRef.nativeElement.style.zIndex=9999}loadFieldset(){let e=this.metadata.getComponentConfig("CalendarSheetEvent",this.model.module);e&&e.header_fieldset&&(this.headerFieldset=e.header_fieldset),e&&e.sub_fieldset&&(this.subFieldset=e.sub_fieldset)}subscribeToColorChange(){this.subscriptions.add(this.calendar.otherCalendarsColor$.subscribe((e=>{this.event.data.assigned_user_id&&e.id==this.event.data.assigned_user_id&&(this.event.otherColor=e.color,this.cdRef.detectChanges())})))}subscribeToModelSave(){this.subscriptions.add(this.broadcast.message$.subscribe((e=>{let t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if(s==this.model.module&&"model.save"===e.messagetype)t==this.model.id&&(this.model.setData(n,!0),this.setEventColor(),this.eventChange.emit())})))}setModelDataFromEvent(){this.model.module=this.event.module,this.model.id=this.event.data.id,this.model.setData({...this.event.data},!0)}onMouseDown(e){if(!this.canEdit)return;this.cdRef.detach(),this.previewsPageY=e.pageY,this.currentPageY=e.pageY,this.oldDuration=this.event.end.diff(this.event.start,"minutes"),this.event.resizing=!0;const t=this.renderer.listen("document","mousemove",(e=>this.onMouseMove(e)));this.mouseUpListener=this.renderer.listen("document","mouseup",(()=>this.onMouseUp(t))),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}onMouseMove(e){this.currentPageY=e.pageY;const t=this.calendar.sheetHourHeight/4,s=this.currentPageY-this.previewsPageY>t,n=this.currentPageY-this.previewsPageY<-Math.abs(t),i=s?"add":n?"subtract":null;i&&(this.previewsPageY=this.currentPageY,this.event.end[i](15,"minutes"),this.eventChange.emit())}onMouseUp(e){this.cdRef.reattach(),this.mouseUpListener(),e();const t=this.event.end.diff(this.event.start,"minutes");if(this.oldDuration!=t){this.event.data.duration_hours=Math.floor(t/60),this.event.data.duration_minutes=t-60*this.event.data.duration_hours,this.model.startEdit(!0,!0);let e={duration_minutes:this.event.data.duration_minutes,duration_hours:this.event.data.duration_hours};e[(this.calendar.modules.find((e=>e.name==this.event.module))||{}).dateEndFieldName||"date_end"]=moment(this.event.end.format()),this.model.setFields(e),this.event.saving=!0,this.model.save().subscribe((()=>{this.event.saving=!1,this.cdRef.detectChanges()})),this.eventChange.emit()}this.previewsPageY=void 0,this.currentPageY=void 0,this.event.resizing=!1,this.oldDuration=0}setEventColor(){if("Schedule"==this.calendar.sheetType)return this.color="transparent";this.color=this.event.hasOwnProperty("color")?this.event.color:this.calendar.eventColor;let e=this.configuration.getData("calendarcolorconditions");if(e){e=e.filter((e=>e.module==this.model.module)).sort(((e,t)=>+e.priority<+t.priority?1:-1));for(let t of e){if(!(null!=t.module_filter&&t.module_filter.length>0)){this.color=t.color_hex_code.indexOf("#")>-1?t.color_hex_code:"#"+t.color_hex_code,this.hasDarkColor=this.isDarkColor(t.color_hex_code);break}if(this.model.checkModuleFilterMatch(t.module_filter)){this.color=t.color_hex_code.indexOf("#")>-1?t.color_hex_code:"#"+t.color_hex_code,this.hasDarkColor=this.isDarkColor(t.color_hex_code);break}}}}static ɵfac=function(e){return new(e||CalendarSheetEvent)(u.Y36(g.d),u.Y36(f.C),u.Y36(M),u.Y36(V.o),u.Y36(K.e),u.Y36(D.f),u.Y36(u.sBO),u.Y36(r.z),u.Y36(T.Pu),u.Y36(u.SBq),u.Y36(u.Qsj))};static ɵcmp=u.Xpm({type:CalendarSheetEvent,selectors:[["calendar-sheet-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},outputs:{eventChange:"eventChange",eventDrop:"eventDrop"},features:[u._Bn([V.o,K.e])],decls:6,vars:12,consts:[["cdkDrag","","cdkDragBoundary",".calendar-event-drag-boundary",1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview",2,"height","100%","border-radius","2px",3,"cdkDragData","cdkDragLockAxis","cdkDragDisabled","click","cdkDragEnded","cdkDragStarted"],["style","height: calc(100% - 2px); width: 8px; border-radius: 2px; margin: 1px; box-shadow: #4b4b4b 1px 0 1px 0;",3,"background-color","title",4,"ngIf"],[4,"ngIf","ngIfElse"],["saving",""],[2,"height","calc(100% - 2px)","width","8px","border-radius","2px","margin","1px","box-shadow","#4b4b4b 1px 0 1px 0",3,"title"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small",2,"height","100%"],[1,"slds-truncate",2,"height","inherit","width","100%"],[3,"ngClass","fieldset",4,"ngIf","ngIfElse"],["summaryContainer",""],[3,"ngClass","fieldset",4,"ngIf"],[1,"slds-p-top--xxx-small",3,"buttonsize"],["draggable","false","class","slds-is-absolute","style","bottom: 0; left: calc(50% - 8px);cursor: ns-resize;",3,"mousedown",4,"ngIf"],[3,"ngClass","fieldset"],["system-model-popover","",1,"slds-text-link--reset",3,"ngClass"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],["draggable","false",1,"slds-is-absolute",2,"bottom","0","left","calc(50% - 8px)","cursor","ns-resize",3,"mousedown"],["colorclass","slds-icon-text-white","icon","threedots","size","x-small"],["inverse","true",2,"opacity","0.5"]],template:function(e,t){if(1&e&&(u.TgZ(0,"div",0),u.NdJ("click",(function(){return t.onClick()}))("cdkDragEnded",(function(e){return t.emitDrop(e)}))("cdkDragStarted",(function(){return t.onDragStart()})),u.YNc(1,ne,1,3,"abbr",1),u.TgZ(2,"div"),u.YNc(3,de,9,5,"ng-container",2),u.YNc(4,ce,1,0,"ng-template",null,3,u.W1O),u.qZA()()),2&e){const e=u.MAs(5);u.Udp("background-color",t.color),u.ekj("slds-p-vertical--xx-small",t.event.saving),u.Q6J("cdkDragData",t)("cdkDragLockAxis",t.lockAxis)("cdkDragDisabled",!t.isDraggable),u.xp6(1),u.Q6J("ngIf",t.event.otherColor),u.xp6(1),u.Udp("width",t.event.otherColor?"calc(100% - 8px)":"100%"),u.xp6(1),u.Q6J("ngIf",!t.event.saving)("ngIfElse",e)}},dependencies:[n.mk,n.O5,X.g,ee.Z,te.W,Q.r,se.g,a.Zt],encapsulation:2,changeDetection:0})}return CalendarSheetEvent})();var ue=s(83917);let ge=(()=>{class CalendarSheetGoogleEvent{calendar;footer;metadata;zone;model;modal;injector;elementRef;event;sheetContainer={};popoverComponentRef=null;showPopoverTimeout={};constructor(e,t,s,n,i,a,r,o){this.calendar=e,this.footer=t,this.metadata=s,this.zone=n,this.model=i,this.modal=a,this.injector=r,this.elementRef=o}ngOnDestroy(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseEnter(){this.zone.runOutsideAngular((()=>{this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}))}onMouseLeave(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.footer.footercontainer&&this.zone.run((()=>{this.metadata.addComponent("CalendarGoogleEventPopover",this.footer.footercontainer,this.injector).subscribe((e=>{e.instance.parentElementRef=this.elementRef,e.instance.event=this.event,this.popoverComponentRef=e.instance}))}))}onActionClick(){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((e=>{e.instance.module$.pipe((0,b.q)(1)).subscribe((e=>{if(e){this.model.module=e.name;const t=this.event.end.diff(this.event.start,"minutes"),s=Math.floor(t/60),n=t-60*s;let i={[e.dateStartFieldName]:this.event.start,[e.dateEndFieldName]:this.event.end,duration_minutes:n,duration_hours:s,name:this.event.summary,description:this.event.description,location:this.event.location,external_id:this.event.id};"UserAbsences"==e.name&&(i.user_id=this.calendar.owner,i.user_name=this.calendar.ownerName),this.model.addModel("",null,i).subscribe((()=>{this.calendar.removeGoogleEvent(this.event.id)}))}}))}))}static ɵfac=function(e){return new(e||CalendarSheetGoogleEvent)(u.Y36(M),u.Y36(ue.M),u.Y36(T.Pu),u.Y36(u.R0b),u.Y36(V.o),u.Y36(k.o),u.Y36(u.zs3),u.Y36(u.SBq))};static ɵcmp=u.Xpm({type:CalendarSheetGoogleEvent,selectors:[["calendar-sheet-google-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},features:[u._Bn([V.o])],decls:6,vars:5,consts:[[1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview","slds-height_full",2,"border-radius","2px"],[1,"slds-size--1-of-1"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small","slds-height_full"],[1,"slds-truncate","slds-grid",2,"height","inherit"],[1,"slds-text-link--reset","slds-truncate",3,"mouseenter","mouseleave"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),u.NdJ("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(){return t.onMouseLeave()})),u._uU(5),u.qZA()()()()()),2&e&&(u.Udp("background-color","Schedule"==t.calendar.sheetType?"0":t.calendar.groupwareColor),u.xp6(4),u.ekj("spice-calendar-event-has-dark-color","Schedule"!=t.calendar.sheetType),u.xp6(1),u.hij(" ",t.event.summary," "))},encapsulation:2,changeDetection:0})}return CalendarSheetGoogleEvent})();var me=s(95681);let pe=(()=>{class CalendarSheetMicrosoftEvent{calendar;footer;metadata;zone;model;modal;injector;elementRef;event;sheetContainer={};popoverComponentRef=null;showPopoverTimeout={};constructor(e,t,s,n,i,a,r,o){this.calendar=e,this.footer=t,this.metadata=s,this.zone=n,this.model=i,this.modal=a,this.injector=r,this.elementRef=o}ngOnDestroy(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseEnter(){this.zone.runOutsideAngular((()=>{this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}))}onMouseLeave(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.footer.footercontainer&&this.zone.run((()=>{this.metadata.addComponent("CalendarMicrosoftEventPopover",this.footer.footercontainer,this.injector).subscribe((e=>{e.instance.parentElementRef=this.elementRef,e.instance.event=this.event,this.popoverComponentRef=e.instance}))}))}onActionClick(){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((e=>{e.instance.module$.pipe((0,b.q)(1)).subscribe((e=>{if(e){this.model.module=e.name;const t=this.event.end.diff(this.event.start,"minutes"),s=Math.floor(t/60),n=t-60*s;let i={[e.dateStartFieldName]:this.event.start,[e.dateEndFieldName]:this.event.end,duration_minutes:n,duration_hours:s,name:this.event.subject,description:this.event.body?.content,location:this.event.location?.displayName,external_id:this.event.id};"UserAbsences"==e.name&&(i.user_id=this.calendar.owner,i.user_name=this.calendar.ownerName),this.model.addModel("",null,i).subscribe((()=>{this.calendar.removeMicrosoftEvent(this.event.id)}))}}))}))}static ɵfac=function(e){return new(e||CalendarSheetMicrosoftEvent)(u.Y36(M),u.Y36(ue.M),u.Y36(T.Pu),u.Y36(u.R0b),u.Y36(V.o),u.Y36(k.o),u.Y36(u.zs3),u.Y36(u.SBq))};static ɵcmp=u.Xpm({type:CalendarSheetMicrosoftEvent,selectors:[["calendar-sheet-microsoft-event"]],inputs:{event:"event",sheetContainer:"sheetContainer"},features:[u._Bn([V.o])],decls:15,vars:5,consts:[[1,"slds-grid","slds-m-around--xxx-small","spice-free-drag-preview","slds-height_full",2,"border-radius","2px"],[1,"slds-size--1-of-1"],[1,"slds-grid","slds-grid--align-spread","slds-p-horizontal--xx-small","slds-height_full"],[1,"slds-truncate","slds-grid",2,"height","inherit"],[1,"slds-text-link--reset","slds-truncate",3,"mouseenter","mouseleave"],["system-dropdown-trigger","",1,"slds-dropdown-trigger","slds-dropdown-trigger--click","slds-p-top--xxx-small",2,"height","fit-content"],["aria-haspopup","true",1,"slds-button","slds-button--icon-border-filled","slds-button--icon-xx-small"],["icon","down","size","xx-small"],[1,"slds-dropdown"],["role","menu",1,"slds-dropdown__list"],["role","presentation",1,"slds-dropdown__item",3,"click"],["href","javascript:void(0);","role","menuitem","tabindex","-1"],[1,"slds-truncate"],["label","LBL_SAVE_TO_CRM"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),u.NdJ("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(){return t.onMouseLeave()})),u._uU(5),u.qZA()(),u.TgZ(6,"div",5)(7,"button",6),u._UZ(8,"system-button-icon",7),u.qZA(),u.TgZ(9,"div",8)(10,"ul",9)(11,"li",10),u.NdJ("click",(function(){return t.onActionClick()})),u.TgZ(12,"a",11)(13,"div",12),u._UZ(14,"system-label",13),u.qZA()()()()()()()()()),2&e&&(u.Udp("background-color","Schedule"==t.calendar.sheetType?"0":t.calendar.groupwareColor),u.xp6(4),u.ekj("spice-calendar-event-has-dark-color","Schedule"!=t.calendar.sheetType),u.xp6(1),u.hij(" ",t.event.subject," "))},dependencies:[Z.J,Y._,me.l],encapsulation:2,changeDetection:0})}return CalendarSheetMicrosoftEvent})();const fe=["sheetContainer"];function ve(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",11),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("height",s.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function ye(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",11),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("height",s.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function xe(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",11),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Udp("height",t.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function we(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",11),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Udp("height",t.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function be(e,t){if(1&e&&(u.ynx(0),u.YNc(1,xe,1,3,"calendar-sheet-google-event",12),u.YNc(2,we,1,3,"calendar-sheet-microsoft-event",12),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type)}}function Ce(e,t){if(1&e&&(u.TgZ(0,"div",13)(1,"div",14)(2,"div",15),u._uU(3),u.qZA()(),u.TgZ(4,"div",16)(5,"div",17),u._UZ(6,"calendar-sheet-drop-target",18)(7,"calendar-sheet-drop-target",18),u.qZA(),u.TgZ(8,"div",19),u._UZ(9,"calendar-sheet-drop-target",18)(10,"calendar-sheet-drop-target",18),u.qZA()()()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("width",s.calendar.sheetTimeWidth,"px"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(1),u.hij("",e,":00"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(2),u.Q6J("hour",e)("hourPart",0),u.xp6(1),u.Q6J("hour",e)("hourPart",1),u.xp6(2),u.Q6J("hour",e)("hourPart",2),u.xp6(1),u.Q6J("hour",e)("hourPart",3)}}function Ee(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",20),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.BQk()}if(2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function De(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",20),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.BQk()}if(2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function _e(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",22),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function ke(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",22),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function Te(e,t){if(1&e&&(u.ynx(0),u.YNc(1,_e,1,2,"calendar-sheet-google-event",21),u.YNc(2,ke,1,2,"calendar-sheet-microsoft-event",21),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type)}}let Me=(()=>{class CalendarSheetDay{language;cdRef;renderer;calendar;sheetContainer;dropTargets;dayTextContainerClass="";dayTextClass="slds-text-body--regular";dateTextClass="slds-text-heading--large";sheetHours=[];ownerMultiEvents=[];groupwareMultiEvents=[];setdate={};groupwareVisible=!0;ownerEvents=[];userEvents=[];userMultiEvents=[];groupwareEvents=[];resizeListener;subscription=new v.w0;constructor(e,t,s,n){this.language=e,this.cdRef=t,this.renderer=s,this.calendar=n,this.buildHours(),this.subscribeToChanges()}subscribeToChanges(){this.subscription.add(this.calendar.layoutChange$.subscribe((()=>{this.setEventsStyle()}))),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>this.setEventsStyle()))}get allEvents(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.groupwareEvents))}get offset(){return moment.tz(this.calendar.timeZone).format("z Z")}get sheetTimeWidth(){return this.calendar.sheetTimeWidth}get startDate(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(this.calendar.endHour-this.calendar.startHour,"h")}get isTodayStyle(){let e=new moment;return{color:e.year()===this.setdate.year()&&e.month()===this.setdate.month()&&e.date()==this.setdate.date()?this.calendar.todayColor:"inherit"}}ngOnChanges(e){e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnInit(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")}ngOnDestroy(){this.subscription.unsubscribe(),this.resizeListener&&this.resizeListener()}trackByItemFn(e,t){return t.id}trackByIndexFn(e,t){return e}correctHours(e){return e.forEach((e=>{if(!e.isMulti){let t=e.end.hour()>this.calendar.startHour&&e.start.hour()<this.calendar.startHour,s=e.start.hour()<this.calendar.endHour&&e.end.hour()>this.calendar.endHour;t&&(e.start=e.start.hour(this.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(this.calendar.endHour).minute(59))}})),e}getOwnerEvents(){if(this.ownerEvents=[],this.ownerMultiEvents=[],!this.calendar.ownerCalendarVisible)return this.setEventsStyle();this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),e=this.filterEvents(e),this.ownerEvents=e.filter((e=>!e.isMulti)),this.ownerMultiEvents=e.filter((e=>e.isMulti)),this.setEventsStyle())}))}getGroupwareEvents(){if(this.groupwareEvents=[],this.groupwareMultiEvents=[],!this.groupwareVisible||this.calendar.isMobileView)return this.setEventsStyle();this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),e=this.filterEvents(e),this.groupwareEvents=e.filter((e=>!e.isMulti)),this.groupwareMultiEvents=e.filter((e=>e.isMulti)),this.setEventsStyle())}))}getUserEvents(e){if(this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.userMultiEvents=this.userMultiEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.calendar.isMobileView||!e.visible)return this.setEventsStyle();this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(e=this.correctHours(e),(e=this.filterEvents(e)).forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.setEventsStyle())}))}getUsersEvents(){if(this.userEvents=[],this.userMultiEvents=[],this.calendar.isMobileView)return this.setEventsStyle();this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e=this.correctHours(e),(e=this.filterEvents(e)).forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.setEventsStyle())}))}filterEvents(e){return e.filter((e=>e.end.hour()>this.calendar.startHour||e.start.hour()<this.calendar.endHour||"absence"==e.type))}displayDate(e){switch(e){case"weekday":return"string"==typeof this.setdate.format("d")?parseInt(this.setdate.format("d"),10):this.setdate.format("d");case"day":return this.setdate.format("ddd");case"date":return this.setdate.format(this.calendar.isDashlet?"D, MMMM":"D")}}buildHours(){this.sheetHours=[];let e=this.calendar.startHour;for(;e<=this.calendar.endHour;)this.sheetHours.push(e),e++}setEventsStyle(){this.allEvents.forEach((e=>{const t=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),s=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),n=(this.sheetContainer.element.nativeElement.clientWidth-this.sheetTimeWidth)/(e.maxOverlay>0?e.maxOverlay:1);e.style={left:this.sheetTimeWidth+n*e.displayIndex+"px",width:n+"px",top:this.calendar.sheetHourHeight/60*t-1+"px",height:this.calendar.sheetHourHeight/60*(s-t)+"px","min-height":this.calendar.multiEventHeight+"px"}})),this.cdRef.detectChanges()}onEventDrop(e){this.calendar.onEventDrop(e,this.dropTargets)}static ɵfac=function(e){return new(e||CalendarSheetDay)(u.Y36(g.d),u.Y36(u.sBO),u.Y36(u.Qsj),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarSheetDay,selectors:[["calendar-sheet-day"]],viewQuery:function(e,t){if(1&e&&(u.Gf(fe,7,u.s_b),u.Gf($,5)),2&e){let e;u.iGM(e=u.CRH())&&(t.sheetContainer=e.first),u.iGM(e=u.CRH())&&(t.dropTargets=e)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.TTD],decls:20,vars:25,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center","slds-height_full"],[1,"slds-border--left","slds-p-top--xx-small","slds-grow"],[1,"slds-p-bottom--xx-small",3,"ngClass","ngStyle"],[1,"slds-p-left--x-small","slds-truncate",3,"ngClass"],[1,"slds-text-align--center","slds-border--top","slds-p-around--xxx-small","slds-text-body--small"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-scrollable--y","slds-is-relative","slds-grow","calendar-event-drag-boundary"],["sheetContainer",""],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"spice-calendar-multi-event-day",3,"event"],["class","spice-calendar-multi-event-day",3,"event","height",4,"ngIf"],[1,"slds-grid"],[1,"slds-height_full"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[1,"spice-calendar-event",3,"event","ngStyle"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2),u._uU(3),u.qZA(),u.TgZ(4,"div",3)(5,"div",4)(6,"div",5),u._uU(7),u.qZA(),u.TgZ(8,"h1",5),u._uU(9),u.qZA()(),u.TgZ(10,"div",6),u.YNc(11,ve,2,3,"ng-container",7),u.YNc(12,ye,2,3,"ng-container",7),u.YNc(13,be,3,2,"ng-container",7),u.qZA()()(),u.TgZ(14,"div",8,9),u.YNc(16,Ce,11,15,"div",10),u.YNc(17,Ee,2,2,"ng-container",7),u.YNc(18,De,2,2,"ng-container",7),u.YNc(19,Te,3,2,"ng-container",7),u.qZA()()),2&e&&(u.xp6(2),u.Udp("width",t.calendar.sheetTimeWidth,"px"),u.xp6(1),u.hij(" ",t.offset," "),u.xp6(2),u.Q6J("ngClass",t.dayTextContainerClass)("ngStyle",t.isTodayStyle),u.xp6(1),u.Q6J("ngClass",t.dayTextClass),u.xp6(1),u.Oqu(t.calendar.weekdayShort(t.displayDate("weekday"))),u.xp6(1),u.Q6J("ngClass",t.dateTextClass),u.xp6(1),u.Oqu(t.displayDate("date")),u.xp6(1),u.Udp("min-height",t.calendar.multiEventHeight,"px"),u.xp6(1),u.Q6J("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(3),u.Q6J("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.xp6(1),u.Q6J("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.mk,n.sg,n.O5,n.PC,he,ge,$,pe],encapsulation:2,changeDetection:0})}return CalendarSheetDay})();const Ze=["sheetContainer"],Se=["scrollContainer"];function Je(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",15)(1,"div",16)(2,"div",17),u._uU(3),u.qZA(),u.TgZ(4,"div",18)(5,"a",19),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.gotoDay(t.date))})),u._uU(6),u.qZA()()()()}if(2&e){const e=t.$implicit,s=u.oxw();u.Q6J("ngStyle",s.dayWidthStyle),u.xp6(1),u.Udp("color",e.color),u.xp6(2),u.hij(" ",s.calendar.weekdayShort(e.day)," "),u.xp6(3),u.hij(" ",e.dateTextDayNumber," ")}}function Ye(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",20),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function Fe(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",20),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function Qe(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",20),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function Ue(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function Ae(e,t){if(1&e&&(u.ynx(0),u.YNc(1,Qe,1,2,"calendar-sheet-google-event",21),u.YNc(2,Ue,1,2,"calendar-sheet-microsoft-event",21),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type)}}function He(e,t){if(1&e&&u._UZ(0,"div"),2&e){const e=u.oxw(2);u.Udp("height",e.calendar.multiEventHeight,"px")}}function Be(e,t){if(1&e&&(u.TgZ(0,"div",15),u.YNc(1,He,1,2,"div",22),u.qZA()),2&e){const e=t.$implicit,s=u.oxw();u.Udp("min-height",s.calendar.multiEventHeight,"px"),u.Q6J("ngStyle",s.dayWidthStyle),u.xp6(1),u.Q6J("ngForOf",e.events)("ngForTrackBy",s.trackByItemFn)}}function Oe(e,t){if(1&e&&(u.TgZ(0,"div",26)(1,"div",27),u._UZ(2,"calendar-sheet-drop-target",28)(3,"calendar-sheet-drop-target",28),u.qZA(),u.TgZ(4,"div",29),u._UZ(5,"calendar-sheet-drop-target",28)(6,"calendar-sheet-drop-target",28),u.qZA()()),2&e){const e=t.$implicit,s=u.oxw().$implicit,n=u.oxw();u.Q6J("ngStyle",n.dayWidthStyle),u.xp6(2),u.Q6J("day",e)("hour",s)("hourPart",0),u.xp6(1),u.Q6J("day",e)("hour",s)("hourPart",1),u.xp6(2),u.Q6J("day",e)("hour",s)("hourPart",2),u.xp6(1),u.Q6J("day",e)("hour",s)("hourPart",3)}}function Ne(e,t){if(1&e&&(u.TgZ(0,"div",5)(1,"div")(2,"div",23),u._uU(3),u.qZA()(),u.TgZ(4,"div",24),u.YNc(5,Oe,7,13,"div",25),u.qZA()()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("width",s.calendar.sheetTimeWidth,"px"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(1),u.hij("",e,":00"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(1),u.Q6J("ngForOf",s.sheetDays)("ngForTrackBy",s.trackByIndexFn)}}function Ie(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-sheet-event",30),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.onEventDrop(t))})),u.qZA()}if(2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.ownerEvents[e.id+"_next"].style)}}function Pe(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",30),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.YNc(2,Ie,1,2,"calendar-sheet-event",31),u.BQk()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("event",e)("ngStyle",e.style),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.ownerEvents[e.id+"_next"])}}function Re(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-sheet-event",30),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.onEventDrop(t))})),u.qZA()}if(2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.userEvents[e.id+"_next"].style)}}function qe(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",30),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.YNc(2,Re,1,2,"calendar-sheet-event",31),u.BQk()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("event",e)("ngStyle",e.style),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"])}}function Ge(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",20),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function Le(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",20),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id+"_next"])}}function $e(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function Ve(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",20),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id+"_next"])}}function ze(e,t){if(1&e&&(u.ynx(0),u.YNc(1,Ge,1,2,"calendar-sheet-google-event",21),u.YNc(2,Le,1,2,"calendar-sheet-google-event",21),u.YNc(3,$e,1,2,"calendar-sheet-microsoft-event",21),u.YNc(4,Ve,1,2,"calendar-sheet-microsoft-event",21),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"]&&"google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.userEvents[e.id+"_next"]&&"microsoft"==e.type)}}let je=(()=>{class CalendarSheetWeek{language;cdRef;renderer;calendar;sheetDays=[];sheetHours=[];dropTargets;sheetContainer;scrollContainer;setdate={};groupwareVisible=!0;ownerMultiEvents=[];groupwareMultiEvents=[];ownerEvents=[];userEvents=[];userMultiEvents=[];groupwareEvents=[];nextDaySingleEvents={ownerEvents:{},userEvents:{},groupwareEvents:{}};subscription=new v.w0;resizeListener;constructor(e,t,s,n){this.language=e,this.cdRef=t,this.renderer=s,this.calendar=n,this.buildHours(),this.buildSheetDays(),this.subscribeToChanges()}get offset(){return moment.tz(this.calendar.timeZone).format("z Z")}get allMultiEvents(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.groupwareMultiEvents)}get sheetTimeWidth(){return this.calendar.sheetTimeWidth}get startDate(){return new moment(this.setdate).day(this.calendar.weekStartDay).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(moment.duration(this.calendar.weekDaysCount-1,"d")).hour(this.calendar.endHour)}get dayWidthStyle(){return{width:`calc(100% / ${this.calendar.weekDaysCount})`}}ngOnChanges(e){this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.subscription.unsubscribe()}trackByItemFn(e,t){return t.id}trackByIndexFn(e,t){return e}buildSheetDays(){this.sheetDays=[];let e=0,t=this.calendar.weekStartDay;for(;e<this.calendar.weekDaysCount;){let s=new moment(this.setdate);s.day(t),this.sheetDays.push({index:e,date:moment(s),day:t,color:this.isToday(moment(s))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(s).format("ddd"),dateTextDayNumber:moment(s).format("D"),items:[]}),e++,t++}}setSingleEventsStyle(){this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.groupwareEvents,Object.values(this.nextDaySingleEvents.ownerEvents),Object.values(this.nextDaySingleEvents.userEvents),Object.values(this.nextDaySingleEvents.groupwareEvents))).forEach((e=>this.setSingleEventStyle(e))),this.cdRef.detectChanges()}setSingleEventStyle(e){const t=1==this.calendar.weekStartDay&&0==e.start.day()?6:e.start.day()-this.calendar.weekStartDay,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),i=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,a=this.sheetContainer.element.nativeElement.clientWidth-i,r=(a-this.sheetTimeWidth)/this.calendar.weekDaysCount/(e.maxOverlay>0?e.maxOverlay:1),o=this.sheetTimeWidth+(a-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+r*e.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);e.style={left:o+"px",width:r+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}}setMultiEventsStyle(){this.allMultiEvents.forEach((e=>this.setMultiEventStyle(e))),this.cdRef.detectChanges()}setMultiEventStyle(e){let t=e.sequence-1;const s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-s-this.sheetTimeWidth)/this.calendar.weekDaysCount,i=moment(moment(this.setdate).day(this.calendar.weekStartDay).hour(0).format("YYYY-MM-DD HH:00:00")),a=moment(moment(i).add(moment.duration(this.calendar.weekDaysCount,"d")).hour(this.calendar.endHour)),r=e.start.isBefore(i)?i:e.start,o=e.end.isAfter(a)?a:e.end,l=+e.start.diff(i,"days")>0?+e.start.diff(i,"days"):0,d=l*n,c=this.calendar.weekDaysCount-l,h=Math.abs(o.diff(r,"days"))+(o.hour()>r.hour()||o.minute()>r.minute()?1:0),u=(h>c?c:h)*n;e.style={width:u+"px",left:d+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*t+"px"}}displayDate(e,t){return t.format(e)}buildHours(){this.sheetHours=[];let e=this.calendar.startHour;for(;e<=this.calendar.endHour;)this.sheetHours.push(e),e++}gotoDay(e){this.calendar.asPicker||this.calendar.gotToDayView(moment(e.format()))}isToday(e){let t=new moment;return t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()}subscribeToChanges(){this.subscription.add(this.calendar.layoutChange$.subscribe((()=>{this.buildSheetDays(),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle()}))),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>{this.setSingleEventsStyle(),this.setMultiEventsStyle()}))}getDaysDiff(e,t,s){let n=Math.ceil(t.diff(e,"day",!0).toFixed(1));return!s&&n>0&&0==t.hour()&&0==t.minute()&&n--,n}arrangeMultiEvents(){const e={};this.sheetDays.forEach((t=>e[t.date.date()]=t.index));const t=this.allMultiEvents.sort(((e,t)=>e.start.isBefore(t.start)?-1:1)).sort(((e,t)=>e.end.diff(e.start,"day")>t.end.diff(t.start,"day")&&e.start.isSameOrBefore(t.start,"day")?-1:1));this.sheetDays.forEach((e=>e.events=[])),t.forEach((t=>{delete t.sequence;const s=this.getDaysDiff(t.start,t.end,t.isAllDay);Array.from({length:s+1},((e,s)=>moment(t.start).add(s,"days"))).forEach((s=>{const n=this.sheetDays[e[s.date()]];n&&(isNaN(t.sequence)&&(t.sequence=n.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1),n.events.push(t))}));for(let e of this.sheetDays)for(let s=moment(t.start);s.diff(t.end,"days")<=-1;s.add(1,"days"))s.date()!=e.date.date()||e.events.some((e=>e.id==t.id))||e.events.push(t)})),this.cdRef.detectChanges()}generateNextDaySingleEvents(e){this[e].forEach((t=>{if(t.isMulti||t.start.date()==t.end.date())return;const s=moment(t.end);t.start.isBefore(this.sheetDays[0].date,"day")?t.start.date(this.sheetDays[0].date.date()).hour(this.calendar.startHour).minute(0):t.end.date(t.start.date()).hour(this.calendar.endHour+1).minute(0),this.nextDaySingleEvents[e][t.id+"_next"]={id:t.id+"_next",start:moment(t.start).add(1,"day").hour(this.calendar.startHour).minute(0),end:s}}))}getOwnerEvents(){if(this.ownerEvents=[],this.ownerMultiEvents=[],this.nextDaySingleEvents.ownerEvents=[],this.arrangeMultiEvents(),!this.calendar.ownerCalendarVisible)return this.setSingleEventsStyle();this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e.filter((e=>!e.isMulti)),this.ownerMultiEvents=e.filter((e=>e.isMulti)),this.generateNextDaySingleEvents("ownerEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getGroupwareEvents(){if(this.groupwareEvents=[],this.nextDaySingleEvents.groupwareEvents=[],this.groupwareMultiEvents=[],this.arrangeMultiEvents(),!this.groupwareVisible||this.calendar.isMobileView)return this.setSingleEventsStyle();this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.groupwareEvents=e.filter((e=>!e.isMulti)),this.groupwareMultiEvents=e.filter((e=>e.isMulti)),this.generateNextDaySingleEvents("groupwareEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getUserEvents(e){if(this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.nextDaySingleEvents.userEvents={},this.generateNextDaySingleEvents("userEvents"),this.userMultiEvents=this.userMultiEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.arrangeMultiEvents(),this.calendar.isMobileView||!e.visible)return this.setSingleEventsStyle();this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(e.forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.generateNextDaySingleEvents("userEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}getUsersEvents(){if(this.userEvents=[],this.nextDaySingleEvents.userEvents={},this.userMultiEvents=[],this.arrangeMultiEvents(),this.calendar.isMobileView)return this.setSingleEventsStyle();this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(e.forEach((e=>{e.isMulti?this.userMultiEvents.push(e):this.userEvents.push(e)})),this.generateNextDaySingleEvents("userEvents"),this.arrangeMultiEvents(),this.setSingleEventsStyle(),this.setMultiEventsStyle())}))}onEventDrop(e){this.calendar.onEventDrop(e,this.dropTargets)}static ɵfac=function(e){return new(e||CalendarSheetWeek)(u.Y36(g.d),u.Y36(u.sBO),u.Y36(u.Qsj),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarSheetWeek,selectors:[["calendar-sheet-week"]],viewQuery:function(e,t){if(1&e&&(u.Gf(Ze,7,u.s_b),u.Gf(Se,7,u.s_b),u.Gf($,5)),2&e){let e;u.iGM(e=u.CRH())&&(t.sheetContainer=e.first),u.iGM(e=u.CRH())&&(t.scrollContainer=e.first),u.iGM(e=u.CRH())&&(t.dropTargets=e)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.TTD],decls:21,vars:21,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%","width","100%"],["sheetContainer",""],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center"],[1,"slds-border--right","slds-grow"],[1,"slds-grid"],["class","slds-border--left",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-is-relative"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid",2,"box-shadow","0 2px var(--color-grey-7)"],["class","slds-border--left",3,"ngStyle","min-height",4,"ngFor","ngForOf","ngForTrackBy"],["aria-hidden","true",1,"slds-scrollable--y",2,"overflow","scroll","visibility","hidden","flex","none"],["scrollContainer",""],[1,"slds-scrollable--y","slds-is-relative","slds-grow","calendar-event-drag-boundary",2,"overflow-y","scroll"],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--left",3,"ngStyle"],[1,"slds-p-top--xx-small"],[1,"slds-text-body--regular","slds-p-left--x-small"],[1,"slds-p-left--x-small","slds-p-bottom--xx-small","slds-border--bottom","slds-text-heading--large"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"click"],[1,"spice-calendar-event",3,"event","ngStyle"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[3,"height",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow","slds-grid"],["class","slds-border--right",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--right",3,"ngStyle"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"day","hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop",4,"ngIf"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3),u._uU(4),u.qZA(),u.TgZ(5,"div",4)(6,"div",5),u.YNc(7,Je,7,5,"div",6),u.qZA(),u.TgZ(8,"div",7),u.YNc(9,Ye,2,2,"ng-container",8),u.YNc(10,Fe,2,2,"ng-container",8),u.YNc(11,Ae,3,2,"ng-container",8),u.qZA(),u.TgZ(12,"div",9),u.YNc(13,Be,2,5,"div",10),u.qZA()(),u._UZ(14,"div",11,12),u.qZA(),u.TgZ(16,"div",13),u.YNc(17,Ne,6,9,"div",14),u.YNc(18,Pe,3,3,"ng-container",8),u.YNc(19,qe,3,3,"ng-container",8),u.YNc(20,ze,5,4,"ng-container",8),u.qZA()()),2&e&&(u.xp6(3),u.Udp("width",t.calendar.sheetTimeWidth,"px"),u.xp6(1),u.hij(" ",t.offset," "),u.xp6(3),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.xp6(2),u.Q6J("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(2),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.xp6(4),u.Q6J("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.xp6(1),u.Q6J("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.sg,n.O5,n.PC,he,ge,$,pe],encapsulation:2,changeDetection:0})}return CalendarSheetWeek})();function We(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",15)(1,"div",16)(2,"div",17),u._uU(3),u.qZA(),u.TgZ(4,"div",17)(5,"a",18),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.gotoDay(t.date))})),u._uU(6),u.qZA()()()()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("color",e.color),u.Q6J("ngClass",s.dayTextContainerClass),u.xp6(1),u.Q6J("ngClass",s.dayTextClass),u.xp6(1),u.hij(" ",s.calendar.weekdayShort(e.day)," "),u.xp6(1),u.Q6J("ngClass",s.dateTextClass),u.xp6(2),u.hij(" ",e.dateTextDayNumber," ")}}function Ke(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",19),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function Xe(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",19),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("event",e)("ngStyle",e.style)}}function et(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",19),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function tt(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function st(e,t){if(1&e&&(u.ynx(0),u.YNc(1,et,1,2,"calendar-sheet-google-event",20),u.YNc(2,tt,1,2,"calendar-sheet-microsoft-event",20),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type)}}function nt(e,t){if(1&e&&u._UZ(0,"div"),2&e){const e=u.oxw(2);u.Udp("height",e.calendar.multiEventHeight,"px")}}function it(e,t){if(1&e&&(u.TgZ(0,"div",15),u.YNc(1,nt,1,2,"div",21),u.qZA()),2&e){const e=t.$implicit,s=u.oxw();u.Udp("min-height",s.calendar.multiEventHeight,"px"),u.xp6(1),u.Q6J("ngForOf",e.events)("ngForTrackBy",s.trackByItemFn)}}function at(e,t){if(1&e&&(u.TgZ(0,"div",25)(1,"div",26),u._UZ(2,"calendar-sheet-drop-target",27)(3,"calendar-sheet-drop-target",27),u.qZA(),u.TgZ(4,"div",28),u._UZ(5,"calendar-sheet-drop-target",27)(6,"calendar-sheet-drop-target",27),u.qZA()()),2&e){const e=t.$implicit,s=u.oxw().$implicit;u.xp6(2),u.Q6J("day",e)("hour",s)("hourPart",0),u.xp6(1),u.Q6J("day",e)("hour",s)("hourPart",1),u.xp6(2),u.Q6J("day",e)("hour",s)("hourPart",2),u.xp6(1),u.Q6J("day",e)("hour",s)("hourPart",3)}}function rt(e,t){if(1&e&&(u.TgZ(0,"div",5)(1,"div")(2,"div",22),u._uU(3),u.qZA()(),u.TgZ(4,"div",23),u.YNc(5,at,7,12,"div",24),u.qZA()()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Udp("width",s.calendar.sheetTimeWidth,"px"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(1),u.hij("",e,":00"),u.xp6(1),u.Udp("height",s.calendar.sheetHourHeight,"px"),u.xp6(1),u.Q6J("ngForOf",s.sheetDays)("ngForTrackBy",s.trackByIndexFn)}}function ot(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-sheet-event",29),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.onEventDrop(t))})),u.qZA()}if(2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.ownerEvents[e.id].style)}}function lt(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",29),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.YNc(2,ot,1,2,"calendar-sheet-event",30),u.BQk()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("event",e)("ngStyle",e.style),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.ownerEvents[e.id])}}function dt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-sheet-event",29),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.onEventDrop(t))})),u.qZA()}if(2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.userEvents[e.id].style)}}function ct(e,t){if(1&e){const e=u.EpF();u.ynx(0),u.TgZ(1,"calendar-sheet-event",29),u.NdJ("eventChange",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.setSingleEventsStyle())}))("eventDrop",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.onEventDrop(t))})),u.qZA(),u.YNc(2,dt,1,2,"calendar-sheet-event",30),u.BQk()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("event",e)("ngStyle",e.style),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.userEvents[e.id])}}function ht(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",19),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function ut(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",19),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id].style)}}function gt(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)("ngStyle",e.style)}}function mt(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Q6J("event",e)("ngStyle",t.nextDaySingleEvents.groupwareEvents[e.id].style)}}function pt(e,t){if(1&e&&(u.ynx(0),u.YNc(1,ht,1,2,"calendar-sheet-google-event",20),u.YNc(2,ut,1,2,"calendar-sheet-google-event",20),u.YNc(3,gt,1,2,"calendar-sheet-microsoft-event",20),u.YNc(4,mt,1,2,"calendar-sheet-microsoft-event",20),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.groupwareEvents[e.id]&&"google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type),u.xp6(1),u.Q6J("ngIf",s.nextDaySingleEvents.groupwareEvents[e.id]&&"microsoft"==e.type)}}let ft=(()=>{class CalendarSheetThreeDays extends je{dayTextContainerClass="";dayTextClass="slds-text-body--regular";dateTextClass="slds-text-heading--large";get startDate(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)}get endDate(){return new moment(this.startDate).add(moment.duration(2,"d")).hour(this.calendar.endHour)}ngOnInit(){this.calendar.isDashlet&&(this.dayTextContainerClass="slds-grid slds-grid--vertical-align-center",this.dayTextClass="slds-text-heading--medium",this.dateTextClass="slds-text-heading--medium")}buildSheetDays(){this.sheetDays=[];let e=0;for(;e<3;){let t=new moment(this.setdate);t=t.add(e,"days"),this.sheetDays.push({index:e,date:moment(t),day:moment(t).day(),color:this.isToday(moment(t))?this.calendar.todayColor:"#000000",dateTextDayShort:moment(t).format("ddd"),dateTextDayNumber:moment(t).format("D"),items:[]}),e++}}setSingleEventStyle(e){const t=this.sheetDays.find((t=>t.day==e.start.day()))||0,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),i=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,a=this.sheetContainer.element.nativeElement.clientWidth-i,r=(a-this.sheetTimeWidth)/3/(e.maxOverlay>0?e.maxOverlay:1),o=this.sheetTimeWidth+(a-this.sheetTimeWidth)/3*t.index+r*e.displayIndex,l=this.calendar.sheetHourHeight/60*s,d=this.calendar.sheetHourHeight/60*(n-s);e.style={left:o+"px",width:r+"px",top:l+"px",height:d+"px","min-height":this.calendar.multiEventHeight+"px"}}setMultiEventStyle(e){let t=null;const s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-s-this.sheetTimeWidth)/3,i=moment(moment(this.setdate).hour(0).format("YYYY-MM-DD HH:00:00")),a=moment(moment(i).add(moment.duration(3,"d")).hour(this.calendar.endHour)),r=e.start.isBefore(i)?i:e.start,o=e.end.isAfter(a)?a:e.end,l=+e.start.diff(i,"days")>0?+e.start.diff(i,"days"):0,d=l*n,c=3-l,h=Math.abs(o.diff(r,"days"))+(o.hour()>r.hour()||o.minute()>r.minute()?1:0),u=(h>c?c:h)*n;this.sheetDays.some((s=>{if(s.events.indexOf(e)>-1)return t=s.events.indexOf(e),!0})),e.style={width:u+"px",left:d+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*t+"px"}}displayDate(e,t){switch(e){case"day":return t.format("ddd");case"date":return t.format(this.calendar.isDashlet?"D, MMM":"D")}}static ɵfac=function(){let e;return function(t){return(e||(e=u.n5z(CalendarSheetThreeDays)))(t||CalendarSheetThreeDays)}}();static ɵcmp=u.Xpm({type:CalendarSheetThreeDays,selectors:[["calendar-sheet-three-days"]],features:[u.qOj],decls:21,vars:21,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%","width","100%"],["sheetContainer",""],[1,"slds-grid","slds-border--bottom"],[1,"slds-align--absolute-center","slds-m-around--none","slds-p-vertical--x-small","slds-text-align--center"],[1,"slds-border--right","slds-grow"],[1,"slds-grid"],["class","slds-border--left","style","width: calc(100% / 3)",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-is-relative"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid",2,"box-shadow","0 2px var(--color-grey-7)"],["style","width: calc(100% / 3)","class","slds-border--left",3,"min-height",4,"ngFor","ngForOf","ngForTrackBy"],["aria-hidden","true",1,"spice-scrollbar",2,"overflow","scroll","visibility","hidden","flex","none"],["scrollContainer",""],[1,"slds-scrollable","spice-scrollbar","slds-is-relative","slds-grow","calendar-event-drag-boundary",2,"overflow-y","scroll"],["class","slds-grid",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--left",2,"width","calc(100% / 3)"],[1,"slds-p-vertical--xx-small","slds-border--bottom",3,"ngClass"],[1,"slds-p-left--x-small","slds-truncate",3,"ngClass"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"click"],[1,"spice-calendar-event",3,"event","ngStyle"],["class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"],[3,"height",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-border--bottom"],[1,"slds-border--left","slds-border--bottom","slds-grow","slds-grid"],["class","slds-border--right","style","width: calc(100% / 3)",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-border--right",2,"width","calc(100% / 3)"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-drop-target",3,"day","hour","hourPart"],[1,"slds-border--top","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop"],["class","spice-calendar-event",3,"event","ngStyle","eventChange","eventDrop",4,"ngIf"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3),u._uU(4),u.qZA(),u.TgZ(5,"div",4)(6,"div",5),u.YNc(7,We,7,7,"div",6),u.qZA(),u.TgZ(8,"div",7),u.YNc(9,Ke,2,2,"ng-container",8),u.YNc(10,Xe,2,2,"ng-container",8),u.YNc(11,st,3,2,"ng-container",8),u.qZA(),u.TgZ(12,"div",9),u.YNc(13,it,2,4,"div",10),u.qZA()(),u._UZ(14,"div",11,12),u.qZA(),u.TgZ(16,"div",13),u.YNc(17,rt,6,9,"div",14),u.YNc(18,lt,3,3,"ng-container",8),u.YNc(19,ct,3,3,"ng-container",8),u.YNc(20,pt,5,4,"ng-container",8),u.qZA()()),2&e&&(u.xp6(3),u.Udp("width",t.calendar.sheetTimeWidth,"px"),u.xp6(1),u.hij(" ",t.offset," "),u.xp6(3),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.xp6(2),u.Q6J("ngForOf",t.ownerMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareMultiEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(2),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByIndexFn),u.xp6(4),u.Q6J("ngForOf",t.sheetHours)("ngForTrackBy",t.trackByIndexFn),u.xp6(1),u.Q6J("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.userEvents)("ngForTrackBy",t.trackByItemFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByItemFn))},dependencies:[n.mk,n.sg,n.O5,n.PC,he,ge,$,pe],encapsulation:2,changeDetection:0})}return CalendarSheetThreeDays})(),vt=(()=>{class CalendarMoreButton{elementRef;language;footer;injector;metadata;events=[];isMobileView=!1;sheetDay={};popoverComponentRef=null;showPopoverTimeout={};constructor(e,t,s,n,i){this.elementRef=e,this.language=t,this.footer=s,this.injector=n,this.metadata=i}ngOnDestroy(){this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)}onMouseOver(){this.showPopoverTimeout=window.setTimeout((()=>this.renderPopover()),500)}onMouseOut(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()}renderPopover(){this.metadata.addComponent("CalendarMorePopover",this.footer.modalcontainer,this.injector).subscribe((e=>{e.instance.events=this.events,e.instance.isMobileView=this.isMobileView,e.instance.sheetDay=this.sheetDay,e.instance.parentElementRef=this.elementRef,this.popoverComponentRef=e.instance}))}static ɵfac=function(e){return new(e||CalendarMoreButton)(u.Y36(u.SBq),u.Y36(g.d),u.Y36(ue.M),u.Y36(u.zs3),u.Y36(T.Pu))};static ɵcmp=u.Xpm({type:CalendarMoreButton,selectors:[["calendar-more-button"]],hostBindings:function(e,t){1&e&&u.NdJ("mouseenter",(function(){return t.onMouseOver()}))("mouseleave",(function(){return t.onMouseOut()}))},inputs:{events:["moreevents","events"],isMobileView:["ismobileview","isMobileView"],sheetDay:["sheetday","sheetDay"]},decls:2,vars:0,consts:[[2,"cursor","pointer"],["label","LBL_MORE"]],template:function(e,t){1&e&&(u.TgZ(0,"span",0),u._UZ(1,"system-label",1),u.qZA())},dependencies:[Y._],encapsulation:2})}return CalendarMoreButton})();const yt=["sheetContainer"];function xt(e,t){if(1&e&&(u.TgZ(0,"div",8),u._uU(1),u.qZA()),2&e){const e=t.$implicit,s=u.oxw();u.Q6J("ngStyle",s.getDayColStyle(e.text)),u.xp6(1),u.hij("",s.calendar.weekdayShort(e.day)," ")}}function wt(e,t){if(1&e&&u._UZ(0,"calendar-more-button",16),2&e){const e=u.oxw().$implicit,t=u.oxw(2);u.Q6J("sheetday",e)("moreevents",e.events)("ismobileview",t.calendar.isMobileView)}}function bt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",11),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw(2);return u.KtG(s.openAddModal(t.date))})),u.TgZ(1,"div",12)(2,"a",13),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw(2);return u.KtG(s.gotoDay(t))})),u._uU(3),u.qZA()(),u.TgZ(4,"div",14),u.YNc(5,wt,1,3,"calendar-more-button",15),u.qZA()()}if(2&e){const e=t.$implicit,s=t.index,n=u.oxw().index,i=u.oxw();u.Q6J("ngStyle",i.getDayStyle(n,s,e.month)),u.xp6(1),u.Udp("height",i.offsetHeight,"px"),u.xp6(1),u.Q6J("ngStyle",i.isTodayStyle(e.day,e.month)),u.xp6(1),u.Oqu(e.day),u.xp6(1),u.Udp("height",i.offsetHeight,"px"),u.xp6(1),u.Q6J("ngIf",e.events.length>0&&e.events.length>i.maxEventsPerDay)}}function Ct(e,t){if(1&e&&u._UZ(0,"div",17),2&e){const e=u.oxw().index,t=u.oxw();u.Q6J("ngStyle",t.getWeekDividerStyle(e+1))}}function Et(e,t){if(1&e&&(u.ynx(0),u.YNc(1,bt,6,8,"div",9),u.YNc(2,Ct,1,1,"div",10),u.BQk()),2&e){const e=t.$implicit,s=t.last,n=u.oxw();u.xp6(1),u.Q6J("ngForOf",e)("ngForTrackBy",n.trackByFnDate),u.xp6(1),u.Q6J("ngIf",!s)}}function Dt(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"div",18),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngStyle",s.getDayDividerStyle(e.index))}}function _t(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",19),u.BQk()),2&e){const e=t.$implicit,s=u.oxw().$implicit;u.xp6(1),u.Q6J("event",s)("ngStyle",s.existsInRanges[e.key].style)}}function kt(e,t){if(1&e&&(u.ynx(0),u.YNc(1,_t,2,2,"ng-container",7),u.ALo(2,"keyvalue"),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}function Tt(e,t){if(1&e&&(u.ynx(0),u._UZ(1,"calendar-sheet-event",19),u.BQk()),2&e){const e=t.$implicit,s=u.oxw().$implicit;u.xp6(1),u.Q6J("event",s)("ngStyle",s.existsInRanges[e.key].style)}}function Mt(e,t){if(1&e&&(u.ynx(0),u.YNc(1,Tt,2,2,"ng-container",7),u.ALo(2,"keyvalue"),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}function Zt(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",19),2&e){const e=u.oxw().$implicit,t=u.oxw().$implicit;u.Q6J("event",t)("ngStyle",t.existsInRanges[e.key].style)}}function St(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",19),2&e){const e=u.oxw().$implicit,t=u.oxw().$implicit;u.Q6J("event",t)("ngStyle",t.existsInRanges[e.key].style)}}function Jt(e,t){if(1&e&&(u.ynx(0),u.YNc(1,Zt,1,2,"calendar-sheet-google-event",20),u.YNc(2,St,1,2,"calendar-sheet-microsoft-event",20),u.BQk()),2&e){const e=u.oxw().$implicit;u.xp6(1),u.Q6J("ngIf","google"==e.type),u.xp6(1),u.Q6J("ngIf","microsoft"==e.type)}}function Yt(e,t){if(1&e&&(u.ynx(0),u.YNc(1,Jt,3,2,"ng-container",7),u.ALo(2,"keyvalue"),u.BQk()),2&e){const e=t.$implicit,s=u.oxw();u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,2,e.existsInRanges))("ngForTrackBy",s.trackByFn)}}let Ft=(()=>{class CalendarSheetMonth{language;broadcast;navigation;elementRef;backend;renderer;cdRef;calendar;sheetDays=[];sheetContainer;setdate={};groupwareVisible=!0;monthGrid=[];weeksIndices={};daysIndices={};offsetHeight=20;ownerEvents=[];userEvents=[];groupwareEvents=[];resizeListener;subscription=new v.w0;maxEventsPerDay=1;constructor(e,t,s,n,i,a,r,o){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=i,this.renderer=a,this.cdRef=r,this.calendar=o,this.buildSheetDays(),this.subscribeToChanges()}get allEvents(){return this.ownerEvents.concat(this.userEvents,this.groupwareEvents)}get eventHeight(){return this.calendar.isMobileView?20:25}setMaxEventsPerDay(){const e=this.sheetContainer?this.sheetContainer.element.nativeElement.clientHeight/5:void 0;this.maxEventsPerDay=e?Math.floor((e-2*this.offsetHeight)/this.eventHeight):1,this.cdRef.detectChanges()}get startDate(){return new moment(this.setdate).date(1).hour(0).minute(0).second(0)}get endDate(){return new moment(this.startDate).endOf("month")}ngAfterViewInit(){this.setMaxEventsPerDay()}ngOnChanges(e){this.buildGrid(),this.buildSheetDays(),e.setdate&&(this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.cdRef.detach(),this.subscription.unsubscribe()}subscribeToChanges(){this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)}))),this.resizeListener=this.renderer.listen("window","resize",(()=>{this.setMaxEventsPerDay(),this.setEventsStyle()}))}trackByFn(e,t){return t.id}trackByFnDate(e,t){return e}buildSheetDays(){this.sheetDays=[];let e=0,t=this.calendar.weekStartDay,s=moment.weekdaysShort();for(;e<this.calendar.weekDaysCount;)this.sheetDays.push({index:e,text:s[t],day:t}),e++,t++,t>6&&(t=0)}getOwnerEvents(){this.ownerEvents=[],this.handleEventsChanges(),this.calendar.ownerCalendarVisible&&this.calendar.loadEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e,this.handleEventsChanges())}))}getGroupwareEvents(){this.groupwareEvents=[],this.handleEventsChanges(),this.groupwareVisible&&!this.calendar.isMobileView&&this.calendar.loadGroupwareEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.groupwareEvents=e,this.handleEventsChanges())}))}getUserEvents(e){this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.handleEventsChanges(),!this.calendar.isMobileView&&e.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,e.id).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.handleEventsChanges())}))}getUsersEvents(){this.userEvents=[],this.handleEventsChanges(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.handleEventsChanges())}))}handleEventsChanges(){this.monthGrid.forEach((e=>e.forEach((e=>{e.events=[]})))),this.spreadEvents(),this.setEventsStyle()}spreadEvents(){this.allEvents.sort(((e,t)=>e.start.isBefore(t.start)?-1:1)).sort(((e,t)=>e.end.diff(e.start,"day")>t.end.diff(t.start,"day")&&e.start.isSameOrBefore(t.start,"day")?-1:1)).forEach((e=>{if(delete e.sequence,e.existsInRanges={},e.isMulti)this.spreadEventIntoRanges(e);else{const t=this.monthGrid[this.weeksIndices[e.start.week()]][this.daysIndices[`${e.start.month()}${e.start.date()}`]];if(!t)return;e.existsInRanges[t.date.week()]={from:t.date.format(),to:t.date.format()},e.sequence=t.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1,t.events.push(e)}})),this.cdRef.detectChanges()}getDaysDiff(e,t,s){let n=Math.ceil(t.diff(e,"day",!0).toFixed(1));return!s&&n>0&&0==t.hour()&&0==t.minute()&&n--,n}spreadEventIntoRanges(e){const t=this.getDaysDiff(e.start,e.end,e.isAllDay);Array.from({length:t+1},((t,s)=>moment(e.start).add(s,"days"))).forEach((s=>{const n=this.monthGrid[this.weeksIndices[s.week()]][this.daysIndices[`${s.month()}${s.date()}`]];if(!n)return;const i=this.monthGrid[this.weeksIndices[n.date.week()]][this.monthGrid[this.weeksIndices[n.date.week()]].length-1].date;e.existsInRanges[n.date.week()]?!e.existsInRanges[n.date.week()].to&&e.end.isBefore(i)?e.existsInRanges[n.date.week()].to=e.end.format():e.existsInRanges[n.date.week()].to||(e.existsInRanges[n.date.week()].to=i.format()):(e.existsInRanges[n.date.week()]={from:n.date.format()},n.date.isSame(i,"days")&&(e.existsInRanges[n.date.week()].to=i.format()),(n.date.isSame(e.end,"days")||0==t)&&(e.existsInRanges[n.date.week()].to=n.date.format())),isNaN(e.sequence)&&(e.sequence=n.events.sort(((e,t)=>e.sequence>t.sequence?1:-1)).reduce(((e,t)=>e+1==t.sequence?e+1:e),0)+1),n.events.push(e)}))}gotoDay(e){let t=moment(this.setdate);t.month(e.month).date(e.day),this.calendar.gotToDayView(t)}getDayColStyle(e){let t=new moment,s=t.format("ddd"),n=this.calendar.calendarDate,i=n.year()==t.year()&&n.month()==t.month()&&s==e;return{width:`calc(100% / ${this.calendar.weekDaysCount})`,color:i?this.calendar.todayColor:"inherit","font-weight":i?"600":"inherit"}}getDayDividerStyle(e){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*e+"px",top:"0px",height:"100%"}}buildGrid(){this.monthGrid=[],this.weeksIndices={},this.daysIndices={};const e=moment(this.setdate.format()).date(1).day(this.calendar.weekStartDay).format();this.monthGrid=Array.from({length:5},((t,s)=>moment(moment(e).add(s,"weeks")))).map((e=>Array.from({length:this.calendar.weekDaysCount},((t,s)=>{const n=moment(moment(e).day(this.calendar.weekStartDay+s).format());return{date:n,day:n.date(),month:n.month(),events:[]}})))),this.monthGrid.forEach(((e,t)=>{e.forEach(((e,t)=>{this.daysIndices[`${e.month}${e.day}`]||(this.daysIndices[`${e.month}${e.day}`]=t)})),this.weeksIndices[e[0].date.week()]=t}))}notThisMonth(e){return e!==this.setdate.month()}getWeekDividerStyle(e){return{top:"calc((100% / "+this.monthGrid.length+") * "+e+" )"}}getDayStyle(e,t,s){return{left:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount*t+"px",top:`calc((100% / ${this.monthGrid.length}) * ${e})`,color:this.notThisMonth(s)?"#9faab5":"inherit","background-color":this.notThisMonth(s)?"#f4f6f9":"transparent",width:this.sheetContainer.element.nativeElement.clientWidth/this.calendar.weekDaysCount+"px",height:"calc(100% / "+this.monthGrid.length+")","min-height":"70px"}}setEventsStyle(){this.allEvents.forEach((e=>{Object.keys(e.existsInRanges).forEach((t=>e.existsInRanges[t].style=this.getEventStyle(e,e.existsInRanges[t],t)))})),this.cdRef.detectChanges()}getEventStyle(e,t,s){const n=e.sequence-1;if(n>=this.maxEventsPerDay)return{display:"none"};const i=moment(t.from),a=this.getDaysDiff(i,moment(t.to),e.isAllDay)+1,r=this.sheetContainer.element.nativeElement;return{left:r.clientWidth/this.calendar.weekDaysCount*this.daysIndices[`${i.month()}${i.date()}`]+"px",width:r.clientWidth/this.calendar.weekDaysCount*a+"px",top:this.offsetHeight+r.clientHeight/this.monthGrid.length*this.weeksIndices[s]+this.eventHeight*n+"px",height:this.eventHeight+"px",display:"block"}}isTodayStyle(e,t){let s=this.calendar.calendarDate.year(),n=new moment,i=s===n.year()&&n.month()===t&&n.date()==e;return{"border-radius":"50%","line-height":"1rem","text-align":"center",width:"1.1rem",height:"1.1rem",display:"block",color:i?"#fff":"inherit","background-color":i?this.calendar.todayColor:"inherit"}}openAddModal(e){this.calendar.addingEvent$.emit(e)}static ɵfac=function(e){return new(e||CalendarSheetMonth)(u.Y36(g.d),u.Y36(D.f),u.Y36(m.G),u.Y36(u.SBq),u.Y36(C.y),u.Y36(u.Qsj),u.Y36(u.sBO),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarSheetMonth,selectors:[["calendar-sheet-month"]],viewQuery:function(e,t){if(1&e&&u.Gf(yt,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.sheetContainer=e.first)}},inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},features:[u.TTD],decls:12,vars:12,consts:[[1,"slds-grid","slds-grid_vertical",2,"height","100%"],[1,"slds-border--bottom"],[1,"slds-grid"],["class","slds-text-align--center slds-p-vertical--small slds-border--left",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-scrollable","slds-grow"],[1,"slds-p-vertical--medium","slds-is-relative","slds-height_full",2,"min-height","375px"],["sheetContainer",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-text-align--center","slds-p-vertical--small","slds-border--left",3,"ngStyle"],["class","slds-is-absolute slds-truncate",3,"ngStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-is-absolute slds-border--bottom slds-size--1-of-1",3,"ngStyle",4,"ngIf"],[1,"slds-is-absolute","slds-truncate",3,"ngStyle","click"],[1,"slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-text-link--reset",3,"ngStyle","click"],[1,"slds-grid","slds-grid--align-center","slds-is-absolute",2,"bottom","0","width","100%"],[3,"sheetday","moreevents","ismobileview",4,"ngIf"],[3,"sheetday","moreevents","ismobileview"],[1,"slds-is-absolute","slds-border--bottom","slds-size--1-of-1",3,"ngStyle"],[1,"slds-is-absolute","slds-border--left",3,"ngStyle"],[1,"spice-calendar-event",2,"padding","1px 0",3,"event","ngStyle"],["style","padding: 1px 0","class","spice-calendar-event",3,"event","ngStyle",4,"ngIf"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2),u.YNc(3,xt,2,2,"div",3),u.qZA()(),u.TgZ(4,"div",4)(5,"div",5,6),u.YNc(7,Et,3,3,"ng-container",7),u.YNc(8,Dt,2,1,"ng-container",7),u.YNc(9,kt,3,4,"ng-container",7),u.YNc(10,Mt,3,4,"ng-container",7),u.YNc(11,Yt,3,4,"ng-container",7),u.qZA()()()),2&e&&(u.xp6(3),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByFnDate),u.xp6(4),u.Q6J("ngForOf",t.monthGrid)("ngForTrackBy",t.trackByFnDate),u.xp6(1),u.Q6J("ngForOf",t.sheetDays)("ngForTrackBy",t.trackByFnDate),u.xp6(1),u.Q6J("ngForOf",t.ownerEvents)("ngForTrackBy",t.trackByFn),u.xp6(1),u.Q6J("ngForOf",t.userEvents)("ngForTrackBy",t.trackByFn),u.xp6(1),u.Q6J("ngForOf",t.groupwareEvents)("ngForTrackBy",t.trackByFn))},dependencies:[n.sg,n.O5,n.PC,he,ge,vt,pe,n.Nd],encapsulation:2,changeDetection:0})}return CalendarSheetMonth})();function Qt(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",16),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)}}function Ut(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",16),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)}}function At(e,t){if(1&e&&u._UZ(0,"calendar-sheet-event",16),2&e){const e=u.oxw().$implicit;u.Q6J("event",e)}}function Ht(e,t){if(1&e&&(u.TgZ(0,"div",9)(1,"div",10),u._UZ(2,"system-button-icon",11),u.qZA(),u.TgZ(3,"div",12),u._uU(4),u.qZA(),u.TgZ(5,"div",13),u.YNc(6,Qt,1,1,"calendar-sheet-google-event",14),u.YNc(7,Ut,1,1,"calendar-sheet-microsoft-event",14),u.YNc(8,At,1,1,"calendar-sheet-event",15),u.qZA()()),2&e){const e=t.$implicit,s=t.last;u.ekj("slds-border--bottom",!s),u.xp6(1),u.Udp("color",e.color),u.xp6(2),u.Q6J("title",e.timeText),u.xp6(1),u.hij(" ",e.timeText," "),u.xp6(1),u.Q6J("ngSwitch",e.type),u.xp6(1),u.Q6J("ngSwitchCase","google"),u.xp6(1),u.Q6J("ngSwitchCase","microsoft")}}function Bt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",4)(1,"div",5)(2,"div"),u._uU(3),u.qZA(),u.TgZ(4,"div")(5,"a",6),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.goToDay(t.date))})),u._uU(6),u.qZA()()(),u.TgZ(7,"div",7),u.YNc(8,Ht,9,9,"div",8),u.qZA()()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(3),u.Oqu(e.dayShortText),u.xp6(3),u.hij(" ",e.dateText," "),u.xp6(2),u.Q6J("ngForOf",e.events)("ngForTrackBy",s.trackByFn)}}function Ot(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",17),u._UZ(1,"system-label",18),u.TgZ(2,"span",19),u._uU(3),u.qZA(),u.TgZ(4,"a",20),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.loadMore())})),u._UZ(5,"system-label",21),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(3),u.AsE("",e.calendar.monthShort(e.untilDate.month()),"",e.untilDate.format("D, Y"),"")}}function Nt(e,t){1&e&&(u.TgZ(0,"div",22),u._UZ(1,"system-label",23),u.qZA())}let It=(()=>{class CalendarSheetSchedule{language;broadcast;navigation;elementRef;backend;session;cdRef;calendar;untildate$=new u.vpe;eventDays=[];setdate={};groupwareVisible=!0;ownerEvents=[];userEvents=[];groupwareEvents=[];untilDate={};subscription=new v.w0;constructor(e,t,s,n,i,a,r,o){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=i,this.session=a,this.cdRef=r,this.calendar=o,this.untilDate=(new moment).hour(0).minute(0).second(0).add(1,"M"),this.subscription.add(this.calendar.userCalendarChange$.subscribe((e=>{"owner"==e.id?this.getOwnerEvents():this.getUserEvents(e)})))}get showNoRecordsMsg(){return 0==this.eventDays.length&&this.calendar.isDashlet}get startDate(){return new moment(this.setdate).hour(0).minute(0).second(0)}ngOnChanges(e){e.setdate&&(this.setUntilDate(),this.getOwnerEvents(),this.getUsersEvents()),(e.groupwareVisible||e.setdate)&&this.getGroupwareEvents()}ngOnDestroy(){this.subscription.unsubscribe()}setEventDays(){let e=this.groupByDay(this.ownerEvents.concat(this.userEvents,this.groupwareEvents));e.forEach((e=>e.events.sort(((e,t)=>e.start-t.start)))),this.eventDays=e.sort(((e,t)=>e.date-t.date)),this.cdRef.detectChanges()}trackByFn(e,t){return t.id}trackByFnDate(e,t){return e}setUntilDate(){this.untilDate=moment(this.setdate).add(1,"M"),this.untildate$.emit(this.untilDate)}groupByDay(e){let t=[],s=new moment(this.setdate).hour(0).minute(0).second(0);for(let n of e){let e=new moment(n.start).hour(0).minute(0).second(0),i=new moment(n.end).hour(0).minute(0).second(0);for(let a=moment(e);a.diff(i,"days")<=0;a.add(1,"days")){let e=s.year()==a.year()&&s.month()==a.month()&&s.date()==a.date();if(a.isAfter(s)||e){n.timeText=n.isMulti?"All Day":`${n.start.format("HH:mm")} - ${n.end.format("HH:mm")} `;let e={year:a.year(),month:a.month(),day:a.date(),date:moment(a),dateText:moment(a).format("MMM D, YYYY"),dayShortText:moment(a).format("ddd"),events:[n]},s=-1;t.some(((e,t)=>{if(e.year==a.year()&&e.month==a.month()&&e.day==a.date())return s=t,!0})),t.length>0&&s>-1?t[s].events.push({...n}):t.push(e)}}}return t}getOwnerEvents(){if(this.ownerEvents=[],this.setEventDays(),!this.calendar.ownerCalendarVisible)return this.cdRef.detectChanges();this.calendar.loadEvents(this.startDate,this.untilDate).subscribe((e=>{e.length>0&&(this.ownerEvents=e),this.setEventDays()}))}getGroupwareEvents(){this.groupwareEvents=[],this.groupwareVisible&&!this.calendar.isMobileView?this.calendar.loadGroupwareEvents(this.startDate,this.untilDate).subscribe((e=>{this.groupwareEvents=e,this.setEventDays()})):this.setEventDays()}getUserEvents(e){this.userEvents=this.userEvents.filter((t=>!(t.data.assigned_user_id==e.id||t.data.meeting_user_status_accept&&t.data.meeting_user_status_accept.beans[e.id]))),this.setEventDays(),!this.calendar.isMobileView&&e.visible&&this.calendar.loadUserEvents(this.startDate,this.untilDate,e.id).subscribe((e=>{e.length>0&&(this.userEvents=[...this.userEvents,...e],this.setEventDays())}))}getUsersEvents(){this.userEvents=[],this.setEventDays(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.untilDate).subscribe((e=>{e.length>0&&(this.userEvents=e,this.setEventDays())}))}goToDay(e){this.calendar.gotToDayView(e)}loadMore(){this.untilDate=moment(this.untilDate).add(1,"M"),this.untildate$.emit(this.untilDate),this.getOwnerEvents(),this.getGroupwareEvents(),this.getUsersEvents()}static ɵfac=function(e){return new(e||CalendarSheetSchedule)(u.Y36(g.d),u.Y36(D.f),u.Y36(m.G),u.Y36(u.SBq),u.Y36(C.y),u.Y36(E.n),u.Y36(u.sBO),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarSheetSchedule,selectors:[["calendar-sheet-schedule"]],inputs:{setdate:"setdate",groupwareVisible:"groupwareVisible"},outputs:{untildate$:"untildate$"},features:[u.TTD],decls:4,vars:4,consts:[[1,"slds-scrollable--y",2,"height","100%"],["class","slds-grid slds-border--bottom",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-grid slds-p-around--small",4,"ngIf"],["class","slds-align_absolute-center slds-m-top--medium",4,"ngIf"],[1,"slds-grid","slds-border--bottom"],[1,"slds-border--right","slds-p-around--xx-small","slds-size--1-of-4"],[1,"slds-text-link",2,"cursor","pointer",3,"click"],[1,"slds-size--3-of-4"],["class","slds-grid slds-p-horizontal--xx-small",3,"slds-border--bottom",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-grid","slds-p-horizontal--xx-small"],[1,"slds-button","slds-button--icon","slds-m-right--x-small","slds-p-top--xxx-small",2,"height","100%"],["icon","user","size","small"],[1,"slds-truncate","slds-size--1-of-4",2,"height","100%",3,"title"],[1,"slds-grow",3,"ngSwitch"],["style","position: initial","class","spice-calendar-event",3,"event",4,"ngSwitchCase"],["style","position: initial","class","spice-calendar-event",3,"event",4,"ngSwitchDefault"],[1,"spice-calendar-event",2,"position","initial",3,"event"],[1,"slds-grid","slds-p-around--small"],["label","MSG_SHOWING_EVENTS_UNTIL"],[1,"slds-m-left--xx-small"],[1,"slds-text-link","slds-m-left--xx-small",2,"cursor","pointer",3,"click"],["label","LBL_MORE"],[1,"slds-align_absolute-center","slds-m-top--medium"],["label","MSG_NO_RECORDS_FOUND"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0),u.YNc(1,Bt,9,4,"div",1),u.YNc(2,Ot,6,2,"div",2),u.YNc(3,Nt,2,0,"div",3),u.qZA()),2&e&&(u.xp6(1),u.Q6J("ngForOf",t.eventDays)("ngForTrackBy",t.trackByFnDate),u.xp6(1),u.Q6J("ngIf",!t.showNoRecordsMsg),u.xp6(1),u.Q6J("ngIf",t.showNoRecordsMsg))},dependencies:[n.sg,n.O5,n.RF,n.n9,n.ED,Z.J,Y._,he,ge,pe],encapsulation:2,changeDetection:0})}return CalendarSheetSchedule})();var Pt=s(10382),Rt=s(22487),qt=s(83398);function Gt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"li",8)(1,"a",9),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.pickColor(t))})),u.TgZ(2,"span",10)(3,"span",11),u._uU(4),u.qZA()()()()}if(2&e){const e=t.$implicit;u.xp6(2),u.Udp("background-color","#"+e),u.xp6(2),u.hij("#",e,"")}}let Lt=(()=>{class CalendarColorPicker{calendar;colorChange=new u.vpe;isOpen=!1;constructor(e){this.calendar=e}pickColor(e){this.colorChange.emit("#"+e),this.isOpen=!1}static ɵfac=function(e){return new(e||CalendarColorPicker)(u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarColorPicker,selectors:[["calendar-color-picker"]],outputs:{colorChange:"colorChange"},decls:8,vars:3,consts:[[1,"slds-dropdown-trigger","slds-dropdown-trigger_click","slds-m-right--x-small"],["aria-haspopup","true",1,"slds-button","slds-button--icon",3,"click"],["icon","palette","size","small"],[1,"slds-dropdown","slds-dropdown--right","slds-dropdown_bottom"],[1,"slds-color-picker","slds-color-picker_swatches-only"],[1,"slds-color-picker__selector"],["role","menu",1,"slds-color-picker__swatches"],["class","slds-color-picker__swatch","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-color-picker__swatch"],["role","menuitem",1,"slds-color-picker__swatch-trigger","slds-is-selected",3,"click"],[1,"slds-swatch"],[1,"slds-assistive-text"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"button",1),u.NdJ("click",(function(){return t.isOpen=!t.isOpen})),u._UZ(2,"system-button-icon",2),u.qZA(),u.TgZ(3,"div",3)(4,"div",4)(5,"div",5)(6,"ul",6),u.YNc(7,Gt,5,3,"li",7),u.qZA()()()()()),2&e&&(u.ekj("slds-is-open",t.isOpen),u.xp6(7),u.Q6J("ngForOf",t.calendar.colorPalette))},dependencies:[n.sg,Z.J],encapsulation:2,changeDetection:0})}return CalendarColorPicker})();const $t=["inputcontainer"],Vt=function(){return{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}},zt=function(){return{}};function jt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",20),u.NdJ("mouseenter",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.hovered="google")}))("mouseleave",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.hovered="")})),u.TgZ(1,"div",5),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.toggleVisible(null,"Google"))})),u._UZ(2,"img",21),u.TgZ(3,"a",8),u._UZ(4,"system-label",22),u.qZA()()()}if(2&e){const e=u.oxw();u.Q6J("ngClass","google"==e.hovered?"slds-theme--shade":""),u.xp6(2),u.Q6J("ngStyle",e.groupwareVisible?u.DdM(5,zt):u.DdM(4,Vt)),u.xp6(1),u.Udp("color",e.groupwareVisible?e.calendar.groupwareColor:"#dddbda")}}function Wt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",20),u.NdJ("mouseenter",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.hovered="microsoft")}))("mouseleave",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.hovered="")})),u.TgZ(1,"div",5),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.toggleVisible(null,"Google"))})),u._UZ(2,"img",23),u.TgZ(3,"a",8),u._UZ(4,"system-label",24),u.qZA()()()}if(2&e){const e=u.oxw();u.Q6J("ngClass","microsoft"==e.hovered?"slds-theme--shade":""),u.xp6(2),u.Q6J("ngStyle",e.groupwareVisible?u.DdM(5,zt):u.DdM(4,Vt)),u.xp6(1),u.Udp("color",e.groupwareVisible?e.calendar.groupwareColor:"#dddbda")}}function Kt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-color-picker",28),u.NdJ("colorChange",(function(t){u.CHM(e);const s=u.oxw().$implicit,n=u.oxw();return u.KtG(n.setUserColor(s.id,t))})),u.qZA()}}function Xt(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",4),u.NdJ("mouseenter",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.hovered=t.id)}))("mouseleave",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.hovered="")})),u.TgZ(1,"div",5),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.toggleVisible(t.id,"Users"))})),u.TgZ(2,"div",6),u._UZ(3,"system-button-icon",7),u.qZA(),u.TgZ(4,"a",8),u._uU(5),u.qZA()(),u.TgZ(6,"div"),u.YNc(7,Kt,1,0,"calendar-color-picker",25),u.TgZ(8,"button",26),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.removeUserCalendar(t.id))})),u._UZ(9,"system-button-icon",27),u.qZA()()()}if(2&e){const e=t.$implicit,s=u.oxw();u.ekj("slds-theme--shade",s.hovered==e.id),u.xp6(2),u.Udp("color",e.visible?e.color:"#dddbda"),u.xp6(2),u.Udp("color",e.visible?e.color:"#dddbda"),u.xp6(1),u.Oqu(e.name),u.xp6(2),u.Q6J("ngIf",s.hovered==e.id)}}function es(e,t){if(1&e&&(u.TgZ(0,"div",34),u._uU(1),u._UZ(2,"system-label",35)(3,"system-label",36),u.qZA()),2&e){const e=u.oxw(2);u.xp6(1),u.hij(" ",e.resultsList.length," ")}}function ts(e,t){1&e&&(u.TgZ(0,"div",34),u._UZ(1,"system-label",37),u.qZA())}function ss(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"li",39),u.NdJ("mousedown",(function(){const t=u.CHM(e).$implicit,s=u.oxw(3);return u.KtG(s.addUserCalendar(t.id,t.summary_text))})),u.TgZ(1,"div",40),u._UZ(2,"system-icon",41),u.TgZ(3,"span",42),u._uU(4),u.qZA()()()}if(2&e){const e=t.$implicit;u.xp6(4),u.Oqu(e.summary_text)}}function ns(e,t){if(1&e&&(u.ynx(0),u.YNc(1,ss,5,1,"li",38),u.BQk()),2&e){const e=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",e.resultsList)("ngForTrackBy",e.trackByFn)}}function is(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"li",39),u.NdJ("mousedown",(function(){const t=u.CHM(e).$implicit,s=u.oxw(3);return u.KtG(s.addUserCalendar(t.item_id,t.item_summary))})),u.TgZ(1,"div",40),u._UZ(2,"system-icon",41),u.TgZ(3,"span",42),u._uU(4),u.qZA()()()}if(2&e){const e=t.$implicit;u.xp6(4),u.Oqu(e.item_summary)}}function as(e,t){if(1&e&&(u.ynx(0),u.YNc(1,is,5,1,"li",38),u.BQk()),2&e){const e=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",e.recentUsers)("ngForTrackBy",e.trackByFn)}}function rs(e,t){1&e&&u._UZ(0,"system-spinner",43),2&e&&u.Q6J("size",16)}function os(e,t){if(1&e&&(u.TgZ(0,"div",29),u.YNc(1,es,4,1,"div",30),u.YNc(2,ts,2,0,"div",30),u.TgZ(3,"ul",31),u.YNc(4,ns,2,2,"ng-container",32),u.YNc(5,as,2,2,"ng-container",32),u.qZA(),u.YNc(6,rs,1,1,"system-spinner",33),u.qZA()),2&e){const e=u.oxw();u.Q6J("ngStyle",e.lookupMenuStyle),u.xp6(1),u.Q6J("ngIf",e.searchterm.length>0),u.xp6(1),u.Q6J("ngIf",0==e.searchterm.length),u.xp6(2),u.Q6J("ngIf",e.searchterm.length>0),u.xp6(1),u.Q6J("ngIf",0==e.searchterm.length),u.xp6(1),u.Q6J("ngIf",e.isLoading&&0==e.resultsList.length)}}let ls=(()=>{class CalendarOtherCalendarsMonitor{language;recent;calendar;fts;usersCalendars=[];groupwareVisible$=new u.vpe;searchterm="";searchopen=!1;resultsList=[];recentUsers=[];timeout=void 0;isLoading=!1;hovered="";inputContainer;groupwareVisible=!0;constructor(e,t,s,n){this.language=e,this.recent=t,this.calendar=s,this.fts=n,this.getRecent()}get searchOpen(){return this.searchopen}set searchOpen(e){this.searchopen=e,e&&this.getRecent()}get lookupMenuStyle(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}}get searchTerm(){return this.searchterm}set searchTerm(e){window.clearTimeout(this.timeout),e&&0!=e.length&&(this.timeout=window.setTimeout((()=>{this.searchterm=e,this.isLoading=!0,this.fts.searchByModules({searchterm:this.searchterm,modules:["Users"],size:5,sortparams:{sortfield:"full_name",sortdirection:"asc"}}).subscribe((e=>{this.filterResultsList(e.Users.hits.map((e=>e._source))),this.isLoading=!1}),(e=>this.isLoading=!1))}),500))}getRecent(){this.recent.getModuleRecent("Users").subscribe((e=>this.filterRecent(e)))}filterRecent(e){this.recentUsers=e.filter((e=>e.item_id!=this.calendar.owner&&null==_.findWhere(this.calendar.usersCalendars,{id:e.item_id})))}filterResultsList(e){this.resultsList=e.filter((e=>e.id!=this.calendar.owner&&null==_.findWhere(this.calendar.usersCalendars,{id:e.id})))}trackByFn(e,t){return t.id}addUserCalendar(e,t){this.calendar.addUserCalendar(e,t),this.filterRecent(this.recentUsers),this.filterResultsList(this.resultsList)}removeUserCalendar(e){this.calendar.removeUserCalendar(e)}toggleVisible(e,t){switch(t){case"Owner":this.calendar.toggleOwnerCalendarVisible();break;case"Users":this.calendar.toggleUserCalendarVisibility(e);break;case"Google":this.groupwareVisible=!this.groupwareVisible,this.groupwareVisible$.emit(this.groupwareVisible)}}setUserColor(e,t){this.calendar.setUserColor(e,t)}static ɵfac=function(e){return new(e||CalendarOtherCalendarsMonitor)(u.Y36(g.d),u.Y36(Pt.h),u.Y36(M),u.Y36(Rt.Q))};static ɵcmp=u.Xpm({type:CalendarOtherCalendarsMonitor,selectors:[["calendar-other-calendars-monitor"]],viewQuery:function(e,t){if(1&e&&u.Gf($t,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.inputContainer=e.first)}},inputs:{usersCalendars:"usersCalendars"},outputs:{groupwareVisible$:"groupwareVisible$"},decls:21,vars:15,consts:[[1,"slds-border--bottom"],[1,"slds-form-element__label","slds-text-heading--small","slds-p-horizontal--small"],["label","LBL_OTHER_CALENDARS"],[1,"slds-p-vertical--xx-small"],[1,"slds-form-element","slds-grid","slds-grid--align-spread","slds-p-horizontal--small","slds-p-vertical--xxx-small",3,"mouseenter","mouseleave"],[1,"slds-grid",2,"cursor","pointer",3,"click"],[1,"slds-button","slds-button--icon","slds-m-right--xx-small","slds-p-top--xxx-small"],["icon","user","size","small"],[1,"slds-text-body--regular","slds-truncate"],["label","LBL_MY_CALENDAR"],["class","slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small",3,"ngClass","mouseenter","mouseleave",4,"ngIf"],["class","slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small",3,"slds-theme--shade","mouseenter","mouseleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-form-element__control","slds-p-around--x-small","slds-border--bottom","slds-theme--default",2,"height","52px"],[1,"slds-form-element","slds-lookup"],["inputcontainer",""],[1,"slds-form-element__control","slds-grid","slds-box--border","slds-m-vertical--xxx-small"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],[3,"icon","addclasses"],["type","search","role","combobox",1,"slds-lookup__search-input","slds-input--bare",3,"ngModel","system-placeholder","ngModelChange","focus","blur"],["class","slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none",3,"ngStyle",4,"ngIf"],[1,"slds-form-element","slds-grid","slds-grid--align-spread","slds-p-horizontal--small","slds-p-vertical--xxx-small",3,"ngClass","mouseenter","mouseleave"],["src","https://developers.google.com/identity/images/g-logo.png","alt","G",2,"height","13px","width","13px","margin-right","2px","margin-top","2px",3,"ngStyle"],["label","MY_GOOGLE_CALENDAR"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsSAAALEgHS3X78AAAAVElEQVQ4jWP8//8/A7UBC8i8z4HKBE3mXX+XsWE3I0F1Da7/GZmo7kwGBoZRQ0cNpTKgXY5iXPqBoMn/owUYGXYRzlEMbqM5atTQoWEo9XMUAwMDAGSOGCOVddy/AAAAAElFTkSuQmCC","alt","G",2,"height","13px","width","13px","margin-right","2px","margin-top","2px",3,"ngStyle"],["label","LBL_MY_MICROSOFT_CALENDAR"],[3,"colorChange",4,"ngIf"],[1,"slds-button","slds-button--icon",3,"click"],["icon","clear","size","small"],[3,"colorChange"],[1,"slds-lookup__menu","slds-size--1-of-4","slds-p-vertical--none",3,"ngStyle"],["class","slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom",4,"ngIf"],["role","listbox",1,"slds-lookup__list",2,"height","175px"],[4,"ngIf"],[3,"size",4,"ngIf"],[1,"slds-theme--shade","slds-p-around--xx-small","slds-text-body--small","slds-text-title--caps","slds-border--bottom"],["label","LBL_USERS"],["label","LBL_FOUND"],["label","LBL_RECENTLYVIEWED"],["role","presentation",3,"mousedown",4,"ngFor","ngForOf","ngForTrackBy"],["role","presentation",3,"mousedown"],["role","option",1,"slds-lookup__item-action","slds-media"],["icon","user","size","x-small","divClass","slds-p-around--xxx-small slds-m-right--xxx-small"],[1,"slds-lookup__result-text"],[3,"size"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"label",1),u._UZ(2,"system-label",2),u.qZA(),u.TgZ(3,"div",3)(4,"div",4),u.NdJ("mouseenter",(function(){return t.hovered="own"}))("mouseleave",(function(){return t.hovered=""})),u.TgZ(5,"div",5),u.NdJ("click",(function(){return t.toggleVisible(null,"Owner")})),u.TgZ(6,"div",6),u._UZ(7,"system-button-icon",7),u.qZA(),u.TgZ(8,"a",8),u._UZ(9,"system-label",9),u.qZA()()(),u.YNc(10,jt,5,6,"div",10),u.YNc(11,Wt,5,6,"div",10),u.YNc(12,Xt,10,8,"div",11),u.qZA()(),u.TgZ(13,"div",12)(14,"div",13,14)(16,"div",15)(17,"div",16),u._UZ(18,"system-utility-icon",17),u.TgZ(19,"input",18),u.NdJ("ngModelChange",(function(e){return t.searchTerm=e}))("focus",(function(){return t.searchOpen=!0}))("blur",(function(){return t.searchOpen=!1})),u.qZA()()()(),u.YNc(20,os,7,6,"div",19),u.qZA()),2&e&&(u.xp6(4),u.ekj("slds-theme--shade","own"==t.hovered),u.xp6(2),u.Udp("color",t.calendar.ownerCalendarVisible?t.calendar.eventColor:"#dddbda"),u.xp6(2),u.Udp("color",t.calendar.ownerCalendarVisible?t.calendar.eventColor:"#dddbda"),u.xp6(2),u.Q6J("ngIf","google"==t.calendar.activeGroupware),u.xp6(1),u.Q6J("ngIf","microsoft"==t.calendar.activeGroupware),u.xp6(1),u.Q6J("ngForOf",t.usersCalendars)("ngForTrackBy",t.trackByFn),u.xp6(6),u.Q6J("icon","search")("addclasses","slds-input__icon"),u.xp6(1),u.Q6J("ngModel",t.searchTerm)("system-placeholder",t.language.getLabel("LBL_ADD")+" "+t.language.getLabel("LBL_USER")+" "+t.language.getLabel("LBL_CALENDAR")),u.xp6(1),u.Q6J("ngIf",t.searchopen))},dependencies:[n.mk,n.sg,n.O5,n.PC,i.Fj,i.JJ,i.On,Z.J,S.f,Y._,te.W,Q.r,qt.A,Lt],encapsulation:2,changeDetection:0})}return CalendarOtherCalendarsMonitor})();const ds=["calendarContainer"];function cs(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-other-calendars-monitor",13),u.NdJ("groupwareVisible$",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.handleGoogleIsVisible(t))})),u.qZA()}if(2&e){const e=u.oxw(2);u.Q6J("usersCalendars",e.calendar.usersCalendars)}}function hs(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",10)(1,"system-input-date-picker",11),u.NdJ("datePicked",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.setDateChanged(t))})),u.qZA(),u.YNc(2,cs,1,1,"calendar-other-calendars-monitor",12),u.qZA()}if(2&e){const e=u.oxw();u.Udp("width",e.calendar.sidebarWidth,"px"),u.xp6(1),u.Q6J("setDate",e.calendar.calendarDate)("dual",e.componentconfig.pickerDualMode)("showTodayButton",!1)("weekStartDay",e.calendar.weekStartDay),u.xp6(1),u.Q6J("ngIf",e.calendar.userPreferencesLoaded)}}function us(e,t){if(1&e&&u._UZ(0,"calendar-sheet-day",16),2&e){const e=u.oxw(2);u.Q6J("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function gs(e,t){if(1&e&&u._UZ(0,"calendar-sheet-three-days",16),2&e){const e=u.oxw(2);u.Q6J("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function ms(e,t){if(1&e&&u._UZ(0,"calendar-sheet-week",16),2&e){const e=u.oxw(2);u.Q6J("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function ps(e,t){if(1&e&&u._UZ(0,"calendar-sheet-month",16),2&e){const e=u.oxw(2);u.Q6J("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function fs(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"calendar-sheet-schedule",17),u.NdJ("untildate$",(function(t){u.CHM(e);const s=u.oxw(2);return u.KtG(s.handleUntilDate(t))})),u.qZA()}if(2&e){const e=u.oxw(2);u.Q6J("groupwareVisible",e.groupwareVisible)("setdate",e.calendar.calendarDate)}}function vs(e,t){1&e&&(u.ynx(0),u.YNc(1,us,1,2,"calendar-sheet-day",14),u.YNc(2,gs,1,2,"calendar-sheet-three-days",14),u.YNc(3,ms,1,2,"calendar-sheet-week",14),u.YNc(4,ps,1,2,"calendar-sheet-month",14),u.YNc(5,fs,1,2,"calendar-sheet-schedule",15),u.BQk()),2&e&&(u.xp6(1),u.Q6J("ngSwitchCase","Day"),u.xp6(1),u.Q6J("ngSwitchCase","Three_Days"),u.xp6(1),u.Q6J("ngSwitchCase","Week"),u.xp6(1),u.Q6J("ngSwitchCase","Month"),u.xp6(1),u.Q6J("ngSwitchCase","Schedule"))}function ys(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"footer",18)(1,"button",19),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.closeModal())})),u._UZ(2,"system-label",20),u.qZA()()}}let xs=(()=>{class Calendar{language;navigationTab;elementRef;renderer;modal;cdr;model;metadata;injector;calendar;componentconfig={};groupwareVisible=!0;calendarContainer;calendarHeader;subscriptions=new v.w0;touchStartListener;touchMoveListener;resizeListener;xDown=null;mainContainerClass="slds-theme--default";yDown=null;self={};constructor(e,t,s,n,i,a,r,o,l,d){this.language=e,this.navigationTab=t,this.elementRef=s,this.renderer=n,this.modal=i,this.cdr=a,this.model=r,this.metadata=o,this.injector=l,this.calendar=d,this.navigationTab.setTabInfo({displaymodule:"Calendar",displayname:this.metadata.getModuleDefs("Calendar").module_label})}get sidebarWidth(){return this.calendar.sidebarWidth}get sheetStyle(){return{width:`calc(100% - ${this.sidebarWidth}px)`,height:"100%"}}ngAfterViewInit(){this.calendar.asPicker&&(this.mainContainerClass="slds-modal slds-fade-in-open slds-modal_large"),this.touchStartListener=this.renderer.listen("document","touchstart",(e=>this.handleTouchStart(e))),this.handleMobileView(),this.subscriptions.add(this.calendar.addingEvent$.subscribe((e=>this.addEvent(e))))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.resizeListener&&this.resizeListener(),this.touchStartListener&&this.touchStartListener()}handleMobileView(){this.resizeListener=this.renderer.listen("window","resize",(()=>{this.calendar.setIsMobileView(this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)})),this.calendar.setIsMobileView(this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768)}handleUntilDate(e){this.calendarHeader.scheduleUntilDate=e}setDateChanged(e){this.calendarHeader.toggleClosed(),this.calendar.refresh(e)}handleGoogleIsVisible(e){this.groupwareVisible=e}closeModal(){this.self.destroy()}handleTouchStart(e){const t=e.touches||e.originalEvent.touches;this.xDown=t[0].clientX,this.yDown=t[0].clientY,this.touchMoveListener=this.renderer.listen("document","touchmove",(e=>this.handleTouchMove(e)))}handleTouchMove(e){if(this.touchMoveListener(),!this.xDown||!this.yDown)return;let t=this.xDown-e.touches[0].clientX;Math.abs(t)>Math.abs(this.yDown-e.touches[0].clientY)&&(t<0?this.calendar.shiftMinus():this.calendar.shiftPlus()),this.xDown=null,this.yDown=null}addEvent(e){this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe((t=>{t.instance.module$.pipe((0,b.q)(1)).subscribe((t=>{if(t){this.model.module=t.name;let s={[t.dateStartFieldName]:e};if(t.dateEndFieldName){let n=moment(e).add(30,"m");s[t.dateEndFieldName]=n}"UserAbsences"==t.name&&(s.user_id=this.calendar.owner,s.user_name=this.calendar.ownerName),this.model.addModel("",null,s)}}))}))}static ɵfac=function(e){return new(e||Calendar)(u.Y36(g.d),u.Y36(z.d),u.Y36(u.SBq),u.Y36(u.Qsj),u.Y36(k.o),u.Y36(u.sBO),u.Y36(V.o),u.Y36(T.Pu),u.Y36(u.zs3),u.Y36(M))};static ɵcmp=u.Xpm({type:Calendar,selectors:[["calendar"]],viewQuery:function(e,t){if(1&e&&(u.Gf(ds,7,u.s_b),u.Gf(G,7)),2&e){let e;u.iGM(e=u.CRH())&&(t.calendarContainer=e.first),u.iGM(e=u.CRH())&&(t.calendarHeader=e.first)}},features:[u._Bn([M,V.o])],decls:11,vars:14,consts:[[2,"height","100%",3,"ngClass","system-to-bottom-noscroll"],["calendarContainer",""],[2,"height","inherit"],[1,"slds-grid","slds-grid--vertical",2,"height","inherit"],[2,"display","block",3,"modules","datePicked"],[1,"slds-grid","slds-theme_default","slds-border--right","slds-grow",2,"min-height","100px"],["class","slds-border--right slds-p-around--xx-small slds-scrollable--y slds-size--1-of-1 slds-theme--default","style","height: 100%; z-index: 1",3,"width",4,"ngIf"],[3,"ngSwitch","system-overlay-loading-spinner","ngStyle"],[4,"ngIf"],["class","slds-modal__footer",4,"ngIf"],[1,"slds-border--right","slds-p-around--xx-small","slds-scrollable--y","slds-size--1-of-1","slds-theme--default",2,"height","100%","z-index","1"],[3,"setDate","dual","showTodayButton","weekStartDay","datePicked"],[3,"usersCalendars","groupwareVisible$",4,"ngIf"],[3,"usersCalendars","groupwareVisible$"],["style","display: block; height: inherit",3,"groupwareVisible","setdate",4,"ngSwitchCase"],["style","display: block; height: inherit",3,"groupwareVisible","setdate","untildate$",4,"ngSwitchCase"],[2,"display","block","height","inherit",3,"groupwareVisible","setdate"],[2,"display","block","height","inherit",3,"groupwareVisible","setdate","untildate$"],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CLOSE"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3)(4,"calendar-header",4),u.NdJ("datePicked",(function(e){return t.setDateChanged(e)})),u.qZA(),u.TgZ(5,"div",5),u.YNc(6,hs,3,7,"div",6),u.TgZ(7,"div",7),u.YNc(8,vs,6,5,"ng-container",8),u.qZA()(),u.TgZ(9,"div"),u.YNc(10,ys,3,0,"footer",9),u.qZA()()()()),2&e&&(u.ekj("slds-text-body--small",t.calendar.isMobileView),u.Q6J("ngClass",t.mainContainerClass)("system-to-bottom-noscroll",!t.calendar.asPicker),u.uIk("role",t.calendar.asPicker?"dialog":"none"),u.xp6(2),u.ekj("slds-modal__container",t.calendar.asPicker),u.xp6(2),u.Q6J("modules",t.calendar.modules),u.xp6(2),u.Q6J("ngIf",!t.calendar.isMobileView),u.xp6(1),u.Q6J("ngSwitch",t.calendar.sheetType)("system-overlay-loading-spinner",t.calendar.isLoading||!t.calendar.userPreferencesLoaded)("ngStyle",t.sheetStyle),u.xp6(1),u.Q6J("ngIf",t.calendar.userPreferencesLoaded),u.xp6(2),u.Q6J("ngIf",t.calendar.asPicker))},dependencies:[n.mk,n.O5,n.PC,n.RF,n.n9,J.e,Y._,j.t,W._,G,Me,ft,je,Ft,It,ls],encapsulation:2,changeDetection:0})}return Calendar})();const ws=["popoverContainer"];function bs(e,t){if(1&e&&u._UZ(0,"calendar-sheet-google-event",12),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Udp("height",t.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function Cs(e,t){if(1&e&&u._UZ(0,"calendar-sheet-microsoft-event",12),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Udp("height",t.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function Es(e,t){if(1&e&&u._UZ(0,"calendar-sheet-event",12),2&e){const e=u.oxw().$implicit,t=u.oxw();u.Udp("height",t.calendar.multiEventHeight,"px"),u.Q6J("event",e)}}function Ds(e,t){if(1&e&&(u.ynx(0,9),u.YNc(1,bs,1,3,"calendar-sheet-google-event",10),u.YNc(2,Cs,1,3,"calendar-sheet-microsoft-event",10),u.YNc(3,Es,1,3,"calendar-sheet-event",11),u.BQk()),2&e){const e=t.$implicit;u.Q6J("ngSwitch",e.type),u.xp6(1),u.Q6J("ngSwitchCase","google"),u.xp6(1),u.Q6J("ngSwitchCase","microsoft")}}let _s=(()=>{class CalendarMorePopover{metadata;calendar;language;renderer;cdr;events=[];nubbinClass="";popoverStyle={};sheetDay={};isMobileView=!1;parentElementRef;self;hidePopoverTimeout={};popoverContainer;constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i}get shortDate(){return this.calendar.calendarDate.month(this.sheetDay.month).date(this.sheetDay.day).format("D MMM,")}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}trackByFn(e,t){return t.id}onMouseOver(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseOut(e){this.closePopover(!0,e)}static ɵfac=function(e){return new(e||CalendarMorePopover)(u.Y36(T.Pu),u.Y36(M),u.Y36(g.d),u.Y36(u.Qsj),u.Y36(u.sBO))};static ɵcmp=u.Xpm({type:CalendarMorePopover,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&u.Gf(ws,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.popoverContainer=e.first)}},decls:11,vars:6,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small"],["label","LBL_EVENTS"],[1,"slds-scrollable--y",2,"height","120px"],[3,"ngSwitch",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],["class","spice-calendar-more-event",3,"event","height",4,"ngSwitchCase"],["class","spice-calendar-more-event",3,"event","height",4,"ngSwitchDefault"],[1,"spice-calendar-more-event",3,"event"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0),u.NdJ("mouseenter",(function(){return t.onMouseOver()}))("mouseleave",(function(e){return t.onMouseOut(e)})),u.TgZ(1,"button",1),u.NdJ("click",(function(){return t.closePopover(!0)})),u._UZ(2,"system-button-icon",2),u.qZA(),u.TgZ(3,"div",null,3)(5,"div",4)(6,"header",5),u._uU(7),u._UZ(8,"system-label",6),u.qZA(),u.TgZ(9,"div",7),u.YNc(10,Ds,4,3,"ng-container",8),u.qZA()()()()),2&e&&(u.Q6J("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.xp6(7),u.AsE("",t.shortDate," ","("+t.events.length+")"," "),u.xp6(3),u.Q6J("ngForOf",t.events)("ngForTrackBy",t.trackByFn))},dependencies:[n.mk,n.sg,n.PC,n.RF,n.n9,n.ED,Z.J,Y._,he,ge,pe],encapsulation:2,changeDetection:0})}return CalendarMorePopover})();var ks=s(50151);const Ts=["popoverContainer"];let Ms=(()=>{class CalendarGoogleEventPopover{metadata;calendar;language;renderer;cdr;event={};nubbinClass="";popoverStyle={};isMobileView=!1;parentElementRef;self;hidePopoverTimeout={};popoverContainer;constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}onMouseEnter(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseLeave(e){this.closePopover(!0,e)}static ɵfac=function(e){return new(e||CalendarGoogleEventPopover)(u.Y36(T.Pu),u.Y36(M),u.Y36(g.d),u.Y36(u.Qsj),u.Y36(u.sBO))};static ɵcmp=u.Xpm({type:CalendarGoogleEventPopover,selectors:[["calendar-google-event-popover"]],viewQuery:function(e,t){if(1&e&&u.Gf(Ts,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.popoverContainer=e.first)}},decls:17,vars:7,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small","slds-truncate","slds-has-divider--bottom-space",3,"system-title"],[1,"slds-scrollable--y",2,"height","120px"],[1,"slds-list_horizontal","slds-wrap","slds-text-body_small"],[1,"slds-item_label","slds-text-color_weak","slds-truncate","slds-m-bottom--x-small"],["label","LBL_DESCRIPTION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"innerHTML"],["label","LBL_LOCATION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"system-title"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0),u.NdJ("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(e){return t.onMouseLeave(e)})),u.TgZ(1,"button",1),u.NdJ("click",(function(){return t.closePopover(!0)})),u._UZ(2,"system-button-icon",2),u.qZA(),u.TgZ(3,"div",null,3)(5,"div",4)(6,"header",5),u._uU(7),u.qZA(),u.TgZ(8,"div",6)(9,"dl",7)(10,"dt",8),u._UZ(11,"system-label",9),u.qZA(),u._UZ(12,"dd",10),u.TgZ(13,"dt",8),u._UZ(14,"system-label",11),u.qZA(),u.TgZ(15,"dd",12),u._uU(16),u.qZA()()()()()()),2&e&&(u.Q6J("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.xp6(6),u.Q6J("system-title",t.event.summary),u.xp6(1),u.hij(" ",t.event.summary," "),u.xp6(5),u.Q6J("innerHTML",t.event.description,u.oJD),u.xp6(3),u.Q6J("system-title",t.event.location),u.xp6(1),u.hij(" ",t.event.location," "))},dependencies:[n.mk,n.PC,Z.J,Y._,ks.S],encapsulation:2,changeDetection:0})}return CalendarGoogleEventPopover})();var Zs=s(59621),Ss=s(83499),Js=s(75767),Ys=s(1916);function Fs(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",8)(1,"a",9),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.save(t))})),u._UZ(2,"system-icon",10),u.TgZ(3,"div",11)(4,"h2",12),u._UZ(5,"system-label",13),u.qZA()()()()}if(2&e){const e=t.$implicit,s=u.oxw();u.xp6(2),u.Q6J("icon",s.getIcon(e.icon))("sprite",s.getSprite(e.icon)),u.xp6(3),u.Q6J("label",e.name)}}let Qs=(()=>{class CalendarAddCalendar{language;backend;calendars=[];addCalendar=new u.vpe;self={};constructor(e,t){this.language=e,this.backend=t}getIcon(e){return e&&e.split(":")[1]?e.split(":")[1]:e}getSprite(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"}close(){this.addCalendar.emit(!1),this.self.destroy()}save(e){this.addCalendar.emit(e),this.self.destroy()}trackByFn(e,t){return t.id}static ɵfac=function(e){return new(e||CalendarAddCalendar)(u.Y36(g.d),u.Y36(C.y))};static ɵcmp=u.Xpm({type:CalendarAddCalendar,selectors:[["ng-component"]],decls:10,vars:2,consts:[["size","small"],[3,"close"],["label","LBL_ADD_CALENDAR"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"icon","sprite"],[1,"slds-media__body","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate"],[3,"label"]],template:function(e,t){1&e&&(u.TgZ(0,"system-modal",0)(1,"system-modal-header",1),u.NdJ("close",(function(){return t.close()})),u._UZ(2,"system-label",2),u.qZA(),u.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4),u.YNc(6,Fs,6,3,"div",5),u.qZA()()(),u.TgZ(7,"system-modal-footer")(8,"button",6),u.NdJ("click",(function(){return t.close()})),u._UZ(9,"system-label",7),u.qZA()()()),2&e&&(u.xp6(6),u.Q6J("ngForOf",t.calendars)("ngForTrackBy",t.trackByFn))},dependencies:[n.sg,S.f,Y._,Zs.j,Ss.x,Js.p,Ys.y],encapsulation:2})}return CalendarAddCalendar})();function Us(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",8)(1,"a",9),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.save(t))})),u._UZ(2,"system-icon",10),u.TgZ(3,"div",11)(4,"h2",12),u._UZ(5,"system-label-modulename",13),u.qZA()()()()}if(2&e){const e=t.$implicit;u.xp6(2),u.Q6J("module",e.name),u.xp6(3),u.Q6J("module",e.name)}}let As=(()=>{class CalendarAddModulesModal{language;calendar;module$=new u.vpe;self={};constructor(e,t){this.language=e,this.calendar=t}close(){this.module$.emit(!1),this.self.destroy()}save(e){this.module$.emit(e),this.self.destroy()}trackByFn(e,t){return t.id}static ɵfac=function(e){return new(e||CalendarAddModulesModal)(u.Y36(g.d),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarAddModulesModal,selectors:[["ng-component"]],decls:10,vars:2,consts:[["size","small"],[3,"close"],["label","LBL_MODULES"],[1,"slds-form-element"],[1,"slds-grid","slds-wrap"],["class","slds-size--1-of-3 slds-p-around--xx-small ",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-size--1-of-3","slds-p-around--xx-small"],["href","javascript:void(0);",1,"slds-box","slds-box_link","slds-box_x-small","slds-media",3,"click"],["size","large",1,"slds-align_absolute-center",3,"module"],[1,"slds-media__body","slds-p-around_small"],[1,"slds-truncate","slds-text-heading_small","slds-truncate"],[3,"module"]],template:function(e,t){1&e&&(u.TgZ(0,"system-modal",0)(1,"system-modal-header",1),u.NdJ("close",(function(){return t.close()})),u._UZ(2,"system-label",2),u.qZA(),u.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4),u.YNc(6,Us,6,2,"div",5),u.qZA()()(),u.TgZ(7,"system-modal-footer")(8,"button",6),u.NdJ("click",(function(){return t.close()})),u._UZ(9,"system-label",7),u.qZA()()()),2&e&&(u.xp6(6),u.Q6J("ngForOf",t.calendar.modules)("ngForTrackBy",t.trackByFn))},dependencies:[n.sg,S.f,Y._,F.M,Zs.j,Ss.x,Js.p,Ys.y],encapsulation:2,changeDetection:0})}return CalendarAddModulesModal})();const Hs=["headercontainer"];let Bs=(()=>{class CalendarScheduleDashlet{language;navigation;elementRef;renderer;calendar;dashletconfig=null;scheduleUntilDate={};headerContainer;constructor(e,t,s,n,i){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=i,this.calendar.isDashlet=!0,this.calendar.sheetType="Schedule",this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:this.headerContainer?`calc(100% - ${this.headerContainer.element.nativeElement.offsetHeight}px)`:"100px",width:"100%"}}get title(){return new moment(this.calendarDate).format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY")}ngOnInit(){this.calendar.customOwner=this.dashletconfig.userId}static ɵfac=function(e){return new(e||CalendarScheduleDashlet)(u.Y36(g.d),u.Y36(m.G),u.Y36(u.SBq),u.Y36(u.Qsj),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarScheduleDashlet,selectors:[["calendar-schedule-dashlet"]],viewQuery:function(e,t){if(1&e&&u.Gf(Hs,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.headerContainer=e.first)}},features:[u._Bn([M])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["headercontainer",""],["module","Calendar","size","small"],[1,"slds-text-heading--medium","slds-truncate"],[1,"slds-size--1-of-1",3,"ngStyle"],[3,"setdate","untildate$"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1,2),u._UZ(3,"system-icon",3),u.TgZ(4,"h2",4),u._uU(5),u.qZA()(),u.TgZ(6,"div",5)(7,"calendar-sheet-schedule",6),u.NdJ("untildate$",(function(e){return t.scheduleUntilDate=e})),u.qZA()()()),2&e&&(u.xp6(5),u.Oqu(t.title),u.xp6(1),u.Q6J("ngStyle",t.contentStyle),u.xp6(1),u.Q6J("setdate",t.calendarDate))},dependencies:[n.PC,S.f,It],encapsulation:2})}return CalendarScheduleDashlet})();const Os=["calendarcontent"];let Ns=(()=>{class CalendarDayDashlet{language;elementRef;calendar;dashletconfig=null;calendarContent;dashletLabel=null;constructor(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.calendar.isDashlet=!0,this.calendar.sheetType="Day",this.calendar.sheetHourHeight=50}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}}ngOnInit(){this.calendar.customOwner=this.dashletconfig.userId}static ɵfac=function(e){return new(e||CalendarDayDashlet)(u.Y36(g.d),u.Y36(u.SBq),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarDayDashlet,selectors:[["calendar-day-dashlet"]],viewQuery:function(e,t){if(1&e&&u.Gf(Os,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.calendarContent=e.first)}},features:[u._Bn([M])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Calendar","size","small"],[1,"slds-text-heading--medium"],[3,"label"],[1,"slds-size--1-of-1",3,"ngStyle"],["calendarcontent",""],[3,"setdate"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1),u._UZ(2,"system-icon",2),u.TgZ(3,"h2",3),u._UZ(4,"system-label",4),u.qZA()(),u.TgZ(5,"div",5,6),u._UZ(7,"calendar-sheet-day",7),u.qZA()()),2&e&&(u.xp6(4),u.Q6J("label",t.dashletLabel),u.xp6(1),u.Q6J("ngStyle",t.contentStyle),u.xp6(2),u.Q6J("setdate",t.calendarDate))},dependencies:[n.PC,S.f,Y._,Me],encapsulation:2,changeDetection:0})}return CalendarDayDashlet})();const Is=["calendarcontent"];let Ps=(()=>{class CalendarThreeDaysDashlet{language;elementRef;calendar;dashletconfig=null;calendarContent;dashletLabel=null;constructor(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.setCalendarType()}get calendarDate(){return this.calendar.calendarDate}get contentStyle(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}}ngOnInit(){this.calendar.customOwner=this.dashletconfig?.userId}setCalendarType(){this.calendar.isDashlet=!0,this.calendar.sheetType="Three_Days",this.calendar.sheetHourHeight=50}static ɵfac=function(e){return new(e||CalendarThreeDaysDashlet)(u.Y36(g.d),u.Y36(u.SBq),u.Y36(M))};static ɵcmp=u.Xpm({type:CalendarThreeDaysDashlet,selectors:[["calendar-three-days-dashlet"]],viewQuery:function(e,t){if(1&e&&u.Gf(Is,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.calendarContent=e.first)}},features:[u._Bn([M])],decls:8,vars:3,consts:[[1,"slds-height_full"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Calendar","size","small"],[1,"slds-text-heading--medium"],[3,"label"],[1,"slds-size--1-of-1",3,"ngStyle"],["calendarcontent",""],[3,"setdate"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1),u._UZ(2,"system-icon",2),u.TgZ(3,"h2",3),u._UZ(4,"system-label",4),u.qZA()(),u.TgZ(5,"div",5,6),u._UZ(7,"calendar-sheet-three-days",7),u.qZA()()),2&e&&(u.xp6(4),u.Q6J("label",t.dashletLabel),u.xp6(1),u.Q6J("ngStyle",t.contentStyle),u.xp6(2),u.Q6J("setdate",t.calendarDate))},dependencies:[n.PC,S.f,Y._,ft],encapsulation:2})}return CalendarThreeDaysDashlet})();const Rs=["popoverContainer"];let qs=(()=>{class CalendarMicrosoftEventPopover{metadata;calendar;language;renderer;cdr;event={};nubbinClass="";popoverStyle={};isMobileView=!1;parentElementRef;self;hidePopoverTimeout={};popoverContainer;constructor(e,t,s,n,i){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=i}ngAfterViewInit(){this.setPopoverPosition(),this.cdr.detectChanges()}closePopover(e=!1,t){if(e)if(t&&t.relatedTarget.classList.contains("slds-dropdown")){let e=this.renderer.listen(t.relatedTarget,"click",(()=>{e(),this.self.destroy()}))}else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout((()=>this.self.destroy()),500)}setPopoverPosition(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};let e,t,s=this.parentElementRef.nativeElement.getBoundingClientRect(),n=this.popoverContainer.element.nativeElement.getBoundingClientRect();e=s.left<n.width?"right":"left",s.top-30+n.height>window.innerHeight&&s.top-n.height+30>0?(t="bottom",this.popoverStyle={top:s.top-n.height+30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}):(t="top",this.popoverStyle={top:s.top-30+"px",left:s.left<n.width?s.left+100+"px":s.left-n.width-30+"px"}),this.nubbinClass=("left"==e?"slds-nubbin--right-":"slds-nubbin--left-")+t}onMouseEnter(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)}onMouseLeave(e){this.closePopover(!0,e)}static ɵfac=function(e){return new(e||CalendarMicrosoftEventPopover)(u.Y36(T.Pu),u.Y36(M),u.Y36(g.d),u.Y36(u.Qsj),u.Y36(u.sBO))};static ɵcmp=u.Xpm({type:CalendarMicrosoftEventPopover,selectors:[["calendar-microsoft-event-popover"]],viewQuery:function(e,t){if(1&e&&u.Gf(Rs,7,u.s_b),2&e){let e;u.iGM(e=u.CRH())&&(t.popoverContainer=e.first)}},decls:17,vars:7,consts:[["role","dialog",1,"slds-popover","slds-popover--panel","slds-is-fixed",3,"ngStyle","ngClass","mouseenter","mouseleave"],[1,"slds-button","slds-button_icon","slds-button_icon","slds-button_icon-small","slds-float_right","slds-popover__close",3,"click"],["icon","close"],["popoverContainer",""],[1,"slds-popover__header",2,"padding",".5rem"],[1,"slds-text-heading--small","slds-m-bottom--x-small","slds-truncate","slds-has-divider--bottom-space",3,"system-title"],[1,"slds-scrollable--y",2,"height","120px"],[1,"slds-list_horizontal","slds-wrap","slds-text-body_small"],[1,"slds-item_label","slds-text-color_weak","slds-truncate","slds-m-bottom--x-small"],["label","LBL_DESCRIPTION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"innerHTML"],["label","LBL_LOCATION"],[1,"slds-item_detail","slds-m-bottom--x-small",3,"system-title"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0),u.NdJ("mouseenter",(function(){return t.onMouseEnter()}))("mouseleave",(function(e){return t.onMouseLeave(e)})),u.TgZ(1,"button",1),u.NdJ("click",(function(){return t.closePopover(!0)})),u._UZ(2,"system-button-icon",2),u.qZA(),u.TgZ(3,"div",null,3)(5,"div",4)(6,"header",5),u._uU(7),u.qZA(),u.TgZ(8,"div",6)(9,"dl",7)(10,"dt",8),u._UZ(11,"system-label",9),u.qZA(),u._UZ(12,"dd",10),u.TgZ(13,"dt",8),u._UZ(14,"system-label",11),u.qZA(),u.TgZ(15,"dd",12),u._uU(16),u.qZA()()()()()()),2&e&&(u.Q6J("ngStyle",t.popoverStyle)("ngClass",t.nubbinClass),u.xp6(6),u.Q6J("system-title",t.event.subject),u.xp6(1),u.hij(" ",t.event.subject," "),u.xp6(5),u.Q6J("innerHTML",null==t.event.body?null:t.event.body.content,u.oJD),u.xp6(3),u.Q6J("system-title",null==t.event.location?null:t.event.location.displayName),u.xp6(1),u.hij(" ",null==t.event.location?null:t.event.location.displayName," "))},dependencies:[n.mk,n.PC,Z.J,Y._,ks.S],encapsulation:2,changeDetection:0})}return CalendarMicrosoftEventPopover})(),Gs=(()=>{class ModuleCalendar{static ɵfac=function(e){return new(e||ModuleCalendar)};static ɵmod=u.oAB({type:ModuleCalendar});static ɵinj=u.cJS({providers:[r.z],imports:[n.ez,i.u5,o.ObjectFields,l.GlobalComponents,d.ObjectComponents,c.SystemComponents,h.o,a._t]})}return ModuleCalendar})();("undefined"==typeof ngJitMode||ngJitMode)&&u.kYT(Gs,{declarations:[xs,G,Me,ft,je,Ft,It,he,ge,$,_s,Ms,vt,Qs,As,ls,Lt,Bs,Ns,Ps,pe,qs],imports:[n.ez,i.u5,o.ObjectFields,l.GlobalComponents,d.ObjectComponents,c.SystemComponents,h.o,a._t]})}}]);