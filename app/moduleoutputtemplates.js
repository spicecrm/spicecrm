/*!
 * 
 *                     aacService
 *
 *                     release: 2023.03.001
 *
 *                     date: 2024-01-09 16:51:03
 *
 *                     build: 2023.03.001.1704815463270
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_outputtemplates_moduleoutputtemplates_ts"],{89637:(e,t,s)=>{s.r(t),s.d(t,{ModuleOutputTemplates:()=>lt});var i=s(44755),l=s(95030),n=s(84357),o=s(53190),a=s(34826),d=s(19784),c=s(57239),u=s(62242),r=s(55329),p=s(4154),m=s(55710),g=s(9062),h=s(61553),f=s(83463),b=s(50727),_=s(14505),v=s(44044),x=s(66550),T=s(13278),Z=s(72656),y=s(44561),O=s(94664);function w(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",3)(1,"div",23)(2,"span",24)(3,"span",25),u._UZ(4,"system-icon",26),u.qZA(),u.TgZ(5,"span",27),u._uU(6),u.qZA(),u.TgZ(7,"button",28),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.clearField())})),u._UZ(8,"system-button-icon",29),u.qZA()()()()}if(2&e){const e=u.oxw();u.xp6(4),u.Q6J("module",e.module)("size","small"),u.xp6(2),u.Oqu(e.selectedItem.summary_text),u.xp6(2),u.Q6J("icon","close")}}function M(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",30)(1,"input",31),u.NdJ("focus",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.searchWithModal())})),u.qZA(),u.TgZ(2,"button",32),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.searchWithModal())})),u._UZ(3,"system-button-icon",29),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(1),u.Q6J("placeholder",e.placeholder),u.xp6(2),u.Q6J("icon","search")}}function F(e,t){if(1&e&&u._UZ(0,"iframe",33),2&e){const e=u.oxw();u.Q6J("srcdoc",e.sanitizedTemplated,u.oJD)}}function J(e,t){if(1&e&&u._UZ(0,"object",34),2&e){const e=u.oxw();u.Q6J("data",e.blobUrl,u.uOi)}}function L(e,t){1&e&&(u.TgZ(0,"div",35),u._UZ(1,"system-spinner"),u.qZA())}function C(e,t){1&e&&(u.TgZ(0,"div",35),u._UZ(1,"system-label",36),u.qZA())}let A=(()=>{class OutputTemplatesPreview{language;backend;metadata;model;modal;sanitizer;cdRef;toast;_outputformat="pdf";loading_output=!1;subscriptions=new b.w0;selectedItem;compiled_selected_template="";blobUrl;constructor(e,t,s,i,l,n,o,a){this.language=e,this.backend=t,this.metadata=s,this.model=i,this.modal=l,this.sanitizer=n,this.cdRef=o,this.toast=a,this.model.data$.subscribe((e=>{this.checkModelChanges()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get sanitizedTemplated(){return this.sanitizer.bypassSecurityTrustHtml(this.compiled_selected_template)}get outputformat(){return this._outputformat}set outputformat(e){this._outputformat=e,this.rendertemplate()}checkModelChanges(){this.selectedItem&&this.selectedItem.module!=this.module&&this.clearField()}get module(){return this.model.getField("module_name")}get placeholder(){return this.module?this.language.getModuleCombinedLabel("LBL_SEARCH",this.module):this.language.getLabel("LBL_SEARCH")}searchWithModal(){this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.module,e.instance.multiselect=!1,this.subscriptions.add(e.instance.selectedItems.subscribe((e=>{e.length&&(this.selectedItem={id:e[0].id,summary_text:e[0].summary_text,module:this.module,data:e[0]},this.blobUrl=null,this.compiled_selected_template=null,this.rendertemplate())})))}))}clearField(){this.selectedItem=void 0,this.blobUrl=null,this.compiled_selected_template=null,this.cdRef.detectChanges()}rendertemplate(){this.loading_output=!0,this.blobUrl=null,this.compiled_selected_template=null,this.cdRef.detectChanges();let e={language:this.model.getField("language"),parentype:this.module,parentid:this.selectedItem.id,body:this.model.getField("body"),header:this.model.getField("header"),footer:this.model.getField("footer"),stylesheet_id:this.model.getField("stylesheet_id"),page_orientation:this.model.getField("page_orientation"),page_size:this.model.getField("page_size"),margin_left:this.model.getField("margin_left"),margin_top:this.model.getField("margin_top"),margin_right:this.model.getField("margin_right"),margin_bottom:this.model.getField("margin_bottom"),id:this.model.id};switch(this.outputformat){case"pdf":this.backend.postRequest("module/OutputTemplates/previewpdf",{},e).subscribe((e=>{let t=this.datatoBlob(atob(e.content),"application/pdf");this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(t)),this.loading_output=!1,this.cdRef.detectChanges()}),(e=>{this.toast.sendToast(this.language.getLabel("ERR_PROCESSING_OUTPUT_TEMPLATE"),"error",e.error.error.message),this.loading_output=!1,this.cdRef.detectChanges()}));break;case"html":this.backend.postRequest("module/OutputTemplates/previewhtml",{},e).subscribe((e=>{this.compiled_selected_template=e.content,this.loading_output=!1,this.cdRef.detectChanges()}),(e=>{this.toast.sendToast(this.language.getLabel("ERR_PROCESSING_OUTPUT_TEMPLATE"),"error",e.error.error.message),this.loading_output=!1,this.cdRef.detectChanges()}))}}datatoBlob(e,t="",s=512){let i=[];for(let t=0;t<e.length;t+=s){let l=e.slice(t,t+s),n=new Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);let o=new Uint8Array(n);i.push(o)}return new Blob(i,{type:t})}static ɵfac=function(e){return new(e||OutputTemplatesPreview)(u.Y36(r.d),u.Y36(_.y),u.Y36(p.Pu),u.Y36(m.o),u.Y36(v.o),u.Y36(x.H7),u.Y36(u.sBO),u.Y36(T.A))};static ɵcmp=u.Xpm({type:OutputTemplatesPreview,selectors:[["output-templates-preview"]],decls:28,vars:9,consts:[[1,"slds-grid","slds-grid--vertical-align-end","slds-gutters_direct-xx-small"],[1,"slds-col","slds-grow","slds-form-element"],[1,"slds-form-element__label"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right",4,"ngIf"],[1,"slds-col","slds-form-element","slds-size--1-of-4"],[1,"slds-form-element__labe"],["label","LBL_DISPLAY"],[1,"slds-form-element__control","slds-p-top--xx-small"],[1,"slds-select_container"],[1,"slds-col","slds-select",3,"disabled","ngModel","ngModelChange"],["value","html"],["value","pdf"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","refresh"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom",2,"height","calc(100vh - 300px)"],["frameBorder","0","style","width: 100%;height: 100%;",3,"srcdoc",4,"ngIf"],["type","application/pdf","width","100%","height","100%",3,"data",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%;",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],[3,"module","size"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-combobox__form-element","slds-input-has-icon","slds-input-has-icon_right"],["type","text","autocomplete","none","role","combobox",1,"slds-input","slds-combobox__input",3,"placeholder","focus"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"click"],["frameBorder","0",2,"width","100%","height","100%",3,"srcdoc"],["type","application/pdf","width","100%","height","100%",3,"data"],[1,"slds-align--absolute-center",2,"height","100%"],["label","MSG_NO_RECORD_SELECTED"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"label",2),u._uU(3,"Bean"),u.qZA(),u.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6),u.YNc(8,w,9,4,"div",7),u.YNc(9,M,4,2,"div",8),u.qZA()()()()(),u.TgZ(10,"div",9)(11,"label",10),u._UZ(12,"system-label",11),u.qZA(),u.TgZ(13,"div",12)(14,"div",13)(15,"select",14),u.NdJ("ngModelChange",(function(e){return t.outputformat=e})),u.TgZ(16,"option",15),u._uU(17,"HTML"),u.qZA(),u.TgZ(18,"option",16),u._uU(19,"PDF"),u.qZA()()()()(),u.TgZ(20,"div")(21,"button",17),u.NdJ("click",(function(){return t.rendertemplate()})),u._UZ(22,"system-button-icon",18),u.qZA()()(),u.TgZ(23,"div",19),u.YNc(24,F,1,1,"iframe",20),u.YNc(25,J,1,1,"object",21),u.YNc(26,L,2,0,"div",22),u.YNc(27,C,2,0,"div",22),u.qZA()),2&e&&(u.xp6(8),u.Q6J("ngIf",t.selectedItem),u.xp6(1),u.Q6J("ngIf",!t.selectedItem),u.xp6(6),u.Q6J("disabled",!t.selectedItem)("ngModel",t.outputformat),u.xp6(6),u.Q6J("disabled",!t.selectedItem||t.loading_output),u.xp6(3),u.Q6J("ngIf","html"===t.outputformat&&!t.loading_output&&t.compiled_selected_template),u.xp6(1),u.Q6J("ngIf","pdf"===t.outputformat&&!t.loading_output&&t.blobUrl),u.xp6(1),u.Q6J("ngIf",t.loading_output),u.xp6(1),u.Q6J("ngIf",!t.selectedItem&&!t.loading_output))},dependencies:[i.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Z.J,y.f,f._,O.W],encapsulation:2,changeDetection:0})}return OutputTemplatesPreview})();const N=function(e){return{"slds-is-active":e}},R=function(e,t){return{"slds-show":e,"slds-hide":t}};let E=(()=>{class OutputTemplatesEditor{language;metadata;model;selectedTab="body";componentconfig={};constructor(e,t,s){this.language=e,this.metadata=t,this.model=s}get bodyfieldset(){return this.componentconfig.body}get headerfieldset(){return this.componentconfig.header}get footerfieldset(){return this.componentconfig.footer}static ɵfac=function(e){return new(e||OutputTemplatesEditor)(u.Y36(r.d),u.Y36(p.Pu),u.Y36(m.o))};static ɵcmp=u.Xpm({type:OutputTemplatesEditor,selectors:[["ng-component"]],decls:23,vars:35,consts:[["tabtitle","LBL_CONTENT"],[1,"slds-tabs_scoped","slds-p-around--x-small"],["role","tablist",1,"slds-tabs_scoped__nav"],["role","presentation",1,"slds-tabs_scoped__item",3,"ngClass","title","click"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link"],["label","LBL_CONTENT"],["label","LBL_HEADER"],["label","LBL_FOOTER"],["label","LBL_PREVIEW"],["role","tabpanel",1,"slds-tabs_scoped__content",3,"ngClass"],["direction","vertical",3,"fieldset"]],template:function(e,t){1&e&&(u.TgZ(0,"system-collapsable-tab",0)(1,"div",1)(2,"ul",2)(3,"li",3),u.NdJ("click",(function(){return t.selectedTab="body"})),u.TgZ(4,"a",4),u._UZ(5,"system-label",5),u.qZA()(),u.TgZ(6,"li",3),u.NdJ("click",(function(){return t.selectedTab="header"})),u.TgZ(7,"a",4),u._UZ(8,"system-label",6),u.qZA()(),u.TgZ(9,"li",3),u.NdJ("click",(function(){return t.selectedTab="footer"})),u.TgZ(10,"a",4),u._UZ(11,"system-label",7),u.qZA()(),u.TgZ(12,"li",3),u.NdJ("click",(function(){return t.selectedTab="preview"})),u.TgZ(13,"a",4),u._UZ(14,"system-label",8),u.qZA()()(),u.TgZ(15,"div",9),u._UZ(16,"object-record-fieldset",10),u.qZA(),u.TgZ(17,"div",9),u._UZ(18,"object-record-fieldset",10),u.qZA(),u.TgZ(19,"div",9),u._UZ(20,"object-record-fieldset",10),u.qZA(),u.TgZ(21,"div",9),u._UZ(22,"output-templates-preview"),u.qZA()()()),2&e&&(u.xp6(3),u.Q6J("ngClass",u.VKq(15,N,"body"==t.selectedTab))("title",t.language.getLabel("LBL_CONTENT")),u.xp6(3),u.Q6J("ngClass",u.VKq(17,N,"header"==t.selectedTab))("title",t.language.getLabel("LBL_HEADER")),u.xp6(3),u.Q6J("ngClass",u.VKq(19,N,"footer"==t.selectedTab))("title",t.language.getLabel("LBL_FOOTER")),u.xp6(3),u.Q6J("ngClass",u.VKq(21,N,"preview"==t.selectedTab))("title",t.language.getLabel("LBL_PREVIEW")),u.xp6(3),u.Q6J("ngClass",u.WLB(23,R,"body"==t.selectedTab,"body"!=t.selectedTab)),u.xp6(1),u.Q6J("fieldset",t.bodyfieldset),u.xp6(1),u.Q6J("ngClass",u.WLB(26,R,"header"==t.selectedTab,"header"!=t.selectedTab)),u.xp6(1),u.Q6J("fieldset",t.headerfieldset),u.xp6(1),u.Q6J("ngClass",u.WLB(29,R,"footer"==t.selectedTab,"footer"!=t.selectedTab)),u.xp6(1),u.Q6J("fieldset",t.footerfieldset),u.xp6(1),u.Q6J("ngClass",u.WLB(32,R,"preview"==t.selectedTab,"preview"!=t.selectedTab)))},dependencies:[i.mk,g.d,h.z,f._,A],encapsulation:2})}return OutputTemplatesEditor})();function q(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",2)(1,"div",8)(2,"span",9)(3,"span",10),u._UZ(4,"system-icon",11),u.qZA(),u.TgZ(5,"span",12),u._uU(6),u.qZA(),u.TgZ(7,"button",13),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.clearField())})),u._UZ(8,"system-button-icon",14),u.qZA()()()()}if(2&e){const e=u.oxw();u.xp6(4),u.Q6J("module",e.module)("size","small"),u.xp6(2),u.Oqu(e.selectedItem.summary_text),u.xp6(2),u.Q6J("icon","close")}}function k(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",15)(1,"input",16),u.NdJ("focus",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.searchWithModal())})),u.qZA(),u.TgZ(2,"button",17),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.searchWithModal())})),u._UZ(3,"system-button-icon",14),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(1),u.Q6J("disabled",e.module)("placeholder",e.placeholder),u.xp6(2),u.Q6J("icon","search")}}let B=(()=>{class OutputTemplatesPreviewSelector{language;metadata;model;modal;subscriptions=new b.w0;selectedItem;constructor(e,t,s,i){this.language=e,this.metadata=t,this.model=s,this.modal=i}ngOnDestroy(){this.subscriptions.unsubscribe()}get module(){return this.model.getField("module_name")}get placeholder(){return this.language.getModuleCombinedLabel("LBL_SEARCH",this.module)}searchWithModal(){this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.module,e.instance.multiselect=!1,this.subscriptions.add(e.instance.selectedItems.subscribe((e=>{e.length&&(this.selectedItem=e[0])})))}))}clearField(){this.selectedItem=void 0}static ɵfac=function(e){return new(e||OutputTemplatesPreviewSelector)(u.Y36(r.d),u.Y36(p.Pu),u.Y36(m.o),u.Y36(v.o))};static ɵcmp=u.Xpm({type:OutputTemplatesPreviewSelector,selectors:[["output-templates-preview-selector"]],decls:9,vars:2,consts:[[1,"slds-form-element"],[1,"slds-form-element__label"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],[3,"module","size"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare",3,"disabled","placeholder","focus"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"click"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"label",1),u._uU(2,"Bean"),u.qZA(),u.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),u.YNc(7,q,9,4,"div",6),u.YNc(8,k,4,3,"div",7),u.qZA()()()()()),2&e&&(u.xp6(7),u.Q6J("ngIf",t.selectedItem),u.xp6(1),u.Q6J("ngIf",!t.selectedItem))},dependencies:[i.O5,Z.J,y.f],encapsulation:2})}return OutputTemplatesPreviewSelector})();var U=s(26625);let Q=(()=>{class ObjectActionOutputBeanButton{language;model;modal;backend;configuration;viewContainerRef;templates=[];forcedFormat;modalTitle;noDownload;handBack;buttonText;actionconfig;constructor(e,t,s,i,l,n){this.language=e,this.model=t,this.modal=s,this.backend=i,this.configuration=l,this.viewContainerRef=n}execute(){let e=this.configuration.getData("OutputTemplates");e&&e[this.model.module]?(this.templates=e[this.model.module],this.openOutput()):(e={},this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="Loading Templates",this.backend.getRequest("module/OutputTemplates/formodule/"+this.model.module,{}).subscribe((t=>{e.instance.self.destroy(),this.configuration.setData("OutputTemplates",t),this.templates=t,this.openOutput()}),(t=>{e.instance.self.destroy()}))})))}openOutput(){this.templates.length>0?(this.templates.sort(((e,t)=>e.name>t.name?1:-1)),this.modal.openModal("ObjectActionOutputBeanModal",!0,this.viewContainerRef.injector).subscribe((e=>{e.instance.templates=this.templates,e.instance.modalTitle=this.modalTitle,e.instance.noDownload=this.noDownload,e.instance.handBack=this.handBack,e.instance.customActionsetId=this.actionconfig.modal_actionset,e.instance.buttonText=this.buttonText}))):this.modal.info("No Templates Found","there are no Output templates defined for the Module")}static ɵfac=function(e){return new(e||ObjectActionOutputBeanButton)(u.Y36(r.d),u.Y36(m.o),u.Y36(v.o),u.Y36(_.y),u.Y36(U.C),u.Y36(u.s_b))};static ɵcmp=u.Xpm({type:ObjectActionOutputBeanButton,selectors:[["object-action-output-bean-button"]],decls:2,vars:0,consts:[["label","LBL_PDF"]],template:function(e,t){1&e&&(u.TgZ(0,"span"),u._UZ(1,"system-label",0),u.qZA())},dependencies:[f._],encapsulation:2})}return ObjectActionOutputBeanButton})(),I=(()=>{class ObjectActionLiveCompileBeanButton extends Q{actionemitter=new u.vpe;openOutput(){this.templates.length>0?(this.templates.sort(((e,t)=>e.name>t.name?1:-1)),this.modal.openModal("ObjectActionOutputBeanModal",!0,this.viewContainerRef.injector).subscribe((e=>{e.instance.templates=this.templates,e.instance.modalTitle=this.modalTitle,e.instance.noDownload=this.noDownload,e.instance.handBack=this.handBack,e.instance.liveCompile=!0,e.instance.forcedFormat="pdf",e.instance.customActionsetId=this.actionconfig.modal_actionset,e.instance.buttonText=this.buttonText,e.instance.outputModalService.modalResponse$.subscribe((e=>{"marksent"==e&&this.actionemitter.emit(e)}))}))):this.modal.info("No Templates Found","there are no Output templates defined for the Module")}static ɵfac=function(){let e;return function(t){return(e||(e=u.n5z(ObjectActionLiveCompileBeanButton)))(t||ObjectActionLiveCompileBeanButton)}}();static ɵcmp=u.Xpm({type:ObjectActionLiveCompileBeanButton,selectors:[["object-action-live-compile-bean-button"]],outputs:{actionemitter:"actionemitter"},features:[u.qOj],decls:2,vars:0,consts:[["label","LBL_PDF"]],template:function(e,t){1&e&&(u.TgZ(0,"span"),u._UZ(1,"system-label",0),u.qZA())},dependencies:[f._],encapsulation:2})}return ObjectActionLiveCompileBeanButton})();var Y=s(72198),P=s(2486),S=s(61810),j=s(32294),D=s(83348),$=s(66367),H=s(73208),z=s(55638);function V(e,t){if(1&e&&u._UZ(0,"field-label",3),2&e){const e=u.oxw();u.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function G(e,t){if(1&e&&(u.ynx(0),u._uU(1),u.BQk()),2&e){const e=u.oxw(2);u.xp6(1),u.AsE("",null==e.selected_item?null:e.selected_item.name," (",null==e.selected_item?null:e.selected_item.language,")")}}function K(e,t){if(1&e&&(u.TgZ(0,"field-generic-display",4),u.YNc(1,G,2,2,"ng-container",5),u.qZA()),2&e){const e=u.oxw();u.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig),u.xp6(1),u.Q6J("ngIf",e.value)}}function W(e,t){if(1&e&&(u.TgZ(0,"option",12),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.Q6J("ngValue",e.id),u.xp6(1),u.AsE("",e.name," (",e.language,")")}}function X(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"select",9),u.NdJ("ngModelChange",(function(t){u.CHM(e);const s=u.oxw();return u.KtG(s.value=t)})),u.YNc(4,W,2,3,"option",10),u.qZA()(),u._UZ(5,"field-messages",11),u.qZA()()}if(2&e){const e=u.oxw();u.xp6(1),u.Q6J("ngClass",e.getFieldClass()),u.xp6(2),u.Q6J("disabled",e.isDisabled)("ngModel",e.value),u.xp6(1),u.Q6J("ngForOf",e.items),u.xp6(1),u.Q6J("fieldname",e.fieldname)}}let ee=(()=>{class fieldOutputTemplates extends S.O{model;view;language;metadata;router;backend;configuration;isLoaded=!1;items=[];constructor(e,t,s,i,l,n,o){super(e,t,s,i,l),this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=l,this.backend=n,this.configuration=o}get isDisabled(){return!this.isLoaded||!this.items}get selected_item(){return this.items.find((e=>e.id==this.value))}ngOnInit(){let e=this.configuration.getData("OutputTemplates");e&&e[this.model.module]?(this.items=e[this.model.module],this.isLoaded=!0):this.backend.getRequest("module/OutputTemplates/formodule/"+this.model.module,{}).subscribe((e=>{this.configuration.setData("OutputTemplates",e),this.items=e,this.isLoaded=!0}))}static ɵfac=function(e){return new(e||fieldOutputTemplates)(u.Y36(m.o),u.Y36(j.e),u.Y36(r.d),u.Y36(p.Pu),u.Y36(D.F0),u.Y36(_.y),u.Y36(U.C))};static ɵcmp=u.Xpm({type:fieldOutputTemplates,selectors:[["field-output-templates"]],features:[u.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[4,"ngIf"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"fieldname"],[3,"ngValue"]],template:function(e,t){1&e&&(u.YNc(0,V,1,2,"field-label",0),u.YNc(1,K,2,4,"field-generic-display",1),u.YNc(2,X,6,5,"div",2)),2&e&&(u.Q6J("ngIf",t.displayLabel),u.xp6(1),u.Q6J("ngIf",!t.isEditMode()),u.xp6(1),u.Q6J("ngIf",t.isEditMode()))},dependencies:[i.mk,i.sg,i.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,$.q,H.D,z.a],encapsulation:2})}return fieldOutputTemplates})();var te=s(95698),se=s(59621),ie=s(83499),le=s(75767),ne=s(1916),oe=s(42161),ae=s(30494),de=s(78859),ce=s(64947);function ue(e,t){if(1&e&&(u.TgZ(0,"option",18),u._uU(1),u.qZA()),2&e){const e=u.oxw().$implicit;u.Q6J("value",e.templateObjectName),u.xp6(1),u.Oqu(e.displayName)}}function re(e,t){if(1&e&&(u.ynx(0),u.YNc(1,ue,2,2,"option",62),u.BQk()),2&e){const e=t.$implicit;u.xp6(1),u.Q6J("ngIf","current_user"!==e.templateObjectName&&"template"!==e.templateObjectName)}}function pe(e,t){1&e&&(u.TgZ(0,"option",63),u._uU(1," "),u.qZA())}function me(e,t){1&e&&(u.ynx(0),u.TgZ(1,"option",63),u._uU(2," "),u.qZA(),u.TgZ(3,"option",64),u._UZ(4,"system-label",65),u.qZA(),u.BQk()),2&e&&(u.xp6(3),u.Q6J("value","template"))}function ge(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",68)(1,"system-module-tree",69),u.NdJ("itemSelected",(function(t){const s=u.CHM(e).$implicit,i=u.oxw(2);return u.KtG(i.treeItemSelected(t,s.name))})),u.qZA()()}if(2&e){const e=t.$implicit,s=u.oxw(2);u.ekj("slds-hide",s.activeModule!=e.templateObjectName),u.xp6(1),u.Q6J("module",e.name)}}function he(e,t){if(1&e&&(u.TgZ(0,"div",66),u.YNc(1,ge,2,3,"div",67),u.qZA()),2&e){const e=u.oxw();u.xp6(1),u.Q6J("ngForOf",e.offeredModules)("ngForTrackBy",e.trackByFn)}}function fe(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"tr")(1,"td")(2,"div",30)(3,"a",70),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw(2);return u.KtG(s.fieldSelected(t.name))})),u._uU(4),u.qZA()()(),u.TgZ(5,"td")(6,"div",30),u._UZ(7,"system-label",71),u.qZA()()()}if(2&e){const e=t.$implicit;u.xp6(4),u.Oqu(e.name),u.xp6(3),u.Q6J("label",e.label)}}function be(e,t){if(1&e&&(u.TgZ(0,"tbody"),u.YNc(1,fe,8,2,"tr",16),u.qZA()),2&e){const e=t.$implicit,s=u.oxw();u.ekj("slds-hide",s.isLoadingModuleFields||s.activeModule!=e.templateObjectName),u.xp6(1),u.Q6J("ngForOf",s.getFilteredFields(s.moduleFields[e.name]))("ngForTrackBy",s.trackByFn)}}function _e(e,t){1&e&&u._UZ(0,"tbody",72),2&e&&u.Q6J("columns",2)("rows",5)}function ve(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"tr")(1,"td")(2,"div",30)(3,"a",70),u.NdJ("click",(function(){const t=u.CHM(e).$implicit,s=u.oxw();return u.KtG(s.functionSelected(t))})),u._uU(4),u.qZA()()()()}if(2&e){const e=t.$implicit;u.xp6(4),u.Oqu(e.name)}}function xe(e,t){1&e&&(u.TgZ(0,"abbr",83),u._uU(1,"* "),u.qZA())}function Te(e,t){if(1&e&&u._UZ(0,"system-tooltip",84),2&e){const e=u.oxw().$implicit;u.Q6J("tooltiptext",e.help)}}function Ze(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"input",85),u.NdJ("ngModelChange",(function(t){u.CHM(e);const s=u.oxw().$implicit;return u.KtG(s.value=t)})),u.qZA()}if(2&e){const e=u.oxw().$implicit;u.Q6J("ngModel",e.value)}}function ye(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"input",88),u.NdJ("ngModelChange",(function(t){u.CHM(e);const s=u.oxw(2).$implicit;return u.KtG(s.value=t)})),u.qZA()}if(2&e){const e=u.oxw(2).$implicit;u.Q6J("ngModel",e.value)}}function Oe(e,t){if(1&e&&(u.TgZ(0,"option",18),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.Q6J("value",e.key),u.xp6(1),u.Oqu(e.value)}}function we(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"select",89),u.NdJ("ngModelChange",(function(t){u.CHM(e);const s=u.oxw(2).$implicit;return u.KtG(s.value=t)})),u.TgZ(1,"option",90),u._uU(2,"Select…"),u.qZA(),u.YNc(3,Oe,2,2,"option",91),u.ALo(4,"keyvalue"),u.qZA()}if(2&e){const e=u.oxw(2).$implicit;u.Q6J("ngModel",e.value),u.xp6(3),u.Q6J("ngForOf",u.lcZ(4,2,e.options))}}function Me(e,t){if(1&e&&(u.ynx(0),u.YNc(1,ye,1,1,"input",86),u.YNc(2,we,5,4,"select",87),u.BQk()),2&e){const e=u.oxw().$implicit;u.xp6(1),u.Q6J("ngIf",!e.options),u.xp6(1),u.Q6J("ngIf",e.options)}}function Fe(e,t){if(1&e&&(u.TgZ(0,"span",92),u._uU(1),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(1),u.Oqu(e.unit)}}const Je=function(e){return{"slds-p-left--x-small":e}},Le=function(e){return{"slds-input-has-fixed-addon":e}};function Ce(e,t){if(1&e&&(u.ynx(0),u.TgZ(1,"div",74)(2,"label",75),u.YNc(3,xe,2,0,"abbr",76),u._UZ(4,"system-label",71),u.YNc(5,Te,1,1,"system-tooltip",77),u.qZA(),u.TgZ(6,"div",78),u.ynx(7,79),u.YNc(8,Ze,1,1,"input",80),u.YNc(9,Me,3,2,"ng-container",81),u.YNc(10,Fe,2,1,"span",82),u.BQk(),u.qZA()(),u.BQk()),2&e){const e=t.$implicit,s=t.first;u.xp6(1),u.Q6J("ngClass",u.VKq(8,Je,!s)),u.xp6(2),u.Q6J("ngIf",e.required),u.xp6(1),u.Q6J("label",e.label),u.xp6(1),u.Q6J("ngIf",e.help),u.xp6(1),u.Q6J("ngClass",u.VKq(10,Le,!!e.unit)),u.xp6(1),u.Q6J("ngSwitch",e.type),u.xp6(1),u.Q6J("ngSwitchCase","color"),u.xp6(2),u.Q6J("ngIf",e.unit)}}function Ae(e,t){if(1&e&&(u.TgZ(0,"div",73),u.YNc(1,Ce,11,12,"ng-container",48),u.qZA()),2&e){const e=u.oxw();u.xp6(1),u.Q6J("ngForOf",e.actualFunctionParams)}}let Ne=(()=>{class OutputTemplatesVariableHelper{language;metadata;backend;cdr;model;self;response=new u.vpe;templateModel;offeredModules=[];activeModule;moduleFields=[];allFunctions;offeredFunctions;fieldFilter="";isLoadingModuleFields=!1;isLoadingFunctions=!1;modulePathFromTree="";functionResult="";fieldResult="";functionHistory=[];hasTemplate=!1;actualFunctionParams=[];constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.backend=s,this.cdr=i,this.model=l}ngOnInit(){if(this.offeredModules=[{name:"Users",templateObjectName:"current_user",displayName:this.language.getLabel("LBL_CURRENT_USER")}],"CampaignTasks"===this.model?.module){let e={};if(this.metadata.fieldDefs.ProspectLists){let t=this.metadata.fieldDefs.ProspectLists;Object.keys(t).forEach((s=>{if("link"===t[s].type){let i=(t[s].module?t[s].module:t[s].name).toLowerCase();for(let t in this.metadata.fieldDefs)t.toLowerCase()==i&&!0==!e[t]&&(this.offeredModules.push({name:t,templateObjectName:"bean."+t,displayName:this.language.getLabel(this.metadata.getModuleDefs(t).module_label)}),e[t]=!0)}}))}}"LandingPages"!==this.model?.module&&"OutputTemplates"!==this.model?.module&&"EmailTemplates"!==this.model?.module||(this.hasTemplate=!0,this.templateModel=this.model,this.offeredModules.push({name:this.templateModel.module,templateObjectName:"template",displayName:this.language.getLabel("LBL_TEMPLATE")}),this.templateModel.getFieldValue("module_name")&&this.offeredModules.push({name:this.templateModel.getFieldValue("module_name"),templateObjectName:"bean."+this.templateModel.getFieldValue("module_name"),displayName:this.language.getModuleName(this.templateModel.getFieldValue("module_name"),!0)}),this.templateModel.getFieldValue("for_bean")&&this.offeredModules.push({name:this.templateModel.getFieldValue("for_bean"),templateObjectName:"bean."+this.templateModel.getFieldValue("for_bean"),displayName:this.language.getModuleName(this.templateModel.getFieldValue("for_bean"),!0)})),this.language.sortObjects(this.offeredModules,"displayName"),this.loadFunctions()}loadFunctions(){this.isLoadingFunctions=!0,this.backend.getRequest("module/OutputTemplates/templateFunctions").pipe((0,te.q)(1)).subscribe((e=>{this.allFunctions=e,this.language.sortObjects(this.allFunctions.pipe,"name"),this.language.sortObjects(this.allFunctions.noPipe,"name"),this.isLoadingFunctions=!1,this.buildOfferedFunctions()}))}buildOfferedFunctions(){this.fieldResult||this.functionResult?this.offeredFunctions=this.allFunctions.pipe:this.offeredFunctions=this.allFunctions.noPipe}close(){this.self.destroy()}cancel(){this.close()}onModalEscX(){this.cancel()}submit(){let e;this.fieldResult||this.functionResultWithParams||(e=""),!this.fieldResult&&this.functionResultWithParams?e="func."+this.functionResultWithParams:(e=this.fieldResult,this.functionResultWithParams&&(e+="|"+this.functionResultWithParams)),this.response.emit(e),this.close()}getModuleFields(e,t){this.moduleFields[t]=[],this.isLoadingModuleFields=!0,this.cdr.detectChanges(),this.backend.getRequest("dictionary/browser/"+e+"/fields").pipe((0,te.q)(1)).subscribe((e=>{this.moduleFields[t]=e.filter((e=>"relate"!=e.type&&"non-db"!=e.source)),this.isLoadingModuleFields=!1}))}getFilteredFields(e){return this.fieldFilter?e.filter((e=>e.name.toLowerCase().includes(this.fieldFilter.toLowerCase())||e.label&&this.language.getLabel(e.label).toLowerCase().includes(this.fieldFilter.toLowerCase()))):e}trackByFn(e,t){return e}setActiveModuleTab(e){this.activeModule=e}treeItemSelected(e,t){this.modulePathFromTree=e.path,this.getModuleFields(e.module,t)}functionUndo(){if(this.functionHistory.length){let e=this.functionHistory.pop();this.functionResult=e.result,this.actualFunctionParams=e.params,this.buildOfferedFunctions()}}isTypeString(e){switch(e){case"string":case"color":return!0}return!1}get functionResultWithParams(){let e=this.functionResult;return this.actualFunctionParams.forEach((t=>{e+=":","color"===t.type&&"#000000"===t.value||void 0===t.value||""===t.value||(e+=this.isTypeString(t.type)?"'"+t.value+"'":t.value)})),e=e.replace(/:+$/g,""),e}functionSelected(e){this.functionHistory.push({result:this.functionResult,params:this.actualFunctionParams}),this.functionResult=this.functionResultWithParams,this.functionResult&&(this.functionResult+="|"),this.functionResult+=e.name,this.actualFunctionParams=e.paramConfigs?JSON.parse(JSON.stringify(e.paramConfigs)):[],this.buildOfferedFunctions()}fieldSelected(e){let t=this.modulePathFromTree.split(/::/),s=[];for(let e=1;e<t.length;e++)s.push(t[e].split(":").pop());let i=s.join(".");if(i&&(i+="."),-1!==this.activeModule.indexOf("bean.",0))this.fieldResult="bean."+i+e;else switch(this.activeModule){case"current_user":this.fieldResult="current_user."+i+e;break;case"template":this.fieldResult="template."+i+e}this.buildOfferedFunctions()}clearFieldResult(){this.fieldResult="",this.buildOfferedFunctions()}static ɵfac=function(e){return new(e||OutputTemplatesVariableHelper)(u.Y36(r.d),u.Y36(p.Pu),u.Y36(_.y),u.Y36(u.sBO),u.Y36(m.o,8))};static ɵcmp=u.Xpm({type:OutputTemplatesVariableHelper,selectors:[["ng-component"]],outputs:{response:"response"},decls:79,vars:19,consts:[["size","large"],[3,"close"],["label","LBL_TEMPLATE_VARIABLE_HELPER"],["margin","none","system-modal-content-grow",""],[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grow",2,"height","0"],[1,"slds-size--3-of-5","slds-border--right","slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"height","0"],[1,"slds-border--bottom","slds-grid","slds-grid--vertical",2,"height","50%"],[1,"slds-form-element","slds-m-around--small",2,"margin-top","0"],[1,"slds-form-element__label"],[1,"slds-form-element__control"],[1,"slds-select_container"],["id","templateVarHelperSource",1,"slds-select",3,"ngModel","ngModelChange"],["hidden","","selected",""],["label","LBL_SELECT"],[4,"ngFor","ngForOf","ngForTrackBy"],["style","font-size:1px;background-color:#ccc","disabled","",4,"ngIf"],[3,"value"],["label","LBL_CURRENT_USER"],[4,"ngIf"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"x-height","100"],["class","slds-grow","style","height:0",4,"ngIf"],[1,"slds-grid","slds-grid--vertical",2,"height","50%"],["role","none",1,"slds-input-has-icon","slds-input-has-icon_left","slds-m-around--x-small"],["icon","search","addclasses","slds-input__icon slds-input__icon--left"],["type","search",1,"slds-input",3,"placeholder","ngModel","ngModelChange"],[1,"slds-grow","slds-scrollable--y","slds-m-bottom--x-small"],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered","slds-table--header-fixed",2,"border-top","none"],["scope","col",2,"min-width","20rem"],[1,"slds-truncate"],["label","LBL_FIELD"],["scope","col",1,"slds-p-horizontal--x-small",2,"width","100%"],[1,"slds-truncate","slds-p-left--x-small"],["label","LBL_NAME"],[3,"slds-hide",4,"ngFor","ngForOf","ngForTrackBy"],["system-table-stencils","",3,"columns","rows",4,"ngIf"],[1,"slds-p-horizontal--medium","slds-p-bottom--medium","slds-p-top--xx-small","slds-border--top","slds-grid","slds-grid--vertical-align-end"],[1,"slds-form-element","slds-col--bump-right","slds-grow","slds-m-right--small"],["type","text","disabled","",1,"slds-input",3,"ngModel","ngModelChange"],[1,"slds-button","slds-button--icon","slds-button_icon-border",3,"disabled","click"],["icon","clear","size","medium"],[1,"slds-assistive-text"],["label","LBL_UNDO"],[1,"slds-size--2-of-5","slds-grid","slds-grid--vertical","slds-p-top--x-small",2,"height","100%"],[1,"slds-line-height_reset"],["scope","col"],["label","LBL_APPLICABLE_FUNCTIONS"],[4,"ngFor","ngForOf"],[1,"slds-border--top","slds-grid","slds-grid--vertical-align-end","slds-p-horizontal--medium","slds-p-bottom--medium","slds-p-top--xx-small"],[1,"slds-grow","slds-p-right--small"],["class","slds-grid slds-p-top--xx-small",4,"ngIf"],[1,"slds-form-element"],["label","LBL_FUNCTION"],["label","LBL_FUNCTION_CHAIN"],[1,"slds-form-element__control","slds-grow"],["type","text","disabled","",1,"slds-input",3,"ngModel"],["icon","undo",3,"size"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_OK"],[3,"value",4,"ngIf"],["disabled","",2,"font-size","1px","background-color","#ccc"],[2,"border-top","1px solid #333333",3,"value"],["label","LBL_TEMPLATE"],[1,"slds-grow",2,"height","0"],["class","slds-scrollable--y","style","height: 100%",3,"slds-hide",4,"ngFor","ngForOf","ngForTrackBy"],[1,"slds-scrollable--y",2,"height","100%"],[3,"module","itemSelected"],["href","javascript:void(0)",3,"click"],[3,"label"],["system-table-stencils","",3,"columns","rows"],[1,"slds-grid","slds-p-top--xx-small"],[1,"slds-form-element","slds-grow",3,"ngClass"],[1,"slds-form-element__label","slds-grid","slds-grid--vertical-align-center"],["class","slds-required","title","required",4,"ngIf"],["class","slds-m-left--x-small",3,"tooltiptext",4,"ngIf"],[1,"slds-form-element__control","slds-grow",3,"ngClass"],[3,"ngSwitch"],["type","color","class","slds-input","style","width:3.5rem;padding-left:2px;padding-right:2px",3,"ngModel","ngModelChange",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","slds-form-element__addon",4,"ngIf"],["title","required",1,"slds-required"],[1,"slds-m-left--x-small",3,"tooltiptext"],["type","color",1,"slds-input",2,"width","3.5rem","padding-left","2px","padding-right","2px",3,"ngModel","ngModelChange"],["type","text","class","slds-input",3,"ngModel","ngModelChange",4,"ngIf"],["class","slds-select",3,"ngModel","ngModelChange",4,"ngIf"],["type","text",1,"slds-input",3,"ngModel","ngModelChange"],[1,"slds-select",3,"ngModel","ngModelChange"],["selected","","value",""],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__addon"]],template:function(e,t){1&e&&(u.TgZ(0,"system-modal",0)(1,"system-modal-header",1),u.NdJ("close",(function(){return t.cancel()})),u._UZ(2,"system-label",2),u.qZA(),u.TgZ(3,"system-modal-content",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"label",10),u._uU(11,"Variable Source"),u.qZA(),u.TgZ(12,"div",11)(13,"div",12)(14,"select",13),u.NdJ("ngModelChange",(function(e){return t.activeModule=e})),u.TgZ(15,"option",14),u._UZ(16,"system-label",15),u.qZA(),u.YNc(17,re,2,1,"ng-container",16),u.YNc(18,pe,2,0,"option",17),u.TgZ(19,"option",18),u._UZ(20,"system-label",19),u.qZA(),u.YNc(21,me,5,1,"ng-container",20),u.qZA()()()(),u.TgZ(22,"div",21),u.YNc(23,he,2,2,"div",22),u.qZA()(),u.TgZ(24,"div",23)(25,"div",24),u._UZ(26,"system-utility-icon",25),u.TgZ(27,"input",26),u.NdJ("ngModelChange",(function(e){return t.fieldFilter=e})),u.qZA()(),u.TgZ(28,"div",27)(29,"table",28)(30,"thead")(31,"tr")(32,"th",29)(33,"div",30),u._UZ(34,"system-label",31),u.qZA()(),u.TgZ(35,"th",32)(36,"div",33),u._UZ(37,"system-label",34),u.qZA()()()(),u.YNc(38,be,2,4,"tbody",35),u.YNc(39,_e,1,2,"tbody",36),u.qZA()()()(),u.TgZ(40,"div",37)(41,"div",38)(42,"label",10),u._UZ(43,"system-label",31),u.qZA(),u.TgZ(44,"div",11)(45,"input",39),u.NdJ("ngModelChange",(function(e){return t.fieldResult=e})),u.qZA()()(),u.TgZ(46,"button",40),u.NdJ("click",(function(){return t.clearFieldResult()})),u._UZ(47,"system-button-icon",41),u.TgZ(48,"span",42),u._UZ(49,"system-label",43),u.qZA()()()(),u.TgZ(50,"div",44)(51,"div",27)(52,"table",28)(53,"thead")(54,"tr",45)(55,"th",46)(56,"div",30),u._UZ(57,"system-label",47),u.qZA()()()(),u.TgZ(58,"tbody"),u.YNc(59,ve,5,1,"tr",48),u.qZA()()(),u.TgZ(60,"div",49)(61,"div",50),u.YNc(62,Ae,2,1,"div",51),u.TgZ(63,"div",52)(64,"label",10),u._UZ(65,"system-label",53),u._uU(66," / "),u._UZ(67,"system-label",54),u.qZA(),u.TgZ(68,"div",55),u._UZ(69,"input",56),u.qZA()()(),u.TgZ(70,"button",40),u.NdJ("click",(function(){return t.functionUndo()})),u._UZ(71,"system-button-icon",57),u.TgZ(72,"span",42),u._UZ(73,"system-label",43),u.qZA()()()()()()(),u.TgZ(74,"system-modal-footer")(75,"button",58),u.NdJ("click",(function(){return t.cancel()})),u._UZ(76,"system-label",59),u.qZA(),u.TgZ(77,"button",60),u.NdJ("click",(function(){return t.submit()})),u._UZ(78,"system-label",61),u.qZA()()()),2&e&&(u.xp6(14),u.Q6J("ngModel",t.activeModule),u.xp6(3),u.Q6J("ngForOf",t.offeredModules)("ngForTrackBy",t.trackByFn),u.xp6(1),u.Q6J("ngIf",t.offeredModules.length),u.xp6(1),u.Q6J("value","current_user"),u.xp6(2),u.Q6J("ngIf",t.hasTemplate),u.xp6(2),u.Q6J("ngIf",!!t.activeModule),u.xp6(4),u.Q6J("placeholder",t.language.getLabel("LBL_SEARCH"))("ngModel",t.fieldFilter),u.xp6(11),u.Q6J("ngForOf",t.offeredModules)("ngForTrackBy",t.trackByFn),u.xp6(1),u.Q6J("ngIf",t.isLoadingModuleFields),u.xp6(6),u.Q6J("ngModel",t.fieldResult),u.xp6(1),u.Q6J("disabled",!t.fieldResult.length),u.xp6(13),u.Q6J("ngForOf",t.offeredFunctions),u.xp6(3),u.Q6J("ngIf",t.actualFunctionParams.length),u.xp6(7),u.Q6J("ngModel",t.functionResultWithParams),u.xp6(1),u.Q6J("disabled",!t.functionHistory.length),u.xp6(1),u.Q6J("size","xx-small"))},dependencies:[i.mk,i.sg,i.O5,i.RF,i.n9,i.ED,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.On,Z.J,f._,se.j,ie.x,le.p,ne.y,oe.x,ae.S,de.r,ce.w,i.Nd],encapsulation:2})}return OutputTemplatesVariableHelper})();var Re=s(23507);let Ee=(()=>{class ObjectActionMarkSentBeanButton extends Q{language;model;modal;backend;configuration;toast;outputModalService;viewContainerRef;actionemitter=new u.vpe;constructor(e,t,s,i,l,n,o,a){super(e,t,s,i,l,a),this.language=e,this.model=t,this.modal=s,this.backend=i,this.configuration=l,this.toast=n,this.outputModalService=o,this.viewContainerRef=a}execute(){if(!this.outputModalService.selectedTemplate)return;const e=this.outputModalService.selectedTemplate.id;let t=this.model.utils.spiceModel2backend("Letters",this.model.data);this.backend.postRequest(`module/Letters/${this.model.id}/marksent/${e}`,null,t).subscribe((e=>{this.actionemitter.emit({close:!0,name:"marksent"}),e?.success?(this.toast.sendToast(this.language.getLabel("LETTER_MARKED_AS_SENT"),"success"),this.model.setField("letter_status","sent")):this.toast.sendToast(this.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error")}))}static ɵfac=function(e){return new(e||ObjectActionMarkSentBeanButton)(u.Y36(r.d),u.Y36(m.o),u.Y36(v.o),u.Y36(_.y),u.Y36(U.C),u.Y36(T.A),u.Y36(Re.w),u.Y36(u.s_b))};static ɵcmp=u.Xpm({type:ObjectActionMarkSentBeanButton,selectors:[["object-action-mark-sent-bean-button"]],outputs:{actionemitter:"actionemitter"},features:[u.qOj],decls:2,vars:0,consts:[["label","LBL_MARK_SENT"]],template:function(e,t){1&e&&(u.TgZ(0,"span"),u._UZ(1,"system-label",0),u.qZA())},dependencies:[f._],encapsulation:2})}return ObjectActionMarkSentBeanButton})();var qe=s(91591),ke=s(77579),Be=s(93441),Ue=s(75920),Qe=s(82995);const Ie=function(e){return{uploadfiles:e,uploadfilesExist:!1,forceModalPreview:!0}};let Ye=(()=>{class OutputRevisionsPDFTabContainerEmail{parent;model;view;backend;helper;modal;toast;language;metadata;session;fieldset=null;filelist={};attachmentContent;email_sent=new u.vpe;attachmentsPanelRef;sending=!1;constructor(e,t,s,i,l,n,o,a,d,c){this.parent=e,this.model=t,this.view=s,this.backend=i,this.helper=l,this.modal=n,this.toast=o,this.language=a,this.metadata=d,this.session=c;let u=this.metadata.getComponentConfig("ObjectActionOutputBeanModal");this.fieldset=u.fieldset_email}ngOnInit(){this.setModelData(),this.setViewData()}setModelData(){this.model.module="Emails",this.model.initialize(this.parent);let e={};e.parent_type=this.parent.module,e.parent_id=this.parent.data.id,e.parent_name=this.parent.data.name,e.isNew=!0,e.assigned_user_id=this.session.authData.userId,e.assigned_user_name=this.session.authData.userName,e.modified_by_id=this.session.authData.userId,e.modified_by_name=this.session.authData.userName,e.date_entered=new Date,e.date_modified=new Date,this.model.setFields(e),this.model.startEdit()}setViewData(){this.view.setEditMode(),this.view.isEditable=!0}get isDirty(){return this.model.isDirty()}get disabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&t&&e&&i)||this.sending}sendEmail(){let e=new ke.x;return this.modal.openModal("SystemLoadingModal",!1).subscribe((t=>{t.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names")}),this.model.save().subscribe({next:s=>{t.instance.self.destroy(),e.next(!0)},error:()=>{t.instance.self.destroy(),this.sending=!1,e.error("Error sending email")}})})),e.asObservable()}static ɵfac=function(e){return new(e||OutputRevisionsPDFTabContainerEmail)(u.Y36(m.o,4),u.Y36(m.o),u.Y36(j.e),u.Y36(_.y),u.Y36(Be._),u.Y36(v.o),u.Y36(T.A),u.Y36(r.d),u.Y36(p.Pu),u.Y36(Ue.n))};static ɵcmp=u.Xpm({type:OutputRevisionsPDFTabContainerEmail,selectors:[["outputrevisions-pdf-tab-container-email"]],inputs:{filelist:"filelist",attachmentContent:"attachmentContent"},outputs:{email_sent:"email_sent"},features:[u._Bn([j.e,m.o])],decls:2,vars:4,consts:[["direction","vertical",3,"fieldset"],["component","SpiceAttachmentsPanel",3,"componentattributes","componentref"]],template:function(e,t){1&e&&(u._UZ(0,"object-record-fieldset",0),u.TgZ(1,"system-dynamic-component",1),u.NdJ("componentref",(function(e){return t.attachmentsPanelRef=e})),u.qZA()),2&e&&(u.Q6J("fieldset",t.fieldset),u.xp6(1),u.Q6J("componentattributes",u.VKq(2,Ie,t.filelist)))},dependencies:[g.d,Qe.T],encapsulation:2})}return OutputRevisionsPDFTabContainerEmail})();function Pe(e,t){if(1&e&&(u.TgZ(0,"option",20),u._UZ(1,"system-display-datetime",21),u._uU(2),u.qZA()),2&e){const e=t.$implicit;u.Q6J("ngValue",e.id),u.xp6(1),u.Q6J("date",e.date_entered),u.xp6(1),u.hij(" (",e.created_by,")")}}function Se(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",8),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.printCurrent())})),u._UZ(1,"system-button-icon",22),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("disabled",!e.outputRevision||e.loading)}}function je(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",8),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.downloadOutput())})),u._UZ(1,"system-button-icon",23),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("disabled",!e.outputRevision||e.loading)}}function De(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",8),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.showEmail=!0)})),u._UZ(1,"system-button-icon",24),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("disabled",!e.outputRevision||e.loading)}}function $e(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",25),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.cancelSend())})),u._UZ(1,"system-button-icon",26),u.qZA()}}function He(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",8),u.NdJ("click",(function(){u.CHM(e);const t=u.oxw();return u.KtG(t.sendEmail())})),u._UZ(1,"system-button-icon",27),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("disabled",!e.canSend)}}function ze(e,t){if(1&e&&u._UZ(0,"system-object-preview",28),2&e){const e=u.oxw();u.Q6J("data",e.blobFile)}}function Ve(e,t){1&e&&(u.TgZ(0,"div",29)(1,"system-illustration-no-data"),u._UZ(2,"system-label",30),u.qZA()())}function Ge(e,t){if(1&e&&u._UZ(0,"outputrevisions-pdf-tab-container-email",31),2&e){const e=u.oxw();u.Q6J("filelist",e.filelist)}}let Ke=(()=>{class OutputRevisionsPDFTabContainer{model;backend;helper;modal;toast;language;emailContainer;file={};blobFile="";loading=!1;outputRevision="";outputRevisions=[];subscriptions=new b.w0;showEmail=!1;constructor(e,t,s,i,l,n){this.model=e,this.backend=t,this.helper=s,this.modal=i,this.toast=l,this.language=n}ngOnInit(){this.getOutputs(),this.subscriptions.add(this.model.saved$.subscribe({next:()=>{this.getOutputs()}}))}ngOnDestroy(){this.subscriptions.unsubscribe()}loadOutput(){this.loading=!0,this.backend.getRequest(`common/spiceattachments/module/OutputRevisions/${this.outputRevision}/byfield/file`).subscribe({next:e=>{this.file=e,this.blobFile=atob(this.file.file),this.loading=!1},error:e=>{this.loading=!1}})}get outputDescription(){return this.outputRevision?this.outputRevisions.find((e=>e.id==this.outputRevision)).description:""}getOutputs(e=!1){this.loading=!0,this.backend.getRequest(`module/${this.model.module}/${this.model.id}/related/outputrevisions?offset=0&limit=99`).subscribe({next:t=>{this.loading=!1,this.outputRevisions=[];for(let e in t)if(t.hasOwnProperty(e)){let s=this.model.utils.backendModel2spice("OutputRevisions",t[e]);this.outputRevisions.push({id:s.id,date_entered:s.date_entered,created_by:s.created_by_user.user_name,description:s.description})}this.outputRevisions.sort(((e,t)=>e.date_entered.isBefore(t.date_entered)?1:-1)),this.outputRevisions.length>0&&(e||!this.outputRevision)&&(this.outputRevision=this.outputRevisions[0].id,this.loadOutput())},error:e=>{this.loading=!1}})}downloadOutput(){if(this.file.file){let e=this.helper.b64toBlob(this.file.file,"application/pdf"),t=URL.createObjectURL(e),s=document.createElement("a");document.body.appendChild(s),s.href=t,s.download=this.file.filename,s.type="application/pdf",s.click(),s.remove()}}createNewOutput(){let e=this.modal.await("LBL_LOADING_TEMPLATES");this.backend.getRequest(`module/OutputTemplates/formodule/${this.model.module}/${this.model.id}`).subscribe({next:t=>{e.emit(!0),t.length>0&&this.generateOutput(t[0].id)},error:t=>{e.emit(!0),this.toast.sendToast("LBL_NO_TEMPLATE_FOUND","warning")}})}generateOutput(e){let t=this.modal.await("LBL_GENERATING");this.backend.getRequest(`module/OutputRevisions/${this.model.module}/${this.model.id}/output/${e}/preview`).subscribe({next:s=>{t.emit(!0),this.modal.openModal("OutputRevisionsPDFTabContainerPreview").subscribe({next:t=>{t.instance.data=atob(s.file),t.instance.name=s.filename,t.instance.type=s.file_mime_type,t.instance.save$.subscribe({next:t=>{t&&this.modal.prompt("input_text","MSG_CREATE_NEW_OUTPUT","MSG_CREATE_NEW_OUTPUT").subscribe({next:t=>{this.loading=!0,this.backend.postRequest(`module/OutputRevisions/${this.model.module}/${this.model.id}/output/${e}`,{},{description:t}).subscribe({next:e=>{this.loading=!1,this.getOutputs(!0)},error:()=>{this.loading=!1}})}})}})}})},error:()=>{t.emit(!0)}})}printCurrent(){this.backend.putRequest(`module/OutPutRevisions/${this.outputRevision}/print`).subscribe({next:e=>{e.printed?this.toast.sendToast("LBL_PRINTED","success"):this.toast.sendToast("LBL_PRINT_ERROR","error")},error:e=>{this.toast.sendToast("LBL_PRINT_ERROR","error",e.error.error)}})}get filelist(){return[{size:this.file.filesize,name:this.file.filename,type:this.file.file_mime_type,filecontent:this.file.file}]}get canSend(){return this.emailContainer&&!this.emailContainer.disabled}cancelSend(){this.emailContainer&&!this.emailContainer.isDirty?this.modal.prompt("confirm","MSG_CANCEL_SEND_EMAIL","MSG_CANCEL_SEND_EMAIL").subscribe({next:e=>{e&&(this.showEmail=!1)}}):this.showEmail=!1}sendEmail(){this.emailContainer.sendEmail().subscribe({next:()=>{this.showEmail=!1}})}static ɵfac=function(e){return new(e||OutputRevisionsPDFTabContainer)(u.Y36(m.o),u.Y36(_.y),u.Y36(Be._),u.Y36(v.o),u.Y36(T.A),u.Y36(r.d))};static ɵcmp=u.Xpm({type:OutputRevisionsPDFTabContainer,selectors:[["outputrevisions-pdf-tab-container"]],viewQuery:function(e,t){if(1&e&&u.Gf(Ye,5),2&e){let e;u.iGM(e=u.CRH())&&(t.emailContainer=e.first)}},decls:24,vars:17,consts:[[1,"slds-size--1-of-1","slds-height_full"],[1,"slds-grid","slds-p-bottom--xx-small"],[1,"slds-form-element","slds-grid","slds-grid_vertical-align-center","slds-col--bump-right"],[1,"slds-form-element__control"],[1,"slds-select_container",2,"min-width","200px"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"slds-m-horizontal--xx-small",3,"helpText"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","sync"],["icon","new"],["class","slds-button slds-button--icon slds-button--icon-border",3,"disabled","click",4,"ngIf"],["class","slds-button slds-button--icon slds-button--icon-border",3,"click",4,"ngIf"],[1,"slds-grid",2,"height","calc(100% - 36px)","overflow","hidden",3,"system-overlay-loading-spinner"],[1,"slds-height_full"],["objectContainerHeight","100%","type","application/pdf",3,"data",4,"ngIf"],["class","slds-box--border slds-height_full slds-size--1-of-1 slds-align--absolute-center",4,"ngIf"],[1,"slds-height_full","slds-p-left--xx-small","slds-scrollable--y"],[1,"slds-box--border","slds-height_full"],[3,"filelist",4,"ngIf"],[3,"ngValue"],[3,"date"],["icon","print"],["icon","download"],["icon","email"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"click"],["icon","close"],["icon","send"],["objectContainerHeight","100%","type","application/pdf",3,"data"],[1,"slds-box--border","slds-height_full","slds-size--1-of-1","slds-align--absolute-center"],["label","LBL_NO_FILE"],[3,"filelist"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"select",5),u.NdJ("ngModelChange",(function(e){return t.outputRevision=e}))("ngModelChange",(function(){return t.loadOutput()})),u.YNc(6,Pe,3,3,"option",6),u.qZA()()(),u._UZ(7,"system-icon-help-text",7),u.TgZ(8,"button",8),u.NdJ("click",(function(){return t.getOutputs()})),u._UZ(9,"system-button-icon",9),u.qZA(),u.TgZ(10,"button",8),u.NdJ("click",(function(){return t.createNewOutput()})),u._UZ(11,"system-button-icon",10),u.qZA()(),u.YNc(12,Se,2,1,"button",11),u.YNc(13,je,2,1,"button",11),u.YNc(14,De,2,1,"button",11),u.YNc(15,$e,2,0,"button",12),u.YNc(16,He,2,1,"button",11),u.qZA(),u.TgZ(17,"div",13)(18,"div",14),u.YNc(19,ze,1,1,"system-object-preview",15),u.YNc(20,Ve,3,0,"div",16),u.qZA(),u.TgZ(21,"div",17)(22,"div",18),u.YNc(23,Ge,1,1,"outputrevisions-pdf-tab-container-email",19),u.qZA()()()()),2&e&&(u.xp6(5),u.Q6J("disabled",t.outputRevisions.length<2||t.loading||t.showEmail)("ngModel",t.outputRevision),u.xp6(1),u.Q6J("ngForOf",t.outputRevisions),u.xp6(1),u.Q6J("helpText",t.outputDescription),u.xp6(1),u.Q6J("disabled",t.loading||t.showEmail),u.xp6(2),u.Q6J("disabled",t.loading||t.showEmail),u.xp6(2),u.Q6J("ngIf",!t.showEmail),u.xp6(1),u.Q6J("ngIf",!t.showEmail),u.xp6(1),u.Q6J("ngIf",!t.showEmail),u.xp6(1),u.Q6J("ngIf",t.showEmail),u.xp6(1),u.Q6J("ngIf",t.showEmail),u.xp6(1),u.Q6J("system-overlay-loading-spinner",t.loading),u.xp6(1),u.Q6J("@slideInOut",t.showEmail?"open":"closed"),u.xp6(1),u.Q6J("ngIf",t.blobFile),u.xp6(1),u.Q6J("ngIf",!t.blobFile&&!t.loading),u.xp6(1),u.Q6J("@slideInOut2",t.showEmail?"open":"closed"),u.xp6(2),u.Q6J("ngIf",t.showEmail))},encapsulation:2,data:{animation:[(0,qe.X$)("slideInOut",[(0,qe.SB)("open",(0,qe.oB)({width:"50%"})),(0,qe.SB)("closed",(0,qe.oB)({width:"100%"})),(0,qe.eR)("open <=> closed",[(0,qe.jt)("200ms")])]),(0,qe.X$)("slideInOut2",[(0,qe.SB)("open",(0,qe.oB)({width:"50%"})),(0,qe.SB)("closed",(0,qe.oB)({width:"0%"})),(0,qe.eR)("open <=> closed",[(0,qe.jt)("200ms")])])]}})}return OutputRevisionsPDFTabContainer})();var We=s(1148);let Xe=(()=>{class OutputRevisionsPDFTabContainerPreview{self={};type="";name="";loadingerror=!1;data;save$=new u.vpe;constructor(){}closeModal(e=!1){this.save$.emit(e),this.self.destroy()}static ɵfac=function(e){return new(e||OutputRevisionsPDFTabContainerPreview)};static ɵcmp=u.Xpm({type:OutputRevisionsPDFTabContainerPreview,selectors:[["outputrevisions-pdf-tab-container-preview"]],inputs:{type:"type",name:"name",loadingerror:"loadingerror",data:"data"},outputs:{save$:"save$"},decls:10,vars:3,consts:[["size","large"],[3,"close"],["margin","none"],[3,"data","type"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(e,t){1&e&&(u.TgZ(0,"system-modal",0)(1,"system-modal-header",1),u.NdJ("close",(function(){return t.closeModal()})),u._uU(2),u.qZA(),u.TgZ(3,"system-modal-content",2),u._UZ(4,"system-object-preview",3),u.qZA(),u.TgZ(5,"system-modal-footer")(6,"button",4),u.NdJ("click",(function(){return t.closeModal()})),u._UZ(7,"system-label",5),u.qZA(),u.TgZ(8,"button",6),u.NdJ("click",(function(){return t.closeModal(!0)})),u._UZ(9,"system-label",7),u.qZA()()()),2&e&&(u.xp6(2),u.Oqu(t.name),u.xp6(2),u.Q6J("data",t.data)("type",t.type))},dependencies:[f._,se.j,ie.x,le.p,ne.y,We.s],encapsulation:2})}return OutputRevisionsPDFTabContainerPreview})();var et=s(46538),tt=s(12646),st=s(98594),it=s(54021);let lt=(()=>{class ModuleOutputTemplates{static ɵfac=function(e){return new(e||ModuleOutputTemplates)};static ɵmod=u.oAB({type:ModuleOutputTemplates});static ɵinj=u.cJS({imports:[i.ez,l.u5,o.ObjectFields,a.GlobalComponents,d.ObjectComponents,c.SystemComponents,n.o]})}return ModuleOutputTemplates})();("undefined"==typeof ngJitMode||ngJitMode)&&u.kYT(lt,{declarations:[E,A,B,Q,Y.N,P.s,ee,Ne,I,Ee,Ke,Ye,Xe],imports:[i.ez,l.u5,o.ObjectFields,a.GlobalComponents,d.ObjectComponents,c.SystemComponents,n.o],exports:[Y.N]}),u.B6R(Ke,[i.sg,i.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Z.J,et.a,tt.t,f._,st.h,We.s,it._,Ye],[])}}]);