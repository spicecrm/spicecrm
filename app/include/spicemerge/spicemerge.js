/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.01.001
 * date: 2021-04-05 20:18:39
 * build: 2021.01.001.1617646719045
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,r){var l,o=arguments.length,d=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;0<=a;a--)(l=e[a])&&(d=(o<3?l(d):3<o?l(t,s,d):l(t,s))||d);return 3<o&&d&&Object.defineProperty(t,s,d),d},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(s,r){return function(e,t){r(e,t,s)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleSpiceMerge=exports.ObjectMergeModalExecute=exports.ObjectMergeModalDataField=exports.ObjectMergeModalData=exports.ObjectMergeModalRecords=exports.ObjectMergeModal=exports.objectmerge=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),directives_1=require("../../directives/directives"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),services_1=require("../../services/services"),objectmerge=function(){function e(e){this.metadata=e,this.masterId="",this.masterModule="",this.mergeFields=[],this.mergeSource={}}return e.prototype.setModule=function(e){this.masterModule=e,this.getMergeFields()},e.prototype.getMergeFields=function(){this.mergeFields=[];var e,t=this.metadata.getModuleFields(this.masterModule);for(e in t)t.hasOwnProperty(e)&&"disabled"!==t[e].duplicate_merge&&"non-db"!=t[e].source&&"id"!=t[e].type&&this.mergeFields.push(t[e])},e.prototype.setAllfieldSources=function(e){this.mergeSource={};for(var t=0,s=this.mergeFields;t<s.length;t++){var r=s[t];this.mergeSource[r.name]=e}},__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.metadata])],e)}();exports.objectmerge=objectmerge;var ObjectMergeModal=function(){function ObjectMergeModal(e,t,s,r,l,o,d,a){this.language=e,this.metadata=t,this.objectmerge=s,this.parentmodel=r,this.model=l,this.modellist=o,this.backend=d,this.modal=a,this.mergemodels=[],this.merged$=new core_1.EventEmitter,this.currentMergeStep=0,this.mergeSteps=["records","fields","execute"]}return ObjectMergeModal.prototype.ngOnInit=function(){this.model.id=this.parentmodel.id,this.model.module=this.parentmodel.module,this.model.data=this.parentmodel.data,this.modellist._module=this.model.module,this.modellist.setListType("all",!1,[],!1),this.objectmerge.setModule(this.model.module),this.objectmerge.masterId=this.model.id,this.objectmerge.setAllfieldSources(this.model.id),this.model.data.selected=!0,this.model.data.id=this.model.id,this.modellist.listData.list.push(this.model.data);for(var e=0,t=this.mergemodels;e<t.length;e++){var s=t[e];this.modellist.listData.list.push(s)}},ObjectMergeModal.prototype.closeModal=function(){this.self.destroy()},ObjectMergeModal.prototype.getCurrentStep=function(){return this.mergeSteps[this.currentMergeStep]},ObjectMergeModal.prototype.getStepClass=function(e){e=this.mergeSteps.indexOf(e);return e==this.currentMergeStep?"slds-is-active":e<this.currentMergeStep?"slds-is-completed":void 0},ObjectMergeModal.prototype.getStepComplete=function(e){return this.mergeSteps.indexOf(e)<this.currentMergeStep},Object.defineProperty(ObjectMergeModal.prototype,"progressBarWidth",{get:function(){return{width:this.currentMergeStep/(this.mergeSteps.length-1)*100+"%"}},enumerable:!1,configurable:!0}),ObjectMergeModal.prototype.nextStep=function(){var s=this;if(this.currentMergeStep<this.mergeSteps.length-1)this.currentMergeStep,this.currentMergeStep++;else{for(var e={},t=0,r=this.objectmerge.mergeFields;t<r.length;t++){var l=r[t];this.objectmerge.mergeSource[l.name]!=this.objectmerge.masterId&&(e[l.name]=this.objectmerge.mergeSource[l.name])}for(var o=[],d=0,a=this.modellist.listData.list;d<a.length;d++){var i=a[d];i.id!=this.objectmerge.masterId&&i.selected&&o.push(i.id)}this.modal.openModal("SystemLoadingModal").subscribe(function(t){t.instance.messagelabel="LBL_MERGING",s.backend.postRequest("module/"+s.model.module+"/"+s.objectmerge.masterId+"/merge_bean",{},{fields:e,toDeleteBeanIds:o}).subscribe(function(e){t.instance.self.destroy(),s.model.id!=s.objectmerge.masterId?(s.model.id=s.objectmerge.masterId,s.model.goDetail()):(s.merged$.emit(!0),s.merged$.complete()),s.closeModal()})})}},Object.defineProperty(ObjectMergeModal.prototype,"prevDisabled",{get:function(){return 0===this.currentMergeStep},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectMergeModal.prototype,"nextDisabled",{get:function(){return 0===this.currentMergeStep&&!(1<this.modellist.getSelectedCount())},enumerable:!1,configurable:!0}),ObjectMergeModal.prototype.prevStep=function(){0<this.currentMergeStep&&this.currentMergeStep--},__decorate([core_1.Input(),__metadata("design:type",Array)],ObjectMergeModal.prototype,"mergemodels",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ObjectMergeModal.prototype,"merged$",void 0),__decorate([core_1.Component({selector:"object-merge-modal",template:'<system-modal size="large"><system-modal-header (close)="closeModal()"><system-label label="LBL_MERGE_RECORD"></system-label> - {{model.data.summary_text}}</system-modal-header><system-modal-content margin="none" [grow]="true"><object-merge-modal-records [hidden]="currentMergeStep!==0"></object-merge-modal-records><object-merge-modal-data [hidden]="currentMergeStep!==1"></object-merge-modal-data><object-merge-modal-execute [hidden]="currentMergeStep!==2"></object-merge-modal-execute></system-modal-content><system-modal-footer><div class="slds-grid slds-grid--align-spread"><div class="slds-progress slds-progress--shade slds-order--2"><ol class="slds-progress__list"><li *ngFor="let mergeStep of mergeSteps" class="slds-progress__item" [ngClass]="getStepClass(mergeStep)"><button class="slds-button slds-progress__marker" [ngClass]="{\'slds-button--icon slds-progress__marker--icon\': getStepComplete(mergeStep)}"><system-button-icon *ngIf="getStepComplete(mergeStep)" [icon]="\'success\'"></system-button-icon></button></li></ol><div class="slds-progress-bar slds-progress-bar_x-small"><div class="slds-progress-bar__value" [ngStyle]="progressBarWidth"></div></div></div><button class="slds-button slds-button--neutral slds-order--1" (click)="prevStep()" [disabled]="prevDisabled"><system-label label="LBL_PREVIOUS"></system-label></button> <button class="slds-button slds-button--brand slds-order--3" (click)="nextStep()" [disabled]="nextDisabled"><system-label label="LBL_NEXT"></system-label></button></div></system-modal-footer></system-modal>',providers:[services_1.model,services_1.modellist,objectmerge]}),__param(3,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.language,services_1.metadata,objectmerge,services_1.model,services_1.model,services_1.modellist,services_1.backend,services_1.modal])],ObjectMergeModal)}();exports.ObjectMergeModal=ObjectMergeModal;var ObjectMergeModalRecords=function(){function e(e,t,s,r){this.language=e,this.metadata=t,this.model=s,this.modellist=r,this.listFields=[];for(var r=this.metadata.getComponentConfig("ObjectMergeModalRecords",this.model.module),l=0,o=this.metadata.getFieldSetFields(r.fieldset);l<o.length;l++){var d=o[l];!1!==d.fieldconfig.default&&this.listFields.push(d)}}return e.prototype.disableSelect=function(e){return e.id==this.model.id},__decorate([core_1.Component({selector:"object-merge-modal-records",template:'<table class="slds-table slds-table--bordered slds-table--cell-buffer"><thead><tr class="slds-text-title--caps" object-list-header [showRowActionMenu]="false"></tr></thead><tbody><tr object-list-item *ngFor="let listItem of modellist.listData.list" [rowselect]="true" [rowselectdisabled]="disableSelect(listItem)" [listItem]="listItem" [showActionMenu]="false" class="slds-hint-parent"></tr></tbody></table>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modellist])],e)}();exports.ObjectMergeModalRecords=ObjectMergeModalRecords;var ObjectMergeModalData=function(){function e(e,t,s,r){this.language=e,this.metadata=t,this.modellist=s,this.objectmerge=r,this.modelFields={}}return e.prototype.getSelected=function(){for(var e=[],t=0,s=this.modellist.listData.list;t<s.length;t++){var r=s[t];r.selected&&e.push(r)}return e},e.prototype.selectAllFields=function(e){this.objectmerge.setAllfieldSources(e)},e.prototype.showField=function(e){for(var t=0,s=this.getSelected();t<s.length;t++)if(""!=s[t][e.name])return!0;return!1},__decorate([core_1.Component({selector:"object-merge-modal-data",template:'<table class="slds-table slds-table--bordered slds-table--cell-buffer"><thead><tr class="slds-text-title--caps"><th scope="col"></th><th scope="col" *ngFor="let item of getSelected()"><div class="slds-truncate">{{item.summary_text}}</div></th></tr></thead><tbody><tr><td></td><td class="slds-truncate" *ngFor="let item of getSelected()"><a href="javascript:void(0)" (click)="selectAllFields(item.id)"><system-label label="LBL_SELECT_ALL_FIELDS"></system-label></a></td></tr><tr><td></td><td class="slds-truncate" *ngFor="let item of getSelected()"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-radio"><input type="radio" [id]="\'master\'+item.id" name="master" [value]="item.id" [(ngModel)]="objectmerge.masterId"> <label class="slds-radio__label" [attr.for]="\'master\'+item.id"><span class="slds-radio--faux"></span> <span class="slds-form-element__label"><system-label label="LBL_USE_AS_MASTER"></system-label></span></label></div></div></div></td></tr><tr *ngFor="let mergeField of objectmerge.mergeFields"><ng-container *ngIf="showField(mergeField)"><td class="slds-truncate"><system-label-fieldname [module]="modellist.module" [field]="mergeField.name"></system-label-fieldname></td><td class="slds-truncate" *ngFor="let item of getSelected()"><div class="slds-grid"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-radio"><input type="radio" [id]="\'master\'+mergeField.name+item.id" [name]="mergeField.name" [value]="item.id" [(ngModel)]="objectmerge.mergeSource[mergeField.name]"> <label class="slds-radio__label" [attr.for]="\'master\'+mergeField.name+item.id"><span class="slds-radio--faux"></span></label></div></div></div><object-merge-modal-data-field [fieldname]="mergeField.name" [fielddata]="item"></object-merge-modal-data-field></div></td></ng-container></tr></tbody></table>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.modellist,objectmerge])],e)}();exports.ObjectMergeModalData=ObjectMergeModalData;var ObjectMergeModalDataField=function(){function e(e,t){this.model=e,this.modellist=t,this.fieldname="",this.fielddata={},this.model.module=this.modellist.module}return e.prototype.ngOnInit=function(){this.model.data=this.fielddata},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fielddata",void 0),__decorate([core_1.Component({selector:"object-merge-modal-data-field",template:'<field-container [field]="fieldname" [fielddisplayclass]="\'slds-truncate\'"></field-container>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.model,services_1.modellist])],e)}();exports.ObjectMergeModalDataField=ObjectMergeModalDataField;var ObjectMergeModalExecute=function(){function e(e,t,s){this.language=e,this.metadata=t,this.model=s}return __decorate([core_1.Component({selector:"object-merge-modal-execute",template:'<div class="slds-p-around--medium"><div class="slds-grid slds-grid--align-center slds-text-heading--medium slds-p-vertical--medium"><system-label label="MSG_CONFIRM_MERGE"></system-label></div><div class="slds-grid slds-grid--align-center slds-p-vertical--medium"><system-label label="MSG_CONFIRM_MERGE" length="long"></system-label></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model])],e)}();exports.ObjectMergeModalExecute=ObjectMergeModalExecute;var ModuleSpiceMerge=function(){function ModuleSpiceMerge(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[ObjectMergeModal,ObjectMergeModalRecords,ObjectMergeModalData,ObjectMergeModalDataField,ObjectMergeModalExecute]})],ModuleSpiceMerge)}();exports.ModuleSpiceMerge=ModuleSpiceMerge;