/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-16 09:05:07
 * build: 2021.02.001.1626419107136
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,o){var l,r=arguments.length,d=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,s,o);else for(var a=e.length-1;0<=a;a--)(l=e[a])&&(d=(r<3?l(d):3<r?l(t,s,d):l(t,s))||d);return 3<r&&d&&Object.defineProperty(t,s,d),d},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(s,o){return function(e,t){o(e,t,s)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleSpiceMerge=exports.ObjectMergeModalExecute=exports.ObjectMergeModalDataField=exports.ObjectMergeModalData=exports.ObjectMergeModalRecords=exports.ObjectMergeModal=exports.objectmerge=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),directives_1=require("../../directives/directives"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),services_1=require("../../services/services"),router_1=require("@angular/router"),objectmerge=function(){function e(e){this.metadata=e,this.masterId="",this.allowSwitchMaster=!0,this.masterModule="",this.mergeFields=[],this.mergeSource={}}return e.prototype.setModule=function(e){this.masterModule=e,this.getMergeFields()},e.prototype.getMergeFields=function(){this.mergeFields=[];var e,t=this.metadata.getModuleFields(this.masterModule);for(e in t)t.hasOwnProperty(e)&&"disabled"!==t[e].duplicate_merge&&"non-db"!=t[e].source&&"id"!=t[e].type&&this.mergeFields.push(t[e])},e.prototype.setAllfieldSources=function(e){this.mergeSource={};for(var t=0,s=this.mergeFields;t<s.length;t++){var o=s[t];this.mergeSource[o.name]=e}},__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.metadata])],e)}();exports.objectmerge=objectmerge;var ObjectMergeModal=function(){function ObjectMergeModal(e,t,s,o,l,r,d,a,i){this.broadcast=e,this.router=t,this.metadata=s,this.objectmerge=o,this.parentmodel=l,this.model=r,this.modellist=d,this.backend=a,this.modal=i,this.mergemodels=[],this.currentMergeStep=0,this.mergeSteps=["records","fields","execute"]}return ObjectMergeModal.prototype.ngOnInit=function(){this.model.module=this.parentmodel.module,this.modellist.module=this.model.module,this.modellist.setListType("all",!1),this.objectmerge.setModule(this.model.module),this.parentmodel.id?(this.model.id=this.parentmodel.id,this.model.data=this.parentmodel.data,this.objectmerge.masterId=this.model.id,this.objectmerge.setAllfieldSources(this.model.id),this.objectmerge.allowSwitchMaster=this.parentmodel.checkAccess("delete"),this.model.data.selected=!0,this.model.data.id=this.model.id,this.modellist.listData.list.push(this.model.data)):(this.mergeSteps=["fields","execute"],this.mergemodels.length==this.mergemodels.filter(function(e){return null===(e=e.acl)||void 0===e?void 0:e.delete}).length?this.objectmerge.masterId=this.mergemodels[0].id:(this.objectmerge.masterId=this.mergemodels.find(function(e){return!(null!==(e=e.acl)&&void 0!==e&&e.delete)}).id,this.objectmerge.allowSwitchMaster=!1),this.objectmerge.setAllfieldSources(this.objectmerge.masterId));for(var e=0,t=this.mergemodels;e<t.length;e++){var s=t[e];this.modellist.listData.list.push(s)}},ObjectMergeModal.prototype.closeModal=function(){this.self.destroy()},ObjectMergeModal.prototype.getCurrentStep=function(){return this.mergeSteps[this.currentMergeStep]},ObjectMergeModal.prototype.nextStep=function(){var r=this;if(this.currentMergeStep<this.mergeSteps.length-1)this.currentMergeStep,this.currentMergeStep++;else{for(var e={},t=0,s=this.objectmerge.mergeFields;t<s.length;t++){var o=s[t];this.objectmerge.mergeSource[o.name]!=this.objectmerge.masterId&&(e[o.name]=this.objectmerge.mergeSource[o.name])}for(var d=[],l=0,a=this.modellist.listData.list;l<a.length;l++){var i=a[l];i.id!=this.objectmerge.masterId&&i.selected&&d.push(i.id)}this.modal.openModal("SystemLoadingModal").subscribe(function(l){l.instance.messagelabel="LBL_MERGING",r.backend.postRequest("module/"+r.model.module+"/"+r.objectmerge.masterId+"/mergebeans",{},{fields:e,duplicates:d}).subscribe(function(e){l.instance.self.destroy(),r.broadcast.broadcastMessage("model.save",{id:r.objectmerge.masterId,module:r.model.module,data:e.data}),r.broadcast.broadcastMessage("model.merge",{id:r.objectmerge.masterId,module:r.model.module});for(var t=0,s=d;t<s.length;t++){var o=s[t];r.broadcast.broadcastMessage("model.delete",{id:o,module:r.model.module})}r.model.id&&r.model.id!=r.objectmerge.masterId&&r.router.navigate(["/module/"+r.model.module+"/"+r.objectmerge.masterId]),r.closeModal()})})}},Object.defineProperty(ObjectMergeModal.prototype,"prevDisabled",{get:function(){return 0===this.currentMergeStep},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectMergeModal.prototype,"nextDisabled",{get:function(){return 0===this.currentMergeStep&&this.modellist.getSelectedCount()<=1},enumerable:!1,configurable:!0}),ObjectMergeModal.prototype.prevStep=function(){0<this.currentMergeStep&&this.currentMergeStep--},__decorate([core_1.Input(),__metadata("design:type",Array)],ObjectMergeModal.prototype,"mergemodels",void 0),__decorate([core_1.Component({selector:"object-merge-modal",template:'<system-modal size="large"><system-modal-header (close)="closeModal()"><system-label label="LBL_MERGE_RECORD"></system-label><span *ngIf="model.id">&nbsp;-&nbsp;{{model.data.summary_text}}</span></system-modal-header><system-modal-content margin="none" [grow]="true"><object-merge-modal-records [hidden]="getCurrentStep() != \'records\'"></object-merge-modal-records><object-merge-modal-data [hidden]="getCurrentStep() != \'fields\'"></object-merge-modal-data><object-merge-modal-execute [hidden]="getCurrentStep() != \'execute\'"></object-merge-modal-execute></system-modal-content><system-modal-footer><div class="slds-grid slds-grid--align-spread slds-grid--vertical-align-center"><button class="slds-button slds-button--neutral slds-order--1" (click)="prevStep()" [disabled]="prevDisabled"><system-label label="LBL_PREVIOUS"></system-label></button><system-progress-list class="slds-grow slds-order--2" system-progress-list-shade [steps]="mergeSteps" [step]="currentMergeStep"></system-progress-list><button class="slds-button slds-button--brand slds-order--3" (click)="nextStep()" [disabled]="nextDisabled"><system-label label="LBL_NEXT"></system-label></button></div></system-modal-footer></system-modal>',providers:[services_1.model,services_1.modellist,objectmerge]}),__param(4,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.broadcast,router_1.Router,services_1.metadata,objectmerge,services_1.model,services_1.model,services_1.modellist,services_1.backend,services_1.modal])],ObjectMergeModal)}();exports.ObjectMergeModal=ObjectMergeModal;var ObjectMergeModalRecords=function(){function e(e,t,s){this.metadata=e,this.model=t,this.modellist=s,this.listFields=[];for(var s=this.metadata.getComponentConfig("ObjectMergeModalRecords",this.model.module),o=0,l=this.metadata.getFieldSetFields(s.fieldset);o<l.length;o++){var r=l[o];!1!==r.fieldconfig.default&&this.listFields.push(r)}}return e.prototype.isCurrentModel=function(e){return this.model.id&&this.model.id==e},e.prototype.disableSelect=function(e){var t;return e.id==this.model.id||null===(t=e.acl)||void 0===t||!t.delete},__decorate([core_1.Component({selector:"object-merge-modal-records",template:'<table class="slds-table slds-table--bordered slds-table--cell-buffer"><thead><tr class="slds-text-title--caps" object-list-header [showRowActionMenu]="false"></tr></thead><tbody><tr [ngClass]="{\'slds-theme--success\' : isCurrentModel(listItem.id)}" object-list-item *ngFor="let listItem of modellist.listData.list" [displaylinks]="false" [rowselect]="true" [rowselectdisabled]="disableSelect(listItem)" [listItem]="listItem" [showActionMenu]="false" class="slds-hint-parent"></tr></tbody></table>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.modellist])],e)}();exports.ObjectMergeModalRecords=ObjectMergeModalRecords;var ObjectMergeModalData=function(){function e(e,t,s,o,l){this.view=e,this.metadata=t,this.modellist=s,this.objectmerge=o,this.model=l,this.view.displayLabels=!1}return Object.defineProperty(e.prototype,"canSwitchMaster",{get:function(){return this.objectmerge.allowSwitchMaster},enumerable:!1,configurable:!0}),e.prototype.getSelected=function(){return this.modellist.listData.list.filter(function(e){return e.selected})},e.prototype.isCurrentModel=function(e){return this.model.id&&(this.model.id==e||this.model.data.id==e)},e.prototype.selectAllFields=function(e){this.objectmerge.setAllfieldSources(e)},e.prototype.showField=function(e){for(var t=0,s=this.getSelected();t<s.length;t++)if(""!=s[t][e.name])return!0;return!1},__decorate([core_1.Component({selector:"object-merge-modal-data",template:'<table class="slds-table slds-table--col-bordered slds-no-row-hover slds-table--fixed-layout"><tbody><tr><td></td><td class="slds-text-align--center" *ngFor="let item of getSelected()"><a href="javascript:void(0)" (click)="selectAllFields(item.id)"><system-label label="LBL_SELECT_ALL_FIELDS"></system-label></a></td></tr><tr><td></td><td class="slds-text-align--center" *ngFor="let item of getSelected()"><div class="slds-form-element"><div class="slds-form-element__control"><system-input-radio name="master" [value]="item.id" [disabled]="!canSwitchMaster" [(ngModel)]="objectmerge.masterId"><system-label class="slds-p-left--xx-small" label="LBL_USE_AS_MASTER"></system-label></system-input-radio></div></div></td></tr></tbody></table><table class="slds-table slds-table--col-bordered slds-no-row-hover slds-table--fixed-layout slds-table--striped slds-border--bottom"><thead><tr class="slds-text-title_bold slds-border--bottom slds-border--top"><th scope="col"></th><th scope="col" *ngFor="let item of getSelected()"><div class="slds-truncate slds-text-align--center" [ngClass]="{\'slds-text-color_success\': isCurrentModel(item.id)}">{{item.summary_text}}</div></th></tr></thead><tbody><ng-container *ngFor="let mergeField of objectmerge.mergeFields"><tr *ngIf="showField(mergeField)" class="slds-align-top"><td class="slds-truncate"><system-label-fieldname [module]="modellist.module" [field]="mergeField.name"></system-label-fieldname></td><td class="slds-truncate" *ngFor="let item of getSelected()"><div class="slds-grid"><system-input-radio name="master" [name]="mergeField.name" [value]="item.id" [(ngModel)]="objectmerge.mergeSource[mergeField.name]"></system-input-radio><object-merge-modal-data-field [fieldname]="mergeField.name" [fielddata]="item"></object-merge-modal-data-field></div></td></tr></ng-container></tbody></table>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.view,services_1.metadata,services_1.modellist,objectmerge,services_1.model])],e)}();exports.ObjectMergeModalData=ObjectMergeModalData;var ObjectMergeModalDataField=function(){function e(e,t){this.model=e,this.modellist=t,this.fieldname="",this.fielddata={},this.model.module=this.modellist.module}return e.prototype.ngOnInit=function(){this.model.data=this.fielddata},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fielddata",void 0),__decorate([core_1.Component({selector:"object-merge-modal-data-field",template:'<field-container [field]="fieldname" [fielddisplayclass]="\'slds-truncate\'"></field-container>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.model,services_1.modellist])],e)}();exports.ObjectMergeModalDataField=ObjectMergeModalDataField;var ObjectMergeModalExecute=function(){function e(){}return __decorate([core_1.Component({selector:"object-merge-modal-execute",template:'<div class="slds-p-around--medium"><div class="slds-grid slds-grid--align-center slds-text-heading--medium slds-p-vertical--medium"><system-label label="MSG_CONFIRM_MERGE"></system-label></div><div class="slds-grid slds-grid--align-center slds-p-vertical--medium"><system-label label="MSG_CONFIRM_MERGE" length="long"></system-label></div></div>'})],e)}();exports.ObjectMergeModalExecute=ObjectMergeModalExecute;var ModuleSpiceMerge=function(){function ModuleSpiceMerge(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[ObjectMergeModal,ObjectMergeModalRecords,ObjectMergeModalData,ObjectMergeModalDataField,ObjectMergeModalExecute]})],ModuleSpiceMerge)}();exports.ModuleSpiceMerge=ModuleSpiceMerge;