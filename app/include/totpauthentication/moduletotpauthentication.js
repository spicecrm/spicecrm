/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.02.001
 * date: 2021-07-16 09:05:07
 * build: 2021.02.001.1626419107136
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,o){var a,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;0<=l;l--)(a=e[l])&&(i=(n<3?a(i):3<n?a(t,s,i):a(t,s))||i);return 3<n&&i&&Object.defineProperty(t,s,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleTOTPAuthentication=exports.TOTPAuthenticationGenerateModal=exports.TOTPAuthenticationGenerateButton=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),directives_1=require("../../directives/directives"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),services_1=require("../../services/services"),TOTPAuthenticationGenerateButton=function(){function TOTPAuthenticationGenerateButton(e,t,s,o,a){this.language=e,this.model=t,this.modal=s,this.backend=o,this.injector=a}return TOTPAuthenticationGenerateButton.prototype.execute=function(){var t=this,s=this.modal.await(this.language.getLabel("MSG_TOTP_STATUSCHECK"));this.backend.getRequest("authentication/totp").subscribe(function(e){s.emit(!0),e.active?t.modal.confirm(t.language.getLabel("MSG_TOTP_DELETE",null,"long"),t.language.getLabel("MSG_TOTP_DELETE")).subscribe(function(e){e&&(s=t.modal.await(t.language.getLabel("MSG_TOTP_DELETING")),t.backend.deleteRequest("authentication/totp").subscribe(function(e){s.emit(!0),t.generateTOTP()},function(){s.emit(!0)}))}):t.generateTOTP()},function(){s.emit(!0)})},TOTPAuthenticationGenerateButton.prototype.generateTOTP=function(){this.modal.openModal("TOTPAuthenticationGenerateModal",!0,this.injector)},__decorate([core_1.Component({selector:"totp-authenticatio-generate-button",template:'<system-label label="LBL_TOTP_AUTHENTICATOR"></system-label>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.backend,core_1.Injector])],TOTPAuthenticationGenerateButton)}();exports.TOTPAuthenticationGenerateButton=TOTPAuthenticationGenerateButton;var TOTPAuthenticationGenerateModal=function(){function TOTPAuthenticationGenerateModal(e,t,s,o,a,n){this.language=e,this.metadata=t,this.modal=s,this.model=o,this.backend=a,this.toast=n,this.code=""}return TOTPAuthenticationGenerateModal.prototype.ngOnInit=function(){var t=this,s=this.modal.await(this.language.getLabel("MSG_TOTP_GENERATING_CODE"));this.backend.getRequest("authentication/totp/generate").subscribe(function(e){s.emit(!0),e.secret?(t.QRCode="data:image/png;base64,"+e.qrcode,t.secret=e.secret,t.name=e.name):(t.toast.sendToast("Error generating Code","error"),t.close())},function(){t.toast.sendToast("Error generating Code","error"),t.close(),s.emit(!0)})},TOTPAuthenticationGenerateModal.prototype.close=function(){this.self.destroy()},TOTPAuthenticationGenerateModal.prototype.save=function(){var t=this;this.backend.putRequest("authentication/totp/validate/"+this.code).subscribe(function(e){e.validated?t.close():t.toast.sendToast("Error validating your code","warning","the code you entered is not valid, please try again",!0),t.code=""},function(){t.toast.sendToast("Error validating your code","error","there as an internal error validating your request",!0),t.code=""})},__decorate([core_1.Component({selector:"totp-authentication-generate-modal",template:'<system-modal *ngIf="secret" size="small"><system-modal-header (close)="close()"><system-label label="LBL_TOTP_AUTHENTICATOR"></system-label></system-modal-header><system-modal-content><div class="slds-grid"><div class="slds-size--1-of-2"><system-label label="MSG_AUTHENTICATOR_INSTRUCTIONS" length="long"></system-label></div><div class="slds-size--1-of-2 slds-align--absolute-center slds-grid slds-grid--vertical"><div class="slds-p-vertical--small">{{name}}</div><img style="width: 200px; height: 200px;" *ngIf="QRCode" [src]="QRCode"><div class="slds-p-vertical--small">{{secret}}</div></div></div></system-modal-content><system-modal-footer><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread"><div class="slds-grid slds-grid--vertical-align-center"><system-label label="LBL_CODE"></system-label> <input class="slds-m-left--x-small slds-input" maxlength="6" style="width: 6rem" [(ngModel)]="code"></div><div class="slds-grid"><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button [disabled]="code.length != 6" class="slds-button slds-button--brand" (click)="save()"><system-label label="LBL_SAVE"></system-label></button></div></div></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.modal,services_1.model,services_1.backend,services_1.toast])],TOTPAuthenticationGenerateModal)}();exports.TOTPAuthenticationGenerateModal=TOTPAuthenticationGenerateModal;var ModuleTOTPAuthentication=function(){function ModuleTOTPAuthentication(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[TOTPAuthenticationGenerateButton,TOTPAuthenticationGenerateModal]})],ModuleTOTPAuthentication)}();exports.ModuleTOTPAuthentication=ModuleTOTPAuthentication;