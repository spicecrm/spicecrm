/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-15 08:39:15
 *
 *                     build: 2023.02.001.1692081555935
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["default-src_modules_outputtemplates_components_objectactionoutputbeanmodal_ts"],{2486:(t,e,s)=>{s.d(e,{s:()=>N});var i=s(1180),l=s(2242),n=s(2294),a=s(1591),o=s(2198),d=s(3507),c=s(5329),m=s(5710),r=s(4154),u=s(4044),h=s(4505),p=s(6550),f=s(6163),g=s(4755),b=s(5030),_=s(8861),Z=s(2656),v=s(3463),x=s(9621),w=s(3499),A=s(5767),T=s(1916),B=s(4664);function y(t,e){if(1&t&&(l.TgZ(0,"option",30),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngValue",t),l.xp6(1),l.AsE("",t.name," (",t.language,")")}}function M(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"div",31)(2,"label",6),l._UZ(3,"system-label",32),l.qZA(),l.TgZ(4,"div",8)(5,"div",9)(6,"select",10),l.NdJ("ngModelChange",(function(e){l.CHM(t);const s=l.oxw();return l.KtG(s.selected_format=e)})),l.TgZ(7,"option",33),l._uU(8,"HTML"),l.qZA(),l.TgZ(9,"option",34),l._uU(10,"PDF"),l.qZA()()()()(),l.BQk()}if(2&t){const t=l.oxw();l.xp6(6),l.Q6J("ngModel",t.selected_format)("disabled",0==t.templates.length)}}const O=function(t){return{"slds-is-selected":t}};function L(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",35),l.NdJ("click",(function(){l.CHM(t);const e=l.oxw();return l.KtG(e.openEmailArea())})),l._UZ(1,"system-button-icon",36),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",!t.selected_template||t.loading_output||"html"===t.selected_format)("ngClass",l.VKq(2,O,t.expanded))}}function E(t,e){if(1&t&&l._UZ(0,"iframe",37),2&t){const t=l.oxw();l.Q6J("srcdoc",t.sanitizedTemplated,l.oJD)}}function J(t,e){if(1&t&&l._UZ(0,"object",38),2&t){const t=l.oxw();l.Q6J("data",t.blobUrl,l.uOi)}}function k(t,e){1&t&&(l.TgZ(0,"div",39),l._UZ(1,"system-spinner"),l.qZA())}function C(t,e){1&t&&(l.TgZ(0,"div",39),l._UZ(1,"system-label",40),l.qZA())}function I(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"object-action-output-bean-modal-email-content",41,42),l.NdJ("email_sent",(function(){l.CHM(t);const e=l.oxw();return l.KtG(e.emailSent())})),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("fieldset",t.fieldset_email)("filelist",t.filelist)("parent",t.model)}}function U(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",43),l.NdJ("click",(function(){l.CHM(t);const e=l.oxw();return l.KtG(e.create())})),l._uU(1),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",!t.selected_template||t.loading_output),l.xp6(1),l.Oqu(t.buttonText)}}function F(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",43),l.NdJ("click",(function(){l.CHM(t);const e=l.oxw();return l.KtG(e.sendEmail())})),l._uU(1),l.qZA()}if(2&t){const t=l.oxw();l.Q6J("disabled",!t.selected_template||t.loading_output||!t.canSend),l.xp6(1),l.Oqu(t.language.getLabel("LBL_SENDEMAIL"))}}let N=(()=>{var t;class ObjectActionOutputBeanModal{constructor(t,e,s,n,a,o,d,c,m,r){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"outputModalService",void 0),(0,i.Z)(this,"sanitizer",void 0),(0,i.Z)(this,"viewContainerRef",void 0),(0,i.Z)(this,"modelutilities",void 0),(0,i.Z)(this,"emailContent",void 0),(0,i.Z)(this,"actionemitter",new l.vpe),(0,i.Z)(this,"modalTitle",void 0),(0,i.Z)(this,"forcedFormat",void 0),(0,i.Z)(this,"noDownload",!1),(0,i.Z)(this,"handBack",void 0),(0,i.Z)(this,"buttonText",void 0),(0,i.Z)(this,"contentForHandBack",void 0),(0,i.Z)(this,"liveCompile",!1),(0,i.Z)(this,"customActionsetId",void 0),(0,i.Z)(this,"self",void 0),(0,i.Z)(this,"templates",[]),(0,i.Z)(this,"_selected_template",null),(0,i.Z)(this,"_selected_format","pdf"),(0,i.Z)(this,"compiled_selected_template",""),(0,i.Z)(this,"loading_output",!1),(0,i.Z)(this,"fieldset_email",""),(0,i.Z)(this,"file",void 0),(0,i.Z)(this,"filelist",[]),(0,i.Z)(this,"showsendemail",!1),(0,i.Z)(this,"expanded",!1),(0,i.Z)(this,"emailInitialized",!1),(0,i.Z)(this,"blobUrl",void 0),this.language=t,this.model=e,this.metadata=s,this.modal=n,this.view=a,this.backend=o,this.outputModalService=d,this.sanitizer=c,this.viewContainerRef=m,this.modelutilities=r;let u=this.metadata.getComponentConfig("ObjectActionOutputBeanModal");this.fieldset_email=u.fieldset_email}ngOnInit(){this.setModalData(),this.setSelectedTemplate(),this.selected_template||1!=this.templates.length||(this.selected_template=this.templates[0])}setModalData(){this.modalTitle||(this.modalTitle=this.language.getLabel(this.language.getLabel("LBL_OUTPUT_TEMPLATE"))),this.buttonText||(this.buttonText=this.language.getLabel(this.noDownload?"LBL_OK":"LBL_DOWNLOAD")),this.forcedFormat&&(this._selected_format=this.forcedFormat)}setSelectedTemplate(){let t=this.metadata.getModuleFields(this.model.module);for(let e in t)if("relate"==t[e].type&&"OutputTemplates"==t[e].module){let s=this.templates.find((s=>s.id==this.model.getFieldValue(t[e].id_name)));s&&(this.selected_template=s);break}}set selected_template(t){this._selected_template=t,this.outputModalService.selectedTemplate=t,this.rendertemplate()}get selected_template(){return this._selected_template}get selected_format(){return this._selected_format}set selected_format(t){this._selected_format=t,this.expanded=!1,this.rendertemplate()}get sanitizedTemplated(){return this.sanitizer.bypassSecurityTrustHtml(this.compiled_selected_template)}rendertemplate(){switch(this.loading_output=!0,this.blobUrl=null,this.compiled_selected_template=null,this.selected_format){case"pdf":const t={bean_data:this.liveCompile?this.modelutilities.spiceModel2backend(this.model.module,this.model.data):null};this.backend.postRequest(`module/OutputTemplates/${this.selected_template.id}/convert/${this.model.id}/to/pdf/base64`,null,t).subscribe({next:t=>{let e=this.datatoBlob(atob(t.content),"application/pdf");this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e)),this.contentForHandBack=t.content,this.setEmailAttachmentData(),this.loading_output=!1},error:()=>{this.loading_output=!1}});break;case"html":this.backend.getRequest(`module/OutputTemplates/${this.selected_template.id}/compile/${this.model.id}`).subscribe({next:t=>{this.compiled_selected_template=t.content,this.contentForHandBack=t.content,this.setEmailAttachmentData(),this.loading_output=!1},error:()=>{this.loading_output=!1}})}}reload(){this.rendertemplate()}close(){this.outputModalService.modalResponse$.next("close"),this.outputModalService.modalResponse$.complete(),this.self.destroy()}create(){if(this.handBack&&this.handBack.emit({name:this.selected_template.name,content:this.contentForHandBack}),this.noDownload)this.close();else{let t=document.createElement("a");document.body.appendChild(t);let e=this.datatoBlob("pdf"==this.selected_format?atob(this.contentForHandBack):this.contentForHandBack);t.href=URL.createObjectURL(e),t.type="pdf"==this.selected_format?"application/pdf":"text/html",t.download=this.model.module+"_"+this.model.getField("summary_text")+"."+this.selected_format,t.click(),t.remove()}}set data(t){let e=this.datatoBlob(t);this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e))}datatoBlob(t,e="",s=512){let i=[];for(let e=0;e<t.length;e+=s){let l=t.slice(e,e+s),n=new Array(l.length);for(let t=0;t<l.length;t++)n[t]=l.charCodeAt(t);let a=new Uint8Array(n);i.push(a)}return new Blob(i,{type:e})}openEmailArea(){this.emailInitialized||(this.emailInitialized=!0,this.setEmailAttachmentData()),this.expanded=!this.expanded}setEmailAttachmentData(){this.emailInitialized&&(this.filelist=[{size:this.contentForHandBack.length,name:this.model.module+"_"+this.model.getField("summary_text")+"."+this.selected_format,type:"application/"+this.selected_format,filecontent:this.contentForHandBack}])}emailSent(){this.close()}get canSend(){return this.emailContent&&!this.emailContent.disabled}sendEmail(){"Letters"==this.model.module&&this.backend.postRequest(`module/Letters/${this.model.id}/marksent/${this.selected_template.id}`,null,this.model.data).subscribe((t=>{this.actionemitter.emit({close:!0,name:"sent"})})),this.emailContent.sendEmail()}handleAction(t){this.outputModalService.modalResponse$.next(t.name),t.close&&(this.model.cancelEdit(),this.close())}}return t=ObjectActionOutputBeanModal,(0,i.Z)(ObjectActionOutputBeanModal,"ɵfac",(function(e){return new(e||t)(l.Y36(c.d),l.Y36(m.o),l.Y36(r.Pu),l.Y36(u.o),l.Y36(n.e),l.Y36(h.y),l.Y36(d.w),l.Y36(p.H7),l.Y36(l.s_b),l.Y36(f.A))})),(0,i.Z)(ObjectActionOutputBeanModal,"ɵcmp",l.Xpm({type:t,selectors:[["object-action-output-bean-modal"]],viewQuery:function(t,e){if(1&t&&l.Gf(o.N,5),2&t){let t;l.iGM(t=l.CRH())&&(e.emailContent=t.first)}},outputs:{actionemitter:"actionemitter"},features:[l._Bn([n.e,d.w])],decls:34,vars:17,consts:[["size","large"],[3,"close"],["margin","none"],[1,"slds-modal__content"],[1,"slds-grid","slds-p-horizontal--x-small","slds-p-top--x-small"],[1,"slds-form-element","slds-grid","slds-grow"],[1,"slds-form-element__label"],["label","LBL_TEMPLATE"],[1,"slds-form-element__control","slds-grow"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","disabled","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],["class","slds-button slds-button--icon slds-button--icon-border slds-m-left--small",3,"disabled","ngClass","click",4,"ngIf"],[1,"slds-grid",2,"height","70vh"],[1,"slds-p-around--small",2,"height","100%","width","200%"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom",2,"width","100%","height","calc(100% - 50px)"],["frameBorder","0","style","width: 100%;height: 100%;",3,"srcdoc",4,"ngIf"],["type","application/pdf","width","100%","height","100%",3,"data",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%;",4,"ngIf"],[1,"slds-scrollable",2,"height","100%"],[3,"fieldset","filelist","parent","email_sent",4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grid--align-end"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_RELOAD"],["class","slds-button slds-button--brand",3,"disabled","click",4,"ngIf"],["containerclass","slds-button-group",1,"slds-m-left--x-small",2,"display","inline-flex",3,"actionset","actionemitter"],[3,"ngValue"],[1,"slds-form-element","slds-grid","slds-grow","slds-m-left--x-small"],["label","LBL_DISPLAY"],["value","html"],["value","pdf"],[1,"slds-button","slds-button--icon","slds-button--icon-border","slds-m-left--small",3,"disabled","ngClass","click"],["icon","email"],["frameBorder","0",2,"width","100%","height","100%",3,"srcdoc"],["type","application/pdf","width","100%","height","100%",3,"data"],[1,"slds-align--absolute-center",2,"height","100%"],["label","LBL_SELECT_TEMPLATE"],[3,"fieldset","filelist","parent","email_sent"],["emailcontent",""],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(t,e){1&t&&(l.TgZ(0,"system-modal",0)(1,"system-modal-header",1),l.NdJ("close",(function(){return e.close()})),l._uU(2),l.qZA(),l.TgZ(3,"system-modal-content",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),l._UZ(8,"system-label",7),l.qZA(),l.TgZ(9,"div",8)(10,"div",9)(11,"select",10),l.NdJ("ngModelChange",(function(t){return e.selected_template=t})),l.YNc(12,y,2,3,"option",11),l.qZA()()()(),l.YNc(13,M,11,2,"ng-container",12),l.YNc(14,L,2,4,"button",13),l.qZA(),l.TgZ(15,"div",14)(16,"div",15)(17,"div",16),l.YNc(18,E,1,1,"iframe",17),l.YNc(19,J,1,1,"object",18),l.YNc(20,k,2,0,"div",19),l.YNc(21,C,2,0,"div",19),l.qZA()(),l.TgZ(22,"div",20),l.YNc(23,I,2,3,"object-action-output-bean-modal-email-content",21),l.qZA()()()(),l.TgZ(24,"system-modal-footer")(25,"div",22)(26,"div",23)(27,"button",24),l.NdJ("click",(function(){return e.close()})),l._UZ(28,"system-label",25),l.qZA(),l.TgZ(29,"button",26),l.NdJ("click",(function(){return e.reload()})),l._UZ(30,"system-label",27),l.qZA(),l.YNc(31,U,2,2,"button",28),l.YNc(32,F,2,2,"button",28),l.qZA(),l.TgZ(33,"object-action-container",29),l.NdJ("actionemitter",(function(t){return e.handleAction(t)})),l.qZA()()()()),2&t&&(l.xp6(2),l.Oqu(e.modalTitle),l.xp6(9),l.Q6J("ngModel",e.selected_template)("disabled",0==e.templates.length),l.xp6(1),l.Q6J("ngForOf",e.templates),l.xp6(1),l.Q6J("ngIf",!e.forcedFormat),l.xp6(1),l.Q6J("ngIf",e.metadata.checkModuleAcl("Emails","create")),l.xp6(2),l.Q6J("@slideInOut",e.expanded?"open":"closed"),l.xp6(2),l.Q6J("ngIf","html"===e.selected_format&&!e.loading_output&&e.selected_template),l.xp6(1),l.Q6J("ngIf","pdf"===e.selected_format&&!e.loading_output&&e.blobUrl),l.xp6(1),l.Q6J("ngIf",e.loading_output),l.xp6(1),l.Q6J("ngIf",!e.selected_template&&!e.loading_output),l.xp6(1),l.Q6J("@slideInOut2",e.expanded?"open":"closed"),l.xp6(1),l.Q6J("ngIf",e.emailInitialized),l.xp6(6),l.Q6J("disabled",!e.selected_template||e.loading_output),l.xp6(2),l.Q6J("ngIf",!e.expanded),l.xp6(1),l.Q6J("ngIf",e.expanded),l.xp6(1),l.Q6J("actionset",e.customActionsetId))},dependencies:[g.mk,g.sg,g.O5,b.YN,b.Kr,b.EJ,b.JJ,b.On,_.S,Z.J,v._,x.j,w.x,A.p,T.y,B.W,o.N],encapsulation:2,data:{animation:[(0,a.X$)("slideInOut",[(0,a.SB)("open",(0,a.oB)({width:"50%"})),(0,a.SB)("closed",(0,a.oB)({width:"100%"})),(0,a.eR)("open <=> closed",[(0,a.jt)("200ms")])]),(0,a.X$)("slideInOut2",[(0,a.SB)("open",(0,a.oB)({width:"50%"})),(0,a.SB)("closed",(0,a.oB)({width:"0%"})),(0,a.eR)("open <=> closed",[(0,a.jt)("200ms")])])]}})),ObjectActionOutputBeanModal})()},2198:(t,e,s)=>{s.d(e,{N:()=>p});var i=s(1180),l=s(2242),n=s(5710),a=s(2294),o=s(5329),d=s(4154),c=s(4044),m=s(5920),r=s(9062),u=s(2995);const h=function(t){return{uploadfiles:t}};let p=(()=>{var t;class ObjectActionOutputBeanModalEmailContent{constructor(t,e,s,n,a,o){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"session",void 0),(0,i.Z)(this,"fieldset",null),(0,i.Z)(this,"filelist",{}),(0,i.Z)(this,"attachmentContent",void 0),(0,i.Z)(this,"parent",{}),(0,i.Z)(this,"email_sent",new l.vpe),(0,i.Z)(this,"attachmentsPanelRef",void 0),(0,i.Z)(this,"sending",!1),this.language=t,this.model=e,this.metadata=s,this.modal=n,this.view=a,this.session=o}ngOnInit(){this.setModelData(),this.setViewData()}ngOnChanges(t){t.filelist&&this.attachmentsPanelRef&&this.attachmentsPanelRef.instance.setUploadFiles(this.filelist)}setModelData(){this.model.module="Emails",this.model.initialize(this.parent);let t={};t.parent_type=this.parent.module,t.parent_id=this.parent.data.id,t.parent_name=this.parent.data.name,t.isNew=!0,t.assigned_user_id=this.session.authData.userId,t.assigned_user_name=this.session.authData.userName,t.modified_by_id=this.session.authData.userId,t.modified_by_name=this.session.authData.userName,t.date_entered=new Date,t.date_modified=new Date,this.model.setFields(t),this.model.startEdit()}setViewData(){this.view.setEditMode(),this.view.isEditable=!0}get disabled(){let t=this.model.getFieldValue("recipient_addresses"),e=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=t?t.find((t=>"to"==t.address_type)):void 0;return!(s&&e&&t&&i)||this.sending}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((t=>{t.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names")}),this.model.save().subscribe((e=>{t.instance.self.destroy(),this.email_sent.emit()}),(e=>{t.instance.self.destroy(),this.sending=!1}))}))}}return t=ObjectActionOutputBeanModalEmailContent,(0,i.Z)(ObjectActionOutputBeanModalEmailContent,"ɵfac",(function(e){return new(e||t)(l.Y36(o.d),l.Y36(n.o),l.Y36(d.Pu),l.Y36(c.o),l.Y36(a.e),l.Y36(m.n))})),(0,i.Z)(ObjectActionOutputBeanModalEmailContent,"ɵcmp",l.Xpm({type:t,selectors:[["object-action-output-bean-modal-email-content"]],inputs:{fieldset:"fieldset",filelist:"filelist",attachmentContent:"attachmentContent",parent:"parent"},outputs:{email_sent:"email_sent"},features:[l._Bn([a.e,n.o]),l.TTD],decls:2,vars:4,consts:[["direction","vertical",3,"fieldset"],["component","SpiceAttachmentsPanel",3,"componentattributes","componentref"]],template:function(t,e){1&t&&(l._UZ(0,"object-record-fieldset",0),l.TgZ(1,"system-dynamic-component",1),l.NdJ("componentref",(function(t){return e.attachmentsPanelRef=t})),l.qZA()),2&t&&(l.Q6J("fieldset",e.fieldset),l.xp6(1),l.Q6J("componentattributes",l.VKq(2,h,e.filelist)))},dependencies:[r.d,u.T],encapsulation:2})),ObjectActionOutputBeanModalEmailContent})()},3507:(t,e,s)=>{s.d(e,{w:()=>n});var i=s(1180),l=s(2242);let n=(()=>{var t;class outputModalService{constructor(){(0,i.Z)(this,"selectedTemplate",void 0),(0,i.Z)(this,"modalResponse$",new l.vpe)}}return t=outputModalService,(0,i.Z)(outputModalService,"ɵfac",(function(e){return new(e||t)})),(0,i.Z)(outputModalService,"ɵprov",l.Yz7({token:t,factory:t.ɵfac})),outputModalService})()}}]);