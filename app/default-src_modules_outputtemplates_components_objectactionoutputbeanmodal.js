/*!
 * 
 *                     aacService
 *
 *                     release: 2023.01.001
 *
 *                     date: 2023-05-30 13:31:03
 *
 *                     build: 2023.01.001.1685446263677
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["default-src_modules_outputtemplates_components_objectactionoutputbeanmodal_ts"],{2486:(t,e,s)=>{s.d(e,{s:()=>U});var i=s(1571),l=s(2294),n=s(7340),a=s(2198),o=s(3507),d=s(5329),c=s(5710),m=s(4154),u=s(4044),r=s(4505),h=s(1481),p=s(6163),f=s(6895),g=s(433),b=s(8861),_=s(2656),x=s(3463),A=s(9621),v=s(3499),w=s(5767),M=s(1916),O=s(4664);function Z(t,e){if(1&t&&(i.TgZ(0,"option",30),i._uU(1),i.qZA()),2&t){const t=e.$implicit;i.Q6J("ngValue",t),i.xp6(1),i.AsE("",t.name," (",t.language,")")}}function B(t,e){if(1&t){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",31)(2,"label",6),i._UZ(3,"system-label",32),i.qZA(),i.TgZ(4,"div",8)(5,"div",9)(6,"select",10),i.NdJ("ngModelChange",(function(e){i.CHM(t);const s=i.oxw();return i.KtG(s.selected_format=e)})),i.TgZ(7,"option",33),i._uU(8,"HTML"),i.qZA(),i.TgZ(9,"option",34),i._uU(10,"PDF"),i.qZA()()()()(),i.BQk()}if(2&t){const t=i.oxw();i.xp6(6),i.Q6J("ngModel",t.selected_format)("disabled",0==t.templates.length)}}const T=function(t){return{"slds-is-selected":t}};function y(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",35),i.NdJ("click",(function(){i.CHM(t);const e=i.oxw();return i.KtG(e.openEmailArea())})),i._UZ(1,"system-button-icon",36),i.qZA()}if(2&t){const t=i.oxw();i.Q6J("disabled",!t.selected_template||t.loading_output||"html"===t.selected_format)("ngClass",i.VKq(2,T,t.expanded))}}function E(t,e){if(1&t&&i._UZ(0,"iframe",37),2&t){const t=i.oxw();i.Q6J("srcdoc",t.sanitizedTemplated,i.oJD)}}function L(t,e){if(1&t&&i._UZ(0,"object",38),2&t){const t=i.oxw();i.Q6J("data",t.blobUrl,i.uOi)}}function J(t,e){1&t&&(i.TgZ(0,"div",39),i._UZ(1,"system-spinner"),i.qZA())}function k(t,e){1&t&&(i.TgZ(0,"div",39),i._UZ(1,"system-label",40),i.qZA())}function C(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"object-action-output-bean-modal-email-content",41,42),i.NdJ("email_sent",(function(){i.CHM(t);const e=i.oxw();return i.KtG(e.emailSent())})),i.qZA()}if(2&t){const t=i.oxw();i.Q6J("fieldset",t.fieldset_email)("filelist",t.filelist)("parent",t.model)}}function I(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",43),i.NdJ("click",(function(){i.CHM(t);const e=i.oxw();return i.KtG(e.create())})),i._uU(1),i.qZA()}if(2&t){const t=i.oxw();i.Q6J("disabled",!t.selected_template||t.loading_output),i.xp6(1),i.Oqu(t.buttonText)}}function N(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",43),i.NdJ("click",(function(){i.CHM(t);const e=i.oxw();return i.KtG(e.sendEmail())})),i._uU(1),i.qZA()}if(2&t){const t=i.oxw();i.Q6J("disabled",!t.selected_template||t.loading_output||!t.canSend),i.xp6(1),i.Oqu(t.language.getLabel("LBL_SENDEMAIL"))}}let U=(()=>{class ObjectActionOutputBeanModal{constructor(t,e,s,l,n,a,o,d,c,m){this.language=t,this.model=e,this.metadata=s,this.modal=l,this.view=n,this.backend=a,this.outputModalService=o,this.sanitizer=d,this.viewContainerRef=c,this.modelutilities=m,this.actionemitter=new i.vpe,this.noDownload=!1,this.liveCompile=!1,this.self=void 0,this.templates=[],this._selected_template=null,this._selected_format="pdf",this.compiled_selected_template="",this.loading_output=!1,this.fieldset_email="",this.filelist=[],this.showsendemail=!1,this.expanded=!1,this.emailInitialized=!1;let u=this.metadata.getComponentConfig("ObjectActionOutputBeanModal");this.fieldset_email=u.fieldset_email}ngOnInit(){this.setModalData(),this.setSelectedTemplate(),this.selected_template||1!=this.templates.length||(this.selected_template=this.templates[0])}setModalData(){this.modalTitle||(this.modalTitle=this.language.getLabel(this.language.getLabel("LBL_OUTPUT_TEMPLATE"))),this.buttonText||(this.buttonText=this.language.getLabel(this.noDownload?"LBL_OK":"LBL_DOWNLOAD")),this.forcedFormat&&(this._selected_format=this.forcedFormat)}setSelectedTemplate(){let t=this.metadata.getModuleFields(this.model.module);for(let e in t)if("relate"==t[e].type&&"OutputTemplates"==t[e].module){let s=this.templates.find((s=>s.id==this.model.getFieldValue(t[e].id_name)));s&&(this.selected_template=s);break}}set selected_template(t){this._selected_template=t,this.outputModalService.selectedTemplate=t,this.rendertemplate()}get selected_template(){return this._selected_template}get selected_format(){return this._selected_format}set selected_format(t){this._selected_format=t,this.expanded=!1,this.rendertemplate()}get sanitizedTemplated(){return this.sanitizer.bypassSecurityTrustHtml(this.compiled_selected_template)}rendertemplate(){switch(this.loading_output=!0,this.blobUrl=null,this.compiled_selected_template=null,this.selected_format){case"pdf":const t={bean_data:this.liveCompile?this.modelutilities.spiceModel2backend(this.model.module,this.model.data):null};this.backend.postRequest(`module/OutputTemplates/${this.selected_template.id}/convert/${this.model.id}/to/pdf/base64`,null,t).subscribe((t=>{let e=this.datatoBlob(atob(t.content));this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e)),this.contentForHandBack=t.content,this.setEmailAttachmentData(),this.loading_output=!1}),(t=>{this.loading_output=!1}));break;case"html":this.backend.getRequest(`module/OutputTemplates/${this.selected_template.id}/compile/${this.model.id}`).subscribe((t=>{this.compiled_selected_template=t.content,this.contentForHandBack=t.content,this.setEmailAttachmentData(),this.loading_output=!1}),(t=>{this.loading_output=!1}))}}reload(){this.rendertemplate()}close(){this.outputModalService.modalResponse$.next("close"),this.outputModalService.modalResponse$.complete(),this.self.destroy()}create(){if(this.handBack&&this.handBack.emit({name:this.selected_template.name,content:this.contentForHandBack}),this.noDownload)this.close();else{let t=document.createElement("a");document.body.appendChild(t);let e=this.datatoBlob("pdf"==this.selected_format?atob(this.contentForHandBack):this.contentForHandBack);t.href=URL.createObjectURL(e),t.type="pdf"==this.selected_format?"application/pdf":"text/html",t.download=this.model.module+"_"+this.model.getField("summary_text")+"."+this.selected_format,t.click(),t.remove()}}set data(t){let e=this.datatoBlob(t);this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e))}datatoBlob(t,e="",s=512){let i=[];for(let e=0;e<t.length;e+=s){let l=t.slice(e,e+s),n=new Array(l.length);for(let t=0;t<l.length;t++)n[t]=l.charCodeAt(t);let a=new Uint8Array(n);i.push(a)}return new Blob(i,{type:e})}openEmailArea(){this.emailInitialized||(this.emailInitialized=!0,this.setEmailAttachmentData()),this.expanded=!this.expanded}setEmailAttachmentData(){this.emailInitialized&&(this.filelist=[{size:this.contentForHandBack.length,name:this.model.module+"_"+this.model.getField("summary_text")+"."+this.selected_format,type:"application/"+this.selected_format,filecontent:this.contentForHandBack}])}emailSent(){this.close()}get canSend(){return this.emailContent&&!this.emailContent.disabled}sendEmail(){"Letters"==this.model.module&&this.backend.postRequest(`module/Letters/${this.model.id}/marksent/${this.selected_template.id}`,null,this.model.data).subscribe((t=>{this.actionemitter.emit({close:!0,name:"sent"})})),this.emailContent.sendEmail()}handleAction(t){this.outputModalService.modalResponse$.next(t.name),t.close&&(this.model.cancelEdit(),this.close())}}return ObjectActionOutputBeanModal.ɵfac=function(t){return new(t||ObjectActionOutputBeanModal)(i.Y36(d.d),i.Y36(c.o),i.Y36(m.Pu),i.Y36(u.o),i.Y36(l.e),i.Y36(r.y),i.Y36(o.w),i.Y36(h.H7),i.Y36(i.s_b),i.Y36(p.A))},ObjectActionOutputBeanModal.ɵcmp=i.Xpm({type:ObjectActionOutputBeanModal,selectors:[["object-action-output-bean-modal"]],viewQuery:function(t,e){if(1&t&&i.Gf(a.N,5),2&t){let t;i.iGM(t=i.CRH())&&(e.emailContent=t.first)}},outputs:{actionemitter:"actionemitter"},features:[i._Bn([l.e,o.w])],decls:34,vars:17,consts:[["size","large"],[3,"close"],["margin","none"],[1,"slds-modal__content"],[1,"slds-grid","slds-p-horizontal--x-small","slds-p-top--x-small"],[1,"slds-form-element","slds-grid","slds-grow"],[1,"slds-form-element__label"],["label","LBL_TEMPLATE"],[1,"slds-form-element__control","slds-grow"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","disabled","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],["class","slds-button slds-button--icon slds-button--icon-border slds-m-left--small",3,"disabled","ngClass","click",4,"ngIf"],[1,"slds-grid",2,"height","70vh"],[1,"slds-p-around--small",2,"height","100%","width","200%"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom",2,"width","100%","height","calc(100% - 50px)"],["frameBorder","0","style","width: 100%;height: 100%;",3,"srcdoc",4,"ngIf"],["type","application/pdf","width","100%","height","100%",3,"data",4,"ngIf"],["class","slds-align--absolute-center","style","height: 100%;",4,"ngIf"],[1,"slds-scrollable",2,"height","100%"],[3,"fieldset","filelist","parent","email_sent",4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grid--align-end"],["role","group",1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_RELOAD"],["class","slds-button slds-button--brand",3,"disabled","click",4,"ngIf"],["containerclass","slds-button-group",1,"slds-m-left--x-small",2,"display","inline-flex",3,"actionset","actionemitter"],[3,"ngValue"],[1,"slds-form-element","slds-grid","slds-grow","slds-m-left--x-small"],["label","LBL_DISPLAY"],["value","html"],["value","pdf"],[1,"slds-button","slds-button--icon","slds-button--icon-border","slds-m-left--small",3,"disabled","ngClass","click"],["icon","email"],["frameBorder","0",2,"width","100%","height","100%",3,"srcdoc"],["type","application/pdf","width","100%","height","100%",3,"data"],[1,"slds-align--absolute-center",2,"height","100%"],["label","LBL_SELECT_TEMPLATE"],[3,"fieldset","filelist","parent","email_sent"],["emailcontent",""],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(t,e){1&t&&(i.TgZ(0,"system-modal",0)(1,"system-modal-header",1),i.NdJ("close",(function(){return e.close()})),i._uU(2),i.qZA(),i.TgZ(3,"system-modal-content",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),i._UZ(8,"system-label",7),i.qZA(),i.TgZ(9,"div",8)(10,"div",9)(11,"select",10),i.NdJ("ngModelChange",(function(t){return e.selected_template=t})),i.YNc(12,Z,2,3,"option",11),i.qZA()()()(),i.YNc(13,B,11,2,"ng-container",12),i.YNc(14,y,2,4,"button",13),i.qZA(),i.TgZ(15,"div",14)(16,"div",15)(17,"div",16),i.YNc(18,E,1,1,"iframe",17),i.YNc(19,L,1,1,"object",18),i.YNc(20,J,2,0,"div",19),i.YNc(21,k,2,0,"div",19),i.qZA()(),i.TgZ(22,"div",20),i.YNc(23,C,2,3,"object-action-output-bean-modal-email-content",21),i.qZA()()()(),i.TgZ(24,"system-modal-footer")(25,"div",22)(26,"div",23)(27,"button",24),i.NdJ("click",(function(){return e.close()})),i._UZ(28,"system-label",25),i.qZA(),i.TgZ(29,"button",26),i.NdJ("click",(function(){return e.reload()})),i._UZ(30,"system-label",27),i.qZA(),i.YNc(31,I,2,2,"button",28),i.YNc(32,N,2,2,"button",28),i.qZA(),i.TgZ(33,"object-action-container",29),i.NdJ("actionemitter",(function(t){return e.handleAction(t)})),i.qZA()()()()),2&t&&(i.xp6(2),i.Oqu(e.modalTitle),i.xp6(9),i.Q6J("ngModel",e.selected_template)("disabled",0==e.templates.length),i.xp6(1),i.Q6J("ngForOf",e.templates),i.xp6(1),i.Q6J("ngIf",!e.forcedFormat),i.xp6(1),i.Q6J("ngIf",e.metadata.checkModuleAcl("Emails","create")),i.xp6(2),i.Q6J("@slideInOut",e.expanded?"open":"closed"),i.xp6(2),i.Q6J("ngIf","html"===e.selected_format&&!e.loading_output&&e.selected_template),i.xp6(1),i.Q6J("ngIf","pdf"===e.selected_format&&!e.loading_output&&e.blobUrl),i.xp6(1),i.Q6J("ngIf",e.loading_output),i.xp6(1),i.Q6J("ngIf",!e.selected_template&&!e.loading_output),i.xp6(1),i.Q6J("@slideInOut2",e.expanded?"open":"closed"),i.xp6(1),i.Q6J("ngIf",e.emailInitialized),i.xp6(6),i.Q6J("disabled",!e.selected_template||e.loading_output),i.xp6(2),i.Q6J("ngIf",!e.expanded),i.xp6(1),i.Q6J("ngIf",e.expanded),i.xp6(1),i.Q6J("actionset",e.customActionsetId))},dependencies:[f.mk,f.sg,f.O5,g.YN,g.Kr,g.EJ,g.JJ,g.On,b.S,_.J,x._,A.j,v.x,w.p,M.y,O.W,a.N],encapsulation:2,data:{animation:[(0,n.X$)("slideInOut",[(0,n.SB)("open",(0,n.oB)({width:"50%"})),(0,n.SB)("closed",(0,n.oB)({width:"100%"})),(0,n.eR)("open <=> closed",[(0,n.jt)("200ms")])]),(0,n.X$)("slideInOut2",[(0,n.SB)("open",(0,n.oB)({width:"50%"})),(0,n.SB)("closed",(0,n.oB)({width:"0%"})),(0,n.eR)("open <=> closed",[(0,n.jt)("200ms")])])]}}),ObjectActionOutputBeanModal})()},2198:(t,e,s)=>{s.d(e,{N:()=>h});var i=s(1571),l=s(5710),n=s(2294),a=s(5329),o=s(4154),d=s(4044),c=s(5920),m=s(9062),u=s(2995);const r=function(t){return{uploadfiles:t}};let h=(()=>{class ObjectActionOutputBeanModalEmailContent{constructor(t,e,s,l,n,a){this.language=t,this.model=e,this.metadata=s,this.modal=l,this.view=n,this.session=a,this.fieldset=null,this.filelist={},this.parent={},this.email_sent=new i.vpe,this.sending=!1}ngOnInit(){this.setModelData(),this.setViewData()}ngOnChanges(t){t.filelist&&this.attachmentsPanelRef&&this.attachmentsPanelRef.instance.setUploadFiles(this.filelist)}setModelData(){this.model.module="Emails",this.model.initialize(this.parent);let t={};t.parent_type=this.parent.module,t.parent_id=this.parent.data.id,t.parent_name=this.parent.data.name,t.isNew=!0,t.assigned_user_id=this.session.authData.userId,t.assigned_user_name=this.session.authData.userName,t.modified_by_id=this.session.authData.userId,t.modified_by_name=this.session.authData.userName,t.date_entered=new Date,t.date_modified=new Date,this.model.setFields(t),this.model.startEdit()}setViewData(){this.view.setEditMode(),this.view.isEditable=!0}get disabled(){let t=this.model.getFieldValue("recipient_addresses"),e=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=t?t.find((t=>"to"==t.address_type)):void 0;return!(s&&e&&t&&i)||this.sending}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((t=>{t.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names")}),this.model.save().subscribe((e=>{t.instance.self.destroy(),this.email_sent.emit()}),(e=>{t.instance.self.destroy(),this.sending=!1}))}))}}return ObjectActionOutputBeanModalEmailContent.ɵfac=function(t){return new(t||ObjectActionOutputBeanModalEmailContent)(i.Y36(a.d),i.Y36(l.o),i.Y36(o.Pu),i.Y36(d.o),i.Y36(n.e),i.Y36(c.n))},ObjectActionOutputBeanModalEmailContent.ɵcmp=i.Xpm({type:ObjectActionOutputBeanModalEmailContent,selectors:[["object-action-output-bean-modal-email-content"]],inputs:{fieldset:"fieldset",filelist:"filelist",attachmentContent:"attachmentContent",parent:"parent"},outputs:{email_sent:"email_sent"},features:[i._Bn([n.e,l.o]),i.TTD],decls:2,vars:4,consts:[["direction","vertical",3,"fieldset"],["component","SpiceAttachmentsPanel",3,"componentattributes","componentref"]],template:function(t,e){1&t&&(i._UZ(0,"object-record-fieldset",0),i.TgZ(1,"system-dynamic-component",1),i.NdJ("componentref",(function(t){return e.attachmentsPanelRef=t})),i.qZA()),2&t&&(i.Q6J("fieldset",e.fieldset),i.xp6(1),i.Q6J("componentattributes",i.VKq(2,r,e.filelist)))},dependencies:[m.d,u.T],encapsulation:2}),ObjectActionOutputBeanModalEmailContent})()},3507:(t,e,s)=>{s.d(e,{w:()=>l});var i=s(1571);let l=(()=>{class outputModalService{constructor(){this.modalResponse$=new i.vpe}}return outputModalService.ɵfac=function(t){return new(t||outputModalService)},outputModalService.ɵprov=i.Yz7({token:outputModalService,factory:outputModalService.ɵfac}),outputModalService})()}}]);