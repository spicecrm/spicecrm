/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:53:45
 *
 *                     build: 2024.01.001.1717779225604
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_spicetexts_spicetexts_ts"],{72334:(e,t,s)=>{s.r(t),s.d(t,{SpiceTextsModule:()=>P});var l=s(345),i=s(21626),n=s(84341),a=s(70569),d=s(12948),r=s(37328),o=s(7745),g=s(71341),c=s(91107),u=s(54438),m=s(35911),h=s(69904),p=s(49722),x=s(29994),f=s(83935),b=s(60177),y=s(32062),T=s(48717),v=s(18521),M=s(46433),F=s(98427),S=s(50531),k=s(53584),L=s(44985);let B=(()=>{class SpiceTextsAddButton{constructor(e,t,s,l,i,n){this.model=e,this.modal=t,this.configurationService=s,this.language=l,this.metadata=i,this.relatedModels=n,this.spiceTexts=[],this.model.module="SpiceTexts"}get sysTextIds(){let e=this.configurationService.getData("systextids");return e?_.values(e).filter((e=>e.module==this.parent.module)):[]}get canAdd(){return this.metadata.checkModuleAcl("SpiceTexts","create")&&!this.allTranslated}get allTranslated(){return this.relatedModels.isloading||0==this.sysTextIds.length||this.spiceTexts.length>=this.sysTextIds.length*this.language.getAvialableLanguages().length}addModel(){this.parent&&!this.allTranslated&&this.modal.openModal("SpiceTextsAddModal",!0).subscribe((e=>{e&&(e.instance.spiceTexts=this.spiceTexts,e.instance.sysTextIds=this.sysTextIds,e.instance.parent=this.parent,e.instance.response.subscribe((e=>{e&&"object"==typeof e&&this.relatedModels.items.push(e)})))}))}static#e=this.ɵfac=function(e){return new(e||SpiceTextsAddButton)(u.rXU(m.g),u.rXU(S.y),u.rXU(k.i),u.rXU(h.B),u.rXU(f.yu),u.rXU(c.K))};static#t=this.ɵcmp=u.VBU({type:SpiceTextsAddButton,selectors:[["spice-texts-add-button"]],inputs:{parent:"parent",spiceTexts:"spiceTexts"},features:[u.Jv_([m.g])],decls:3,vars:2,consts:[["title","add item",1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_ADD"],["module","SpiceTexts",3,"singular"]],template:function(e,t){1&e&&(u.j41(0,"button",0),u.bIt("click",(function(){return t.addModel()})),u.nrm(1,"system-label",1)(2,"system-label-modulename",2),u.k0s()),2&e&&(u.Y8G("disabled",!t.canAdd),u.R7$(2),u.Y8G("singular",!0))},dependencies:[y.W,L.r],encapsulation:2})}return SpiceTextsAddButton})();function I(e,t){if(1&e&&(u.j41(0,"option",19),u.EFF(1),u.k0s()),2&e){const e=t.$implicit,s=u.XpG();u.Y8G("value",e.language),u.R7$(),u.SpI(" ",s.language.getLabel(null==e?null:e.text)," ")}}function R(e,t){1&e&&(u.j41(0,"div",20),u.nrm(1,"system-spinner"),u.k0s())}const C=(e,t)=>({module:"SpiceTexts",id:e,data:t});function G(e,t){if(1&e&&(u.j41(0,"div",21)(1,"div",22),u.nrm(2,"object-record-details"),u.k0s()()),2&e){const e=t.$implicit;u.R7$(),u.Y8G("system-model-provider",u.l_i(1,C,e.id,e))}}function $(e,t){1&e&&(u.j41(0,"div",20),u.nrm(1,"system-label",23),u.k0s())}let j=(()=>{class SpiceTexts{constructor(e,t,s,l,i,n){this.model=e,this.language=t,this.backend=s,this.session=l,this.metadata=i,this.relatedModels=n,this.searchTerm="",this.languageFilter="all"}get moduleTexts(){return this.relatedModels.items.filter((e=>{let t=e.name.toLowerCase(),s=e.description.toLowerCase(),l=this.searchTerm.toLowerCase(),i=0==this.searchTerm.length||t.includes(l)||s.includes(l),n=this.languageFilter==e.text_language;return i&&("all"==this.languageFilter||n)}))}get sysLanguages(){return this.language.getAvialableLanguages()}ngOnInit(){this.loadModuleTexts()}loadModuleTexts(){this.relatedModels.id=this.model.id,this.relatedModels.module=this.model.module,this.relatedModels.loaditems=-1,this.relatedModels.relatedModule="SpiceTexts",this.relatedModels.getData()}trackByFn(e,t){return t.id}static#e=this.ɵfac=function(e){return new(e||SpiceTexts)(u.rXU(m.g),u.rXU(h.B),u.rXU(p.H),u.rXU(x.d),u.rXU(f.yu),u.rXU(c.K))};static#t=this.ɵcmp=u.VBU({type:SpiceTexts,selectors:[["ng-component"]],features:[u.Jv_([c.K])],decls:20,vars:11,consts:[[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--x-small"],["for","searchField",1,"slds-item_label"],["label","LBL_SEARCH"],[1,"slds-col","slds-form-element","slds-m-left--x-small"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon_right"],["icon","search","addclasses","slds-input__icon slds-input__icon--right"],["id","searchField","type","text","placeholder","search by",1,"slds-input",3,"ngModel","ngModelChange"],["for","languageFilter",1,"slds-item_label","slds-m-left--small","slds-m-right--xx-small"],["label","LBL_FILTER"],[1,"slds-form-element","slds-m-right--small"],[1,"slds-form-element__control"],[1,"slds-select_container"],["id","languageFilter",1,"slds-select",3,"ngModel","disabled","ngModelChange"],["value","all"],["label","LBL_ALL"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"parent","spiceTexts"],["class","slds-align--absolute-center slds-m-top--large",4,"ngIf"],["class","slds-m-vertical--small",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"],[1,"slds-align--absolute-center","slds-m-top--large"],[1,"slds-m-vertical--small"],[1,"slds-box--border",2,"padding","0 .50rem",3,"system-model-provider"],["label","MSG_NO_RECORDS_FOUND"]],template:function(e,t){1&e&&(u.j41(0,"div",0)(1,"label",1),u.nrm(2,"system-label",2),u.k0s(),u.j41(3,"div",3)(4,"div",4),u.nrm(5,"system-utility-icon",5),u.j41(6,"input",6),u.mxI("ngModelChange",(function(e){return u.DH7(t.searchTerm,e)||(t.searchTerm=e),e})),u.k0s()()(),u.j41(7,"label",7),u.nrm(8,"system-label",8),u.k0s(),u.j41(9,"div",9)(10,"div",10)(11,"div",11)(12,"select",12),u.mxI("ngModelChange",(function(e){return u.DH7(t.languageFilter,e)||(t.languageFilter=e),e})),u.j41(13,"option",13),u.nrm(14,"system-label",14),u.k0s(),u.DNE(15,I,2,2,"option",15),u.k0s()()()(),u.nrm(16,"spice-texts-add-button",16),u.k0s(),u.DNE(17,R,2,0,"div",17)(18,G,3,4,"div",18)(19,$,2,0,"div",17)),2&e&&(u.R7$(6),u.R50("ngModel",t.searchTerm),u.R7$(6),u.R50("ngModel",t.languageFilter),u.Y8G("disabled",0==(null==t.sysLanguages?null:t.sysLanguages.length)),u.R7$(3),u.Y8G("ngForOf",t.sysLanguages)("ngForTrackBy",t.trackByFn),u.R7$(),u.Y8G("parent",t.model)("spiceTexts",t.relatedModels.items),u.R7$(),u.Y8G("ngIf",t.relatedModels.isloading),u.R7$(),u.Y8G("ngForOf",t.moduleTexts)("ngForTrackBy",t.trackByFn),u.R7$(),u.Y8G("ngIf",!t.relatedModels.isloading&&0==(null==t.relatedModels.items?null:t.relatedModels.items.length)))},dependencies:[b.Sq,b.bT,n.xH,n.y7,n.me,n.wz,n.BC,n.vS,y.W,T.P,v.B,M.B,F.v,B],encapsulation:2})}return SpiceTexts})();var Y=s(21413),U=s(41731),A=s(40713),D=s(25028),w=s(88418),O=s(83524),X=s(766),E=s(15091),N=s(89166);function z(e,t){if(1&e&&(u.j41(0,"option",22),u.nrm(1,"system-label",23),u.k0s()),2&e){const e=t.$implicit;u.Y8G("value",e.text_id),u.R7$(),u.Y8G("label",e.label)}}function H(e,t){1&e&&u.nrm(0,"system-spinner",24)}function J(e,t){if(1&e&&(u.j41(0,"option",22),u.EFF(1),u.k0s()),2&e){const e=t.$implicit;u.Y8G("value",e.language),u.R7$(),u.SpI(" ",e.text," ")}}function q(e,t){1&e&&u.nrm(0,"system-spinner",24)}const V=()=>({required:!0});let K=(()=>{class SpiceTextsAddModal{constructor(e,t,s,l,i){this.model=e,this.configurationService=t,this.view=s,this.backend=l,this.language=i,this.spiceTexts=[],this.sysTextIds=[],this.parent={},this.response=new Y.B,this.self={},this.saveTriggered=!1,this.loading="",this.model.module="SpiceTexts"}get textId(){return this.model.getField("text_id")}set textId(e){this.model.setField("text_id",e),this.model.resetFieldMessages("text_id","error","validation"),this.loading="text_language",window.setTimeout((()=>this.loading=""),500)}get textLanguage(){return this.model.getField("text_language")}set textLanguage(e){this.model.setField("text_language",e),this.model.resetFieldMessages("text_language","error","validation"),this.loading="text_id",window.setTimeout((()=>this.loading=""),500)}get availableSysLanguages(){return this.language.getAvialableLanguages().filter((e=>{let t=_.groupBy(this.spiceTexts,"text_id"),s=0;for(let l in t)if(t.hasOwnProperty(l)){s+=t[l].find((t=>t.text_language==e.language))?1:0}let l=this.spiceTexts.find((t=>t.text_id==this.textId&&t.text_language==e.language));return s<this.sysTextIds.length&&!l}))}get availableSysTexts(){return this.sysTextIds.filter((e=>{let t=this.spiceTexts.filter((t=>t.text_id==e.text_id)),s=this.spiceTexts.find((t=>t.text_id==e.text_id&&t.text_language==this.textLanguage));return t.length<this.language.getAvialableLanguages().length&&!s}))}get isDisabledText(){return!this.availableSysTexts||0==this.availableSysTexts.length||"text_id"==this.loading}get isDisabledLang(){return!this.availableSysLanguages||0==this.availableSysLanguages.length||"text_language"==this.loading}ngOnInit(){this.initializeModel(),this.view.isEditable=!0,this.view.setEditMode()}getFieldStyle(e){return this.model.getFieldMessages(e,"error")?"slds-has-error":""}initializeModel(){this.model.initialize(),this.model.setFields({parent_id:this.parent.id,parent_type:this.parent.module})}trackByFn(e,t){return t.id}isLoading(e){return this.loading==e}save(){if(this.saveTriggered=!0,!this.model.validate())return this.saveTriggered=!1;let e=this.model.getField("description").slice(0,100);this.model.setField("name",e),this.model.save(!0).subscribe((e=>{this.response.next(e),this.response.complete(),this.self.destroy()}),(e=>{this.cancel()})),this.saveTriggered=!1}cancel(){this.response.next(!1),this.response.complete(),this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||SpiceTextsAddModal)(u.rXU(m.g),u.rXU(k.i),u.rXU(U.U),u.rXU(p.H),u.rXU(h.B))};static#t=this.ɵcmp=u.VBU({type:SpiceTextsAddModal,selectors:[["ng-component"]],features:[u.Jv_([m.g,U.U])],decls:29,vars:17,consts:[["size","large"],[3,"close"],["module","SpiceTexts",3,"singular"],[1,"slds-grid"],[1,"slds-size--1-of-2","slds-p-right--small"],["fieldname","text_id",3,"fieldconfig"],[1,"slds-form-element",3,"ngClass"],[1,"slds-form-element__control"],[1,"slds-select_container"],["id","text_id",1,"slds-select",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["fieldname","text_id"],["class","slds-is-absolute","size","15","style","right: 25px; top: 8px",4,"ngIf"],[1,"slds-size--1-of-2"],["fieldname","text_language",3,"fieldconfig"],["id","text_language",1,"slds-select",3,"ngModel","disabled","ngModelChange"],["fieldname","text_language"],["field","description","fielddisplayclass","slds-truncate"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[3,"value"],[3,"label"],["size","15",1,"slds-is-absolute",2,"right","25px","top","8px"]],template:function(e,t){1&e&&(u.j41(0,"system-modal",0)(1,"system-modal-header",1),u.bIt("close",(function(){return t.cancel()})),u.nrm(2,"system-label-modulename",2),u.k0s(),u.j41(3,"system-modal-content")(4,"div",3)(5,"div",4),u.nrm(6,"field-label",5),u.j41(7,"div",6)(8,"div",7)(9,"div",8)(10,"select",9),u.mxI("ngModelChange",(function(e){return u.DH7(t.textId,e)||(t.textId=e),e})),u.DNE(11,z,2,2,"option",10),u.k0s()()(),u.nrm(12,"field-messages",11),u.DNE(13,H,1,0,"system-spinner",12),u.k0s()(),u.j41(14,"div",13),u.nrm(15,"field-label",14),u.j41(16,"div",6)(17,"div",7)(18,"div",8)(19,"select",15),u.mxI("ngModelChange",(function(e){return u.DH7(t.textLanguage,e)||(t.textLanguage=e),e})),u.DNE(20,J,2,2,"option",10),u.k0s()()(),u.nrm(21,"field-messages",16),u.DNE(22,q,1,0,"system-spinner",12),u.k0s()()(),u.nrm(23,"field-container",17),u.k0s(),u.j41(24,"system-modal-footer")(25,"button",18),u.bIt("click",(function(){return t.cancel()})),u.nrm(26,"system-label",19),u.k0s(),u.j41(27,"button",20),u.bIt("click",(function(){return t.save()})),u.nrm(28,"system-label",21),u.k0s()()()),2&e&&(u.R7$(2),u.Y8G("singular",!0),u.R7$(4),u.Y8G("fieldconfig",u.lJ4(15,V)),u.R7$(),u.Y8G("ngClass",t.getFieldStyle("text_id")),u.R7$(3),u.R50("ngModel",t.textId),u.Y8G("disabled",t.isDisabledText),u.R7$(),u.Y8G("ngForOf",t.availableSysTexts)("ngForTrackBy",t.trackByFn),u.R7$(2),u.Y8G("ngIf",t.isLoading("text_id")),u.R7$(2),u.Y8G("fieldconfig",u.lJ4(16,V)),u.R7$(),u.Y8G("ngClass",t.getFieldStyle("text_language")),u.R7$(3),u.R50("ngModel",t.textLanguage),u.Y8G("disabled",t.isDisabledLang),u.R7$(),u.Y8G("ngForOf",t.availableSysLanguages)("ngForTrackBy",t.trackByFn),u.R7$(2),u.Y8G("ngIf",t.isLoading("text_language")))},dependencies:[b.YU,b.Sq,b.bT,n.xH,n.y7,n.wz,n.BC,n.vS,y.W,L.r,A.D,D.I,w.Q,O.C,T.P,X.b,E.y,N.A],encapsulation:2})}return SpiceTextsAddModal})(),P=(()=>{class SpiceTextsModule{static#e=this.ɵfac=function(e){return new(e||SpiceTextsModule)};static#t=this.ɵmod=u.$C({type:SpiceTextsModule});static#s=this.ɵinj=u.G2t({imports:[l.Bb,i.q1,n.YN,a.SystemComponents,d.GlobalComponents,r.ObjectComponents,o.ObjectFields,g.h]})}return SpiceTextsModule})();("undefined"==typeof ngJitMode||ngJitMode)&&u.Obh(P,{declarations:[j,B,K],imports:[l.Bb,i.q1,n.YN,a.SystemComponents,d.GlobalComponents,r.ObjectComponents,o.ObjectFields,g.h]})}}]);