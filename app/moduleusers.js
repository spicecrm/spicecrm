/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_users_moduleusers_ts"],{98398:(e,s,t)=>{t.r(s),t.d(s,{ModuleUsers:()=>Fs});var a=t(60177),i=t(84341),n=t(71341),l=t(7745),r=t(12948),o=t(37328),d=t(70569),c=t(5220),h=t(54438),u=t(69904),m=t(50531),g=t(35911);let p=(()=>{class UserChangePasswordButton{constructor(e,s,t){this.language=e,this.modal=s,this.model=t}get disabled(){return 0==this.model.getFieldValue("external_auth_only")}execute(){this.modal.openStaticModal(c.y)}static#e=this.ɵfac=function(e){return new(e||UserChangePasswordButton)(h.rXU(u.B),h.rXU(m.y),h.rXU(g.g))};static#s=this.ɵcmp=h.VBU({type:UserChangePasswordButton,selectors:[["user-change-password-button"]],decls:2,vars:0,template:function(e,s){1&e&&(h.j41(0,"span"),h.EFF(1,"Change Password"),h.k0s())},encapsulation:2})}return UserChangePasswordButton})();var b=t(41081),f=t(29994),y=t(49722),R=t(53584),E=t(13562),S=t(25863),w=t(84359),L=t(32062),v=t(40713),U=t(25028),k=t(88418),M=t(83524),G=t(18521),D=t(32130),C=t(90154);function I(e,s){if(1&e&&(h.j41(0,"div"),h.nrm(1,"system-label",30),h.EFF(2),h.nrm(3,"br"),h.k0s()),2&e){const e=h.XpG();h.R7$(2),h.SpI(": ",e.pwdGuideline,"")}}function B(e,s){1&e&&(h.j41(0,"div",31),h.nrm(1,"system-label",32),h.k0s())}function P(e,s){1&e&&(h.j41(0,"div",31),h.nrm(1,"system-label",33),h.k0s())}let A=(()=>{class UserResetPasswordModal{constructor(e,s,t,a,i,n,l){this.model=e,this.language=s,this.toast=t,this.session=a,this.backend=i,this.configuration=n,this.helper=l,this.self=void 0,this.password=void 0,this.repeatPassword=void 0,this.pwdCheck=new RegExp("//"),this.pwdGuideline=void 0,this.autogenerate=!1,this.sendByEmail=!1,this.showPassword=!1,this.forceReset=!0,this.autocompletebreaker="",this.updating=!1,this.getInfo()}get passwordError(){return this.password&&!this.pwdCheck.test(this.password)}get repeatPasswordError(){return this.repeatPassword&&this.password!==this.repeatPassword}get autoGenerate(){return this.autogenerate}set autoGenerate(e){this.autogenerate=e,e&&(this.password=this.helper.generatePassword(this.configuration.getCapabilityConfig("userpassword")),this.repeatPassword=this.password)}toggleShowPassword(){this.showPassword=!this.showPassword}copyPassword(){this.autoGenerate&&(navigator.clipboard.writeText(this.password),this.toast.sendToast("Password copied","success"))}getInfo(){let e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);let s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.onespecial&&s.push(this.language.getLabel("MSG_PASSWORD_ONESPECIAL")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")}get canSave(){return!(this.updating||this.passwordError||this.repeatPasswordError||!this.session.isAdmin)}setPassword(){this.canSave&&(this.updating=!0,this.backend.postRequest(`module/Users/${this.model.id}/password/reset`,{},{newPassword:this.password,forceReset:this.forceReset,sendEmail:this.sendByEmail}).subscribe((e=>{this.close(),this.toast.sendToast("Password Reset!","info")}),(e=>{this.updating=!1,this.toast.sendToast("Error resetting the password","error")})))}close(){this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||UserResetPasswordModal)(h.rXU(g.g),h.rXU(u.B),h.rXU(b.o),h.rXU(f.d),h.rXU(y.H),h.rXU(R.i),h.rXU(E.d))};static#s=this.ɵcmp=h.VBU({type:UserResetPasswordModal,selectors:[["user-reset-password-modal"]],decls:37,vars:22,consts:[["size","small"],[3,"close"],["label","LBL_RESET_PASSWORD"],[3,"system-overlay-loading-spinner"],[1,"slds-form--stacked","slds-text-align--left"],[4,"ngIf"],[1,"slds-grid"],[1,"slds-grow"],[1,"slds-form-element","slds-m-vertical--small"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--left"],[3,"icon","addclasses"],["system-placeholder","MSG_ENTER_NEW_PASSWORD",1,"slds-input",3,"autocomplete","type","ngModel","disabled","ngModelChange"],["passField","ngModel"],["class","slds-form-element__help slds-text-color--error",4,"ngIf"],["system-placeholder","MSG_REPEAT_PASSWORD",1,"slds-input",3,"autocomplete","type","ngModel","disabled","ngModelChange"],["repPassField","ngModel"],[1,"slds-p-left--xx-small","slds-p-vertical--small"],[1,"slds-button","slds-button--icon-border","slds-button--neutral",3,"click"],["size","medium",3,"icon"],[1,"slds-button","slds-button--icon-border","slds-button--neutral",3,"disabled","click"],["icon","copy","size","medium"],[3,"ngModel","ngModelChange"],["label","LBL_AUTO_GENERATE"],[1,"slds-m-left--small",3,"ngModel","ngModelChange"],["label","LBL_SEND_BY_EMAIL"],["label","LBL_FORCE_RESET"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SET_PASSWORD"],["label","LBL_PWD_GUIDELINE",2,"display","inline-block"],[1,"slds-form-element__help","slds-text-color--error"],["label","LBL_PASSWORD_REQ_CHECK_ERR"],["label","LBL_PASSWORDS_DONT_MATCH"]],template:function(e,s){1&e&&(h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",2),h.k0s(),h.j41(3,"system-modal-content",3)(4,"div",4)(5,"div",4),h.DNE(6,I,4,1,"div",5),h.j41(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),h.nrm(11,"system-utility-icon",10),h.j41(12,"input",11,12),h.mxI("ngModelChange",(function(e){return h.DH7(s.password,e)||(s.password=e),e})),h.k0s()(),h.DNE(14,B,2,0,"div",13),h.k0s(),h.j41(15,"div",8)(16,"div",9),h.nrm(17,"system-utility-icon",10),h.j41(18,"input",14,15),h.mxI("ngModelChange",(function(e){return h.DH7(s.repeatPassword,e)||(s.repeatPassword=e),e})),h.k0s()(),h.DNE(20,P,2,0,"div",13),h.k0s()(),h.j41(21,"div",16)(22,"button",17),h.bIt("click",(function(){return s.toggleShowPassword()})),h.nrm(23,"system-button-icon",18),h.k0s(),h.j41(24,"button",19),h.bIt("click",(function(){return s.copyPassword()})),h.nrm(25,"system-button-icon",20),h.k0s()()()(),h.j41(26,"system-checkbox",21),h.mxI("ngModelChange",(function(e){return h.DH7(s.autoGenerate,e)||(s.autoGenerate=e),e})),h.nrm(27,"system-label",22),h.k0s(),h.j41(28,"system-checkbox",23),h.mxI("ngModelChange",(function(e){return h.DH7(s.sendByEmail,e)||(s.sendByEmail=e),e})),h.nrm(29,"system-label",24),h.k0s(),h.j41(30,"system-checkbox",23),h.mxI("ngModelChange",(function(e){return h.DH7(s.forceReset,e)||(s.forceReset=e),e})),h.nrm(31,"system-label",25),h.k0s()()(),h.j41(32,"system-modal-footer")(33,"button",26),h.bIt("click",(function(){return s.close()})),h.nrm(34,"system-label",27),h.k0s(),h.j41(35,"button",28),h.bIt("click",(function(){return s.setPassword()})),h.nrm(36,"system-label",29),h.k0s()()()),2&e&&(h.R7$(3),h.Y8G("system-overlay-loading-spinner",s.updating),h.R7$(3),h.Y8G("ngIf",s.pwdGuideline),h.R7$(5),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("autocomplete",s.autocompletebreaker)("type",s.showPassword?"text":"password"),h.R50("ngModel",s.password),h.Y8G("disabled",s.autoGenerate),h.R7$(2),h.Y8G("ngIf",s.passwordError),h.R7$(3),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("autocomplete",s.autocompletebreaker)("type",s.showPassword?"text":"password"),h.R50("ngModel",s.repeatPassword),h.Y8G("disabled",s.autoGenerate),h.R7$(2),h.Y8G("ngIf",s.repeatPasswordError),h.R7$(3),h.Y8G("icon",s.showPassword?"hide":"preview"),h.R7$(),h.Y8G("disabled",!s.autoGenerate),h.R7$(2),h.R50("ngModel",s.autoGenerate),h.R7$(2),h.R50("ngModel",s.sendByEmail),h.R7$(2),h.R50("ngModel",s.forceReset),h.R7$(5),h.Y8G("disabled",!s.canSave))},dependencies:[a.bT,i.me,i.BC,i.vS,S.t,w.f,L.W,v.D,U.I,k.Q,M.C,G.B,D.M,C.m],encapsulation:2})}return UserResetPasswordModal})(),x=(()=>{class UserResetPasswordButton{constructor(e,s,t,a,i){this.modal=e,this.language=s,this.model=t,this.session=a,this.injector=i}get disabled(){return!this.session.isAdmin||"Active"!=this.model.getField("status")||0!=this.model.getFieldValue("external_auth_only")}execute(){this.session.isAdmin&&this.modal.openModal("UserResetPasswordModal",!0,this.injector)}static#e=this.ɵfac=function(e){return new(e||UserResetPasswordButton)(h.rXU(m.y),h.rXU(u.B),h.rXU(g.g),h.rXU(f.d),h.rXU(h.zZn))};static#s=this.ɵcmp=h.VBU({type:UserResetPasswordButton,selectors:[["ng-component"]],decls:2,vars:0,template:function(e,s){1&e&&(h.j41(0,"span"),h.EFF(1,"Reset Password"),h.k0s())},encapsulation:2})}return UserResetPasswordButton})();var j=t(41731),O=t(21413),F=t(88421),T=t(48849),N=t(40553),$=t(83935),X=t(2187),Y=t(84338),H=t(14445),V=t(22667),z=t(36953);const W=["systemPreferencesPanel"];function q(e,s){1&e&&(h.j41(0,"div",2),h.EFF(1," The preferences of the user are only viewable/editable by himself.\n"),h.k0s())}function J(e,s){if(1&e&&(h.j41(0,"span"),h.EFF(1),h.k0s()),2&e){const e=h.XpG(2);h.R7$(),h.JRh(e.homeDashboardData.name)}}function Q(e,s){if(1&e&&(h.j41(0,"option",23),h.EFF(1),h.k0s()),2&e){const e=s.$implicit;h.Y8G("value",e.id),h.R7$(),h.JRh(e.name)}}function K(e,s){if(1&e&&(h.j41(0,"span"),h.EFF(1),h.k0s()),2&e){const e=h.XpG(2);h.R7$(),h.JRh(e.homeDashboardSetData.name)}}function Z(e,s){if(1&e&&(h.j41(0,"option",23),h.EFF(1),h.k0s()),2&e){const e=s.$implicit;h.Y8G("value",e.id),h.R7$(),h.JRh(e.name)}}function ee(e,s){1&e&&h.nrm(0,"system-label",19)}function se(e,s){1&e&&h.nrm(0,"system-label",21)}function te(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",24)(1,"button",25),h.bIt("click",(function(){h.eBV(e);const s=h.XpG(2);return h.Njj(s.cancel())})),h.nrm(2,"system-label",26),h.k0s(),h.j41(3,"button",27),h.bIt("click",(function(){h.eBV(e);const s=h.XpG(2);return h.Njj(s.save())})),h.nrm(4,"system-label",28),h.k0s()()}}function ae(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",3),h.nrm(1,"system-preferences-panel",4,5),h.j41(3,"system-collapsable-tab",6)(4,"div",7)(5,"system-preferences-panel-item",8)(6,"system-preferences-panel-item-display"),h.DNE(7,J,2,1,"span",9),h.k0s(),h.j41(8,"system-preferences-panel-item-edit")(9,"div",10)(10,"select",11),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.preferences.home_dashboard,s)||(t.preferences.home_dashboard=s),h.Njj(s)})),h.bIt("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.Njj(t.setHomeDashboardData(s))})),h.DNE(11,Q,2,2,"option",12),h.k0s()()()(),h.j41(12,"system-preferences-panel-item",13)(13,"system-preferences-panel-item-display"),h.DNE(14,K,2,1,"span",9),h.k0s(),h.j41(15,"system-preferences-panel-item-edit")(16,"div",10)(17,"select",11),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.preferences.home_dashboardset,s)||(t.preferences.home_dashboardset=s),h.Njj(s)})),h.bIt("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.Njj(t.setHomeDashboardSetData(s))})),h.DNE(18,Z,2,2,"option",12),h.k0s()()()(),h.j41(19,"system-preferences-panel-item",14)(20,"system-preferences-panel-item-display",15),h.DNE(21,ee,1,0,"system-label",16)(22,se,1,0,"system-label",17),h.k0s(),h.j41(23,"system-preferences-panel-item-edit")(24,"div",10)(25,"select",11),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.preferences.home_assistant,s)||(t.preferences.home_assistant=s),h.Njj(s)})),h.bIt("ngModelChange",(function(){h.eBV(e);const s=h.sdS(2);return h.Njj(s.prefChanged())})),h.nrm(26,"option"),h.j41(27,"option",18),h.nrm(28,"system-label",19),h.k0s(),h.j41(29,"option",20),h.nrm(30,"system-label",21),h.k0s()()()()()()(),h.DNE(31,te,5,0,"div",22),h.k0s()}if(2&e){const e=h.sdS(2),s=h.XpG();h.Y8G("system-overlay-loading-spinner",s.isLoading),h.R7$(),h.Y8G("preferences",s.preferences)("isPersonalContext",!0),h.R7$(2),h.Y8G("collapsible",!1),h.R7$(4),h.Y8G("ngIf",s.homeDashboardData&&s.homeDashboardData.name),h.R7$(3),h.R50("ngModel",s.preferences.home_dashboard),h.R7$(),h.Y8G("ngForOf",s.dashboards),h.R7$(3),h.Y8G("ngIf",s.homeDashboardSetData&&s.homeDashboardSetData.name),h.R7$(3),h.R50("ngModel",s.preferences.home_dashboardset),h.R7$(),h.Y8G("ngForOf",s.dashboardSets),h.R7$(2),h.Y8G("global",e.prefValueIsGlobalFallback("home_assistant")),h.R7$(),h.Y8G("ngIf","visible"===e.getPrefValue("home_assistant")),h.R7$(),h.Y8G("ngIf","hidden"===e.getPrefValue("home_assistant")),h.R7$(3),h.R50("ngModel",s.preferences.home_assistant),h.R7$(6),h.Y8G("ngIf",s.view.isEditMode())}}let ie=(()=>{class UserPreferences{constructor(e,s,t,a,i,n,l,r,o,d,c){this.backend=e,this.view=s,this.toast=t,this.currency=a,this.language=i,this.preferencesService=n,this.session=l,this.model=r,this.broadcast=o,this.configuration=d,this.metadata=c,this.preferences={},this.names=["calendar_day_start_hour","calendar_day_end_hour","currency","datef","dec_sep","currency_significant_digits","export_charset","locale_name_format","distance_unit_system","export_delimiter","help_icon","home_dashboard","home_dashboardset","home_assistant","num_grp_sep","reminder_time","timef","timezone","week_day_start","week_days_count"],this.defaultDashboardPlaceHolder={},this.defaultDashboardSetPlaceHolder={},this.dashboardSets=[],this.dashboardSetData={},this.homeDashboardData={},this.homeDashboardSetData={},this.dashboards=[],this.loadedSubscription=new O.B,this.isLoading=!0,this.loadInitialValues()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadInitialValues(){this.view.isEditable=!0,this.isCurrentUser=this.session.authData.userId==this.model.getField("id");const e=this.configuration.getSystemParamater("aclcontroller");this.canEdit=e&&"spiceacl"!=e?this.isCurrentUser||this.session.isAdmin&&this.configuration.getSystemParamater("enableSettingUserPrefsByAdmin"):this.metadata.checkModuleAcl("UserPreferences","edit"),this.loadDasboardPlaceHolder(),this.loadDashboardSetPlaceHolder(),this.loadDashboardsLists(),this.loadPreferences()}loadDasboardPlaceHolder(){this.defaultDashboardPlaceHolder={id:"",name:this.language.getLabel("LBL_ROLE_DEFAULT_DASHBOARD")}}loadDashboardSetPlaceHolder(){this.defaultDashboardSetPlaceHolder={id:"",name:this.language.getLabel("LBL_ROLE_DEFAULT_DASHBOARDSET")}}loadPreferences(){this.isCurrentUser?(this.subscriptions=this.loadedSubscription.subscribe((()=>{this.isLoading=!1,this.preferences=_.pick(this.preferencesService.unchangedPreferences.global,this.names),this.setHomeDashboardSetData(this.preferences.home_dashboardset),this.setHomeDashboardData(this.preferences.home_dashboard)})),this.preferencesService.getPreferences(this.loadedSubscription)):this.canEdit&&this.backend.getRequest(`module/Users/${this.model.id}/preferences/global`,{}).subscribe((e=>{this.isLoading=!1,this.preferences=e,this.setHomeDashboardSetData(this.preferences.home_dashboardset),this.setHomeDashboardData(this.preferences.home_dashboard)}),(e=>{this.toast.sendToast(this.language.getLabel("LBL_ERROR")+" "+e.status,"error",e.error.error.message),403===e.status&&(this.canEdit=!0)}))}loadDashboardsLists(){this.backend.getList("Dashboards",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe((e=>{this.dashboards=[].concat(this.dashboards,this.defaultDashboardPlaceHolder,e.list),this.setHomeDashboardData(this.preferences.home_dashboard)})),this.backend.getList("DashboardSets",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe((e=>{this.dashboardSets=[].concat(this.dashboardSets,this.defaultDashboardSetPlaceHolder,e.list),this.setHomeDashboardSetData(this.preferences.home_dashboardset)}))}setHomeDashboardData(e){this.homeDashboardData=this.dashboards.find((s=>s.id==e))}setHomeDashboardSetData(e){this.homeDashboardSetData=this.dashboardSets.find((s=>s.id==e))}cancel(){this.view.setViewMode()}save(){this.isCurrentUser?(this.preferencesService.setPreferences(this.preferences).subscribe((()=>{this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED"),"success"),this.preferences=_.pick(this.preferencesService.unchangedPreferences.global,this.names),this.broadcast.broadcastMessage("userpreferences.save")})),this.view.setViewMode()):this.backend.postRequest(`module/Users/${this.model.id}/preferences/global`,{},this.preferences).subscribe((e=>{this.preferences=e,this.view.setViewMode()}),(e=>{this.toast.sendToast(this.language.getLabel("LBL_ERROR")+" "+e.status,"error",e.error.error.message)}))}static#e=this.ɵfac=function(e){return new(e||UserPreferences)(h.rXU(y.H),h.rXU(j.U),h.rXU(b.o),h.rXU(F.G),h.rXU(u.B),h.rXU(T.S),h.rXU(f.d),h.rXU(g.g),h.rXU(N.m),h.rXU(R.i),h.rXU($.yu))};static#s=this.ɵcmp=h.VBU({type:UserPreferences,selectors:[["user-preferences"]],viewQuery:function(e,s){if(1&e&&h.GBs(W,5),2&e){let e;h.mGM(e=h.lsd())&&(s.systemPreferencesPanel=e.first)}},features:[h.Jv_([j.U])],decls:3,vars:2,consts:[["class","slds-text-align--center slds-m-top--x-large",4,"ngIf","ngIfElse"],["preferencesContainer",""],[1,"slds-text-align--center","slds-m-top--x-large"],[3,"system-overlay-loading-spinner"],[3,"preferences","isPersonalContext"],["systemPreferencesPanel",""],["tabtitle","LBL_HOME_PREFERENCES",3,"collapsible"],[1,"slds-grid"],["itemlabel","LBL_HOME_DASHBOARD",1,"slds-size--1-of-3"],[4,"ngIf"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["itemlabel","LBL_HOME_DASHBOARDSET",1,"slds-size--1-of-3"],["itemlabel","LBL_HOME_ASSISTANT",1,"slds-size--1-of-3"],[3,"global"],["label","LBL_VISIBLE",4,"ngIf"],["label","LBL_HIDDEN",4,"ngIf"],["value","visible"],["label","LBL_VISIBLE"],["value","hidden"],["label","LBL_HIDDEN"],["class","slds-p-around--small slds-align--absolute-center",4,"ngIf"],[3,"value"],[1,"slds-p-around--small","slds-align--absolute-center"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand","slds-button-space-left",3,"click"],["label","LBL_SAVE"]],template:function(e,s){if(1&e&&h.DNE(0,q,2,0,"div",0)(1,ae,32,15,"ng-template",null,1,h.C5r),2&e){const e=h.sdS(2);h.Y8G("ngIf",!s.canEdit)("ngIfElse",e)}},dependencies:[a.Sq,a.bT,i.xH,i.y7,i.wz,i.BC,i.vS,X.p,L.W,Y.w,H.x,V.J,z.t,D.M],encapsulation:2})}return UserPreferences})();var ne=t(49380),le=t(28933);function re(e,s){if(1&e&&h.nrm(0,"system-custom-icon",20),2&e){const e=h.XpG(2);h.FS9("title",e.language.getLabel("LBL_CUSTOM_ROLE"))}}function oe(e,s){if(1&e){const e=h.RV6();h.j41(0,"td",21)(1,"button",22),h.bIt("click",(function(){h.eBV(e);const s=h.XpG(),t=s.index,a=s.$implicit,i=h.XpG();return h.Njj(i.deleteRole(t,a.id,"1"==a.defaultrole))})),h.nrm(2,"system-button-icon",23),h.k0s()()}if(2&e){const e=h.XpG().$implicit;h.R7$(),h.Y8G("disabled","1"==e.defaultrole),h.R7$(),h.Y8G("icon","delete")}}function de(e,s){if(1&e){const e=h.RV6();h.j41(0,"tr",10),h.qex(1),h.j41(2,"td",11)(3,"span",12),h.EFF(4),h.nI1(5,"uppercase"),h.k0s()(),h.j41(6,"td",4),h.DNE(7,re,1,1,"system-custom-icon",13),h.EFF(8),h.k0s(),h.j41(9,"td",14)(10,"span",15)(11,"input",16),h.bIt("change",(function(){const s=h.eBV(e).$implicit,t=h.XpG();return h.Njj(t.setDefaultRole(s.id))})),h.k0s(),h.j41(12,"label",17),h.nrm(13,"span",18),h.k0s()()(),h.DNE(14,oe,3,2,"td",19),h.bVm(),h.k0s()}if(2&e){const e=s.$implicit,t=h.XpG();h.R7$(3),h.ZvI("slds-avatar slds-avatar--small slds-align--absolute-center ",e.icon,""),h.R7$(),h.SpI(" ",e.label?t.language.getLabel(e.label,"","short"):h.bMT(5,14,e.name.substring(0,2))," "),h.R7$(3),h.Y8G("ngIf",e.custom),h.R7$(),h.SpI(" ",t.language.getAppLanglabel(e.label)||e.name,""),h.R7$(3),h.FCK("id","",t.componentId,"-",e.id,""),h.Y8G("name",t.componentId+"-radio-default-role")("disabled",!t.session.authData.admin)("checked","1"==e.defaultrole),h.R7$(),h.FCK("for","",t.componentId,"-",e.id,""),h.R7$(2),h.Y8G("ngIf",t.session.authData.admin)}}function ce(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",24)(1,"button",25),h.bIt("click",(function(s){h.eBV(e);const t=h.XpG();return h.Njj(t.addRole(s))})),h.nrm(2,"system-label",26),h.EFF(3," … "),h.k0s()()}}let he=(()=>{class UserRoles{constructor(e,s,t,a,i,n){this.backend=e,this.toast=s,this.modal=t,this.model=a,this.session=i,this.language=n,this.userRoles=[],this.noneUserRoles=[],this.loading=!0,this.componentId=_.uniqueId(),this.backend.getRequest("configuration/spiceui/core/roles/"+this.model.id).subscribe((e=>{this.userRoles=e.allRoles.filter((s=>{for(let t of e.userRoles)if(s.id==t.sysuirole_id)return s.defaultrole=t.defaultrole,!0;return!1})),this.userRoles=this.sortRoles(this.userRoles),this.noneUserRoles=e.allRoles.filter((e=>{for(let s of this.userRoles)if(e.id==s.id)return!1;return!0})),this.noneUserRoles=this.sortRoles(this.noneUserRoles),this.noneUserRoles.map((e=>e.defaultrole="0")),this.loading=!1}))}sortRoles(e){return e?e.sort(((e,s)=>this.language.getLabel(e.label??e.name).localeCompare(this.language.getLabel(s.label??s.name)))):[]}addRole(e){this.session.authData.admin&&this.modal.openModal("UserRolesAddModal").subscribe((e=>{e.instance.user_id=this.model.id,e.instance.noneUserRoles=this.noneUserRoles,e.instance.response.subscribe((e=>{e&&"object"==typeof e&&(this.userRoles.push(e),1===this.userRoles.length&&this.setDefaultRole(e.id),this.userRoles=this.sortRoles(this.userRoles)),e&&"string"==typeof e&&(this.noneUserRoles=this.noneUserRoles.filter((s=>s.id!=e)))}))}))}deleteRole(e,s,t){this.session.authData.admin&&!t&&this.modal.confirm(this.language.getLabel("MSG_DELETE_RECORD","","long"),this.language.getLabel("MSG_DELETE_RECORD")).subscribe((t=>{t&&this.backend.deleteRequest(`configuration/spiceui/core/roles/${s}/${this.model.id}`).subscribe((s=>{if("error"==s.status)return this.toast.sendToast(s.message,"error"),!1;let t=this.userRoles.splice(e,1);this.noneUserRoles.push(t[0]),this.noneUserRoles=this.sortRoles(this.noneUserRoles),this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_DELETED"),"success")}),(e=>this.toast.sendToast(this.language.getLabel("ERR_CANT_DELETE"),"error")))}))}setDefaultRole(e){this.session.authData.admin&&(this.userRoles.every((s=>(s.id==e?s.defaultrole="1":s.defaultrole="0",!0))),this.backend.postRequest(`configuration/spiceui/core/roles/${e}/${this.model.id}/default`))}static#e=this.ɵfac=function(e){return new(e||UserRoles)(h.rXU(y.H),h.rXU(b.o),h.rXU(m.y),h.rXU(g.g),h.rXU(f.d),h.rXU(u.B))};static#s=this.ɵcmp=h.VBU({type:UserRoles,selectors:[["user-roles"]],decls:12,vars:3,consts:[["system-to-bottom","",3,"system-overlay-loading-spinner"],[1,"slds-table","slds-table_bordered","slds-table_cell-buffer",2,"box-shadow","0px 2px 5px 0 rgba(0,0,0,.1)","border-radius",".15rem"],[1,"slds-table--bordered","slds-text-align_center"],[1,"slds-text-title--caps"],[2,"padding",".75rem 1rem"],["label","LBL_NAME"],["colspan","2"],["label","LBL_DEFAULT"],["class","slds-hint-parent",4,"ngFor","ngForOf"],["class","slds-p-around--small slds-align--absolute-center",4,"ngIf"],[1,"slds-hint-parent"],[2,"padding-left","1rem","padding-right","0","width","1.5rem"],[2,"margin","0"],["icon","custom","size","x-small","style","display:inline-block",3,"title",4,"ngIf"],[1,"slds-text-align_center",2,"width","5rem"],[1,"slds-radio"],["type","radio",3,"name","id","disabled","checked","change"],[1,"slds-radio__label",3,"for"],[1,"slds-radio_faux"],["style","padding-right: 1rem;width: 35px",4,"ngIf"],["icon","custom","size","x-small",2,"display","inline-block",3,"title"],[2,"padding-right","1rem","width","35px"],[1,"slds-button","slds-button--icon",3,"disabled","click"],[3,"icon"],[1,"slds-p-around--small","slds-align--absolute-center"],[1,"slds-button","slds-button--brand","slds-button-space-left",3,"click"],["label","LBL_ASSIGN_ROLE"]],template:function(e,s){1&e&&(h.j41(0,"div",0)(1,"table",1)(2,"thead",2)(3,"tr",3),h.nrm(4,"th"),h.j41(5,"th",4),h.nrm(6,"system-label",5),h.k0s(),h.j41(7,"th",6),h.nrm(8,"system-label",7),h.k0s()()(),h.j41(9,"tbody"),h.DNE(10,de,15,16,"tr",8),h.k0s()(),h.DNE(11,ce,4,0,"div",9),h.k0s()),2&e&&(h.Y8G("system-overlay-loading-spinner",s.loading),h.R7$(10),h.Y8G("ngForOf",s.userRoles),h.R7$(),h.Y8G("ngIf",s.noneUserRoles.length>0&&s.session.authData.admin))},dependencies:[a.Sq,a.bT,S.t,ne.k,L.W,le.b,D.M,a.Pc],encapsulation:2})}return UserRoles})();function ue(e,s){if(1&e&&(h.j41(0,"option",18),h.EFF(1),h.nI1(2,"uppercase"),h.k0s()),2&e){const e=s.$implicit,t=h.XpG(2);h.Y8G("value",e.id),h.R7$(),h.SpI(" ",e.label?t.language.getLabel(e.label,"short"):h.bMT(2,2,e.name.substring(0,2))+" "+t.language.getLabel(e.label)," ")}}function me(e,s){if(1&e&&(h.qex(0),h.DNE(1,ue,3,4,"option",17),h.bVm()),2&e){const e=h.XpG();h.R7$(),h.Y8G("ngForOf",e.nonUserGlobalRoles)}}function ge(e,s){if(1&e&&(h.j41(0,"option",18),h.EFF(1),h.nI1(2,"uppercase"),h.nrm(3,"system-label",20),h.EFF(4,") "),h.k0s()),2&e){const e=s.$implicit,t=h.XpG(2);h.Y8G("value",e.id),h.R7$(),h.SpI(" ",e.label?t.language.getLabel(e.label,"short"):h.bMT(2,2,e.name.substring(0,2))+" "+t.language.getLabel(e.label)," (")}}function pe(e,s){if(1&e&&(h.j41(0,"optgroup",19),h.DNE(1,ge,5,4,"option",17),h.k0s()),2&e){const e=h.XpG();h.FS9("label",e.language.getLabel("LBL_CUSTOM_ROLES")),h.R7$(),h.Y8G("ngForOf",e.nonUserCustomRoles)}}let be=(()=>{class UserRolesAddModal{constructor(e,s,t){this.language=e,this.toast=s,this.backend=t,this.user_id="",this.noneUserRoles=[],this.sysuirole_id="",this.response=null,this.responseSubject=null,this.responseSubject=new O.B,this.response=this.responseSubject.asObservable()}get nonUserGlobalRoles(){let e=[];return this.noneUserRoles.forEach((s=>{s.custom||e.push(s)})),e}get nonUserCustomRoles(){let e=[];return this.noneUserRoles.forEach((s=>{s.custom&&e.push(s)})),e}setRole(e){this.sysuirole_id=e}cancel(){this.responseSubject.next(!1),this.responseSubject.complete(),this.self.destroy()}onModalEscX(){this.cancel()}canSubmit(){return this.sysuirole_id.length>0}add(){this.backend.postRequest(`configuration/spiceui/core/roles/${this.sysuirole_id}/${this.user_id}/new`).subscribe((e=>{let s;"error"==e.status&&(this.toast.sendToast(e.message,"error"),this.responseSubject.complete(),this.self.destroy()),this.noneUserRoles.every((e=>(e.id==this.sysuirole_id&&(s=e),!0))),this.responseSubject.next(s),this.responseSubject.next(this.sysuirole_id),this.responseSubject.complete(),this.self.destroy(),this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_ADDED"),"success")}),(e=>{this.toast.sendToast("Error, try again later","error"),this.self.destroy()}))}static#e=this.ɵfac=function(e){return new(e||UserRolesAddModal)(h.rXU(u.B),h.rXU(b.o),h.rXU(y.H))};static#s=this.ɵcmp=h.VBU({type:UserRolesAddModal,selectors:[["user-roles-add-modal"]],inputs:{user_id:"user_id",noneUserRoles:"noneUserRoles"},decls:21,vars:3,consts:[[3,"close"],["label","LBL_ASSIGN_ROLE"],[1,"slds-grid--pull-padded"],[1,"slds-form-element","slds-m-vertical--xxx-small","slds-m-horizontal--small"],[1,"slds-form-element__label"],["label","LBL_ROLES"],[1,"slds-form-element__control"],[1,"slds-select_container"],[1,"slds-select",3,"change"],["value",""],["label","LBL_SELECT"],[4,"ngIf"],[3,"label",4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_ASSIGN"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"label"],["label","LBL_CUSTOM"]],template:function(e,s){1&e&&(h.j41(0,"system-modal")(1,"system-modal-header",0),h.bIt("close",(function(){return s.cancel()})),h.nrm(2,"system-label",1),h.k0s(),h.j41(3,"system-modal-content")(4,"div",2)(5,"div",3)(6,"label",4),h.nrm(7,"system-label",5),h.k0s(),h.j41(8,"div",6)(9,"div",7)(10,"select",8),h.bIt("change",(function(e){return s.setRole(e.srcElement.value)})),h.j41(11,"option",9),h.nrm(12,"system-label",10),h.EFF(13," …"),h.k0s(),h.DNE(14,me,2,1,"ng-container",11)(15,pe,2,2,"optgroup",12),h.k0s()()()()()(),h.j41(16,"system-modal-footer")(17,"button",13),h.bIt("click",(function(){return s.cancel()})),h.nrm(18,"system-label",14),h.k0s(),h.j41(19,"button",15),h.bIt("click",(function(){return s.add()})),h.nrm(20,"system-label",16),h.k0s()()()),2&e&&(h.R7$(14),h.Y8G("ngIf",s.nonUserGlobalRoles.length),h.R7$(),h.Y8G("ngIf",s.nonUserCustomRoles.length),h.R7$(4),h.Y8G("disabled",!s.canSubmit()))},dependencies:[a.Sq,a.bT,i.xH,i.y7,L.W,v.D,U.I,k.Q,M.C,a.Pc],encapsulation:2})}return UserRolesAddModal})(),fe=(()=>{class UserAddButton{constructor(e,s,t,a,i,n,l){this.modal=e,this.language=s,this.model=t,this.session=a,this.metadata=i,this.injector=n,this.configurationService=l,this.disabled=!0;let r=this.configurationService.getSystemParamater("aclcontroller");r&&"spiceacl"!=r?this.session.isAdmin&&(this.disabled=!1):this.metadata.checkModuleAcl("Users","create")&&(this.disabled=!1)}execute(){this.modal.openModal("UserAddModal",!0,this.injector)}static#e=this.ɵfac=function(e){return new(e||UserAddButton)(h.rXU(m.y),h.rXU(u.B),h.rXU(g.g),h.rXU(f.d),h.rXU($.yu),h.rXU(h.zZn),h.rXU(R.i))};static#s=this.ɵcmp=h.VBU({type:UserAddButton,selectors:[["user-add-button"]],decls:2,vars:0,consts:[["label","LBL_NEW"]],template:function(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",0),h.k0s())},dependencies:[L.W],encapsulation:2})}return UserAddButton})();var _e=t(92462),ye=t(89166),Re=t(3719),Ee=t(12883);const Se=["addcontainer"];function we(e,s){if(1&e&&(h.j41(0,"div"),h.nrm(1,"system-label",35),h.EFF(2),h.nrm(3,"br"),h.k0s()),2&e){const e=h.XpG();h.R7$(2),h.SpI(": ",e.pwdGuideline,"")}}function Le(e,s){if(1&e&&h.nrm(0,"field-messages",36),2&e){const e=h.XpG();h.Y8G("messages",e.passwordMsg)}}function ve(e,s){if(1&e&&h.nrm(0,"field-messages",36),2&e){const e=h.XpG();h.Y8G("messages",e.rePasswordMsg)}}let Ue=(()=>{class UserAddModal{constructor(e,s,t,a,i,n,l,r,o,d,c){this.language=e,this.model=s,this.parent=t,this.modelutilities=a,this.toast=i,this.backend=n,this.view=l,this.cdr=r,this.metadata=o,this.configuration=d,this.helper=c,this.response=null,this.responseSubject=null,this.pwdCheck=new RegExp("//"),this.userNameCheck=new RegExp("^(?![_.])(?!.*[_.]{2})[@a-zA-Z0-9._-]{1,60}$"),this.autogenerate=!1,this.sendByEmail=!1,this.forceReset=!0,this.externalAuthOnly=!1,this.showPassword=!1,this.saveTriggered=!1,this.canSendByEmail=!0,this.model.module="Users",this.view.isEditable=!0,this.view.setEditMode(),this.responseSubject=new O.B,this.response=this.responseSubject.asObservable()}get PwdFieldType(){return this.showPassword?"text":"password"}get modelOptions(){return{updateOn:"blur"}}get passwordMsg(){return this.pwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.pwdNotMatchGuide?[{type:"error",message:this.language.getLabel("MSG_PWD_NOT_LEGAL")}]:[]}get rePasswordMsg(){return this.rePwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.rePwdNotSame?[{type:"error",message:this.language.getLabel("MSG_PWDS_DONT_MATCH")}]:[]}get pwdFieldEmpty(){return this.saveTriggered&&!this.password}get rePwdFieldEmpty(){return this.saveTriggered&&!this.repeatPassword}get pwdNotMatchGuide(){return!this.autoGenerate&&this.password&&!this.pwdCheck.test(this.password)}get rePwdNotSame(){return!this.autoGenerate&&this.repeatPassword&&this.password!=this.repeatPassword}get pwdFieldStyle(){return this.externalAuthOnly||!this.pwdFieldEmpty&&!this.pwdNotMatchGuide?"":"slds-has-error"}get rePwdFieldStyle(){return this.externalAuthOnly||!this.rePwdFieldEmpty&&!this.rePwdNotSame?"":"slds-has-error"}get hasError(){let e=!0;!this.externalAuthOnly&&!this.autoGenerate&&this.pwdGuideline&&this.pwdNotMatchGuide&&(e=!1),this.externalAuthOnly||this.autoGenerate||this.password&&!this.rePwdNotSame||(e=!1),this.model.validate()||(e=!1);let s=this.model.getField("user_name");return s&&!this.userNameCheck.test(s)&&(this.model.setFieldMessage("error",this.language.getLabel("MSG_USERNAME_NOT_LEGAL"),"user_name","validation"),e=!1),!e}get autoGenerate(){return this.autogenerate}set autoGenerate(e){this.autogenerate=e,e&&(this.password=this.helper.generatePassword(this.configuration.getCapabilityConfig("userpassword")),this.repeatPassword=this.password)}ngOnInit(){this.model.initialize(this.parent),this.model.setFields({UserType:"RegularUser",status:"Active"}),this.getFieldSets(),this.getPassInfo()}getFieldSets(){let e=this.metadata.getComponentConfig("UserAddModal","Users");this.profileFieldset=e&&e.profile?e.profile:this.profileFieldset,this.informationFieldset=e&&e.information?e.information:this.informationFieldset}toggleShowPassword(){this.showPassword=!this.showPassword}getPassInfo(){let e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);let s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.onespecial&&s.push(this.language.getLabel("MSG_PASSWORD_ONESPECIAL")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")}copyPassword(){navigator.clipboard.writeText(this.password),this.toast.sendToast(this.language.getLabel("MSG_PASSWORD_COPIED"),"success")}cancel(){this.responseSubject.next(!1),this.responseSubject.complete(),this.self.destroy()}save(e=!1){if(this.saveTriggered=!0,this.hasError)return;this.model.setFields({system_generated_password:!this.externalAuthOnly&&this.autoGenerate,pwd_last_changed:new moment,external_auth_only:this.externalAuthOnly});let s=this.modelutilities.spiceModel2backend("Users",this.model.data);this.backend.postRequest("module/Users/"+this.model.id,{},JSON.stringify(s)).subscribe({next:s=>{for(let e in s)s.hasOwnProperty(e)&&(s[e]=this.modelutilities.backend2spice("Users",e,s[e]));this.model.setData(s),this.model.endEdit(),this.externalAuthOnly?(e&&this.model.goDetail(),this.self.destroy()):this.savePassword(e)},error:e=>{e.error.error.message&&(this.addcontainer.element.nativeElement.scrollTop=0,"duplicateUsername"==e.error.error.errorCode&&this.model.setFieldMessage("error",e.error.error.message,"user_name","validation"),"duplicateEmail1"==e.error.error.errorCode&&this.model.setFieldMessage("error",e.error.error.message,"email1","validation"))}})}savePassword(e){let s={newPassword:this.password,forceReset:this.forceReset,sendEmail:!!this.canSendByEmail&&this.sendByEmail};this.backend.postRequest("module/Users/"+this.model.id+"/password/reset",{},s).subscribe((s=>{this.sendByEmail?this.toast.sendToast(this.language.getLabel("MSG_NEW_PASSWORD_EMAIL_SENT"),"success","",10):this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED"),"success"),e&&this.model.goDetail(),this.self.destroy()}),(e=>{this.sendByEmail=!1,this.canSendByEmail=!1,this.toast.sendToast(this.language.getLabel("MSG_PASSWORD_RESET_FAILED"),"error")}))}static#e=this.ɵfac=function(e){return new(e||UserAddModal)(h.rXU(u.B),h.rXU(g.g),h.rXU(g.g,4),h.rXU(_e.g),h.rXU(b.o),h.rXU(y.H),h.rXU(j.U),h.rXU(h.gRc),h.rXU($.yu),h.rXU(R.i),h.rXU(E.d))};static#s=this.ɵcmp=h.VBU({type:UserAddModal,selectors:[["ng-component"]],viewQuery:function(e,s){if(1&e&&h.GBs(Se,7,h.c1b),2&e){let e;h.mGM(e=h.lsd())&&(s.addcontainer=e.first)}},features:[h.Jv_([g.g,j.U])],decls:47,vars:33,consts:[["size","large"],[3,"close"],["addcontainer",""],["titlelabel","LBL_USER_PROFILE"],[3,"fieldset","direction"],["titlelabel","LBL_USER_PASSWORD"],[4,"ngIf"],[1,"slds-grid","slds-wrap"],[1,"slds-p-around--x-small","slds-size--1-of-1","slds-large-size--1-of-2"],[1,"slds-form--stacked","slds-text-align--left"],[1,"slds-grid"],[1,"slds-size--10-of-12"],[1,"slds-form-element","slds-m-vertical--small",3,"ngClass"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--left"],[3,"icon","addclasses"],[1,"slds-input",3,"type","ngModel","placeholder","disabled","ngModelOptions","ngModelChange"],[3,"messages",4,"ngIf"],[1,"slds-size--2-of-12","slds-p-horizontal--xx-small","slds-p-vertical--small",2,"white-space","nowrap"],[1,"slds-button","slds-button--neutral","slds-p-horizontal--x-small",3,"click"],["size","medium",3,"icon"],[1,"slds-button","slds-button--neutral","slds-p-horizontal--x-small",3,"disabled","click"],["icon","copy","size","medium"],[1,"slds-p-horizontal--small","slds-p-vertical_medium","slds-size--1-of-1","slds-large-size--1-of-2","slds-grid","slds-grid--vertical"],[3,"disabled","ngModel","ngModelChange"],["label","LBL_AUTO_GENERATE"],["label","LBL_SEND_BY_EMAIL"],["label","LBL_FORCE_RESET"],[3,"ngModel","ngModelChange"],["label","LBL_EXT_AUTHENTICATE"],["titlelabel","LBL_USER_INFORMATION"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],["label","LBL_SAVE_AND_GO_TO_RECORD"],["label","LBL_PWD_GUIDELINE",2,"display","inline-block"],[3,"messages"]],template:function(e,s){1&e&&(h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.cancel()})),h.EFF(2),h.k0s(),h.j41(3,"system-modal-content",null,2)(5,"system-section",3),h.nrm(6,"object-record-fieldset",4),h.k0s(),h.j41(7,"system-section",5),h.DNE(8,we,4,1,"div",6),h.j41(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13),h.nrm(16,"system-utility-icon",14),h.j41(17,"input",15),h.mxI("ngModelChange",(function(e){return h.DH7(s.password,e)||(s.password=e),e})),h.k0s()(),h.DNE(18,Le,1,1,"field-messages",16),h.k0s(),h.j41(19,"div",12)(20,"div",13),h.nrm(21,"system-utility-icon",14),h.j41(22,"input",15),h.mxI("ngModelChange",(function(e){return h.DH7(s.repeatPassword,e)||(s.repeatPassword=e),e})),h.k0s()(),h.DNE(23,ve,1,1,"field-messages",16),h.k0s()(),h.j41(24,"div",17)(25,"button",18),h.bIt("click",(function(){return s.toggleShowPassword()})),h.nrm(26,"system-button-icon",19),h.k0s(),h.j41(27,"button",20),h.bIt("click",(function(){return s.copyPassword()})),h.nrm(28,"system-button-icon",21),h.k0s()()()()(),h.j41(29,"div",22)(30,"system-checkbox",23),h.mxI("ngModelChange",(function(e){return h.DH7(s.autoGenerate,e)||(s.autoGenerate=e),e})),h.nrm(31,"system-label",24),h.k0s(),h.j41(32,"system-checkbox",23),h.mxI("ngModelChange",(function(e){return h.DH7(s.sendByEmail,e)||(s.sendByEmail=e),e})),h.nrm(33,"system-label",25),h.k0s(),h.j41(34,"system-checkbox",23),h.mxI("ngModelChange",(function(e){return h.DH7(s.forceReset,e)||(s.forceReset=e),e})),h.nrm(35,"system-label",26),h.k0s(),h.j41(36,"system-checkbox",27),h.mxI("ngModelChange",(function(e){return h.DH7(s.externalAuthOnly,e)||(s.externalAuthOnly=e),e})),h.nrm(37,"system-label",28),h.k0s()()()(),h.j41(38,"system-section",29),h.nrm(39,"object-record-fieldset",4),h.k0s()(),h.j41(40,"system-modal-footer")(41,"button",30),h.bIt("click",(function(){return s.cancel()})),h.nrm(42,"system-label",31),h.k0s(),h.j41(43,"button",32),h.bIt("click",(function(){return s.save()})),h.nrm(44,"system-label",33),h.k0s(),h.j41(45,"button",32),h.bIt("click",(function(){return s.save(!0)})),h.nrm(46,"system-label",34),h.k0s()()()),2&e&&(h.R7$(2),h.JRh(s.model.module),h.R7$(4),h.Y8G("fieldset",s.profileFieldset)("direction","vertical"),h.R7$(2),h.Y8G("ngIf",s.pwdGuideline),h.R7$(6),h.Y8G("ngClass",s.pwdFieldStyle),h.R7$(2),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("type",s.PwdFieldType),h.R50("ngModel",s.password),h.Y8G("placeholder",s.language.getLabel("MSG_ENTER_NEW_PASSWORD"))("disabled",s.autoGenerate||s.externalAuthOnly)("ngModelOptions",s.modelOptions),h.R7$(),h.Y8G("ngIf",!s.externalAuthOnly),h.R7$(),h.Y8G("ngClass",s.rePwdFieldStyle),h.R7$(2),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("type",s.PwdFieldType),h.R50("ngModel",s.repeatPassword),h.Y8G("placeholder",s.language.getLabel("LBL_REPEAT_PWD"))("disabled",s.autoGenerate||s.externalAuthOnly)("ngModelOptions",s.modelOptions),h.R7$(),h.Y8G("ngIf",!s.externalAuthOnly),h.R7$(3),h.Y8G("icon",s.showPassword?"hide":"preview"),h.R7$(),h.Y8G("disabled",!s.autoGenerate),h.R7$(3),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.autoGenerate),h.R7$(2),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.sendByEmail),h.R7$(2),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.forceReset),h.R7$(2),h.R50("ngModel",s.externalAuthOnly),h.R7$(3),h.Y8G("fieldset",s.informationFieldset)("direction","vertical"))},dependencies:[a.YU,a.bT,i.me,i.BC,i.vS,ye.A,Re.D,S.t,w.f,L.W,v.D,U.I,k.Q,M.C,Ee.v,G.B],encapsulation:2})}return UserAddModal})(),ke=(()=>{class UserCreateFromBeanButton{constructor(e,s,t,a,i,n,l){this.modal=e,this.language=s,this.model=t,this.session=a,this.metadata=i,this.injector=n,this.configurationService=l,this.disabled=!0,this.metadata.checkModuleAcl("Users","create")&&(this.disabled=!1)}execute(){this.modal.openModal("UserCreateFromBeanModal",!0,this.injector)}static#e=this.ɵfac=function(e){return new(e||UserCreateFromBeanButton)(h.rXU(m.y),h.rXU(u.B),h.rXU(g.g),h.rXU(f.d),h.rXU($.yu),h.rXU(h.zZn),h.rXU(R.i))};static#s=this.ɵcmp=h.VBU({type:UserCreateFromBeanButton,selectors:[["user-ceate-from-bean-button"]],decls:1,vars:0,consts:[["label","LBL_CREATE_USER"]],template:function(e,s){1&e&&h.nrm(0,"system-label",0)},dependencies:[L.W],encapsulation:2})}return UserCreateFromBeanButton})();var Me=t(65416),Ge=t(82931);function De(e,s){if(1&e&&(h.j41(0,"div",22),h.nrm(1,"system-label",23),h.EFF(2),h.nrm(3,"br"),h.k0s()),2&e){const e=h.XpG();h.R7$(2),h.SpI(": ",e.pwdGuideline,"")}}function Ce(e,s){if(1&e&&h.nrm(0,"field-messages",24),2&e){const e=h.XpG();h.Y8G("messages",e.passwordMsg)}}function Ie(e,s){if(1&e&&h.nrm(0,"field-messages",24),2&e){const e=h.XpG();h.Y8G("messages",e.rePasswordMsg)}}let Be=(()=>{class UserCreatePassword{constructor(e,s,t,a,i,n,l,r,o,d,c){this.language=e,this.model=s,this.parent=t,this.modelutilities=a,this.toast=i,this.backend=n,this.view=l,this.cdr=r,this.metadata=o,this.configuration=d,this.helper=c,this.pwdCheck=new RegExp("//"),this.userNameCheck=new RegExp("^(?![_.])(?!.*[_.]{2})[@a-zA-Z0-9._-]{1,60}$"),this.autogenerate=!1,this.sendByEmail=!1,this.forceReset=!0,this.externalauthonly=!1,this.showPassword=!1,this.saveTriggered=!1,this.canSendByEmail=!0,this.sendbyemail=new h.bkB,this.forcereset=new h.bkB,this.extauthonly=new h.bkB,this.systemgenerated=new h.bkB}ngOnInit(){this.getPassInfo()}registerOnChange(e){this.onChange=s=>{e(s)}}registerOnTouched(e){this.onTouched=e}writeValue(e){void 0!==e&&(this._password=e)}emitChanges(){this.sendbyemail.emit(this.sendByEmail),this.extauthonly.emit(this.externalAuthOnly),this.forcereset.emit(this.forceReset),this.systemgenerated.emit(this.autogenerate)}get password(){return this._password}set password(e){this._password=e,this.onChange(e)}get modelOptions(){return{updateOn:"blur"}}get PwdFieldType(){return this.showPassword?"text":"password"}get passwordMsg(){return this.pwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.pwdNotMatchGuide?[{type:"error",message:this.language.getLabel("MSG_PWD_NOT_LEGAL")}]:[]}get rePasswordMsg(){return this.rePwdFieldEmpty?[{type:"error",message:this.language.getLabel("MSG_INPUT_REQUIRED")}]:this.rePwdNotSame?[{type:"error",message:this.language.getLabel("MSG_PWDS_DONT_MATCH")}]:[]}get pwdFieldEmpty(){return this.saveTriggered&&!this.password}get rePwdFieldEmpty(){return this.saveTriggered&&!this.repeatPassword}get pwdNotMatchGuide(){return!this.autoGenerate&&this.password&&!this.pwdCheck.test(this.password)}get rePwdNotSame(){return!this.autoGenerate&&this.repeatPassword&&this.password!=this.repeatPassword}get pwdFieldStyle(){return this.externalAuthOnly||!this.pwdFieldEmpty&&!this.pwdNotMatchGuide?"":"slds-has-error"}get rePwdFieldStyle(){return this.externalAuthOnly||!this.rePwdFieldEmpty&&!this.rePwdNotSame?"":"slds-has-error"}get hasError(){let e=!0;!this.externalAuthOnly&&!this.autoGenerate&&this.pwdGuideline&&this.pwdNotMatchGuide&&(e=!1),this.externalAuthOnly||this.autoGenerate||this.password&&!this.rePwdNotSame||(e=!1),this.model.validate()||(e=!1);let s=this.model.getField("user_name");return s&&!this.userNameCheck.test(s)&&(this.model.setFieldMessage("error",this.language.getLabel("MSG_USERNAME_NOT_LEGAL"),"user_name","validation"),e=!1),!e}get autoGenerate(){return this.autogenerate}set autoGenerate(e){this.autogenerate=e,e&&(this.password=this.helper.generatePassword(this.configuration.getCapabilityConfig("userpassword")),this.repeatPassword=this.password)}get externalAuthOnly(){return this.externalauthonly}set externalAuthOnly(e){this.externalauthonly=e,e&&(this.autogenerate=!1,this.sendByEmail=!1,this.forceReset=!1,this.password="",this.showPassword=!1,this.repeatPassword="")}toggleShowPassword(){this.showPassword=!this.showPassword}getPassInfo(){let e=this.configuration.getCapabilityConfig("userpassword");this.pwdCheck=new RegExp(e.regex);let s=[];e.onelower&&s.push(this.language.getLabel("MSG_PASSWORD_ONELOWER")),e.oneupper&&s.push(this.language.getLabel("MSG_PASSWORD_ONEUPPER")),e.onenumber&&s.push(this.language.getLabel("MSG_PASSWORD_ONENUMBER")),e.onespecial&&s.push(this.language.getLabel("MSG_PASSWORD_ONESPECIAL")),e.minpwdlength&&s.push(this.language.getLabel("MSG_PASSWORD_LENGTH")+" "+e.minpwdlength),this.pwdGuideline=s.join(", ")}copyPassword(){navigator.clipboard.writeText(this.password),this.toast.sendToast(this.language.getLabel("MSG_PASSWORD_COPIED"),"success")}static#e=this.ɵfac=function(e){return new(e||UserCreatePassword)(h.rXU(u.B),h.rXU(g.g),h.rXU(g.g,4),h.rXU(_e.g),h.rXU(b.o),h.rXU(y.H),h.rXU(j.U),h.rXU(h.gRc),h.rXU($.yu),h.rXU(R.i),h.rXU(E.d))};static#s=this.ɵcmp=h.VBU({type:UserCreatePassword,selectors:[["user-create-password"]],outputs:{sendbyemail:"sendbyemail",forcereset:"forcereset",extauthonly:"extauthonly",systemgenerated:"systemgenerated"},features:[h.Jv_([{provide:i.kq,useExisting:(0,h.Rfq)((()=>UserCreatePassword)),multi:!0}])],decls:30,vars:29,consts:[["class","slds-p-top--x-small slds-p-horizontal--x-small",4,"ngIf"],[1,"slds-grid","slds-wrap"],[1,"slds-p-around--x-small","slds-size--1-of-1","slds-large-size--1-of-2"],[1,"slds-form--stacked","slds-text-align--left"],[1,"slds-grid"],[1,"slds-size--10-of-12"],[1,"slds-form-element","slds-m-vertical--small",3,"ngClass"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--left"],[3,"icon","addclasses"],[1,"slds-input",3,"type","ngModel","placeholder","disabled","ngModelOptions","ngModelChange"],[3,"messages",4,"ngIf"],[1,"slds-size--2-of-12","slds-p-horizontal--xx-small","slds-p-vertical--small",2,"white-space","nowrap"],[1,"slds-button","slds-button--neutral","slds-p-horizontal--x-small",3,"disabled","click"],["size","medium",3,"icon"],["icon","copy","size","medium"],[1,"slds-p-horizontal--small","slds-p-vertical_medium","slds-size--1-of-1","slds-large-size--1-of-2","slds-grid","slds-grid--vertical"],[3,"disabled","ngModel","ngModelChange"],["label","LBL_AUTO_GENERATE"],["label","LBL_SEND_BY_EMAIL"],["label","LBL_FORCE_RESET"],[3,"ngModel","ngModelChange"],["label","LBL_EXT_AUTHENTICATE"],[1,"slds-p-top--x-small","slds-p-horizontal--x-small"],["label","LBL_PWD_GUIDELINE",2,"display","inline-block"],[3,"messages"]],template:function(e,s){1&e&&(h.DNE(0,De,4,1,"div",0),h.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),h.nrm(8,"system-utility-icon",8),h.j41(9,"input",9),h.mxI("ngModelChange",(function(e){return h.DH7(s.password,e)||(s.password=e),e})),h.k0s()(),h.DNE(10,Ce,1,1,"field-messages",10),h.k0s(),h.j41(11,"div",6)(12,"div",7),h.nrm(13,"system-utility-icon",8),h.j41(14,"input",9),h.mxI("ngModelChange",(function(e){return h.DH7(s.repeatPassword,e)||(s.repeatPassword=e),e})),h.k0s()(),h.DNE(15,Ie,1,1,"field-messages",10),h.k0s()(),h.j41(16,"div",11)(17,"button",12),h.bIt("click",(function(){return s.toggleShowPassword()})),h.nrm(18,"system-button-icon",13),h.k0s(),h.j41(19,"button",12),h.bIt("click",(function(){return s.copyPassword()})),h.nrm(20,"system-button-icon",14),h.k0s()()()()(),h.j41(21,"div",15)(22,"system-checkbox",16),h.mxI("ngModelChange",(function(e){return h.DH7(s.autoGenerate,e)||(s.autoGenerate=e),e})),h.bIt("ngModelChange",(function(){return s.emitChanges()})),h.nrm(23,"system-label",17),h.k0s(),h.j41(24,"system-checkbox",16),h.mxI("ngModelChange",(function(e){return h.DH7(s.sendByEmail,e)||(s.sendByEmail=e),e})),h.bIt("ngModelChange",(function(){return s.emitChanges()})),h.nrm(25,"system-label",18),h.k0s(),h.j41(26,"system-checkbox",16),h.mxI("ngModelChange",(function(e){return h.DH7(s.forceReset,e)||(s.forceReset=e),e})),h.bIt("ngModelChange",(function(){return s.emitChanges()})),h.nrm(27,"system-label",19),h.k0s(),h.j41(28,"system-checkbox",20),h.mxI("ngModelChange",(function(e){return h.DH7(s.externalAuthOnly,e)||(s.externalAuthOnly=e),e})),h.bIt("ngModelChange",(function(){return s.emitChanges()})),h.nrm(29,"system-label",21),h.k0s()()()),2&e&&(h.Y8G("ngIf",s.pwdGuideline),h.R7$(6),h.Y8G("ngClass",s.pwdFieldStyle),h.R7$(2),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("type",s.PwdFieldType),h.R50("ngModel",s.password),h.Y8G("placeholder",s.language.getLabel("MSG_ENTER_NEW_PASSWORD"))("disabled",s.autoGenerate||s.externalAuthOnly)("ngModelOptions",s.modelOptions),h.R7$(),h.Y8G("ngIf",!s.externalAuthOnly),h.R7$(),h.Y8G("ngClass",s.rePwdFieldStyle),h.R7$(2),h.Y8G("icon","lock")("addclasses","slds-input__icon slds-icon-text-default"),h.R7$(),h.Y8G("type",s.PwdFieldType),h.R50("ngModel",s.repeatPassword),h.Y8G("placeholder",s.language.getLabel("LBL_REPEAT_PWD"))("disabled",s.autoGenerate||s.externalAuthOnly)("ngModelOptions",s.modelOptions),h.R7$(),h.Y8G("ngIf",!s.externalAuthOnly),h.R7$(2),h.Y8G("disabled",s.externalauthonly),h.R7$(),h.Y8G("icon",s.showPassword?"hide":"preview"),h.R7$(),h.Y8G("disabled",!s.autoGenerate),h.R7$(3),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.autoGenerate),h.R7$(2),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.sendByEmail),h.R7$(2),h.Y8G("disabled",s.externalAuthOnly),h.R50("ngModel",s.forceReset),h.R7$(2),h.R50("ngModel",s.externalAuthOnly))},dependencies:[a.YU,a.bT,i.me,i.BC,i.vS,ye.A,S.t,w.f,L.W,G.B],encapsulation:2})}return UserCreatePassword})();var Pe=t(66589),Ae=t(22465);const xe=(e,s)=>s.id;function je(e,s){1&e&&h.nrm(0,"system-custom-icon",11)}function Oe(e,s){if(1&e){const e=h.RV6();h.j41(0,"tr",6)(1,"td")(2,"div"),h.EFF(3),h.k0s()(),h.j41(4,"td"),h.DNE(5,je,1,0,"system-custom-icon",7),h.nrm(6,"system-label",8),h.k0s(),h.j41(7,"td")(8,"system-checkbox",9),h.bIt("ngModelChange",(function(){const s=h.eBV(e).$implicit,t=h.XpG();return h.Njj(t.checkRole(s.id))})),h.k0s()(),h.j41(9,"td")(10,"system-input-radio",10),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.defaultRole,s)||(t.defaultRole=s),h.Njj(s)})),h.k0s()()()}if(2&e){const e=s.$implicit,t=h.XpG();let a;h.R7$(2),h.ZvI("slds-avatar slds-avatar--small slds-align--absolute-center ",e.icon,""),h.R7$(),h.SpI(" ",e.identifier," "),h.R7$(2),h.Y8G("ngIf",e.custom),h.R7$(),h.Y8G("label",null!==(a=e.label)&&void 0!==a?a:e.name),h.R7$(2),h.Y8G("value",e.id)("ngModel",t.roleChecked(e.id)),h.R7$(2),h.Y8G("disabled",!t.roleChecked(e.id))("value",e.id),h.R50("ngModel",t.defaultRole)}}let Fe=(()=>{class UserCreateRoles{constructor(e,s,t,a){this.model=e,this.modelutilities=s,this.backend=t,this.metadata=a,this.availableRoles=[],this.userRoles=[]}ngOnInit(){this.getRoles()}registerOnChange(e){this.onChange=s=>{e(s)}}registerOnTouched(e){this.onTouched=e}writeValue(e){void 0!==e&&(this.userRoles=e)}getRoles(){this.backend.getRequest("configuration/spiceui/core/roles/"+this.model.id).subscribe((e=>{this.availableRoles=e.allRoles.filter((e=>"a"==e.rolescope||this.scopefilter&&e.rolescope==this.scopefilter))}))}get defaultRole(){let e=this.userRoles.find((e=>e.default));return e?e.id:""}set defaultRole(e){this.defaultRole&&(this.userRoles.find((e=>e.default)).default=!1),this.userRoles.find((s=>s.id==e)).default=!0}roleChecked(e){return this.userRoles.findIndex((s=>s.id==e))>=0}checkRole(e){let s=this.userRoles.findIndex((s=>s.id==e));s>=0?this.userRoles.splice(s,1):this.userRoles.push({id:e,default:!1}),!this.defaultRole&&this.userRoles.length>0&&(this.userRoles[0].default=!0),this.onChange(this.userRoles)}static#e=this.ɵfac=function(e){return new(e||UserCreateRoles)(h.rXU(g.g),h.rXU(_e.g),h.rXU(y.H),h.rXU($.yu))};static#s=this.ɵcmp=h.VBU({type:UserCreateRoles,selectors:[["user-create-roles"]],inputs:{scopefilter:"scopefilter"},features:[h.Jv_([{provide:i.kq,useExisting:(0,h.Rfq)((()=>UserCreateRoles)),multi:!0}])],decls:11,vars:0,consts:[[1,"slds-table","slds-table_bordered"],[1,"slds-table--bordered","slds-text-align_center"],[1,"slds-text-title--caps"],[2,"width","2rem"],["label","LBL_NAME"],[2,"width","1rem"],[1,"slds-hint-parent"],["icon","custom","size","x-small","system-title","LBL_CUSTOM_ROLE",4,"ngIf"],[3,"label"],[3,"value","ngModel","ngModelChange"],["name","defaultrole",3,"disabled","value","ngModel","ngModelChange"],["icon","custom","size","x-small","system-title","LBL_CUSTOM_ROLE"],["class","slds-hint-parent"]],template:function(e,s){1&e&&(h.j41(0,"table",0)(1,"thead",1)(2,"tr",2),h.nrm(3,"th",3),h.j41(4,"th"),h.nrm(5,"system-label",4),h.k0s(),h.nrm(6,"th",5)(7,"th",5),h.k0s()(),h.j41(8,"tbody"),h.Z7z(9,Oe,11,11,"tr",12,xe),h.k0s()()),2&e&&(h.R7$(9),h.Dyx(s.availableRoles))},dependencies:[a.bT,i.BC,i.vS,w.f,ne.k,Pe.J,L.W,Ae.L],encapsulation:2})}return UserCreateRoles})();const Te=(e,s)=>s.id;function Ne(e,s){1&e&&h.nrm(0,"system-utility-icon",7)}function $e(e,s){if(1&e){const e=h.RV6();h.j41(0,"system-checkbox",8),h.bIt("ngModelChange",(function(){h.eBV(e);const s=h.XpG().$implicit,t=h.XpG();return h.Njj(t.checkProfile(s.id))})),h.k0s()}if(2&e){const e=h.XpG().$implicit,s=h.XpG();h.Y8G("value",e.id)("ngModel",s.profileChecked(e.id))}}function Xe(e,s){if(1&e&&(h.j41(0,"tr",5)(1,"td"),h.EFF(2),h.k0s(),h.j41(3,"td"),h.DNE(4,Ne,1,0,"system-utility-icon",6)(5,$e,1,2),h.k0s()()),2&e){const e=s.$implicit;h.R7$(2),h.SpI(" ",e.name," "),h.R7$(2),h.vxM(4,e.is_global?4:5)}}let Ye=(()=>{class UserCreateProfiles{constructor(e,s,t,a){this.model=e,this.modelutilities=s,this.backend=t,this.metadata=a,this.availableProfiles=[],this.userProfiles=[]}ngOnInit(){this.getACLProfiles()}registerOnChange(e){this.onChange=s=>{e(s)}}registerOnTouched(e){this.onTouched=e}writeValue(e){void 0!==e&&(this.userProfiles=e)}getACLProfiles(){this.backend.getRequest("module/SpiceACLProfiles",{limit:-99}).subscribe({next:e=>{this.availableProfiles=e.list.filter((e=>"a"==e.spiceaclprofilescope||this.scopefilter&&e.spiceaclprofilescope==this.scopefilter)).sort(((e,s)=>e.name.localeCompare(s.name)))}})}profileChecked(e){return this.userProfiles.indexOf(e)>=0}checkProfile(e){let s=this.userProfiles.indexOf(e);s>=0?this.userProfiles.splice(s,1):this.userProfiles.push(e),this.onChange(this.userProfiles)}static#e=this.ɵfac=function(e){return new(e||UserCreateProfiles)(h.rXU(g.g),h.rXU(_e.g),h.rXU(y.H),h.rXU($.yu))};static#s=this.ɵcmp=h.VBU({type:UserCreateProfiles,selectors:[["user-create-profiles"]],inputs:{scopefilter:"scopefilter"},features:[h.Jv_([{provide:i.kq,useExisting:(0,h.Rfq)((()=>UserCreateProfiles)),multi:!0}])],decls:9,vars:0,consts:[[1,"slds-table","slds-table_bordered"],[1,"slds-table--bordered","slds-text-align_center"],[1,"slds-text-title--caps"],["label","LBL_NAME"],[2,"width","2rem"],[1,"slds-hint-parent"],["class","slds-p-horizontal--xx-small","icon","world","size","xx-small"],["icon","world","size","xx-small",1,"slds-p-horizontal--xx-small"],[3,"value","ngModel","ngModelChange"],["class","slds-hint-parent"]],template:function(e,s){1&e&&(h.j41(0,"table",0)(1,"thead",1)(2,"tr",2)(3,"th"),h.nrm(4,"system-label",3),h.k0s(),h.nrm(5,"th",4),h.k0s()(),h.j41(6,"tbody"),h.Z7z(7,Xe,6,2,"tr",9,Te),h.k0s()()),2&e&&(h.R7$(7),h.Dyx(s.availableProfiles))},dependencies:[i.BC,i.vS,w.f,L.W,G.B],encapsulation:2})}return UserCreateProfiles})();const He=["addcontainer"];function Ve(e,s){if(1&e&&h.nrm(0,"system-progress-indicator-item",19),2&e){const e=s.$implicit,t=h.XpG();h.Y8G("value",e.value)("label",e.label)("status",t.getStatus(e.value))}}function ze(e,s){if(1&e){const e=h.RV6();h.j41(0,"button",20),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.next())})),h.nrm(1,"system-label",21),h.k0s()}}function We(e,s){if(1&e){const e=h.RV6();h.j41(0,"button",22),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.save())})),h.nrm(1,"system-label",23),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("disabled",!e.canSave)}}const qe=e=>({"slds-hide":e});let Je=(()=>{class UserCreateFromBeanModal{constructor(e,s,t,a,i,n,l,r,o,d,c){this.language=e,this.model=s,this.parent=t,this.modelutilities=a,this.toast=i,this.backend=n,this.view=l,this.cdr=r,this.metadata=o,this.configuration=d,this.modal=c,this.response=null,this.responseSubject=null,this.userNameCheck=new RegExp("^(?![_.])(?!.*[_.]{2})[@a-zA-Z0-9._-]{1,60}$"),this.sendByEmail=!1,this.forceReset=!0,this.systemGenerated=!0,this.externalAuthOnly=!1,this.canSendByEmail=!0,this.step="user",this.steps=[{value:"user",label:"LBL_USER"},{value:"role",label:"LBL_ROLE"},{value:"acl",label:"LBL_ACL"}],this.userRoles=[],this.userProfiles=[],this.model.module="Users",this.view.isEditable=!0,this.view.setEditMode(),this.responseSubject=new O.B,this.response=this.responseSubject.asObservable()}get modelOptions(){return{updateOn:"blur"}}get hasError(){let e=!0;this.model.validate()||(e=!1);let s=this.model.getField("user_name");return s&&!this.userNameCheck.test(s)&&(this.model.setFieldMessage("error",this.language.getLabel("MSG_USERNAME_NOT_LEGAL"),"user_name","validation"),e=!1),!e}ngOnInit(){this.model.initialize();let e={UserType:"RegularUser",status:"Active"};this.parent&&(e.user_name=this.parent.getField("email1"),e.email1=this.parent.getField("email1"),e.first_name=this.parent.getField("first_name"),e.last_name=this.parent.getField("last_name"),e.salutation=this.parent.getField("salutation")),this.model.setFields(e),this.getFieldSets()}get scopeFilter(){return"Employees"==this.parent.module?"i":"e"}getStatus(e){switch(e){case"user":return this.model.validate()?"complete":"error";case"role":return this.userRoles.length>0?"complete":"error";default:return""}}getFieldSets(){let e=this.metadata.getComponentConfig("UserCreateFromBeanModal","Users");this.fieldset=e.fieldset}cancel(){this.responseSubject.next(!1),this.responseSubject.complete(),this.self.destroy()}next(){let e=this.steps.findIndex((e=>e.value==this.step));this.steps.length>=e+1&&(this.step=this.steps[e+1].value)}get canSave(){return this.model.validate()&&this.userRoles.length>0}save(){this.model.setFields({parent_type:this.parent.module,parent_id:this.parent.id,system_generated_password:!this.externalAuthOnly&&this.systemGenerated,pwd_last_changed:new moment,external_auth_only:this.externalAuthOnly});let e={data:this.modelutilities.spiceModel2backend("Users",this.model.data),roles:this.userRoles,profiles:this.userProfiles,credentials:{newPassword:this.password,forceReset:this.forceReset,sendEmail:!!this.canSendByEmail&&this.sendByEmail}};this.backend.postRequest(`module/Users/${this.model.id}/create`,{},e).subscribe({next:e=>{this.self.destroy()},error:e=>{this.toast.sendToast("MSG_ERROR_CREATING_USER","error",e.error?.error?.message)}})}saveUser(){let e=this.modal.await("LBL_SAVING_USER");this.model.setFields({system_generated_password:!this.externalAuthOnly&&this.systemGenerated,pwd_last_changed:new moment,external_auth_only:this.externalAuthOnly});let s=this.modelutilities.spiceModel2backend("Users",this.model.data);this.backend.postRequest("module/Users/"+this.model.id,{},JSON.stringify(s)).subscribe({next:s=>{for(let e in s)s.hasOwnProperty(e)&&(s[e]=this.modelutilities.backend2spice("Users",e,s[e]));this.model.setData(s),this.model.endEdit(),this.saveRoles(),e.emit(!0)},error:s=>{e.emit(!0)}})}saveRoles(){let e=this.modal.await("LBL_SAVING_ROLES");this.backend.postRequest(`module/Users/${this.model.id}/roles`,{},this.userRoles).subscribe({next:()=>{this.userProfiles.length>0?this.saveACLProfiles():this.externalAuthOnly?this.self.destroy():this.savePassword(),e.emit(!0)},error:()=>{e.emit(!0)}})}saveACLProfiles(){let e=this.modal.await("LBL_SAVING_PROFILES");this.backend.postRequest(`module/Users/${this.model.id}/related/spiceaclprofiles`,{},this.userProfiles).subscribe({next:()=>{this.externalAuthOnly?this.self.destroy():this.savePassword(),e.emit(!0)},error:()=>{e.emit(!0)}})}savePassword(){let e=this.modal.await("LBL_SAVING_PASSWORD"),s={newPassword:this.password,forceReset:this.forceReset,sendEmail:!!this.canSendByEmail&&this.sendByEmail};this.backend.postRequest("module/Users/"+this.model.id+"/password/reset",{},s).subscribe((s=>{this.sendByEmail?this.toast.sendToast(this.language.getLabel("MSG_NEW_PASSWORD_EMAIL_SENT"),"success","",10):this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED"),"success"),e.emit(!0),this.self.destroy()}),(s=>{this.sendByEmail=!1,this.canSendByEmail=!1,this.toast.sendToast(this.language.getLabel("MSG_PASSWORD_RESET_FAILED"),"error"),e.emit(!0)}))}static#e=this.ɵfac=function(e){return new(e||UserCreateFromBeanModal)(h.rXU(u.B),h.rXU(g.g),h.rXU(g.g,4),h.rXU(_e.g),h.rXU(b.o),h.rXU(y.H),h.rXU(j.U),h.rXU(h.gRc),h.rXU($.yu),h.rXU(R.i),h.rXU(m.y))};static#s=this.ɵcmp=h.VBU({type:UserCreateFromBeanModal,selectors:[["usercreatefrombeanmodal"]],viewQuery:function(e,s){if(1&e&&h.GBs(He,7,h.c1b),2&e){let e;h.mGM(e=h.lsd())&&(s.addcontainer=e.first)}},features:[h.Jv_([g.g,j.U])],decls:23,vars:23,consts:[["size","large"],[3,"close"],["margin","none"],["addcontainer",""],[1,"slds-p-around--x-small",3,"ngClass"],["titlelabel","LBL_USER_PROFILE",3,"alwaysExpanded"],[3,"fieldset","direction"],["titlelabel","LBL_USER_PASSWORD",3,"alwaysExpanded"],[3,"ngModel","ngModelChange","forcereset","systemgenerated","sendbyemail","extauthonly"],[3,"ngClass"],[3,"ngModel","scopefilter","ngModelChange"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-grow","slds-text-align--left","slds-p-horizontal--small"],["system-progress-indicator-shade","",3,"ngModel","ngModelChange"],[3,"value","label","status",4,"ngFor","ngForOf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],["class","slds-button slds-button--brand",3,"click",4,"ngIf"],["class","slds-button slds-button--brand",3,"disabled","click",4,"ngIf"],[3,"value","label","status"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_NEXT"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.cancel()})),h.EFF(2),h.k0s(),h.j41(3,"system-modal-content",2,3)(5,"div",4)(6,"system-section",5),h.nrm(7,"object-record-fieldset",6),h.k0s(),h.j41(8,"system-section",7)(9,"user-create-password",8),h.mxI("ngModelChange",(function(e){return h.DH7(s.password,e)||(s.password=e),e})),h.bIt("forcereset",(function(){return s.forceReset}))("systemgenerated",(function(){return s.systemGenerated}))("sendbyemail",(function(){return s.sendByEmail}))("extauthonly",(function(){return s.externalAuthOnly})),h.k0s()()(),h.j41(10,"div",9)(11,"user-create-roles",10),h.mxI("ngModelChange",(function(e){return h.DH7(s.userRoles,e)||(s.userRoles=e),e})),h.k0s()(),h.j41(12,"div",9)(13,"user-create-profiles",10),h.mxI("ngModelChange",(function(e){return h.DH7(s.userProfiles,e)||(s.userProfiles=e),e})),h.k0s()()(),h.j41(14,"system-modal-footer")(15,"div",11)(16,"div",12)(17,"system-progress-indicator",13),h.mxI("ngModelChange",(function(e){return h.DH7(s.step,e)||(s.step=e),e})),h.DNE(18,Ve,1,3,"system-progress-indicator-item",14),h.k0s()(),h.j41(19,"button",15),h.bIt("click",(function(){return s.cancel()})),h.nrm(20,"system-label",16),h.k0s(),h.DNE(21,ze,2,0,"button",17)(22,We,2,1,"button",18),h.k0s()()()),2&e&&(h.R7$(2),h.JRh(s.model.module),h.R7$(3),h.Y8G("ngClass",h.eq3(17,qe,"user"!=s.step)),h.R7$(),h.Y8G("alwaysExpanded",!0),h.R7$(),h.Y8G("fieldset",s.fieldset)("direction","vertical"),h.R7$(),h.Y8G("alwaysExpanded",!0),h.R7$(),h.R50("ngModel",s.password),h.R7$(),h.Y8G("ngClass",h.eq3(19,qe,"role"!=s.step)),h.R7$(),h.R50("ngModel",s.userRoles),h.Y8G("scopefilter",s.scopeFilter),h.R7$(),h.Y8G("ngClass",h.eq3(21,qe,"acl"!=s.step)),h.R7$(),h.R50("ngModel",s.userProfiles),h.Y8G("scopefilter",s.scopeFilter),h.R7$(4),h.R50("ngModel",s.step),h.R7$(),h.Y8G("ngForOf",s.steps),h.R7$(3),h.Y8G("ngIf","acl"!=s.step),h.R7$(),h.Y8G("ngIf","acl"==s.step))},dependencies:[a.YU,a.Sq,a.bT,i.BC,i.vS,Re.D,L.W,v.D,U.I,k.Q,M.C,Ee.v,Me.Q,Ge.D,Be,Fe,Ye],encapsulation:2})}return UserCreateFromBeanModal})();var Qe=t(15091);function Ke(e,s){1&e&&(h.j41(0,"span",11),h.nrm(1,"system-utility-icon",12),h.k0s())}function Ze(e,s){if(1&e&&h.nrm(0,"img",13),2&e){const e=h.XpG();h.Y8G("src",e.userimage,h.B4B)}}const es=()=>({fieldtype:"fullname"});let ss=(()=>{class UserPopoverHeader{constructor(e,s,t){this.language=e,this.view=s,this.model=t,this.view.displayLabels=!1}get userimage(){return this.model.getField("user_image")}static#e=this.ɵfac=function(e){return new(e||UserPopoverHeader)(h.rXU(u.B),h.rXU(j.U),h.rXU(g.g))};static#s=this.ɵcmp=h.VBU({type:UserPopoverHeader,selectors:[["ng-component"]],features:[h.Jv_([j.U])],decls:12,vars:4,consts:[[1,"slds-media","slds-media_center","slds-m-bottom_small","slds-p-vertical--x-small"],[1,"slds-p-right--medium"],["class","slds-icon_container slds-icon-standard-empty slds-icon_container--circle","style","width:40px;height:40px;",4,"ngIf"],["style","height: 40px; width: 40px",3,"src",4,"ngIf"],[1,"slds-media__body"],[1,"slds-text-heading_small","slds-hyphenate"],["field","full_name","fielddisplayclass","slds-truncate",3,"fieldconfig"],[1,"slds-list_horizontal","slds-has-dividers_right"],[1,"slds-item"],["field","title","fielddisplayclass","slds-truncate"],["field","department","fielddisplayclass","slds-truncate"],[1,"slds-icon_container","slds-icon-standard-empty","slds-icon_container--circle",2,"width","40px","height","40px"],["icon","user","size","small","addclasses","slds-icon","colorclass",""],[2,"height","40px","width","40px",3,"src"]],template:function(e,s){1&e&&(h.j41(0,"header",0)(1,"div",1),h.DNE(2,Ke,2,0,"span",2)(3,Ze,1,1,"img",3),h.k0s(),h.j41(4,"div",4)(5,"h2",5),h.nrm(6,"field-container",6),h.k0s(),h.j41(7,"ul",7)(8,"li",8),h.nrm(9,"field-container",9),h.k0s(),h.j41(10,"li",8),h.nrm(11,"field-container",10),h.k0s()()()()),2&e&&(h.R7$(2),h.Y8G("ngIf",!s.userimage),h.R7$(),h.Y8G("ngIf",s.userimage),h.R7$(3),h.Y8G("fieldconfig",h.lJ4(3,es)))},dependencies:[a.bT,Qe.y,G.B],encapsulation:2})}return UserPopoverHeader})(),ts=(()=>{class UserDeactivateButton{constructor(e,s,t,a,i,n,l){this.language=e,this.modal=s,this.model=t,this.session=a,this.injector=i,this.backend=n,this.toast=l}get disabled(){return!this.session.isAdmin||"1"==this.model.id}execute(){"Active"==this.model.getField("status")?this.modal.openModal("UserDeactivateModal",!0,this.injector):this.modal.prompt("confirm",this.language.getLabel("MSG_ACTIVATE_USER","","long"),this.language.getLabel("MSG_ACTIVATE_USER")).subscribe((e=>{if(e){let e=this.modal.await(this.language.getLabel("LBL_ACTIVATING"));this.backend.postRequest(`module/Users/${this.model.id}/activate`).subscribe((s=>{this.model.getData(),e.emit(!0)}),(s=>{e.emit(!0),this.toast.sendToast("an Error occured deactivating the User","error")}))}}))}get actionLabel(){return"Active"==this.model.getField("status")?"LBL_DEACTIVATE":"LBL_ACTIVATE"}static#e=this.ɵfac=function(e){return new(e||UserDeactivateButton)(h.rXU(u.B),h.rXU(m.y),h.rXU(g.g),h.rXU(f.d),h.rXU(h.zZn),h.rXU(y.H),h.rXU(b.o))};static#s=this.ɵcmp=h.VBU({type:UserDeactivateButton,selectors:[["ng-component"]],decls:2,vars:1,consts:[[3,"label"]],template:function(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",0),h.k0s()),2&e&&(h.R7$(),h.Y8G("label",s.actionLabel))},dependencies:[L.W],encapsulation:2})}return UserDeactivateButton})();var as=t(44985),is=t(42205),ns=t(18359),ls=t(68823);function rs(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",1)(1,"div",7)(2,"span",8)(3,"span",9),h.nrm(4,"system-icon",10),h.k0s(),h.j41(5,"span",11),h.EFF(6),h.k0s(),h.j41(7,"button",12),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.clearField())})),h.nrm(8,"system-button-icon",13),h.k0s()()()()}if(2&e){const e=h.XpG();h.R7$(4),h.Y8G("size","small"),h.R7$(2),h.JRh(e.selectedItem.full_name),h.R7$(2),h.Y8G("icon","close")}}function os(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",14)(1,"input",15),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.searchWithModal())})),h.k0s(),h.j41(2,"button",16),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.searchWithModal())})),h.nrm(3,"system-button-icon",13),h.k0s()()}if(2&e){const e=h.XpG();h.R7$(),h.Y8G("placeholder",e.placeholder),h.R7$(2),h.Y8G("icon","search")}}let ds=(()=>{class UserDeactivateSelectUser{constructor(e,s,t,a){this.language=e,this.metadata=s,this.model=t,this.modal=a,this.subscriptions=new ns.yU,this.userid$=new h.bkB}ngOnDestroy(){this.subscriptions.unsubscribe()}get placeholder(){return this.language.getModuleCombinedLabel("LBL_SEARCH","Users")}searchWithModal(){this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module="Users",e.instance.multiselect=!1,this.subscriptions.add(e.instance.selectedItems.subscribe((e=>{e.length&&(this.selectedItem=e[0],this.userid$.emit(this.selectedItem.id))})))}))}clearField(){this.selectedItem=void 0}static#e=this.ɵfac=function(e){return new(e||UserDeactivateSelectUser)(h.rXU(u.B),h.rXU($.yu),h.rXU(g.g),h.rXU(m.y))};static#s=this.ɵcmp=h.VBU({type:UserDeactivateSelectUser,selectors:[["user-deactivate-select-user"]],outputs:{userid$:"userid$"},decls:7,vars:2,consts:[[1,"slds-form-element"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],["module","Users",3,"size"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare",3,"placeholder","click"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"click"]],template:function(e,s){1&e&&(h.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),h.DNE(5,rs,9,3,"div",5)(6,os,4,2,"div",6),h.k0s()()()()()),2&e&&(h.R7$(5),h.Y8G("ngIf",s.selectedItem),h.R7$(),h.Y8G("ngIf",!s.selectedItem))},dependencies:[a.bT,S.t,ls.J],encapsulation:2})}return UserDeactivateSelectUser})();function cs(e,s){if(1&e){const e=h.RV6();h.j41(0,"tr",23)(1,"td")(2,"system-checkbox",24),h.mxI("ngModelChange",(function(s){const t=h.eBV(e).$implicit;return h.DH7(t.reassign,s)||(t.reassign=s),h.Njj(s)})),h.k0s()(),h.j41(3,"td")(4,"div",25),h.nrm(5,"system-label-modulename",26),h.k0s()(),h.j41(6,"td")(7,"div",25),h.EFF(8),h.k0s()()()}if(2&e){const e=s.$implicit,t=h.XpG();h.R7$(2),h.Y8G("disabled",!t.reassignRecords||0==e.count),h.R50("ngModel",e.reassign),h.R7$(3),h.Y8G("module",e.sysmoduleid),h.R7$(3),h.JRh(e.count)}}function hs(e,s){1&e&&h.nrm(0,"tbody",27),2&e&&h.Y8G("select",!0)("tools",!1)}const us=e=>({"slds-hidden":e});let ms=(()=>{class UserDeactivateModal{constructor(e,s,t,a,i){this.model=e,this.modal=s,this.language=t,this.backend=a,this.toast=i,this.objects=[],this.loading=!0,this.reassignRecords=!1,this.totalrecords=0,this.newuserid="",this.getUserObjects()}getUserObjects(){this.backend.getRequest(`module/Users/${this.model.id}/deactivate`).subscribe((e=>{for(let s in e)this.objects.push({sysmoduleid:s,count:parseInt(e[s].totalcount,10),reassign:parseInt(e[s].totalcount,10)>0}),this.totalrecords+=parseInt(e[s].totalcount,10);this.totalrecords>0&&(this.reassignRecords=!0),this.loading=!1}),(e=>{this.loading=!1}))}get canReassign(){return this.totalrecords>0}get canSubmit(){return!(this.reassignRecords&&!this.newuserid)}deactivate(){let e=[],s={};if(this.newuserid){s.modules=[];for(let s of this.objects.filter((e=>e.reassign)))e.push(s.sysmoduleid);s.newuserid=this.newuserid}let t=this.modal.await(this.language.getLabel("LBL_DEACTIVATING"));this.backend.postRequest(`module/Users/${this.model.id}/deactivate`,{},s).subscribe((e=>{this.model.getData(),t.emit(!0),this.close()}),(e=>{t.emit(!0),this.toast.sendToast("an Error occured deactivating the User","error")}))}close(){this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||UserDeactivateModal)(h.rXU(g.g),h.rXU(m.y),h.rXU(u.B),h.rXU(y.H),h.rXU(b.o))};static#s=this.ɵcmp=h.VBU({type:UserDeactivateModal,selectors:[["ng-component"]],decls:29,vars:9,consts:[[3,"close"],["label","MSG_USER_DEACTIVATE"],["margin","none"],[1,"slds-p-around--small"],["label","MSG_USER_DEACTIVATE","length","long"],[1,"slds-p-top--small","slds-grid","slds-grid--vertical-align-center"],[1,"slds-p-right--small",3,"disabled","ngModel","ngModelChange"],["label","MSG_REASSIGN_RECORDS"],[2,"min-width","300px",3,"ngClass","userid$"],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered"],[1,"slds-line-height_reset"],["scope","col",1,"slds-text-align_right",2,"width","3.25rem"],["scope","col",1,""],["system-title","LBL_MODULE",1,"slds-truncate"],["label","LBL_MODULE"],["system-title","LBL_COUNT",1,"slds-truncate"],["label","LBL_COUNT"],["class","slds-hint-parent",4,"ngFor","ngForOf"],["system-table-stencils","","columns","2","rows","5",3,"select","tools",4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_DEACTIVATE"],[1,"slds-hint-parent"],[3,"disabled","ngModel","ngModelChange"],[1,"slds-truncate"],[3,"module"],["system-table-stencils","","columns","2","rows","5",3,"select","tools"]],template:function(e,s){1&e&&(h.j41(0,"system-modal")(1,"system-modal-header",0),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",1),h.k0s(),h.j41(3,"system-modal-content",2)(4,"div",3),h.nrm(5,"system-label",4),h.j41(6,"div",5)(7,"system-checkbox",6),h.mxI("ngModelChange",(function(e){return h.DH7(s.reassignRecords,e)||(s.reassignRecords=e),e})),h.nrm(8,"system-label",7),h.EFF(9),h.k0s(),h.j41(10,"user-deactivate-select-user",8),h.bIt("userid$",(function(e){return s.newuserid=e})),h.k0s()()(),h.j41(11,"table",9)(12,"thead")(13,"tr",10),h.nrm(14,"th",11),h.j41(15,"th",12)(16,"div",13),h.nrm(17,"system-label",14),h.k0s()(),h.j41(18,"th",12)(19,"div",15),h.nrm(20,"system-label",16),h.k0s()()()(),h.j41(21,"tbody"),h.DNE(22,cs,9,4,"tr",17),h.k0s(),h.DNE(23,hs,1,2,"tbody",18),h.k0s()(),h.j41(24,"system-modal-footer")(25,"button",19),h.bIt("click",(function(){return s.close()})),h.nrm(26,"system-label",20),h.k0s(),h.j41(27,"button",21),h.bIt("click",(function(){return s.deactivate()})),h.nrm(28,"system-label",22),h.k0s()()()),2&e&&(h.R7$(7),h.Y8G("disabled",!s.canReassign),h.R50("ngModel",s.reassignRecords),h.R7$(2),h.SpI(" (",s.totalrecords,")"),h.R7$(),h.Y8G("ngClass",h.eq3(7,us,!s.reassignRecords)),h.R7$(12),h.Y8G("ngForOf",s.objects),h.R7$(),h.Y8G("ngIf",s.loading),h.R7$(4),h.Y8G("disabled",!s.canSubmit))},dependencies:[a.YU,a.Sq,a.bT,i.BC,i.vS,w.f,L.W,as.r,v.D,U.I,k.Q,M.C,is.t,Ae.L,ds],encapsulation:2})}return UserDeactivateModal})(),gs=(()=>{class UserSignature{constructor(e,s,t){this.backend=e,this.view=s,this.broadcast=t,this.preferences={}}static#e=this.ɵfac=function(e){return new(e||UserSignature)(h.rXU(y.H),h.rXU(j.U),h.rXU(N.m))};static#s=this.ɵcmp=h.VBU({type:UserSignature,selectors:[["user-signature"]],features:[h.Jv_([j.U])],decls:29,vars:4,consts:[[1,"slds-section-title--divider"],[1,"slds-p-around--small"],[1,"slds-grid","slds-grid--align-spread"],[1,"slds-form-element","slds-size--1-of-2","slds-p-around--x-small"],[1,"slds-form-element__label"],[1,"slds-form-element__control","slds-has-divider--bottom"],[1,"slds-form-element__static"],[1,"slds-form-element","slds-size--1-of-2","slds-m-around--x-small"]],template:function(e,s){1&e&&(h.j41(0,"h3",0),h.EFF(1,"User Signature"),h.k0s(),h.j41(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),h.EFF(6,"Export Delimiter"),h.k0s(),h.j41(7,"div",5)(8,"span",6),h.EFF(9),h.k0s()()(),h.j41(10,"div",3)(11,"label",4),h.EFF(12,"Timezone"),h.k0s(),h.j41(13,"div",5)(14,"span",6),h.EFF(15),h.k0s()()()(),h.j41(16,"div",2)(17,"div",7)(18,"label",4),h.EFF(19,"Date Format"),h.k0s(),h.j41(20,"div",5)(21,"span",6),h.EFF(22),h.k0s()()(),h.j41(23,"div",7)(24,"label",4),h.EFF(25,"Time Format"),h.k0s(),h.j41(26,"div",5)(27,"span",6),h.EFF(28),h.k0s()()()()()),2&e&&(h.R7$(9),h.JRh(s.preferences.export_delimiter),h.R7$(6),h.JRh(s.preferences.timezone),h.R7$(7),h.JRh(s.preferences.datef),h.R7$(6),h.JRh(s.preferences.timef))},encapsulation:2})}return UserSignature})();var ps=t(66935);function bs(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",11),h.k0s())}function fs(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",12),h.k0s())}function _s(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",13),h.k0s())}function ys(e,s){1&e&&(h.j41(0,"span"),h.nrm(1,"system-label",14),h.k0s())}function Rs(e,s){1&e&&(h.j41(0,"span",15),h.EFF(1," ( "),h.nrm(2,"system-label",16),h.EFF(3," ) "),h.k0s())}function Es(e,s){if(1&e&&(h.j41(0,"div",4)(1,"label",5),h.nrm(2,"system-label",6),h.k0s(),h.j41(3,"field-generic-display",7),h.DNE(4,bs,2,0,"span",8)(5,fs,2,0,"span",8)(6,_s,2,0,"span",8)(7,ys,2,0,"span",9)(8,Rs,4,0,"span",10),h.k0s()()),2&e){const e=h.XpG();h.R7$(3),h.Y8G("ngSwitch",null!=e.system2FAConfig&&e.system2FAConfig.require_on?null==e.system2FAConfig?null:e.system2FAConfig.method:null==e.model.data?null:e.model.data.user_2fa_method)("editable",!(null!=e.system2FAConfig&&e.system2FAConfig.require_on)),h.R7$(),h.Y8G("ngSwitchCase","one_time_password"),h.R7$(),h.Y8G("ngSwitchCase","sms"),h.R7$(),h.Y8G("ngSwitchCase","email"),h.R7$(2),h.Y8G("ngIf",!!e.system2FAConfig.require_on)}}function Ss(e,s){if(1&e&&(h.j41(0,"option",27),h.nrm(1,"system-label",28),h.k0s()),2&e){const e=s.$implicit;h.Y8G("value",e.value),h.R7$(),h.Y8G("label",e.label)}}function ws(e,s){if(1&e){const e=h.RV6();h.j41(0,"div",4)(1,"label",5),h.nrm(2,"system-label",6),h.k0s(),h.j41(3,"div",17)(4,"div",18)(5,"select",19),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.model.data.user_2fa_method,s)||(t.model.data.user_2fa_method=s),h.Njj(s)})),h.bIt("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.Njj(t.handleMethodChange(s))})),h.j41(6,"option",20),h.nrm(7,"system-label",14),h.k0s(),h.DNE(8,Ss,2,2,"option",21),h.k0s()()()(),h.j41(9,"div",22)(10,"button",23),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.model.cancelEdit())})),h.nrm(11,"system-label",24),h.k0s(),h.j41(12,"button",25),h.bIt("click",(function(){h.eBV(e);const s=h.XpG();return h.Njj(s.save())})),h.nrm(13,"system-label",26),h.k0s()()}if(2&e){const e=h.XpG();h.R7$(5),h.R50("ngModel",e.model.data.user_2fa_method),h.R7$(3),h.Y8G("ngForOf",e.methods)}}let Ls=(()=>{class User2FAConfiguration{constructor(e,s,t,a,i,n,l){this.model=e,this.backend=s,this.toast=t,this.modal=a,this.language=i,this.injector=n,this.view=l,this.isLoading=!1,this.methods=[{label:"LBL_TOTP_AUTHENTICATION",value:"one_time_password"}]}ngOnInit(){this.view.linkedToModel=!0,this.view.isEditable=!0,this.loadConfig()}loadConfig(){this.isLoading=!0,this.backend.getRequest("configuration/configurator/editor/user_login_2fa").subscribe((e=>{this.isLoading=!1,e.sms_mailbox_id&&this.methods.push({label:"LBL_SMS",value:"sms"}),e.email_mailbox_id&&this.methods.push({label:"LBL_EMAIL",value:"email"}),this.system2FAConfig=e,this.system2FAConfig.require_on&&(this.view.isEditable=!1)}))}save(){this.isLoading||this.system2FAConfig.require_on||this.model.save(!0)}handleMethodChange(e){return"one_time_password"==e&&this.handleOneTimePassword(),"email"!=e||this.model.data.email1?"sms"!=e||this.model.data.phone_mobile?void 0:(this.model.data.user_2fa_method=void 0,this.toast.sendToast("MSG_MOBILE_PHONE_REQUIRED")):(this.model.data.user_2fa_method=void 0,this.toast.sendToast("MSG_EMAIL_ADDRESS_REQUIRED"))}handleOneTimePassword(){const e=this.modal.await(this.language.getLabel("MSG_TOTP_STATUSCHECK"));this.backend.getRequest("authentication/totp",{onBehalfUserId:this.model.id}).subscribe({next:s=>{e.emit(!0),s.active||this.generateOneTimePassword()},error:()=>{this.model.data.user_2fa_method=void 0,e.emit(!0)}})}generateOneTimePassword(){this.modal.openModal("TOTPAuthenticationGenerateModal",!0,this.injector).subscribe((e=>{e.instance.onBehalfUserId=this.model.id,e.instance.response.subscribe({next:e=>{e||(this.model.data.user_2fa_method=void 0)}})}))}static#e=this.ɵfac=function(e){return new(e||User2FAConfiguration)(h.rXU(g.g),h.rXU(y.H),h.rXU(b.o),h.rXU(m.y),h.rXU(u.B),h.rXU(h.zZn),h.rXU(j.U))};static#s=this.ɵcmp=h.VBU({type:User2FAConfiguration,selectors:[["user-2fa-configuration"]],features:[h.Jv_([j.U])],decls:5,vars:3,consts:[[1,"slds-box","slds-m-around--small","slds-p-around--none"],["tabtitle","LBL_2FA_CONFIGURATION",1,"slds-m-around--small","spice-display-block",3,"system-overlay-loading-spinner"],["class","slds-form-element slds-size--1-of-4 slds-m-top--small",4,"ngIf","ngIfElse"],["editModel",""],[1,"slds-form-element","slds-size--1-of-4","slds-m-top--small"],[1,"slds-form-element__label"],["label","LBL_METHOD"],[3,"ngSwitch","editable"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","slds-m-left--xx-small",4,"ngIf"],["label","LBL_TOTP_AUTHENTICATION"],["label","LBL_SMS"],["label","LBL_EMAIL"],["label","LBL_NONE"],[1,"slds-m-left--xx-small"],["label","LBL_SET_BY_SYSTEM_ADMINISTRATOR"],[1,"slds-form-element__control"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"slds-grid","slds-p-vertical--large"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[3,"value"],[3,"label"]],template:function(e,s){if(1&e&&(h.j41(0,"div",0)(1,"system-collapsable-tab",1),h.DNE(2,Es,9,6,"div",2)(3,ws,14,2,"ng-template",null,3,h.C5r),h.k0s()()),2&e){const e=h.sdS(4);h.R7$(),h.Y8G("system-overlay-loading-spinner",s.isLoading),h.R7$(),h.Y8G("ngIf",!s.view.isEditMode())("ngIfElse",e)}},dependencies:[a.Sq,a.bT,a.ux,a.e1,a.fG,i.xH,i.y7,i.wz,i.BC,i.vS,ps.K,X.p,L.W,D.M],encapsulation:2})}return User2FAConfiguration})();const vs=["systemPreferencesPanel"];function Us(e,s){if(1&e&&(h.j41(0,"span"),h.EFF(1),h.k0s()),2&e){const e=h.XpG();h.R7$(),h.JRh(e.homeDashboardData.name)}}function ks(e,s){if(1&e&&(h.j41(0,"option",26),h.EFF(1),h.k0s()),2&e){const e=s.$implicit;h.Y8G("value",e.id),h.R7$(),h.JRh(e.name)}}function Ms(e,s){if(1&e&&(h.j41(0,"span"),h.EFF(1),h.k0s()),2&e){const e=h.XpG();h.R7$(),h.JRh(e.homeDashboardSetData.name)}}function Gs(e,s){if(1&e&&(h.j41(0,"option",26),h.EFF(1),h.k0s()),2&e){const e=s.$implicit;h.Y8G("value",e.id),h.R7$(),h.JRh(e.name)}}function Ds(e,s){1&e&&h.nrm(0,"system-label",19)}function Cs(e,s){1&e&&h.nrm(0,"system-label",21)}let Is=(()=>{class UserPreferencesModal{constructor(e,s,t,a,i,n,l,r,o,d,c){this.backend=e,this.view=s,this.toast=t,this.currency=a,this.modal=i,this.language=n,this.preferencesService=l,this.session=r,this.broadcast=o,this.configuration=d,this.metadata=c,this.preferences={},this.names=["calendar_day_start_hour","calendar_day_end_hour","currency","datef","dec_sep","currency_significant_digits","export_charset","locale_name_format","distance_unit_system","export_delimiter","help_icon","home_dashboard","home_dashboardset","home_assistant","num_grp_sep","reminder_time","timef","timezone","week_day_start","week_days_count"],this.defaultDashboardPlaceHolder={},this.defaultDashboardSetPlaceHolder={},this.dashboardSets=[],this.dashboardSetData={},this.homeDashboardData={},this.homeDashboardSetData={},this.dashboards=[],this.loadedSubscription=new O.B,this.isLoading=!0,this.loadInitialValues(),this.view.setEditMode()}ngOnDestroy(){this.subscriptions.unsubscribe()}close(){this.self.destroy()}loadInitialValues(){this.view.isEditable=!0,this.loadDasboardPlaceHolder(),this.loadDashboardSetPlaceHolder(),this.loadDashboardsLists(),this.loadPreferences()}loadDasboardPlaceHolder(){this.defaultDashboardPlaceHolder={id:"",name:this.language.getLabel("LBL_ROLE_DEFAULT_DASHBOARD")}}loadDashboardSetPlaceHolder(){this.defaultDashboardSetPlaceHolder={id:"",name:this.language.getLabel("LBL_ROLE_DEFAULT_DASHBOARDSET")}}loadPreferences(){this.subscriptions=this.loadedSubscription.subscribe({next:()=>{this.isLoading=!1,this.preferences=_.pick(this.preferencesService.unchangedPreferences.global,this.names),this.setHomeDashboardSetData(this.preferences.home_dashboardset),this.setHomeDashboardData(this.preferences.home_dashboard)}}),this.preferencesService.getPreferences(this.loadedSubscription)}loadDashboardsLists(){this.backend.getList("Dashboards",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe((e=>{this.dashboards=[].concat(this.dashboards,this.defaultDashboardPlaceHolder,e.list),this.setHomeDashboardData(this.preferences.home_dashboard)})),this.backend.getList("DashboardSets",[{sortfield:"name",sortdirection:"DESC"}],{limit:-99}).subscribe((e=>{this.dashboardSets=[].concat(this.dashboardSets,this.defaultDashboardSetPlaceHolder,e.list),this.setHomeDashboardSetData(this.preferences.home_dashboardset)}))}setHomeDashboardData(e){this.homeDashboardData=this.dashboards.find((s=>s.id==e))}setHomeDashboardSetData(e){this.homeDashboardSetData=this.dashboardSets.find((s=>s.id==e))}save(){let e=this.modal.await("LBL_SAVING");this.preferencesService.setPreferences(this.preferences).subscribe({next:()=>{this.toast.sendToast(this.language.getLabel("LBL_DATA_SAVED"),"success"),this.preferences=_.pick(this.preferencesService.unchangedPreferences.global,this.names),this.broadcast.broadcastMessage("userpreferences.save"),e.emit(!0),this.close()}})}static#e=this.ɵfac=function(e){return new(e||UserPreferencesModal)(h.rXU(y.H),h.rXU(j.U),h.rXU(b.o),h.rXU(F.G),h.rXU(m.y),h.rXU(u.B),h.rXU(T.S),h.rXU(f.d),h.rXU(N.m),h.rXU(R.i),h.rXU($.yu))};static#s=this.ɵcmp=h.VBU({type:UserPreferencesModal,selectors:[["user-preferences-modal"]],viewQuery:function(e,s){if(1&e&&h.GBs(vs,5),2&e){let e;h.mGM(e=h.lsd())&&(s.systemPreferencesPanel=e.first)}},features:[h.Jv_([j.U])],decls:40,vars:14,consts:[[3,"close"],["label","LBL_PREFERENCES"],["margin","none"],[3,"system-overlay-loading-spinner"],[3,"preferences","isPersonalContext"],["systemPreferencesPanel",""],["tabtitle","LBL_HOME_PREFERENCES",3,"collapsible"],[1,"slds-grid"],["itemlabel","LBL_HOME_DASHBOARD",1,"slds-size--1-of-3"],[4,"ngIf"],[1,"slds-select_container"],[1,"slds-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["itemlabel","LBL_HOME_DASHBOARDSET",1,"slds-size--1-of-3"],["itemlabel","LBL_HOME_ASSISTANT",1,"slds-size--1-of-3"],[3,"global"],["label","LBL_VISIBLE",4,"ngIf"],["label","LBL_HIDDEN",4,"ngIf"],["value","visible"],["label","LBL_VISIBLE"],["value","hidden"],["label","LBL_HIDDEN"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand","slds-button-space-left",3,"click"],["label","LBL_SAVE"],[3,"value"]],template:function(e,s){if(1&e){const e=h.RV6();h.j41(0,"system-modal")(1,"system-modal-header",0),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",1),h.k0s(),h.j41(3,"system-modal-content",2)(4,"div",3),h.nrm(5,"system-preferences-panel",4,5),h.j41(7,"system-collapsable-tab",6)(8,"div",7)(9,"system-preferences-panel-item",8)(10,"system-preferences-panel-item-display"),h.DNE(11,Us,2,1,"span",9),h.k0s(),h.j41(12,"system-preferences-panel-item-edit")(13,"div",10)(14,"select",11),h.mxI("ngModelChange",(function(e){return h.DH7(s.preferences.home_dashboard,e)||(s.preferences.home_dashboard=e),e})),h.bIt("ngModelChange",(function(e){return s.setHomeDashboardData(e)})),h.DNE(15,ks,2,2,"option",12),h.k0s()()()(),h.j41(16,"system-preferences-panel-item",13)(17,"system-preferences-panel-item-display"),h.DNE(18,Ms,2,1,"span",9),h.k0s(),h.j41(19,"system-preferences-panel-item-edit")(20,"div",10)(21,"select",11),h.mxI("ngModelChange",(function(e){return h.DH7(s.preferences.home_dashboardset,e)||(s.preferences.home_dashboardset=e),e})),h.bIt("ngModelChange",(function(e){return s.setHomeDashboardSetData(e)})),h.DNE(22,Gs,2,2,"option",12),h.k0s()()()(),h.j41(23,"system-preferences-panel-item",14)(24,"system-preferences-panel-item-display",15),h.DNE(25,Ds,1,0,"system-label",16)(26,Cs,1,0,"system-label",17),h.k0s(),h.j41(27,"system-preferences-panel-item-edit")(28,"div",10)(29,"select",11),h.mxI("ngModelChange",(function(e){return h.DH7(s.preferences.home_assistant,e)||(s.preferences.home_assistant=e),e})),h.bIt("ngModelChange",(function(){h.eBV(e);const s=h.sdS(6);return h.Njj(s.prefChanged())})),h.nrm(30,"option"),h.j41(31,"option",18),h.nrm(32,"system-label",19),h.k0s(),h.j41(33,"option",20),h.nrm(34,"system-label",21),h.k0s()()()()()()()()(),h.j41(35,"system-modal-footer")(36,"button",22),h.bIt("click",(function(){return s.close()})),h.nrm(37,"system-label",23),h.k0s(),h.j41(38,"button",24),h.bIt("click",(function(){return s.save()})),h.nrm(39,"system-label",25),h.k0s()()()}if(2&e){const e=h.sdS(6);h.R7$(4),h.Y8G("system-overlay-loading-spinner",s.isLoading),h.R7$(),h.Y8G("preferences",s.preferences)("isPersonalContext",!0),h.R7$(2),h.Y8G("collapsible",!1),h.R7$(4),h.Y8G("ngIf",s.homeDashboardData&&s.homeDashboardData.name),h.R7$(3),h.R50("ngModel",s.preferences.home_dashboard),h.R7$(),h.Y8G("ngForOf",s.dashboards),h.R7$(3),h.Y8G("ngIf",s.homeDashboardSetData&&s.homeDashboardSetData.name),h.R7$(3),h.R50("ngModel",s.preferences.home_dashboardset),h.R7$(),h.Y8G("ngForOf",s.dashboardSets),h.R7$(2),h.Y8G("global",e.prefValueIsGlobalFallback("home_assistant")),h.R7$(),h.Y8G("ngIf","visible"===e.getPrefValue("home_assistant")),h.R7$(),h.Y8G("ngIf","hidden"===e.getPrefValue("home_assistant")),h.R7$(3),h.R50("ngModel",s.preferences.home_assistant)}},dependencies:[a.Sq,a.bT,i.xH,i.y7,i.wz,i.BC,i.vS,X.p,L.W,v.D,U.I,k.Q,M.C,Y.w,H.x,V.J,z.t,D.M],encapsulation:2})}return UserPreferencesModal})();var Bs=t(34411);let Ps=(()=>{class UserSignatureModal{constructor(e,s,t){this.backend=e,this.session=s,this.modal=t,this.signature=this.session.authData.user.email_signature}get canSave(){return this.signature!=this.session.authData.user.email_signature}save(){let e=this.modal.await("LBL_SAVING");this.backend.postRequest(`module/Users/${this.session.authData.userId}/signature`,{},{signature:this.signature}).subscribe({next:()=>{this.session.authData.user.email_signature=this.signature,this.close(),e.emit(!0)}})}close(){this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||UserSignatureModal)(h.rXU(y.H),h.rXU(f.d),h.rXU(m.y))};static#s=this.ɵcmp=h.VBU({type:UserSignatureModal,selectors:[["user-signature-modal"]],decls:10,vars:3,consts:[["size","large"],[3,"close"],["label","LBL_EMAIL_SIGNATURE"],["margin","none"],["innerheight","550px",3,"ngModel","extendedmode","ngModelChange"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand","slds-button-space-left",3,"disabled","click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",2),h.k0s(),h.j41(3,"system-modal-content",3)(4,"system-richtext-editor",4),h.mxI("ngModelChange",(function(e){return h.DH7(s.signature,e)||(s.signature=e),e})),h.k0s()(),h.j41(5,"system-modal-footer")(6,"button",5),h.bIt("click",(function(){return s.close()})),h.nrm(7,"system-label",6),h.k0s(),h.j41(8,"button",7),h.bIt("click",(function(){return s.save()})),h.nrm(9,"system-label",8),h.k0s()()()),2&e&&(h.R7$(4),h.R50("ngModel",s.signature),h.Y8G("extendedmode",!1),h.R7$(4),h.Y8G("disabled",!s.canSave))},dependencies:[i.BC,i.vS,L.W,v.D,U.I,k.Q,M.C,Bs.K],encapsulation:2})}return UserSignatureModal})();function As(e,s){if(1&e){const e=h.RV6();h.j41(0,"system-input-radio",13),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.user_2fa_method,s)||(t.user_2fa_method=s),h.Njj(s)})),h.nrm(1,"system-label",14),h.EFF(2),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("disabled","sms"==e.currentMethod),h.R50("ngModel",e.user_2fa_method),h.R7$(2),h.SpI(" (",e.phoneMobile,")")}}function xs(e,s){if(1&e){const e=h.RV6();h.j41(0,"system-input-radio",15),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.user_2fa_method,s)||(t.user_2fa_method=s),h.Njj(s)})),h.nrm(1,"system-label",16),h.EFF(2),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("disabled","email"==e.currentMethod),h.R50("ngModel",e.user_2fa_method),h.R7$(2),h.SpI(" (",e.email,")")}}function js(e,s){if(1&e){const e=h.RV6();h.j41(0,"system-input-radio",17),h.mxI("ngModelChange",(function(s){h.eBV(e);const t=h.XpG();return h.DH7(t.user_2fa_method,s)||(t.user_2fa_method=s),h.Njj(s)})),h.nrm(1,"system-label",18),h.k0s()}if(2&e){const e=h.XpG();h.Y8G("disabled","none"==e.currentMethod),h.R50("ngModel",e.user_2fa_method)}}let Os=(()=>{class UserSet2FAModal{constructor(e,s,t,a){this.config=e,this.session=s,this.modal=t,this.backend=a,this.capabilityConfig=this.config.getCapabilityConfig("login"),this.currentMethod&&(this.user_2fa_method=this.currentMethod)}get smsEnabled(){return this.capabilityConfig.twofactor.sms}get emailEnabled(){return this.capabilityConfig.twofactor.email}get candelete(){return!this.capabilityConfig.twofactor.onlogin.enforced}get currentMethod(){return this.session.authData.user.user_2fa_method?this.session.authData.user.user_2fa_method:"none"}get phoneMobile(){return this.session.authData.user.phone_mobile}get email(){return this.session.authData.user.email1}close(){this.self.destroy()}get canSave(){return this.user_2fa_method!=this.currentMethod}save(){switch(this.user_2fa_method){case"one_time_password":this.modal.openModal("TOTPAuthenticationGenerateModal"),this.close();break;case"sms":case"email":let e=this.modal.await("LBL_SENDING_TOKEN");this.backend.getRequest(`authentication/2fa/${this.user_2fa_method}`).subscribe({next:s=>{e.emit(!0),this.validate2FAToken()},error:()=>{e.emit(!0),this.close()}});break;case"none":if("sms"==this.currentMethod||"email"==this.currentMethod){let e=this.modal.await("LBL_SENDING_TOKEN");this.backend.getRequest(`authentication/2fa/${this.currentMethod}`).subscribe({next:s=>{e.emit(!0),this.delete2FASettings()},error:()=>{e.emit(!0),this.close()}})}else this.delete2FASettings()}}validate2FAToken(){this.modal.prompt("input","MSG_ENTER_FA_TOKEN","MSG_ENTER_FA_TOKEN").subscribe({next:e=>{if(e){let s=this.modal.await("LBL_VALIDATING");this.backend.putRequest(`authentication/2fa/${this.user_2fa_method}/${e}`).subscribe({next:e=>{s.emit(!0),e.success?(this.session.authData.user.user_2fa_method=this.user_2fa_method,this.close()):this.validate2FAToken()},error:e=>{s.emit(!0),this.validate2FAToken()}})}else this.close()}})}delete2FASettings(){this.modal.prompt("input","MSG_ENTER_FA_TOKEN","MSG_ENTER_FA_TOKEN").subscribe({next:e=>{if(e){let s=this.modal.await("LBL_DELETING");this.backend.deleteRequest(`authentication/2fa/${e}`).subscribe({next:e=>{s.emit(!0),e.success?(this.session.authData.user.user_2fa_method=void 0,this.close()):this.delete2FASettings()},error:e=>{s.emit(!0),this.delete2FASettings()}})}else this.close()}})}static#e=this.ɵfac=function(e){return new(e||UserSet2FAModal)(h.rXU(R.i),h.rXU(f.d),h.rXU(m.y),h.rXU(y.H))};static#s=this.ɵcmp=h.VBU({type:UserSet2FAModal,selectors:[["user-set-2fa-modal"]],decls:15,vars:5,consts:[["size","small"],[3,"close"],["label","LBL_2FA_METHOD"],[1,"slds-grid","slds-grid--vertical"],["name","user2famethod","value","one_time_password",3,"disabled","ngModel","ngModelChange"],["label","LBL_TOTP_AUTHENTICATION"],["name","user2famethod","value","sms",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["name","user2famethod","value","email",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["name","user2famethod","value","none",3,"disabled","ngModel","ngModelChange",4,"ngIf"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CLOSE"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],["name","user2famethod","value","sms",3,"disabled","ngModel","ngModelChange"],["label","LBL_SMS"],["name","user2famethod","value","email",3,"disabled","ngModel","ngModelChange"],["label","LBL_EMAIL"],["name","user2famethod","value","none",3,"disabled","ngModel","ngModelChange"],["label","LBL_NONE"]],template:function(e,s){1&e&&(h.j41(0,"system-modal",0)(1,"system-modal-header",1),h.bIt("close",(function(){return s.close()})),h.nrm(2,"system-label",2),h.k0s(),h.j41(3,"system-modal-content")(4,"div",3)(5,"system-input-radio",4),h.mxI("ngModelChange",(function(e){return h.DH7(s.user_2fa_method,e)||(s.user_2fa_method=e),e})),h.nrm(6,"system-label",5),h.k0s(),h.DNE(7,As,3,3,"system-input-radio",6)(8,xs,3,3,"system-input-radio",7)(9,js,2,2,"system-input-radio",8),h.k0s()(),h.j41(10,"system-modal-footer")(11,"button",9),h.bIt("click",(function(){return s.close()})),h.nrm(12,"system-label",10),h.k0s(),h.j41(13,"button",11),h.bIt("click",(function(){return s.save()})),h.nrm(14,"system-label",12),h.k0s()()()),2&e&&(h.R7$(5),h.Y8G("disabled","one_time_password"==s.currentMethod),h.R50("ngModel",s.user_2fa_method),h.R7$(2),h.Y8G("ngIf",s.smsEnabled&&s.phoneMobile),h.R7$(),h.Y8G("ngIf",s.emailEnabled&&s.email),h.R7$(),h.Y8G("ngIf",s.candelete))},dependencies:[a.bT,i.BC,i.vS,Pe.J,L.W,v.D,U.I,k.Q,M.C],encapsulation:2})}return UserSet2FAModal})(),Fs=(()=>{class ModuleUsers{static#e=this.ɵfac=function(e){return new(e||ModuleUsers)};static#s=this.ɵmod=h.$C({type:ModuleUsers});static#t=this.ɵinj=h.G2t({imports:[a.MD,i.YN,l.ObjectFields,r.GlobalComponents,o.ObjectComponents,d.SystemComponents,n.h]})}return ModuleUsers})();("undefined"==typeof ngJitMode||ngJitMode)&&h.Obh(Fs,{declarations:[p,A,x,ie,Is,Ps,he,be,fe,Ue,ke,Je,Be,Fe,Ye,ss,ts,ms,ds,gs,Ls,Os],imports:[a.MD,i.YN,l.ObjectFields,r.GlobalComponents,o.ObjectComponents,d.SystemComponents,n.h],exports:[ie]})}}]);