/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_spiceimports_modulespiceimports_ts"],{13758:(t,s,e)=>{e.r(s),e.d(s,{ModuleSpiceImports:()=>x});var i=e(60177),l=e(84341),o=e(7745),r=e(12948),n=e(37328),a=e(70569),c=e(54438),d=e(49722);let m=(()=>{class spiceimportsservice{constructor(t){this.backend=t,this.isloading=!1,this.isloadingLogs=!1,this.canLoadMore=!0,this.activeimportdata=void 0,this.loadLimit=25,this.activeimportdata$=new c.bkB,this.items=[],this.activeItemLogs=void 0}get activeImportData(){return this.activeimportdata}set activeImportData(t){this.activeimportdata=t,this.activeimportdata$.emit(t)}getItemLogs(){this.activeItemLogs=void 0,this.isloadingLogs=!0,this.backend.getRequest(`module/SpiceImports/${this.activeImportData.id}/logs`).subscribe((t=>{t.map((t=>t.data=t.data.split('";"'))),this.activeItemLogs=t,this.isloadingLogs=!1}))}loadData(){this.isloading=!0,this.backend.getRequest("module/SpiceImports",{orderby:"date_entered DESC",limit:this.loadLimit,offset:0,fields:"*"}).subscribe((t=>{this.parseItemsStatus(t.list),this.items=t.list,this.isloading=!1}))}loadMoreData(){if(this.isloading||!this.canLoadMore)return!1;this.isloading=!0,this.backend.getRequest("module/SpiceImports",{orderby:"date_entered DESC",limit:this.loadLimit,offset:this.items.length,fields:"*"}).subscribe((t=>{this.parseItemsStatus(t.list),this.items=this.items.concat(t.list),t.list.length<this.loadLimit&&(this.canLoadMore=!1),this.isloading=!1}))}deleteImport(){this.items.every((t=>{let s=this.items.indexOf(t);return t.id==this.activeImportData.id&&this.items.splice(s,1),!0}))}parseItemsStatus(t){t.map((t=>{let s=JSON.parse(t.data);switch(t.status){case"c":"new"==s.importAction?t.statusdisplay="LBL_IMPORTED":t.statusdisplay="LBL_UPDATED";break;case"e":"new"==s.importAction?t.statusdisplay="LBL_IMPORTED":t.statusdisplay="LBL_UPDATE_FAILED";break;default:t.statusdisplay="LBL_SCHEDULED"}return t}))}static#t=this.ɵfac=function(t){return new(t||spiceimportsservice)(c.KVO(d.H))};static#s=this.ɵprov=c.jDH({token:spiceimportsservice,factory:spiceimportsservice.ɵfac})}return spiceimportsservice})();var p=e(69904),u=e(60940),g=e(32062),h=e(48717),v=e(68823);const f=t=>({"slds-theme_shade":t});let b=(()=>{class SpiceImportsListItem{constructor(t,s){this.language=t,this.spiceimportsservice=s,this.item=void 0}static#t=this.ɵfac=function(t){return new(t||SpiceImportsListItem)(c.rXU(p.B),c.rXU(m))};static#s=this.ɵcmp=c.VBU({type:SpiceImportsListItem,selectors:[["spice-imports-list-item"]],inputs:{item:"item"},decls:15,vars:13,consts:[[1,"slds-p-around--medium","slds-border--bottom","slds-border--right","slds-grid",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-icon_container","slds-col","slds-size--1-of-12",3,"title"],["size","medium",3,"module"],[1,"slds-col","slds-size--11-of-12"],[1,"slds-grid","slds-grid--align-spread"],[1,"slds-text-title_caps"],[1,"slds-col--bump-left","slds-truncate"],[1,"slds-truncate"]],template:function(t,s){1&t&&(c.j41(0,"div",0),c.bIt("click",(function(){return s.spiceimportsservice.activeImportData={id:s.item.id,name:s.item.name}})),c.j41(1,"div",1),c.nrm(2,"system-icon",2),c.k0s(),c.j41(3,"div",3)(4,"div",4)(5,"div",5),c.EFF(6),c.k0s(),c.j41(7,"div",6),c.EFF(8),c.nI1(9,"slice"),c.k0s()(),c.j41(10,"div",4)(11,"div",7),c.EFF(12),c.k0s(),c.j41(13,"div",6),c.EFF(14),c.k0s()()()()),2&t&&(c.Y8G("ngClass",c.eq3(11,f,(null==s.spiceimportsservice.activeImportData?null:s.spiceimportsservice.activeImportData.id)==s.item.id)),c.R7$(),c.FS9("title",s.item.model),c.R7$(),c.Y8G("module",s.item.module),c.R7$(4),c.JRh(s.item.name),c.R7$(2),c.JRh(c.brH(9,7,s.item.date_entered,0,16)),c.R7$(4),c.JRh(s.language.getLabel(s.item.statusdisplay)),c.R7$(2),c.JRh(s.item.created_by_name))},dependencies:[i.YU,v.J,i.P9],encapsulation:2})}return SpiceImportsListItem})();const L=["listcontainer"];function I(t,s){if(1&t&&(c.j41(0,"option",11),c.nrm(1,"system-label",12),c.k0s()),2&t){const t=s.$implicit;c.Y8G("value",t.value),c.R7$(),c.Y8G("label",t.label)}}function S(t,s){1&t&&(c.j41(0,"div",13)(1,"span"),c.nrm(2,"system-label",14),c.k0s()())}function _(t,s){if(1&t&&c.nrm(0,"spice-imports-list-item",15),2&t){const t=s.$implicit;c.Y8G("item",t)}}function R(t,s){1&t&&c.nrm(0,"system-spinner")}let E=(()=>{class SpiceImportsList{constructor(t,s){this.language=t,this.spiceimportsservice=s,this.filtermodule="",this.filterstatus="",this.filterstatusoptions=[],this.filterstatusoptions.push({value:"c",label:"LBL_IMPORTED"},{value:"q",label:"LBL_SCHEDULED"},{value:"e",label:"LBL_ERROR"})}listStyle(){return{height:"calc(100vh - "+this.listcontainer.element.nativeElement.getBoundingClientRect().top+"px)"}}get items(){return this.filtermodule&&this.filterstatus?this.spiceimportsservice.items.filter((t=>t.module===this.filtermodule&&t.status===this.filterstatus)):this.filtermodule?this.spiceimportsservice.items.filter((t=>t.module===this.filtermodule)):this.filterstatus?this.spiceimportsservice.items.filter((t=>t.status===this.filterstatus)):this.spiceimportsservice.items}onScroll(t){let s=this.listcontainer.element.nativeElement;s.scrollTop+s.clientHeight+50>s.scrollHeight&&this.spiceimportsservice.loadMoreData()}static#t=this.ɵfac=function(t){return new(t||SpiceImportsList)(c.rXU(p.B),c.rXU(m))};static#s=this.ɵcmp=c.VBU({type:SpiceImportsList,selectors:[["spice-imports-list"]],viewQuery:function(t,s){if(1&t&&c.GBs(L,7,c.c1b),2&t){let t;c.mGM(t=c.lsd())&&(s.listcontainer=t.first)}},decls:12,vars:7,consts:[[1,"slds-p-around--xx-small","slds-grid","slds-grid--vertical-align-center"],["label","LBL_MODULE"],[1,"slds-select",3,"ngModel","ngModelChange"],["label","LBL_STATUS"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"slds-scrollable--y",3,"ngStyle","scroll"],["listcontainer",""],["class","slds-text-align_center slds-p-vertical--medium",4,"ngIf"],[3,"item",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],[3,"label"],[1,"slds-text-align_center","slds-p-vertical--medium"],["label","LBL_NO_ENTRIES"],[3,"item"]],template:function(t,s){1&t&&(c.j41(0,"div",0),c.nrm(1,"system-label",1),c.j41(2,"system-input-module",2),c.mxI("ngModelChange",(function(t){return c.DH7(s.filtermodule,t)||(s.filtermodule=t),t})),c.k0s(),c.nrm(3,"system-label",3),c.j41(4,"select",2),c.mxI("ngModelChange",(function(t){return c.DH7(s.filterstatus,t)||(s.filterstatus=t),t})),c.nrm(5,"option",4),c.DNE(6,I,2,2,"option",5),c.k0s()(),c.j41(7,"div",6,7),c.bIt("scroll",(function(t){return s.onScroll(t)})),c.DNE(9,S,3,0,"div",8)(10,_,1,1,"spice-imports-list-item",9)(11,R,1,0,"system-spinner",10),c.k0s()),2&t&&(c.R7$(2),c.R50("ngModel",s.filtermodule),c.R7$(2),c.R50("ngModel",s.filterstatus),c.R7$(2),c.Y8G("ngForOf",s.filterstatusoptions),c.R7$(),c.Y8G("ngStyle",s.listStyle()),c.R7$(2),c.Y8G("ngIf",!s.spiceimportsservice.isloading&&0==(null==s.items?null:s.items.length)),c.R7$(),c.Y8G("ngForOf",s.items),c.R7$(),c.Y8G("ngIf",s.spiceimportsservice.isloading))},dependencies:[i.Sq,i.bT,i.B3,l.xH,l.y7,l.wz,l.BC,l.vS,u.u,g.W,h.P,b],encapsulation:2})}return SpiceImportsList})();var D=e(50531),y=e(41081),k=e(25863);const $=["logscontainer"];function G(t,s){if(1&t){const t=c.RV6();c.j41(0,"button",9),c.bIt("click",(function(){c.eBV(t);const s=c.XpG();return c.Njj(s.delete())})),c.nrm(1,"system-label",10),c.k0s()}}function j(t,s){1&t&&(c.j41(0,"div",11),c.nrm(1,"system-label",12),c.k0s())}function F(t,s){1&t&&(c.j41(0,"div",11),c.nrm(1,"system-label",13),c.k0s())}function B(t,s){1&t&&c.nrm(0,"system-spinner")}function M(t,s){if(1&t&&(c.j41(0,"div",19)(1,"button",20),c.nrm(2,"system-button-icon",21),c.k0s()()),2&t){const t=c.XpG().$implicit,s=c.XpG();c.R7$(2),c.Y8G("icon",s.getButtonicon(t.id))}}function O(t,s){if(1&t&&(c.j41(0,"tr")(1,"td",23),c.EFF(2),c.k0s(),c.j41(3,"td",23),c.EFF(4),c.k0s()()),2&t){const t=s.$implicit,e=s.index,i=c.XpG(3);c.R7$(2),c.JRh(i.itemHeader[e]),c.R7$(2),c.JRh(t)}}function C(t,s){if(1&t&&(c.j41(0,"table",22)(1,"tbody"),c.DNE(2,O,5,2,"tr",8),c.k0s()()),2&t){const t=c.XpG().$implicit;c.R7$(2),c.Y8G("ngForOf",t.data)}}function N(t,s){if(1&t){const t=c.RV6();c.j41(0,"div")(1,"div",14),c.bIt("click",(function(){const s=c.eBV(t).$implicit,e=c.XpG();return c.Njj(e.toggleOpen(s.id))})),c.j41(2,"div",15),c.EFF(3),c.k0s(),c.j41(4,"div",16),c.EFF(5),c.k0s(),c.DNE(6,M,3,1,"div",17),c.k0s(),c.DNE(7,C,3,1,"table",18),c.k0s()}if(2&t){const t=s.$implicit,e=c.XpG();c.R7$(3),c.SpI(" ",t.msg," "),c.R7$(),c.Y8G("hidden",e.opened&&t.id==e.activeLogId&&e.itemHeader),c.R7$(),c.SpI(" ",t.data.join(" , ")," "),c.R7$(),c.Y8G("ngIf",e.itemHeader),c.R7$(),c.Y8G("ngIf",e.opened&&t.id==e.activeLogId&&e.itemHeader)}}let U=(()=>{class Spiceimportslogs{constructor(t,s,e,i,l){this.language=t,this.modal=s,this.backend=e,this.toast=i,this.spiceimportsservice=l,this.itemHeader=void 0,this.activeLogId=void 0,this.activelogname=void 0,this.opened=!1,this.spiceimportsservice.activeimportdata$.subscribe((t=>{t&&(this.activeLogName=t.name,this.spiceimportsservice.getItemLogs(),this.setItemHeader(t.id)),this.opened=!1}))}get itemLogs(){return this.spiceimportsservice.activeItemLogs}get activeLogName(){return this.activelogname}set activeLogName(t){this.activelogname=t}getButtonicon(t){return this.opened&&this.activeLogId==t?"chevronup":"chevrondown"}setItemHeader(t){this.spiceimportsservice.items.some((s=>{let e=JSON.parse(s.data);return s.id==t&&(this.itemHeader=e.fileHeader),!0}))}mainStyle(){return{height:"calc(100vh - "+this.logscontainer.element.nativeElement.getBoundingClientRect().top+"px)",overflow:"auto"}}toggleOpen(t){this.opened&&t!=this.activeLogId||(this.opened=!this.opened),this.activeLogId=t}delete(){this.modal.confirm(this.language.getLabel("MSG_DELETE_RECORD","","long"),this.language.getLabel("MSG_DELETE_RECORD")).subscribe((t=>{t&&this.backend.deleteRequest(`module/SpiceImports/${this.spiceimportsservice.activeImportData.id}`).subscribe((t=>{t?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_DELETED"),"success"),this.spiceimportsservice.deleteImport(),this.resetData()):this.toast.sendToast(this.language.getLabel("ERR_CANT_DELETE"),"error")}))}))}resetData(){this.spiceimportsservice.activeImportData=void 0,this.spiceimportsservice.activeItemLogs=void 0,this.activeLogName=void 0}static#t=this.ɵfac=function(t){return new(t||Spiceimportslogs)(c.rXU(p.B),c.rXU(D.y),c.rXU(d.H),c.rXU(y.o),c.rXU(m))};static#s=this.ɵcmp=c.VBU({type:Spiceimportslogs,selectors:[["spice-imports-logs"]],viewQuery:function(t,s){if(1&t&&c.GBs($,7,c.c1b),2&t){let t;c.mGM(t=c.lsd())&&(s.logscontainer=t.first)}},decls:11,vars:7,consts:[[1,"slds-grid","slds-page-header","slds-p-horizontal--none","slds-p-vertical--xx-small","slds-grid--vertical-align-center",2,"border-radius","0","border-left","0","height","50px"],[1,"slds-text-title_caps","slds-p-left--small"],[1,"slds-p-around_xx-small","slds-col--bump-left"],["class","slds-button slds-button--brand",3,"click",4,"ngIf"],[1,"slds-scrollable--y",3,"ngStyle"],["logscontainer",""],["class","slds-align_absolute-center slds-m-around--xx-large slds-text-heading--medium",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_DELETE"],[1,"slds-align_absolute-center","slds-m-around--xx-large","slds-text-heading--medium"],["label","MSG_NO_LOGS_FOUND"],["label","LBL_MAKE_SELECTION"],[1,"slds-p-left--small","slds-border--bottom","slds-border--right","slds-grid",2,"cursor","pointer",3,"click"],[1,"slds-p-vertical--small","slds-col","slds-size--2-of-12","slds-border--right"],[1,"slds-p-around--small","slds-col","slds-size--9-of-12","slds-truncate",3,"hidden"],["class","slds-p-around--small slds-size--1-of-12 slds-col_bump-left",4,"ngIf"],["class","slds-table slds-table--bordered slds-table--cell-buffer",4,"ngIf"],[1,"slds-p-around--small","slds-size--1-of-12","slds-col_bump-left"],[1,"slds-button","slds-button_icon"],[3,"icon"],[1,"slds-table","slds-table--bordered","slds-table--cell-buffer"],[1,"slds-truncate"]],template:function(t,s){1&t&&(c.j41(0,"div",0)(1,"div",1),c.EFF(2),c.k0s(),c.j41(3,"div",2),c.DNE(4,G,2,0,"button",3),c.k0s()(),c.j41(5,"div",4,5),c.DNE(7,j,2,0,"div",6)(8,F,2,0,"div",6)(9,B,1,0,"system-spinner",7)(10,N,8,5,"div",8),c.k0s()),2&t&&(c.R7$(2),c.JRh(s.activeLogName),c.R7$(2),c.Y8G("ngIf",s.activeLogName),c.R7$(),c.Y8G("ngStyle",s.mainStyle()),c.R7$(2),c.Y8G("ngIf",!s.spiceimportsservice.isloadingLogs&&s.spiceimportsservice.activeImportData&&(null==s.itemLogs?null:s.itemLogs.length)<=0),c.R7$(),c.Y8G("ngIf",!s.spiceimportsservice.isloadingLogs&&!s.spiceimportsservice.activeImportData),c.R7$(),c.Y8G("ngIf",s.spiceimportsservice.isloadingLogs),c.R7$(),c.Y8G("ngForOf",s.itemLogs))},dependencies:[i.Sq,i.bT,i.B3,k.t,g.W,h.P],encapsulation:2})}return Spiceimportslogs})(),Y=(()=>{class SpiceImports{constructor(t,s){this.language=t,this.spiceimportsservice=s}ngOnInit(){this.spiceimportsservice.loadData()}static#t=this.ɵfac=function(t){return new(t||SpiceImports)(c.rXU(p.B),c.rXU(m))};static#s=this.ɵcmp=c.VBU({type:SpiceImports,selectors:[["ng-component"]],features:[c.Jv_([m])],decls:5,vars:0,consts:[[1,"slds-grid"],[1,"slds-size--1-of-2"],[1,"slds-scrollable"],[1,"slds-size--1-of-2","slds-theme--shade"]],template:function(t,s){1&t&&(c.j41(0,"div",0)(1,"spice-imports-list",1),c.nrm(2,"div",2),c.k0s(),c.j41(3,"spice-imports-logs",3),c.nrm(4,"div",2),c.k0s()())},dependencies:[E,U],encapsulation:2})}return SpiceImports})(),x=(()=>{class ModuleSpiceImports{static#t=this.ɵfac=function(t){return new(t||ModuleSpiceImports)};static#s=this.ɵmod=c.$C({type:ModuleSpiceImports});static#e=this.ɵinj=c.G2t({providers:[m],imports:[i.MD,l.YN,o.ObjectFields,r.GlobalComponents,n.ObjectComponents,a.SystemComponents]})}return ModuleSpiceImports})();("undefined"==typeof ngJitMode||ngJitMode)&&c.Obh(x,{declarations:[Y,E,b,U],imports:[i.MD,l.YN,o.ObjectFields,r.GlobalComponents,n.ObjectComponents,a.SystemComponents]})}}]);