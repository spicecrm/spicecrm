/*!
 * 
 *                     aacService
 *
 *                     release: 2023.03.001
 *
 *                     date: 2024-01-03 13:43:56
 *
 *                     build: 2023.03.001.1704285836024
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_include_totpauthentication_moduletotpauthentication_ts"],{38127:(e,t,s)=>{s.r(t),s.d(t,{ModuleTOTPAuthentication:()=>v});var n=s(44755),o=s(95030),a=s(84357),i=s(53190),l=s(34826),d=s(19784),r=s(57239),c=s(62242),h=s(55329),u=s(55710),g=s(44044),T=s(14505),m=s(75920),p=s(83463);let b=(()=>{class TOTPAuthenticationGenerateButton{language;model;modal;backend;injector;session;onBehalfUserId;constructor(e,t,s,n,o,a){this.language=e,this.model=t,this.modal=s,this.backend=n,this.injector=o,this.session=a}execute(){this.onBehalfUserId=this.session.authData.userId!=this.model.id?this.model.id:void 0;let e=this.modal.await(this.language.getLabel("MSG_TOTP_STATUSCHECK"));this.backend.getRequest("authentication/totp",{onBehalfUserId:this.onBehalfUserId}).subscribe((t=>{e.emit(!0),t.active?this.modal.confirm(this.language.getLabel("MSG_TOTP_DELETE",null,"long"),this.language.getLabel("MSG_TOTP_DELETE")).subscribe((t=>{t&&(e=this.modal.await(this.language.getLabel("MSG_TOTP_DELETING")),this.backend.deleteRequest("authentication/totp",{onBehalfUserId:this.onBehalfUserId}).subscribe((t=>{e.emit(!0),this.generateTOTP()}),(()=>{e.emit(!0)})))})):this.generateTOTP()}),(()=>{e.emit(!0)}))}generateTOTP(){this.modal.openModal("TOTPAuthenticationGenerateModal",!0,this.injector).subscribe((e=>{e.instance.onBehalfUserId=this.onBehalfUserId}))}static ɵfac=function(e){return new(e||TOTPAuthenticationGenerateButton)(c.Y36(h.d),c.Y36(u.o),c.Y36(g.o),c.Y36(T.y),c.Y36(c.zs3),c.Y36(m.n))};static ɵcmp=c.Xpm({type:TOTPAuthenticationGenerateButton,selectors:[["totp-authenticatio-generate-button"]],decls:1,vars:0,consts:[["label","LBL_TOTP_AUTHENTICATION"]],template:function(e,t){1&e&&c._UZ(0,"system-label",0)},dependencies:[p._],encapsulation:2})}return TOTPAuthenticationGenerateButton})();var f=s(77579),O=s(4154),_=s(13278),A=s(59621),C=s(83499),I=s(75767),U=s(1916);function x(e,t){if(1&e&&c._UZ(0,"img",18),2&e){const e=c.oxw(2);c.Q6J("src",e.QRCode,c.LSH)}}function y(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"system-modal",1)(1,"system-modal-header",2),c.NdJ("close",(function(){c.CHM(e);const t=c.oxw();return c.KtG(t.close())})),c._UZ(2,"system-label",3),c.qZA(),c.TgZ(3,"system-modal-content")(4,"div",4)(5,"div",5),c._UZ(6,"system-label",6),c.qZA(),c.TgZ(7,"div",7)(8,"div",8),c._uU(9),c.qZA(),c.YNc(10,x,1,1,"img",9),c.TgZ(11,"div",8),c._uU(12),c.qZA()()()(),c.TgZ(13,"system-modal-footer")(14,"div",10)(15,"div",11),c._UZ(16,"system-label",12),c.TgZ(17,"input",13),c.NdJ("ngModelChange",(function(t){c.CHM(e);const s=c.oxw();return c.KtG(s.code=t)})),c.qZA()(),c.TgZ(18,"div",4)(19,"button",14),c.NdJ("click",(function(){c.CHM(e);const t=c.oxw();return c.KtG(t.close())})),c._UZ(20,"system-label",15),c.qZA(),c.TgZ(21,"button",16),c.NdJ("click",(function(){c.CHM(e);const t=c.oxw();return c.KtG(t.save())})),c._UZ(22,"system-label",17),c.qZA()()()()()}if(2&e){const e=c.oxw();c.xp6(9),c.Oqu(e.name),c.xp6(1),c.Q6J("ngIf",e.QRCode),c.xp6(2),c.Oqu(e.secret),c.xp6(5),c.Q6J("ngModel",e.code),c.xp6(4),c.Q6J("disabled",6!=e.code.length)}}let M=(()=>{class TOTPAuthenticationGenerateModal{language;metadata;modal;backend;toast;model;session;self;QRCode;secret;name;code="";onBehalfUserId;response=new f.x;constructor(e,t,s,n,o,a,i){this.language=e,this.metadata=t,this.modal=s,this.backend=n,this.toast=o,this.model=a,this.session=i}ngOnInit(){let e=this.modal.await(this.language.getLabel("MSG_TOTP_GENERATING_CODE"));this.backend.postRequest("authentication/totp/generate",{onBehalfUserId:this.onBehalfUserId}).subscribe({next:t=>{e.emit(!0),t.secret?(this.QRCode="data:image/png;base64,"+t.qrcode,this.secret=t.secret,this.name=t.name,this.response.next(!0)):(this.toast.sendToast("Error generating Code","error"),this.response.next(!1),this.close())},error:()=>{this.toast.sendToast("Error generating Code","error"),this.response.next(!1),this.close(),e.emit(!0)}})}close(){this.self.destroy()}save(){this.backend.putRequest(`authentication/totp/validate/${this.code}`,{onBehalfUserId:this.onBehalfUserId}).subscribe({next:e=>{e.validated?(this.response.next(!0),this.close()):(this.response.next(!1),this.toast.sendToast("Error validating your code","warning","the code you entered is not valid, please try again",!0)),this.code=""},error:()=>{this.response.next(!1),this.toast.sendToast("Error validating your code","error","there as an internal error validating your request",!0),this.code=""}})}static ɵfac=function(e){return new(e||TOTPAuthenticationGenerateModal)(c.Y36(h.d),c.Y36(O.Pu),c.Y36(g.o),c.Y36(T.y),c.Y36(_.A),c.Y36(u.o),c.Y36(m.n))};static ɵcmp=c.Xpm({type:TOTPAuthenticationGenerateModal,selectors:[["totp-authentication-generate-modal"]],inputs:{onBehalfUserId:"onBehalfUserId"},decls:1,vars:1,consts:[["size","small",4,"ngIf"],["size","small"],[3,"close"],["label","LBL_TOTP_AUTHENTICATION"],[1,"slds-grid"],[1,"slds-size--1-of-2"],["label","MSG_AUTHENTICATOR_INSTRUCTIONS","length","long"],[1,"slds-size--1-of-2","slds-align--absolute-center","slds-grid","slds-grid--vertical"],[1,"slds-p-vertical--small"],["style","width: 200px; height: 200px;",3,"src",4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center","slds-grid--align-spread"],[1,"slds-grid","slds-grid--vertical-align-center"],["label","LBL_CODE"],["maxlength","6",1,"slds-m-left--x-small","slds-input",2,"width","6rem",3,"ngModel","ngModelChange"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"],[2,"width","200px","height","200px",3,"src"]],template:function(e,t){1&e&&c.YNc(0,y,23,5,"system-modal",0),2&e&&c.Q6J("ngIf",t.secret)},dependencies:[n.O5,o.Fj,o.JJ,o.nD,o.On,p._,A.j,C.x,I.p,U.y],encapsulation:2})}return TOTPAuthenticationGenerateModal})(),v=(()=>{class ModuleTOTPAuthentication{static ɵfac=function(e){return new(e||ModuleTOTPAuthentication)};static ɵmod=c.oAB({type:ModuleTOTPAuthentication});static ɵinj=c.cJS({imports:[n.ez,o.u5,i.ObjectFields,l.GlobalComponents,d.ObjectComponents,r.SystemComponents,a.o]})}return ModuleTOTPAuthentication})();("undefined"==typeof ngJitMode||ngJitMode)&&c.kYT(v,{declarations:[b,M],imports:[n.ez,o.u5,i.ObjectFields,l.GlobalComponents,d.ObjectComponents,r.SystemComponents,a.o]})}}]);