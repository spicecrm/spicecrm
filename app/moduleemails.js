/*!
 * 
 *                     aacService
 *
 *                     release: 2022.02.001
 *
 *                     date: 2022-09-03 11:05:02
 *
 *                     build: 2022.02.001.1662195902704
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_emails_moduleemails_ts"],{8544:(e,t,s)=>{s.r(t),s.d(t,{ModuleEmails:()=>zt});var i=s(6895),l=s(433),n=s(4357),d=s(3121),o=s(3283),a=s(4518),c=s(5478),r=s(1571),m=s(5329),u=s(4154),h=s(7674);const p=["contextMenu"];function g(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"li",7)(1,"a",8),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw(2);return r.KtG(s.setField(t))})),r.TgZ(2,"span",9),r._UZ(3,"system-label-fieldname",10),r.qZA()()()}if(2&e){const e=t.$implicit,s=r.oxw(2);r.xp6(3),r.Q6J("module",s.target_module_name)("field",e)}}function b(e,t){if(1&e&&(r.TgZ(0,"div",3,4)(2,"ul",5),r.YNc(3,g,4,2,"li",6),r.qZA()()),2&e){const e=r.oxw();r.Q6J("ngStyle",e.contextMenuStyle),r.xp6(3),r.Q6J("ngForOf",e.target_module_fields)}}let f=(()=>{class EmailToObjectEmailText{constructor(e,t,s,i){this.elementRef=e,this.renderer=t,this.language=s,this.metadata=i,this.text="",this.html="",this.target_module_name="",this.target_module_fields=[],this.setfield=new r.vpe,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.html?this.html:this.text}get striped_content(){return this._striped_content||(this.html?this._striped_content=this.html.replace(/<!--.*?-->/gs,"").replace(/<[^>]+>/g,"").replace(/[ ]{2,}/g," ").replace(/[\n\r]{3,}/g,"\n"):this._striped_content=this.text),this._striped_content}ngOnInit(){if(!this.target_module_fields||0===this.target_module_fields.length){let e=["varchar","text"],t=this.metadata.getModuleFields(this.target_module_name);for(let s in t)e.indexOf(t[s].type)>=0&&t[s].vname&&"id"!==t[s].name&&this.target_module_fields.push(s)}}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return EmailToObjectEmailText.ɵfac=function(e){return new(e||EmailToObjectEmailText)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(m.d),r.Y36(u.Pu))},EmailToObjectEmailText.ɵcmp=r.Xpm({type:EmailToObjectEmailText,selectors:[["email-to-object-emailtext"]],viewQuery:function(e,t){if(1&e&&r.Gf(p,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.contextMenu=e.first)}},inputs:{text:"text",html:"html",target_module_name:"target_module_name",target_module_fields:"target_module_fields"},outputs:{setfield:"setfield"},decls:4,vars:3,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-input",2,"height","100%","width","100%","resize","none",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),r._uU(2),r.qZA(),r.YNc(3,b,4,2,"div",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("innerHTML",t.content,r.oJD),r.xp6(1),r.Oqu(t.striped_content),r.xp6(1),r.Q6J("ngIf",t.displayContextMenu))},dependencies:[i.sg,i.O5,i.PC,h.h],encapsulation:2}),EmailToObjectEmailText})();var _=s(5710),y=s(2294),E=s(4505),x=s(2656),v=s(3463),Z=s(3333);const L=["detailcontainer"];let T=(()=>{class EmailToObjectModal{constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.view=s,this.model=i,this.backend=l,this.email_model=null,this.self=null,this.componentRefs=[],this.save$=new r.vpe,this.object_fields=[]}ngOnInit(){if(this.model.module=this.object_module_name,this.model.initializeModel(this.email_model),this.object_predefined_fields){let e={};for(let t in this.object_predefined_fields)e[t]=this.object_predefined_fields[t];this.model.setFields(e)}this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}close(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}save(){this.model.validate()&&this.model.save().subscribe((e=>{this.object_relation_link_name?this.backend.postRequest("module/Emails/"+this.email_model.id+"/related/"+this.object_relation_link_name,[],[this.model.id]).subscribe((e=>{this.save$.emit(this.model.data),this.close()})):(this.save$.emit(this.model.data),this.close())}))}}return EmailToObjectModal.ɵfac=function(e){return new(e||EmailToObjectModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(y.e),r.Y36(_.o),r.Y36(E.y))},EmailToObjectModal.ɵcmp=r.Xpm({type:EmailToObjectModal,selectors:[["email-to-object-modal"]],viewQuery:function(e,t){if(1&e&&r.Gf(L,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.detailcontainer=e.first)}},inputs:{object_module_name:"object_module_name",object_fields:"object_fields",object_relation_link_name:"object_relation_link_name",object_predefined_fields:"object_predefined_fields"},outputs:{save$:"save$"},features:[r._Bn([_.o,y.e])],decls:20,vars:7,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],[3,"module","singular"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"target_module_name","text","html","target_module_fields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",(function(){return t.close()})),r._UZ(4,"system-button-icon",4),r.qZA(),r.TgZ(5,"h2",5),r._UZ(6,"system-label-modulename",6),r.qZA()(),r.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"email-to-object-emailtext",10),r.NdJ("setfield",(function(e){return t.setField(e)})),r.qZA()(),r.TgZ(11,"div",11),r._UZ(12,"div",null,12),r.qZA()()(),r.TgZ(14,"div",13)(15,"button",14),r.NdJ("click",(function(){return t.close()})),r._UZ(16,"system-label",15),r.qZA(),r.TgZ(17,"button",16),r.NdJ("click",(function(){return t.save()})),r._UZ(18,"system-label",17),r.qZA()()()(),r._UZ(19,"div",18)),2&e&&(r.xp6(4),r.Q6J("icon","close"),r.xp6(2),r.Q6J("module",t.object_module_name)("singular",!0),r.xp6(4),r.Q6J("target_module_name",t.object_module_name)("text",t.email_model.data.body)("html",t.email_model.data.body)("target_module_fields",t.object_fields))},dependencies:[x.J,v._,Z.M,f],encapsulation:2}),EmailToObjectModal})();var w=s(6040),M=s(4044);let k=(()=>{class EmailToObjectButton{constructor(e,t,s,i,l){this.language=e,this.model=t,this.metadata=s,this.modal=i,this.relatedmodels=l,this.actionemitter=new r.vpe}get disabled(){if(!this.metadata.checkModuleAcl(this.actionconfig.module,"create"))return!0;if(this.actionconfig.checklink){if(this.relatedmodels.isloading)return!0;if(this.relatedmodels.count>0)return!0}return!1}ngOnInit(){this.object_module_name=this.actionconfig.module,this.actionconfig.checklink&&this.subscribeToModel()}subscribeToModel(){this.subscription=this.model.data$.subscribe((e=>{this.getRelatedData()}))}ngOnDestroy(){this.subscription?.unsubscribe()}getRelatedData(){this.relatedmodels.module=this.model.module,this.relatedmodels.id=this.model.id,this.relatedmodels.relatedModule=this.actionconfig.module,this.relatedmodels.linkName=this.actionconfig.checklink,this.relatedmodels.getData()}execute(){this.modal.openModal("EmailToObjectModal",!0).subscribe((e=>{e.instance.email_model=this.model,e.instance.object_module_name=this.object_module_name,e.instance.object_relation_link_name=this.actionconfig.relation_link_name,e.instance.object_predefined_fields=this.actionconfig.predefined_fields,e.instance.save$.subscribe((e=>{this.actionemitter.emit("save")}))}))}}return EmailToObjectButton.ɵfac=function(e){return new(e||EmailToObjectButton)(r.Y36(m.d),r.Y36(_.o),r.Y36(u.Pu),r.Y36(M.o),r.Y36(w.j))},EmailToObjectButton.ɵcmp=r.Xpm({type:EmailToObjectButton,selectors:[["email-to-object-button"]],outputs:{actionemitter:"actionemitter"},features:[r._Bn([w.j])],decls:3,vars:2,consts:[["label","LBL_CONVERT_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0)(2,"system-label-modulename",1),r.qZA()),2&e&&(r.xp6(2),r.Q6J("module",t.object_module_name)("singular",!0))},dependencies:[v._,Z.M],encapsulation:2}),EmailToObjectButton})();var A=s(1481),B=s(323),C=s(9062),S=s(9621),Y=s(3499),J=s(5767),F=s(1916),O=s(4664);function q(e,t){if(1&e&&(r.TgZ(0,"span",9),r._uU(1),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.hij('"',e.model.data.name,'"')}}function N(e,t){1&e&&(r.TgZ(0,"div",10)(1,"div",11),r._UZ(2,"system-spinner"),r.TgZ(3,"div",12),r._uU(4,"... "),r._UZ(5,"system-label",13),r._uU(6," ..."),r.qZA()()())}function U(e,t){if(1&e&&r._UZ(0,"object-record-fieldset",14),2&e){const e=r.oxw();r.Q6J("fieldset",e.fieldset)}}let I=(()=>{class EmailPreviewModal{constructor(e,t,s,i,l,n,d){this.language=e,this.metadata=t,this.sanitizer=s,this.backend=i,this.model=l,this.view=n,this.modelattachments=d,this.self={},this.type="",this.name="",this.isLoading=!0,this.model.module="Emails";let o=this.metadata.getComponentConfig("EmailPreviewModal",this.model.module);this.fieldset=o.fieldset}closeModal(){this.self.destroy()}ngOnInit(){this.backend.getRequest("module/Emails/msg/"+this.file.id).subscribe((e=>{this.model.setFields(this.model.utils.backendModel2spice("Emails",e)),this.isLoading=!1}))}download(){this.modelattachments.downloadAttachment(this.file.id,this.file.filename)}}return EmailPreviewModal.ɵfac=function(e){return new(e||EmailPreviewModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(A.H7),r.Y36(E.y),r.Y36(_.o),r.Y36(y.e),r.Y36(B.H))},EmailPreviewModal.ɵcmp=r.Xpm({type:EmailPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},features:[r._Bn([_.o,y.e])],decls:10,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_EMAIL"],["class","slds-truncate",4,"ngIf"],["margin","none"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["direction","vertical",3,"fieldset",4,"ngIf"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","download","size","small"],[1,"slds-truncate"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-grid_vertical"],[1,"slds-p-around--small"],["label","LBL_LOADING"],["direction","vertical",3,"fieldset"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.closeModal()})),r._UZ(2,"system-label",2),r.YNc(3,q,2,1,"span",3),r.qZA(),r.TgZ(4,"system-modal-content",4),r.YNc(5,N,7,0,"div",5),r.YNc(6,U,1,1,"object-record-fieldset",6),r.qZA(),r.TgZ(7,"system-modal-footer")(8,"button",7),r.NdJ("click",(function(){return t.download()})),r._UZ(9,"system-button-icon",8),r.qZA()()()),2&e&&(r.xp6(3),r.Q6J("ngIf",!t.isLoading),r.xp6(2),r.Q6J("ngIf",t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.isLoading),r.xp6(2),r.Q6J("disabled",t.isLoading))},dependencies:[i.O5,C.d,x.J,v._,S.j,Y.x,J.p,F.y,O.W],encapsulation:2}),EmailPreviewModal})();var R=s(2067);function Q(e,t){1&e&&(r.TgZ(0,"div",5),r._UZ(1,"system-spinner"),r.qZA())}function j(e,t){if(1&e&&(r.TgZ(0,"div",6)(1,"div"),r._uU(2),r.qZA(),r._UZ(3,"div",7),r.qZA()),2&e){const e=r.oxw();r.xp6(2),r.hij("subject: ",e.subject,""),r.xp6(1),r.Q6J("innerHTML",e.body,r.oJD)}}let D=(()=>{class EmailMSGPreviewModal{constructor(e,t,s){this.language=e,this.sanitizer=t,this.libloader=s,this.self={},this.type="",this.name="",this.libsloaded=!1}closeModal(){this.self.destroy()}set data(e){this.libloader.loadLib("msgreader").subscribe((e=>{}))}get subject(){return this.msgData?this.msgData.subject:""}get body(){return this.msgData?this.sanitizer.bypassSecurityTrustHtml(this.msgData.body.replace(/\n/g,"<br/>")):""}get objecttype(){if(!this.type)return"";let e=this.type.split("/");switch(e[0]){case"audio":case"video":return e[0];default:return"object"}}download(){let e=document.createElement("a");document.body.appendChild(e),e.href=this.blobUrl,e.download=this.name,e.click(),e.remove()}datatoBlob(e,t="",s=512){let i=[];for(let t=0;t<e.length;t+=s){let l=e.slice(t,t+s),n=new Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);let d=new Uint8Array(n);i.push(d)}return new Blob(i,{type:t})}}return EmailMSGPreviewModal.ɵfac=function(e){return new(e||EmailMSGPreviewModal)(r.Y36(m.d),r.Y36(A.H7),r.Y36(R.$))},EmailMSGPreviewModal.ɵcmp=r.Xpm({type:EmailMSGPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},decls:6,vars:3,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["class","slds-p-around--small slds-text-align--center",4,"ngIf"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-p-around--small","slds-text-align--center"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.closeModal()})),r._uU(2,"Email Preview"),r.qZA(),r.TgZ(3,"system-modal-content",2),r.YNc(4,Q,2,0,"div",3),r.YNc(5,j,4,2,"div",4),r.qZA()()),2&e&&(r.xp6(3),r.Q6J("grow",!0),r.xp6(1),r.Q6J("ngIf",!t.msgData),r.xp6(1),r.Q6J("ngIf",t.msgData))},dependencies:[i.O5,S.j,Y.x,F.y,O.W],encapsulation:2}),EmailMSGPreviewModal})(),H=(()=>{class EmailsPopoverBody{constructor(e,t,s){this.model=e,this.language=t,this.sanitized=s,this.fullValue=""}get emailbody(){return this.model.getFieldValue("body")}get sanitizedValue(){return this.emailbody&&(this.emailbody.includes("</html>")?this.fullValue=this.emailbody:this.fullValue=`<html><body class="spice">${this.emailbody}</body></html>`),this.fullValue!=this.fullValue_cached&&(this._sanitizedValue=this.sanitized.bypassSecurityTrustResourceUrl(this.fullValue?"data:text/html;charset=UTF-8,"+encodeURIComponent(this.fullValue):""),this.fullValue_cached=this.fullValue),this._sanitizedValue}}return EmailsPopoverBody.ɵfac=function(e){return new(e||EmailsPopoverBody)(r.Y36(_.o),r.Y36(m.d),r.Y36(A.H7))},EmailsPopoverBody.ɵcmp=r.Xpm({type:EmailsPopoverBody,selectors:[["ng-component"]],decls:1,vars:1,consts:[["width","100%","frameborder","0","seamless","true","sandbox","",2,"resize","vertical",3,"src"]],template:function(e,t){1&e&&r._UZ(0,"iframe",0),2&e&&r.Q6J("src",t.sanitizedValue,r.uOi)},encapsulation:2}),EmailsPopoverBody})();var P=s(7040),z=s(7774),G=s(6367),$=s(3208),V=s(8859);function K(e,t){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}let X=(()=>{class fieldEmailStatus extends P.O{constructor(e,t,s,i,l){super(e,t,s,i,l),this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=l}get statusicon(){switch(this.value){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}}return fieldEmailStatus.ɵfac=function(e){return new(e||fieldEmailStatus)(r.Y36(_.o),r.Y36(y.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(z.F0))},fieldEmailStatus.ɵcmp=r.Xpm({type:fieldEmailStatus,selectors:[["ng-component"]],features:[r.qOj],decls:3,vars:7,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],["size","x-small",3,"title","icon"],[3,"fieldname","fieldconfig"]],template:function(e,t){1&e&&(r.YNc(0,K,1,2,"field-label",0),r.TgZ(1,"field-generic-display",1),r._UZ(2,"system-utility-icon",2),r.qZA()),2&e&&(r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("fielddisplayclass",t.fielddisplayclass)("editable",!1)("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),r.xp6(1),r.Q6J("title",t.value)("icon",t.statusicon))},dependencies:[i.O5,G.q,$.D,V.r],encapsulation:2}),fieldEmailStatus})(),W=(()=>{class EmailReplyButton{constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailReplyModal",!0,this.injector)}}return EmailReplyButton.ɵfac=function(e){return new(e||EmailReplyButton)(r.Y36(r.zs3),r.Y36(_.o),r.Y36(u.Pu),r.Y36(M.o))},EmailReplyButton.ɵcmp=r.Xpm({type:EmailReplyButton,selectors:[["email-reply-button"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_REPLY"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[v._],encapsulation:2}),EmailReplyButton})();var ee=s(2422),te=s(5920),se=s(788),ie=s(8861),le=s(6951),ne=s(1604);let de=(()=>{class EmailReplyModal{constructor(e,t,s,i,l,n,d,o,a,c){this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=d,this.session=o,this.userpreferences=a,this.dockedcomposer=c,this.self=null,this.sending=!1,this.titlelabel="LBL_EMAIL_REPLY",this.mode="reply",this.mailsent=new r.vpe,this.componentconfig={},this.model.module="Emails",this.view.isEditable=!0,this.view.setEditMode(),this.componentconfig=this.metadata.getComponentConfig("EmailReplyModal",this.model.module)}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1);let e=[];for(let t of this.parent.getField("recipient_addresses"))if("from"==t.address_type){let s={...t};s.address_type="to",s.id="",e.push(s)}else if("from"!=t.address_type&&"to"!=t.address_type){let s={...t};s.id="",e.push(s)}this.model.setFields({recipient_addresses:e,reference_id:this.parent.id,name:this.language.getLabel("LBL_RE")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()})}buildHistoryText(){let e=new moment.utc(this.parent.getField("date_sent")).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0)),t=e?e.format(this.userpreferences.getDateFormat()):"",s=e?e.format(this.userpreferences.getTimeFormat()):"",i="";return i+="<br><br>",i+="<div spicecrm_reply_quote='' class='spicecrm_reply_quote'>",i+="<div dir='ltr' class='crm_attr'>",i+="<b>"+this.language.getLabel("LBL_FROM")+":</b> <a href='mailto:"+this.parent.getField("from_addr")+"'>"+this.parent.getField("from_addr")+"</a>",i+="<br>",i+="<b>"+this.language.getLabel("LBL_DATE_SENT")+":</b> "+t+" "+s,i+="<br>",i+="<b>"+this.language.getLabel("LBL_TO")+":</b> "+this.parent.getField("to_addrs"),i+="<br>",i+="<b>"+this.language.getLabel("LBL_SUBJECT")+":</b> "+this.parent.getField("data.name"),i+="<br><br>",i+="</div>",i+='<blockquote class="crm_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">',i+=this.parent.getField("body").replace('data-signature=""',"").replace('spicecrm_temp_quote=""',""),i+="</blockquote>",i+="</div>",i}get isDisabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}close(){this.self.destroy()}dock(){this.dockedcomposer.addComposer(this.model.module,this.model),this.close()}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"outbound",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe((t=>{e.instance.self.destroy(),this.mailsent.emit(!0),this.close()}),(t=>{e.instance.self.destroy(),this.sending=!1}))}))}handleaction(e){this.close()}}return EmailReplyModal.ɵfac=function(e){return new(e||EmailReplyModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(_.o,4),r.Y36(y.e),r.Y36(ee.z),r.Y36(M.o),r.Y36(te.n),r.Y36(ee.z),r.Y36(se.m))},EmailReplyModal.ɵcmp=r.Xpm({type:EmailReplyModal,selectors:[["email-reply-modal"]],outputs:{mailsent:"mailsent"},features:[r._Bn([y.e,_.o])],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.TgZ(3,"system-modal-header-right")(4,"button",3),r.NdJ("click",(function(){return t.dock()})),r._UZ(5,"system-button-icon",4),r.TgZ(6,"span",5),r._UZ(7,"system-label",6),r.qZA()()()(),r.TgZ(8,"system-modal-content"),r._UZ(9,"system-componentset",7),r.qZA(),r.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.NdJ("actionemitter",(function(e){return t.handleaction(e)})),r.qZA()()()()),2&e&&(r.xp6(2),r.Q6J("label",t.titlelabel),r.xp6(2),r.Q6J("title",t.language.getLabel("LBL_DOCK")),r.xp6(5),r.Q6J("componentset",t.componentconfig.componentset),r.xp6(3),r.Q6J("actionset",t.componentconfig.actionset))},dependencies:[ie.S,x.J,le.E,v._,S.j,Y.x,J.p,F.y,ne.O],encapsulation:2}),EmailReplyModal})(),oe=(()=>{class EmailForwardButton{constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailForwardModal",!0,this.injector)}}return EmailForwardButton.ɵfac=function(e){return new(e||EmailForwardButton)(r.Y36(r.zs3),r.Y36(_.o),r.Y36(u.Pu),r.Y36(M.o))},EmailForwardButton.ɵcmp=r.Xpm({type:EmailForwardButton,selectors:[["ng-component"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_FORWARD"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[v._],encapsulation:2}),EmailForwardButton})(),ae=(()=>{class EmailForwardModal extends de{constructor(e,t,s,i,l,n,d,o,a,c,r,m){super(e,t,s,i,l,n,d,o,a,c),this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=d,this.session=o,this.userpreferences=a,this.dockedcomposer=c,this.modelattachments=r,this.backend=m,this.titlelabel="LBL_EMAIL_FORWARD"}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1),this.model.setFields({recipient_addresses:[],reference_id:this.parent.id,name:this.language.getLabel("LBL_FW")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()}),this.loadParentAttachments()}loadParentAttachments(){this.modelattachments.module="Emails",this.modelattachments.id=this.model.id,this.modelattachments.cloneAttachments(this.parent)}}return EmailForwardModal.ɵfac=function(e){return new(e||EmailForwardModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(_.o,4),r.Y36(y.e),r.Y36(ee.z),r.Y36(M.o),r.Y36(te.n),r.Y36(ee.z),r.Y36(se.m),r.Y36(B.H),r.Y36(E.y))},EmailForwardModal.ɵcmp=r.Xpm({type:EmailForwardModal,selectors:[["ng-component"]],features:[r._Bn([y.e,_.o,B.H]),r.qOj],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.TgZ(3,"system-modal-header-right")(4,"button",3),r.NdJ("click",(function(){return t.dock()})),r._UZ(5,"system-button-icon",4),r.TgZ(6,"span",5),r._UZ(7,"system-label",6),r.qZA()()()(),r.TgZ(8,"system-modal-content"),r._UZ(9,"system-componentset",7),r.qZA(),r.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.NdJ("actionemitter",(function(e){return t.handleaction(e)})),r.qZA()()()()),2&e&&(r.xp6(2),r.Q6J("label",t.titlelabel),r.xp6(2),r.Q6J("title",t.language.getLabel("LBL_DOCK")),r.xp6(5),r.Q6J("componentset",t.componentconfig.componentset),r.xp6(3),r.Q6J("actionset",t.componentconfig.actionset))},dependencies:[ie.S,x.J,le.E,v._,S.j,Y.x,J.p,F.y,ne.O],encapsulation:2}),EmailForwardModal})(),ce=(()=>{class EmailSendButton{constructor(e,t,s){this.model=e,this.metadata=t,this.modal=s,this.actionemitter=new r.vpe,this.sending=!1}get disabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}execute(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:!0,from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe((t=>{e.instance.self.destroy(),this.actionemitter.emit("emailsent")}),(t=>{e.instance.self.destroy(),this.sending=!1}))}))}}return EmailSendButton.ɵfac=function(e){return new(e||EmailSendButton)(r.Y36(_.o),r.Y36(u.Pu),r.Y36(M.o))},EmailSendButton.ɵcmp=r.Xpm({type:EmailSendButton,selectors:[["email-send-button"]],outputs:{actionemitter:"actionemitter"},decls:2,vars:0,consts:[["label","LBL_SEND"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[v._],encapsulation:2}),EmailSendButton})();var re=s(2644),me=s(3278);let ue=(()=>{class EmailSchedulesButton{constructor(e,t,s,i,l,n,d){this.language=e,this.metadata=t,this.model=s,this.modellist=i,this.modal=l,this.injector=n,this.toast=d,this.hidden=!0,this.maxCount=50}ngOnInit(){this.findEmailsLink()}get disabled(){return 0==this.modellist.getSelectedCount()||this.modellist.getSelectedCount()>this.maxCount}get exportcount(){let e=this.modellist.getSelectedCount();return e||this.modellist.listData.totalcount}findEmailsLink(){if(!this.metadata.checkModuleAcl("EmailSchedules","create"))return;let e=this.metadata.getModuleFields(this.model.module);for(let t in e){let s=e[t];("emails"==t||"link"==s.type&&"Emails"==s.module)&&(this.hidden=!1)}}execute(){this.model.fields.hasOwnProperty("emails")?this.modal.openModal("EmailSchedulesModal",!0,this.injector):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}}return EmailSchedulesButton.ɵfac=function(e){return new(e||EmailSchedulesButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(re.t),r.Y36(M.o),r.Y36(r.zs3),r.Y36(me.A))},EmailSchedulesButton.ɵcmp=r.Xpm({type:EmailSchedulesButton,selectors:[["email-schedules-button"]],decls:4,vars:1,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.TgZ(2,"span"),r._uU(3),r.qZA()()),2&e&&(r.xp6(3),r.hij(" (",t.exportcount,")"))},dependencies:[v._],encapsulation:2}),EmailSchedulesButton})(),he=(()=>{class EmailSchedulesCancelButton{constructor(e,t,s){this.model=e,this.modal=t,this.backend=s,this.actionemitter=new r.vpe}get disabled(){return!this.model.checkAccess("edit")||"open"!=this.model.getField("email_schedule_status")}execute(){this.modal.confirm("MSG_CANCEL_EMAILSCHEDULE","MSG_CANCEL_EMAILSCHEDULE").subscribe((e=>{e&&this.backend.putRequest(`module/EmailSchedules/${this.model.id}/cancel`).subscribe((e=>{this.model.setField("email_schedule_status","cancelled"),this.actionemitter.emit("save")}))}))}}return EmailSchedulesCancelButton.ɵfac=function(e){return new(e||EmailSchedulesCancelButton)(r.Y36(_.o),r.Y36(M.o),r.Y36(E.y))},EmailSchedulesCancelButton.ɵcmp=r.Xpm({type:EmailSchedulesCancelButton,selectors:[["email-schedules-cancel-button"]],outputs:{actionemitter:"actionemitter"},decls:1,vars:0,consts:[["label","LBL_CANCEL"]],template:function(e,t){1&e&&r._UZ(0,"system-label",0)},dependencies:[v._],encapsulation:2}),EmailSchedulesCancelButton})();var pe=s(2995);let ge=(()=>{class EmailSchedulesModal{constructor(e,t,s,i,l,n,d,o,a,c){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=d,this.modellist=o,this.backend=a,this.toast=c,this.self={},this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1)}close(){this.self.destroy()}get canSave(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}saveSchedule(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t=this.modellist.getSelectedIDs(),s={module:this.modellist.module,ids:t,data:this.model.data,modulefilter:this.modellist.modulefilter,searchterm:this.modellist.searchTerm,aggregates:this.modellist.selectedAggregates};this.backend.postRequest(`module/EmailSchedules/${this.model.id}`,{},s).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}}return EmailSchedulesModal.ɵfac=function(e){return new(e||EmailSchedulesModal)(r.Y36(m.d),r.Y36(_.o),r.Y36(_.o,4),r.Y36(r.zs3),r.Y36(y.e),r.Y36(M.o),r.Y36(u.Pu),r.Y36(re.t),r.Y36(E.y),r.Y36(me.A))},EmailSchedulesModal.ɵcmp=r.Xpm({type:EmailSchedulesModal,selectors:[["email-schedules-modal"]],features:[r._Bn([_.o,y.e])],decls:11,vars:3,consts:[["title","LBL_EMAIL_SCHEDULES"],[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","none",3,"grow"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.qZA(),r.TgZ(3,"system-modal-content",3),r._UZ(4,"system-dynamic-component",4)(5,"system-dynamic-component",5),r.qZA(),r.TgZ(6,"system-modal-footer")(7,"button",6),r.NdJ("click",(function(){return t.sendTestEmail()})),r._UZ(8,"system-label",7),r.qZA(),r.TgZ(9,"button",8),r.NdJ("click",(function(){return t.saveSchedule()})),r._UZ(10,"system-label",2),r.qZA()()()),2&e&&(r.xp6(3),r.Q6J("grow",!0),r.xp6(4),r.Q6J("disabled",!t.canSave),r.xp6(2),r.Q6J("disabled",!t.canSave))},dependencies:[pe.T,v._,S.j,Y.x,J.p,F.y],encapsulation:2}),EmailSchedulesModal})();var be=s(7579);let fe=(()=>{class EmailSchedulesRelatedButton{constructor(e,t,s,i,l,n,d){this.language=e,this.metadata=t,this.model=s,this.modal=i,this.injector=l,this.backend=n,this.toast=d,this.linkedBeans=[]}execute(){let e=this.modal.await(this.language.getLabel("LBL_LOADING"));this.checkEmailsLink().subscribe((t=>{e.emit(!0),t&&this.modal.openModal("EmailSchedulesRelatedModal",!0,this.injector).subscribe((e=>{e.instance.linkedBeans=this.linkedBeans,e.instance.modelId=this.modelId,e.instance.currentModule=this.model.module}))}))}checkEmailsLink(){let e=new be.x,t=[];Object.keys(this.model.fields).forEach((e=>{if("link"==this.model.fields[e].type){let s=this.model.fields[e].name;for(let e in this.metadata.fieldDefs)e.toLowerCase()==s&&t.push(e)}}));let s=[];for(let e in t){let i=t[e];Object.keys(this.metadata.fieldDefs).forEach((e=>{null!=this.metadata.fieldDefs[e]&&e==i&&(this.metadata.fieldDefs[e].hasOwnProperty("email")||this.metadata.fieldDefs[e].hasOwnProperty("email1"))&&s.push(i)}))}let i={modules:s};return this.backend.getRequest(`module/EmailSchedules/${this.model.module}/${this.model.id}`,i).subscribe((t=>{t.status?(this.linkedBeans=t.linkedBeans,this.modelId=t.beanId,e.next(t.status)):(e.next(!1),this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error"));for(let e in this.linkedBeans){let t=this.linkedBeans[e];t.vname=this.model.fields[t.link].vname}e.complete()})),e.asObservable()}}return EmailSchedulesRelatedButton.ɵfac=function(e){return new(e||EmailSchedulesRelatedButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(M.o),r.Y36(r.zs3),r.Y36(E.y),r.Y36(me.A))},EmailSchedulesRelatedButton.ɵcmp=r.Xpm({type:EmailSchedulesRelatedButton,selectors:[["email-schedules-related-button"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[v._],encapsulation:2}),EmailSchedulesRelatedButton})();var _e=s(7514),ye=s(4561),Ee=s(151);function xe(e,t){1&e&&(r.TgZ(0,"div",41),r._uU(1,"("),r._UZ(2,"system-label",42),r._uU(3,")"),r.qZA())}function ve(e,t){if(1&e&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.hij("(",e.email1,")")}}const Ze=function(e){return{"slds-text-color--inverse-weak":e}},Le=function(e){return{"text-decoration":e}};function Te(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"tr"),r._UZ(1,"td"),r.TgZ(2,"td",43)(3,"div",44)(4,"div"),r._uU(5),r.qZA(),r.YNc(6,ve,2,1,"div",23),r.qZA()(),r.TgZ(7,"td",33),r._UZ(8,"system-utility-icon",45),r.qZA(),r.TgZ(9,"td",34)(10,"button",46)(11,"system-button-icon",47),r.NdJ("click",(function(){const t=r.CHM(e).index,s=r.oxw(2).$implicit,i=r.oxw();return r.KtG(i.removeBean(s,t))})),r.qZA()()()()}if(2&e){const e=t.$implicit;r.xp6(2),r.Q6J("ngClass",r.VKq(6,Ze,e.deleted))("ngStyle",r.VKq(8,Le,e.deleted?"line-through":"inherit")),r.xp6(3),r.Oqu(e.summary_text),r.xp6(1),r.Q6J("ngIf",e.email1),r.xp6(2),r.Q6J("icon","link"==e.source?"linked":"user"),r.xp6(3),r.Q6J("icon",!0===e.deleted?"undo":"delete")}}function we(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Te,12,10,"tr",21),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.Q6J("ngForOf",e.linkedbeans)}}const Me=function(e){return{"slds-disabled-text":e}};function ke(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"tr",27)(2,"td")(3,"system-checkbox",28),r.NdJ("ngModelChange",(function(t){const s=r.CHM(e).$implicit;return r.KtG(s.selected=t)})),r.qZA()(),r.TgZ(4,"td")(5,"div",29)(6,"div",16),r._UZ(7,"system-icon",30),r.qZA(),r.TgZ(8,"div",16),r._UZ(9,"system-label-modulename",31),r.qZA(),r.YNc(10,xe,4,0,"div",32),r.qZA()(),r.TgZ(11,"td",33)(12,"div",29)(13,"div",16),r._uU(14),r.qZA()()(),r.TgZ(15,"td",34)(16,"button",35),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw();return r.KtG(s.expandRelated(t))})),r._UZ(17,"system-button-icon",36),r.qZA(),r.TgZ(18,"button",37),r.NdJ("click",(function(){const t=r.CHM(e).$implicit;return r.KtG(t.open=!t.open)})),r._UZ(19,"system-button-icon",38),r.qZA(),r.TgZ(20,"button",39)(21,"system-button-icon",40),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw();return r.KtG(s.addBean(t))})),r.qZA()()()(),r.YNc(22,we,2,1,"ng-container",23),r.BQk()}if(2&e){const e=t.$implicit,s=r.oxw();r.xp6(1),r.Q6J("ngClass",r.VKq(15,Me,e.disabled&&(!e.linkedbeans||0==e.linkedbeans.length))),r.xp6(2),r.Q6J("disabled",e.disabled||e.expanded)("ngModel",e.selected),r.xp6(4),r.Q6J("addclasses",!e.disabled||e.linkedbeans&&0!=e.linkedbeans.length?null:"slds-icon_disabled")("size","small")("module",e.module),r.xp6(2),r.Q6J("module",e.module),r.xp6(1),r.Q6J("ngIf",e.count>s.maxCount),r.xp6(4),r.AsE("",s.getLinkCount(e)," / ",e.count,""),r.xp6(2),r.Q6J("disabled",e.expanded||0==e.count||e.count>s.maxCount),r.xp6(2),r.Q6J("disabled",!e.linkedbeans),r.xp6(1),r.Q6J("icon",!0===e.open?"up":"down"),r.xp6(1),r.Q6J("disabled",e.count>s.maxCount),r.xp6(2),r.Q6J("ngIf",!0===e.open)}}function Ae(e,t){1&e&&(r.TgZ(0,"div"),r._UZ(1,"system-label",42),r.qZA())}const Be=function(e){return{"slds-is-active":e}},Ce=function(e){return{"slds-hide":e}};let Se=(()=>{class EmailSchedulesRelatedModal{constructor(e,t,s,i,l,n,d,o,a){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=d,this.backend=o,this.toast=a,this.self={},this.activetab="recipients",this.linkedBeans=[],this.maxCount=50,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1),this.fiilterProspects()}fiilterProspects(){this.linkedBeans=this.linkedBeans.map((e=>(e.disabled=0==e.count||e.count>this.maxCount,e.selected=!1,e.expanded=!1,e)))}close(){this.self.destroy()}get canSchedule(){if(!this.model.getField("mailbox_id")||!this.model.getField("email_subject"))return!1;let e=this.selectedCount;return!(0==e||e>this.maxCount)}get selectedCount(){let e=0;return this.linkedBeans.forEach((t=>{t.selected?e+=t.count:t.linkedbeans&&(e+=t.linkedbeans.filter((e=>!e.deleted)).length)})),e}saveSchedule(){this.canSchedule&&this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={links:this.linkedBeans.filter((e=>e.selected)).map((e=>e.module)),data:this.model.data,linkedbeans:this.linkedbeans};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/${this.parentModel.module}/${this.parentModel.id}`,{},t).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}get linkedbeans(){let e={};for(let t of this.linkedBeans){if(!t.linkedbeans)continue;let s=t.linkedbeans.filter((e=>!e.deleted)).map((e=>e.id));s.length>0&&(e[t.module]=s)}return e}getLinkCount(e){if(e.expanded)return e.linkedbeans?e.linkedbeans.filter((e=>!e.deleted)).length:0;let t=e.selected?parseInt(e.count,10):0;return e.linkedbeans&&(t+=e.linkedbeans.length),t}expandRelated(e){if(e.expanded)e.open=!e.open;else{let t=this.modal.await("LBL_LOADING");e.selected=!1,e.expanded=!0,this.backend.getRequest(`module/${this.parentModel.module}/${this.parentModel.id}/related/${e.link}`,{getcount:0,excludeinactive:1,offset:0,limit:100}).subscribe((s=>{e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let t in s)s[t].source="link",s[t].deleted=!1,e.linkedbeans.push(s[t]);this.sortLinkedBeans(e),t.emit(!0)}),(()=>{this.toast.sendToast("LBL_ERROR","error"),t.emit(!0)}))}}addBean(e){this.modal.openModal("ObjectModalModuleLookup").subscribe((t=>{t.instance.module=e.module,t.instance.multiselect=!0,t.instance.selectedItems.subscribe((t=>{if(t.length){e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let s of t)-1==e.linkedbeans.findIndex((e=>e.id==s.id))&&(s.source="user",e.linkedbeans.push(s));this.sortLinkedBeans(e)}}))}))}sortLinkedBeans(e){e.linkedbeans.sort(((e,t)=>e.last_name?e.last_name.localeCompare(t.last_name):e.summary_text.localeCompare(t.summary_text)))}removeBean(e,t){"link"==e.linkedbeans[t].source?e.linkedbeans[t].deleted=!e.linkedbeans[t].deleted:e.linkedbeans.splice(t,1)}get canSendTest(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}}return EmailSchedulesRelatedModal.ɵfac=function(e){return new(e||EmailSchedulesRelatedModal)(r.Y36(m.d),r.Y36(_.o),r.Y36(_.o,4),r.Y36(r.zs3),r.Y36(y.e),r.Y36(M.o),r.Y36(u.Pu),r.Y36(E.y),r.Y36(me.A))},EmailSchedulesRelatedModal.ɵcmp=r.Xpm({type:EmailSchedulesRelatedModal,selectors:[["email-schedules-related-modal"]],features:[r._Bn([_.o,y.e])],decls:36,vars:18,consts:[[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","x-small"],[1,"slds-tabs_scoped"],["role","tablist",1,"slds-tabs_scoped__nav"],["title","Emails","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link",3,"click"],["title","Recipients","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small",2,"height","70vh",3,"ngClass"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small","slds-scrollable--y",2,"height","70vh",3,"ngClass"],[1,"slds-table","slds-box--border"],[1,"slds-text-title_caps"],["scope","col",2,"width","2rem"],["scope","col",1,"slds-resizable"],[1,"slds-truncate"],["label","LBL_LINK"],["scope","col",1,"slds-text-align--center",2,"width","5rem"],["label","LBL_COUNT"],["scope","col",2,"width","4rem"],[4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical-align-center"],[4,"ngIf"],[1,"slds-button","slds-col--bump-left","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],[3,"ngClass"],[3,"disabled","ngModel","ngModelChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small"],[3,"addclasses","size","module"],[3,"module"],["class","slds-truncate slds-p-horizontal--x-small",4,"ngIf"],[1,"slds-text-align--center"],[1,"slds-text-align--right"],["system-title","LBL_EXPAND",1,"slds-button","slds-button--icon",3,"disabled","click"],["icon","expand_all"],["system-title","LBL_TOGGLE",1,"slds-button","slds-button--icon",3,"disabled","click"],[3,"icon"],["system-title","LBL_ADD",1,"slds-button","slds-button--icon",3,"disabled"],["icon","new",3,"click"],[1,"slds-truncate","slds-p-horizontal--x-small"],["label","LBL_MAX50RECORDS"],[3,"ngClass","ngStyle"],[1,"slds-grid","slds-grid--align-spread"],["size","xx-small",3,"icon"],["system-title","LBL_DELETE",1,"slds-button","slds-button--icon"],[3,"icon","click"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal")(1,"system-modal-header",0),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",1),r.qZA(),r.TgZ(3,"system-modal-content",2)(4,"div",3)(5,"ul",4)(6,"li",5)(7,"a",6),r.NdJ("click",(function(){return t.activetab="emails"})),r._uU(8),r.qZA()(),r.TgZ(9,"li",7)(10,"a",6),r.NdJ("click",(function(){return t.activetab="recipients"})),r._uU(11),r.qZA()()(),r.TgZ(12,"div",8),r._UZ(13,"system-dynamic-component",9)(14,"system-dynamic-component",10),r.qZA(),r.TgZ(15,"div",11)(16,"table",12)(17,"thead")(18,"tr",13),r._UZ(19,"th",14),r.TgZ(20,"th",15)(21,"div",16),r._UZ(22,"system-label",17),r.qZA()(),r.TgZ(23,"th",18)(24,"div",16),r._UZ(25,"system-label",19),r.qZA()(),r._UZ(26,"th",20),r.qZA()(),r.TgZ(27,"tbody"),r.YNc(28,ke,23,17,"ng-container",21),r.qZA()()()()(),r.TgZ(29,"system-modal-footer")(30,"div",22),r.YNc(31,Ae,2,0,"div",23),r.TgZ(32,"button",24),r.NdJ("click",(function(){return t.sendTestEmail()})),r._UZ(33,"system-label",25),r.qZA(),r.TgZ(34,"button",26),r.NdJ("click",(function(){return t.saveSchedule()})),r._UZ(35,"system-label",1),r.qZA()()()()),2&e&&(r.xp6(6),r.Q6J("ngClass",r.VKq(10,Be,"emails"==t.activetab)),r.xp6(2),r.Oqu(t.language.getLabel("LBL_EMAILS")),r.xp6(1),r.Q6J("ngClass",r.VKq(12,Be,"recipients"==t.activetab)),r.xp6(2),r.Oqu(t.language.getLabel("LBL_RECIPIENTS")),r.xp6(1),r.Q6J("ngClass",r.VKq(14,Ce,"emails"!=t.activetab)),r.xp6(3),r.Q6J("ngClass",r.VKq(16,Ce,"recipients"!=t.activetab)),r.xp6(13),r.Q6J("ngForOf",t.linkedBeans),r.xp6(3),r.Q6J("ngIf",t.selectedCount>t.maxCount),r.xp6(1),r.Q6J("disabled",!t.canSendTest),r.xp6(2),r.Q6J("disabled",!t.canSchedule))},dependencies:[i.mk,i.sg,i.O5,i.PC,l.JJ,l.On,x.J,_e.U,pe.T,ye.f,v._,Z.M,S.j,Y.x,J.p,F.y,V.r,Ee.S],encapsulation:2}),EmailSchedulesRelatedModal})();var Ye=s(4567),Je=s(4730),Fe=s(4021);function Oe(e,t){if(1&e&&(r.TgZ(0,"tr",14)(1,"td")(2,"div",10),r._uU(3),r.qZA()(),r.TgZ(4,"td")(5,"div",10),r._uU(6),r.qZA()(),r.TgZ(7,"td")(8,"div",10),r._uU(9),r.qZA()()()),2&e){const e=t.$implicit;r.xp6(3),r.Oqu(e.id),r.xp6(3),r.Oqu(e.subject),r.xp6(3),r.Oqu(e.status)}}function qe(e,t){if(1&e&&(r.TgZ(0,"table",8)(1,"thead")(2,"tr",9)(3,"th")(4,"div",10),r._uU(5,"Id"),r.qZA()(),r.TgZ(6,"th")(7,"div",10),r._UZ(8,"system-label",11),r.qZA()(),r.TgZ(9,"th")(10,"div",10),r._UZ(11,"system-label",12),r.qZA()()()(),r.TgZ(12,"tbody"),r.YNc(13,Oe,10,3,"tr",13),r.qZA()()),2&e){const e=r.oxw();r.xp6(13),r.Q6J("ngForOf",e.emailschedules)}}function Ne(e,t){1&e&&(r.TgZ(0,"div",15)(1,"system-illustration-no-records"),r._UZ(2,"system-label",16),r.qZA()())}function Ue(e,t){1&e&&(r.TgZ(0,"div",15)(1,"system-illustration-no-access"),r._UZ(2,"system-label",17),r.qZA()())}let Ie=(()=>{class EmailSchedulesView{constructor(e,t,s,i,l){this.language=e,this.model=t,this.view=s,this.metadata=i,this.backend=l,this.emailschedules=[],this.locked=!1,this.isLoading=!1,this.getData()}refresh(){this.getData()}getData(){this.isLoading=!0,this.backend.getRequest(`module/EmailSchedules/myopen/${this.model.id}`).subscribe((e=>{e.status?(this.isLoading=!1,this.emailschedules=e.openschedules):this.locked=!0}))}}return EmailSchedulesView.ɵfac=function(e){return new(e||EmailSchedulesView)(r.Y36(m.d),r.Y36(_.o),r.Y36(y.e),r.Y36(u.Pu),r.Y36(E.y))},EmailSchedulesView.ɵcmp=r.Xpm({type:EmailSchedulesView,selectors:[["email-schedules-view"]],features:[r._Bn([y.e])],decls:10,vars:8,consts:[[3,"system-overlay-loading-spinner"],[1,"slds-grid","slds-p-around--small",2,"align-items","center"],[1,"slds-col","slds-grow-none",3,"module","title"],[1,"slds-grow"],[1,"slds-col--bump-left","slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","refresh"],["width","100%","class","slds-table slds-table_cell-buffer slds-table_bordered",4,"ngIf"],["class","slds-align--absolute-center slds-m-around--large",4,"ngIf"],["width","100%",1,"slds-table","slds-table_cell-buffer","slds-table_bordered"],[1,"slds-line-height_reset"],[1,"slds-truncate"],["label","LBL_SUBJECT"],["label","LBL_STATUS"],["class","slds-hint-parent",4,"ngFor","ngForOf"],[1,"slds-hint-parent"],[1,"slds-align--absolute-center","slds-m-around--large"],["label","MSG_NO_RECORDS_FOUND"],["label","LBL_NO_ACCESS"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r._UZ(2,"system-icon",2),r.TgZ(3,"h2",3),r._uU(4),r.qZA(),r.TgZ(5,"button",4),r.NdJ("click",(function(){return t.getData()})),r._UZ(6,"system-button-icon",5),r.qZA()(),r.YNc(7,qe,14,1,"table",6),r.YNc(8,Ne,3,0,"div",7),r.YNc(9,Ue,3,0,"div",7),r.qZA()),2&e&&(r.Q6J("system-overlay-loading-spinner",t.isLoading),r.xp6(2),r.Q6J("module","EmailSchedules")("title","EmailSchedules"),r.xp6(2),r.Oqu(t.language.getModuleName("EmailSchedules")),r.xp6(1),r.Q6J("disabled",t.isLoading),r.xp6(2),r.Q6J("ngIf",t.emailschedules.length>0),r.xp6(1),r.Q6J("ngIf",0==t.emailschedules.length&&!t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.isLoading&&t.locked))},dependencies:[i.sg,i.O5,x.J,ye.f,Ye.s,Je.C,v._,Fe._],encapsulation:2}),EmailSchedulesView})();var Re=s(727),Qe=s(2161),je=s(1790),De=s(7763);const He=function(e,t){return{module:e,data:t}};function Pe(e,t){if(1&e&&(r.TgZ(0,"tr",9)(1,"td")(2,"div",10),r._UZ(3,"system-icon",11),r.TgZ(4,"div",3),r._uU(5),r.qZA()()(),r.TgZ(6,"td")(7,"div",3),r._uU(8),r.qZA()()()),2&e){const e=t.$implicit;r.Q6J("system-model-provider",r.WLB(4,He,e.module,e.data)),r.xp6(3),r.Q6J("module",e.module),r.xp6(2),r.Oqu(e.summary_text),r.xp6(3),r.Oqu(e.status)}}function ze(e,t){1&e&&r._UZ(0,"tbody",12),2&e&&r.Q6J("rows",10)}let Ge=(()=>{class EmailSchedulesBeans{constructor(e,t,s){this.model=e,this.metadata=t,this.backend=s,this.loading=!1,this.subscriptions=new Re.w0,this.subscriptions.add(this.model.data$.subscribe((e=>{this.getData()})))}ngOnDestroy(){this.subscriptions.unsubscribe()}getData(){!this.model.getField("email_schedule_status")||this.loadedStatus&&this.loadedStatus==this.model.getField("email_schedule_status")||(this.beans=[],this.loading=!0,this.loadedStatus=this.model.getField("email_schedule_status"),this.backend.getRequest(`module/EmailSchedules/${this.model.id}/beans`).subscribe((e=>{this.beans=e,this.loading=!1})))}}return EmailSchedulesBeans.ɵfac=function(e){return new(e||EmailSchedulesBeans)(r.Y36(_.o),r.Y36(u.Pu),r.Y36(E.y))},EmailSchedulesBeans.ɵcmp=r.Xpm({type:EmailSchedulesBeans,selectors:[["email-schedules-beans"]],decls:12,vars:2,consts:[[1,"slds-table","slds-table--fixed-layout","slds-table_bordered","slds-box--border"],[1,"slds-line-height_reset"],["scope","col",2,"width","99%"],[1,"slds-truncate"],["label","LBL_NAME"],["scope","col",2,"width","5rem"],["label","LBL_STATUS"],["class","slds-hint-parent",3,"system-model-provider",4,"ngFor","ngForOf"],["system-table-stencils","","columns","2",3,"rows",4,"ngIf"],[1,"slds-hint-parent",3,"system-model-provider"],["system-model-popover","",1,"slds-grid","slds-grid--vertical-align-center"],["size","x-small",3,"module"],["system-table-stencils","","columns","2",3,"rows"]],template:function(e,t){1&e&&(r.TgZ(0,"table",0)(1,"thead")(2,"tr",1)(3,"th",2)(4,"div",3),r._UZ(5,"system-label",4),r.qZA()(),r.TgZ(6,"th",5)(7,"div",3),r._UZ(8,"system-label",6),r.qZA()()()(),r.TgZ(9,"tbody"),r.YNc(10,Pe,9,7,"tr",7),r.qZA(),r.YNc(11,ze,1,1,"tbody",8),r.qZA()),2&e&&(r.xp6(10),r.Q6J("ngForOf",t.beans),r.xp6(1),r.Q6J("ngIf",t.loading))},dependencies:[i.sg,i.O5,ye.f,v._,Qe.x,je.g,De.u],encapsulation:2}),EmailSchedulesBeans})();function $e(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",1),r.qZA())}let Ve=(()=>{class EmailActionSetReadButton{constructor(e,t,s){this.language=e,this.metadata=t,this.model=s,this.displayasicon=!1}get hidden(){return!("unread"==this.model.getFieldValue("status")||!this.model.isEditing)}get disabled(){return!this.model.checkAccess("edit")||(this.model.isEditing||this.model.isSaving)}execute(){this.model.setField("status","read")}}return EmailActionSetReadButton.ɵfac=function(e){return new(e||EmailActionSetReadButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o))},EmailActionSetReadButton.ɵcmp=r.Xpm({type:EmailActionSetReadButton,selectors:[["email-action-set-read-button"]],decls:1,vars:1,consts:[[4,"ngIf"],["label","LBL_SET_READ"]],template:function(e,t){1&e&&r.YNc(0,$e,2,0,"span",0),2&e&&r.Q6J("ngIf",!t.displayasicon)},dependencies:[i.O5,v._],encapsulation:2}),EmailActionSetReadButton})();var Ke=s(3634),Xe=s(1553),We=s(6271);function et(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",4)(1,"div",19)(2,"span",20)(3,"span",21),r._UZ(4,"system-icon",22),r.qZA(),r.TgZ(5,"span",23),r._uU(6),r.qZA(),r.TgZ(7,"button",24),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.clearSelectedItem())})),r._UZ(8,"system-button-icon",25),r.qZA()()()()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("module",e.previewForBean),r.xp6(2),r.hij(" ",e.selectedItem.text," "),r.xp6(2),r.Q6J("icon","close")}}function tt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",26),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.searchWithModal())})),r._UZ(1,"input",27),r.TgZ(2,"button",28),r._UZ(3,"system-button-icon",29),r.qZA()()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("disabled",!e.previewForBean)("placeholder",e.placeholder),r.xp6(1),r.Q6J("disabled",!e.previewForBean)}}function st(e,t){if(1&e&&(r.TgZ(0,"div")(1,"div",30),r._UZ(2,"div",31),r.TgZ(3,"span",32),r._uU(4),r.qZA()(),r._UZ(5,"iframe",33),r.qZA()),2&e){const e=r.oxw();r.Udp("width",e.viewType.width,"px"),r.xp6(4),r.hij(" ",e.viewType.width,"px "),r.xp6(1),r.Udp("height",e.iframeHeight,"px"),r.Q6J("src",e.parsedHtml,r.uOi)}}function it(e,t){1&e&&(r.TgZ(0,"div",34),r._UZ(1,"system-label",35),r.qZA())}let lt=(()=>{class EmailTemplatesPreview{constructor(e,t,s,i,l,n,d,o){this.language=e,this.backend=t,this.metadata=s,this.model=i,this.modal=l,this.toast=n,this.sanitizer=d,this.cdRef=o,this.viewTypeOptions=[{title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},{title:"LBL_TABLET",icon:"tablet_portrait",value:"tablet",width:768},{title:"LBL_MOBILE",icon:"phone_portrait",value:"mobile",width:320}],this.viewType={title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},this.subscription=new Re.w0,this.bodyHtmlField="body_html",this.iframeHeight=250}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnDestroy(){this.subscription.unsubscribe()}subscribeToModelChanges(){this.subscription.add(this.model.data$.subscribe((()=>{this.setPlaceholder(),this.selectedItem&&this.selectedItem.module==this.previewForBean||this.clearSelectedItem()})))}setPlaceholder(){this.placeholder=this.previewForBean?this.language.getModuleCombinedLabel("LBL_SEARCH",this.previewForBean):this.language.getLabel("LBL_SEARCH"),this.cdRef.detectChanges()}searchWithModal(){this.previewForBean&&this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.previewForBean,e.instance.multiselect=!1,this.subscription.add(e.instance.selectedItems.subscribe((e=>{e&&e.length&&(this.selectedItem={id:e[0].id,text:e[0].summary_text,module:this.previewForBean},this.compileBody())})))}))}clearSelectedItem(){this.selectedItem=void 0,this.parsedHtml=void 0,this.cdRef.detectChanges()}compileBody(){if(!this.model.id)return;const e=this.modal.await("LBL_PARSING_HTML"),t={html:this.model.getField(this.bodyHtmlField)};this.backend.postRequest(`module/${this.model.module}/${this.model.id}/livecompile/${this.previewForBean}/${this.selectedItem.id}`,{},t).subscribe((t=>{if(!t||!t.html)return e.emit(!1),e.unsubscribe();this.parsedHtml=this.sanitizer.bypassSecurityTrustResourceUrl("data:text/html;charset=UTF-8,"+encodeURIComponent(t.html)),this.cdRef.detectChanges(),e.emit(!0),e.unsubscribe()}),(()=>{this.toast.sendToast(this.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),e.emit(!1),e.unsubscribe()}))}setViewType(e){this.viewType=this.viewTypeOptions.find((t=>t.value==e))}}return EmailTemplatesPreview.ɵfac=function(e){return new(e||EmailTemplatesPreview)(r.Y36(m.d),r.Y36(E.y),r.Y36(u.Pu),r.Y36(_.o),r.Y36(M.o),r.Y36(me.A),r.Y36(A.H7),r.Y36(r.sBO))},EmailTemplatesPreview.ɵcmp=r.Xpm({type:EmailTemplatesPreview,selectors:[["email-templates-preview"]],inputs:{bodyHtmlField:"bodyHtmlField",previewForBean:"previewForBean",iframeHeight:"iframeHeight"},decls:20,vars:9,consts:[[1,"slds-grid","slds-grid--vertical-align-end","slds-gutters_direct-xx-small"],[1,"slds-col","slds-grow","slds-form-element"],[1,"slds-form-element__label"],["label","LBL_RECORD"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",3,"click",4,"ngIf"],[1,"slds-button","slds-button--icon-border","slds-m-horizontal--xx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-form-element"],["label","LBL_DISPLAY"],[1,"slds-form-element__control","slds-p-top--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom","slds-grid","slds-p-around--xx-small","slds-grid","slds-grid--align-center"],[3,"width",4,"ngIf"],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],["size","small",3,"module"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow",3,"click"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare",3,"disabled","placeholder"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled"],["icon","search"],[1,"slds-size--1-of-1","slds-grid","slds-grid--vertical-align-center","slds-is-relative","slds-m-vertical--xx-small",2,"height","16px","border-left","1px solid #aaa","border-right","1px solid #aaa"],[2,"height","1px","width","100%","background","#aaa"],[1,"slds-theme--default","slds-p-horizontal--xx-small","slds-is-absolute",2,"left","50%","transform","translateX(-50%)"],["sandbox","",1,"slds-size--1-of-1",2,"border","0","resize","vertical",3,"src"],[1,"slds-align--absolute-center","slds-height_full"],["label","MSG_NO_RECORD_SELECTED"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"label",2),r._UZ(3,"system-label",3),r.qZA(),r.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),r.YNc(8,et,9,3,"div",8),r.YNc(9,tt,4,3,"div",9),r.qZA()()()()(),r.TgZ(10,"button",10),r.NdJ("click",(function(){return t.compileBody()})),r._UZ(11,"system-button-icon",11),r.qZA(),r.TgZ(12,"div",12)(13,"label",2),r._UZ(14,"system-label",13),r.qZA(),r.TgZ(15,"div",14)(16,"system-input-radio-button-group",15),r.NdJ("ngModelChange",(function(e){return t.setViewType(e)})),r.qZA()()()(),r.TgZ(17,"div",16),r.YNc(18,st,6,6,"div",17),r.YNc(19,it,2,0,"div",18),r.qZA()),2&e&&(r.xp6(8),r.Q6J("ngIf",t.selectedItem),r.xp6(1),r.Q6J("ngIf",!t.selectedItem),r.xp6(1),r.Q6J("disabled",!t.selectedItem),r.xp6(6),r.Q6J("ngModel",t.viewType.value)("inputOptions",t.viewTypeOptions),r.xp6(1),r.Udp("min-height",t.iframeHeight,"px"),r.xp6(1),r.Q6J("ngIf",t.parsedHtml),r.xp6(1),r.Q6J("ngIf",!t.selectedItem))},dependencies:[i.O5,l.JJ,l.On,x.J,ye.f,We.p,v._],encapsulation:2,changeDetection:0}),EmailTemplatesPreview})();const nt=function(e,t){return{"slds-is-active":e,"slds-text-color--inverse-weak":t}};function dt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"li",12),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.setSelectedTab("preview"))})),r.TgZ(1,"a",5),r._UZ(2,"system-label",13),r.qZA()()}if(2&e){const e=r.oxw(2);r.Q6J("ngClass",r.WLB(3,nt,"preview"==e.selectedTab,!e.model.data[e.fieldsNames.bodyHtmlField])),r.xp6(1),r.ekj("slds-text-color--inverse-weak",!e.model.data[e.fieldsNames.bodyHtmlField])}}function ot(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",14),r.NdJ("dblclick",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.setEditMode())})),r.TgZ(1,"button",15),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.setEditMode())})),r._UZ(2,"system-button-icon",16),r.qZA()()}2&e&&(r.xp6(2),r.Q6J("icon","edit"))}function at(e,t){if(1&e&&r._UZ(0,"field-container",27),2&e){const e=r.oxw(3);r.Q6J("field",e.fieldsNames.subjectField)}}const ct=function(){return{fieldtype:"mailboxes",scope:"outboundmass"}};function rt(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(3);r.Q6J("field",e.fieldsNames.mailboxField)("fieldconfig",r.DdM(2,ct))}}const mt=function(){return{fieldtype:"richtext",hidelabel:!0}};function ut(e,t){if(1&e&&r._UZ(0,"field-container",29),2&e){const e=r.oxw(3);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,mt))}}const ht=function(e){return{fieldtype:"pagebuilder",hidelabel:!0,bodySPBField:e}};function pt(e,t){if(1&e&&r._UZ(0,"field-container",29),2&e){const e=r.oxw(3);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.VKq(2,ht,e.fieldsNames.bodySPBField))}}const gt=function(){return{fieldtype:"html",hidelabel:!0}};function bt(e,t){if(1&e&&r._UZ(0,"field-container",29),2&e){const e=r.oxw(3);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,gt))}}function ft(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r._UZ(1,"system-label",30),r.TgZ(2,"button",31),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(3);return r.KtG(t.updateModelEditor("richText"))})),r._UZ(3,"system-label",32),r.qZA(),r._UZ(4,"system-label",33),r.TgZ(5,"button",34),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(3);return r.KtG(t.updateModelEditor("pageBuilder"))})),r._UZ(6,"system-label",35),r.qZA(),r._UZ(7,"system-label",33),r.TgZ(8,"button",34),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(3);return r.KtG(t.updateModelEditor("html"))})),r._UZ(9,"system-label",36),r.qZA()()}}function _t(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",17),r.YNc(1,at,1,1,"field-container",18),r.YNc(2,rt,1,3,"field-container",19),r.TgZ(3,"div",20)(4,"button",21),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.copyFromTemplate())})),r._UZ(5,"system-button-icon",22)(6,"system-label",23),r.qZA()()(),r.TgZ(7,"div",24),r.YNc(8,ut,1,3,"field-container",25),r.YNc(9,pt,1,4,"field-container",25),r.YNc(10,bt,1,3,"field-container",25),r.YNc(11,ft,10,0,"div",26),r.qZA()}if(2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("ngIf",!!e.fieldsNames.subjectField),r.xp6(1),r.Q6J("ngIf",!!e.fieldsNames.mailboxField),r.xp6(2),r.Q6J("disabled",!e.view.isEditMode()),r.xp6(3),r.Q6J("ngSwitch",e.activeEditor),r.xp6(1),r.Q6J("ngSwitchCase","richText"),r.xp6(1),r.Q6J("ngSwitchCase","pageBuilder"),r.xp6(1),r.Q6J("ngSwitchCase","html")}}const yt=function(e,t){return{"slds-show":e,"slds-hide":t}};function Et(e,t){if(1&e&&(r.TgZ(0,"div",8),r._UZ(1,"email-templates-preview",37),r.qZA()),2&e){const e=r.oxw(2);r.Q6J("ngClass",r.WLB(4,yt,"preview"==e.selectedTab,"preview"!=e.selectedTab)),r.xp6(1),r.Q6J("previewForBean",e.fieldsNames.previewForBean)("bodyHtmlField",e.fieldsNames.bodyHtmlField)("iframeHeight",e.iframeHeight)}}function xt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"system-collapsable-tab",1)(1,"div",2)(2,"ul",3)(3,"li",4),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setSelectedTab("editor"))})),r.TgZ(4,"a",5),r._UZ(5,"system-label",6),r.qZA()(),r.YNc(6,dt,3,6,"li",7),r.qZA(),r.TgZ(7,"div",8),r.YNc(8,ot,3,1,"div",9),r.YNc(9,_t,12,7,"ng-template",null,10,r.W1O),r.qZA(),r.YNc(11,Et,2,7,"div",11),r.qZA()()}if(2&e){const e=r.MAs(10),t=r.oxw();r.xp6(3),r.ekj("slds-is-active","editor"==t.selectedTab),r.xp6(3),r.Q6J("ngIf",!!t.fieldsNames.previewForBean),r.xp6(1),r.Q6J("ngClass",r.WLB(7,yt,"editor"==t.selectedTab,"editor"!=t.selectedTab)),r.xp6(1),r.Q6J("ngIf",!t.view.isEditMode()&&!t.model.data[t.fieldsNames.bodyHtmlField])("ngIfElse",e),r.xp6(3),r.Q6J("ngIf",!!t.fieldsNames.previewForBean)}}let vt=(()=>{class EmailTemplatesEditor{constructor(e,t,s,i,l){this.model=e,this.cdRef=t,this.modal=s,this.injector=i,this.view=l,this.selectedTab="editor",this.fieldsNames={bodyHtmlField:"body_html",bodySPBField:"body_spb"},this.iframeHeight=250,this.subscription=new Re.w0}get isHidden(){return this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}ngAfterViewInit(){this.setActiveEditor(this.model.getField("editor_type")),this.subscribeToModelChanges()}ngOnInit(){this.setBodyFieldsName(),this.setIframeHeight()}ngOnDestroy(){this.subscription.unsubscribe()}setEditMode(){this.model.startEdit(),this.view.setEditMode(),this.cdRef.detectChanges()}setIframeHeight(){const e=parseInt(this.componentconfig.previewInitialHeight,10);e&&!isNaN(e)&&(this.iframeHeight=e)}setBodyFieldsName(){this.componentconfig.bodyHtmlField&&(this.fieldsNames.bodyHtmlField=this.componentconfig.bodyHtmlField),this.componentconfig.bodySPBField&&(this.fieldsNames.bodySPBField=this.componentconfig.bodySPBField),this.componentconfig.subjectField&&(this.fieldsNames.subjectField=this.componentconfig.subjectField),this.componentconfig.mailboxField&&(this.fieldsNames.mailboxField=this.componentconfig.mailboxField),this.componentconfig.previewForBean&&(this.fieldsNames.previewForBean=this.componentconfig.previewForBean)}subscribeToModelChanges(){this.subscription.add(this.model.observeFieldChanges("editor_type").subscribe((e=>{this.setActiveEditor(e)}))),this.subscription.add(this.view.mode$.subscribe((()=>this.cdRef.detectChanges())))}setActiveEditor(e){this.activeEditor=e,this.cdRef.detectChanges()}setSelectedTab(e){("preview"!=e||this.model.getField(this.fieldsNames.bodyHtmlField))&&(this.selectedTab=e)}copyFromTemplate(){this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe((e=>{e.instance.module="EmailTemplates",e.instance.multiselect=!1,e.instance.selectedItems.subscribe((e=>{e.length&&this.model.setFields({[this.fieldsNames.bodyHtmlField]:e[0].body_html,[this.fieldsNames.bodySPBField]:e[0].body_spb})}))}))}updateModelEditor(e){this.setActiveEditor(e),this.model.setField("editor_type",e)}}return EmailTemplatesEditor.ɵfac=function(e){return new(e||EmailTemplatesEditor)(r.Y36(_.o),r.Y36(r.sBO),r.Y36(M.o),r.Y36(r.zs3),r.Y36(y.e))},EmailTemplatesEditor.ɵcmp=r.Xpm({type:EmailTemplatesEditor,selectors:[["email-templates-editor"]],decls:1,vars:1,consts:[["tabtitle","LBL_CONTENT",4,"ngIf"],["tabtitle","LBL_CONTENT"],[1,"slds-tabs_scoped","slds-p-around--x-small"],["role","tablist",1,"slds-tabs_scoped__nav"],["system-title","LBL_EDITOR","role","presentation",1,"slds-tabs_scoped__item",3,"click"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link"],["label","LBL_EDITOR"],["class","slds-tabs_scoped__item","system-title","LBL_PREVIEW","role","presentation",3,"ngClass","click",4,"ngIf"],["role","tabpanel",1,"slds-tabs_scoped__content",3,"ngClass"],["class","slds-grid slds-grid--vertical-align-start slds-grid--align-end","style","min-height: 250px",3,"dblclick",4,"ngIf","ngIfElse"],["contentEditingContainer",""],["class","slds-tabs_scoped__content","role","tabpanel",3,"ngClass",4,"ngIf"],["system-title","LBL_PREVIEW","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass","click"],["label","LBL_PREVIEW"],[1,"slds-grid","slds-grid--vertical-align-start","slds-grid--align-end",2,"min-height","250px",3,"dblclick"],[1,"slds-button","slds-button--icon","spice-hover-button",3,"click"],[3,"icon"],[1,"slds-grid","slds-m-bottom--xx-small"],["class","slds-grow slds-m-right--x-small","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small","class","slds-m-right--x-small",3,"field","fieldconfig",4,"ngIf"],[1,"slds-align-bottom","slds-col--bump-left","slds-p-bottom--xx-small"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","copy","position","left"],["label","LBL_COPY_TEMPLATE"],[1,"slds-grid","slds-grid--align-center","slds-grid--vertical-align-center",2,"min-height","250px",3,"ngSwitch"],["class","slds-size--1-of-1",3,"field","fieldconfig",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow","slds-m-right--x-small",3,"field"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-m-right--x-small",3,"field","fieldconfig"],[1,"slds-size--1-of-1",3,"field","fieldconfig"],["label","LBL_EDIT_WITH",1,"slds-m-right--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button",3,"click"],["label","LBL_RICH_TEXT_EDITOR"],["label","LBL_OR",1,"slds-m-horizontal--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button","slds-m-lef",3,"click"],["label","LBL_PAGE_BUILDER"],["label","LBL_HTML"],[3,"previewForBean","bodyHtmlField","iframeHeight"]],template:function(e,t){1&e&&r.YNc(0,xt,12,10,"system-collapsable-tab",0),2&e&&r.Q6J("ngIf",!t.isHidden)},dependencies:[i.mk,i.O5,i.RF,i.n9,i.ED,Ke.j,x.J,Xe.z,v._,Ee.S,lt],encapsulation:2,changeDetection:0}),EmailTemplatesEditor})();var Zt=s(3369),Lt=s(6625),Tt=s(5638),wt=s(3398);function Mt(e,t){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}const kt=function(e,t){return{"text-decoration":e,"font-weight":t}};function At(e,t){if(1&e&&(r.TgZ(0,"field-generic-display",4)(1,"div",5)(2,"div",6),r._UZ(3,"system-utility-icon",7),r.qZA(),r.TgZ(4,"div",8),r._uU(5),r.qZA()()()),2&e){const e=r.oxw();r.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig)("fieldid",e.fieldid),r.xp6(2),r.Q6J("system-title",e.statusLabel),r.xp6(1),r.Q6J("icon",e.statusIcon),r.xp6(1),r.Q6J("title",e.value)("ngStyle",r.WLB(9,kt,"user_closed"==e.model.data.openness||"system_closed"==e.model.data.openness?"line-through":"initial","unread"==e.model.data.status?"bold":"initial")),r.xp6(1),r.hij(" ",e.value," ")}}function Bt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",9)(1,"input",10),r.NdJ("ngModelChange",(function(t){r.CHM(e);const s=r.oxw();return r.KtG(s.value=t)})),r.qZA(),r._UZ(2,"field-messages",11),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("ngClass",e.getFieldClass()),r.xp6(1),r.Q6J("ngModel",e.value)("maxlength",e.fieldlength)("autocomplete",e.fieldid)("ngModelOptions",e.modelOptions),r.xp6(1),r.Q6J("fieldname",e.fieldname)}}let Ct=(()=>{class fieldEmailSubject extends P.O{constructor(e,t,s,i,l,n,d,o,a,c,r,m,u){super(e,t,s,i,d),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=d,this.injector=o,this.broadcast=a,this.configurationService=c,this.modal=r,this.cdRef=m,this.sanitized=u}get statusIcon(){switch(this.model.getField("status")){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get statusLabel(){switch(this.model.getField("status")){case"opened":case"read":return"LBL_OPEN";case"bounced":case"deferred":case"send_error":return"LBL_ERROR";case"sent":return"LBL_OUTBOUND";default:return"LBL_UNREAD"}}}return fieldEmailSubject.ɵfac=function(e){return new(e||fieldEmailSubject)(r.Y36(_.o),r.Y36(y.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(E.y),r.Y36(me.A),r.Y36(z.F0),r.Y36(r.zs3),r.Y36(Zt.f),r.Y36(Lt.C),r.Y36(M.o),r.Y36(r.sBO),r.Y36(A.H7))},fieldEmailSubject.ɵcmp=r.Xpm({type:fieldEmailSubject,selectors:[["field-email-subject"]],features:[r.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],["class","slds-form-element__control slds-is-relative","style","position:relative;",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-right--x-small",3,"system-title"],["size","x-small",3,"icon"],[1,"slds-truncate",3,"title","ngStyle"],[1,"slds-form-element__control","slds-is-relative",2,"position","relative",3,"ngClass"],["system-placeholder","","type","text",1,"slds-input",3,"ngModel","maxlength","autocomplete","ngModelOptions","ngModelChange"],[3,"fieldname"]],template:function(e,t){1&e&&(r.YNc(0,Mt,1,2,"field-label",0),r.YNc(1,At,6,12,"field-generic-display",1),r.YNc(2,Bt,3,6,"div",2)),2&e&&(r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("ngIf",!t.isEditMode()),r.xp6(1),r.Q6J("ngIf",t.isEditable()&&t.isEditMode()))},dependencies:[i.mk,i.O5,i.PC,l.Fj,l.JJ,l.nD,l.On,G.q,$.D,Tt.a,V.r,wt.A,Ee.S],encapsulation:2}),fieldEmailSubject})();function St(e,t){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Yt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setOpenness("user_closed"))})),r._UZ(1,"system-button-icon",5),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function Jt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setOpenness("open"))})),r._UZ(1,"system-button-icon",6),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}let Ft=(()=>{class fieldEmailActivityOpenness extends P.O{constructor(e,t,s,i,l,n,d){super(e,t,s,i,d),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=d}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest(`module/${this.model.module}/${this.model.id}/openness`,null,{openness:e}).subscribe((e=>{}),(t=>{this.toast.sendAlert("Cannot change openness to "+e)}))}}return fieldEmailActivityOpenness.ɵfac=function(e){return new(e||fieldEmailActivityOpenness)(r.Y36(_.o),r.Y36(y.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(E.y),r.Y36(me.A),r.Y36(z.F0))},fieldEmailActivityOpenness.ɵcmp=r.Xpm({type:fieldEmailActivityOpenness,selectors:[["field-email-activity-openness"]],features:[r.qOj],decls:4,vars:4,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngClass"],["class","slds-button slds-button--icon",3,"disabled","title","click",4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-button","slds-button--icon",3,"disabled","title","click"],["icon","unlock"],["icon","lock"]],template:function(e,t){1&e&&(r.YNc(0,St,1,2,"field-label",0),r.TgZ(1,"div",1),r.YNc(2,Yt,2,2,"button",2),r.YNc(3,Jt,2,2,"button",2),r.qZA()),2&e&&(r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("ngClass",t.getFieldClass()),r.xp6(1),r.Q6J("ngIf","open"==t.model.data.openness),r.xp6(1),r.Q6J("ngIf","user_closed"==t.model.data.openness||"system_closed"==t.model.data.openness))},dependencies:[i.mk,i.O5,G.q,x.J],encapsulation:2}),fieldEmailActivityOpenness})();function Ot(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",9)(1,"div")(2,"system-checkbox",10),r.NdJ("ngModelChange",(function(t){const s=r.CHM(e).$implicit;return r.KtG(s.selected=t)})),r.qZA()(),r.TgZ(3,"div"),r._UZ(4,"system-icon",11),r.qZA(),r.TgZ(5,"div",12),r._uU(6),r.qZA(),r.TgZ(7,"div"),r._uU(8),r.qZA()()}if(2&e){const e=t.$implicit;r.xp6(2),r.Q6J("ngModel",e.selected),r.xp6(2),r.Q6J("module",e.module),r.xp6(2),r.Oqu(e.summary_text),r.xp6(2),r.hij("(",e.email_address,")")}}function qt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"system-modal",1)(1,"system-modal-header",2),r.NdJ("close",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.close())})),r._UZ(2,"system-label",3),r.qZA(),r.TgZ(3,"system-modal-content"),r.YNc(4,Ot,9,4,"div",4),r.qZA(),r.TgZ(5,"system-modal-footer")(6,"button",5),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.close())})),r._UZ(7,"system-label",6),r.qZA(),r.TgZ(8,"button",7),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.add())})),r._UZ(9,"system-label",8),r.qZA()()()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("ngForOf",e.addresses),r.xp6(4),r.Q6J("disabled",!e.canAdd)}}let Nt=(()=>{class EmailParentAddressesModal{constructor(e,t,s,i){this.model=e,this.modal=t,this.toast=s,this.backend=i,this.addresses=[],this.addAddresses=new r.vpe}ngOnInit(){let e=this.modal.await("LBL_LOADING");this.backend.getRequest(`module/EmailAddresses/${this.model.getField("parent_type")}/${this.model.getField("parent_id")}`).subscribe((t=>{this.addresses=t,0==this.addresses.length&&(this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","info"),this.close()),e.emit(!0)}),(()=>{this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","error"),e.emit(!0),this.close()}))}get canAdd(){return this.addresses.filter((e=>e.selected)).length>0}add(){this.addAddresses.emit(this.addresses.filter((e=>e.selected))),this.close()}close(){this.self.destroy()}}return EmailParentAddressesModal.ɵfac=function(e){return new(e||EmailParentAddressesModal)(r.Y36(_.o),r.Y36(M.o),r.Y36(me.A),r.Y36(E.y))},EmailParentAddressesModal.ɵcmp=r.Xpm({type:EmailParentAddressesModal,selectors:[["email-parent-addresses-modal"]],decls:1,vars:1,consts:[["size","small",4,"ngIf"],["size","small"],[3,"close"],["label","LBL_SELECT_PARENT_EMAIL"],["class","slds-grid slds-p-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-button","slds-button_neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button_brand",3,"disabled","click"],["label","LBL_ADD"],[1,"slds-grid","slds-p-vertical--xx-small"],[3,"ngModel","ngModelChange"],["size","x-small",3,"module"],[1,"slds-p-right--small"]],template:function(e,t){1&e&&r.YNc(0,qt,10,2,"system-modal",0),2&e&&r.Q6J("ngIf",t.addresses.length>0)},dependencies:[i.sg,i.O5,l.JJ,l.On,_e.U,ye.f,v._,S.j,Y.x,J.p,F.y],encapsulation:2}),EmailParentAddressesModal})();var Ut=s(3917);const It=["contextMenu"];function Rt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"li",7)(1,"a",8),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw(2);return r.KtG(s.setField(t))})),r.TgZ(2,"span",9),r._UZ(3,"system-label-fieldname",10),r.qZA()()()}if(2&e){const e=t.$implicit,s=r.oxw(2);r.xp6(3),r.Q6J("module",s.emailmodule)("field",e)}}function Qt(e,t){if(1&e&&(r.TgZ(0,"div",3,4)(2,"ul",5),r.YNc(3,Rt,4,2,"li",6),r.qZA()()),2&e){const e=r.oxw();r.Q6J("ngStyle",e.contextMenuStyle),r.xp6(3),r.Q6J("ngForOf",e.emailfields)}}let jt=(()=>{class EmailToLeadEmailText{constructor(e,t,s){this.elementRef=e,this.renderer=t,this.language=s,this.emailtext="",this.emailhtml="",this.emailmodule="",this.emailfields=["first_name","last_name"],this.setfield=new r.vpe,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return EmailToLeadEmailText.ɵfac=function(e){return new(e||EmailToLeadEmailText)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(m.d))},EmailToLeadEmailText.ɵcmp=r.Xpm({type:EmailToLeadEmailText,selectors:[["email-to-lead-emailtext"]],viewQuery:function(e,t){if(1&e&&r.Gf(It,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),r.qZA(),r.YNc(2,Qt,4,2,"div",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("innerHTML",t.content,r.oJD),r.xp6(1),r.Q6J("ngIf",t.displayContextMenu))},dependencies:[i.sg,i.O5,i.PC,h.h],encapsulation:2}),EmailToLeadEmailText})();const Dt=["detailcontainer"];let Ht=(()=>{class EmailToLeadModal{constructor(e,t,s,i,l,n){this.language=e,this.metadata=t,this.view=s,this.model=i,this.footer=l,this.toast=n,this.email=null,this.self=null,this.componentRefs=[],this.leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"],this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}}return EmailToLeadModal.ɵfac=function(e){return new(e||EmailToLeadModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(y.e),r.Y36(_.o),r.Y36(Ut.M),r.Y36(me.A))},EmailToLeadModal.ɵcmp=r.Xpm({type:EmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&r.Gf(Dt,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.detailcontainer=e.first)}},features:[r._Bn([_.o,y.e])],decls:20,vars:5,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",(function(){return t.closeModal()})),r._UZ(4,"system-button-icon",4),r.qZA(),r.TgZ(5,"h2",5),r._UZ(6,"system-label",6),r.qZA()(),r.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"email-to-lead-emailtext",10),r.NdJ("setfield",(function(e){return t.setField(e)})),r.qZA()(),r.TgZ(11,"div",11),r._UZ(12,"div",null,12),r.qZA()()(),r.TgZ(14,"div",13)(15,"button",14),r.NdJ("click",(function(){return t.closeModal()})),r._UZ(16,"system-label",15),r.qZA(),r.TgZ(17,"button",16),r.NdJ("click",(function(){return t.saveLead()})),r._UZ(18,"system-label",17),r.qZA()()()(),r._UZ(19,"div",18)),2&e&&(r.xp6(4),r.Q6J("icon","close"),r.xp6(6),r.Q6J("emailmodule",t.model.module)("emailtext",t.email.data.body)("emailhtml",t.email.data.body)("emailfields",t.leadFields))},dependencies:[x.J,v._,jt],encapsulation:2}),EmailToLeadModal})(),Pt=(()=>{class EmailToLeadButton{constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.model=s,this.footer=i,this.toast=l}createLead(){this.metadata.addComponent("EmailToLeadModal",this.footer.footercontainer).subscribe((e=>{e.instance.email=this.model,e.instance.self=e}))}}return EmailToLeadButton.ɵfac=function(e){return new(e||EmailToLeadButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(Ut.M),r.Y36(me.A))},EmailToLeadButton.ɵcmp=r.Xpm({type:EmailToLeadButton,selectors:[["ng-component"]],hostAttrs:[1,"slds-button","slds-button--neutral"],hostBindings:function(e,t){1&e&&r.NdJ("click",(function(){return t.createLead()}))},decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[v._],styles:["[_nghost-%COMP%]{cursor:pointer}"]}),EmailToLeadButton})(),zt=(()=>{class ModuleEmails{}return ModuleEmails.ɵfac=function(e){return new(e||ModuleEmails)},ModuleEmails.ɵmod=r.oAB({type:ModuleEmails}),ModuleEmails.ɵinj=r.cJS({imports:[i.ez,l.u5,d.ObjectFields,o.GlobalComponents,a.ObjectComponents,c.SystemComponents,n.o]}),ModuleEmails})();("undefined"==typeof ngJitMode||ngJitMode)&&r.kYT(zt,{declarations:[k,f,T,I,D,H,X,W,de,ce,oe,ae,ue,ge,fe,he,Se,Ie,Ge,Ve,vt,lt,Nt,Ct,Ft,Ht,jt,Pt],imports:[i.ez,l.u5,d.ObjectFields,o.GlobalComponents,a.ObjectComponents,c.SystemComponents,n.o]})}}]);