/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:47:00
 *
 *                     build: 2024.01.001.1717778820753
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_emails_moduleemails_ts"],{95271:(e,t,s)=>{s.r(t),s.d(t,{ModuleEmails:()=>Gs});var i=s(60177),l=s(84341),n=s(71341),a=s(7745),d=s(12948),o=s(37328),c=s(70569),r=s(54438),m=s(69904),h=s(83935),u=s(45915);const f=["contextMenu"];function b(e,t){if(1&e){const e=r.RV6();r.j41(0,"li",7)(1,"a",8),r.bIt("click",(function(){const t=r.eBV(e).$implicit,s=r.XpG(2);return r.Njj(s.setField(t))})),r.j41(2,"span",9),r.nrm(3,"system-label-fieldname",10),r.k0s()()()}if(2&e){const e=t.$implicit,s=r.XpG(2);r.R7$(3),r.Y8G("module",s.target_module_name)("field",e)}}function g(e,t){if(1&e&&(r.j41(0,"div",3,4)(2,"ul",5),r.DNE(3,b,4,2,"li",6),r.k0s()()),2&e){const e=r.XpG();r.Y8G("ngStyle",e.contextMenuStyle),r.R7$(3),r.Y8G("ngForOf",e.target_module_fields)}}let p=(()=>{class EmailToObjectEmailText{constructor(e,t,s,i){this.elementRef=e,this.renderer=t,this.language=s,this.metadata=i,this.text="",this.html="",this.target_module_name="",this.target_module_fields=[],this.setfield=new r.bkB,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.html?this.html:this.text}get striped_content(){return this._striped_content||(this.html?this._striped_content=this.html.replace(/<!--.*?-->/gs,"").replace(/<[^>]+>/g,"").replace(/[ ]{2,}/g," ").replace(/[\n\r]{3,}/g,"\n"):this._striped_content=this.text),this._striped_content}ngOnInit(){if(!this.target_module_fields||0===this.target_module_fields.length){let e=["varchar","text"],t=this.metadata.getModuleFields(this.target_module_name);for(let s in t)e.indexOf(t[s].type)>=0&&t[s].vname&&"id"!==t[s].name&&this.target_module_fields.push(s)}}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static#e=this.ɵfac=function(e){return new(e||EmailToObjectEmailText)(r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(m.B),r.rXU(h.yu))};static#t=this.ɵcmp=r.VBU({type:EmailToObjectEmailText,selectors:[["email-to-object-emailtext"]],viewQuery:function(e,t){if(1&e&&r.GBs(f,7,r.c1b),2&e){let e;r.mGM(e=r.lsd())&&(t.contextMenu=e.first)}},inputs:{text:"text",html:"html",target_module_name:"target_module_name",target_module_fields:"target_module_fields"},outputs:{setfield:"setfield"},decls:4,vars:3,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-input",2,"height","100%","width","100%","resize","none",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1),r.bIt("contextmenu",(function(e){return t.showContextMenu(e)})),r.EFF(2),r.k0s(),r.DNE(3,g,4,2,"div",2),r.k0s()),2&e&&(r.R7$(),r.Y8G("innerHTML",t.content,r.npT),r.R7$(),r.JRh(t.striped_content),r.R7$(),r.Y8G("ngIf",t.displayContextMenu))},dependencies:[i.Sq,i.bT,i.B3,u.P],encapsulation:2})}return EmailToObjectEmailText})();var _=s(35911),y=s(41731),v=s(49722),E=s(3719),k=s(25863),L=s(32062),R=s(44985),x=s(98427),j=s(37263);const B=["detailcontainer"];function U(e,t){if(1&e&&r.nrm(0,"object-record-fieldset",20),2&e){const e=r.XpG();r.Y8G("fieldset",e.componentconfig.emailFieldset)}}const F=(e,t)=>({module:"Emails",id:e,data:t});let M=(()=>{class EmailToObjectModal{constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.view=s,this.model=i,this.backend=l,this.email_model=null,this.self=null,this.componentRefs=[],this.save$=new r.bkB,this.object_fields=[]}ngOnInit(){if(this.model.module=this.object_module_name,this.model.initializeModel(this.email_model),this.componentconfig=this.metadata.getComponentConfig("EmailToObjectModal",this.model.module),this.object_predefined_fields){let e={};for(let t in this.object_predefined_fields)e[t]=this.object_predefined_fields[t];this.model.setFields(e)}this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}close(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}save(){this.model.validate()&&this.model.save().subscribe((e=>{this.object_relation_link_name?this.backend.postRequest("module/Emails/"+this.email_model.id+"/related/"+this.object_relation_link_name,[],[this.model.id]).subscribe((e=>{this.save$.emit(this.model.data),this.close()})):(this.save$.emit(this.model.data),this.close())}))}static#e=this.ɵfac=function(e){return new(e||EmailToObjectModal)(r.rXU(m.B),r.rXU(h.yu),r.rXU(y.U),r.rXU(_.g),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailToObjectModal,selectors:[["email-to-object-modal"]],viewQuery:function(e,t){if(1&e&&r.GBs(B,7,r.c1b),2&e){let e;r.mGM(e=r.lsd())&&(t.detailcontainer=e.first)}},inputs:{object_module_name:"object_module_name",object_fields:"object_fields",object_relation_link_name:"object_relation_link_name",object_predefined_fields:"object_predefined_fields"},outputs:{save$:"save$"},features:[r.Jv_([_.g,y.U])],decls:21,vars:12,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],[3,"module","singular"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],["system-view-provider","",1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%",3,"system-model-provider"],[3,"fieldset",4,"ngIf"],[3,"target_module_name","text","html","target_module_fields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"],[3,"fieldset"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.bIt("click",(function(){return t.close()})),r.nrm(4,"system-button-icon",4),r.k0s(),r.j41(5,"h2",5),r.nrm(6,"system-label-modulename",6),r.k0s()(),r.j41(7,"div",7)(8,"div",8)(9,"div",9),r.DNE(10,U,1,1,"object-record-fieldset",10),r.j41(11,"email-to-object-emailtext",11),r.bIt("setfield",(function(e){return t.setField(e)})),r.k0s()(),r.j41(12,"div",12),r.nrm(13,"div",null,13),r.k0s()()(),r.j41(15,"div",14)(16,"button",15),r.bIt("click",(function(){return t.close()})),r.nrm(17,"system-label",16),r.k0s(),r.j41(18,"button",17),r.bIt("click",(function(){return t.save()})),r.nrm(19,"system-label",18),r.k0s()()()(),r.nrm(20,"div",19)),2&e&&(r.R7$(4),r.Y8G("icon","close"),r.R7$(2),r.Y8G("module",t.object_module_name)("singular",!0),r.R7$(3),r.Y8G("system-model-provider",r.l_i(9,F,t.email_model.id,t.email_model.data)),r.R7$(),r.Y8G("ngIf",!(null==t.componentconfig||!t.componentconfig.emailFieldset)),r.R7$(),r.Y8G("target_module_name",t.object_module_name)("text",t.email_model.data.body)("html",t.email_model.data.body)("target_module_fields",t.object_fields))},dependencies:[i.bT,E.D,k.t,L.W,R.r,x.v,j.x,p],encapsulation:2})}return EmailToObjectModal})();var w=s(91107),G=s(50531);let I=(()=>{class EmailToObjectButton{constructor(e,t,s,i,l){this.language=e,this.model=t,this.metadata=s,this.modal=i,this.relatedmodels=l,this.actionemitter=new r.bkB}get disabled(){if(!this.metadata.checkModuleAcl(this.actionconfig.module,"create"))return!0;if(this.actionconfig.checklink){if(this.relatedmodels.isloading)return!0;if(this.relatedmodels.count>0)return!0}return!1}ngOnInit(){this.object_module_name=this.actionconfig.module,this.actionconfig.checklink&&this.subscribeToModel()}subscribeToModel(){this.subscription=this.model.data$.subscribe((e=>{this.getRelatedData()}))}ngOnDestroy(){this.subscription?.unsubscribe()}getRelatedData(){this.relatedmodels.module=this.model.module,this.relatedmodels.id=this.model.id,this.relatedmodels.relatedModule=this.actionconfig.module,this.relatedmodels.linkName=this.actionconfig.checklink,this.relatedmodels.getData()}execute(){this.modal.openModal("EmailToObjectModal",!0).subscribe((e=>{e.instance.email_model=this.model,e.instance.object_module_name=this.object_module_name,e.instance.object_relation_link_name=this.actionconfig.relation_link_name,e.instance.object_predefined_fields=this.actionconfig.predefined_fields,e.instance.save$.subscribe((e=>{this.actionemitter.emit("save")}))}))}static#e=this.ɵfac=function(e){return new(e||EmailToObjectButton)(r.rXU(m.B),r.rXU(_.g),r.rXU(h.yu),r.rXU(G.y),r.rXU(w.K))};static#t=this.ɵcmp=r.VBU({type:EmailToObjectButton,selectors:[["email-to-object-button"]],outputs:{actionemitter:"actionemitter"},features:[r.Jv_([w.K])],decls:3,vars:2,consts:[["label","LBL_CONVERT_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0)(2,"system-label-modulename",1),r.k0s()),2&e&&(r.R7$(2),r.Y8G("module",t.object_module_name)("singular",!0))},dependencies:[L.W,R.r],encapsulation:2})}return EmailToObjectButton})();var X=s(345),C=s(74547),S=s(40713),$=s(25028),T=s(88418),D=s(83524),Y=s(48717);function O(e,t){if(1&e&&(r.j41(0,"span",9),r.EFF(1),r.k0s()),2&e){const e=r.XpG();r.R7$(),r.SpI('"',e.model.data.name,'"')}}function N(e,t){1&e&&(r.j41(0,"div",10)(1,"div",11),r.nrm(2,"system-spinner"),r.j41(3,"div",12),r.EFF(4,"... "),r.nrm(5,"system-label",13),r.EFF(6," ..."),r.k0s()()())}function A(e,t){if(1&e&&r.nrm(0,"object-record-fieldset",14),2&e){const e=r.XpG();r.Y8G("fieldset",e.fieldset)}}let V=(()=>{class EmailPreviewModal{constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.sanitizer=s,this.backend=i,this.model=l,this.view=n,this.modelattachments=a,this.self={},this.type="",this.name="",this.isLoading=!0,this.model.module="Emails";let d=this.metadata.getComponentConfig("EmailPreviewModal",this.model.module);this.fieldset=d.fieldset}closeModal(){this.self.destroy()}ngOnInit(){this.backend.getRequest("module/Emails/msg/"+this.file.id).subscribe((e=>{this.model.setFields(this.model.utils.backendModel2spice("Emails",e)),this.isLoading=!1}))}download(){this.modelattachments.downloadAttachment(this.file.id,this.file.filename)}static#e=this.ɵfac=function(e){return new(e||EmailPreviewModal)(r.rXU(m.B),r.rXU(h.yu),r.rXU(X.up),r.rXU(v.H),r.rXU(_.g),r.rXU(y.U),r.rXU(C.S))};static#t=this.ɵcmp=r.VBU({type:EmailPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},features:[r.Jv_([_.g,y.U])],decls:10,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_EMAIL"],["class","slds-truncate",4,"ngIf"],["margin","none"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["direction","vertical",3,"fieldset",4,"ngIf"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","download","size","small"],[1,"slds-truncate"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-grid_vertical"],[1,"slds-p-around--small"],["label","LBL_LOADING"],["direction","vertical",3,"fieldset"]],template:function(e,t){1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.closeModal()})),r.nrm(2,"system-label",2),r.DNE(3,O,2,1,"span",3),r.k0s(),r.j41(4,"system-modal-content",4),r.DNE(5,N,7,0,"div",5)(6,A,1,1,"object-record-fieldset",6),r.k0s(),r.j41(7,"system-modal-footer")(8,"button",7),r.bIt("click",(function(){return t.download()})),r.nrm(9,"system-button-icon",8),r.k0s()()()),2&e&&(r.R7$(3),r.Y8G("ngIf",!t.isLoading),r.R7$(2),r.Y8G("ngIf",t.isLoading),r.R7$(),r.Y8G("ngIf",!t.isLoading),r.R7$(2),r.Y8G("disabled",t.isLoading))},dependencies:[i.bT,E.D,k.t,L.W,S.D,$.I,T.Q,D.C,Y.P],encapsulation:2})}return EmailPreviewModal})();var H=s(82802);function z(e,t){1&e&&(r.j41(0,"div",5),r.nrm(1,"system-spinner"),r.k0s())}function P(e,t){if(1&e&&(r.j41(0,"div",6)(1,"div"),r.EFF(2),r.k0s(),r.nrm(3,"div",7),r.k0s()),2&e){const e=r.XpG();r.R7$(2),r.SpI("subject: ",e.subject,""),r.R7$(),r.Y8G("innerHTML",e.body,r.npT)}}let q=(()=>{class EmailMSGPreviewModal{constructor(e,t,s){this.language=e,this.sanitizer=t,this.libloader=s,this.self={},this.type="",this.name="",this.libsloaded=!1}closeModal(){this.self.destroy()}set data(e){this.libloader.loadLib("msgreader").subscribe((e=>{}))}get subject(){return this.msgData?this.msgData.subject:""}get body(){return this.msgData?this.sanitizer.bypassSecurityTrustHtml(this.msgData.body.replace(/\n/g,"<br/>")):""}get objecttype(){if(!this.type)return"";let e=this.type.split("/");switch(e[0]){case"audio":case"video":return e[0];default:return"object"}}download(){let e=document.createElement("a");document.body.appendChild(e),e.href=this.blobUrl,e.download=this.name,e.click(),e.remove()}datatoBlob(e,t="",s=512){let i=[];for(let t=0;t<e.length;t+=s){let l=e.slice(t,t+s),n=new Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);let a=new Uint8Array(n);i.push(a)}return new Blob(i,{type:t})}static#e=this.ɵfac=function(e){return new(e||EmailMSGPreviewModal)(r.rXU(m.B),r.rXU(X.up),r.rXU(H.b))};static#t=this.ɵcmp=r.VBU({type:EmailMSGPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},decls:6,vars:3,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["class","slds-p-around--small slds-text-align--center",4,"ngIf"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-p-around--small","slds-text-align--center"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.closeModal()})),r.EFF(2,"Email Preview"),r.k0s(),r.j41(3,"system-modal-content",2),r.DNE(4,z,2,0,"div",3)(5,P,4,2,"div",4),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("grow",!0),r.R7$(),r.Y8G("ngIf",!t.msgData),r.R7$(),r.Y8G("ngIf",t.msgData))},dependencies:[i.bT,S.D,$.I,D.C,Y.P],encapsulation:2})}return EmailMSGPreviewModal})();var J=s(43308);function W(e,t){if(1&e&&r.nrm(0,"iframe",2),2&e){const e=r.XpG();r.Y8G("src",e.iframeUrl,r.f$h)}}function K(e,t){1&e&&(r.j41(0,"div",3),r.nrm(1,"system-stencil"),r.k0s())}let Z=(()=>{class EmailsPopoverBody{constructor(e,t,s){this.model=e,this.language=t,this.sanitized=s,this.isLoading=!1}ngOnInit(){this.isLoading=!0,this.model.generateFieldHtmlContentBlobUrl("body").subscribe((e=>{this.isLoading=!1,this.iframeUrl=e}))}static#e=this.ɵfac=function(e){return new(e||EmailsPopoverBody)(r.rXU(_.g),r.rXU(m.B),r.rXU(X.up))};static#t=this.ɵcmp=r.VBU({type:EmailsPopoverBody,selectors:[["ng-component"]],decls:2,vars:2,consts:[["style","height: 400px;","style","resize: vertical;","width","100%","frameborder","0","seamless","true","sandbox","",3,"src",4,"ngIf"],["class","slds-p-around--small",4,"ngIf"],["width","100%","frameborder","0","seamless","true","sandbox","",2,"resize","vertical",3,"src"],[1,"slds-p-around--small"]],template:function(e,t){1&e&&r.DNE(0,W,1,1,"iframe",0)(1,K,2,0,"div",1),2&e&&(r.Y8G("ngIf",!t.isLoading&&t.iframeUrl),r.R7$(),r.Y8G("ngIf",t.isLoading))},dependencies:[i.bT,J.O],encapsulation:2})}return EmailsPopoverBody})();var Q=s(13921),ee=s(57363),te=s(766),se=s(66935),ie=s(18521);function le(e,t){if(1&e&&r.nrm(0,"field-label",4),2&e){const e=r.XpG();r.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function ne(e,t){if(1&e&&(r.qex(0),r.nrm(1,"system-utility-icon",5)(2,"system-utility-icon",6)(3,"system-utility-icon",7),r.bVm()),2&e){const e=r.XpG();r.R7$(),r.Y8G("title",e.value)("icon",e.statusicon),r.R7$(),r.Y8G("title",e.direction)}}function ae(e,t){if(1&e&&r.nrm(0,"system-utility-icon",7)(1,"system-utility-icon",6)(2,"system-utility-icon",5),2&e){const e=r.XpG();r.R7$(),r.Y8G("title",e.direction),r.R7$(),r.Y8G("title",e.value)("icon",e.statusicon)}}let de=(()=>{class fieldEmailStatus extends Q.s{constructor(e,t,s,i,l){super(e,t,s,i,l),this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=l}get statusicon(){switch(this.value){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get direction(){return this.model.getField("type")}get directionicon(){switch(this.model.getField("type")){case"inbound":return"back";case"out":return"forward";default:return""}}static#e=this.ɵfac=function(e){return new(e||fieldEmailStatus)(r.rXU(_.g),r.rXU(y.U),r.rXU(m.B),r.rXU(h.yu),r.rXU(ee.Ix))};static#t=this.ɵcmp=r.VBU({type:fieldEmailStatus,selectors:[["ng-component"]],features:[r.Vt3],decls:5,vars:7,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[4,"ngIf","ngIfElse"],["inbound",""],[3,"fieldname","fieldconfig"],["size","x-small",3,"title","icon"],["size","xx-small","colorclass","slds-icon-text-light","icon","forward",1,"slds-p-horizontal--xx-small",3,"title"],["size","x-small","icon","user","colorclass","slds-icon-text-light"]],template:function(e,t){if(1&e&&(r.DNE(0,le,1,2,"field-label",0),r.j41(1,"field-generic-display",1),r.DNE(2,ne,4,3,"ng-container",2)(3,ae,3,3,"ng-template",null,3,r.C5r),r.k0s()),2&e){const e=r.sdS(4);r.Y8G("ngIf",t.displayLabel),r.R7$(),r.Y8G("fielddisplayclass",t.fielddisplayclass)("editable",!1)("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),r.R7$(),r.Y8G("ngIf","out"==t.direction)("ngIfElse",e)}},dependencies:[i.bT,te.b,se.K,ie.B],encapsulation:2})}return fieldEmailStatus})(),oe=(()=>{class EmailReplyButton{constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{null!=this.actionconfig.replymode&&(e.instance.mode=this.actionconfig.replymode)}))}static#e=this.ɵfac=function(e){return new(e||EmailReplyButton)(r.rXU(r.zZn),r.rXU(_.g),r.rXU(h.yu),r.rXU(G.y))};static#t=this.ɵcmp=r.VBU({type:EmailReplyButton,selectors:[["email-reply-button"]],decls:2,vars:1,consts:[[3,"label"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s()),2&e&&(r.R7$(),r.Y8G("label",t.actionconfig.label))},dependencies:[L.W],encapsulation:2})}return EmailReplyButton})();var ce=s(48849),re=s(29994),me=s(47866),he=s(44261),ue=s(60595),fe=s(88980);let be=(()=>{class EmailReplyModal{constructor(e,t,s,i,l,n,a,d,o,c){this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=a,this.session=d,this.userpreferences=o,this.dockedcomposer=c,this.self=null,this.sending=!1,this.titlelabel="LBL_EMAIL_REPLY",this.mode="reply",this.mailsent=new r.bkB,this.componentconfig={},this.model.module="Emails",this.view.isEditable=!0,this.view.setEditMode(),this.componentconfig=this.metadata.getComponentConfig("EmailReplyModal",this.model.module)}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1);let e=[];for(let t of this.parent.getField("recipient_addresses"))if("from"==t.address_type){let s={...t};s.address_type="to",s.id="",e.push(s)}else if("replyall"==this.mode&&("cc"==t.address_type||"to"==t.address_type)){let s={...t};s.address_type="cc",s.id="",e.push(s)}this.model.setFields({recipient_addresses:e,reference_id:this.parent.id,name:this.language.getLabel("LBL_RE")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()})}buildHistoryText(){let e=new moment.utc(this.parent.getField("date_sent")).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0)),t=e?e.format(this.userpreferences.getDateFormat()):"",s=e?e.format(this.userpreferences.getTimeFormat()):"",i="";i+="<br><br>",i+="<div data-spice-reply-quote='' class='spicecrm_reply_quote'>",i+="<div dir='ltr' class='crm_attr'>",i+="<b>"+this.language.getLabel("LBL_FROM")+":</b> <a href='mailto:"+this.parent.getField("from_addr")+"'>"+this.parent.getField("from_addr")+"</a>",i+="<br>",i+="<b>"+this.language.getLabel("LBL_DATE_SENT")+":</b> "+t+" "+s,i+="<br>",i+="<b>"+this.language.getLabel("LBL_TO")+":</b> "+this.parent.getField("to_addrs"),i+="<br>",i+="<b>"+this.language.getLabel("LBL_SUBJECT")+":</b> "+this.parent.getField("name"),i+="<br><br>",i+="</div>",i+='<blockquote class="crm_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">';const l=this.parent.getField("body").replace('data-signature=""',"").replace('data-spice-temp-quote=""',"");if(l.startsWith("<html>")){const e=document.createElement("html");e.innerHTML=l;const t=e.getElementsByTagName("body")[0];i+=t?t.innerHTML:l,e.remove()}else i+=l;return i+="</blockquote>",i+="</div>",i}get isDisabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}close(){this.self.destroy()}dock(){this.dockedcomposer.addComposer(this.model.module,this.model),this.close()}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"outbound",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe((t=>{e.instance.self.destroy(),this.mailsent.emit(!0),this.close()}),(t=>{e.instance.self.destroy(),this.sending=!1}))}))}handleaction(e){this.close()}static#e=this.ɵfac=function(e){return new(e||EmailReplyModal)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g),r.rXU(_.g,4),r.rXU(y.U),r.rXU(ce.S),r.rXU(G.y),r.rXU(re.d),r.rXU(ce.S),r.rXU(me.n))};static#t=this.ɵcmp=r.VBU({type:EmailReplyModal,selectors:[["email-reply-modal"]],outputs:{mailsent:"mailsent"},features:[r.Jv_([y.U,_.g])],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.close()})),r.nrm(2,"system-label",2),r.j41(3,"system-modal-header-right")(4,"button",3),r.bIt("click",(function(){return t.dock()})),r.nrm(5,"system-button-icon",4),r.j41(6,"span",5),r.nrm(7,"system-label",6),r.k0s()()()(),r.j41(8,"system-modal-content"),r.nrm(9,"system-componentset",7),r.k0s(),r.j41(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.bIt("actionemitter",(function(e){return t.handleaction(e)})),r.k0s()()()()),2&e&&(r.R7$(2),r.Y8G("label",t.titlelabel),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_DOCK")),r.R7$(5),r.Y8G("componentset",t.componentconfig.componentset),r.R7$(3),r.Y8G("actionset",t.componentconfig.actionset))},dependencies:[he.l,k.t,ue.F,L.W,S.D,$.I,T.Q,D.C,fe.s],encapsulation:2})}return EmailReplyModal})(),ge=(()=>{class EmailForwardButton{constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailForwardModal",!0,this.injector)}static#e=this.ɵfac=function(e){return new(e||EmailForwardButton)(r.rXU(r.zZn),r.rXU(_.g),r.rXU(h.yu),r.rXU(G.y))};static#t=this.ɵcmp=r.VBU({type:EmailForwardButton,selectors:[["ng-component"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_FORWARD"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s())},dependencies:[L.W],encapsulation:2})}return EmailForwardButton})(),pe=(()=>{class EmailForwardModal extends be{constructor(e,t,s,i,l,n,a,d,o,c,r,m){super(e,t,s,i,l,n,a,d,o,c),this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=a,this.session=d,this.userpreferences=o,this.dockedcomposer=c,this.modelattachments=r,this.backend=m,this.titlelabel="LBL_EMAIL_FORWARD"}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1),this.model.setFields({recipient_addresses:[],reference_id:this.parent.id,name:this.language.getLabel("LBL_FW")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()}),this.loadParentAttachments()}loadParentAttachments(){this.modelattachments.module="Emails",this.modelattachments.id=this.model.id,this.modelattachments.cloneAttachments(this.parent)}static#e=this.ɵfac=function(e){return new(e||EmailForwardModal)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g),r.rXU(_.g,4),r.rXU(y.U),r.rXU(ce.S),r.rXU(G.y),r.rXU(re.d),r.rXU(ce.S),r.rXU(me.n),r.rXU(C.S),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailForwardModal,selectors:[["ng-component"]],features:[r.Jv_([y.U,_.g,C.S]),r.Vt3],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.close()})),r.nrm(2,"system-label",2),r.j41(3,"system-modal-header-right")(4,"button",3),r.bIt("click",(function(){return t.dock()})),r.nrm(5,"system-button-icon",4),r.j41(6,"span",5),r.nrm(7,"system-label",6),r.k0s()()()(),r.j41(8,"system-modal-content"),r.nrm(9,"system-componentset",7),r.k0s(),r.j41(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.bIt("actionemitter",(function(e){return t.handleaction(e)})),r.k0s()()()()),2&e&&(r.R7$(2),r.Y8G("label",t.titlelabel),r.R7$(2),r.Y8G("title",t.language.getLabel("LBL_DOCK")),r.R7$(5),r.Y8G("componentset",t.componentconfig.componentset),r.R7$(3),r.Y8G("actionset",t.componentconfig.actionset))},dependencies:[he.l,k.t,ue.F,L.W,S.D,$.I,T.Q,D.C,fe.s],encapsulation:2})}return EmailForwardModal})();var _e=s(41081),ye=s(53584);let ve=(()=>{class EmailSendButton{constructor(e,t,s,i,l,n){this.model=e,this.metadata=t,this.modal=s,this.toast=i,this.language=l,this.configuration=n,this.actionemitter=new r.bkB,this.sending=!1}get disabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=[];["outbound","outboundsingle","outboundmass"].forEach((e=>{0!=this.configuration.getData("mailboxes"+e)&&(s=this.configuration.getData("mailboxes"+e))}));const i=s.find((e=>e.value==t));let l=!!this.model.getFieldValue("attachments_size")&&this.model.getFieldValue("attachments_size")>i.max_upload,n=this.model.getFieldValue("name"),a=this.model.getFieldValue("body"),d=e?e.find((e=>"to"==e.address_type)):void 0;return!(n&&a&&t&&e&&d&&!l)||this.sending}execute(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:!0,from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe({next:()=>{e.instance.self.destroy(),this.actionemitter.emit("emailsent")},error:t=>{e.instance.self.destroy(),this.toast.sendToast(this.language.getLabel("LBL_ERROR_SENDING_EMAIL"),"error",t.error.error.lbl?this.language.getLabel(t.error.error.lbl):t.error.error.message),this.sending=!1}})}))}static#e=this.ɵfac=function(e){return new(e||EmailSendButton)(r.rXU(_.g),r.rXU(h.yu),r.rXU(G.y),r.rXU(_e.o),r.rXU(m.B),r.rXU(ye.i))};static#t=this.ɵcmp=r.VBU({type:EmailSendButton,selectors:[["email-send-button"]],outputs:{actionemitter:"actionemitter"},decls:2,vars:0,consts:[["label","LBL_SEND"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s())},dependencies:[L.W],encapsulation:2})}return EmailSendButton})();var Ee=s(75103);let ke=(()=>{class EmailSchedulesButton{constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.model=s,this.modellist=i,this.modal=l,this.injector=n,this.toast=a,this.hidden=!0,this.maxCount=50}ngOnInit(){this.findEmailsLink()}get disabled(){return 0==this.modellist.getSelectedCount()||this.modellist.getSelectedCount()>this.maxCount}get exportcount(){let e=this.modellist.getSelectedCount();return e||this.modellist.listData.totalcount}findEmailsLink(){if(!this.metadata.checkModuleAcl("EmailSchedules","create"))return;let e=this.metadata.getModuleFields(this.model.module);for(let t in e){let s=e[t];("emails"==t||"link"==s.type&&"Emails"==s.module)&&(this.hidden=!1)}}execute(){this.model.fields.hasOwnProperty("emails")?this.modal.openModal("EmailSchedulesModal",!0,this.injector):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesButton)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g),r.rXU(Ee.K),r.rXU(G.y),r.rXU(r.zZn),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesButton,selectors:[["email-schedules-button"]],decls:4,vars:1,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.j41(2,"span"),r.EFF(3),r.k0s()()),2&e&&(r.R7$(3),r.SpI(" (",t.exportcount,")"))},dependencies:[L.W],encapsulation:2})}return EmailSchedulesButton})(),Le=(()=>{class EmailSchedulesCancelButton{constructor(e,t,s){this.model=e,this.modal=t,this.backend=s,this.actionemitter=new r.bkB}get disabled(){return!this.model.checkAccess("edit")||"open"!=this.model.getField("email_schedule_status")}execute(){this.modal.confirm("MSG_CANCEL_EMAILSCHEDULE","MSG_CANCEL_EMAILSCHEDULE").subscribe((e=>{e&&this.backend.putRequest(`module/EmailSchedules/${this.model.id}/cancel`).subscribe((e=>{this.model.setField("email_schedule_status","cancelled"),this.actionemitter.emit("save")}))}))}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesCancelButton)(r.rXU(_.g),r.rXU(G.y),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesCancelButton,selectors:[["email-schedules-cancel-button"]],outputs:{actionemitter:"actionemitter"},decls:1,vars:0,consts:[["label","LBL_CANCEL"]],template:function(e,t){1&e&&r.nrm(0,"system-label",0)},dependencies:[L.W],encapsulation:2})}return EmailSchedulesCancelButton})();var Re=s(10650);let xe=(()=>{class EmailSchedulesModal{constructor(e,t,s,i,l,n,a,d,o,c){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=a,this.modellist=d,this.backend=o,this.toast=c,this.self={},this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1)}close(){this.self.destroy()}get canSave(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}saveSchedule(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t=this.modellist.getSelectedIDs(),s={module:this.modellist.module,ids:t,data:this.model.data,modulefilter:this.modellist.modulefilter,searchterm:this.modellist.searchTerm,aggregates:this.modellist.selectedAggregates};this.backend.postRequest(`module/EmailSchedules/${this.model.id}`,{},s).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesModal)(r.rXU(m.B),r.rXU(_.g),r.rXU(_.g,4),r.rXU(r.zZn),r.rXU(y.U),r.rXU(G.y),r.rXU(h.yu),r.rXU(Ee.K),r.rXU(v.H),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesModal,selectors:[["email-schedules-modal"]],features:[r.Jv_([_.g,y.U])],decls:11,vars:3,consts:[["title","LBL_EMAIL_SCHEDULES"],[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","none",3,"grow"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(e,t){1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.close()})),r.nrm(2,"system-label",2),r.k0s(),r.j41(3,"system-modal-content",3),r.nrm(4,"system-dynamic-component",4)(5,"system-dynamic-component",5),r.k0s(),r.j41(6,"system-modal-footer")(7,"button",6),r.bIt("click",(function(){return t.sendTestEmail()})),r.nrm(8,"system-label",7),r.k0s(),r.j41(9,"button",8),r.bIt("click",(function(){return t.saveSchedule()})),r.nrm(10,"system-label",2),r.k0s()()()),2&e&&(r.R7$(3),r.Y8G("grow",!0),r.R7$(4),r.Y8G("disabled",!t.canSave),r.R7$(2),r.Y8G("disabled",!t.canSave))},dependencies:[Re.s,L.W,S.D,$.I,T.Q,D.C],encapsulation:2})}return EmailSchedulesModal})();var je=s(21413);let Be=(()=>{class EmailSchedulesRelatedButton{constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.model=s,this.modal=i,this.injector=l,this.backend=n,this.toast=a,this.linkedBeans=[]}execute(){let e=this.modal.await(this.language.getLabel("LBL_LOADING"));this.checkEmailsLink().subscribe((t=>{e.emit(!0),t&&this.modal.openModal("EmailSchedulesRelatedModal",!0,this.injector).subscribe((e=>{e.instance.linkedBeans=this.linkedBeans,e.instance.modelId=this.modelId,e.instance.currentModule=this.model.module}))}))}checkEmailsLink(){let e=new je.B,t=[];Object.keys(this.model.fields).forEach((e=>{if("link"==this.model.fields[e].type){let s=this.model.fields[e].name;for(let e in this.metadata.fieldDefs)e.toLowerCase()==s&&t.push(e)}}));let s=[];for(let e in t){let i=t[e];Object.keys(this.metadata.fieldDefs).forEach((e=>{null!=this.metadata.fieldDefs[e]&&e==i&&(this.metadata.fieldDefs[e].hasOwnProperty("email")||this.metadata.fieldDefs[e].hasOwnProperty("email1"))&&s.push(i)}))}let i={modules:s};return this.backend.getRequest(`module/EmailSchedules/${this.model.module}/${this.model.id}`,i).subscribe((t=>{t.status?(this.linkedBeans=t.linkedBeans,this.modelId=t.beanId,e.next(t.status)):(e.next(!1),this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error"));for(let e in this.linkedBeans){let t=this.linkedBeans[e];t.vname=this.model.fields[t.link].vname}e.complete()})),e.asObservable()}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesRelatedButton)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g),r.rXU(G.y),r.rXU(r.zZn),r.rXU(v.H),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesRelatedButton,selectors:[["email-schedules-related-button"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s())},dependencies:[L.W],encapsulation:2})}return EmailSchedulesRelatedButton})();var Ue=s(84359),Fe=s(68823),Me=s(22465);function we(e,t){1&e&&(r.j41(0,"div",41),r.EFF(1,"("),r.nrm(2,"system-label",42),r.EFF(3,")"),r.k0s())}function Ge(e,t){if(1&e&&(r.j41(0,"div"),r.EFF(1),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.SpI("(",e.email1,")")}}const Ie=e=>({"slds-text-color--inverse-weak":e}),Xe=e=>({"text-decoration":e});function Ce(e,t){if(1&e){const e=r.RV6();r.j41(0,"tr"),r.nrm(1,"td"),r.j41(2,"td",43)(3,"div",44)(4,"div"),r.EFF(5),r.k0s(),r.DNE(6,Ge,2,1,"div",23),r.k0s()(),r.j41(7,"td",33),r.nrm(8,"system-utility-icon",45),r.k0s(),r.j41(9,"td",34)(10,"button",46)(11,"system-button-icon",47),r.bIt("click",(function(){const t=r.eBV(e).index,s=r.XpG(2).$implicit,i=r.XpG();return r.Njj(i.removeBean(s,t))})),r.k0s()()()()}if(2&e){const e=t.$implicit;r.R7$(2),r.Y8G("ngClass",r.eq3(6,Ie,e.deleted))("ngStyle",r.eq3(8,Xe,e.deleted?"line-through":"inherit")),r.R7$(3),r.JRh(e.summary_text),r.R7$(),r.Y8G("ngIf",e.email1),r.R7$(2),r.Y8G("icon","link"==e.source?"linked":"user"),r.R7$(3),r.Y8G("icon",!0===e.deleted?"undo":"delete")}}function Se(e,t){if(1&e&&(r.qex(0),r.DNE(1,Ce,12,10,"tr",21),r.bVm()),2&e){const e=r.XpG().$implicit;r.R7$(),r.Y8G("ngForOf",e.linkedbeans)}}const $e=e=>({"slds-disabled-text":e});function Te(e,t){if(1&e){const e=r.RV6();r.qex(0),r.j41(1,"tr",27)(2,"td")(3,"system-checkbox",28),r.mxI("ngModelChange",(function(t){const s=r.eBV(e).$implicit;return r.DH7(s.selected,t)||(s.selected=t),r.Njj(t)})),r.k0s()(),r.j41(4,"td")(5,"div",29)(6,"div",16),r.nrm(7,"system-icon",30),r.k0s(),r.j41(8,"div",16),r.nrm(9,"system-label-modulename",31),r.k0s(),r.DNE(10,we,4,0,"div",32),r.k0s()(),r.j41(11,"td",33)(12,"div",29)(13,"div",16),r.EFF(14),r.k0s()()(),r.j41(15,"td",34)(16,"button",35),r.bIt("click",(function(){const t=r.eBV(e).$implicit,s=r.XpG();return r.Njj(s.expandRelated(t))})),r.nrm(17,"system-button-icon",36),r.k0s(),r.j41(18,"button",37),r.bIt("click",(function(){const t=r.eBV(e).$implicit;return r.Njj(t.open=!t.open)})),r.nrm(19,"system-button-icon",38),r.k0s(),r.j41(20,"button",39)(21,"system-button-icon",40),r.bIt("click",(function(){const t=r.eBV(e).$implicit,s=r.XpG();return r.Njj(s.addBean(t))})),r.k0s()()()(),r.DNE(22,Se,2,1,"ng-container",23),r.bVm()}if(2&e){const e=t.$implicit,s=r.XpG();r.R7$(),r.Y8G("ngClass",r.eq3(15,$e,e.disabled&&(!e.linkedbeans||0==e.linkedbeans.length))),r.R7$(2),r.Y8G("disabled",e.disabled||e.expanded),r.R50("ngModel",e.selected),r.R7$(4),r.Y8G("addclasses",!e.disabled||e.linkedbeans&&0!=e.linkedbeans.length?null:"slds-icon_disabled")("size","small")("module",e.module),r.R7$(2),r.Y8G("module",e.module),r.R7$(),r.Y8G("ngIf",e.count>s.maxCount),r.R7$(4),r.Lme("",s.getLinkCount(e)," / ",e.count,""),r.R7$(2),r.Y8G("disabled",e.expanded||0==e.count||e.count>s.maxCount),r.R7$(2),r.Y8G("disabled",!e.linkedbeans),r.R7$(),r.Y8G("icon",!0===e.open?"up":"down"),r.R7$(),r.Y8G("disabled",e.count>s.maxCount),r.R7$(2),r.Y8G("ngIf",!0===e.open)}}function De(e,t){1&e&&(r.j41(0,"div"),r.nrm(1,"system-label",42),r.k0s())}const Ye=e=>({"slds-is-active":e}),Oe=e=>({"slds-hide":e});let Ne=(()=>{class EmailSchedulesRelatedModal{constructor(e,t,s,i,l,n,a,d,o){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=a,this.backend=d,this.toast=o,this.self={},this.activetab="recipients",this.linkedBeans=[],this.maxCount=50,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1),this.fiilterProspects()}fiilterProspects(){this.linkedBeans=this.linkedBeans.map((e=>(e.disabled=0==e.count||e.count>this.maxCount,e.selected=!1,e.expanded=!1,e)))}close(){this.self.destroy()}get canSchedule(){if(!this.model.getField("mailbox_id")||!this.model.getField("email_subject"))return!1;let e=this.selectedCount;return!(0==e||e>this.maxCount)}get selectedCount(){let e=0;return this.linkedBeans.forEach((t=>{t.selected?e+=t.count:t.linkedbeans&&(e+=t.linkedbeans.filter((e=>!e.deleted)).length)})),e}saveSchedule(){this.canSchedule&&this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={links:this.linkedBeans.filter((e=>e.selected)).map((e=>e.module)),data:this.model.data,linkedbeans:this.linkedbeans};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/${this.parentModel.module}/${this.parentModel.id}`,{},t).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}get linkedbeans(){let e={};for(let t of this.linkedBeans){if(!t.linkedbeans)continue;let s=t.linkedbeans.filter((e=>!e.deleted)).map((e=>e.id));s.length>0&&(e[t.module]=s)}return e}getLinkCount(e){if(e.expanded)return e.linkedbeans?e.linkedbeans.filter((e=>!e.deleted)).length:0;let t=e.selected?parseInt(e.count,10):0;return e.linkedbeans&&(t+=e.linkedbeans.length),t}expandRelated(e){if(e.expanded)e.open=!e.open;else{let t=this.modal.await("LBL_LOADING");e.selected=!1,e.expanded=!0,this.backend.getRequest(`module/${this.parentModel.module}/${this.parentModel.id}/related/${e.link}`,{getcount:0,excludeinactive:1,offset:0,limit:100}).subscribe((s=>{e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let t in s)s[t].source="link",s[t].deleted=!1,e.linkedbeans.push(s[t]);this.sortLinkedBeans(e),t.emit(!0)}),(()=>{this.toast.sendToast("LBL_ERROR","error"),t.emit(!0)}))}}addBean(e){this.modal.openModal("ObjectModalModuleLookup").subscribe((t=>{t.instance.module=e.module,t.instance.multiselect=!0,t.instance.selectedItems.subscribe((t=>{if(t.length){e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let s of t)-1==e.linkedbeans.findIndex((e=>e.id==s.id))&&(s.source="user",e.linkedbeans.push(s));this.sortLinkedBeans(e)}}))}))}sortLinkedBeans(e){e.linkedbeans.sort(((e,t)=>e.last_name?e.last_name.localeCompare(t.last_name):e.summary_text.localeCompare(t.summary_text)))}removeBean(e,t){"link"==e.linkedbeans[t].source?e.linkedbeans[t].deleted=!e.linkedbeans[t].deleted:e.linkedbeans.splice(t,1)}get canSendTest(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesRelatedModal)(r.rXU(m.B),r.rXU(_.g),r.rXU(_.g,4),r.rXU(r.zZn),r.rXU(y.U),r.rXU(G.y),r.rXU(h.yu),r.rXU(v.H),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesRelatedModal,selectors:[["email-schedules-related-modal"]],features:[r.Jv_([_.g,y.U])],decls:36,vars:18,consts:[[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","x-small"],[1,"slds-tabs_scoped"],["role","tablist",1,"slds-tabs_scoped__nav"],["title","Emails","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link",3,"click"],["title","Recipients","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small",2,"height","70vh",3,"ngClass"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small","slds-scrollable--y",2,"height","70vh",3,"ngClass"],[1,"slds-table","slds-box--border"],[1,"slds-text-title_caps"],["scope","col",2,"width","2rem"],["scope","col",1,"slds-resizable"],[1,"slds-truncate"],["label","LBL_LINK"],["scope","col",1,"slds-text-align--center",2,"width","5rem"],["label","LBL_COUNT"],["scope","col",2,"width","4rem"],[4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical-align-center"],[4,"ngIf"],[1,"slds-button","slds-col--bump-left","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],[3,"ngClass"],[3,"disabled","ngModel","ngModelChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small"],[3,"addclasses","size","module"],[3,"module"],["class","slds-truncate slds-p-horizontal--x-small",4,"ngIf"],[1,"slds-text-align--center"],[1,"slds-text-align--right"],["system-title","LBL_EXPAND",1,"slds-button","slds-button--icon",3,"disabled","click"],["icon","expand_all"],["system-title","LBL_TOGGLE",1,"slds-button","slds-button--icon",3,"disabled","click"],[3,"icon"],["system-title","LBL_ADD",1,"slds-button","slds-button--icon",3,"disabled"],["icon","new",3,"click"],[1,"slds-truncate","slds-p-horizontal--x-small"],["label","LBL_MAX50RECORDS"],[3,"ngClass","ngStyle"],[1,"slds-grid","slds-grid--align-spread"],["size","xx-small",3,"icon"],["system-title","LBL_DELETE",1,"slds-button","slds-button--icon"],[3,"icon","click"]],template:function(e,t){1&e&&(r.j41(0,"system-modal")(1,"system-modal-header",0),r.bIt("close",(function(){return t.close()})),r.nrm(2,"system-label",1),r.k0s(),r.j41(3,"system-modal-content",2)(4,"div",3)(5,"ul",4)(6,"li",5)(7,"a",6),r.bIt("click",(function(){return t.activetab="emails"})),r.EFF(8),r.k0s()(),r.j41(9,"li",7)(10,"a",6),r.bIt("click",(function(){return t.activetab="recipients"})),r.EFF(11),r.k0s()()(),r.j41(12,"div",8),r.nrm(13,"system-dynamic-component",9)(14,"system-dynamic-component",10),r.k0s(),r.j41(15,"div",11)(16,"table",12)(17,"thead")(18,"tr",13),r.nrm(19,"th",14),r.j41(20,"th",15)(21,"div",16),r.nrm(22,"system-label",17),r.k0s()(),r.j41(23,"th",18)(24,"div",16),r.nrm(25,"system-label",19),r.k0s()(),r.nrm(26,"th",20),r.k0s()(),r.j41(27,"tbody"),r.DNE(28,Te,23,17,"ng-container",21),r.k0s()()()()(),r.j41(29,"system-modal-footer")(30,"div",22),r.DNE(31,De,2,0,"div",23),r.j41(32,"button",24),r.bIt("click",(function(){return t.sendTestEmail()})),r.nrm(33,"system-label",25),r.k0s(),r.j41(34,"button",26),r.bIt("click",(function(){return t.saveSchedule()})),r.nrm(35,"system-label",1),r.k0s()()()()),2&e&&(r.R7$(6),r.Y8G("ngClass",r.eq3(10,Ye,"emails"==t.activetab)),r.R7$(2),r.JRh(t.language.getLabel("LBL_EMAILS")),r.R7$(),r.Y8G("ngClass",r.eq3(12,Ye,"recipients"==t.activetab)),r.R7$(2),r.JRh(t.language.getLabel("LBL_RECIPIENTS")),r.R7$(),r.Y8G("ngClass",r.eq3(14,Oe,"emails"!=t.activetab)),r.R7$(3),r.Y8G("ngClass",r.eq3(16,Oe,"recipients"!=t.activetab)),r.R7$(13),r.Y8G("ngForOf",t.linkedBeans),r.R7$(3),r.Y8G("ngIf",t.selectedCount>t.maxCount),r.R7$(),r.Y8G("disabled",!t.canSendTest),r.R7$(2),r.Y8G("disabled",!t.canSchedule))},dependencies:[i.YU,i.Sq,i.bT,i.B3,l.BC,l.vS,k.t,Ue.f,Re.s,Fe.J,L.W,R.r,S.D,$.I,T.Q,D.C,ie.B,Me.L],encapsulation:2})}return EmailSchedulesRelatedModal})();var Ae=s(13269),Ve=s(58461),He=s(32130);function ze(e,t){if(1&e&&(r.j41(0,"tr",14)(1,"td")(2,"div",10),r.EFF(3),r.k0s()(),r.j41(4,"td")(5,"div",10),r.EFF(6),r.k0s()(),r.j41(7,"td")(8,"div",10),r.EFF(9),r.k0s()()()),2&e){const e=t.$implicit;r.R7$(3),r.JRh(e.id),r.R7$(3),r.JRh(e.subject),r.R7$(3),r.JRh(e.status)}}function Pe(e,t){if(1&e&&(r.j41(0,"table",8)(1,"thead")(2,"tr",9)(3,"th")(4,"div",10),r.EFF(5,"Id"),r.k0s()(),r.j41(6,"th")(7,"div",10),r.nrm(8,"system-label",11),r.k0s()(),r.j41(9,"th")(10,"div",10),r.nrm(11,"system-label",12),r.k0s()()()(),r.j41(12,"tbody"),r.DNE(13,ze,10,3,"tr",13),r.k0s()()),2&e){const e=r.XpG();r.R7$(13),r.Y8G("ngForOf",e.emailschedules)}}function qe(e,t){1&e&&(r.j41(0,"div",15)(1,"system-illustration-no-records"),r.nrm(2,"system-label",16),r.k0s()())}function Je(e,t){1&e&&(r.j41(0,"div",15)(1,"system-illustration-no-access"),r.nrm(2,"system-label",17),r.k0s()())}let We=(()=>{class EmailSchedulesView{constructor(e,t,s,i,l){this.language=e,this.model=t,this.view=s,this.metadata=i,this.backend=l,this.emailschedules=[],this.locked=!1,this.isLoading=!1,this.getData()}refresh(){this.getData()}getData(){this.isLoading=!0,this.backend.getRequest(`module/EmailSchedules/myopen/${this.model.id}`).subscribe((e=>{e.status?(this.isLoading=!1,this.emailschedules=e.openschedules):this.locked=!0}))}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesView)(r.rXU(m.B),r.rXU(_.g),r.rXU(y.U),r.rXU(h.yu),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesView,selectors:[["email-schedules-view"]],features:[r.Jv_([y.U])],decls:10,vars:8,consts:[[3,"system-overlay-loading-spinner"],[1,"slds-grid","slds-p-around--small",2,"align-items","center"],[1,"slds-col","slds-grow-none",3,"module","title"],[1,"slds-grow"],[1,"slds-col--bump-left","slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","refresh"],["width","100%","class","slds-table slds-table_cell-buffer slds-table_bordered",4,"ngIf"],["class","slds-align--absolute-center slds-m-around--large",4,"ngIf"],["width","100%",1,"slds-table","slds-table_cell-buffer","slds-table_bordered"],[1,"slds-line-height_reset"],[1,"slds-truncate"],["label","LBL_SUBJECT"],["label","LBL_STATUS"],["class","slds-hint-parent",4,"ngFor","ngForOf"],[1,"slds-hint-parent"],[1,"slds-align--absolute-center","slds-m-around--large"],["label","MSG_NO_RECORDS_FOUND"],["label","LBL_NO_ACCESS"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1),r.nrm(2,"system-icon",2),r.j41(3,"h2",3),r.EFF(4),r.k0s(),r.j41(5,"button",4),r.bIt("click",(function(){return t.getData()})),r.nrm(6,"system-button-icon",5),r.k0s()(),r.DNE(7,Pe,14,1,"table",6)(8,qe,3,0,"div",7)(9,Je,3,0,"div",7),r.k0s()),2&e&&(r.Y8G("system-overlay-loading-spinner",t.isLoading),r.R7$(2),r.Y8G("module","EmailSchedules")("title","EmailSchedules"),r.R7$(2),r.JRh(t.language.getModuleName("EmailSchedules")),r.R7$(),r.Y8G("disabled",t.isLoading),r.R7$(2),r.Y8G("ngIf",t.emailschedules.length>0),r.R7$(),r.Y8G("ngIf",0==t.emailschedules.length&&!t.isLoading),r.R7$(),r.Y8G("ngIf",!t.isLoading&&t.locked))},dependencies:[i.Sq,i.bT,k.t,Fe.J,Ae.r,Ve.b,L.W,He.M],encapsulation:2})}return EmailSchedulesView})();var Ke=s(18359),Ze=s(42205),Qe=s(33325);const et=(e,t)=>({module:e,data:t});function tt(e,t){if(1&e&&(r.j41(0,"tr",9)(1,"td")(2,"div",10),r.nrm(3,"system-icon",11),r.j41(4,"div",3),r.EFF(5),r.k0s()()(),r.j41(6,"td")(7,"div",3),r.EFF(8),r.k0s()()()),2&e){const e=t.$implicit,s=r.XpG();r.Y8G("system-model-provider",r.l_i(4,et,e.module,e.data)),r.R7$(3),r.Y8G("module",e.module),r.R7$(2),r.JRh(e.summary_text),r.R7$(3),r.SpI(" ",s.getValue(e.status),"")}}function st(e,t){1&e&&r.nrm(0,"tbody",12),2&e&&r.Y8G("rows",10)}let it=(()=>{class EmailSchedulesBeans{constructor(e,t,s,i){this.model=e,this.metadata=t,this.language=s,this.backend=i,this.loading=!1,this.subscriptions=new Ke.yU,this.subscriptions.add(this.model.data$.subscribe((e=>{this.getData()})))}ngOnDestroy(){this.subscriptions.unsubscribe()}getValue(e){try{return this.language.languagedata.applist.emailschedule_status_dom[e]?this.language.languagedata.applist.emailschedule_status_dom[e]:e}catch(t){return e}}getData(){!this.model.getField("email_schedule_status")||this.loadedStatus&&this.loadedStatus==this.model.getField("email_schedule_status")||(this.beans=[],this.loading=!0,this.loadedStatus=this.model.getField("email_schedule_status"),this.backend.getRequest(`module/EmailSchedules/${this.model.id}/beans`).subscribe((e=>{this.beans=e,this.loading=!1})))}static#e=this.ɵfac=function(e){return new(e||EmailSchedulesBeans)(r.rXU(_.g),r.rXU(h.yu),r.rXU(m.B),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailSchedulesBeans,selectors:[["email-schedules-beans"]],decls:12,vars:2,consts:[[1,"slds-table","slds-table--fixed-layout","slds-table_bordered","slds-box--border"],[1,"slds-line-height_reset"],["scope","col",2,"width","99%"],[1,"slds-truncate"],["label","LBL_NAME"],["scope","col",2,"width","5rem"],["label","LBL_STATUS"],["class","slds-hint-parent",3,"system-model-provider",4,"ngFor","ngForOf"],["system-table-stencils","","columns","2",3,"rows",4,"ngIf"],[1,"slds-hint-parent",3,"system-model-provider"],["system-model-popover","",1,"slds-grid","slds-grid--vertical-align-center"],["size","x-small",3,"module"],["system-table-stencils","","columns","2",3,"rows"]],template:function(e,t){1&e&&(r.j41(0,"table",0)(1,"thead")(2,"tr",1)(3,"th",2)(4,"div",3),r.nrm(5,"system-label",4),r.k0s()(),r.j41(6,"th",5)(7,"div",3),r.nrm(8,"system-label",6),r.k0s()()()(),r.j41(9,"tbody"),r.DNE(10,tt,9,7,"tr",7),r.k0s(),r.DNE(11,st,1,1,"tbody",8),r.k0s()),2&e&&(r.R7$(10),r.Y8G("ngForOf",t.beans),r.R7$(),r.Y8G("ngIf",t.loading))},dependencies:[i.Sq,i.bT,Fe.J,L.W,Ze.t,Qe.j,x.v],encapsulation:2})}return EmailSchedulesBeans})();function lt(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",1),r.k0s())}let nt=(()=>{class EmailActionSetReadButton{constructor(e,t,s){this.language=e,this.metadata=t,this.model=s,this.displayasicon=!1}get hidden(){return!("unread"==this.model.getFieldValue("status")||!this.model.isEditing)}get disabled(){return!this.model.checkAccess("edit")||(this.model.isEditing||this.model.isSaving)}execute(){this.model.setField("status","read")}static#e=this.ɵfac=function(e){return new(e||EmailActionSetReadButton)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g))};static#t=this.ɵcmp=r.VBU({type:EmailActionSetReadButton,selectors:[["email-action-set-read-button"]],decls:1,vars:1,consts:[[4,"ngIf"],["label","LBL_SET_READ"]],template:function(e,t){1&e&&r.DNE(0,lt,2,0,"span",0),2&e&&r.Y8G("ngIf",!t.displayasicon)},dependencies:[i.bT,L.W],encapsulation:2})}return EmailActionSetReadButton})();var at=s(15091),dt=s(10467),ot=s(70923),ct=s(39554);function rt(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",4)(1,"div",19)(2,"span",20)(3,"span",21),r.nrm(4,"system-icon",22),r.k0s(),r.j41(5,"span",23),r.EFF(6),r.k0s(),r.j41(7,"button",24),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.clearSelectedItem())})),r.nrm(8,"system-button-icon",25),r.k0s()()()()}if(2&e){const e=r.XpG();r.R7$(4),r.Y8G("module",e.previewForBean),r.R7$(2),r.SpI(" ",e.selectedItem.text," "),r.R7$(2),r.Y8G("icon","close")}}function mt(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",26),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.searchWithModal())})),r.nrm(1,"input",27),r.j41(2,"button",28),r.nrm(3,"system-button-icon",29),r.k0s()()}if(2&e){const e=r.XpG();r.R7$(),r.Y8G("disabled",!e.previewForBean)("placeholder",e.placeholder),r.R7$(),r.Y8G("disabled",!e.previewForBean)}}function ht(e,t){if(1&e&&(r.j41(0,"div",30)(1,"div",31),r.nrm(2,"div",32),r.j41(3,"span",33),r.EFF(4),r.k0s()(),r.nrm(5,"iframe",34),r.k0s()),2&e){const e=r.XpG();r.xc7("width",e.viewType.width,"px"),r.R7$(4),r.SpI(" ",e.viewType.width,"px "),r.R7$(),r.Y8G("src",e.parsedHtml,r.f$h)}}function ut(e,t){1&e&&(r.j41(0,"div",35)(1,"system-illustration-no-data"),r.nrm(2,"system-label",36),r.k0s()())}let ft=(()=>{class EmailTemplatesPreview{constructor(e,t,s,i,l,n,a,d){this.language=e,this.backend=t,this.metadata=s,this.model=i,this.modal=l,this.toast=n,this.sanitizer=a,this.cdRef=d,this.viewTypeOptions=[{title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},{title:"LBL_TABLET",icon:"tablet_portrait",value:"tablet",width:768},{title:"LBL_MOBILE",icon:"phone_portrait",value:"mobile",width:320}],this.viewType={title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},this.subscription=new Ke.yU,this.bodyHtmlField="body_html"}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnDestroy(){this.subscription.unsubscribe()}subscribeToModelChanges(){this.subscription.add(this.model.data$.subscribe((()=>{this.setPlaceholder(),this.selectedItem&&this.selectedItem.module==this.previewForBean||this.clearSelectedItem()})))}setPlaceholder(){this.placeholder=this.previewForBean?this.language.getModuleCombinedLabel("LBL_SEARCH",this.previewForBean):this.language.getLabel("LBL_SEARCH"),this.cdRef.detectChanges()}searchWithModal(){this.previewForBean&&this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.previewForBean,e.instance.multiselect=!1,this.subscription.add(e.instance.selectedItems.subscribe((e=>{e&&e.length&&(this.selectedItem={id:e[0].id,text:e[0].summary_text,module:this.previewForBean},this.compileBody())})))}))}clearSelectedItem(){this.selectedItem=void 0,this.parsedHtml=void 0,this.cdRef.detectChanges()}compileBody(){var e=this;return(0,dt.A)((function*(){if(!e.model.id)return;const t=e.modal.await("LBL_PARSING_HTML"),s={html:e.model.getField(e.bodyHtmlField),field:e.bodyHtmlField};e.backend.postRequest(`module/${e.model.module}/${e.model.id}/livecompile/${e.previewForBean}/${e.selectedItem.id}`,{},s).subscribe({next:s=>{if(!s||!s.html)return t.emit(!1),t.unsubscribe();e.parsedHtml=e.sanitizer.bypassSecurityTrustResourceUrl("data:text/html;charset=UTF-8,"+encodeURIComponent(s.html)),e.cdRef.detectChanges(),t.emit(!0),t.unsubscribe()},error:()=>{e.toast.sendToast(e.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),t.emit(!1),t.unsubscribe()}})}))()}setViewType(e){this.viewType=this.viewTypeOptions.find((t=>t.value==e))}static#e=this.ɵfac=function(e){return new(e||EmailTemplatesPreview)(r.rXU(m.B),r.rXU(v.H),r.rXU(h.yu),r.rXU(_.g),r.rXU(G.y),r.rXU(_e.o),r.rXU(X.up),r.rXU(r.gRc))};static#t=this.ɵcmp=r.VBU({type:EmailTemplatesPreview,selectors:[["email-templates-preview"]],inputs:{bodyHtmlField:"bodyHtmlField",previewForBean:"previewForBean"},decls:20,vars:7,consts:[[1,"slds-grid","slds-grid--vertical-align-end","slds-gutters_direct-xx-small"],[1,"slds-col","slds-grow","slds-form-element"],[1,"slds-form-element__label"],["label","LBL_RECORD"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",3,"click",4,"ngIf"],[1,"slds-button","slds-button--icon-border","slds-m-horizontal--xx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-form-element"],["label","LBL_DISPLAY"],[1,"slds-form-element__control","slds-p-top--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom","slds-grid","slds-p-around--xx-small","slds-grid","slds-grid--align-center","slds-grow",2,"min-height","0"],["class","slds-grid slds-grid--vertical slds-height_full",3,"width",4,"ngIf"],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],["size","small",3,"module"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow",3,"click"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare","slds-input",3,"disabled","placeholder"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled"],["icon","search"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],[1,"slds-size--1-of-1","slds-grid","slds-grid--vertical-align-center","slds-is-relative","slds-m-vertical--xx-small",2,"height","16px","border-left","1px solid #aaa","border-right","1px solid #aaa"],[2,"height","1px","width","100%","background","#aaa"],[1,"slds-theme--default","slds-p-horizontal--xx-small","slds-is-absolute",2,"left","50%","transform","translateX(-50%)"],["sandbox","",1,"slds-grow",2,"border","0","min-height","250px",3,"src"],[1,"slds-align--absolute-center","slds-height_full"],["label","MSG_NO_RECORD_SELECTED"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1)(2,"label",2),r.nrm(3,"system-label",3),r.k0s(),r.j41(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),r.DNE(8,rt,9,3,"div",8)(9,mt,4,3,"div",9),r.k0s()()()()(),r.j41(10,"button",10),r.bIt("click",(function(){return t.compileBody()})),r.nrm(11,"system-button-icon",11),r.k0s(),r.j41(12,"div",12)(13,"label",2),r.nrm(14,"system-label",13),r.k0s(),r.j41(15,"div",14)(16,"system-input-radio-button-group",15),r.bIt("ngModelChange",(function(e){return t.setViewType(e)})),r.k0s()()()(),r.j41(17,"div",16),r.DNE(18,ht,6,4,"div",17)(19,ut,3,0,"div",18),r.k0s()),2&e&&(r.R7$(8),r.Y8G("ngIf",t.selectedItem),r.R7$(),r.Y8G("ngIf",!t.selectedItem),r.R7$(),r.Y8G("disabled",!t.selectedItem),r.R7$(6),r.Y8G("ngModel",t.viewType.value)("inputOptions",t.viewTypeOptions),r.R7$(2),r.Y8G("ngIf",t.parsedHtml),r.R7$(),r.Y8G("ngIf",!t.selectedItem))},dependencies:[i.bT,l.BC,l.vS,k.t,Fe.J,ot.L,ct.s,L.W],encapsulation:2,changeDetection:0})}return EmailTemplatesPreview})();function bt(e,t){1&e&&r.eu8(0)}function gt(e,t){if(1&e&&(r.qex(0),r.DNE(1,bt,1,0,"ng-container",18),r.bVm()),2&e){r.XpG();const e=r.sdS(20);r.R7$(),r.Y8G("ngTemplateOutlet",e)}}function pt(e,t){if(1&e&&r.nrm(0,"field-container",26),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.subjectField)}}const _t=()=>({fieldtype:"mailboxes",scope:"outboundmass"});function yt(e,t){if(1&e&&r.nrm(0,"field-container",27),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.mailboxField)("fieldconfig",r.lJ4(2,_t))}}const vt=()=>({fieldtype:"richtext",hidelabel:!0});function Et(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.lJ4(2,vt))}}const kt=e=>({fieldtype:"pagebuilder",hidelabel:!0,bodySPBField:e});function Lt(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.eq3(2,kt,e.fieldsNames.bodySPBField))}}const Rt=()=>({fieldtype:"html",hidelabel:!0});function xt(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.lJ4(2,Rt))}}const jt=()=>({hidelabel:!0});function Bt(e,t){if(1&e&&(r.j41(0,"div"),r.nrm(1,"field-container",28),r.k0s()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.lJ4(2,jt))}}function Ut(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",19),r.bIt("dblclick",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.setEditMode())})),r.j41(1,"div",20),r.DNE(2,pt,1,1,"field-container",21)(3,yt,1,3,"field-container",22),r.k0s(),r.j41(4,"div",23),r.DNE(5,Et,1,3,"field-container",24)(6,Lt,1,4,"field-container",24)(7,xt,1,3,"field-container",24)(8,Bt,2,3,"div",25),r.k0s()()}if(2&e){const e=r.XpG();r.R7$(2),r.Y8G("ngIf",!!e.fieldsNames.subjectField),r.R7$(),r.Y8G("ngIf",!!e.fieldsNames.mailboxField),r.R7$(),r.Y8G("ngSwitch",e.activeEditor),r.R7$(),r.Y8G("ngSwitchCase","richText"),r.R7$(),r.Y8G("ngSwitchCase","pageBuilder"),r.R7$(),r.Y8G("ngSwitchCase","html")}}function Ft(e,t){if(1&e&&r.nrm(0,"field-container",31),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.subjectField)}}function Mt(e,t){if(1&e&&r.nrm(0,"field-container",27),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.mailboxField)("fieldconfig",r.lJ4(2,_t))}}function wt(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.lJ4(2,vt))}}function Gt(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.eq3(2,kt,e.fieldsNames.bodySPBField))}}function It(e,t){if(1&e&&r.nrm(0,"field-container",28),2&e){const e=r.XpG(2);r.Y8G("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.lJ4(2,Rt))}}function Xt(e,t){if(1&e){const e=r.RV6();r.j41(0,"div"),r.nrm(1,"system-label",32),r.j41(2,"button",33),r.bIt("click",(function(){r.eBV(e);const t=r.XpG(2);return r.Njj(t.updateModelEditor("richText"))})),r.nrm(3,"system-label",34),r.k0s(),r.nrm(4,"system-label",35),r.j41(5,"button",36),r.bIt("click",(function(){r.eBV(e);const t=r.XpG(2);return r.Njj(t.updateModelEditor("pageBuilder"))})),r.nrm(6,"system-label",37),r.k0s(),r.nrm(7,"system-label",35),r.j41(8,"button",36),r.bIt("click",(function(){r.eBV(e);const t=r.XpG(2);return r.Njj(t.updateModelEditor("html"))})),r.nrm(9,"system-label",38),r.k0s()()}}function Ct(e,t){if(1&e&&(r.j41(0,"div",29)(1,"div",20),r.DNE(2,Ft,1,1,"field-container",30)(3,Mt,1,3,"field-container",22),r.k0s(),r.j41(4,"div",23),r.DNE(5,wt,1,3,"field-container",24)(6,Gt,1,4,"field-container",24)(7,It,1,3,"field-container",24)(8,Xt,10,0,"div",25),r.k0s()()),2&e){const e=r.XpG();r.R7$(2),r.Y8G("ngIf",!!e.fieldsNames.subjectField),r.R7$(),r.Y8G("ngIf",!!e.fieldsNames.mailboxField),r.R7$(),r.Y8G("ngSwitch",e.activeEditor),r.R7$(),r.Y8G("ngSwitchCase","richText"),r.R7$(),r.Y8G("ngSwitchCase","pageBuilder"),r.R7$(),r.Y8G("ngSwitchCase","html")}}function St(e,t){1&e&&r.eu8(0)}function $t(e,t){if(1&e&&(r.j41(0,"div",39),r.DNE(1,St,1,0,"ng-container",18),r.k0s()),2&e){r.XpG();const e=r.sdS(20);r.R7$(),r.Y8G("ngTemplateOutlet",e)}}function Tt(e,t){if(1&e){const e=r.RV6();r.j41(0,"button",5),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.toggleFullscreen())})),r.nrm(1,"system-button-icon",40),r.k0s()}if(2&e){const e=r.XpG();r.R7$(),r.Y8G("icon",e.isFullscreen?"contract_alt":"expand_alt")}}const Dt=(e,t,s)=>({"slds-size--7-of-12":e,"slds-hide":t,"slds-grow":s}),Yt=e=>({"slds-hide":e});let Ot=(()=>{class EmailTemplatesEditor{constructor(e,t,s,i,l){this.model=e,this.cdRef=t,this.modal=s,this.injector=i,this.view=l,this.fieldsNames={bodyHtmlField:"body_html",bodySPBField:"body_spb"},this.subscription=new Ke.yU,this.isFullscreen=!1,this.useDynamicModule=!1}get activeEditor(){return this.model.data.editor_type}get isHidden(){return this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnInit(){this.view.isEditable=!0,this.view.linkedToModel=!0,this.setUseDynamicModule(),this.setBodyFieldsName()}ngOnDestroy(){this.subscription.unsubscribe()}setEditMode(){(this.model.checkAccess("edit")||this.model.checkAccess("create"))&&(this.model.startEdit(),this.view.setEditMode(),this.cdRef.detectChanges())}setBodyFieldsName(){this.componentconfig.bodyHtmlField&&(this.fieldsNames.bodyHtmlField=this.componentconfig.bodyHtmlField),this.componentconfig.bodySPBField&&(this.fieldsNames.bodySPBField=this.componentconfig.bodySPBField),this.componentconfig.subjectField&&(this.fieldsNames.subjectField=this.componentconfig.subjectField),this.componentconfig.mailboxField&&(this.fieldsNames.mailboxField=this.componentconfig.mailboxField),this.componentconfig.previewForBean&&(this.fieldsNames.previewForBean=this.componentconfig.previewForBean),this.useDynamicModule&&this.model.getField(this.componentconfig.previewForBeanField)&&this.setActivePreviewForBean(this.model.getField(this.componentconfig.previewForBeanField))}subscribeToModelChanges(){this.useDynamicModule&&this.subscription.add(this.model.observeFieldChanges(this.componentconfig.previewForBeanField).subscribe((e=>{this.setActivePreviewForBean(e)}))),this.subscription.add(this.model.data$.subscribe((()=>this.cdRef.detectChanges()))),this.subscription.add(this.view.mode$.subscribe((()=>this.cdRef.detectChanges())))}setUseDynamicModule(){!this.componentconfig.previewForBean&&this.componentconfig.previewForBeanField&&(this.useDynamicModule=!0)}setPreviewForBean(e){this.fieldsNames.previewForBean=e}setActivePreviewForBean(e){this.setPreviewForBean(e),this.cdRef.detectChanges()}copyFromTemplate(){this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe((e=>{e.instance.module="EmailTemplates",e.instance.multiselect=!1,e.instance.selectedItems.subscribe((e=>{e.length&&this.model.setFields({[this.fieldsNames.bodyHtmlField]:e[0].body_html,[this.fieldsNames.bodySPBField]:e[0].body_spb,editor_type:e[0].editor_type})}))}))}updateModelEditor(e){this.model.setField("editor_type",e),this.cdRef.detectChanges()}expand(e){this.expanded&&this.expanded!=e?this.expanded=void 0:this.expanded=e}toggleFullscreen(){this.isFullscreen=!this.isFullscreen,this.cdRef.detectChanges()}static#e=this.ɵfac=function(e){return new(e||EmailTemplatesEditor)(r.rXU(_.g),r.rXU(r.gRc),r.rXU(G.y),r.rXU(r.zZn),r.rXU(y.U))};static#t=this.ɵcmp=r.VBU({type:EmailTemplatesEditor,selectors:[["email-templates-editor"]],features:[r.Jv_([y.U])],decls:21,vars:17,consts:[[1,"slds-grid","slds-height_full","slds-is-relative","slds-theme--default"],[1,"slds-border--right","slds-height_full","slds-grid","slds-grid--vertical",3,"ngClass"],[1,"slds-grid","slds-grid--align-end","slds-p-right--x-small","slds-p-top--xxx-small"],[1,"slds-button","slds-button--icon-bare","slds-button--icon",3,"disabled","click"],["icon","copy","size","small"],[1,"slds-button","slds-button--icon-bare","slds-button--icon",3,"click"],["icon","arrow_left","size","small"],[4,"ngIf"],[1,"slds-p-around--x-small","slds-grow",2,"min-height","0"],["class","slds-height_full slds-p-top--x-small slds-grid slds-grid--vertical","style","min-height: 250px",3,"dblclick",4,"ngIf","ngIfElse"],["contentEditingContainer",""],[1,"slds-is-relative","slds-grow","slds-height_full","slds-grid","slds-grid--vertical",2,"min-width","0",3,"ngClass"],[1,"slds-grid","slds-p-left--x-small","slds-grid--align-spread"],["icon","arrow_right","size","small"],["class","slds-m-right--x-small",4,"ngIf"],[1,"slds-grow","slds-p-around--x-small",2,"min-height","0"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"previewForBean","bodyHtmlField"],["fullscreenButton",""],[4,"ngTemplateOutlet"],[1,"slds-height_full","slds-p-top--x-small","slds-grid","slds-grid--vertical",2,"min-height","250px",3,"dblclick"],[1,"slds-grid","slds-m-bottom--xx-small"],["class","slds-grow slds-m-right--x-small","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small","class","slds-m-left--x-small",3,"field","fieldconfig",4,"ngIf"],[1,"slds-grid","slds-grid--align-center","slds-grid--vertical-align-center","slds-grow",2,"min-height","250px",3,"ngSwitch"],["class","slds-size--1-of-1 slds-height_full child-height-full",3,"field","fieldconfig",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow","slds-m-right--x-small",3,"field"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-m-left--x-small",3,"field","fieldconfig"],[1,"slds-size--1-of-1","slds-height_full","child-height-full",3,"field","fieldconfig"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],["class","slds-grow","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow",3,"field"],["label","LBL_EDIT_WITH",1,"slds-m-right--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button",3,"click"],["label","LBL_RICH_TEXT_EDITOR"],["label","LBL_OR",1,"slds-m-horizontal--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button","slds-m-lef",3,"click"],["label","LBL_PAGE_BUILDER"],["label","LBL_HTML"],[1,"slds-m-right--x-small"],[3,"icon"]],template:function(e,t){if(1&e&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.bIt("click",(function(){return t.copyFromTemplate()})),r.nrm(4,"system-button-icon",4),r.k0s(),r.j41(5,"button",5),r.bIt("click",(function(){return t.expand("right")})),r.nrm(6,"system-button-icon",6),r.k0s(),r.DNE(7,gt,2,1,"ng-container",7),r.k0s(),r.j41(8,"div",8),r.DNE(9,Ut,9,6,"div",9)(10,Ct,9,6,"ng-template",null,10,r.C5r),r.k0s()(),r.j41(12,"div",11)(13,"div",12)(14,"button",5),r.bIt("click",(function(){return t.expand("left")})),r.nrm(15,"system-button-icon",13),r.k0s(),r.DNE(16,$t,2,1,"div",14),r.k0s(),r.j41(17,"div",15),r.nrm(18,"email-templates-preview",16),r.k0s()()(),r.DNE(19,Tt,2,1,"ng-template",null,17,r.C5r)),2&e){const e=r.sdS(11);r.AVh("spice-fullscreen",t.isFullscreen),r.R7$(),r.Y8G("ngClass",r.sMw(11,Dt,!t.expanded,"right"==t.expanded,"left"==t.expanded)),r.R7$(2),r.Y8G("disabled",!t.view.isEditMode()),r.R7$(4),r.Y8G("ngIf","left"==t.expanded),r.R7$(2),r.Y8G("ngIf",!t.view.isEditMode())("ngIfElse",e),r.R7$(3),r.Y8G("ngClass",r.eq3(15,Yt,"left"==t.expanded)),r.R7$(4),r.Y8G("ngIf","left"!=t.expanded),r.R7$(2),r.Y8G("previewForBean",t.fieldsNames.previewForBean)("bodyHtmlField",t.fieldsNames.bodyHtmlField)}},dependencies:[i.YU,i.bT,i.T3,i.ux,i.e1,i.fG,at.y,k.t,L.W,ft],encapsulation:2,changeDetection:0})}return EmailTemplatesEditor})();var Nt=s(40553),At=s(89166),Vt=s(90154);function Ht(e,t){if(1&e&&r.nrm(0,"field-label",3),2&e){const e=r.XpG();r.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}const zt=(e,t)=>({"text-decoration":e,"font-weight":t});function Pt(e,t){if(1&e&&(r.j41(0,"field-generic-display",4)(1,"div",5)(2,"div",6),r.nrm(3,"system-utility-icon",7),r.k0s(),r.j41(4,"div",8),r.EFF(5),r.k0s()()()),2&e){const e=r.XpG();r.Y8G("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig)("fieldid",e.fieldid),r.R7$(2),r.Y8G("system-title",e.statusLabel),r.R7$(),r.Y8G("icon",e.statusIcon),r.R7$(),r.Y8G("title",e.value)("ngStyle",r.l_i(9,zt,"user_closed"==e.model.data.openness||"system_closed"==e.model.data.openness?"line-through":"initial","unread"==e.model.data.status?"bold":"initial")),r.R7$(),r.SpI(" ",e.value," ")}}function qt(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",9)(1,"input",10),r.mxI("ngModelChange",(function(t){r.eBV(e);const s=r.XpG();return r.DH7(s.value,t)||(s.value=t),r.Njj(t)})),r.k0s(),r.nrm(2,"field-messages",11),r.k0s()}if(2&e){const e=r.XpG();r.Y8G("ngClass",e.getFieldClass()),r.R7$(),r.R50("ngModel",e.value),r.Y8G("maxlength",e.fieldlength)("autocomplete",e.fieldid)("ngModelOptions",e.modelOptions),r.R7$(),r.Y8G("fieldname",e.fieldname)}}let Jt=(()=>{class fieldEmailSubject extends Q.s{constructor(e,t,s,i,l,n,a,d,o,c,r,m,h){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a,this.injector=d,this.broadcast=o,this.configurationService=c,this.modal=r,this.cdRef=m,this.sanitized=h}get statusIcon(){switch(this.model.getField("status")){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get statusLabel(){switch(this.model.getField("status")){case"opened":case"read":return"LBL_OPEN";case"bounced":case"deferred":case"send_error":return"LBL_ERROR";case"sent":return"LBL_OUTBOUND";default:return"LBL_UNREAD"}}static#e=this.ɵfac=function(e){return new(e||fieldEmailSubject)(r.rXU(_.g),r.rXU(y.U),r.rXU(m.B),r.rXU(h.yu),r.rXU(v.H),r.rXU(_e.o),r.rXU(ee.Ix),r.rXU(r.zZn),r.rXU(Nt.m),r.rXU(ye.i),r.rXU(G.y),r.rXU(r.gRc),r.rXU(X.up))};static#t=this.ɵcmp=r.VBU({type:fieldEmailSubject,selectors:[["field-email-subject"]],features:[r.Vt3],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],["class","slds-form-element__control slds-is-relative","style","position:relative;",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-right--x-small",3,"system-title"],["size","x-small",3,"icon"],[1,"slds-truncate",3,"title","ngStyle"],[1,"slds-form-element__control","slds-is-relative",2,"position","relative",3,"ngClass"],["system-placeholder","","type","text",1,"slds-input",3,"ngModel","maxlength","autocomplete","ngModelOptions","ngModelChange"],[3,"fieldname"]],template:function(e,t){1&e&&r.DNE(0,Ht,1,2,"field-label",0)(1,Pt,6,12,"field-generic-display",1)(2,qt,3,6,"div",2),2&e&&(r.Y8G("ngIf",t.displayLabel),r.R7$(),r.Y8G("ngIf",!t.isEditMode()),r.R7$(),r.Y8G("ngIf",t.isEditable()&&t.isEditMode()))},dependencies:[i.YU,i.bT,i.B3,l.me,l.BC,l.tU,l.vS,te.b,se.K,At.A,ie.B,Vt.m,Me.L],encapsulation:2})}return fieldEmailSubject})();function Wt(e,t){if(1&e&&r.nrm(0,"field-label",3),2&e){const e=r.XpG();r.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Kt(e,t){if(1&e){const e=r.RV6();r.j41(0,"button",4),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.setOpenness("user_closed"))})),r.nrm(1,"system-button-icon",5),r.k0s()}if(2&e){const e=r.XpG();r.Y8G("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function Zt(e,t){if(1&e){const e=r.RV6();r.j41(0,"button",4),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.setOpenness("open"))})),r.nrm(1,"system-button-icon",6),r.k0s()}if(2&e){const e=r.XpG();r.Y8G("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}let Qt=(()=>{class fieldEmailActivityOpenness extends Q.s{constructor(e,t,s,i,l,n,a){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest(`module/${this.model.module}/${this.model.id}/openness`,null,{openness:e}).subscribe((e=>{}),(t=>{this.toast.sendAlert("Cannot change openness to "+e)}))}static#e=this.ɵfac=function(e){return new(e||fieldEmailActivityOpenness)(r.rXU(_.g),r.rXU(y.U),r.rXU(m.B),r.rXU(h.yu),r.rXU(v.H),r.rXU(_e.o),r.rXU(ee.Ix))};static#t=this.ɵcmp=r.VBU({type:fieldEmailActivityOpenness,selectors:[["field-email-activity-openness"]],features:[r.Vt3],decls:4,vars:4,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngClass"],["class","slds-button slds-button--icon",3,"disabled","title","click",4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-button","slds-button--icon",3,"disabled","title","click"],["icon","unlock"],["icon","lock"]],template:function(e,t){1&e&&(r.DNE(0,Wt,1,2,"field-label",0),r.j41(1,"div",1),r.DNE(2,Kt,2,2,"button",2)(3,Zt,2,2,"button",2),r.k0s()),2&e&&(r.Y8G("ngIf",t.displayLabel),r.R7$(),r.Y8G("ngClass",t.getFieldClass()),r.R7$(),r.Y8G("ngIf","open"==t.model.data.openness),r.R7$(),r.Y8G("ngIf","user_closed"==t.model.data.openness||"system_closed"==t.model.data.openness))},dependencies:[i.YU,i.bT,te.b,k.t],encapsulation:2})}return fieldEmailActivityOpenness})();function es(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",9)(1,"div")(2,"system-checkbox",10),r.mxI("ngModelChange",(function(t){const s=r.eBV(e).$implicit;return r.DH7(s.selected,t)||(s.selected=t),r.Njj(t)})),r.k0s()(),r.j41(3,"div"),r.nrm(4,"system-icon",11),r.k0s(),r.j41(5,"div",12),r.EFF(6),r.k0s(),r.j41(7,"div"),r.EFF(8),r.k0s()()}if(2&e){const e=t.$implicit;r.R7$(2),r.R50("ngModel",e.selected),r.R7$(2),r.Y8G("module",e.module),r.R7$(2),r.JRh(e.summary_text),r.R7$(2),r.SpI("(",e.email_address,")")}}function ts(e,t){if(1&e){const e=r.RV6();r.j41(0,"system-modal",1)(1,"system-modal-header",2),r.bIt("close",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.close())})),r.nrm(2,"system-label",3),r.k0s(),r.j41(3,"system-modal-content"),r.DNE(4,es,9,4,"div",4),r.k0s(),r.j41(5,"system-modal-footer")(6,"button",5),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.close())})),r.nrm(7,"system-label",6),r.k0s(),r.j41(8,"button",7),r.bIt("click",(function(){r.eBV(e);const t=r.XpG();return r.Njj(t.add())})),r.nrm(9,"system-label",8),r.k0s()()()}if(2&e){const e=r.XpG();r.R7$(4),r.Y8G("ngForOf",e.addresses),r.R7$(4),r.Y8G("disabled",!e.canAdd)}}let ss=(()=>{class EmailParentAddressesModal{constructor(e,t,s,i){this.model=e,this.modal=t,this.toast=s,this.backend=i,this.addresses=[],this.addAddresses=new r.bkB}ngOnInit(){let e=this.modal.await("LBL_LOADING");this.backend.getRequest(`module/EmailAddresses/${this.model.getField("parent_type")}/${this.model.getField("parent_id")}`).subscribe((t=>{this.addresses=t,0==this.addresses.length&&(this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","info"),this.close()),e.emit(!0)}),(()=>{this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","error"),e.emit(!0),this.close()}))}get canAdd(){return this.addresses.filter((e=>e.selected)).length>0}add(){this.addAddresses.emit(this.addresses.filter((e=>e.selected))),this.close()}close(){this.self.destroy()}static#e=this.ɵfac=function(e){return new(e||EmailParentAddressesModal)(r.rXU(_.g),r.rXU(G.y),r.rXU(_e.o),r.rXU(v.H))};static#t=this.ɵcmp=r.VBU({type:EmailParentAddressesModal,selectors:[["email-parent-addresses-modal"]],decls:1,vars:1,consts:[["size","small",4,"ngIf"],["size","small"],[3,"close"],["label","LBL_SELECT_PARENT_EMAIL"],["class","slds-grid slds-p-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-button","slds-button_neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button_brand",3,"disabled","click"],["label","LBL_ADD"],[1,"slds-grid","slds-p-vertical--xx-small"],[3,"ngModel","ngModelChange"],["size","x-small",3,"module"],[1,"slds-p-right--small"]],template:function(e,t){1&e&&r.DNE(0,ts,10,2,"system-modal",0),2&e&&r.Y8G("ngIf",t.addresses.length>0)},dependencies:[i.Sq,i.bT,l.BC,l.vS,Ue.f,Fe.J,L.W,S.D,$.I,T.Q,D.C],encapsulation:2})}return EmailParentAddressesModal})();var is=s(4921);const ls=["contextMenu"];function ns(e,t){if(1&e){const e=r.RV6();r.j41(0,"li",7)(1,"a",8),r.bIt("click",(function(){const t=r.eBV(e).$implicit,s=r.XpG(2);return r.Njj(s.setField(t))})),r.j41(2,"span",9),r.nrm(3,"system-label-fieldname",10),r.k0s()()()}if(2&e){const e=t.$implicit,s=r.XpG(2);r.R7$(3),r.Y8G("module",s.emailmodule)("field",e)}}function as(e,t){if(1&e&&(r.j41(0,"div",3,4)(2,"ul",5),r.DNE(3,ns,4,2,"li",6),r.k0s()()),2&e){const e=r.XpG();r.Y8G("ngStyle",e.contextMenuStyle),r.R7$(3),r.Y8G("ngForOf",e.emailfields)}}let ds=(()=>{class EmailToLeadEmailText{constructor(e,t,s){this.elementRef=e,this.renderer=t,this.language=s,this.emailtext="",this.emailhtml="",this.emailmodule="",this.emailfields=["first_name","last_name"],this.setfield=new r.bkB,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static#e=this.ɵfac=function(e){return new(e||EmailToLeadEmailText)(r.rXU(r.aKT),r.rXU(r.sFG),r.rXU(m.B))};static#t=this.ɵcmp=r.VBU({type:EmailToLeadEmailText,selectors:[["email-to-lead-emailtext"]],viewQuery:function(e,t){if(1&e&&r.GBs(ls,7,r.c1b),2&e){let e;r.mGM(e=r.lsd())&&(t.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1),r.bIt("contextmenu",(function(e){return t.showContextMenu(e)})),r.k0s(),r.DNE(2,as,4,2,"div",2),r.k0s()),2&e&&(r.R7$(),r.Y8G("innerHTML",t.content,r.npT),r.R7$(),r.Y8G("ngIf",t.displayContextMenu))},dependencies:[i.Sq,i.bT,i.B3,u.P],encapsulation:2})}return EmailToLeadEmailText})();const os=["detailcontainer"];let cs=(()=>{class EmailToLeadModal{constructor(e,t,s,i,l,n){this.language=e,this.metadata=t,this.view=s,this.model=i,this.footer=l,this.toast=n,this.email=null,this.self=null,this.componentRefs=[],this.leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"],this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}static#e=this.ɵfac=function(e){return new(e||EmailToLeadModal)(r.rXU(m.B),r.rXU(h.yu),r.rXU(y.U),r.rXU(_.g),r.rXU(is.q),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&r.GBs(os,7,r.c1b),2&e){let e;r.mGM(e=r.lsd())&&(t.detailcontainer=e.first)}},features:[r.Jv_([_.g,y.U])],decls:20,vars:5,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"]],template:function(e,t){1&e&&(r.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.bIt("click",(function(){return t.closeModal()})),r.nrm(4,"system-button-icon",4),r.k0s(),r.j41(5,"h2",5),r.nrm(6,"system-label",6),r.k0s()(),r.j41(7,"div",7)(8,"div",8)(9,"div",9)(10,"email-to-lead-emailtext",10),r.bIt("setfield",(function(e){return t.setField(e)})),r.k0s()(),r.j41(11,"div",11),r.nrm(12,"div",null,12),r.k0s()()(),r.j41(14,"div",13)(15,"button",14),r.bIt("click",(function(){return t.closeModal()})),r.nrm(16,"system-label",15),r.k0s(),r.j41(17,"button",16),r.bIt("click",(function(){return t.saveLead()})),r.nrm(18,"system-label",17),r.k0s()()()(),r.nrm(19,"div",18)),2&e&&(r.R7$(4),r.Y8G("icon","close"),r.R7$(6),r.Y8G("emailmodule",t.model.module)("emailtext",t.email.data.body)("emailhtml",t.email.data.body)("emailfields",t.leadFields))},dependencies:[k.t,L.W,ds],encapsulation:2})}return EmailToLeadModal})(),rs=(()=>{class EmailToLeadButton{constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.model=s,this.footer=i,this.toast=l}createLead(){this.metadata.addComponent("EmailToLeadModal",this.footer.footercontainer).subscribe((e=>{e.instance.email=this.model,e.instance.self=e}))}static#e=this.ɵfac=function(e){return new(e||EmailToLeadButton)(r.rXU(m.B),r.rXU(h.yu),r.rXU(_.g),r.rXU(is.q),r.rXU(_e.o))};static#t=this.ɵcmp=r.VBU({type:EmailToLeadButton,selectors:[["ng-component"]],hostAttrs:[1,"slds-button","slds-button--neutral"],hostBindings:function(e,t){1&e&&r.bIt("click",(function(){return t.createLead()}))},decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s())},dependencies:[L.W],styles:["\n\n\n\n\n\n\n\n\n\n\n[_nghost-%COMP%]{cursor:pointer}"]})}return EmailToLeadButton})();var ms=s(95757);let hs=(()=>{class EmailCloneAttachmentsButton{constructor(e,t,s,i,l,n,a){this.model=e,this.modal=t,this.toast=s,this.injector=i,this.metadata=l,this.activityTimeline=n,this.parentModel=a}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")&&!this.activityTimeline.parent||!this.parentModel}execute(){this.modal.openModal("EmailCloneAttachmentsModal",!0,this.injector).subscribe((e=>{e.instance.parent=this.activityTimeline?.parent??this.parentModel}))}static#e=this.ɵfac=function(e){return new(e||EmailCloneAttachmentsButton)(r.rXU(_.g),r.rXU(G.y),r.rXU(_e.o),r.rXU(r.zZn),r.rXU(h.yu),r.rXU(ms.k,8),r.rXU(_.g,4))};static#t=this.ɵcmp=r.VBU({type:EmailCloneAttachmentsButton,selectors:[["email-clone-attachments-button"]],decls:2,vars:0,consts:[["label","LBL_CLONE_ATTACHMENTS"]],template:function(e,t){1&e&&(r.j41(0,"span"),r.nrm(1,"system-label",0),r.k0s())},dependencies:[L.W],encapsulation:2})}return EmailCloneAttachmentsButton})();var us=s(70335),fs=s(27778);function bs(e,t){1&e&&r.nrm(0,"system-spinner")}function gs(e,t){1&e&&(r.j41(0,"system-illustration-no-records"),r.nrm(1,"system-label",13),r.k0s())}function ps(e,t){if(1&e&&(r.qex(0),r.j41(1,"div",12),r.DNE(2,bs,1,0,"system-spinner",5)(3,gs,2,0,"system-illustration-no-records",5),r.k0s(),r.bVm()),2&e){const e=r.XpG();r.R7$(2),r.Y8G("ngIf",!e.showIllustration),r.R7$(),r.Y8G("ngIf",e.showIllustration)}}const _s=e=>({"slds-theme_shade":e});function ys(e,t){if(1&e){const e=r.RV6();r.j41(0,"div",15)(1,"div")(2,"system-checkbox",16),r.mxI("ngModelChange",(function(t){const s=r.eBV(e).$implicit;return r.DH7(s.selected,t)||(s.selected=t),r.Njj(t)})),r.k0s()(),r.j41(3,"div"),r.nrm(4,"spice-attachment-file",17),r.k0s()()}if(2&e){const e=t.$implicit,s=r.XpG(2);r.Y8G("ngClass",r.eq3(7,_s,e.selected)),r.R7$(2),r.R50("ngModel",e.selected),r.Y8G("disabled",!1),r.R7$(2),r.Y8G("modelattachments",s.modelattachments)("file",e)("editmode",!1)("disabled",!0)}}function vs(e,t){if(1&e&&r.DNE(0,ys,5,9,"div",14),2&e){const e=r.XpG();r.Y8G("ngForOf",e.filteredFiles)}}function Es(e,t){if(1&e&&(r.j41(0,"div",20)(1,"div"),r.nrm(2,"system-checkbox",21),r.k0s(),r.j41(3,"div"),r.nrm(4,"spice-attachment-file",17),r.k0s()()),2&e){const e=t.$implicit,s=r.XpG(2);r.R7$(2),r.Y8G("disabled",!0),r.R7$(2),r.Y8G("modelattachments",s.modelattachments)("file",e)("editmode",!1)("disabled",!0)}}const ks=e=>({"slds-border_top":e});function Ls(e,t){if(1&e&&(r.j41(0,"div"),r.nrm(1,"div",18),r.DNE(2,Es,5,5,"div",19),r.k0s()),2&e){const e=r.XpG();r.R7$(),r.Y8G("ngClass",r.eq3(2,ks,e.showArchive&&e.filteredFiles.length>0)),r.R7$(),r.Y8G("ngForOf",e.linkedFiles)}}let Rs=(()=>{class EmailCloneAttachmentsModal{constructor(e,t,s,i,l,n,a){this.model=e,this.backend=t,this.toast=s,this.modelattachments=i,this.cdRef=l,this.modal=n,this.broadcast=a,this.linkedFiles=[],this.filteredFiles=[],this.parentFiles=[],this.parentCount=0,this.showIllustration=!1,this.showArchive=!1}ngAfterViewInit(){this.loadFiles()}loadFiles(){this.getParentAttachments(this.parent).subscribe({next:e=>{this.filteredFiles=this.modelattachments.files.filter((e=>!this.parentFiles.some((t=>t.filemd5===e.filemd5)))),0==this.filteredFiles.length&&(this.showIllustration=!0),this.linkedFiles=this.modelattachments.files.filter((e=>this.parentFiles.some((t=>t.filemd5===e.filemd5)))),this.cdRef.detectChanges()},error:()=>{this.showIllustration=!0,this.toast.sendToast("LBL_ERROR","error")}})}get canSave(){return this.filteredFiles.filter((e=>e.selected)).length>0}save(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{const t=this.modelattachments.files.filter((e=>e.selected));this.cloneAttachmentsFromEmail(this.parent,t).subscribe((t=>{e.instance.self.destroy(),t?(this.toast.sendToast("LBL_SUCCESS","success"),this.close()):this.toast.sendToast("LBL_ERROR","error")}))}))}broadcastAttachmentCount(){this.broadcast.broadcastMessage("attachments.cloned",{module:this.parent.module,id:this.parent.id,attachmentcount:this.parentCount,clonedFiles:this.parentFiles,reload:!0})}close(){this.self.destroy()}getParentAttachments(e){let t=new je.B;return this.modelattachments.getAttachments().subscribe((s=>{this.backend.getRequest(`common/spiceattachments/module/${e.module}/${e.id}`,{},this.modelattachments.httpRequestsRefID).subscribe({next:e=>{for(let t in e)this.parentFiles.push(e[t]);t.next(this.parentFiles),t.complete()},error:e=>{t.error(e),t.complete()}})})),t.asObservable()}cloneAttachmentsFromEmail(e,t,s){let i=new je.B;const l={categoryId:s,selectedFiles:t};return this.backend.postRequest(`common/spiceattachments/module/${this.parent.module}/${this.parent.id}/clone/${this.model.module}/${this.model.id}`,{},l,this.modelattachments.httpRequestsRefID).subscribe({next:e=>{for(let t in e)this.filteredFiles.find((e=>e.id==t))||(e[t].date=new moment(e[t].date),this.parentFiles.push(e[t]));this.parentCount=this.parentFiles.length,this.broadcastAttachmentCount(),i.next(this.parentFiles),i.complete()},error:e=>{i.error(e),i.complete()}}),i.asObservable()}static#e=this.ɵfac=function(e){return new(e||EmailCloneAttachmentsModal)(r.rXU(_.g),r.rXU(v.H),r.rXU(_e.o),r.rXU(C.S),r.rXU(r.gRc),r.rXU(G.y),r.rXU(Nt.m))};static#t=this.ɵcmp=r.VBU({type:EmailCloneAttachmentsModal,selectors:[["email-clone-attachments-modal"]],features:[r.Jv_([y.U])],decls:15,vars:7,consts:[["size","small"],[3,"close"],["label","LBL_CLONE_ATTACHMENTS"],[4,"ngIf","ngIfElse"],["showAttachments",""],[4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-col--bump-right",3,"ngModel","disabled","label","ngModelChange"],[1,"slds-col--bump-left","slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"],[1,"slds-align--absolute-center","slds-p-around--small"],["label","LBL_NO_RECORDS"],["class","slds-grid slds-grid_vertical-align-center slds-p-around--xx-small",3,"ngClass",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--xx-small",3,"ngClass"],[3,"ngModel","disabled","ngModelChange"],[1,"slds-media",2,"pointer-events","none",3,"modelattachments","file","editmode","disabled"],[3,"ngClass"],["class","slds-grid slds-grid_vertical-align-center slds-p-around--xx-small",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--xx-small"],[3,"disabled"]],template:function(e,t){if(1&e&&(r.j41(0,"system-modal",0)(1,"system-modal-header",1),r.bIt("close",(function(){return t.close()})),r.nrm(2,"system-label",2),r.k0s(),r.j41(3,"system-modal-content"),r.DNE(4,ps,4,2,"ng-container",3)(5,vs,1,1,"ng-template",null,4,r.C5r)(7,Ls,3,4,"div",5),r.k0s(),r.j41(8,"system-modal-footer")(9,"div",6)(10,"system-checkbox-toggle",7),r.mxI("ngModelChange",(function(e){return r.DH7(t.showArchive,e)||(t.showArchive=e),e})),r.k0s(),r.j41(11,"button",8),r.bIt("click",(function(){return t.close()})),r.nrm(12,"system-label",9),r.k0s(),r.j41(13,"button",10),r.bIt("click",(function(){return t.save()})),r.nrm(14,"system-label",11),r.k0s()()()()),2&e){const e=r.sdS(6);r.R7$(4),r.Y8G("ngIf",0==t.filteredFiles.length&&!t.showArchive)("ngIfElse",e),r.R7$(3),r.Y8G("ngIf",t.showArchive&&t.linkedFiles.length>0),r.R7$(3),r.R50("ngModel",t.showArchive),r.Y8G("disabled",0==t.linkedFiles.length)("label","LBL_SHOW_LINKED"),r.R7$(3),r.Y8G("disabled",!t.canSave)}},dependencies:[i.YU,i.Sq,i.bT,l.BC,l.vS,Ue.f,us.x,Ve.b,L.W,S.D,$.I,T.Q,D.C,Y.P,fs.E],encapsulation:2})}return EmailCloneAttachmentsModal})();var xs=s(28618);function js(e,t){if(1&e&&r.nrm(0,"field-label",3),2&e){const e=r.XpG(2);r.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Bs(e,t){if(1&e){const e=r.RV6();r.j41(0,"div"),r.DNE(1,js,1,2,"field-label",1),r.j41(2,"system-checkbox",2),r.mxI("ngModelChange",(function(t){r.eBV(e);const s=r.XpG();return r.DH7(s.zipCompress,t)||(s.zipCompress=t),r.Njj(t)})),r.bIt("ngModelChange",(function(t){r.eBV(e);const s=r.XpG();return r.Njj(s.setZip(t))})),r.k0s()()}if(2&e){const e=r.XpG();r.R7$(),r.Y8G("ngIf",e.displayLabel),r.R7$(),r.R50("ngModel",e.zipCompress)}}let Us=(()=>{class fieldZipCompress extends Q.s{constructor(e,t,s,i,l,n,a,d,o){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a,this.modelattachments=d,this.configuration=o,this.modelattachments.module=this.model.module,this.modelattachments.id=this.model.id,this.setUploadSettings(this.model.getField("mailbox_id")),this.model.observeFieldChanges("mailbox_id").subscribe((e=>this.setUploadSettings(e)))}get zipHidden(){return"0"==this.mailboxZipConfig}setUploadSettings(e){e&&this.backend.getRequest("module/Mailboxes/scope").subscribe((t=>{const s=t.find((t=>t.value==e));this.mailboxZipConfig=s.zip_compress}))}setZip(e){this.model.setField("zip_compress",e)}static#e=this.ɵfac=function(e){return new(e||fieldZipCompress)(r.rXU(_.g),r.rXU(y.U),r.rXU(m.B),r.rXU(h.yu),r.rXU(v.H),r.rXU(_e.o),r.rXU(ee.Ix),r.rXU(C.S),r.rXU(ye.i))};static#t=this.ɵcmp=r.VBU({type:fieldZipCompress,selectors:[["field-zip-compress"]],features:[r.Jv_([C.S]),r.Vt3],decls:1,vars:1,consts:[[4,"ngIf"],[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngModel","ngModelChange"],[3,"fieldname","fieldconfig"]],template:function(e,t){1&e&&r.DNE(0,Bs,3,2,"div",0),2&e&&r.Y8G("ngIf",!t.zipHidden)},dependencies:[i.bT,l.BC,l.vS,te.b,Ue.f],encapsulation:2})}return fieldZipCompress})();function Fs(e,t){if(1&e&&r.nrm(0,"field-label",3),2&e){const e=r.XpG(2);r.Y8G("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Ms(e,t){if(1&e){const e=r.RV6();r.j41(0,"div"),r.DNE(1,Fs,1,2,"field-label",1),r.j41(2,"system-checkbox",2),r.mxI("ngModelChange",(function(t){r.eBV(e);const s=r.XpG();return r.DH7(s.sendReadReceipt,t)||(s.sendReadReceipt=t),r.Njj(t)})),r.bIt("ngModelChange",(function(t){r.eBV(e);const s=r.XpG();return r.Njj(s.setReadReceipt(t))})),r.k0s()()}if(2&e){const e=r.XpG();r.R7$(),r.Y8G("ngIf",e.displayLabel),r.R7$(),r.R50("ngModel",e.sendReadReceipt)}}let ws=(()=>{class fieldReadReceipt extends Q.s{constructor(e,t,s,i,l,n,a,d,o){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a,this.modelattachments=d,this.configuration=o,this.modelattachments.module=this.model.module,this.modelattachments.id=this.model.id,this.setMailboxSettings(this.model.getField("mailbox_id")),this.model.observeFieldChanges("mailbox_id").subscribe((e=>this.setMailboxSettings(e)))}get hidden(){return"0"==this.mailboxReadReceiptConfig}setMailboxSettings(e){e&&this.backend.getRequest("module/Mailboxes/scope").subscribe((t=>{const s=t.find((t=>t.value==e));this.mailboxReadReceiptConfig=s.send_read_receipt}))}setReadReceipt(e){this.model.setField("send_read_receipt",e)}static#e=this.ɵfac=function(e){return new(e||fieldReadReceipt)(r.rXU(_.g),r.rXU(y.U),r.rXU(m.B),r.rXU(h.yu),r.rXU(v.H),r.rXU(_e.o),r.rXU(ee.Ix),r.rXU(C.S),r.rXU(ye.i))};static#t=this.ɵcmp=r.VBU({type:fieldReadReceipt,selectors:[["field-read-receipt"]],features:[r.Jv_([C.S]),r.Vt3],decls:1,vars:1,consts:[[4,"ngIf"],[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngModel","ngModelChange"],[3,"fieldname","fieldconfig"]],template:function(e,t){1&e&&r.DNE(0,Ms,3,2,"div",0),2&e&&r.Y8G("ngIf",!t.hidden)},dependencies:[i.bT,l.BC,l.vS,te.b,Ue.f],encapsulation:2})}return fieldReadReceipt})(),Gs=(()=>{class ModuleEmails{static#e=this.ɵfac=function(e){return new(e||ModuleEmails)};static#t=this.ɵmod=r.$C({type:ModuleEmails});static#s=this.ɵinj=r.G2t({imports:[i.MD,l.YN,a.ObjectFields,d.GlobalComponents,o.ObjectComponents,c.SystemComponents,n.h,xs.ModuleSpiceAttachments]})}return ModuleEmails})();("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(Gs,{declarations:[I,p,M,V,q,Z,de,oe,be,ve,ge,pe,ke,xe,Be,Le,Ne,We,it,nt,Ot,ft,ss,Jt,Qt,cs,ds,rs,hs,Rs,Us,ws],imports:[i.MD,l.YN,a.ObjectFields,d.GlobalComponents,o.ObjectComponents,c.SystemComponents,n.h,xs.ModuleSpiceAttachments]})},95757:(e,t,s)=>{s.d(t,{k:()=>u});var i=s(54438),l=s(84412),n=s(7673),a=s(21413),d=s(83935),o=s(49722),c=s(92462),r=s(53584),m=s(29994),h=s(40553);let u=(()=>{class activitiytimeline{constructor(e,t,s,n,a,d){this.metadata=e,this.backend=t,this.modelutilities=s,this.configurationService=n,this.session=a,this.broadcast=d,this.httpRequestsRefID=_.uniqueId("activity_timeline_http_ref_"),this.serviceSubscriptions=[],this.filters={searchterm:"",objectfilters:[],own:""},this.loading$=new i.bkB,this.defaultLimit=5,this.modules=["Activities","History"],this.activeStates=["Planned","In Progress","Not Started","Pending Input"],this.activityObjects=["Tasks","Meetings","Calls","Notes","Emails"],this.sortDates={Calls:"date_start",Meetings:"date_start",Tasks:"date_due",Emails:"date_entered",Notes:"date_entered"},this.activities={Activities:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]},History:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]}},this.usefts=!1,this._openness=!1,this.serviceSubscriptions.push(this.broadcast.message$.subscribe((e=>this.handleMessage(e)))),this.openness$=new l.t(this._openness)}get openness(){return this._openness}set openness(e){this._openness=e,this.openness$.next(e)}get filterObjects(){if(this.usefts){let e=[];for(let t in this.activities)e=e.concat(this.getAggregateObjects(t));return _.uniq(e)}return this.activityObjects}getAggregateObjects(e){try{let t=[];for(let s of this.activities[e].aggregates.module)t.push(s.module);return t}catch(e){return[]}}stopSubscriptions(){for(let e of this.serviceSubscriptions)e.unsubscribe();this.backend.cancelPendingRequests([this.httpRequestsRefID])}handleMessage(e){let t=e.messagetype.split(".");if("model"===t[0])switch(t[1]){case"merge":this.parent&&e.messagedata.module==this.parent.module&&e.messagedata.id==this.parent.id&&(this.getTimeLineData("Activities",!0),this.getTimeLineData("History",!0));break;case"save":this.metadata.getModuleDefs(e.messagedata.module).ftsactivities.Activities&&this.getTimeLineData("Activities",!0),this.metadata.getModuleDefs(e.messagedata.module).ftsactivities.History&&this.getTimeLineData("History",!0);break;case"delete":for(let t of this.modules){let s=this.activities[t].list.findIndex((t=>t.module==e.messagedata.module&&t.id==e.messagedata.id));s>=0&&this.activities[t].list.splice(s,1)}}}checkModuleActive(e){return 0==this.filters.objectfilters.length||this.filters.objectfilters.indexOf(e)>=0}toggleModuleFilter(e){0==this.filters.objectfilters.length?(this.filters.objectfilters=this.filterObjects,this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(e),1)):this.filters.objectfilters.indexOf(e)>=0?this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(e),1):(this.filters.objectfilters.push(e),this.filters.objectfilters.length==this.filterObjects.length&&(this.filters.objectfilters=[]))}reload(e=!1){this.loading$.emit(!0);for(let t of this.modules)this.getTimeLineData(t,e)}getTimeLineData(e,t=!1){t||(this.activities[e].loading=!0);let s={count:!0,limit:this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};this.backend.postRequest("module/"+e+"/fts/"+this.parent.module+"/"+this.parent.id,{},s,this.httpRequestsRefID).subscribe({next:t=>{if(t){this.resetListData(e);for(let e of t.items)e.data=this.modelutilities.backendModel2spice(e.module,e.data);this.activities[e].list=t.items,this.activities[e].totalcount=parseInt(t.totalcount,10),this.activities[e].aggregates=t.aggregates?t.aggregates:[]}this.activities[e].loading=!1},error:t=>{this.activities[e].loading=!1}})}getMoreTimeLineData(e,t){if(!this.canLoadMore(e)||this.activities[e].loading)return(0,n.of)(!0);let s=new a.B,i={start:this.activities[e].list.length,limit:t||this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};return this.activities[e].loadingmore=!0,this.backend.postRequest("module/"+e+"/fts/"+this.parent.module+"/"+this.parent.id,{},i,this.httpRequestsRefID).subscribe({next:t=>{for(let s of t.items)s.data=this.modelutilities.backendModel2spice(s.module,s.data),this.activities[e].list.push(s);this.activities[e].loadingmore=!1,s.next(!0),s.complete()},error:t=>{this.activities[e].loadingmore=!1,s.error(t),s.complete()}}),s.asObservable()}resetListData(e){this.activities[e]={loading:!1,loadingmore:!1,list:[],totalcount:0}}canLoadMore(e){return this.activities[e].totalcount>this.activities[e].list.length&&!this.activities[e].loadingmore}sortListdata(e){this.activities[e].list.sort(((t,s)=>{let i=new moment(t.data[this.sortDates[t.module]]),l=new moment(s.data[this.sortDates[s.module]]);return"Activities"!==e?i.isBefore(l):i.isAfter(l)}))}static#e=this.ɵfac=function(e){return new(e||activitiytimeline)(i.KVO(d.yu),i.KVO(o.H),i.KVO(c.g),i.KVO(r.i),i.KVO(m.d),i.KVO(h.m))};static#t=this.ɵprov=i.jDH({token:activitiytimeline,factory:activitiytimeline.ɵfac})}return activitiytimeline})()}}]);