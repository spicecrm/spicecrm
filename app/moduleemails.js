/*!
 * 
 *                     aacService
 *
 *                     release: 2023.02.001
 *
 *                     date: 2023-08-14 15:46:31
 *
 *                     build: 2023.02.001.1692020791886
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_emails_moduleemails_ts"],{8544:(e,t,s)=>{s.r(t),s.d(t,{ModuleEmails:()=>cs});var i=s(1180),l=s(4755),d=s(5030),n=s(4357),o=s(3190),a=s(4826),c=s(6490),r=s(3735),m=s(2242),u=s(5329),h=s(4154),p=s(7674);const g=["contextMenu"];function f(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"li",7)(1,"a",8),m.NdJ("click",(function(){const t=m.CHM(e).$implicit,s=m.oxw(2);return m.KtG(s.setField(t))})),m.TgZ(2,"span",9),m._UZ(3,"system-label-fieldname",10),m.qZA()()()}if(2&e){const e=t.$implicit,s=m.oxw(2);m.xp6(3),m.Q6J("module",s.target_module_name)("field",e)}}function b(e,t){if(1&e&&(m.TgZ(0,"div",3,4)(2,"ul",5),m.YNc(3,f,4,2,"li",6),m.qZA()()),2&e){const e=m.oxw();m.Q6J("ngStyle",e.contextMenuStyle),m.xp6(3),m.Q6J("ngForOf",e.target_module_fields)}}let Z=(()=>{var e;class EmailToObjectEmailText{constructor(e,t,s,l){(0,i.Z)(this,"elementRef",void 0),(0,i.Z)(this,"renderer",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"contextMenu",void 0),(0,i.Z)(this,"text",""),(0,i.Z)(this,"html",""),(0,i.Z)(this,"target_module_name",""),(0,i.Z)(this,"target_module_fields",[]),(0,i.Z)(this,"setfield",new m.vpe),(0,i.Z)(this,"clickListener",null),(0,i.Z)(this,"displayContextMenu",!1),(0,i.Z)(this,"displayContextCoordinates",{top:0,left:0}),(0,i.Z)(this,"_striped_content",void 0),this.elementRef=e,this.renderer=t,this.language=s,this.metadata=l}get content(){return this.html?this.html:this.text}get striped_content(){return this._striped_content||(this.html?this._striped_content=this.html.replace(/<!--.*?-->/gs,"").replace(/<[^>]+>/g,"").replace(/[ ]{2,}/g," ").replace(/[\n\r]{3,}/g,"\n"):this._striped_content=this.text),this._striped_content}ngOnInit(){if(!this.target_module_fields||0===this.target_module_fields.length){let e=["varchar","text"],t=this.metadata.getModuleFields(this.target_module_name);for(let s in t)e.indexOf(t[s].type)>=0&&t[s].vname&&"id"!==t[s].name&&this.target_module_fields.push(s)}}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return e=EmailToObjectEmailText,(0,i.Z)(EmailToObjectEmailText,"ɵfac",(function(t){return new(t||e)(m.Y36(m.SBq),m.Y36(m.Qsj),m.Y36(u.d),m.Y36(h.Pu))})),(0,i.Z)(EmailToObjectEmailText,"ɵcmp",m.Xpm({type:e,selectors:[["email-to-object-emailtext"]],viewQuery:function(e,t){if(1&e&&m.Gf(g,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(t.contextMenu=e.first)}},inputs:{text:"text",html:"html",target_module_name:"target_module_name",target_module_fields:"target_module_fields"},outputs:{setfield:"setfield"},decls:4,vars:3,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-input",2,"height","100%","width","100%","resize","none",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1),m.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),m._uU(2),m.qZA(),m.YNc(3,b,4,2,"div",2),m.qZA()),2&e&&(m.xp6(1),m.Q6J("innerHTML",t.content,m.oJD),m.xp6(1),m.Oqu(t.striped_content),m.xp6(1),m.Q6J("ngIf",t.displayContextMenu))},dependencies:[l.sg,l.O5,l.PC,p.h],encapsulation:2})),EmailToObjectEmailText})();var _=s(5710),v=s(2294),x=s(4505),y=s(9062),E=s(2656),L=s(3463),w=s(3333),T=s(7763),M=s(3814);const k=["detailcontainer"];function A(e,t){if(1&e&&m._UZ(0,"object-record-fieldset",20),2&e){const e=m.oxw();m.Q6J("fieldset",e.componentconfig.emailFieldset)}}const B=function(e,t){return{module:"Emails",id:e,data:t}};let C=(()=>{var e;class EmailToObjectModal{constructor(e,t,s,l,d){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"detailcontainer",void 0),(0,i.Z)(this,"email_model",null),(0,i.Z)(this,"self",null),(0,i.Z)(this,"componentRefs",[]),(0,i.Z)(this,"save$",new m.vpe),(0,i.Z)(this,"object_module_name",void 0),(0,i.Z)(this,"object_fields",[]),(0,i.Z)(this,"object_relation_link_name",void 0),(0,i.Z)(this,"object_predefined_fields",void 0),(0,i.Z)(this,"componentconfig",void 0),this.language=e,this.metadata=t,this.view=s,this.model=l,this.backend=d}ngOnInit(){if(this.model.module=this.object_module_name,this.model.initializeModel(this.email_model),this.componentconfig=this.metadata.getComponentConfig("EmailToObjectModal",this.model.module),this.object_predefined_fields){let e={};for(let t in this.object_predefined_fields)e[t]=this.object_predefined_fields[t];this.model.setFields(e)}this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}close(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}save(){this.model.validate()&&this.model.save().subscribe((e=>{this.object_relation_link_name?this.backend.postRequest("module/Emails/"+this.email_model.id+"/related/"+this.object_relation_link_name,[],[this.model.id]).subscribe((e=>{this.save$.emit(this.model.data),this.close()})):(this.save$.emit(this.model.data),this.close())}))}}return e=EmailToObjectModal,(0,i.Z)(EmailToObjectModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(v.e),m.Y36(_.o),m.Y36(x.y))})),(0,i.Z)(EmailToObjectModal,"ɵcmp",m.Xpm({type:e,selectors:[["email-to-object-modal"]],viewQuery:function(e,t){if(1&e&&m.Gf(k,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(t.detailcontainer=e.first)}},inputs:{object_module_name:"object_module_name",object_fields:"object_fields",object_relation_link_name:"object_relation_link_name",object_predefined_fields:"object_predefined_fields"},outputs:{save$:"save$"},features:[m._Bn([_.o,v.e])],decls:21,vars:12,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],[3,"module","singular"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],["system-view-provider","",1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%",3,"system-model-provider"],[3,"fieldset",4,"ngIf"],[3,"target_module_name","text","html","target_module_fields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"],[3,"fieldset"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),m.NdJ("click",(function(){return t.close()})),m._UZ(4,"system-button-icon",4),m.qZA(),m.TgZ(5,"h2",5),m._UZ(6,"system-label-modulename",6),m.qZA()(),m.TgZ(7,"div",7)(8,"div",8)(9,"div",9),m.YNc(10,A,1,1,"object-record-fieldset",10),m.TgZ(11,"email-to-object-emailtext",11),m.NdJ("setfield",(function(e){return t.setField(e)})),m.qZA()(),m.TgZ(12,"div",12),m._UZ(13,"div",null,13),m.qZA()()(),m.TgZ(15,"div",14)(16,"button",15),m.NdJ("click",(function(){return t.close()})),m._UZ(17,"system-label",16),m.qZA(),m.TgZ(18,"button",17),m.NdJ("click",(function(){return t.save()})),m._UZ(19,"system-label",18),m.qZA()()()(),m._UZ(20,"div",19)),2&e&&(m.xp6(4),m.Q6J("icon","close"),m.xp6(2),m.Q6J("module",t.object_module_name)("singular",!0),m.xp6(3),m.Q6J("system-model-provider",m.WLB(9,B,t.email_model.id,t.email_model.data)),m.xp6(1),m.Q6J("ngIf",!(null==t.componentconfig||!t.componentconfig.emailFieldset)),m.xp6(1),m.Q6J("target_module_name",t.object_module_name)("text",t.email_model.data.body)("html",t.email_model.data.body)("target_module_fields",t.object_fields))},dependencies:[l.O5,y.d,E.J,L._,w.M,T.u,M.V,Z],encapsulation:2})),EmailToObjectModal})();var F=s(6040),J=s(4044);let S=(()=>{var e;class EmailToObjectButton{constructor(e,t,s,l,d){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"relatedmodels",void 0),(0,i.Z)(this,"object_module_name",void 0),(0,i.Z)(this,"actionconfig",void 0),(0,i.Z)(this,"relation_subscription",void 0),(0,i.Z)(this,"actionemitter",new m.vpe),(0,i.Z)(this,"subscription",void 0),this.language=e,this.model=t,this.metadata=s,this.modal=l,this.relatedmodels=d}get disabled(){if(!this.metadata.checkModuleAcl(this.actionconfig.module,"create"))return!0;if(this.actionconfig.checklink){if(this.relatedmodels.isloading)return!0;if(this.relatedmodels.count>0)return!0}return!1}ngOnInit(){this.object_module_name=this.actionconfig.module,this.actionconfig.checklink&&this.subscribeToModel()}subscribeToModel(){this.subscription=this.model.data$.subscribe((e=>{this.getRelatedData()}))}ngOnDestroy(){this.subscription?.unsubscribe()}getRelatedData(){this.relatedmodels.module=this.model.module,this.relatedmodels.id=this.model.id,this.relatedmodels.relatedModule=this.actionconfig.module,this.relatedmodels.linkName=this.actionconfig.checklink,this.relatedmodels.getData()}execute(){this.modal.openModal("EmailToObjectModal",!0).subscribe((e=>{e.instance.email_model=this.model,e.instance.object_module_name=this.object_module_name,e.instance.object_relation_link_name=this.actionconfig.relation_link_name,e.instance.object_predefined_fields=this.actionconfig.predefined_fields,e.instance.save$.subscribe((e=>{this.actionemitter.emit("save")}))}))}}return e=EmailToObjectButton,(0,i.Z)(EmailToObjectButton,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(_.o),m.Y36(h.Pu),m.Y36(J.o),m.Y36(F.j))})),(0,i.Z)(EmailToObjectButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-to-object-button"]],outputs:{actionemitter:"actionemitter"},features:[m._Bn([F.j])],decls:3,vars:2,consts:[["label","LBL_CONVERT_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0)(2,"system-label-modulename",1),m.qZA()),2&e&&(m.xp6(2),m.Q6J("module",t.object_module_name)("singular",!0))},dependencies:[L._,w.M],encapsulation:2})),EmailToObjectButton})();var Y=s(6550),N=s(323),q=s(9621),U=s(3499),O=s(5767),I=s(1916),Q=s(4664);function R(e,t){if(1&e&&(m.TgZ(0,"span",9),m._uU(1),m.qZA()),2&e){const e=m.oxw();m.xp6(1),m.hij('"',e.model.data.name,'"')}}function j(e,t){1&e&&(m.TgZ(0,"div",10)(1,"div",11),m._UZ(2,"system-spinner"),m.TgZ(3,"div",12),m._uU(4,"... "),m._UZ(5,"system-label",13),m._uU(6," ..."),m.qZA()()())}function D(e,t){if(1&e&&m._UZ(0,"object-record-fieldset",14),2&e){const e=m.oxw();m.Q6J("fieldset",e.fieldset)}}let P=(()=>{var e;class EmailPreviewModal{constructor(e,t,s,l,d,n,o){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"sanitizer",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"modelattachments",void 0),(0,i.Z)(this,"self",{}),(0,i.Z)(this,"type",""),(0,i.Z)(this,"name",""),(0,i.Z)(this,"file",void 0),(0,i.Z)(this,"fieldset",void 0),(0,i.Z)(this,"isLoading",!0),this.language=e,this.metadata=t,this.sanitizer=s,this.backend=l,this.model=d,this.view=n,this.modelattachments=o,this.model.module="Emails";let a=this.metadata.getComponentConfig("EmailPreviewModal",this.model.module);this.fieldset=a.fieldset}closeModal(){this.self.destroy()}ngOnInit(){this.backend.getRequest("module/Emails/msg/"+this.file.id).subscribe((e=>{this.model.setFields(this.model.utils.backendModel2spice("Emails",e)),this.isLoading=!1}))}download(){this.modelattachments.downloadAttachment(this.file.id,this.file.filename)}}return e=EmailPreviewModal,(0,i.Z)(EmailPreviewModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(Y.H7),m.Y36(x.y),m.Y36(_.o),m.Y36(v.e),m.Y36(N.H))})),(0,i.Z)(EmailPreviewModal,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},features:[m._Bn([_.o,v.e])],decls:10,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_EMAIL"],["class","slds-truncate",4,"ngIf"],["margin","none"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["direction","vertical",3,"fieldset",4,"ngIf"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","download","size","small"],[1,"slds-truncate"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-grid_vertical"],[1,"slds-p-around--small"],["label","LBL_LOADING"],["direction","vertical",3,"fieldset"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return t.closeModal()})),m._UZ(2,"system-label",2),m.YNc(3,R,2,1,"span",3),m.qZA(),m.TgZ(4,"system-modal-content",4),m.YNc(5,j,7,0,"div",5),m.YNc(6,D,1,1,"object-record-fieldset",6),m.qZA(),m.TgZ(7,"system-modal-footer")(8,"button",7),m.NdJ("click",(function(){return t.download()})),m._UZ(9,"system-button-icon",8),m.qZA()()()),2&e&&(m.xp6(3),m.Q6J("ngIf",!t.isLoading),m.xp6(2),m.Q6J("ngIf",t.isLoading),m.xp6(1),m.Q6J("ngIf",!t.isLoading),m.xp6(2),m.Q6J("disabled",t.isLoading))},dependencies:[l.O5,y.d,E.J,L._,q.j,U.x,O.p,I.y,Q.W],encapsulation:2})),EmailPreviewModal})();var H=s(2067);function z(e,t){1&e&&(m.TgZ(0,"div",5),m._UZ(1,"system-spinner"),m.qZA())}function G(e,t){if(1&e&&(m.TgZ(0,"div",6)(1,"div"),m._uU(2),m.qZA(),m._UZ(3,"div",7),m.qZA()),2&e){const e=m.oxw();m.xp6(2),m.hij("subject: ",e.subject,""),m.xp6(1),m.Q6J("innerHTML",e.body,m.oJD)}}let V=(()=>{var e;class EmailMSGPreviewModal{constructor(e,t,s){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"sanitizer",void 0),(0,i.Z)(this,"libloader",void 0),(0,i.Z)(this,"self",{}),(0,i.Z)(this,"type",""),(0,i.Z)(this,"name",""),(0,i.Z)(this,"libsloaded",!1),(0,i.Z)(this,"blobUrl",void 0),(0,i.Z)(this,"msgData",void 0),this.language=e,this.sanitizer=t,this.libloader=s}closeModal(){this.self.destroy()}set data(e){this.libloader.loadLib("msgreader").subscribe((e=>{}))}get subject(){return this.msgData?this.msgData.subject:""}get body(){return this.msgData?this.sanitizer.bypassSecurityTrustHtml(this.msgData.body.replace(/\n/g,"<br/>")):""}get objecttype(){if(!this.type)return"";let e=this.type.split("/");switch(e[0]){case"audio":case"video":return e[0];default:return"object"}}download(){let e=document.createElement("a");document.body.appendChild(e),e.href=this.blobUrl,e.download=this.name,e.click(),e.remove()}datatoBlob(e,t="",s=512){let i=[];for(let t=0;t<e.length;t+=s){let l=e.slice(t,t+s),d=new Array(l.length);for(let e=0;e<l.length;e++)d[e]=l.charCodeAt(e);let n=new Uint8Array(d);i.push(n)}return new Blob(i,{type:t})}}return e=EmailMSGPreviewModal,(0,i.Z)(EmailMSGPreviewModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(Y.H7),m.Y36(H.$))})),(0,i.Z)(EmailMSGPreviewModal,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},decls:6,vars:3,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["class","slds-p-around--small slds-text-align--center",4,"ngIf"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-p-around--small","slds-text-align--center"],[3,"innerHTML"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return t.closeModal()})),m._uU(2,"Email Preview"),m.qZA(),m.TgZ(3,"system-modal-content",2),m.YNc(4,z,2,0,"div",3),m.YNc(5,G,4,2,"div",4),m.qZA()()),2&e&&(m.xp6(3),m.Q6J("grow",!0),m.xp6(1),m.Q6J("ngIf",!t.msgData),m.xp6(1),m.Q6J("ngIf",t.msgData))},dependencies:[l.O5,q.j,U.x,I.y,Q.W],encapsulation:2})),EmailMSGPreviewModal})(),$=(()=>{var e;class EmailsPopoverBody{constructor(e,t,s){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"sanitized",void 0),(0,i.Z)(this,"_sanitizedValue",void 0),(0,i.Z)(this,"fullValue_cached",void 0),(0,i.Z)(this,"fullValue",""),this.model=e,this.language=t,this.sanitized=s}get emailbody(){return this.model.getFieldValue("body")}get sanitizedValue(){return this.emailbody&&(this.emailbody.includes("</html>")?this.fullValue=this.emailbody:this.fullValue=`<html><body class="spice">${this.emailbody}</body></html>`),this.fullValue!=this.fullValue_cached&&(this._sanitizedValue=this.sanitized.bypassSecurityTrustResourceUrl(this.fullValue?"data:text/html;charset=UTF-8,"+encodeURIComponent(this.fullValue):""),this.fullValue_cached=this.fullValue),this._sanitizedValue}}return e=EmailsPopoverBody,(0,i.Z)(EmailsPopoverBody,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(u.d),m.Y36(Y.H7))})),(0,i.Z)(EmailsPopoverBody,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],decls:1,vars:1,consts:[["width","100%","frameborder","0","seamless","true","sandbox","",2,"resize","vertical",3,"src"]],template:function(e,t){1&e&&m._UZ(0,"iframe",0),2&e&&m.Q6J("src",t.sanitizedValue,m.uOi)},encapsulation:2})),EmailsPopoverBody})();var K=s(7040),X=s(3348),W=s(6367),ee=s(3208),te=s(8859);function se(e,t){if(1&e&&m._UZ(0,"field-label",4),2&e){const e=m.oxw();m.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function ie(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"system-utility-icon",5)(2,"system-utility-icon",6)(3,"system-utility-icon",7),m.BQk()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("title",e.value)("icon",e.statusicon),m.xp6(1),m.Q6J("title",e.direction)}}function le(e,t){if(1&e&&m._UZ(0,"system-utility-icon",7)(1,"system-utility-icon",6)(2,"system-utility-icon",5),2&e){const e=m.oxw();m.xp6(1),m.Q6J("title",e.direction),m.xp6(1),m.Q6J("title",e.value)("icon",e.statusicon)}}let de=(()=>{var e;class fieldEmailStatus extends K.O{constructor(e,t,s,l,d){super(e,t,s,l,d),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"router",void 0),this.model=e,this.view=t,this.language=s,this.metadata=l,this.router=d}get statusicon(){switch(this.value){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get direction(){return this.model.getField("type")}get directionicon(){switch(this.model.getField("type")){case"inbound":return"back";case"out":return"forward";default:return""}}}return e=fieldEmailStatus,(0,i.Z)(fieldEmailStatus,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(v.e),m.Y36(u.d),m.Y36(h.Pu),m.Y36(X.F0))})),(0,i.Z)(fieldEmailStatus,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],features:[m.qOj],decls:5,vars:7,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[4,"ngIf","ngIfElse"],["inbound",""],[3,"fieldname","fieldconfig"],["size","x-small",3,"title","icon"],["size","xx-small","colorclass","slds-icon-text-light","icon","forward",1,"slds-p-horizontal--xx-small",3,"title"],["size","x-small","icon","user","colorclass","slds-icon-text-light"]],template:function(e,t){if(1&e&&(m.YNc(0,se,1,2,"field-label",0),m.TgZ(1,"field-generic-display",1),m.YNc(2,ie,4,3,"ng-container",2),m.YNc(3,le,3,3,"ng-template",null,3,m.W1O),m.qZA()),2&e){const e=m.MAs(4);m.Q6J("ngIf",t.displayLabel),m.xp6(1),m.Q6J("fielddisplayclass",t.fielddisplayclass)("editable",!1)("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),m.xp6(1),m.Q6J("ngIf","out"==t.direction)("ngIfElse",e)}},dependencies:[l.O5,W.q,ee.D,te.r],encapsulation:2})),fieldEmailStatus})(),ne=(()=>{var e;class EmailReplyButton{constructor(e,t,s,l){(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"actionconfig",void 0),this.injector=e,this.model=t,this.metadata=s,this.modal=l}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{null!=this.actionconfig.replymode&&(e.instance.mode=this.actionconfig.replymode)}))}}return e=EmailReplyButton,(0,i.Z)(EmailReplyButton,"ɵfac",(function(t){return new(t||e)(m.Y36(m.zs3),m.Y36(_.o),m.Y36(h.Pu),m.Y36(J.o))})),(0,i.Z)(EmailReplyButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-reply-button"]],decls:2,vars:1,consts:[[3,"label"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA()),2&e&&(m.xp6(1),m.Q6J("label",t.actionconfig.label))},dependencies:[L._],encapsulation:2})),EmailReplyButton})();var oe=s(2422),ae=s(5920),ce=s(788),re=s(8861),me=s(6951),ue=s(1604);let he=(()=>{var e;class EmailReplyModal{constructor(e,t,s,l,d,n,o,a,c,r){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"parent",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"prefs",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"session",void 0),(0,i.Z)(this,"userpreferences",void 0),(0,i.Z)(this,"dockedcomposer",void 0),(0,i.Z)(this,"self",null),(0,i.Z)(this,"sending",!1),(0,i.Z)(this,"titlelabel","LBL_EMAIL_REPLY"),(0,i.Z)(this,"mode","reply"),(0,i.Z)(this,"mailsent",new m.vpe),(0,i.Z)(this,"componentconfig",{}),this.language=e,this.metadata=t,this.model=s,this.parent=l,this.view=d,this.prefs=n,this.modal=o,this.session=a,this.userpreferences=c,this.dockedcomposer=r,this.model.module="Emails",this.view.isEditable=!0,this.view.setEditMode(),this.componentconfig=this.metadata.getComponentConfig("EmailReplyModal",this.model.module)}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1);let e=[];for(let t of this.parent.getField("recipient_addresses"))if("from"==t.address_type){let s={...t};s.address_type="to",s.id="",e.push(s)}else if("replyall"==this.mode&&("cc"==t.address_type||"to"==t.address_type)){let s={...t};s.address_type="cc",s.id="",e.push(s)}this.model.setFields({recipient_addresses:e,reference_id:this.parent.id,name:this.language.getLabel("LBL_RE")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()})}buildHistoryText(){let e=new moment.utc(this.parent.getField("date_sent")).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0)),t=e?e.format(this.userpreferences.getDateFormat()):"",s=e?e.format(this.userpreferences.getTimeFormat()):"",i="";i+="<br><br>",i+="<div data-spice-reply-quote='' class='spicecrm_reply_quote'>",i+="<div dir='ltr' class='crm_attr'>",i+="<b>"+this.language.getLabel("LBL_FROM")+":</b> <a href='mailto:"+this.parent.getField("from_addr")+"'>"+this.parent.getField("from_addr")+"</a>",i+="<br>",i+="<b>"+this.language.getLabel("LBL_DATE_SENT")+":</b> "+t+" "+s,i+="<br>",i+="<b>"+this.language.getLabel("LBL_TO")+":</b> "+this.parent.getField("to_addrs"),i+="<br>",i+="<b>"+this.language.getLabel("LBL_SUBJECT")+":</b> "+this.parent.getField("name"),i+="<br><br>",i+="</div>",i+='<blockquote class="crm_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">';const l=this.parent.getField("body").replace('data-signature=""',"").replace('data-spice-temp-quote=""',"");if(l.startsWith("<html>")){const e=document.createElement("html");e.innerHTML=l;const t=e.getElementsByTagName("body")[0];i+=t?t.innerHTML:l,e.remove()}else i+=l;return i+="</blockquote>",i+="</div>",i}get isDisabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}close(){this.self.destroy()}dock(){this.dockedcomposer.addComposer(this.model.module,this.model),this.close()}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"outbound",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe((t=>{e.instance.self.destroy(),this.mailsent.emit(!0),this.close()}),(t=>{e.instance.self.destroy(),this.sending=!1}))}))}handleaction(e){this.close()}}return e=EmailReplyModal,(0,i.Z)(EmailReplyModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o),m.Y36(_.o,4),m.Y36(v.e),m.Y36(oe.z),m.Y36(J.o),m.Y36(ae.n),m.Y36(oe.z),m.Y36(ce.m))})),(0,i.Z)(EmailReplyModal,"ɵcmp",m.Xpm({type:e,selectors:[["email-reply-modal"]],outputs:{mailsent:"mailsent"},features:[m._Bn([v.e,_.o])],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return t.close()})),m._UZ(2,"system-label",2),m.TgZ(3,"system-modal-header-right")(4,"button",3),m.NdJ("click",(function(){return t.dock()})),m._UZ(5,"system-button-icon",4),m.TgZ(6,"span",5),m._UZ(7,"system-label",6),m.qZA()()()(),m.TgZ(8,"system-modal-content"),m._UZ(9,"system-componentset",7),m.qZA(),m.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),m.NdJ("actionemitter",(function(e){return t.handleaction(e)})),m.qZA()()()()),2&e&&(m.xp6(2),m.Q6J("label",t.titlelabel),m.xp6(2),m.Q6J("title",t.language.getLabel("LBL_DOCK")),m.xp6(5),m.Q6J("componentset",t.componentconfig.componentset),m.xp6(3),m.Q6J("actionset",t.componentconfig.actionset))},dependencies:[re.S,E.J,me.E,L._,q.j,U.x,O.p,I.y,ue.O],encapsulation:2})),EmailReplyModal})(),pe=(()=>{var e;class EmailForwardButton{constructor(e,t,s,l){(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"actionconfig",void 0),this.injector=e,this.model=t,this.metadata=s,this.modal=l}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailForwardModal",!0,this.injector)}}return e=EmailForwardButton,(0,i.Z)(EmailForwardButton,"ɵfac",(function(t){return new(t||e)(m.Y36(m.zs3),m.Y36(_.o),m.Y36(h.Pu),m.Y36(J.o))})),(0,i.Z)(EmailForwardButton,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_FORWARD"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[L._],encapsulation:2})),EmailForwardButton})(),ge=(()=>{var e;class EmailForwardModal extends he{constructor(e,t,s,l,d,n,o,a,c,r,m,u){super(e,t,s,l,d,n,o,a,c,r),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"parent",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"prefs",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"session",void 0),(0,i.Z)(this,"userpreferences",void 0),(0,i.Z)(this,"dockedcomposer",void 0),(0,i.Z)(this,"modelattachments",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"titlelabel","LBL_EMAIL_FORWARD"),this.language=e,this.metadata=t,this.model=s,this.parent=l,this.view=d,this.prefs=n,this.modal=o,this.session=a,this.userpreferences=c,this.dockedcomposer=r,this.modelattachments=m,this.backend=u}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1),this.model.setFields({recipient_addresses:[],reference_id:this.parent.id,name:this.language.getLabel("LBL_FW")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()}),this.loadParentAttachments()}loadParentAttachments(){this.modelattachments.module="Emails",this.modelattachments.id=this.model.id,this.modelattachments.cloneAttachments(this.parent)}}return e=EmailForwardModal,(0,i.Z)(EmailForwardModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o),m.Y36(_.o,4),m.Y36(v.e),m.Y36(oe.z),m.Y36(J.o),m.Y36(ae.n),m.Y36(oe.z),m.Y36(ce.m),m.Y36(N.H),m.Y36(x.y))})),(0,i.Z)(EmailForwardModal,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],features:[m._Bn([v.e,_.o,N.H]),m.qOj],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return t.close()})),m._UZ(2,"system-label",2),m.TgZ(3,"system-modal-header-right")(4,"button",3),m.NdJ("click",(function(){return t.dock()})),m._UZ(5,"system-button-icon",4),m.TgZ(6,"span",5),m._UZ(7,"system-label",6),m.qZA()()()(),m.TgZ(8,"system-modal-content"),m._UZ(9,"system-componentset",7),m.qZA(),m.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),m.NdJ("actionemitter",(function(e){return t.handleaction(e)})),m.qZA()()()()),2&e&&(m.xp6(2),m.Q6J("label",t.titlelabel),m.xp6(2),m.Q6J("title",t.language.getLabel("LBL_DOCK")),m.xp6(5),m.Q6J("componentset",t.componentconfig.componentset),m.xp6(3),m.Q6J("actionset",t.componentconfig.actionset))},dependencies:[re.S,E.J,me.E,L._,q.j,U.x,O.p,I.y,ue.O],encapsulation:2})),EmailForwardModal})();var fe=s(3278);let be=(()=>{var e;class EmailSendButton{constructor(e,t,s,l,d){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"actionconfig",void 0),(0,i.Z)(this,"actionemitter",new m.vpe),(0,i.Z)(this,"sending",!1),this.model=e,this.metadata=t,this.modal=s,this.toast=l,this.language=d}get disabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}execute(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:!0,from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe({next:()=>{e.instance.self.destroy(),this.actionemitter.emit("emailsent")},error:t=>{e.instance.self.destroy(),this.toast.sendToast(this.language.getLabel("LBL_ERROR_SENDING_EMAIL"),"error",t.error.error.lbl?this.language.getLabel(t.error.error.lbl):t.error.error.message),this.sending=!1}})}))}}return e=EmailSendButton,(0,i.Z)(EmailSendButton,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(h.Pu),m.Y36(J.o),m.Y36(fe.A),m.Y36(u.d))})),(0,i.Z)(EmailSendButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-send-button"]],outputs:{actionemitter:"actionemitter"},decls:2,vars:0,consts:[["label","LBL_SEND"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[L._],encapsulation:2})),EmailSendButton})();var Ze=s(2644);let _e=(()=>{var e;class EmailSchedulesButton{constructor(e,t,s,l,d,n,o){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modellist",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"hidden",!0),(0,i.Z)(this,"maxCount",50),this.language=e,this.metadata=t,this.model=s,this.modellist=l,this.modal=d,this.injector=n,this.toast=o}ngOnInit(){this.findEmailsLink()}get disabled(){return 0==this.modellist.getSelectedCount()||this.modellist.getSelectedCount()>this.maxCount}get exportcount(){let e=this.modellist.getSelectedCount();return e||this.modellist.listData.totalcount}findEmailsLink(){if(!this.metadata.checkModuleAcl("EmailSchedules","create"))return;let e=this.metadata.getModuleFields(this.model.module);for(let t in e){let s=e[t];("emails"==t||"link"==s.type&&"Emails"==s.module)&&(this.hidden=!1)}}execute(){this.model.fields.hasOwnProperty("emails")?this.modal.openModal("EmailSchedulesModal",!0,this.injector):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}}return e=EmailSchedulesButton,(0,i.Z)(EmailSchedulesButton,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o),m.Y36(Ze.t),m.Y36(J.o),m.Y36(m.zs3),m.Y36(fe.A))})),(0,i.Z)(EmailSchedulesButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-button"]],decls:4,vars:1,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.TgZ(2,"span"),m._uU(3),m.qZA()()),2&e&&(m.xp6(3),m.hij(" (",t.exportcount,")"))},dependencies:[L._],encapsulation:2})),EmailSchedulesButton})(),ve=(()=>{var e;class EmailSchedulesCancelButton{constructor(e,t,s){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"actionemitter",new m.vpe),this.model=e,this.modal=t,this.backend=s}get disabled(){return!this.model.checkAccess("edit")||"open"!=this.model.getField("email_schedule_status")}execute(){this.modal.confirm("MSG_CANCEL_EMAILSCHEDULE","MSG_CANCEL_EMAILSCHEDULE").subscribe((e=>{e&&this.backend.putRequest(`module/EmailSchedules/${this.model.id}/cancel`).subscribe((e=>{this.model.setField("email_schedule_status","cancelled"),this.actionemitter.emit("save")}))}))}}return e=EmailSchedulesCancelButton,(0,i.Z)(EmailSchedulesCancelButton,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(J.o),m.Y36(x.y))})),(0,i.Z)(EmailSchedulesCancelButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-cancel-button"]],outputs:{actionemitter:"actionemitter"},decls:1,vars:0,consts:[["label","LBL_CANCEL"]],template:function(e,t){1&e&&m._UZ(0,"system-label",0)},dependencies:[L._],encapsulation:2})),EmailSchedulesCancelButton})();var xe=s(2995);let ye=(()=>{var e;class EmailSchedulesModal{constructor(e,t,s,l,d,n,o,a,c,r){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"parentModel",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"modellist",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"self",{}),this.language=e,this.model=t,this.parentModel=s,this.injector=l,this.view=d,this.modal=n,this.metadata=o,this.modellist=a,this.backend=c,this.toast=r,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1)}close(){this.self.destroy()}get canSave(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}saveSchedule(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t=this.modellist.getSelectedIDs(),s={module:this.modellist.module,ids:t,data:this.model.data,modulefilter:this.modellist.modulefilter,searchterm:this.modellist.searchTerm,aggregates:this.modellist.selectedAggregates};this.backend.postRequest(`module/EmailSchedules/${this.model.id}`,{},s).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}}return e=EmailSchedulesModal,(0,i.Z)(EmailSchedulesModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(_.o),m.Y36(_.o,4),m.Y36(m.zs3),m.Y36(v.e),m.Y36(J.o),m.Y36(h.Pu),m.Y36(Ze.t),m.Y36(x.y),m.Y36(fe.A))})),(0,i.Z)(EmailSchedulesModal,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-modal"]],features:[m._Bn([_.o,v.e])],decls:11,vars:3,consts:[["title","LBL_EMAIL_SCHEDULES"],[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","none",3,"grow"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal",0)(1,"system-modal-header",1),m.NdJ("close",(function(){return t.close()})),m._UZ(2,"system-label",2),m.qZA(),m.TgZ(3,"system-modal-content",3),m._UZ(4,"system-dynamic-component",4)(5,"system-dynamic-component",5),m.qZA(),m.TgZ(6,"system-modal-footer")(7,"button",6),m.NdJ("click",(function(){return t.sendTestEmail()})),m._UZ(8,"system-label",7),m.qZA(),m.TgZ(9,"button",8),m.NdJ("click",(function(){return t.saveSchedule()})),m._UZ(10,"system-label",2),m.qZA()()()),2&e&&(m.xp6(3),m.Q6J("grow",!0),m.xp6(4),m.Q6J("disabled",!t.canSave),m.xp6(2),m.Q6J("disabled",!t.canSave))},dependencies:[xe.T,L._,q.j,U.x,O.p,I.y],encapsulation:2})),EmailSchedulesModal})();var Ee=s(7579);let Le=(()=>{var e;class EmailSchedulesRelatedButton{constructor(e,t,s,l,d,n,o){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"linkedBeans",[]),(0,i.Z)(this,"modelId",void 0),(0,i.Z)(this,"currentModule",void 0),this.language=e,this.metadata=t,this.model=s,this.modal=l,this.injector=d,this.backend=n,this.toast=o}execute(){let e=this.modal.await(this.language.getLabel("LBL_LOADING"));this.checkEmailsLink().subscribe((t=>{e.emit(!0),t&&this.modal.openModal("EmailSchedulesRelatedModal",!0,this.injector).subscribe((e=>{e.instance.linkedBeans=this.linkedBeans,e.instance.modelId=this.modelId,e.instance.currentModule=this.model.module}))}))}checkEmailsLink(){let e=new Ee.x,t=[];Object.keys(this.model.fields).forEach((e=>{if("link"==this.model.fields[e].type){let s=this.model.fields[e].name;for(let e in this.metadata.fieldDefs)e.toLowerCase()==s&&t.push(e)}}));let s=[];for(let e in t){let i=t[e];Object.keys(this.metadata.fieldDefs).forEach((e=>{null!=this.metadata.fieldDefs[e]&&e==i&&(this.metadata.fieldDefs[e].hasOwnProperty("email")||this.metadata.fieldDefs[e].hasOwnProperty("email1"))&&s.push(i)}))}let i={modules:s};return this.backend.getRequest(`module/EmailSchedules/${this.model.module}/${this.model.id}`,i).subscribe((t=>{t.status?(this.linkedBeans=t.linkedBeans,this.modelId=t.beanId,e.next(t.status)):(e.next(!1),this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error"));for(let e in this.linkedBeans){let t=this.linkedBeans[e];t.vname=this.model.fields[t.link].vname}e.complete()})),e.asObservable()}}return e=EmailSchedulesRelatedButton,(0,i.Z)(EmailSchedulesRelatedButton,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o),m.Y36(J.o),m.Y36(m.zs3),m.Y36(x.y),m.Y36(fe.A))})),(0,i.Z)(EmailSchedulesRelatedButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-related-button"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[L._],encapsulation:2})),EmailSchedulesRelatedButton})();var we=s(7514),Te=s(4561),Me=s(151);function ke(e,t){1&e&&(m.TgZ(0,"div",41),m._uU(1,"("),m._UZ(2,"system-label",42),m._uU(3,")"),m.qZA())}function Ae(e,t){if(1&e&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&e){const e=m.oxw().$implicit;m.xp6(1),m.hij("(",e.email1,")")}}const Be=function(e){return{"slds-text-color--inverse-weak":e}},Ce=function(e){return{"text-decoration":e}};function Fe(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"tr"),m._UZ(1,"td"),m.TgZ(2,"td",43)(3,"div",44)(4,"div"),m._uU(5),m.qZA(),m.YNc(6,Ae,2,1,"div",23),m.qZA()(),m.TgZ(7,"td",33),m._UZ(8,"system-utility-icon",45),m.qZA(),m.TgZ(9,"td",34)(10,"button",46)(11,"system-button-icon",47),m.NdJ("click",(function(){const t=m.CHM(e).index,s=m.oxw(2).$implicit,i=m.oxw();return m.KtG(i.removeBean(s,t))})),m.qZA()()()()}if(2&e){const e=t.$implicit;m.xp6(2),m.Q6J("ngClass",m.VKq(6,Be,e.deleted))("ngStyle",m.VKq(8,Ce,e.deleted?"line-through":"inherit")),m.xp6(3),m.Oqu(e.summary_text),m.xp6(1),m.Q6J("ngIf",e.email1),m.xp6(2),m.Q6J("icon","link"==e.source?"linked":"user"),m.xp6(3),m.Q6J("icon",!0===e.deleted?"undo":"delete")}}function Je(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Fe,12,10,"tr",21),m.BQk()),2&e){const e=m.oxw().$implicit;m.xp6(1),m.Q6J("ngForOf",e.linkedbeans)}}const Se=function(e){return{"slds-disabled-text":e}};function Ye(e,t){if(1&e){const e=m.EpF();m.ynx(0),m.TgZ(1,"tr",27)(2,"td")(3,"system-checkbox",28),m.NdJ("ngModelChange",(function(t){const s=m.CHM(e).$implicit;return m.KtG(s.selected=t)})),m.qZA()(),m.TgZ(4,"td")(5,"div",29)(6,"div",16),m._UZ(7,"system-icon",30),m.qZA(),m.TgZ(8,"div",16),m._UZ(9,"system-label-modulename",31),m.qZA(),m.YNc(10,ke,4,0,"div",32),m.qZA()(),m.TgZ(11,"td",33)(12,"div",29)(13,"div",16),m._uU(14),m.qZA()()(),m.TgZ(15,"td",34)(16,"button",35),m.NdJ("click",(function(){const t=m.CHM(e).$implicit,s=m.oxw();return m.KtG(s.expandRelated(t))})),m._UZ(17,"system-button-icon",36),m.qZA(),m.TgZ(18,"button",37),m.NdJ("click",(function(){const t=m.CHM(e).$implicit;return m.KtG(t.open=!t.open)})),m._UZ(19,"system-button-icon",38),m.qZA(),m.TgZ(20,"button",39)(21,"system-button-icon",40),m.NdJ("click",(function(){const t=m.CHM(e).$implicit,s=m.oxw();return m.KtG(s.addBean(t))})),m.qZA()()()(),m.YNc(22,Je,2,1,"ng-container",23),m.BQk()}if(2&e){const e=t.$implicit,s=m.oxw();m.xp6(1),m.Q6J("ngClass",m.VKq(15,Se,e.disabled&&(!e.linkedbeans||0==e.linkedbeans.length))),m.xp6(2),m.Q6J("disabled",e.disabled||e.expanded)("ngModel",e.selected),m.xp6(4),m.Q6J("addclasses",!e.disabled||e.linkedbeans&&0!=e.linkedbeans.length?null:"slds-icon_disabled")("size","small")("module",e.module),m.xp6(2),m.Q6J("module",e.module),m.xp6(1),m.Q6J("ngIf",e.count>s.maxCount),m.xp6(4),m.AsE("",s.getLinkCount(e)," / ",e.count,""),m.xp6(2),m.Q6J("disabled",e.expanded||0==e.count||e.count>s.maxCount),m.xp6(2),m.Q6J("disabled",!e.linkedbeans),m.xp6(1),m.Q6J("icon",!0===e.open?"up":"down"),m.xp6(1),m.Q6J("disabled",e.count>s.maxCount),m.xp6(2),m.Q6J("ngIf",!0===e.open)}}function Ne(e,t){1&e&&(m.TgZ(0,"div"),m._UZ(1,"system-label",42),m.qZA())}const qe=function(e){return{"slds-is-active":e}},Ue=function(e){return{"slds-hide":e}};let Oe=(()=>{var e;class EmailSchedulesRelatedModal{constructor(e,t,s,l,d,n,o,a,c){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"parentModel",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"self",{}),(0,i.Z)(this,"activetab","recipients"),(0,i.Z)(this,"linkedBeans",[]),(0,i.Z)(this,"modelId",void 0),(0,i.Z)(this,"currentModule",void 0),(0,i.Z)(this,"maxCount",50),this.language=e,this.model=t,this.parentModel=s,this.injector=l,this.view=d,this.modal=n,this.metadata=o,this.backend=a,this.toast=c,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1),this.fiilterProspects()}fiilterProspects(){this.linkedBeans=this.linkedBeans.map((e=>(e.disabled=0==e.count||e.count>this.maxCount,e.selected=!1,e.expanded=!1,e)))}close(){this.self.destroy()}get canSchedule(){if(!this.model.getField("mailbox_id")||!this.model.getField("email_subject"))return!1;let e=this.selectedCount;return!(0==e||e>this.maxCount)}get selectedCount(){let e=0;return this.linkedBeans.forEach((t=>{t.selected?e+=t.count:t.linkedbeans&&(e+=t.linkedbeans.filter((e=>!e.deleted)).length)})),e}saveSchedule(){this.canSchedule&&this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={links:this.linkedBeans.filter((e=>e.selected)).map((e=>e.module)),data:this.model.data,linkedbeans:this.linkedbeans};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/${this.parentModel.module}/${this.parentModel.id}`,{},t).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}get linkedbeans(){let e={};for(let t of this.linkedBeans){if(!t.linkedbeans)continue;let s=t.linkedbeans.filter((e=>!e.deleted)).map((e=>e.id));s.length>0&&(e[t.module]=s)}return e}getLinkCount(e){if(e.expanded)return e.linkedbeans?e.linkedbeans.filter((e=>!e.deleted)).length:0;let t=e.selected?parseInt(e.count,10):0;return e.linkedbeans&&(t+=e.linkedbeans.length),t}expandRelated(e){if(e.expanded)e.open=!e.open;else{let t=this.modal.await("LBL_LOADING");e.selected=!1,e.expanded=!0,this.backend.getRequest(`module/${this.parentModel.module}/${this.parentModel.id}/related/${e.link}`,{getcount:0,excludeinactive:1,offset:0,limit:100}).subscribe((s=>{e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let t in s)s[t].source="link",s[t].deleted=!1,e.linkedbeans.push(s[t]);this.sortLinkedBeans(e),t.emit(!0)}),(()=>{this.toast.sendToast("LBL_ERROR","error"),t.emit(!0)}))}}addBean(e){this.modal.openModal("ObjectModalModuleLookup").subscribe((t=>{t.instance.module=e.module,t.instance.multiselect=!0,t.instance.selectedItems.subscribe((t=>{if(t.length){e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let s of t)-1==e.linkedbeans.findIndex((e=>e.id==s.id))&&(s.source="user",e.linkedbeans.push(s));this.sortLinkedBeans(e)}}))}))}sortLinkedBeans(e){e.linkedbeans.sort(((e,t)=>e.last_name?e.last_name.localeCompare(t.last_name):e.summary_text.localeCompare(t.summary_text)))}removeBean(e,t){"link"==e.linkedbeans[t].source?e.linkedbeans[t].deleted=!e.linkedbeans[t].deleted:e.linkedbeans.splice(t,1)}get canSendTest(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}}return e=EmailSchedulesRelatedModal,(0,i.Z)(EmailSchedulesRelatedModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(_.o),m.Y36(_.o,4),m.Y36(m.zs3),m.Y36(v.e),m.Y36(J.o),m.Y36(h.Pu),m.Y36(x.y),m.Y36(fe.A))})),(0,i.Z)(EmailSchedulesRelatedModal,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-related-modal"]],features:[m._Bn([_.o,v.e])],decls:36,vars:18,consts:[[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","x-small"],[1,"slds-tabs_scoped"],["role","tablist",1,"slds-tabs_scoped__nav"],["title","Emails","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link",3,"click"],["title","Recipients","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small",2,"height","70vh",3,"ngClass"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small","slds-scrollable--y",2,"height","70vh",3,"ngClass"],[1,"slds-table","slds-box--border"],[1,"slds-text-title_caps"],["scope","col",2,"width","2rem"],["scope","col",1,"slds-resizable"],[1,"slds-truncate"],["label","LBL_LINK"],["scope","col",1,"slds-text-align--center",2,"width","5rem"],["label","LBL_COUNT"],["scope","col",2,"width","4rem"],[4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical-align-center"],[4,"ngIf"],[1,"slds-button","slds-col--bump-left","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],[3,"ngClass"],[3,"disabled","ngModel","ngModelChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small"],[3,"addclasses","size","module"],[3,"module"],["class","slds-truncate slds-p-horizontal--x-small",4,"ngIf"],[1,"slds-text-align--center"],[1,"slds-text-align--right"],["system-title","LBL_EXPAND",1,"slds-button","slds-button--icon",3,"disabled","click"],["icon","expand_all"],["system-title","LBL_TOGGLE",1,"slds-button","slds-button--icon",3,"disabled","click"],[3,"icon"],["system-title","LBL_ADD",1,"slds-button","slds-button--icon",3,"disabled"],["icon","new",3,"click"],[1,"slds-truncate","slds-p-horizontal--x-small"],["label","LBL_MAX50RECORDS"],[3,"ngClass","ngStyle"],[1,"slds-grid","slds-grid--align-spread"],["size","xx-small",3,"icon"],["system-title","LBL_DELETE",1,"slds-button","slds-button--icon"],[3,"icon","click"]],template:function(e,t){1&e&&(m.TgZ(0,"system-modal")(1,"system-modal-header",0),m.NdJ("close",(function(){return t.close()})),m._UZ(2,"system-label",1),m.qZA(),m.TgZ(3,"system-modal-content",2)(4,"div",3)(5,"ul",4)(6,"li",5)(7,"a",6),m.NdJ("click",(function(){return t.activetab="emails"})),m._uU(8),m.qZA()(),m.TgZ(9,"li",7)(10,"a",6),m.NdJ("click",(function(){return t.activetab="recipients"})),m._uU(11),m.qZA()()(),m.TgZ(12,"div",8),m._UZ(13,"system-dynamic-component",9)(14,"system-dynamic-component",10),m.qZA(),m.TgZ(15,"div",11)(16,"table",12)(17,"thead")(18,"tr",13),m._UZ(19,"th",14),m.TgZ(20,"th",15)(21,"div",16),m._UZ(22,"system-label",17),m.qZA()(),m.TgZ(23,"th",18)(24,"div",16),m._UZ(25,"system-label",19),m.qZA()(),m._UZ(26,"th",20),m.qZA()(),m.TgZ(27,"tbody"),m.YNc(28,Ye,23,17,"ng-container",21),m.qZA()()()()(),m.TgZ(29,"system-modal-footer")(30,"div",22),m.YNc(31,Ne,2,0,"div",23),m.TgZ(32,"button",24),m.NdJ("click",(function(){return t.sendTestEmail()})),m._UZ(33,"system-label",25),m.qZA(),m.TgZ(34,"button",26),m.NdJ("click",(function(){return t.saveSchedule()})),m._UZ(35,"system-label",1),m.qZA()()()()),2&e&&(m.xp6(6),m.Q6J("ngClass",m.VKq(10,qe,"emails"==t.activetab)),m.xp6(2),m.Oqu(t.language.getLabel("LBL_EMAILS")),m.xp6(1),m.Q6J("ngClass",m.VKq(12,qe,"recipients"==t.activetab)),m.xp6(2),m.Oqu(t.language.getLabel("LBL_RECIPIENTS")),m.xp6(1),m.Q6J("ngClass",m.VKq(14,Ue,"emails"!=t.activetab)),m.xp6(3),m.Q6J("ngClass",m.VKq(16,Ue,"recipients"!=t.activetab)),m.xp6(13),m.Q6J("ngForOf",t.linkedBeans),m.xp6(3),m.Q6J("ngIf",t.selectedCount>t.maxCount),m.xp6(1),m.Q6J("disabled",!t.canSendTest),m.xp6(2),m.Q6J("disabled",!t.canSchedule))},dependencies:[l.mk,l.sg,l.O5,l.PC,d.JJ,d.On,E.J,we.U,xe.T,Te.f,L._,w.M,q.j,U.x,O.p,I.y,te.r,Me.S],encapsulation:2})),EmailSchedulesRelatedModal})();var Ie=s(4567),Qe=s(4730),Re=s(4021);function je(e,t){if(1&e&&(m.TgZ(0,"tr",14)(1,"td")(2,"div",10),m._uU(3),m.qZA()(),m.TgZ(4,"td")(5,"div",10),m._uU(6),m.qZA()(),m.TgZ(7,"td")(8,"div",10),m._uU(9),m.qZA()()()),2&e){const e=t.$implicit;m.xp6(3),m.Oqu(e.id),m.xp6(3),m.Oqu(e.subject),m.xp6(3),m.Oqu(e.status)}}function De(e,t){if(1&e&&(m.TgZ(0,"table",8)(1,"thead")(2,"tr",9)(3,"th")(4,"div",10),m._uU(5,"Id"),m.qZA()(),m.TgZ(6,"th")(7,"div",10),m._UZ(8,"system-label",11),m.qZA()(),m.TgZ(9,"th")(10,"div",10),m._UZ(11,"system-label",12),m.qZA()()()(),m.TgZ(12,"tbody"),m.YNc(13,je,10,3,"tr",13),m.qZA()()),2&e){const e=m.oxw();m.xp6(13),m.Q6J("ngForOf",e.emailschedules)}}function Pe(e,t){1&e&&(m.TgZ(0,"div",15)(1,"system-illustration-no-records"),m._UZ(2,"system-label",16),m.qZA()())}function He(e,t){1&e&&(m.TgZ(0,"div",15)(1,"system-illustration-no-access"),m._UZ(2,"system-label",17),m.qZA()())}let ze=(()=>{var e;class EmailSchedulesView{constructor(e,t,s,l,d){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"emailschedules",[]),(0,i.Z)(this,"locked",!1),(0,i.Z)(this,"isLoading",!1),this.language=e,this.model=t,this.view=s,this.metadata=l,this.backend=d,this.getData()}refresh(){this.getData()}getData(){this.isLoading=!0,this.backend.getRequest(`module/EmailSchedules/myopen/${this.model.id}`).subscribe((e=>{e.status?(this.isLoading=!1,this.emailschedules=e.openschedules):this.locked=!0}))}}return e=EmailSchedulesView,(0,i.Z)(EmailSchedulesView,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(_.o),m.Y36(v.e),m.Y36(h.Pu),m.Y36(x.y))})),(0,i.Z)(EmailSchedulesView,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-view"]],features:[m._Bn([v.e])],decls:10,vars:8,consts:[[3,"system-overlay-loading-spinner"],[1,"slds-grid","slds-p-around--small",2,"align-items","center"],[1,"slds-col","slds-grow-none",3,"module","title"],[1,"slds-grow"],[1,"slds-col--bump-left","slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","refresh"],["width","100%","class","slds-table slds-table_cell-buffer slds-table_bordered",4,"ngIf"],["class","slds-align--absolute-center slds-m-around--large",4,"ngIf"],["width","100%",1,"slds-table","slds-table_cell-buffer","slds-table_bordered"],[1,"slds-line-height_reset"],[1,"slds-truncate"],["label","LBL_SUBJECT"],["label","LBL_STATUS"],["class","slds-hint-parent",4,"ngFor","ngForOf"],[1,"slds-hint-parent"],[1,"slds-align--absolute-center","slds-m-around--large"],["label","MSG_NO_RECORDS_FOUND"],["label","LBL_NO_ACCESS"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1),m._UZ(2,"system-icon",2),m.TgZ(3,"h2",3),m._uU(4),m.qZA(),m.TgZ(5,"button",4),m.NdJ("click",(function(){return t.getData()})),m._UZ(6,"system-button-icon",5),m.qZA()(),m.YNc(7,De,14,1,"table",6),m.YNc(8,Pe,3,0,"div",7),m.YNc(9,He,3,0,"div",7),m.qZA()),2&e&&(m.Q6J("system-overlay-loading-spinner",t.isLoading),m.xp6(2),m.Q6J("module","EmailSchedules")("title","EmailSchedules"),m.xp6(2),m.Oqu(t.language.getModuleName("EmailSchedules")),m.xp6(1),m.Q6J("disabled",t.isLoading),m.xp6(2),m.Q6J("ngIf",t.emailschedules.length>0),m.xp6(1),m.Q6J("ngIf",0==t.emailschedules.length&&!t.isLoading),m.xp6(1),m.Q6J("ngIf",!t.isLoading&&t.locked))},dependencies:[l.sg,l.O5,E.J,Te.f,Ie.s,Qe.C,L._,Re._],encapsulation:2})),EmailSchedulesView})();var Ge=s(727),Ve=s(2161),$e=s(1790);const Ke=function(e,t){return{module:e,data:t}};function Xe(e,t){if(1&e&&(m.TgZ(0,"tr",9)(1,"td")(2,"div",10),m._UZ(3,"system-icon",11),m.TgZ(4,"div",3),m._uU(5),m.qZA()()(),m.TgZ(6,"td")(7,"div",3),m._uU(8),m.qZA()()()),2&e){const e=t.$implicit,s=m.oxw();m.Q6J("system-model-provider",m.WLB(4,Ke,e.module,e.data)),m.xp6(3),m.Q6J("module",e.module),m.xp6(2),m.Oqu(e.summary_text),m.xp6(3),m.hij(" ",s.getValue(e.status),"")}}function We(e,t){1&e&&m._UZ(0,"tbody",12),2&e&&m.Q6J("rows",10)}let et=(()=>{var e;class EmailSchedulesBeans{constructor(e,t,s,l){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"beans",void 0),(0,i.Z)(this,"loading",!1),(0,i.Z)(this,"loadedStatus",void 0),(0,i.Z)(this,"subscriptions",new Ge.w0),this.model=e,this.metadata=t,this.language=s,this.backend=l,this.subscriptions.add(this.model.data$.subscribe((e=>{this.getData()})))}ngOnDestroy(){this.subscriptions.unsubscribe()}getValue(e){try{return this.language.languagedata.applist.emailschedule_status_dom[e]?this.language.languagedata.applist.emailschedule_status_dom[e]:e}catch(t){return e}}getData(){!this.model.getField("email_schedule_status")||this.loadedStatus&&this.loadedStatus==this.model.getField("email_schedule_status")||(this.beans=[],this.loading=!0,this.loadedStatus=this.model.getField("email_schedule_status"),this.backend.getRequest(`module/EmailSchedules/${this.model.id}/beans`).subscribe((e=>{this.beans=e,this.loading=!1})))}}return e=EmailSchedulesBeans,(0,i.Z)(EmailSchedulesBeans,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(h.Pu),m.Y36(u.d),m.Y36(x.y))})),(0,i.Z)(EmailSchedulesBeans,"ɵcmp",m.Xpm({type:e,selectors:[["email-schedules-beans"]],decls:12,vars:2,consts:[[1,"slds-table","slds-table--fixed-layout","slds-table_bordered","slds-box--border"],[1,"slds-line-height_reset"],["scope","col",2,"width","99%"],[1,"slds-truncate"],["label","LBL_NAME"],["scope","col",2,"width","5rem"],["label","LBL_STATUS"],["class","slds-hint-parent",3,"system-model-provider",4,"ngFor","ngForOf"],["system-table-stencils","","columns","2",3,"rows",4,"ngIf"],[1,"slds-hint-parent",3,"system-model-provider"],["system-model-popover","",1,"slds-grid","slds-grid--vertical-align-center"],["size","x-small",3,"module"],["system-table-stencils","","columns","2",3,"rows"]],template:function(e,t){1&e&&(m.TgZ(0,"table",0)(1,"thead")(2,"tr",1)(3,"th",2)(4,"div",3),m._UZ(5,"system-label",4),m.qZA()(),m.TgZ(6,"th",5)(7,"div",3),m._UZ(8,"system-label",6),m.qZA()()()(),m.TgZ(9,"tbody"),m.YNc(10,Xe,9,7,"tr",7),m.qZA(),m.YNc(11,We,1,1,"tbody",8),m.qZA()),2&e&&(m.xp6(10),m.Q6J("ngForOf",t.beans),m.xp6(1),m.Q6J("ngIf",t.loading))},dependencies:[l.sg,l.O5,Te.f,L._,Ve.x,$e.g,T.u],encapsulation:2})),EmailSchedulesBeans})();function tt(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",1),m.qZA())}let st=(()=>{var e;class EmailActionSetReadButton{constructor(e,t,s){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"displayasicon",!1),this.language=e,this.metadata=t,this.model=s}get hidden(){return!("unread"==this.model.getFieldValue("status")||!this.model.isEditing)}get disabled(){return!this.model.checkAccess("edit")||(this.model.isEditing||this.model.isSaving)}execute(){this.model.setField("status","read")}}return e=EmailActionSetReadButton,(0,i.Z)(EmailActionSetReadButton,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o))})),(0,i.Z)(EmailActionSetReadButton,"ɵcmp",m.Xpm({type:e,selectors:[["email-action-set-read-button"]],decls:1,vars:1,consts:[[4,"ngIf"],["label","LBL_SET_READ"]],template:function(e,t){1&e&&m.YNc(0,tt,2,0,"span",0),2&e&&m.Q6J("ngIf",!t.displayasicon)},dependencies:[l.O5,L._],encapsulation:2})),EmailActionSetReadButton})();var it=s(3634),lt=s(5861),dt=s(2646),nt=s(6271);function ot(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",4)(1,"div",19)(2,"span",20)(3,"span",21),m._UZ(4,"system-icon",22),m.qZA(),m.TgZ(5,"span",23),m._uU(6),m.qZA(),m.TgZ(7,"button",24),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.clearSelectedItem())})),m._UZ(8,"system-button-icon",25),m.qZA()()()()}if(2&e){const e=m.oxw();m.xp6(4),m.Q6J("module",e.previewForBean),m.xp6(2),m.hij(" ",e.selectedItem.text," "),m.xp6(2),m.Q6J("icon","close")}}function at(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",26),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.searchWithModal())})),m._UZ(1,"input",27),m.TgZ(2,"button",28),m._UZ(3,"system-button-icon",29),m.qZA()()}if(2&e){const e=m.oxw();m.xp6(1),m.Q6J("disabled",!e.previewForBean)("placeholder",e.placeholder),m.xp6(1),m.Q6J("disabled",!e.previewForBean)}}function ct(e,t){if(1&e&&(m.TgZ(0,"div",30)(1,"div",31),m._UZ(2,"div",32),m.TgZ(3,"span",33),m._uU(4),m.qZA()(),m._UZ(5,"iframe",34),m.qZA()),2&e){const e=m.oxw();m.Udp("width",e.viewType.width,"px"),m.xp6(4),m.hij(" ",e.viewType.width,"px "),m.xp6(1),m.Q6J("src",e.parsedHtml,m.uOi)}}function rt(e,t){1&e&&(m.TgZ(0,"div",35)(1,"system-illustration-no-data"),m._UZ(2,"system-label",36),m.qZA()())}let mt=(()=>{var e;class EmailTemplatesPreview{constructor(e,t,s,l,d,n,o,a){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"sanitizer",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"viewTypeOptions",[{title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},{title:"LBL_TABLET",icon:"tablet_portrait",value:"tablet",width:768},{title:"LBL_MOBILE",icon:"phone_portrait",value:"mobile",width:320}]),(0,i.Z)(this,"viewType",{title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024}),(0,i.Z)(this,"subscription",new Ge.w0),(0,i.Z)(this,"selectedItem",void 0),(0,i.Z)(this,"placeholder",void 0),(0,i.Z)(this,"parsedHtml",void 0),(0,i.Z)(this,"bodyHtmlField","body_html"),(0,i.Z)(this,"previewForBean",void 0),this.language=e,this.backend=t,this.metadata=s,this.model=l,this.modal=d,this.toast=n,this.sanitizer=o,this.cdRef=a}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnDestroy(){this.subscription.unsubscribe()}subscribeToModelChanges(){this.subscription.add(this.model.data$.subscribe((()=>{this.setPlaceholder(),this.selectedItem&&this.selectedItem.module==this.previewForBean||this.clearSelectedItem()})))}setPlaceholder(){this.placeholder=this.previewForBean?this.language.getModuleCombinedLabel("LBL_SEARCH",this.previewForBean):this.language.getLabel("LBL_SEARCH"),this.cdRef.detectChanges()}searchWithModal(){this.previewForBean&&this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.previewForBean,e.instance.multiselect=!1,this.subscription.add(e.instance.selectedItems.subscribe((e=>{e&&e.length&&(this.selectedItem={id:e[0].id,text:e[0].summary_text,module:this.previewForBean},this.compileBody())})))}))}clearSelectedItem(){this.selectedItem=void 0,this.parsedHtml=void 0,this.cdRef.detectChanges()}compileBody(){var e=this;return(0,lt.Z)((function*(){if(!e.model.id)return;const t=e.modal.await("LBL_PARSING_HTML"),s={html:e.model.getField(e.bodyHtmlField),field:e.bodyHtmlField};e.backend.postRequest(`module/${e.model.module}/${e.model.id}/livecompile/${e.previewForBean}/${e.selectedItem.id}`,{},s).subscribe({next:s=>{if(!s||!s.html)return t.emit(!1),t.unsubscribe();e.parsedHtml=e.sanitizer.bypassSecurityTrustResourceUrl("data:text/html;charset=UTF-8,"+encodeURIComponent(s.html)),e.cdRef.detectChanges(),t.emit(!0),t.unsubscribe()},error:()=>{e.toast.sendToast(e.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),t.emit(!1),t.unsubscribe()}})}))()}setViewType(e){this.viewType=this.viewTypeOptions.find((t=>t.value==e))}}return e=EmailTemplatesPreview,(0,i.Z)(EmailTemplatesPreview,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(x.y),m.Y36(h.Pu),m.Y36(_.o),m.Y36(J.o),m.Y36(fe.A),m.Y36(Y.H7),m.Y36(m.sBO))})),(0,i.Z)(EmailTemplatesPreview,"ɵcmp",m.Xpm({type:e,selectors:[["email-templates-preview"]],inputs:{bodyHtmlField:"bodyHtmlField",previewForBean:"previewForBean"},decls:20,vars:7,consts:[[1,"slds-grid","slds-grid--vertical-align-end","slds-gutters_direct-xx-small"],[1,"slds-col","slds-grow","slds-form-element"],[1,"slds-form-element__label"],["label","LBL_RECORD"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",3,"click",4,"ngIf"],[1,"slds-button","slds-button--icon-border","slds-m-horizontal--xx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-form-element"],["label","LBL_DISPLAY"],[1,"slds-form-element__control","slds-p-top--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom","slds-grid","slds-p-around--xx-small","slds-grid","slds-grid--align-center","slds-grow",2,"min-height","0"],["class","slds-grid slds-grid--vertical slds-height_full",3,"width",4,"ngIf"],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],["size","small",3,"module"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow",3,"click"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare","slds-input",3,"disabled","placeholder"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled"],["icon","search"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],[1,"slds-size--1-of-1","slds-grid","slds-grid--vertical-align-center","slds-is-relative","slds-m-vertical--xx-small",2,"height","16px","border-left","1px solid #aaa","border-right","1px solid #aaa"],[2,"height","1px","width","100%","background","#aaa"],[1,"slds-theme--default","slds-p-horizontal--xx-small","slds-is-absolute",2,"left","50%","transform","translateX(-50%)"],["sandbox","",1,"slds-grow",2,"border","0","min-height","250px",3,"src"],[1,"slds-align--absolute-center","slds-height_full"],["label","MSG_NO_RECORD_SELECTED"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"label",2),m._UZ(3,"system-label",3),m.qZA(),m.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),m.YNc(8,ot,9,3,"div",8),m.YNc(9,at,4,3,"div",9),m.qZA()()()()(),m.TgZ(10,"button",10),m.NdJ("click",(function(){return t.compileBody()})),m._UZ(11,"system-button-icon",11),m.qZA(),m.TgZ(12,"div",12)(13,"label",2),m._UZ(14,"system-label",13),m.qZA(),m.TgZ(15,"div",14)(16,"system-input-radio-button-group",15),m.NdJ("ngModelChange",(function(e){return t.setViewType(e)})),m.qZA()()()(),m.TgZ(17,"div",16),m.YNc(18,ct,6,4,"div",17),m.YNc(19,rt,3,0,"div",18),m.qZA()),2&e&&(m.xp6(8),m.Q6J("ngIf",t.selectedItem),m.xp6(1),m.Q6J("ngIf",!t.selectedItem),m.xp6(1),m.Q6J("disabled",!t.selectedItem),m.xp6(6),m.Q6J("ngModel",t.viewType.value)("inputOptions",t.viewTypeOptions),m.xp6(2),m.Q6J("ngIf",t.parsedHtml),m.xp6(1),m.Q6J("ngIf",!t.selectedItem))},dependencies:[l.O5,d.JJ,d.On,E.J,Te.f,dt.t,nt.p,L._],encapsulation:2,changeDetection:0})),EmailTemplatesPreview})();function ut(e,t){1&e&&m.GkF(0)}function ht(e,t){if(1&e&&(m.ynx(0),m.YNc(1,ut,1,0,"ng-container",17),m.BQk()),2&e){m.oxw();const e=m.MAs(20);m.xp6(1),m.Q6J("ngTemplateOutlet",e)}}function pt(e,t){if(1&e&&m._UZ(0,"field-container",25),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.subjectField)}}const gt=function(){return{fieldtype:"mailboxes",scope:"outboundmass"}};function ft(e,t){if(1&e&&m._UZ(0,"field-container",26),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.mailboxField)("fieldconfig",m.DdM(2,gt))}}const bt=function(){return{fieldtype:"richtext",hidelabel:!0}};function Zt(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.DdM(2,bt))}}const _t=function(e){return{fieldtype:"pagebuilder",hidelabel:!0,bodySPBField:e}};function vt(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.VKq(2,_t,e.fieldsNames.bodySPBField))}}const xt=function(){return{fieldtype:"html",hidelabel:!0}};function yt(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.DdM(2,xt))}}const Et=function(){return{hidelabel:!0}};function Lt(e,t){if(1&e&&(m.TgZ(0,"div"),m._UZ(1,"field-container",27),m.qZA()),2&e){const e=m.oxw(2);m.xp6(1),m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.DdM(2,Et))}}function wt(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",18),m.NdJ("dblclick",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.setEditMode())})),m.TgZ(1,"div",19),m.YNc(2,pt,1,1,"field-container",20),m.YNc(3,ft,1,3,"field-container",21),m.qZA(),m.TgZ(4,"div",22),m.YNc(5,Zt,1,3,"field-container",23),m.YNc(6,vt,1,4,"field-container",23),m.YNc(7,yt,1,3,"field-container",23),m.YNc(8,Lt,2,3,"div",24),m.qZA()()}if(2&e){const e=m.oxw();m.xp6(2),m.Q6J("ngIf",!!e.fieldsNames.subjectField),m.xp6(1),m.Q6J("ngIf",!!e.fieldsNames.mailboxField),m.xp6(1),m.Q6J("ngSwitch",e.activeEditor),m.xp6(1),m.Q6J("ngSwitchCase","richText"),m.xp6(1),m.Q6J("ngSwitchCase","pageBuilder"),m.xp6(1),m.Q6J("ngSwitchCase","html")}}function Tt(e,t){if(1&e&&m._UZ(0,"field-container",31),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.subjectField)}}function Mt(e,t){if(1&e&&m._UZ(0,"field-container",26),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.mailboxField)("fieldconfig",m.DdM(2,gt))}}function kt(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.DdM(2,bt))}}function At(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.VKq(2,_t,e.fieldsNames.bodySPBField))}}function Bt(e,t){if(1&e&&m._UZ(0,"field-container",27),2&e){const e=m.oxw(2);m.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",m.DdM(2,xt))}}function Ct(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div"),m._UZ(1,"system-label",32),m.TgZ(2,"button",33),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw(2);return m.KtG(t.updateModelEditor("richText"))})),m._UZ(3,"system-label",34),m.qZA(),m._UZ(4,"system-label",35),m.TgZ(5,"button",36),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw(2);return m.KtG(t.updateModelEditor("pageBuilder"))})),m._UZ(6,"system-label",37),m.qZA(),m._UZ(7,"system-label",35),m.TgZ(8,"button",36),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw(2);return m.KtG(t.updateModelEditor("html"))})),m._UZ(9,"system-label",38),m.qZA()()}}function Ft(e,t){if(1&e&&(m.TgZ(0,"div",28)(1,"div",19),m.YNc(2,Tt,1,1,"field-container",29),m.YNc(3,Mt,1,3,"field-container",21),m.qZA(),m.TgZ(4,"div",30),m.YNc(5,kt,1,3,"field-container",23),m.YNc(6,At,1,4,"field-container",23),m.YNc(7,Bt,1,3,"field-container",23),m.YNc(8,Ct,10,0,"div",24),m.qZA()()),2&e){const e=m.oxw();m.xp6(2),m.Q6J("ngIf",!!e.fieldsNames.subjectField),m.xp6(1),m.Q6J("ngIf",!!e.fieldsNames.mailboxField),m.xp6(1),m.Q6J("ngSwitch",e.activeEditor),m.xp6(1),m.Q6J("ngSwitchCase","richText"),m.xp6(1),m.Q6J("ngSwitchCase","pageBuilder"),m.xp6(1),m.Q6J("ngSwitchCase","html")}}function Jt(e,t){1&e&&m.GkF(0)}function St(e,t){if(1&e&&(m.TgZ(0,"div",39),m.YNc(1,Jt,1,0,"ng-container",17),m.qZA()),2&e){m.oxw();const e=m.MAs(20);m.xp6(1),m.Q6J("ngTemplateOutlet",e)}}function Yt(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"button",3),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.toggleFullscreen())})),m._UZ(1,"system-button-icon",40),m.qZA()}if(2&e){const e=m.oxw();m.xp6(1),m.Q6J("icon",e.isFullscreen?"contract_alt":"expand_alt")}}const Nt=function(e,t,s){return{"slds-size--7-of-12":e,"slds-hide":t,"slds-grow":s}},qt=function(e){return{"slds-hide":e}};let Ut=(()=>{var e;class EmailTemplatesEditor{constructor(e,t,s,l,d){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"componentconfig",void 0),(0,i.Z)(this,"fieldsNames",{bodyHtmlField:"body_html",bodySPBField:"body_spb"}),(0,i.Z)(this,"expanded",void 0),(0,i.Z)(this,"subscription",new Ge.w0),(0,i.Z)(this,"isFullscreen",!1),(0,i.Z)(this,"useDynamicModule",!1),this.model=e,this.cdRef=t,this.modal=s,this.injector=l,this.view=d}get activeEditor(){return this.model.data.editor_type}get isHidden(){return this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnInit(){this.view.isEditable=!0,this.view.linkedToModel=!0,this.setUseDynamicModule(),this.setBodyFieldsName()}ngOnDestroy(){this.subscription.unsubscribe()}setEditMode(){(this.model.checkAccess("edit")||this.model.checkAccess("create"))&&(this.model.startEdit(),this.view.setEditMode(),this.cdRef.detectChanges())}setBodyFieldsName(){this.componentconfig.bodyHtmlField&&(this.fieldsNames.bodyHtmlField=this.componentconfig.bodyHtmlField),this.componentconfig.bodySPBField&&(this.fieldsNames.bodySPBField=this.componentconfig.bodySPBField),this.componentconfig.subjectField&&(this.fieldsNames.subjectField=this.componentconfig.subjectField),this.componentconfig.mailboxField&&(this.fieldsNames.mailboxField=this.componentconfig.mailboxField),this.componentconfig.previewForBean&&(this.fieldsNames.previewForBean=this.componentconfig.previewForBean),this.useDynamicModule&&this.model.getField(this.componentconfig.previewForBeanField)&&this.setActivePreviewForBean(this.model.getField(this.componentconfig.previewForBeanField))}subscribeToModelChanges(){this.useDynamicModule&&this.subscription.add(this.model.observeFieldChanges(this.componentconfig.previewForBeanField).subscribe((e=>{this.setActivePreviewForBean(e)}))),this.subscription.add(this.model.data$.subscribe((()=>this.cdRef.detectChanges()))),this.subscription.add(this.view.mode$.subscribe((()=>this.cdRef.detectChanges())))}setUseDynamicModule(){!this.componentconfig.previewForBean&&this.componentconfig.previewForBeanField&&(this.useDynamicModule=!0)}setPreviewForBean(e){this.fieldsNames.previewForBean=e}setActivePreviewForBean(e){this.setPreviewForBean(e),this.cdRef.detectChanges()}copyFromTemplate(){this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe((e=>{e.instance.module="EmailTemplates",e.instance.multiselect=!1,e.instance.selectedItems.subscribe((e=>{e.length&&this.model.setFields({[this.fieldsNames.bodyHtmlField]:e[0].body_html,[this.fieldsNames.bodySPBField]:e[0].body_spb,editor_type:e[0].editor_type})}))}))}updateModelEditor(e){this.model.setField("editor_type",e),this.cdRef.detectChanges()}expand(e){this.expanded&&this.expanded!=e?this.expanded=void 0:this.expanded=e}toggleFullscreen(){this.isFullscreen=!this.isFullscreen,this.cdRef.detectChanges()}}return e=EmailTemplatesEditor,(0,i.Z)(EmailTemplatesEditor,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(m.sBO),m.Y36(J.o),m.Y36(m.zs3),m.Y36(v.e))})),(0,i.Z)(EmailTemplatesEditor,"ɵcmp",m.Xpm({type:e,selectors:[["email-templates-editor"]],features:[m._Bn([v.e])],decls:21,vars:16,consts:[[1,"slds-grid","slds-height_full","slds-is-relative","slds-theme--default"],[1,"slds-border--right","slds-height_full","slds-grid","slds-grid--vertical",3,"ngClass"],[1,"slds-grid","slds-grid--align-end","slds-p-right--x-small","slds-p-top--xxx-small"],[1,"slds-button","slds-button--icon-bare","slds-button--icon",3,"click"],["icon","copy","size","small"],["icon","arrow_left","size","small"],[4,"ngIf"],[1,"slds-p-around--x-small","slds-grow",2,"min-height","0"],["class","slds-height_full slds-p-top--x-small","style","min-height: 250px",3,"dblclick",4,"ngIf","ngIfElse"],["contentEditingContainer",""],[1,"slds-is-relative","slds-grow","slds-height_full","slds-grid","slds-grid--vertical",2,"min-width","0",3,"ngClass"],[1,"slds-grid","slds-p-left--x-small","slds-grid--align-spread"],["icon","arrow_right","size","small"],["class","slds-m-right--x-small",4,"ngIf"],[1,"slds-grow","slds-p-around--x-small",2,"min-height","0"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"previewForBean","bodyHtmlField"],["fullscreenButton",""],[4,"ngTemplateOutlet"],[1,"slds-height_full","slds-p-top--x-small",2,"min-height","250px",3,"dblclick"],[1,"slds-grid","slds-m-bottom--xx-small"],["class","slds-grow slds-m-right--x-small","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small","class","slds-m-left--x-small",3,"field","fieldconfig",4,"ngIf"],[1,"slds-grid","slds-grid--align-center","slds-grid--vertical-align-center",2,"min-height","250px",3,"ngSwitch"],["class","slds-size--1-of-1 slds-height_full child-height-full",3,"field","fieldconfig",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow","slds-m-right--x-small",3,"field"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-m-left--x-small",3,"field","fieldconfig"],[1,"slds-size--1-of-1","slds-height_full","child-height-full",3,"field","fieldconfig"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],["class","slds-grow","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],[1,"slds-grid","slds-grid--align-center","slds-grid--vertical-align-center","slds-grow",2,"min-height","250px",3,"ngSwitch"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow",3,"field"],["label","LBL_EDIT_WITH",1,"slds-m-right--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button",3,"click"],["label","LBL_RICH_TEXT_EDITOR"],["label","LBL_OR",1,"slds-m-horizontal--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button","slds-m-lef",3,"click"],["label","LBL_PAGE_BUILDER"],["label","LBL_HTML"],[1,"slds-m-right--x-small"],[3,"icon"]],template:function(e,t){if(1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),m.NdJ("click",(function(){return t.copyFromTemplate()})),m._UZ(4,"system-button-icon",4),m.qZA(),m.TgZ(5,"button",3),m.NdJ("click",(function(){return t.expand("right")})),m._UZ(6,"system-button-icon",5),m.qZA(),m.YNc(7,ht,2,1,"ng-container",6),m.qZA(),m.TgZ(8,"div",7),m.YNc(9,wt,9,6,"div",8),m.YNc(10,Ft,9,6,"ng-template",null,9,m.W1O),m.qZA()(),m.TgZ(12,"div",10)(13,"div",11)(14,"button",3),m.NdJ("click",(function(){return t.expand("left")})),m._UZ(15,"system-button-icon",12),m.qZA(),m.YNc(16,St,2,1,"div",13),m.qZA(),m.TgZ(17,"div",14),m._UZ(18,"email-templates-preview",15),m.qZA()()(),m.YNc(19,Yt,2,1,"ng-template",null,16,m.W1O)),2&e){const e=m.MAs(11);m.ekj("spice-fullscreen",t.isFullscreen),m.xp6(1),m.Q6J("ngClass",m.kEZ(10,Nt,!t.expanded,"right"==t.expanded,"left"==t.expanded)),m.xp6(6),m.Q6J("ngIf","left"==t.expanded),m.xp6(2),m.Q6J("ngIf",!t.view.isEditMode())("ngIfElse",e),m.xp6(3),m.Q6J("ngClass",m.VKq(14,qt,"left"==t.expanded)),m.xp6(4),m.Q6J("ngIf","left"!=t.expanded),m.xp6(2),m.Q6J("previewForBean",t.fieldsNames.previewForBean)("bodyHtmlField",t.fieldsNames.bodyHtmlField)}},dependencies:[l.mk,l.O5,l.tP,l.RF,l.n9,l.ED,it.j,E.J,L._,mt],encapsulation:2,changeDetection:0})),EmailTemplatesEditor})();var Ot=s(3369),It=s(6625),Qt=s(5638),Rt=s(3398);function jt(e,t){if(1&e&&m._UZ(0,"field-label",3),2&e){const e=m.oxw();m.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}const Dt=function(e,t){return{"text-decoration":e,"font-weight":t}};function Pt(e,t){if(1&e&&(m.TgZ(0,"field-generic-display",4)(1,"div",5)(2,"div",6),m._UZ(3,"system-utility-icon",7),m.qZA(),m.TgZ(4,"div",8),m._uU(5),m.qZA()()()),2&e){const e=m.oxw();m.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig)("fieldid",e.fieldid),m.xp6(2),m.Q6J("system-title",e.statusLabel),m.xp6(1),m.Q6J("icon",e.statusIcon),m.xp6(1),m.Q6J("title",e.value)("ngStyle",m.WLB(9,Dt,"user_closed"==e.model.data.openness||"system_closed"==e.model.data.openness?"line-through":"initial","unread"==e.model.data.status?"bold":"initial")),m.xp6(1),m.hij(" ",e.value," ")}}function Ht(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",9)(1,"input",10),m.NdJ("ngModelChange",(function(t){m.CHM(e);const s=m.oxw();return m.KtG(s.value=t)})),m.qZA(),m._UZ(2,"field-messages",11),m.qZA()}if(2&e){const e=m.oxw();m.Q6J("ngClass",e.getFieldClass()),m.xp6(1),m.Q6J("ngModel",e.value)("maxlength",e.fieldlength)("autocomplete",e.fieldid)("ngModelOptions",e.modelOptions),m.xp6(1),m.Q6J("fieldname",e.fieldname)}}let zt=(()=>{var e;class fieldEmailSubject extends K.O{constructor(e,t,s,l,d,n,o,a,c,r,m,u,h){super(e,t,s,l,o),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"router",void 0),(0,i.Z)(this,"injector",void 0),(0,i.Z)(this,"broadcast",void 0),(0,i.Z)(this,"configurationService",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"cdRef",void 0),(0,i.Z)(this,"sanitized",void 0),this.model=e,this.view=t,this.language=s,this.metadata=l,this.backend=d,this.toast=n,this.router=o,this.injector=a,this.broadcast=c,this.configurationService=r,this.modal=m,this.cdRef=u,this.sanitized=h}get statusIcon(){switch(this.model.getField("status")){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get statusLabel(){switch(this.model.getField("status")){case"opened":case"read":return"LBL_OPEN";case"bounced":case"deferred":case"send_error":return"LBL_ERROR";case"sent":return"LBL_OUTBOUND";default:return"LBL_UNREAD"}}}return e=fieldEmailSubject,(0,i.Z)(fieldEmailSubject,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(v.e),m.Y36(u.d),m.Y36(h.Pu),m.Y36(x.y),m.Y36(fe.A),m.Y36(X.F0),m.Y36(m.zs3),m.Y36(Ot.f),m.Y36(It.C),m.Y36(J.o),m.Y36(m.sBO),m.Y36(Y.H7))})),(0,i.Z)(fieldEmailSubject,"ɵcmp",m.Xpm({type:e,selectors:[["field-email-subject"]],features:[m.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],["class","slds-form-element__control slds-is-relative","style","position:relative;",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-right--x-small",3,"system-title"],["size","x-small",3,"icon"],[1,"slds-truncate",3,"title","ngStyle"],[1,"slds-form-element__control","slds-is-relative",2,"position","relative",3,"ngClass"],["system-placeholder","","type","text",1,"slds-input",3,"ngModel","maxlength","autocomplete","ngModelOptions","ngModelChange"],[3,"fieldname"]],template:function(e,t){1&e&&(m.YNc(0,jt,1,2,"field-label",0),m.YNc(1,Pt,6,12,"field-generic-display",1),m.YNc(2,Ht,3,6,"div",2)),2&e&&(m.Q6J("ngIf",t.displayLabel),m.xp6(1),m.Q6J("ngIf",!t.isEditMode()),m.xp6(1),m.Q6J("ngIf",t.isEditable()&&t.isEditMode()))},dependencies:[l.mk,l.O5,l.PC,d.Fj,d.JJ,d.nD,d.On,W.q,ee.D,Qt.a,te.r,Rt.A,Me.S],encapsulation:2})),fieldEmailSubject})();function Gt(e,t){if(1&e&&m._UZ(0,"field-label",3),2&e){const e=m.oxw();m.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Vt(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"button",4),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.setOpenness("user_closed"))})),m._UZ(1,"system-button-icon",5),m.qZA()}if(2&e){const e=m.oxw();m.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function $t(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"button",4),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.setOpenness("open"))})),m._UZ(1,"system-button-icon",6),m.qZA()}if(2&e){const e=m.oxw();m.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}let Kt=(()=>{var e;class fieldEmailActivityOpenness extends K.O{constructor(e,t,s,l,d,n,o){super(e,t,s,l,o),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"router",void 0),this.model=e,this.view=t,this.language=s,this.metadata=l,this.backend=d,this.toast=n,this.router=o}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest(`module/${this.model.module}/${this.model.id}/openness`,null,{openness:e}).subscribe((e=>{}),(t=>{this.toast.sendAlert("Cannot change openness to "+e)}))}}return e=fieldEmailActivityOpenness,(0,i.Z)(fieldEmailActivityOpenness,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(v.e),m.Y36(u.d),m.Y36(h.Pu),m.Y36(x.y),m.Y36(fe.A),m.Y36(X.F0))})),(0,i.Z)(fieldEmailActivityOpenness,"ɵcmp",m.Xpm({type:e,selectors:[["field-email-activity-openness"]],features:[m.qOj],decls:4,vars:4,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngClass"],["class","slds-button slds-button--icon",3,"disabled","title","click",4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-button","slds-button--icon",3,"disabled","title","click"],["icon","unlock"],["icon","lock"]],template:function(e,t){1&e&&(m.YNc(0,Gt,1,2,"field-label",0),m.TgZ(1,"div",1),m.YNc(2,Vt,2,2,"button",2),m.YNc(3,$t,2,2,"button",2),m.qZA()),2&e&&(m.Q6J("ngIf",t.displayLabel),m.xp6(1),m.Q6J("ngClass",t.getFieldClass()),m.xp6(1),m.Q6J("ngIf","open"==t.model.data.openness),m.xp6(1),m.Q6J("ngIf","user_closed"==t.model.data.openness||"system_closed"==t.model.data.openness))},dependencies:[l.mk,l.O5,W.q,E.J],encapsulation:2})),fieldEmailActivityOpenness})();function Xt(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",9)(1,"div")(2,"system-checkbox",10),m.NdJ("ngModelChange",(function(t){const s=m.CHM(e).$implicit;return m.KtG(s.selected=t)})),m.qZA()(),m.TgZ(3,"div"),m._UZ(4,"system-icon",11),m.qZA(),m.TgZ(5,"div",12),m._uU(6),m.qZA(),m.TgZ(7,"div"),m._uU(8),m.qZA()()}if(2&e){const e=t.$implicit;m.xp6(2),m.Q6J("ngModel",e.selected),m.xp6(2),m.Q6J("module",e.module),m.xp6(2),m.Oqu(e.summary_text),m.xp6(2),m.hij("(",e.email_address,")")}}function Wt(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"system-modal",1)(1,"system-modal-header",2),m.NdJ("close",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.close())})),m._UZ(2,"system-label",3),m.qZA(),m.TgZ(3,"system-modal-content"),m.YNc(4,Xt,9,4,"div",4),m.qZA(),m.TgZ(5,"system-modal-footer")(6,"button",5),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.close())})),m._UZ(7,"system-label",6),m.qZA(),m.TgZ(8,"button",7),m.NdJ("click",(function(){m.CHM(e);const t=m.oxw();return m.KtG(t.add())})),m._UZ(9,"system-label",8),m.qZA()()()}if(2&e){const e=m.oxw();m.xp6(4),m.Q6J("ngForOf",e.addresses),m.xp6(4),m.Q6J("disabled",!e.canAdd)}}let es=(()=>{var e;class EmailParentAddressesModal{constructor(e,t,s,l){(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"modal",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"backend",void 0),(0,i.Z)(this,"self",void 0),(0,i.Z)(this,"addresses",[]),(0,i.Z)(this,"addAddresses",new m.vpe),this.model=e,this.modal=t,this.toast=s,this.backend=l}ngOnInit(){let e=this.modal.await("LBL_LOADING");this.backend.getRequest(`module/EmailAddresses/${this.model.getField("parent_type")}/${this.model.getField("parent_id")}`).subscribe((t=>{this.addresses=t,0==this.addresses.length&&(this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","info"),this.close()),e.emit(!0)}),(()=>{this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","error"),e.emit(!0),this.close()}))}get canAdd(){return this.addresses.filter((e=>e.selected)).length>0}add(){this.addAddresses.emit(this.addresses.filter((e=>e.selected))),this.close()}close(){this.self.destroy()}}return e=EmailParentAddressesModal,(0,i.Z)(EmailParentAddressesModal,"ɵfac",(function(t){return new(t||e)(m.Y36(_.o),m.Y36(J.o),m.Y36(fe.A),m.Y36(x.y))})),(0,i.Z)(EmailParentAddressesModal,"ɵcmp",m.Xpm({type:e,selectors:[["email-parent-addresses-modal"]],decls:1,vars:1,consts:[["size","small",4,"ngIf"],["size","small"],[3,"close"],["label","LBL_SELECT_PARENT_EMAIL"],["class","slds-grid slds-p-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-button","slds-button_neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button_brand",3,"disabled","click"],["label","LBL_ADD"],[1,"slds-grid","slds-p-vertical--xx-small"],[3,"ngModel","ngModelChange"],["size","x-small",3,"module"],[1,"slds-p-right--small"]],template:function(e,t){1&e&&m.YNc(0,Wt,10,2,"system-modal",0),2&e&&m.Q6J("ngIf",t.addresses.length>0)},dependencies:[l.sg,l.O5,d.JJ,d.On,we.U,Te.f,L._,q.j,U.x,O.p,I.y],encapsulation:2})),EmailParentAddressesModal})();var ts=s(3917);const ss=["contextMenu"];function is(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"li",7)(1,"a",8),m.NdJ("click",(function(){const t=m.CHM(e).$implicit,s=m.oxw(2);return m.KtG(s.setField(t))})),m.TgZ(2,"span",9),m._UZ(3,"system-label-fieldname",10),m.qZA()()()}if(2&e){const e=t.$implicit,s=m.oxw(2);m.xp6(3),m.Q6J("module",s.emailmodule)("field",e)}}function ls(e,t){if(1&e&&(m.TgZ(0,"div",3,4)(2,"ul",5),m.YNc(3,is,4,2,"li",6),m.qZA()()),2&e){const e=m.oxw();m.Q6J("ngStyle",e.contextMenuStyle),m.xp6(3),m.Q6J("ngForOf",e.emailfields)}}let ds=(()=>{var e;class EmailToLeadEmailText{constructor(e,t,s){(0,i.Z)(this,"elementRef",void 0),(0,i.Z)(this,"renderer",void 0),(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"contextMenu",void 0),(0,i.Z)(this,"emailtext",""),(0,i.Z)(this,"emailhtml",""),(0,i.Z)(this,"emailmodule",""),(0,i.Z)(this,"emailfields",["first_name","last_name"]),(0,i.Z)(this,"setfield",new m.vpe),(0,i.Z)(this,"clickListener",null),(0,i.Z)(this,"displayContextMenu",!1),(0,i.Z)(this,"displayContextCoordinates",{top:0,left:0}),this.elementRef=e,this.renderer=t,this.language=s}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return e=EmailToLeadEmailText,(0,i.Z)(EmailToLeadEmailText,"ɵfac",(function(t){return new(t||e)(m.Y36(m.SBq),m.Y36(m.Qsj),m.Y36(u.d))})),(0,i.Z)(EmailToLeadEmailText,"ɵcmp",m.Xpm({type:e,selectors:[["email-to-lead-emailtext"]],viewQuery:function(e,t){if(1&e&&m.Gf(ss,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(t.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1),m.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),m.qZA(),m.YNc(2,ls,4,2,"div",2),m.qZA()),2&e&&(m.xp6(1),m.Q6J("innerHTML",t.content,m.oJD),m.xp6(1),m.Q6J("ngIf",t.displayContextMenu))},dependencies:[l.sg,l.O5,l.PC,p.h],encapsulation:2})),EmailToLeadEmailText})();const ns=["detailcontainer"];let os=(()=>{var e;class EmailToLeadModal{constructor(e,t,s,l,d,n){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"footer",void 0),(0,i.Z)(this,"toast",void 0),(0,i.Z)(this,"detailcontainer",void 0),(0,i.Z)(this,"email",null),(0,i.Z)(this,"self",null),(0,i.Z)(this,"componentRefs",[]),(0,i.Z)(this,"leadFields",["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"]),this.language=e,this.metadata=t,this.view=s,this.model=l,this.footer=d,this.toast=n,this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}}return e=EmailToLeadModal,(0,i.Z)(EmailToLeadModal,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(v.e),m.Y36(_.o),m.Y36(ts.M),m.Y36(fe.A))})),(0,i.Z)(EmailToLeadModal,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&m.Gf(ns,7,m.s_b),2&e){let e;m.iGM(e=m.CRH())&&(t.detailcontainer=e.first)}},features:[m._Bn([_.o,v.e])],decls:20,vars:5,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),m.NdJ("click",(function(){return t.closeModal()})),m._UZ(4,"system-button-icon",4),m.qZA(),m.TgZ(5,"h2",5),m._UZ(6,"system-label",6),m.qZA()(),m.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"email-to-lead-emailtext",10),m.NdJ("setfield",(function(e){return t.setField(e)})),m.qZA()(),m.TgZ(11,"div",11),m._UZ(12,"div",null,12),m.qZA()()(),m.TgZ(14,"div",13)(15,"button",14),m.NdJ("click",(function(){return t.closeModal()})),m._UZ(16,"system-label",15),m.qZA(),m.TgZ(17,"button",16),m.NdJ("click",(function(){return t.saveLead()})),m._UZ(18,"system-label",17),m.qZA()()()(),m._UZ(19,"div",18)),2&e&&(m.xp6(4),m.Q6J("icon","close"),m.xp6(6),m.Q6J("emailmodule",t.model.module)("emailtext",t.email.data.body)("emailhtml",t.email.data.body)("emailfields",t.leadFields))},dependencies:[E.J,L._,ds],encapsulation:2})),EmailToLeadModal})(),as=(()=>{var e;class EmailToLeadButton{constructor(e,t,s,l,d){(0,i.Z)(this,"language",void 0),(0,i.Z)(this,"metadata",void 0),(0,i.Z)(this,"model",void 0),(0,i.Z)(this,"footer",void 0),(0,i.Z)(this,"toast",void 0),this.language=e,this.metadata=t,this.model=s,this.footer=l,this.toast=d}createLead(){this.metadata.addComponent("EmailToLeadModal",this.footer.footercontainer).subscribe((e=>{e.instance.email=this.model,e.instance.self=e}))}}return e=EmailToLeadButton,(0,i.Z)(EmailToLeadButton,"ɵfac",(function(t){return new(t||e)(m.Y36(u.d),m.Y36(h.Pu),m.Y36(_.o),m.Y36(ts.M),m.Y36(fe.A))})),(0,i.Z)(EmailToLeadButton,"ɵcmp",m.Xpm({type:e,selectors:[["ng-component"]],hostAttrs:[1,"slds-button","slds-button--neutral"],hostBindings:function(e,t){1&e&&m.NdJ("click",(function(){return t.createLead()}))},decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,t){1&e&&(m.TgZ(0,"span"),m._UZ(1,"system-label",0),m.qZA())},dependencies:[L._],styles:["[_nghost-%COMP%]{cursor:pointer}"]})),EmailToLeadButton})(),cs=(()=>{var e;class ModuleEmails{}return e=ModuleEmails,(0,i.Z)(ModuleEmails,"ɵfac",(function(t){return new(t||e)})),(0,i.Z)(ModuleEmails,"ɵmod",m.oAB({type:e})),(0,i.Z)(ModuleEmails,"ɵinj",m.cJS({imports:[l.ez,d.u5,o.ObjectFields,a.GlobalComponents,c.ObjectComponents,r.SystemComponents,n.o]})),ModuleEmails})();("undefined"==typeof ngJitMode||ngJitMode)&&m.kYT(cs,{declarations:[S,Z,C,P,V,$,de,ne,he,be,pe,ge,_e,ye,Le,ve,Oe,ze,et,st,Ut,mt,es,zt,Kt,os,ds,as],imports:[l.ez,d.u5,o.ObjectFields,a.GlobalComponents,c.ObjectComponents,r.SystemComponents,n.o]})}}]);