/*!
 * 
 *                     aacService
 *
 *                     release: 2023.03.001
 *
 *                     date: 2024-01-03 13:43:56
 *
 *                     build: 2023.03.001.1704285836024
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_emails_moduleemails_ts"],{11268:(e,t,s)=>{s.r(t),s.d(t,{ModuleEmails:()=>Ts});var i=s(44755),l=s(95030),n=s(84357),a=s(53190),o=s(34826),d=s(19784),c=s(57239),r=s(62242),m=s(55329),u=s(4154),h=s(7674);const g=["contextMenu"];function p(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"li",7)(1,"a",8),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw(2);return r.KtG(s.setField(t))})),r.TgZ(2,"span",9),r._UZ(3,"system-label-fieldname",10),r.qZA()()()}if(2&e){const e=t.$implicit,s=r.oxw(2);r.xp6(3),r.Q6J("module",s.target_module_name)("field",e)}}function f(e,t){if(1&e&&(r.TgZ(0,"div",3,4)(2,"ul",5),r.YNc(3,p,4,2,"li",6),r.qZA()()),2&e){const e=r.oxw();r.Q6J("ngStyle",e.contextMenuStyle),r.xp6(3),r.Q6J("ngForOf",e.target_module_fields)}}let b=(()=>{class EmailToObjectEmailText{elementRef;renderer;language;metadata;contextMenu;text="";html="";target_module_name="";target_module_fields=[];setfield=new r.vpe;clickListener=null;displayContextMenu=!1;displayContextCoordinates={top:0,left:0};_striped_content;constructor(e,t,s,i){this.elementRef=e,this.renderer=t,this.language=s,this.metadata=i}get content(){return this.html?this.html:this.text}get striped_content(){return this._striped_content||(this.html?this._striped_content=this.html.replace(/<!--.*?-->/gs,"").replace(/<[^>]+>/g,"").replace(/[ ]{2,}/g," ").replace(/[\n\r]{3,}/g,"\n"):this._striped_content=this.text),this._striped_content}ngOnInit(){if(!this.target_module_fields||0===this.target_module_fields.length){let e=["varchar","text"],t=this.metadata.getModuleFields(this.target_module_name);for(let s in t)e.indexOf(t[s].type)>=0&&t[s].vname&&"id"!==t[s].name&&this.target_module_fields.push(s)}}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static ɵfac=function(e){return new(e||EmailToObjectEmailText)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(m.d),r.Y36(u.Pu))};static ɵcmp=r.Xpm({type:EmailToObjectEmailText,selectors:[["email-to-object-emailtext"]],viewQuery:function(e,t){if(1&e&&r.Gf(g,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.contextMenu=e.first)}},inputs:{text:"text",html:"html",target_module_name:"target_module_name",target_module_fields:"target_module_fields"},outputs:{setfield:"setfield"},decls:4,vars:3,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-input",2,"height","100%","width","100%","resize","none",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),r._uU(2),r.qZA(),r.YNc(3,f,4,2,"div",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("innerHTML",t.content,r.oJD),r.xp6(1),r.Oqu(t.striped_content),r.xp6(1),r.Q6J("ngIf",t.displayContextMenu))},dependencies:[i.sg,i.O5,i.PC,h.h],encapsulation:2})}return EmailToObjectEmailText})();var _=s(55710),x=s(32294),v=s(14505),y=s(9062),Z=s(72656),E=s(83463),L=s(93333),w=s(7763),T=s(23814);const M=["detailcontainer"];function A(e,t){if(1&e&&r._UZ(0,"object-record-fieldset",20),2&e){const e=r.oxw();r.Q6J("fieldset",e.componentconfig.emailFieldset)}}const k=function(e,t){return{module:"Emails",id:e,data:t}};let C=(()=>{class EmailToObjectModal{language;metadata;view;model;backend;detailcontainer;email_model=null;self=null;componentRefs=[];save$=new r.vpe;object_module_name;object_fields=[];object_relation_link_name;object_predefined_fields;componentconfig;constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.view=s,this.model=i,this.backend=l}ngOnInit(){if(this.model.module=this.object_module_name,this.model.initializeModel(this.email_model),this.componentconfig=this.metadata.getComponentConfig("EmailToObjectModal",this.model.module),this.object_predefined_fields){let e={};for(let t in this.object_predefined_fields)e[t]=this.object_predefined_fields[t];this.model.setFields(e)}this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}close(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}save(){this.model.validate()&&this.model.save().subscribe((e=>{this.object_relation_link_name?this.backend.postRequest("module/Emails/"+this.email_model.id+"/related/"+this.object_relation_link_name,[],[this.model.id]).subscribe((e=>{this.save$.emit(this.model.data),this.close()})):(this.save$.emit(this.model.data),this.close())}))}static ɵfac=function(e){return new(e||EmailToObjectModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(x.e),r.Y36(_.o),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailToObjectModal,selectors:[["email-to-object-modal"]],viewQuery:function(e,t){if(1&e&&r.Gf(M,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.detailcontainer=e.first)}},inputs:{object_module_name:"object_module_name",object_fields:"object_fields",object_relation_link_name:"object_relation_link_name",object_predefined_fields:"object_predefined_fields"},outputs:{save$:"save$"},features:[r._Bn([_.o,x.e])],decls:21,vars:12,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],[3,"module","singular"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],["system-view-provider","",1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%",3,"system-model-provider"],[3,"fieldset",4,"ngIf"],[3,"target_module_name","text","html","target_module_fields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"],[3,"fieldset"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",(function(){return t.close()})),r._UZ(4,"system-button-icon",4),r.qZA(),r.TgZ(5,"h2",5),r._UZ(6,"system-label-modulename",6),r.qZA()(),r.TgZ(7,"div",7)(8,"div",8)(9,"div",9),r.YNc(10,A,1,1,"object-record-fieldset",10),r.TgZ(11,"email-to-object-emailtext",11),r.NdJ("setfield",(function(e){return t.setField(e)})),r.qZA()(),r.TgZ(12,"div",12),r._UZ(13,"div",null,13),r.qZA()()(),r.TgZ(15,"div",14)(16,"button",15),r.NdJ("click",(function(){return t.close()})),r._UZ(17,"system-label",16),r.qZA(),r.TgZ(18,"button",17),r.NdJ("click",(function(){return t.save()})),r._UZ(19,"system-label",18),r.qZA()()()(),r._UZ(20,"div",19)),2&e&&(r.xp6(4),r.Q6J("icon","close"),r.xp6(2),r.Q6J("module",t.object_module_name)("singular",!0),r.xp6(3),r.Q6J("system-model-provider",r.WLB(9,k,t.email_model.id,t.email_model.data)),r.xp6(1),r.Q6J("ngIf",!(null==t.componentconfig||!t.componentconfig.emailFieldset)),r.xp6(1),r.Q6J("target_module_name",t.object_module_name)("text",t.email_model.data.body)("html",t.email_model.data.body)("target_module_fields",t.object_fields))},dependencies:[i.O5,y.d,Z.J,E._,L.M,w.u,T.V,b],encapsulation:2})}return EmailToObjectModal})();var F=s(66040),J=s(44044);let Y=(()=>{class EmailToObjectButton{language;model;metadata;modal;relatedmodels;object_module_name;actionconfig;relation_subscription;actionemitter=new r.vpe;subscription;constructor(e,t,s,i,l){this.language=e,this.model=t,this.metadata=s,this.modal=i,this.relatedmodels=l}get disabled(){if(!this.metadata.checkModuleAcl(this.actionconfig.module,"create"))return!0;if(this.actionconfig.checklink){if(this.relatedmodels.isloading)return!0;if(this.relatedmodels.count>0)return!0}return!1}ngOnInit(){this.object_module_name=this.actionconfig.module,this.actionconfig.checklink&&this.subscribeToModel()}subscribeToModel(){this.subscription=this.model.data$.subscribe((e=>{this.getRelatedData()}))}ngOnDestroy(){this.subscription?.unsubscribe()}getRelatedData(){this.relatedmodels.module=this.model.module,this.relatedmodels.id=this.model.id,this.relatedmodels.relatedModule=this.actionconfig.module,this.relatedmodels.linkName=this.actionconfig.checklink,this.relatedmodels.getData()}execute(){this.modal.openModal("EmailToObjectModal",!0).subscribe((e=>{e.instance.email_model=this.model,e.instance.object_module_name=this.object_module_name,e.instance.object_relation_link_name=this.actionconfig.relation_link_name,e.instance.object_predefined_fields=this.actionconfig.predefined_fields,e.instance.save$.subscribe((e=>{this.actionemitter.emit("save")}))}))}static ɵfac=function(e){return new(e||EmailToObjectButton)(r.Y36(m.d),r.Y36(_.o),r.Y36(u.Pu),r.Y36(J.o),r.Y36(F.j))};static ɵcmp=r.Xpm({type:EmailToObjectButton,selectors:[["email-to-object-button"]],outputs:{actionemitter:"actionemitter"},features:[r._Bn([F.j])],decls:3,vars:2,consts:[["label","LBL_CONVERT_TO"],[3,"module","singular"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0)(2,"system-label-modulename",1),r.qZA()),2&e&&(r.xp6(2),r.Q6J("module",t.object_module_name)("singular",!0))},dependencies:[E._,L.M],encapsulation:2})}return EmailToObjectButton})();var B=s(66550),S=s(50323),q=s(59621),N=s(83499),O=s(75767),U=s(1916),I=s(94664);function Q(e,t){if(1&e&&(r.TgZ(0,"span",9),r._uU(1),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.hij('"',e.model.data.name,'"')}}function R(e,t){1&e&&(r.TgZ(0,"div",10)(1,"div",11),r._UZ(2,"system-spinner"),r.TgZ(3,"div",12),r._uU(4,"... "),r._UZ(5,"system-label",13),r._uU(6," ..."),r.qZA()()())}function j(e,t){if(1&e&&r._UZ(0,"object-record-fieldset",14),2&e){const e=r.oxw();r.Q6J("fieldset",e.fieldset)}}let D=(()=>{class EmailPreviewModal{language;metadata;sanitizer;backend;model;view;modelattachments;self={};type="";name="";file;fieldset;isLoading=!0;constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.sanitizer=s,this.backend=i,this.model=l,this.view=n,this.modelattachments=a,this.model.module="Emails";let o=this.metadata.getComponentConfig("EmailPreviewModal",this.model.module);this.fieldset=o.fieldset}closeModal(){this.self.destroy()}ngOnInit(){this.backend.getRequest("module/Emails/msg/"+this.file.id).subscribe((e=>{this.model.setFields(this.model.utils.backendModel2spice("Emails",e)),this.isLoading=!1}))}download(){this.modelattachments.downloadAttachment(this.file.id,this.file.filename)}static ɵfac=function(e){return new(e||EmailPreviewModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(B.H7),r.Y36(v.y),r.Y36(_.o),r.Y36(x.e),r.Y36(S.H))};static ɵcmp=r.Xpm({type:EmailPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},features:[r._Bn([_.o,x.e])],decls:10,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_EMAIL"],["class","slds-truncate",4,"ngIf"],["margin","none"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["direction","vertical",3,"fieldset",4,"ngIf"],[1,"slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","download","size","small"],[1,"slds-truncate"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-grid_vertical"],[1,"slds-p-around--small"],["label","LBL_LOADING"],["direction","vertical",3,"fieldset"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.closeModal()})),r._UZ(2,"system-label",2),r.YNc(3,Q,2,1,"span",3),r.qZA(),r.TgZ(4,"system-modal-content",4),r.YNc(5,R,7,0,"div",5),r.YNc(6,j,1,1,"object-record-fieldset",6),r.qZA(),r.TgZ(7,"system-modal-footer")(8,"button",7),r.NdJ("click",(function(){return t.download()})),r._UZ(9,"system-button-icon",8),r.qZA()()()),2&e&&(r.xp6(3),r.Q6J("ngIf",!t.isLoading),r.xp6(2),r.Q6J("ngIf",t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.isLoading),r.xp6(2),r.Q6J("disabled",t.isLoading))},dependencies:[i.O5,y.d,Z.J,E._,q.j,N.x,O.p,U.y,I.W],encapsulation:2})}return EmailPreviewModal})();var H=s(42067);function P(e,t){1&e&&(r.TgZ(0,"div",5),r._UZ(1,"system-spinner"),r.qZA())}function z(e,t){if(1&e&&(r.TgZ(0,"div",6)(1,"div"),r._uU(2),r.qZA(),r._UZ(3,"div",7),r.qZA()),2&e){const e=r.oxw();r.xp6(2),r.hij("subject: ",e.subject,""),r.xp6(1),r.Q6J("innerHTML",e.body,r.oJD)}}let G=(()=>{class EmailMSGPreviewModal{language;sanitizer;libloader;self={};type="";name="";libsloaded=!1;blobUrl;msgData;constructor(e,t,s){this.language=e,this.sanitizer=t,this.libloader=s}closeModal(){this.self.destroy()}set data(e){this.libloader.loadLib("msgreader").subscribe((e=>{}))}get subject(){return this.msgData?this.msgData.subject:""}get body(){return this.msgData?this.sanitizer.bypassSecurityTrustHtml(this.msgData.body.replace(/\n/g,"<br/>")):""}get objecttype(){if(!this.type)return"";let e=this.type.split("/");switch(e[0]){case"audio":case"video":return e[0];default:return"object"}}download(){let e=document.createElement("a");document.body.appendChild(e),e.href=this.blobUrl,e.download=this.name,e.click(),e.remove()}datatoBlob(e,t="",s=512){let i=[];for(let t=0;t<e.length;t+=s){let l=e.slice(t,t+s),n=new Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);let a=new Uint8Array(n);i.push(a)}return new Blob(i,{type:t})}static ɵfac=function(e){return new(e||EmailMSGPreviewModal)(r.Y36(m.d),r.Y36(B.H7),r.Y36(H.$))};static ɵcmp=r.Xpm({type:EmailMSGPreviewModal,selectors:[["ng-component"]],inputs:{type:"type",name:"name"},decls:6,vars:3,consts:[["size","large"],[3,"close"],["margin","none",3,"grow"],["style","height: 50vh;","class","slds-align--absolute-center",4,"ngIf"],["class","slds-p-around--small slds-text-align--center",4,"ngIf"],[1,"slds-align--absolute-center",2,"height","50vh"],[1,"slds-p-around--small","slds-text-align--center"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.closeModal()})),r._uU(2,"Email Preview"),r.qZA(),r.TgZ(3,"system-modal-content",2),r.YNc(4,P,2,0,"div",3),r.YNc(5,z,4,2,"div",4),r.qZA()()),2&e&&(r.xp6(3),r.Q6J("grow",!0),r.xp6(1),r.Q6J("ngIf",!t.msgData),r.xp6(1),r.Q6J("ngIf",t.msgData))},dependencies:[i.O5,q.j,N.x,U.y,I.W],encapsulation:2})}return EmailMSGPreviewModal})();var $=s(12803);function K(e,t){if(1&e&&r._UZ(0,"iframe",2),2&e){const e=r.oxw();r.Q6J("src",e.iframeUrl,r.uOi)}}function X(e,t){1&e&&(r.TgZ(0,"div",3),r._UZ(1,"system-stencil"),r.qZA())}let V=(()=>{class EmailsPopoverBody{model;language;sanitized;iframeUrl;isLoading=!1;constructor(e,t,s){this.model=e,this.language=t,this.sanitized=s}ngOnInit(){this.isLoading=!0,this.model.generateFieldHtmlContentBlobUrl("body").subscribe((e=>{this.isLoading=!1,this.iframeUrl=e}))}static ɵfac=function(e){return new(e||EmailsPopoverBody)(r.Y36(_.o),r.Y36(m.d),r.Y36(B.H7))};static ɵcmp=r.Xpm({type:EmailsPopoverBody,selectors:[["ng-component"]],decls:2,vars:2,consts:[["style","height: 400px;","style","resize: vertical;","width","100%","frameborder","0","seamless","true","sandbox","",3,"src",4,"ngIf"],["class","slds-p-around--small",4,"ngIf"],["width","100%","frameborder","0","seamless","true","sandbox","",2,"resize","vertical",3,"src"],[1,"slds-p-around--small"]],template:function(e,t){1&e&&(r.YNc(0,K,1,1,"iframe",0),r.YNc(1,X,2,0,"div",1)),2&e&&(r.Q6J("ngIf",!t.isLoading&&t.iframeUrl),r.xp6(1),r.Q6J("ngIf",t.isLoading))},dependencies:[i.O5,$.B],encapsulation:2})}return EmailsPopoverBody})();var W=s(61810),ee=s(83348),te=s(66367),se=s(73208),ie=s(78859);function le(e,t){if(1&e&&r._UZ(0,"field-label",4),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function ne(e,t){if(1&e&&(r.ynx(0),r._UZ(1,"system-utility-icon",5)(2,"system-utility-icon",6)(3,"system-utility-icon",7),r.BQk()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("title",e.value)("icon",e.statusicon),r.xp6(1),r.Q6J("title",e.direction)}}function ae(e,t){if(1&e&&r._UZ(0,"system-utility-icon",7)(1,"system-utility-icon",6)(2,"system-utility-icon",5),2&e){const e=r.oxw();r.xp6(1),r.Q6J("title",e.direction),r.xp6(1),r.Q6J("title",e.value)("icon",e.statusicon)}}let oe=(()=>{class fieldEmailStatus extends W.O{model;view;language;metadata;router;constructor(e,t,s,i,l){super(e,t,s,i,l),this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=l}get statusicon(){switch(this.value){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get direction(){return this.model.getField("type")}get directionicon(){switch(this.model.getField("type")){case"inbound":return"back";case"out":return"forward";default:return""}}static ɵfac=function(e){return new(e||fieldEmailStatus)(r.Y36(_.o),r.Y36(x.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(ee.F0))};static ɵcmp=r.Xpm({type:fieldEmailStatus,selectors:[["ng-component"]],features:[r.qOj],decls:5,vars:7,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[4,"ngIf","ngIfElse"],["inbound",""],[3,"fieldname","fieldconfig"],["size","x-small",3,"title","icon"],["size","xx-small","colorclass","slds-icon-text-light","icon","forward",1,"slds-p-horizontal--xx-small",3,"title"],["size","x-small","icon","user","colorclass","slds-icon-text-light"]],template:function(e,t){if(1&e&&(r.YNc(0,le,1,2,"field-label",0),r.TgZ(1,"field-generic-display",1),r.YNc(2,ne,4,3,"ng-container",2),r.YNc(3,ae,3,3,"ng-template",null,3,r.W1O),r.qZA()),2&e){const e=r.MAs(4);r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("fielddisplayclass",t.fielddisplayclass)("editable",!1)("fieldconfig",t.fieldconfig)("fieldid",t.fieldid),r.xp6(1),r.Q6J("ngIf","out"==t.direction)("ngIfElse",e)}},dependencies:[i.O5,te.q,se.D,ie.r],encapsulation:2})}return fieldEmailStatus})(),de=(()=>{class EmailReplyButton{injector;model;metadata;modal;actionconfig;constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailReplyModal",!0,this.injector).subscribe((e=>{null!=this.actionconfig.replymode&&(e.instance.mode=this.actionconfig.replymode)}))}static ɵfac=function(e){return new(e||EmailReplyButton)(r.Y36(r.zs3),r.Y36(_.o),r.Y36(u.Pu),r.Y36(J.o))};static ɵcmp=r.Xpm({type:EmailReplyButton,selectors:[["email-reply-button"]],decls:2,vars:1,consts:[[3,"label"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA()),2&e&&(r.xp6(1),r.Q6J("label",t.actionconfig.label))},dependencies:[E._],encapsulation:2})}return EmailReplyButton})();var ce=s(62422),re=s(75920),me=s(80788),ue=s(2294),he=s(26951),ge=s(11604);let pe=(()=>{class EmailReplyModal{language;metadata;model;parent;view;prefs;modal;session;userpreferences;dockedcomposer;self=null;sending=!1;titlelabel="LBL_EMAIL_REPLY";mode="reply";mailsent=new r.vpe;componentconfig={};constructor(e,t,s,i,l,n,a,o,d,c){this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=a,this.session=o,this.userpreferences=d,this.dockedcomposer=c,this.model.module="Emails",this.view.isEditable=!0,this.view.setEditMode(),this.componentconfig=this.metadata.getComponentConfig("EmailReplyModal",this.model.module)}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1);let e=[];for(let t of this.parent.getField("recipient_addresses"))if("from"==t.address_type){let s={...t};s.address_type="to",s.id="",e.push(s)}else if("replyall"==this.mode&&("cc"==t.address_type||"to"==t.address_type)){let s={...t};s.address_type="cc",s.id="",e.push(s)}this.model.setFields({recipient_addresses:e,reference_id:this.parent.id,name:this.language.getLabel("LBL_RE")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()})}buildHistoryText(){let e=new moment.utc(this.parent.getField("date_sent")).tz(this.session.getSessionData("timezone")||moment.tz.guess(!0)),t=e?e.format(this.userpreferences.getDateFormat()):"",s=e?e.format(this.userpreferences.getTimeFormat()):"",i="";i+="<br><br>",i+="<div data-spice-reply-quote='' class='spicecrm_reply_quote'>",i+="<div dir='ltr' class='crm_attr'>",i+="<b>"+this.language.getLabel("LBL_FROM")+":</b> <a href='mailto:"+this.parent.getField("from_addr")+"'>"+this.parent.getField("from_addr")+"</a>",i+="<br>",i+="<b>"+this.language.getLabel("LBL_DATE_SENT")+":</b> "+t+" "+s,i+="<br>",i+="<b>"+this.language.getLabel("LBL_TO")+":</b> "+this.parent.getField("to_addrs"),i+="<br>",i+="<b>"+this.language.getLabel("LBL_SUBJECT")+":</b> "+this.parent.getField("name"),i+="<br><br>",i+="</div>",i+='<blockquote class="crm_quote" style="margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">';const l=this.parent.getField("body").replace('data-signature=""',"").replace('data-spice-temp-quote=""',"");if(l.startsWith("<html>")){const e=document.createElement("html");e.innerHTML=l;const t=e.getElementsByTagName("body")[0];i+=t?t.innerHTML:l,e.remove()}else i+=l;return i+="</blockquote>",i+="</div>",i}get isDisabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}close(){this.self.destroy()}dock(){this.dockedcomposer.addComposer(this.model.module,this.model),this.close()}sendEmail(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"outbound",to_be_sent:"1",from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe((t=>{e.instance.self.destroy(),this.mailsent.emit(!0),this.close()}),(t=>{e.instance.self.destroy(),this.sending=!1}))}))}handleaction(e){this.close()}static ɵfac=function(e){return new(e||EmailReplyModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(_.o,4),r.Y36(x.e),r.Y36(ce.z),r.Y36(J.o),r.Y36(re.n),r.Y36(ce.z),r.Y36(me.m))};static ɵcmp=r.Xpm({type:EmailReplyModal,selectors:[["email-reply-modal"]],outputs:{mailsent:"mailsent"},features:[r._Bn([x.e,_.o])],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.TgZ(3,"system-modal-header-right")(4,"button",3),r.NdJ("click",(function(){return t.dock()})),r._UZ(5,"system-button-icon",4),r.TgZ(6,"span",5),r._UZ(7,"system-label",6),r.qZA()()()(),r.TgZ(8,"system-modal-content"),r._UZ(9,"system-componentset",7),r.qZA(),r.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.NdJ("actionemitter",(function(e){return t.handleaction(e)})),r.qZA()()()()),2&e&&(r.xp6(2),r.Q6J("label",t.titlelabel),r.xp6(2),r.Q6J("title",t.language.getLabel("LBL_DOCK")),r.xp6(5),r.Q6J("componentset",t.componentconfig.componentset),r.xp6(3),r.Q6J("actionset",t.componentconfig.actionset))},dependencies:[ue.S,Z.J,he.E,E._,q.j,N.x,O.p,U.y,ge.O],encapsulation:2})}return EmailReplyModal})(),fe=(()=>{class EmailForwardButton{injector;model;metadata;modal;actionconfig;constructor(e,t,s,i){this.injector=e,this.model=t,this.metadata=s,this.modal=i}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")}execute(){this.modal.openModal("EmailForwardModal",!0,this.injector)}static ɵfac=function(e){return new(e||EmailForwardButton)(r.Y36(r.zs3),r.Y36(_.o),r.Y36(u.Pu),r.Y36(J.o))};static ɵcmp=r.Xpm({type:EmailForwardButton,selectors:[["ng-component"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_FORWARD"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[E._],encapsulation:2})}return EmailForwardButton})(),be=(()=>{class EmailForwardModal extends pe{language;metadata;model;parent;view;prefs;modal;session;userpreferences;dockedcomposer;modelattachments;backend;titlelabel="LBL_EMAIL_FORWARD";constructor(e,t,s,i,l,n,a,o,d,c,r,m){super(e,t,s,i,l,n,a,o,d,c),this.language=e,this.metadata=t,this.model=s,this.parent=i,this.view=l,this.prefs=n,this.modal=a,this.session=o,this.userpreferences=d,this.dockedcomposer=c,this.modelattachments=r,this.backend=m}ngOnInit(){this.model.initializeModel(this.parent),this.model.startEdit(!1),this.model.setFields({recipient_addresses:[],reference_id:this.parent.id,name:this.language.getLabel("LBL_FW")+this.parent.getField("name"),body:"<br><br><br>"+this.buildHistoryText()}),this.loadParentAttachments()}loadParentAttachments(){this.modelattachments.module="Emails",this.modelattachments.id=this.model.id,this.modelattachments.cloneAttachments(this.parent)}static ɵfac=function(e){return new(e||EmailForwardModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(_.o,4),r.Y36(x.e),r.Y36(ce.z),r.Y36(J.o),r.Y36(re.n),r.Y36(ce.z),r.Y36(me.m),r.Y36(S.H),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailForwardModal,selectors:[["ng-component"]],features:[r._Bn([x.e,_.o,S.H]),r.qOj],decls:13,vars:4,consts:[["size","large"],["module","Emails",3,"close"],[3,"label"],[1,"slds-button","slds-button_icon",3,"title","click"],["icon","dock_panel"],[1,"slds-assistive-text"],["label","LBL_DOCK"],[3,"componentset"],[1,"slds-text-align_right"],["containerclass","",3,"actionset","actionemitter"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.TgZ(3,"system-modal-header-right")(4,"button",3),r.NdJ("click",(function(){return t.dock()})),r._UZ(5,"system-button-icon",4),r.TgZ(6,"span",5),r._UZ(7,"system-label",6),r.qZA()()()(),r.TgZ(8,"system-modal-content"),r._UZ(9,"system-componentset",7),r.qZA(),r.TgZ(10,"system-modal-footer")(11,"div",8)(12,"object-action-container",9),r.NdJ("actionemitter",(function(e){return t.handleaction(e)})),r.qZA()()()()),2&e&&(r.xp6(2),r.Q6J("label",t.titlelabel),r.xp6(2),r.Q6J("title",t.language.getLabel("LBL_DOCK")),r.xp6(5),r.Q6J("componentset",t.componentconfig.componentset),r.xp6(3),r.Q6J("actionset",t.componentconfig.actionset))},dependencies:[ue.S,Z.J,he.E,E._,q.j,N.x,O.p,U.y,ge.O],encapsulation:2})}return EmailForwardModal})();var _e=s(13278);let xe=(()=>{class EmailSendButton{model;metadata;modal;toast;language;actionconfig;actionemitter=new r.vpe;sending=!1;constructor(e,t,s,i,l){this.model=e,this.metadata=t,this.modal=s,this.toast=i,this.language=l}get disabled(){let e=this.model.getFieldValue("recipient_addresses"),t=this.model.getFieldValue("mailbox_id"),s=this.model.getFieldValue("name"),i=this.model.getFieldValue("body"),l=e?e.find((e=>"to"==e.address_type)):void 0;return!(s&&i&&t&&e&&l)||this.sending}execute(){this.modal.openModal("SystemLoadingModal",!1).subscribe((e=>{e.instance.messagelabel="LBL_SENDING",this.sending=!0,this.model.setFields({type:"out",to_be_sent:!0,from_addr:this.model.getField("from_addr_name"),to_addrs:this.model.getField("to_addrs_names"),cc_addrs:this.model.getField("cc_addrs_names")}),this.model.save().subscribe({next:()=>{e.instance.self.destroy(),this.actionemitter.emit("emailsent")},error:t=>{e.instance.self.destroy(),this.toast.sendToast(this.language.getLabel("LBL_ERROR_SENDING_EMAIL"),"error",t.error.error.lbl?this.language.getLabel(t.error.error.lbl):t.error.error.message),this.sending=!1}})}))}static ɵfac=function(e){return new(e||EmailSendButton)(r.Y36(_.o),r.Y36(u.Pu),r.Y36(J.o),r.Y36(_e.A),r.Y36(m.d))};static ɵcmp=r.Xpm({type:EmailSendButton,selectors:[["email-send-button"]],outputs:{actionemitter:"actionemitter"},decls:2,vars:0,consts:[["label","LBL_SEND"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[E._],encapsulation:2})}return EmailSendButton})();var ve=s(42644);let ye=(()=>{class EmailSchedulesButton{language;metadata;model;modellist;modal;injector;toast;hidden=!0;maxCount=50;constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.model=s,this.modellist=i,this.modal=l,this.injector=n,this.toast=a}ngOnInit(){this.findEmailsLink()}get disabled(){return 0==this.modellist.getSelectedCount()||this.modellist.getSelectedCount()>this.maxCount}get exportcount(){let e=this.modellist.getSelectedCount();return e||this.modellist.listData.totalcount}findEmailsLink(){if(!this.metadata.checkModuleAcl("EmailSchedules","create"))return;let e=this.metadata.getModuleFields(this.model.module);for(let t in e){let s=e[t];("emails"==t||"link"==s.type&&"Emails"==s.module)&&(this.hidden=!1)}}execute(){this.model.fields.hasOwnProperty("emails")?this.modal.openModal("EmailSchedulesModal",!0,this.injector):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}static ɵfac=function(e){return new(e||EmailSchedulesButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(ve.t),r.Y36(J.o),r.Y36(r.zs3),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailSchedulesButton,selectors:[["email-schedules-button"]],decls:4,vars:1,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.TgZ(2,"span"),r._uU(3),r.qZA()()),2&e&&(r.xp6(3),r.hij(" (",t.exportcount,")"))},dependencies:[E._],encapsulation:2})}return EmailSchedulesButton})(),Ze=(()=>{class EmailSchedulesCancelButton{model;modal;backend;actionemitter=new r.vpe;constructor(e,t,s){this.model=e,this.modal=t,this.backend=s}get disabled(){return!this.model.checkAccess("edit")||"open"!=this.model.getField("email_schedule_status")}execute(){this.modal.confirm("MSG_CANCEL_EMAILSCHEDULE","MSG_CANCEL_EMAILSCHEDULE").subscribe((e=>{e&&this.backend.putRequest(`module/EmailSchedules/${this.model.id}/cancel`).subscribe((e=>{this.model.setField("email_schedule_status","cancelled"),this.actionemitter.emit("save")}))}))}static ɵfac=function(e){return new(e||EmailSchedulesCancelButton)(r.Y36(_.o),r.Y36(J.o),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailSchedulesCancelButton,selectors:[["email-schedules-cancel-button"]],outputs:{actionemitter:"actionemitter"},decls:1,vars:0,consts:[["label","LBL_CANCEL"]],template:function(e,t){1&e&&r._UZ(0,"system-label",0)},dependencies:[E._],encapsulation:2})}return EmailSchedulesCancelButton})();var Ee=s(82995);let Le=(()=>{class EmailSchedulesModal{language;model;parentModel;injector;view;modal;metadata;modellist;backend;toast;self={};constructor(e,t,s,i,l,n,a,o,d,c){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=a,this.modellist=o,this.backend=d,this.toast=c,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1)}close(){this.self.destroy()}get canSave(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}saveSchedule(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t=this.modellist.getSelectedIDs(),s={module:this.modellist.module,ids:t,data:this.model.data,modulefilter:this.modellist.modulefilter,searchterm:this.modellist.searchTerm,aggregates:this.modellist.selectedAggregates};this.backend.postRequest(`module/EmailSchedules/${this.model.id}`,{},s).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}static ɵfac=function(e){return new(e||EmailSchedulesModal)(r.Y36(m.d),r.Y36(_.o),r.Y36(_.o,4),r.Y36(r.zs3),r.Y36(x.e),r.Y36(J.o),r.Y36(u.Pu),r.Y36(ve.t),r.Y36(v.y),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailSchedulesModal,selectors:[["email-schedules-modal"]],features:[r._Bn([_.o,x.e])],decls:11,vars:3,consts:[["title","LBL_EMAIL_SCHEDULES"],[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","none",3,"grow"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-button","slds-button--brand",3,"disabled","click"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.qZA(),r.TgZ(3,"system-modal-content",3),r._UZ(4,"system-dynamic-component",4)(5,"system-dynamic-component",5),r.qZA(),r.TgZ(6,"system-modal-footer")(7,"button",6),r.NdJ("click",(function(){return t.sendTestEmail()})),r._UZ(8,"system-label",7),r.qZA(),r.TgZ(9,"button",8),r.NdJ("click",(function(){return t.saveSchedule()})),r._UZ(10,"system-label",2),r.qZA()()()),2&e&&(r.xp6(3),r.Q6J("grow",!0),r.xp6(4),r.Q6J("disabled",!t.canSave),r.xp6(2),r.Q6J("disabled",!t.canSave))},dependencies:[Ee.T,E._,q.j,N.x,O.p,U.y],encapsulation:2})}return EmailSchedulesModal})();var we=s(77579);let Te=(()=>{class EmailSchedulesRelatedButton{language;metadata;model;modal;injector;backend;toast;linkedBeans=[];modelId;currentModule;constructor(e,t,s,i,l,n,a){this.language=e,this.metadata=t,this.model=s,this.modal=i,this.injector=l,this.backend=n,this.toast=a}execute(){let e=this.modal.await(this.language.getLabel("LBL_LOADING"));this.checkEmailsLink().subscribe((t=>{e.emit(!0),t&&this.modal.openModal("EmailSchedulesRelatedModal",!0,this.injector).subscribe((e=>{e.instance.linkedBeans=this.linkedBeans,e.instance.modelId=this.modelId,e.instance.currentModule=this.model.module}))}))}checkEmailsLink(){let e=new we.x,t=[];Object.keys(this.model.fields).forEach((e=>{if("link"==this.model.fields[e].type){let s=this.model.fields[e].name;for(let e in this.metadata.fieldDefs)e.toLowerCase()==s&&t.push(e)}}));let s=[];for(let e in t){let i=t[e];Object.keys(this.metadata.fieldDefs).forEach((e=>{null!=this.metadata.fieldDefs[e]&&e==i&&(this.metadata.fieldDefs[e].hasOwnProperty("email")||this.metadata.fieldDefs[e].hasOwnProperty("email1"))&&s.push(i)}))}let i={modules:s};return this.backend.getRequest(`module/EmailSchedules/${this.model.module}/${this.model.id}`,i).subscribe((t=>{t.status?(this.linkedBeans=t.linkedBeans,this.modelId=t.beanId,e.next(t.status)):(e.next(!1),this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error"));for(let e in this.linkedBeans){let t=this.linkedBeans[e];t.vname=this.model.fields[t.link].vname}e.complete()})),e.asObservable()}static ɵfac=function(e){return new(e||EmailSchedulesRelatedButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(J.o),r.Y36(r.zs3),r.Y36(v.y),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailSchedulesRelatedButton,selectors:[["email-schedules-related-button"]],decls:2,vars:0,consts:[["label","LBL_EMAIL_SCHEDULE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[E._],encapsulation:2})}return EmailSchedulesRelatedButton})();var Me=s(7514),Ae=s(44561),ke=s(50151);function Ce(e,t){1&e&&(r.TgZ(0,"div",41),r._uU(1,"("),r._UZ(2,"system-label",42),r._uU(3,")"),r.qZA())}function Fe(e,t){if(1&e&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.hij("(",e.email1,")")}}const Je=function(e){return{"slds-text-color--inverse-weak":e}},Ye=function(e){return{"text-decoration":e}};function Be(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"tr"),r._UZ(1,"td"),r.TgZ(2,"td",43)(3,"div",44)(4,"div"),r._uU(5),r.qZA(),r.YNc(6,Fe,2,1,"div",23),r.qZA()(),r.TgZ(7,"td",33),r._UZ(8,"system-utility-icon",45),r.qZA(),r.TgZ(9,"td",34)(10,"button",46)(11,"system-button-icon",47),r.NdJ("click",(function(){const t=r.CHM(e).index,s=r.oxw(2).$implicit,i=r.oxw();return r.KtG(i.removeBean(s,t))})),r.qZA()()()()}if(2&e){const e=t.$implicit;r.xp6(2),r.Q6J("ngClass",r.VKq(6,Je,e.deleted))("ngStyle",r.VKq(8,Ye,e.deleted?"line-through":"inherit")),r.xp6(3),r.Oqu(e.summary_text),r.xp6(1),r.Q6J("ngIf",e.email1),r.xp6(2),r.Q6J("icon","link"==e.source?"linked":"user"),r.xp6(3),r.Q6J("icon",!0===e.deleted?"undo":"delete")}}function Se(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Be,12,10,"tr",21),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.Q6J("ngForOf",e.linkedbeans)}}const qe=function(e){return{"slds-disabled-text":e}};function Ne(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"tr",27)(2,"td")(3,"system-checkbox",28),r.NdJ("ngModelChange",(function(t){const s=r.CHM(e).$implicit;return r.KtG(s.selected=t)})),r.qZA()(),r.TgZ(4,"td")(5,"div",29)(6,"div",16),r._UZ(7,"system-icon",30),r.qZA(),r.TgZ(8,"div",16),r._UZ(9,"system-label-modulename",31),r.qZA(),r.YNc(10,Ce,4,0,"div",32),r.qZA()(),r.TgZ(11,"td",33)(12,"div",29)(13,"div",16),r._uU(14),r.qZA()()(),r.TgZ(15,"td",34)(16,"button",35),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw();return r.KtG(s.expandRelated(t))})),r._UZ(17,"system-button-icon",36),r.qZA(),r.TgZ(18,"button",37),r.NdJ("click",(function(){const t=r.CHM(e).$implicit;return r.KtG(t.open=!t.open)})),r._UZ(19,"system-button-icon",38),r.qZA(),r.TgZ(20,"button",39)(21,"system-button-icon",40),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw();return r.KtG(s.addBean(t))})),r.qZA()()()(),r.YNc(22,Se,2,1,"ng-container",23),r.BQk()}if(2&e){const e=t.$implicit,s=r.oxw();r.xp6(1),r.Q6J("ngClass",r.VKq(15,qe,e.disabled&&(!e.linkedbeans||0==e.linkedbeans.length))),r.xp6(2),r.Q6J("disabled",e.disabled||e.expanded)("ngModel",e.selected),r.xp6(4),r.Q6J("addclasses",!e.disabled||e.linkedbeans&&0!=e.linkedbeans.length?null:"slds-icon_disabled")("size","small")("module",e.module),r.xp6(2),r.Q6J("module",e.module),r.xp6(1),r.Q6J("ngIf",e.count>s.maxCount),r.xp6(4),r.AsE("",s.getLinkCount(e)," / ",e.count,""),r.xp6(2),r.Q6J("disabled",e.expanded||0==e.count||e.count>s.maxCount),r.xp6(2),r.Q6J("disabled",!e.linkedbeans),r.xp6(1),r.Q6J("icon",!0===e.open?"up":"down"),r.xp6(1),r.Q6J("disabled",e.count>s.maxCount),r.xp6(2),r.Q6J("ngIf",!0===e.open)}}function Oe(e,t){1&e&&(r.TgZ(0,"div"),r._UZ(1,"system-label",42),r.qZA())}const Ue=function(e){return{"slds-is-active":e}},Ie=function(e){return{"slds-hide":e}};let Qe=(()=>{class EmailSchedulesRelatedModal{language;model;parentModel;injector;view;modal;metadata;backend;toast;self={};activetab="recipients";linkedBeans=[];modelId;currentModule;maxCount=50;constructor(e,t,s,i,l,n,a,o,d){this.language=e,this.model=t,this.parentModel=s,this.injector=i,this.view=l,this.modal=n,this.metadata=a,this.backend=o,this.toast=d,this.view.isEditable=!0,this.view.setEditMode()}ngOnInit(){this.model.module="EmailSchedules",this.model.initialize(this.parentModel),this.model.setFields({parent_id:this.parentModel.id,parent_type:this.parentModel.module}),this.model.startEdit(!1),this.fiilterProspects()}fiilterProspects(){this.linkedBeans=this.linkedBeans.map((e=>(e.disabled=0==e.count||e.count>this.maxCount,e.selected=!1,e.expanded=!1,e)))}close(){this.self.destroy()}get canSchedule(){if(!this.model.getField("mailbox_id")||!this.model.getField("email_subject"))return!1;let e=this.selectedCount;return!(0==e||e>this.maxCount)}get selectedCount(){let e=0;return this.linkedBeans.forEach((t=>{t.selected?e+=t.count:t.linkedbeans&&(e+=t.linkedbeans.filter((e=>!e.deleted)).length)})),e}saveSchedule(){this.canSchedule&&this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={links:this.linkedBeans.filter((e=>e.selected)).map((e=>e.module)),data:this.model.data,linkedbeans:this.linkedbeans};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/${this.parentModel.module}/${this.parentModel.id}`,{},t).subscribe((t=>{e.instance.self.destroy(),t.status?(this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"),this.close()):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}get linkedbeans(){let e={};for(let t of this.linkedBeans){if(!t.linkedbeans)continue;let s=t.linkedbeans.filter((e=>!e.deleted)).map((e=>e.id));s.length>0&&(e[t.module]=s)}return e}getLinkCount(e){if(e.expanded)return e.linkedbeans?e.linkedbeans.filter((e=>!e.deleted)).length:0;let t=e.selected?parseInt(e.count,10):0;return e.linkedbeans&&(t+=e.linkedbeans.length),t}expandRelated(e){if(e.expanded)e.open=!e.open;else{let t=this.modal.await("LBL_LOADING");e.selected=!1,e.expanded=!0,this.backend.getRequest(`module/${this.parentModel.module}/${this.parentModel.id}/related/${e.link}`,{getcount:0,excludeinactive:1,offset:0,limit:100}).subscribe((s=>{e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let t in s)s[t].source="link",s[t].deleted=!1,e.linkedbeans.push(s[t]);this.sortLinkedBeans(e),t.emit(!0)}),(()=>{this.toast.sendToast("LBL_ERROR","error"),t.emit(!0)}))}}addBean(e){this.modal.openModal("ObjectModalModuleLookup").subscribe((t=>{t.instance.module=e.module,t.instance.multiselect=!0,t.instance.selectedItems.subscribe((t=>{if(t.length){e.open=!0,e.linkedbeans||(e.linkedbeans=[]);for(let s of t)-1==e.linkedbeans.findIndex((e=>e.id==s.id))&&(s.source="user",e.linkedbeans.push(s));this.sortLinkedBeans(e)}}))}))}sortLinkedBeans(e){e.linkedbeans.sort(((e,t)=>e.last_name?e.last_name.localeCompare(t.last_name):e.summary_text.localeCompare(t.summary_text)))}removeBean(e,t){"link"==e.linkedbeans[t].source?e.linkedbeans[t].deleted=!e.linkedbeans[t].deleted:e.linkedbeans.splice(t,1)}get canSendTest(){return this.model.getField("mailbox_id")&&this.model.getField("email_subject")&&this.model.getField("email_body")}sendTestEmail(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{e.instance.messagelabel="LBL_LOADING";let t={parent_id:this.model.data.parent_id,email_subject:this.model.data.email_subject,email_body:this.model.data.email_body,mailbox_id:this.model.data.mailbox_id};this.backend.postRequest(`module/EmailSchedules/${this.model.id}/sendtest`,{},t).subscribe((t=>{e.instance.self.destroy(),t.success?this.toast.sendToast(this.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):this.toast.sendToast(this.language.getLabel("LBL_ERROR"),"error")}))}))}static ɵfac=function(e){return new(e||EmailSchedulesRelatedModal)(r.Y36(m.d),r.Y36(_.o),r.Y36(_.o,4),r.Y36(r.zs3),r.Y36(x.e),r.Y36(J.o),r.Y36(u.Pu),r.Y36(v.y),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailSchedulesRelatedModal,selectors:[["email-schedules-related-modal"]],features:[r._Bn([_.o,x.e])],decls:36,vars:18,consts:[[3,"close"],["label","LBL_EMAIL_SCHEDULE"],["margin","x-small"],[1,"slds-tabs_scoped"],["role","tablist",1,"slds-tabs_scoped__nav"],["title","Emails","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["href","javascript:void(0);","role","tab",1,"slds-tabs_scoped__link",3,"click"],["title","Recipients","role","presentation",1,"slds-tabs_scoped__item",3,"ngClass"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small",2,"height","70vh",3,"ngClass"],["component","CampaignTaskEmailPanel"],["component","SpiceAttachmentsPanel"],["role","tabpanel",1,"slds-tabs_scoped__content","slds-p-around--xx-small","slds-scrollable--y",2,"height","70vh",3,"ngClass"],[1,"slds-table","slds-box--border"],[1,"slds-text-title_caps"],["scope","col",2,"width","2rem"],["scope","col",1,"slds-resizable"],[1,"slds-truncate"],["label","LBL_LINK"],["scope","col",1,"slds-text-align--center",2,"width","5rem"],["label","LBL_COUNT"],["scope","col",2,"width","4rem"],[4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid--vertical-align-center"],[4,"ngIf"],[1,"slds-button","slds-col--bump-left","slds-button--neutral",3,"disabled","click"],["label","LBL_SEND_TEST_EMAIL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],[3,"ngClass"],[3,"disabled","ngModel","ngModelChange"],[1,"slds-grid","slds-grid--vertical-align-center","slds-p-around--xx-small"],[3,"addclasses","size","module"],[3,"module"],["class","slds-truncate slds-p-horizontal--x-small",4,"ngIf"],[1,"slds-text-align--center"],[1,"slds-text-align--right"],["system-title","LBL_EXPAND",1,"slds-button","slds-button--icon",3,"disabled","click"],["icon","expand_all"],["system-title","LBL_TOGGLE",1,"slds-button","slds-button--icon",3,"disabled","click"],[3,"icon"],["system-title","LBL_ADD",1,"slds-button","slds-button--icon",3,"disabled"],["icon","new",3,"click"],[1,"slds-truncate","slds-p-horizontal--x-small"],["label","LBL_MAX50RECORDS"],[3,"ngClass","ngStyle"],[1,"slds-grid","slds-grid--align-spread"],["size","xx-small",3,"icon"],["system-title","LBL_DELETE",1,"slds-button","slds-button--icon"],[3,"icon","click"]],template:function(e,t){1&e&&(r.TgZ(0,"system-modal")(1,"system-modal-header",0),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",1),r.qZA(),r.TgZ(3,"system-modal-content",2)(4,"div",3)(5,"ul",4)(6,"li",5)(7,"a",6),r.NdJ("click",(function(){return t.activetab="emails"})),r._uU(8),r.qZA()(),r.TgZ(9,"li",7)(10,"a",6),r.NdJ("click",(function(){return t.activetab="recipients"})),r._uU(11),r.qZA()()(),r.TgZ(12,"div",8),r._UZ(13,"system-dynamic-component",9)(14,"system-dynamic-component",10),r.qZA(),r.TgZ(15,"div",11)(16,"table",12)(17,"thead")(18,"tr",13),r._UZ(19,"th",14),r.TgZ(20,"th",15)(21,"div",16),r._UZ(22,"system-label",17),r.qZA()(),r.TgZ(23,"th",18)(24,"div",16),r._UZ(25,"system-label",19),r.qZA()(),r._UZ(26,"th",20),r.qZA()(),r.TgZ(27,"tbody"),r.YNc(28,Ne,23,17,"ng-container",21),r.qZA()()()()(),r.TgZ(29,"system-modal-footer")(30,"div",22),r.YNc(31,Oe,2,0,"div",23),r.TgZ(32,"button",24),r.NdJ("click",(function(){return t.sendTestEmail()})),r._UZ(33,"system-label",25),r.qZA(),r.TgZ(34,"button",26),r.NdJ("click",(function(){return t.saveSchedule()})),r._UZ(35,"system-label",1),r.qZA()()()()),2&e&&(r.xp6(6),r.Q6J("ngClass",r.VKq(10,Ue,"emails"==t.activetab)),r.xp6(2),r.Oqu(t.language.getLabel("LBL_EMAILS")),r.xp6(1),r.Q6J("ngClass",r.VKq(12,Ue,"recipients"==t.activetab)),r.xp6(2),r.Oqu(t.language.getLabel("LBL_RECIPIENTS")),r.xp6(1),r.Q6J("ngClass",r.VKq(14,Ie,"emails"!=t.activetab)),r.xp6(3),r.Q6J("ngClass",r.VKq(16,Ie,"recipients"!=t.activetab)),r.xp6(13),r.Q6J("ngForOf",t.linkedBeans),r.xp6(3),r.Q6J("ngIf",t.selectedCount>t.maxCount),r.xp6(1),r.Q6J("disabled",!t.canSendTest),r.xp6(2),r.Q6J("disabled",!t.canSchedule))},dependencies:[i.mk,i.sg,i.O5,i.PC,l.JJ,l.On,Z.J,Me.U,Ee.T,Ae.f,E._,L.M,q.j,N.x,O.p,U.y,ie.r,ke.S],encapsulation:2})}return EmailSchedulesRelatedModal})();var Re=s(84567),je=s(64730),De=s(54021);function He(e,t){if(1&e&&(r.TgZ(0,"tr",14)(1,"td")(2,"div",10),r._uU(3),r.qZA()(),r.TgZ(4,"td")(5,"div",10),r._uU(6),r.qZA()(),r.TgZ(7,"td")(8,"div",10),r._uU(9),r.qZA()()()),2&e){const e=t.$implicit;r.xp6(3),r.Oqu(e.id),r.xp6(3),r.Oqu(e.subject),r.xp6(3),r.Oqu(e.status)}}function Pe(e,t){if(1&e&&(r.TgZ(0,"table",8)(1,"thead")(2,"tr",9)(3,"th")(4,"div",10),r._uU(5,"Id"),r.qZA()(),r.TgZ(6,"th")(7,"div",10),r._UZ(8,"system-label",11),r.qZA()(),r.TgZ(9,"th")(10,"div",10),r._UZ(11,"system-label",12),r.qZA()()()(),r.TgZ(12,"tbody"),r.YNc(13,He,10,3,"tr",13),r.qZA()()),2&e){const e=r.oxw();r.xp6(13),r.Q6J("ngForOf",e.emailschedules)}}function ze(e,t){1&e&&(r.TgZ(0,"div",15)(1,"system-illustration-no-records"),r._UZ(2,"system-label",16),r.qZA()())}function Ge(e,t){1&e&&(r.TgZ(0,"div",15)(1,"system-illustration-no-access"),r._UZ(2,"system-label",17),r.qZA()())}let $e=(()=>{class EmailSchedulesView{language;model;view;metadata;backend;emailschedules=[];locked=!1;isLoading=!1;constructor(e,t,s,i,l){this.language=e,this.model=t,this.view=s,this.metadata=i,this.backend=l,this.getData()}refresh(){this.getData()}getData(){this.isLoading=!0,this.backend.getRequest(`module/EmailSchedules/myopen/${this.model.id}`).subscribe((e=>{e.status?(this.isLoading=!1,this.emailschedules=e.openschedules):this.locked=!0}))}static ɵfac=function(e){return new(e||EmailSchedulesView)(r.Y36(m.d),r.Y36(_.o),r.Y36(x.e),r.Y36(u.Pu),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailSchedulesView,selectors:[["email-schedules-view"]],features:[r._Bn([x.e])],decls:10,vars:8,consts:[[3,"system-overlay-loading-spinner"],[1,"slds-grid","slds-p-around--small",2,"align-items","center"],[1,"slds-col","slds-grow-none",3,"module","title"],[1,"slds-grow"],[1,"slds-col--bump-left","slds-button","slds-button--icon","slds-button--icon-border",3,"disabled","click"],["icon","refresh"],["width","100%","class","slds-table slds-table_cell-buffer slds-table_bordered",4,"ngIf"],["class","slds-align--absolute-center slds-m-around--large",4,"ngIf"],["width","100%",1,"slds-table","slds-table_cell-buffer","slds-table_bordered"],[1,"slds-line-height_reset"],[1,"slds-truncate"],["label","LBL_SUBJECT"],["label","LBL_STATUS"],["class","slds-hint-parent",4,"ngFor","ngForOf"],[1,"slds-hint-parent"],[1,"slds-align--absolute-center","slds-m-around--large"],["label","MSG_NO_RECORDS_FOUND"],["label","LBL_NO_ACCESS"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r._UZ(2,"system-icon",2),r.TgZ(3,"h2",3),r._uU(4),r.qZA(),r.TgZ(5,"button",4),r.NdJ("click",(function(){return t.getData()})),r._UZ(6,"system-button-icon",5),r.qZA()(),r.YNc(7,Pe,14,1,"table",6),r.YNc(8,ze,3,0,"div",7),r.YNc(9,Ge,3,0,"div",7),r.qZA()),2&e&&(r.Q6J("system-overlay-loading-spinner",t.isLoading),r.xp6(2),r.Q6J("module","EmailSchedules")("title","EmailSchedules"),r.xp6(2),r.Oqu(t.language.getModuleName("EmailSchedules")),r.xp6(1),r.Q6J("disabled",t.isLoading),r.xp6(2),r.Q6J("ngIf",t.emailschedules.length>0),r.xp6(1),r.Q6J("ngIf",0==t.emailschedules.length&&!t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.isLoading&&t.locked))},dependencies:[i.sg,i.O5,Z.J,Ae.f,Re.s,je.C,E._,De._],encapsulation:2})}return EmailSchedulesView})();var Ke=s(50727),Xe=s(42161),Ve=s(31790);const We=function(e,t){return{module:e,data:t}};function et(e,t){if(1&e&&(r.TgZ(0,"tr",9)(1,"td")(2,"div",10),r._UZ(3,"system-icon",11),r.TgZ(4,"div",3),r._uU(5),r.qZA()()(),r.TgZ(6,"td")(7,"div",3),r._uU(8),r.qZA()()()),2&e){const e=t.$implicit,s=r.oxw();r.Q6J("system-model-provider",r.WLB(4,We,e.module,e.data)),r.xp6(3),r.Q6J("module",e.module),r.xp6(2),r.Oqu(e.summary_text),r.xp6(3),r.hij(" ",s.getValue(e.status),"")}}function tt(e,t){1&e&&r._UZ(0,"tbody",12),2&e&&r.Q6J("rows",10)}let st=(()=>{class EmailSchedulesBeans{model;metadata;language;backend;beans;loading=!1;loadedStatus;subscriptions=new Ke.w0;constructor(e,t,s,i){this.model=e,this.metadata=t,this.language=s,this.backend=i,this.subscriptions.add(this.model.data$.subscribe((e=>{this.getData()})))}ngOnDestroy(){this.subscriptions.unsubscribe()}getValue(e){try{return this.language.languagedata.applist.emailschedule_status_dom[e]?this.language.languagedata.applist.emailschedule_status_dom[e]:e}catch(t){return e}}getData(){!this.model.getField("email_schedule_status")||this.loadedStatus&&this.loadedStatus==this.model.getField("email_schedule_status")||(this.beans=[],this.loading=!0,this.loadedStatus=this.model.getField("email_schedule_status"),this.backend.getRequest(`module/EmailSchedules/${this.model.id}/beans`).subscribe((e=>{this.beans=e,this.loading=!1})))}static ɵfac=function(e){return new(e||EmailSchedulesBeans)(r.Y36(_.o),r.Y36(u.Pu),r.Y36(m.d),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailSchedulesBeans,selectors:[["email-schedules-beans"]],decls:12,vars:2,consts:[[1,"slds-table","slds-table--fixed-layout","slds-table_bordered","slds-box--border"],[1,"slds-line-height_reset"],["scope","col",2,"width","99%"],[1,"slds-truncate"],["label","LBL_NAME"],["scope","col",2,"width","5rem"],["label","LBL_STATUS"],["class","slds-hint-parent",3,"system-model-provider",4,"ngFor","ngForOf"],["system-table-stencils","","columns","2",3,"rows",4,"ngIf"],[1,"slds-hint-parent",3,"system-model-provider"],["system-model-popover","",1,"slds-grid","slds-grid--vertical-align-center"],["size","x-small",3,"module"],["system-table-stencils","","columns","2",3,"rows"]],template:function(e,t){1&e&&(r.TgZ(0,"table",0)(1,"thead")(2,"tr",1)(3,"th",2)(4,"div",3),r._UZ(5,"system-label",4),r.qZA()(),r.TgZ(6,"th",5)(7,"div",3),r._UZ(8,"system-label",6),r.qZA()()()(),r.TgZ(9,"tbody"),r.YNc(10,et,9,7,"tr",7),r.qZA(),r.YNc(11,tt,1,1,"tbody",8),r.qZA()),2&e&&(r.xp6(10),r.Q6J("ngForOf",t.beans),r.xp6(1),r.Q6J("ngIf",t.loading))},dependencies:[i.sg,i.O5,Ae.f,E._,Xe.x,Ve.g,w.u],encapsulation:2})}return EmailSchedulesBeans})();function it(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",1),r.qZA())}let lt=(()=>{class EmailActionSetReadButton{language;metadata;model;displayasicon=!1;constructor(e,t,s){this.language=e,this.metadata=t,this.model=s}get hidden(){return!("unread"==this.model.getFieldValue("status")||!this.model.isEditing)}get disabled(){return!this.model.checkAccess("edit")||(this.model.isEditing||this.model.isSaving)}execute(){this.model.setField("status","read")}static ɵfac=function(e){return new(e||EmailActionSetReadButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o))};static ɵcmp=r.Xpm({type:EmailActionSetReadButton,selectors:[["email-action-set-read-button"]],decls:1,vars:1,consts:[[4,"ngIf"],["label","LBL_SET_READ"]],template:function(e,t){1&e&&r.YNc(0,it,2,0,"span",0),2&e&&r.Q6J("ngIf",!t.displayasicon)},dependencies:[i.O5,E._],encapsulation:2})}return EmailActionSetReadButton})();var nt=s(33634),at=s(15861),ot=s(12646),dt=s(6271);function ct(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",4)(1,"div",19)(2,"span",20)(3,"span",21),r._UZ(4,"system-icon",22),r.qZA(),r.TgZ(5,"span",23),r._uU(6),r.qZA(),r.TgZ(7,"button",24),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.clearSelectedItem())})),r._UZ(8,"system-button-icon",25),r.qZA()()()()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("module",e.previewForBean),r.xp6(2),r.hij(" ",e.selectedItem.text," "),r.xp6(2),r.Q6J("icon","close")}}function rt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",26),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.searchWithModal())})),r._UZ(1,"input",27),r.TgZ(2,"button",28),r._UZ(3,"system-button-icon",29),r.qZA()()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("disabled",!e.previewForBean)("placeholder",e.placeholder),r.xp6(1),r.Q6J("disabled",!e.previewForBean)}}function mt(e,t){if(1&e&&(r.TgZ(0,"div",30)(1,"div",31),r._UZ(2,"div",32),r.TgZ(3,"span",33),r._uU(4),r.qZA()(),r._UZ(5,"iframe",34),r.qZA()),2&e){const e=r.oxw();r.Udp("width",e.viewType.width,"px"),r.xp6(4),r.hij(" ",e.viewType.width,"px "),r.xp6(1),r.Q6J("src",e.parsedHtml,r.uOi)}}function ut(e,t){1&e&&(r.TgZ(0,"div",35)(1,"system-illustration-no-data"),r._UZ(2,"system-label",36),r.qZA()())}let ht=(()=>{class EmailTemplatesPreview{language;backend;metadata;model;modal;toast;sanitizer;cdRef;viewTypeOptions=[{title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024},{title:"LBL_TABLET",icon:"tablet_portrait",value:"tablet",width:768},{title:"LBL_MOBILE",icon:"phone_portrait",value:"mobile",width:320}];viewType={title:"LBL_DESKTOP",icon:"desktop",value:"desktop",width:1024};subscription=new Ke.w0;selectedItem;placeholder;parsedHtml;bodyHtmlField="body_html";previewForBean;constructor(e,t,s,i,l,n,a,o){this.language=e,this.backend=t,this.metadata=s,this.model=i,this.modal=l,this.toast=n,this.sanitizer=a,this.cdRef=o}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnDestroy(){this.subscription.unsubscribe()}subscribeToModelChanges(){this.subscription.add(this.model.data$.subscribe((()=>{this.setPlaceholder(),this.selectedItem&&this.selectedItem.module==this.previewForBean||this.clearSelectedItem()})))}setPlaceholder(){this.placeholder=this.previewForBean?this.language.getModuleCombinedLabel("LBL_SEARCH",this.previewForBean):this.language.getLabel("LBL_SEARCH"),this.cdRef.detectChanges()}searchWithModal(){this.previewForBean&&this.modal.openModal("ObjectModalModuleLookup").subscribe((e=>{e.instance.module=this.previewForBean,e.instance.multiselect=!1,this.subscription.add(e.instance.selectedItems.subscribe((e=>{e&&e.length&&(this.selectedItem={id:e[0].id,text:e[0].summary_text,module:this.previewForBean},this.compileBody())})))}))}clearSelectedItem(){this.selectedItem=void 0,this.parsedHtml=void 0,this.cdRef.detectChanges()}compileBody(){var e=this;return(0,at.Z)((function*(){if(!e.model.id)return;const t=e.modal.await("LBL_PARSING_HTML"),s={html:e.model.getField(e.bodyHtmlField),field:e.bodyHtmlField};e.backend.postRequest(`module/${e.model.module}/${e.model.id}/livecompile/${e.previewForBean}/${e.selectedItem.id}`,{},s).subscribe({next:s=>{if(!s||!s.html)return t.emit(!1),t.unsubscribe();e.parsedHtml=e.sanitizer.bypassSecurityTrustResourceUrl("data:text/html;charset=UTF-8,"+encodeURIComponent(s.html)),e.cdRef.detectChanges(),t.emit(!0),t.unsubscribe()},error:()=>{e.toast.sendToast(e.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),t.emit(!1),t.unsubscribe()}})}))()}setViewType(e){this.viewType=this.viewTypeOptions.find((t=>t.value==e))}static ɵfac=function(e){return new(e||EmailTemplatesPreview)(r.Y36(m.d),r.Y36(v.y),r.Y36(u.Pu),r.Y36(_.o),r.Y36(J.o),r.Y36(_e.A),r.Y36(B.H7),r.Y36(r.sBO))};static ɵcmp=r.Xpm({type:EmailTemplatesPreview,selectors:[["email-templates-preview"]],inputs:{bodyHtmlField:"bodyHtmlField",previewForBean:"previewForBean"},decls:20,vars:7,consts:[[1,"slds-grid","slds-grid--vertical-align-end","slds-gutters_direct-xx-small"],[1,"slds-col","slds-grow","slds-form-element"],[1,"slds-form-element__label"],["label","LBL_RECORD"],[1,"slds-form-element__control"],[1,"slds-combobox_container"],["aria-expanded","false","aria-haspopup","listbox","role","combobox",1,"slds-combobox","slds-dropdown-trigger","slds-dropdown-trigger_click"],[1,"slds-form-element__control","slds-box--border"],["class","slds-form-element__control",4,"ngIf"],["class","slds-input-has-icon slds-input-has-icon--right slds-grow",3,"click",4,"ngIf"],[1,"slds-button","slds-button--icon-border","slds-m-horizontal--xx-small",3,"disabled","click"],["icon","refresh"],[1,"slds-form-element"],["label","LBL_DISPLAY"],[1,"slds-form-element__control","slds-p-top--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-m-top--small","slds-border--top","slds-border--right","slds-border--left","slds-border--bottom","slds-grid","slds-p-around--xx-small","slds-grid","slds-grid--align-center","slds-grow",2,"min-height","0"],["class","slds-grid slds-grid--vertical slds-height_full",3,"width",4,"ngIf"],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],[1,"slds-pill_container"],[1,"slds-pill","slds-size--1-of-1"],[1,"slds-icon_container","slds-icon-standard-account","slds-pill__icon_container"],["size","small",3,"module"],[1,"slds-pill__label"],[1,"slds-button","slds-button--icon","slds-pill__remove",3,"click"],[3,"icon"],[1,"slds-input-has-icon","slds-input-has-icon--right","slds-grow",3,"click"],["type","text","role","combobox",1,"slds-lookup__search-input","slds-input--bare","slds-input",3,"disabled","placeholder"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled"],["icon","search"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],[1,"slds-size--1-of-1","slds-grid","slds-grid--vertical-align-center","slds-is-relative","slds-m-vertical--xx-small",2,"height","16px","border-left","1px solid #aaa","border-right","1px solid #aaa"],[2,"height","1px","width","100%","background","#aaa"],[1,"slds-theme--default","slds-p-horizontal--xx-small","slds-is-absolute",2,"left","50%","transform","translateX(-50%)"],["sandbox","",1,"slds-grow",2,"border","0","min-height","250px",3,"src"],[1,"slds-align--absolute-center","slds-height_full"],["label","MSG_NO_RECORD_SELECTED"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"label",2),r._UZ(3,"system-label",3),r.qZA(),r.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),r.YNc(8,ct,9,3,"div",8),r.YNc(9,rt,4,3,"div",9),r.qZA()()()()(),r.TgZ(10,"button",10),r.NdJ("click",(function(){return t.compileBody()})),r._UZ(11,"system-button-icon",11),r.qZA(),r.TgZ(12,"div",12)(13,"label",2),r._UZ(14,"system-label",13),r.qZA(),r.TgZ(15,"div",14)(16,"system-input-radio-button-group",15),r.NdJ("ngModelChange",(function(e){return t.setViewType(e)})),r.qZA()()()(),r.TgZ(17,"div",16),r.YNc(18,mt,6,4,"div",17),r.YNc(19,ut,3,0,"div",18),r.qZA()),2&e&&(r.xp6(8),r.Q6J("ngIf",t.selectedItem),r.xp6(1),r.Q6J("ngIf",!t.selectedItem),r.xp6(1),r.Q6J("disabled",!t.selectedItem),r.xp6(6),r.Q6J("ngModel",t.viewType.value)("inputOptions",t.viewTypeOptions),r.xp6(2),r.Q6J("ngIf",t.parsedHtml),r.xp6(1),r.Q6J("ngIf",!t.selectedItem))},dependencies:[i.O5,l.JJ,l.On,Z.J,Ae.f,ot.t,dt.p,E._],encapsulation:2,changeDetection:0})}return EmailTemplatesPreview})();function gt(e,t){1&e&&r.GkF(0)}function pt(e,t){if(1&e&&(r.ynx(0),r.YNc(1,gt,1,0,"ng-container",18),r.BQk()),2&e){r.oxw();const e=r.MAs(20);r.xp6(1),r.Q6J("ngTemplateOutlet",e)}}function ft(e,t){if(1&e&&r._UZ(0,"field-container",26),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.subjectField)}}const bt=function(){return{fieldtype:"mailboxes",scope:"outboundmass"}};function _t(e,t){if(1&e&&r._UZ(0,"field-container",27),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.mailboxField)("fieldconfig",r.DdM(2,bt))}}const xt=function(){return{fieldtype:"richtext",hidelabel:!0}};function vt(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,xt))}}const yt=function(e){return{fieldtype:"pagebuilder",hidelabel:!0,bodySPBField:e}};function Zt(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.VKq(2,yt,e.fieldsNames.bodySPBField))}}const Et=function(){return{fieldtype:"html",hidelabel:!0}};function Lt(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,Et))}}const wt=function(){return{hidelabel:!0}};function Tt(e,t){if(1&e&&(r.TgZ(0,"div"),r._UZ(1,"field-container",28),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,wt))}}function Mt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",19),r.NdJ("dblclick",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setEditMode())})),r.TgZ(1,"div",20),r.YNc(2,ft,1,1,"field-container",21),r.YNc(3,_t,1,3,"field-container",22),r.qZA(),r.TgZ(4,"div",23),r.YNc(5,vt,1,3,"field-container",24),r.YNc(6,Zt,1,4,"field-container",24),r.YNc(7,Lt,1,3,"field-container",24),r.YNc(8,Tt,2,3,"div",25),r.qZA()()}if(2&e){const e=r.oxw();r.xp6(2),r.Q6J("ngIf",!!e.fieldsNames.subjectField),r.xp6(1),r.Q6J("ngIf",!!e.fieldsNames.mailboxField),r.xp6(1),r.Q6J("ngSwitch",e.activeEditor),r.xp6(1),r.Q6J("ngSwitchCase","richText"),r.xp6(1),r.Q6J("ngSwitchCase","pageBuilder"),r.xp6(1),r.Q6J("ngSwitchCase","html")}}function At(e,t){if(1&e&&r._UZ(0,"field-container",31),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.subjectField)}}function kt(e,t){if(1&e&&r._UZ(0,"field-container",27),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.mailboxField)("fieldconfig",r.DdM(2,bt))}}function Ct(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,xt))}}function Ft(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.VKq(2,yt,e.fieldsNames.bodySPBField))}}function Jt(e,t){if(1&e&&r._UZ(0,"field-container",28),2&e){const e=r.oxw(2);r.Q6J("field",e.fieldsNames.bodyHtmlField)("fieldconfig",r.DdM(2,Et))}}function Yt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r._UZ(1,"system-label",32),r.TgZ(2,"button",33),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.updateModelEditor("richText"))})),r._UZ(3,"system-label",34),r.qZA(),r._UZ(4,"system-label",35),r.TgZ(5,"button",36),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.updateModelEditor("pageBuilder"))})),r._UZ(6,"system-label",37),r.qZA(),r._UZ(7,"system-label",35),r.TgZ(8,"button",36),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw(2);return r.KtG(t.updateModelEditor("html"))})),r._UZ(9,"system-label",38),r.qZA()()}}function Bt(e,t){if(1&e&&(r.TgZ(0,"div",29)(1,"div",20),r.YNc(2,At,1,1,"field-container",30),r.YNc(3,kt,1,3,"field-container",22),r.qZA(),r.TgZ(4,"div",23),r.YNc(5,Ct,1,3,"field-container",24),r.YNc(6,Ft,1,4,"field-container",24),r.YNc(7,Jt,1,3,"field-container",24),r.YNc(8,Yt,10,0,"div",25),r.qZA()()),2&e){const e=r.oxw();r.xp6(2),r.Q6J("ngIf",!!e.fieldsNames.subjectField),r.xp6(1),r.Q6J("ngIf",!!e.fieldsNames.mailboxField),r.xp6(1),r.Q6J("ngSwitch",e.activeEditor),r.xp6(1),r.Q6J("ngSwitchCase","richText"),r.xp6(1),r.Q6J("ngSwitchCase","pageBuilder"),r.xp6(1),r.Q6J("ngSwitchCase","html")}}function St(e,t){1&e&&r.GkF(0)}function qt(e,t){if(1&e&&(r.TgZ(0,"div",39),r.YNc(1,St,1,0,"ng-container",18),r.qZA()),2&e){r.oxw();const e=r.MAs(20);r.xp6(1),r.Q6J("ngTemplateOutlet",e)}}function Nt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",5),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.toggleFullscreen())})),r._UZ(1,"system-button-icon",40),r.qZA()}if(2&e){const e=r.oxw();r.xp6(1),r.Q6J("icon",e.isFullscreen?"contract_alt":"expand_alt")}}const Ot=function(e,t,s){return{"slds-size--7-of-12":e,"slds-hide":t,"slds-grow":s}},Ut=function(e){return{"slds-hide":e}};let It=(()=>{class EmailTemplatesEditor{model;cdRef;modal;injector;view;componentconfig;fieldsNames={bodyHtmlField:"body_html",bodySPBField:"body_spb"};expanded;subscription=new Ke.w0;isFullscreen=!1;useDynamicModule=!1;constructor(e,t,s,i,l){this.model=e,this.cdRef=t,this.modal=s,this.injector=i,this.view=l}get activeEditor(){return this.model.data.editor_type}get isHidden(){return this.componentconfig.requiredmodelstate&&!this.model.checkModelState(this.componentconfig.requiredmodelstate)}ngAfterViewInit(){this.subscribeToModelChanges()}ngOnInit(){this.view.isEditable=!0,this.view.linkedToModel=!0,this.setUseDynamicModule(),this.setBodyFieldsName()}ngOnDestroy(){this.subscription.unsubscribe()}setEditMode(){(this.model.checkAccess("edit")||this.model.checkAccess("create"))&&(this.model.startEdit(),this.view.setEditMode(),this.cdRef.detectChanges())}setBodyFieldsName(){this.componentconfig.bodyHtmlField&&(this.fieldsNames.bodyHtmlField=this.componentconfig.bodyHtmlField),this.componentconfig.bodySPBField&&(this.fieldsNames.bodySPBField=this.componentconfig.bodySPBField),this.componentconfig.subjectField&&(this.fieldsNames.subjectField=this.componentconfig.subjectField),this.componentconfig.mailboxField&&(this.fieldsNames.mailboxField=this.componentconfig.mailboxField),this.componentconfig.previewForBean&&(this.fieldsNames.previewForBean=this.componentconfig.previewForBean),this.useDynamicModule&&this.model.getField(this.componentconfig.previewForBeanField)&&this.setActivePreviewForBean(this.model.getField(this.componentconfig.previewForBeanField))}subscribeToModelChanges(){this.useDynamicModule&&this.subscription.add(this.model.observeFieldChanges(this.componentconfig.previewForBeanField).subscribe((e=>{this.setActivePreviewForBean(e)}))),this.subscription.add(this.model.data$.subscribe((()=>this.cdRef.detectChanges()))),this.subscription.add(this.view.mode$.subscribe((()=>this.cdRef.detectChanges())))}setUseDynamicModule(){!this.componentconfig.previewForBean&&this.componentconfig.previewForBeanField&&(this.useDynamicModule=!0)}setPreviewForBean(e){this.fieldsNames.previewForBean=e}setActivePreviewForBean(e){this.setPreviewForBean(e),this.cdRef.detectChanges()}copyFromTemplate(){this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe((e=>{e.instance.module="EmailTemplates",e.instance.multiselect=!1,e.instance.selectedItems.subscribe((e=>{e.length&&this.model.setFields({[this.fieldsNames.bodyHtmlField]:e[0].body_html,[this.fieldsNames.bodySPBField]:e[0].body_spb,editor_type:e[0].editor_type})}))}))}updateModelEditor(e){this.model.setField("editor_type",e),this.cdRef.detectChanges()}expand(e){this.expanded&&this.expanded!=e?this.expanded=void 0:this.expanded=e}toggleFullscreen(){this.isFullscreen=!this.isFullscreen,this.cdRef.detectChanges()}static ɵfac=function(e){return new(e||EmailTemplatesEditor)(r.Y36(_.o),r.Y36(r.sBO),r.Y36(J.o),r.Y36(r.zs3),r.Y36(x.e))};static ɵcmp=r.Xpm({type:EmailTemplatesEditor,selectors:[["email-templates-editor"]],features:[r._Bn([x.e])],decls:21,vars:17,consts:[[1,"slds-grid","slds-height_full","slds-is-relative","slds-theme--default"],[1,"slds-border--right","slds-height_full","slds-grid","slds-grid--vertical",3,"ngClass"],[1,"slds-grid","slds-grid--align-end","slds-p-right--x-small","slds-p-top--xxx-small"],[1,"slds-button","slds-button--icon-bare","slds-button--icon",3,"disabled","click"],["icon","copy","size","small"],[1,"slds-button","slds-button--icon-bare","slds-button--icon",3,"click"],["icon","arrow_left","size","small"],[4,"ngIf"],[1,"slds-p-around--x-small","slds-grow",2,"min-height","0"],["class","slds-height_full slds-p-top--x-small slds-grid slds-grid--vertical","style","min-height: 250px",3,"dblclick",4,"ngIf","ngIfElse"],["contentEditingContainer",""],[1,"slds-is-relative","slds-grow","slds-height_full","slds-grid","slds-grid--vertical",2,"min-width","0",3,"ngClass"],[1,"slds-grid","slds-p-left--x-small","slds-grid--align-spread"],["icon","arrow_right","size","small"],["class","slds-m-right--x-small",4,"ngIf"],[1,"slds-grow","slds-p-around--x-small",2,"min-height","0"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"previewForBean","bodyHtmlField"],["fullscreenButton",""],[4,"ngTemplateOutlet"],[1,"slds-height_full","slds-p-top--x-small","slds-grid","slds-grid--vertical",2,"min-height","250px",3,"dblclick"],[1,"slds-grid","slds-m-bottom--xx-small"],["class","slds-grow slds-m-right--x-small","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small","class","slds-m-left--x-small",3,"field","fieldconfig",4,"ngIf"],[1,"slds-grid","slds-grid--align-center","slds-grid--vertical-align-center","slds-grow",2,"min-height","250px",3,"ngSwitch"],["class","slds-size--1-of-1 slds-height_full child-height-full",3,"field","fieldconfig",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow","slds-m-right--x-small",3,"field"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-m-left--x-small",3,"field","fieldconfig"],[1,"slds-size--1-of-1","slds-height_full","child-height-full",3,"field","fieldconfig"],[1,"slds-grid","slds-grid--vertical","slds-height_full"],["class","slds-grow","fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",3,"field",4,"ngIf"],["fielddisplayclass","slds-has-divider--bottom slds-p-vertical--x-small",1,"slds-grow",3,"field"],["label","LBL_EDIT_WITH",1,"slds-m-right--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button",3,"click"],["label","LBL_RICH_TEXT_EDITOR"],["label","LBL_OR",1,"slds-m-horizontal--xx-small"],[1,"slds-button","slds-button--neutral","spice-hover-button","slds-m-lef",3,"click"],["label","LBL_PAGE_BUILDER"],["label","LBL_HTML"],[1,"slds-m-right--x-small"],[3,"icon"]],template:function(e,t){if(1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",(function(){return t.copyFromTemplate()})),r._UZ(4,"system-button-icon",4),r.qZA(),r.TgZ(5,"button",5),r.NdJ("click",(function(){return t.expand("right")})),r._UZ(6,"system-button-icon",6),r.qZA(),r.YNc(7,pt,2,1,"ng-container",7),r.qZA(),r.TgZ(8,"div",8),r.YNc(9,Mt,9,6,"div",9),r.YNc(10,Bt,9,6,"ng-template",null,10,r.W1O),r.qZA()(),r.TgZ(12,"div",11)(13,"div",12)(14,"button",5),r.NdJ("click",(function(){return t.expand("left")})),r._UZ(15,"system-button-icon",13),r.qZA(),r.YNc(16,qt,2,1,"div",14),r.qZA(),r.TgZ(17,"div",15),r._UZ(18,"email-templates-preview",16),r.qZA()()(),r.YNc(19,Nt,2,1,"ng-template",null,17,r.W1O)),2&e){const e=r.MAs(11);r.ekj("spice-fullscreen",t.isFullscreen),r.xp6(1),r.Q6J("ngClass",r.kEZ(11,Ot,!t.expanded,"right"==t.expanded,"left"==t.expanded)),r.xp6(2),r.Q6J("disabled",!t.view.isEditMode()),r.xp6(4),r.Q6J("ngIf","left"==t.expanded),r.xp6(2),r.Q6J("ngIf",!t.view.isEditMode())("ngIfElse",e),r.xp6(3),r.Q6J("ngClass",r.VKq(15,Ut,"left"==t.expanded)),r.xp6(4),r.Q6J("ngIf","left"!=t.expanded),r.xp6(2),r.Q6J("previewForBean",t.fieldsNames.previewForBean)("bodyHtmlField",t.fieldsNames.bodyHtmlField)}},dependencies:[i.mk,i.O5,i.tP,i.RF,i.n9,i.ED,nt.j,Z.J,E._,ht],encapsulation:2,changeDetection:0})}return EmailTemplatesEditor})();var Qt=s(33369),Rt=s(26625),jt=s(55638),Dt=s(83398);function Ht(e,t){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}const Pt=function(e,t){return{"text-decoration":e,"font-weight":t}};function zt(e,t){if(1&e&&(r.TgZ(0,"field-generic-display",4)(1,"div",5)(2,"div",6),r._UZ(3,"system-utility-icon",7),r.qZA(),r.TgZ(4,"div",8),r._uU(5),r.qZA()()()),2&e){const e=r.oxw();r.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig)("fieldid",e.fieldid),r.xp6(2),r.Q6J("system-title",e.statusLabel),r.xp6(1),r.Q6J("icon",e.statusIcon),r.xp6(1),r.Q6J("title",e.value)("ngStyle",r.WLB(9,Pt,"user_closed"==e.model.data.openness||"system_closed"==e.model.data.openness?"line-through":"initial","unread"==e.model.data.status?"bold":"initial")),r.xp6(1),r.hij(" ",e.value," ")}}function Gt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",9)(1,"input",10),r.NdJ("ngModelChange",(function(t){r.CHM(e);const s=r.oxw();return r.KtG(s.value=t)})),r.qZA(),r._UZ(2,"field-messages",11),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("ngClass",e.getFieldClass()),r.xp6(1),r.Q6J("ngModel",e.value)("maxlength",e.fieldlength)("autocomplete",e.fieldid)("ngModelOptions",e.modelOptions),r.xp6(1),r.Q6J("fieldname",e.fieldname)}}let $t=(()=>{class fieldEmailSubject extends W.O{model;view;language;metadata;backend;toast;router;injector;broadcast;configurationService;modal;cdRef;sanitized;constructor(e,t,s,i,l,n,a,o,d,c,r,m,u){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a,this.injector=o,this.broadcast=d,this.configurationService=c,this.modal=r,this.cdRef=m,this.sanitized=u}get statusIcon(){switch(this.model.getField("status")){case"opened":case"read":return"email_open";case"bounced":case"deferred":case"send_error":return"error";case"sent":return"send";default:return"email"}}get statusLabel(){switch(this.model.getField("status")){case"opened":case"read":return"LBL_OPEN";case"bounced":case"deferred":case"send_error":return"LBL_ERROR";case"sent":return"LBL_OUTBOUND";default:return"LBL_UNREAD"}}static ɵfac=function(e){return new(e||fieldEmailSubject)(r.Y36(_.o),r.Y36(x.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(v.y),r.Y36(_e.A),r.Y36(ee.F0),r.Y36(r.zs3),r.Y36(Qt.f),r.Y36(Rt.C),r.Y36(J.o),r.Y36(r.sBO),r.Y36(B.H7))};static ɵcmp=r.Xpm({type:fieldEmailSubject,selectors:[["field-email-subject"]],features:[r.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig","fieldid",4,"ngIf"],["class","slds-form-element__control slds-is-relative","style","position:relative;",3,"ngClass",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig","fieldid"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-m-right--x-small",3,"system-title"],["size","x-small",3,"icon"],[1,"slds-truncate",3,"title","ngStyle"],[1,"slds-form-element__control","slds-is-relative",2,"position","relative",3,"ngClass"],["system-placeholder","","type","text",1,"slds-input",3,"ngModel","maxlength","autocomplete","ngModelOptions","ngModelChange"],[3,"fieldname"]],template:function(e,t){1&e&&(r.YNc(0,Ht,1,2,"field-label",0),r.YNc(1,zt,6,12,"field-generic-display",1),r.YNc(2,Gt,3,6,"div",2)),2&e&&(r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("ngIf",!t.isEditMode()),r.xp6(1),r.Q6J("ngIf",t.isEditable()&&t.isEditMode()))},dependencies:[i.mk,i.O5,i.PC,l.Fj,l.JJ,l.nD,l.On,te.q,se.D,jt.a,ie.r,Dt.A,ke.S],encapsulation:2})}return fieldEmailSubject})();function Kt(e,t){if(1&e&&r._UZ(0,"field-label",3),2&e){const e=r.oxw();r.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Xt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setOpenness("user_closed"))})),r._UZ(1,"system-button-icon",5),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function Vt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.setOpenness("open"))})),r._UZ(1,"system-button-icon",6),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}let Wt=(()=>{class fieldEmailActivityOpenness extends W.O{model;view;language;metadata;backend;toast;router;constructor(e,t,s,i,l,n,a){super(e,t,s,i,a),this.model=e,this.view=t,this.language=s,this.metadata=i,this.backend=l,this.toast=n,this.router=a}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest(`module/${this.model.module}/${this.model.id}/openness`,null,{openness:e}).subscribe((e=>{}),(t=>{this.toast.sendAlert("Cannot change openness to "+e)}))}static ɵfac=function(e){return new(e||fieldEmailActivityOpenness)(r.Y36(_.o),r.Y36(x.e),r.Y36(m.d),r.Y36(u.Pu),r.Y36(v.y),r.Y36(_e.A),r.Y36(ee.F0))};static ɵcmp=r.Xpm({type:fieldEmailActivityOpenness,selectors:[["field-email-activity-openness"]],features:[r.qOj],decls:4,vars:4,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"ngClass"],["class","slds-button slds-button--icon",3,"disabled","title","click",4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-button","slds-button--icon",3,"disabled","title","click"],["icon","unlock"],["icon","lock"]],template:function(e,t){1&e&&(r.YNc(0,Kt,1,2,"field-label",0),r.TgZ(1,"div",1),r.YNc(2,Xt,2,2,"button",2),r.YNc(3,Vt,2,2,"button",2),r.qZA()),2&e&&(r.Q6J("ngIf",t.displayLabel),r.xp6(1),r.Q6J("ngClass",t.getFieldClass()),r.xp6(1),r.Q6J("ngIf","open"==t.model.data.openness),r.xp6(1),r.Q6J("ngIf","user_closed"==t.model.data.openness||"system_closed"==t.model.data.openness))},dependencies:[i.mk,i.O5,te.q,Z.J],encapsulation:2})}return fieldEmailActivityOpenness})();function es(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",9)(1,"div")(2,"system-checkbox",10),r.NdJ("ngModelChange",(function(t){const s=r.CHM(e).$implicit;return r.KtG(s.selected=t)})),r.qZA()(),r.TgZ(3,"div"),r._UZ(4,"system-icon",11),r.qZA(),r.TgZ(5,"div",12),r._uU(6),r.qZA(),r.TgZ(7,"div"),r._uU(8),r.qZA()()}if(2&e){const e=t.$implicit;r.xp6(2),r.Q6J("ngModel",e.selected),r.xp6(2),r.Q6J("module",e.module),r.xp6(2),r.Oqu(e.summary_text),r.xp6(2),r.hij("(",e.email_address,")")}}function ts(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"system-modal",1)(1,"system-modal-header",2),r.NdJ("close",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.close())})),r._UZ(2,"system-label",3),r.qZA(),r.TgZ(3,"system-modal-content"),r.YNc(4,es,9,4,"div",4),r.qZA(),r.TgZ(5,"system-modal-footer")(6,"button",5),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.close())})),r._UZ(7,"system-label",6),r.qZA(),r.TgZ(8,"button",7),r.NdJ("click",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.add())})),r._UZ(9,"system-label",8),r.qZA()()()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("ngForOf",e.addresses),r.xp6(4),r.Q6J("disabled",!e.canAdd)}}let ss=(()=>{class EmailParentAddressesModal{model;modal;toast;backend;self;addresses=[];addAddresses=new r.vpe;constructor(e,t,s,i){this.model=e,this.modal=t,this.toast=s,this.backend=i}ngOnInit(){let e=this.modal.await("LBL_LOADING");this.backend.getRequest(`module/EmailAddresses/${this.model.getField("parent_type")}/${this.model.getField("parent_id")}`).subscribe((t=>{this.addresses=t,0==this.addresses.length&&(this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","info"),this.close()),e.emit(!0)}),(()=>{this.toast.sendToast("LBL_NO_RELATED_EMAILADDRESSES_FOUND","error"),e.emit(!0),this.close()}))}get canAdd(){return this.addresses.filter((e=>e.selected)).length>0}add(){this.addAddresses.emit(this.addresses.filter((e=>e.selected))),this.close()}close(){this.self.destroy()}static ɵfac=function(e){return new(e||EmailParentAddressesModal)(r.Y36(_.o),r.Y36(J.o),r.Y36(_e.A),r.Y36(v.y))};static ɵcmp=r.Xpm({type:EmailParentAddressesModal,selectors:[["email-parent-addresses-modal"]],decls:1,vars:1,consts:[["size","small",4,"ngIf"],["size","small"],[3,"close"],["label","LBL_SELECT_PARENT_EMAIL"],["class","slds-grid slds-p-vertical--xx-small",4,"ngFor","ngForOf"],[1,"slds-button","slds-button_neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button_brand",3,"disabled","click"],["label","LBL_ADD"],[1,"slds-grid","slds-p-vertical--xx-small"],[3,"ngModel","ngModelChange"],["size","x-small",3,"module"],[1,"slds-p-right--small"]],template:function(e,t){1&e&&r.YNc(0,ts,10,2,"system-modal",0),2&e&&r.Q6J("ngIf",t.addresses.length>0)},dependencies:[i.sg,i.O5,l.JJ,l.On,Me.U,Ae.f,E._,q.j,N.x,O.p,U.y],encapsulation:2})}return EmailParentAddressesModal})();var is=s(83917);const ls=["contextMenu"];function ns(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"li",7)(1,"a",8),r.NdJ("click",(function(){const t=r.CHM(e).$implicit,s=r.oxw(2);return r.KtG(s.setField(t))})),r.TgZ(2,"span",9),r._UZ(3,"system-label-fieldname",10),r.qZA()()()}if(2&e){const e=t.$implicit,s=r.oxw(2);r.xp6(3),r.Q6J("module",s.emailmodule)("field",e)}}function as(e,t){if(1&e&&(r.TgZ(0,"div",3,4)(2,"ul",5),r.YNc(3,ns,4,2,"li",6),r.qZA()()),2&e){const e=r.oxw();r.Q6J("ngStyle",e.contextMenuStyle),r.xp6(3),r.Q6J("ngForOf",e.emailfields)}}let os=(()=>{class EmailToLeadEmailText{elementRef;renderer;language;contextMenu;emailtext="";emailhtml="";emailmodule="";emailfields=["first_name","last_name"];setfield=new r.vpe;clickListener=null;displayContextMenu=!1;displayContextCoordinates={top:0,left:0};constructor(e,t,s){this.elementRef=e,this.renderer=t,this.language=s}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{top:this.displayContextCoordinates.top-e.top+"px",left:this.displayContextCoordinates.left-e.left+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}static ɵfac=function(e){return new(e||EmailToLeadEmailText)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(m.d))};static ɵcmp=r.Xpm({type:EmailToLeadEmailText,selectors:[["email-to-lead-emailtext"]],viewQuery:function(e,t){if(1&e&&r.Gf(ls,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.NdJ("contextmenu",(function(e){return t.showContextMenu(e)})),r.qZA(),r.YNc(2,as,4,2,"div",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("innerHTML",t.content,r.oJD),r.xp6(1),r.Q6J("ngIf",t.displayContextMenu))},dependencies:[i.sg,i.O5,i.PC,h.h],encapsulation:2})}return EmailToLeadEmailText})();const ds=["detailcontainer"];let cs=(()=>{class EmailToLeadModal{language;metadata;view;model;footer;toast;detailcontainer;email=null;self=null;componentRefs=[];leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"];constructor(e,t,s,i,l,n){this.language=e,this.metadata=t,this.view=s,this.model=i,this.footer=l,this.toast=n,this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let t of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(t.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}static ɵfac=function(e){return new(e||EmailToLeadModal)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(x.e),r.Y36(_.o),r.Y36(is.M),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&r.Gf(ds,7,r.s_b),2&e){let e;r.iGM(e=r.CRH())&&(t.detailcontainer=e.first)}},features:[r._Bn([_.o,x.e])],decls:20,vars:5,consts:[["role","dialog","tabindex","-1",1,"slds-modal","slds-modal_large","slds-fade-in-open"],[1,"slds-modal__container"],[1,"slds-modal__header"],["title","Close",1,"slds-button","slds-modal__close","slds-button--icon-inverse",3,"click"],[3,"icon"],[1,"slds-text-heading--medium"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-modal__content"],[1,"slds-grid",2,"height","80vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-modal__footer"],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"],[1,"slds-backdrop","slds-backdrop--open"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),r.NdJ("click",(function(){return t.closeModal()})),r._UZ(4,"system-button-icon",4),r.qZA(),r.TgZ(5,"h2",5),r._UZ(6,"system-label",6),r.qZA()(),r.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"email-to-lead-emailtext",10),r.NdJ("setfield",(function(e){return t.setField(e)})),r.qZA()(),r.TgZ(11,"div",11),r._UZ(12,"div",null,12),r.qZA()()(),r.TgZ(14,"div",13)(15,"button",14),r.NdJ("click",(function(){return t.closeModal()})),r._UZ(16,"system-label",15),r.qZA(),r.TgZ(17,"button",16),r.NdJ("click",(function(){return t.saveLead()})),r._UZ(18,"system-label",17),r.qZA()()()(),r._UZ(19,"div",18)),2&e&&(r.xp6(4),r.Q6J("icon","close"),r.xp6(6),r.Q6J("emailmodule",t.model.module)("emailtext",t.email.data.body)("emailhtml",t.email.data.body)("emailfields",t.leadFields))},dependencies:[Z.J,E._,os],encapsulation:2})}return EmailToLeadModal})(),rs=(()=>{class EmailToLeadButton{language;metadata;model;footer;toast;constructor(e,t,s,i,l){this.language=e,this.metadata=t,this.model=s,this.footer=i,this.toast=l}createLead(){this.metadata.addComponent("EmailToLeadModal",this.footer.footercontainer).subscribe((e=>{e.instance.email=this.model,e.instance.self=e}))}static ɵfac=function(e){return new(e||EmailToLeadButton)(r.Y36(m.d),r.Y36(u.Pu),r.Y36(_.o),r.Y36(is.M),r.Y36(_e.A))};static ɵcmp=r.Xpm({type:EmailToLeadButton,selectors:[["ng-component"]],hostAttrs:[1,"slds-button","slds-button--neutral"],hostBindings:function(e,t){1&e&&r.NdJ("click",(function(){return t.createLead()}))},decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[E._],styles:["[_nghost-%COMP%]{cursor:pointer}"]})}return EmailToLeadButton})();var ms=s(50721);let us=(()=>{class EmailCloneAttachmentsButton{model;modal;toast;injector;metadata;activityTimeline;parentModel;constructor(e,t,s,i,l,n,a){this.model=e,this.modal=t,this.toast=s,this.injector=i,this.metadata=l,this.activityTimeline=n,this.parentModel=a}get disabled(){return!this.metadata.checkModuleAcl("Emails","create")&&!this.activityTimeline.parent||!this.parentModel}execute(){this.modal.openModal("EmailCloneAttachmentsModal",!0,this.injector).subscribe((e=>{e.instance.parent=this.activityTimeline?.parent??this.parentModel}))}static ɵfac=function(e){return new(e||EmailCloneAttachmentsButton)(r.Y36(_.o),r.Y36(J.o),r.Y36(_e.A),r.Y36(r.zs3),r.Y36(u.Pu),r.Y36(ms.h,8),r.Y36(_.o,4))};static ɵcmp=r.Xpm({type:EmailCloneAttachmentsButton,selectors:[["email-clone-attachments-button"]],decls:2,vars:0,consts:[["label","LBL_CLONE_ATTACHMENTS"]],template:function(e,t){1&e&&(r.TgZ(0,"span"),r._UZ(1,"system-label",0),r.qZA())},dependencies:[E._],encapsulation:2})}return EmailCloneAttachmentsButton})();var hs=s(20528),gs=s(46346);function ps(e,t){1&e&&r._UZ(0,"system-spinner")}function fs(e,t){1&e&&(r.TgZ(0,"system-illustration-no-records"),r._UZ(1,"system-label",13),r.qZA())}function bs(e,t){if(1&e&&(r.ynx(0),r.TgZ(1,"div",12),r.YNc(2,ps,1,0,"system-spinner",5),r.YNc(3,fs,2,0,"system-illustration-no-records",5),r.qZA(),r.BQk()),2&e){const e=r.oxw();r.xp6(2),r.Q6J("ngIf",!e.showIllustration),r.xp6(1),r.Q6J("ngIf",e.showIllustration)}}const _s=function(e){return{"slds-theme_shade":e}};function xs(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",15)(1,"div")(2,"system-checkbox",16),r.NdJ("ngModelChange",(function(t){const s=r.CHM(e).$implicit;return r.KtG(s.selected=t)})),r.qZA()(),r.TgZ(3,"div"),r._UZ(4,"spice-attachment-file",17),r.qZA()()}if(2&e){const e=t.$implicit,s=r.oxw(2);r.Q6J("ngClass",r.VKq(7,_s,e.selected)),r.xp6(2),r.Q6J("ngModel",e.selected)("disabled",!1),r.xp6(2),r.Q6J("modelattachments",s.modelattachments)("file",e)("editmode",!1)("disabled",!0)}}function vs(e,t){if(1&e&&r.YNc(0,xs,5,9,"div",14),2&e){const e=r.oxw();r.Q6J("ngForOf",e.filteredFiles)}}function ys(e,t){if(1&e&&(r.TgZ(0,"div",20)(1,"div"),r._UZ(2,"system-checkbox",21),r.qZA(),r.TgZ(3,"div"),r._UZ(4,"spice-attachment-file",17),r.qZA()()),2&e){const e=t.$implicit,s=r.oxw(2);r.xp6(2),r.Q6J("disabled",!0),r.xp6(2),r.Q6J("modelattachments",s.modelattachments)("file",e)("editmode",!1)("disabled",!0)}}const Zs=function(e){return{"slds-border_top":e}};function Es(e,t){if(1&e&&(r.TgZ(0,"div"),r._UZ(1,"div",18),r.YNc(2,ys,5,5,"div",19),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngClass",r.VKq(2,Zs,e.showArchive&&e.filteredFiles.length>0)),r.xp6(1),r.Q6J("ngForOf",e.linkedFiles)}}let Ls=(()=>{class EmailCloneAttachmentsModal{model;backend;toast;modelattachments;cdRef;modal;broadcast;self;parent;linkedFiles=[];filteredFiles=[];parentFiles=[];parentCount=0;showIllustration=!1;showArchive=!1;constructor(e,t,s,i,l,n,a){this.model=e,this.backend=t,this.toast=s,this.modelattachments=i,this.cdRef=l,this.modal=n,this.broadcast=a}ngAfterViewInit(){this.loadFiles()}loadFiles(){this.getParentAttachments(this.parent).subscribe({next:e=>{this.filteredFiles=this.modelattachments.files.filter((e=>!this.parentFiles.some((t=>t.filemd5===e.filemd5)))),0==this.filteredFiles.length&&(this.showIllustration=!0),this.linkedFiles=this.modelattachments.files.filter((e=>this.parentFiles.some((t=>t.filemd5===e.filemd5)))),this.cdRef.detectChanges()},error:()=>{this.showIllustration=!0,this.toast.sendToast("LBL_ERROR","error")}})}get canSave(){return this.filteredFiles.filter((e=>e.selected)).length>0}save(){this.modal.openModal("SystemLoadingModal").subscribe((e=>{const t=this.modelattachments.files.filter((e=>e.selected));this.cloneAttachmentsFromEmail(this.parent,t).subscribe((t=>{e.instance.self.destroy(),t?(this.toast.sendToast("LBL_SUCCESS","success"),this.close()):this.toast.sendToast("LBL_ERROR","error")}))}))}broadcastAttachmentCount(){this.broadcast.broadcastMessage("attachments.cloned",{module:this.parent.module,id:this.parent.id,attachmentcount:this.parentCount,clonedFiles:this.parentFiles,reload:!0})}close(){this.self.destroy()}getParentAttachments(e){let t=new we.x;return this.modelattachments.getAttachments().subscribe((s=>{this.backend.getRequest(`common/spiceattachments/module/${e.module}/${e.id}`,{},this.modelattachments.httpRequestsRefID).subscribe({next:e=>{for(let t in e)this.parentFiles.push(e[t]);t.next(this.parentFiles),t.complete()},error:e=>{t.error(e),t.complete()}})})),t.asObservable()}cloneAttachmentsFromEmail(e,t,s){let i=new we.x;const l={categoryId:s,selectedFiles:t};return this.backend.postRequest(`common/spiceattachments/module/${this.parent.module}/${this.parent.id}/clone/${this.model.module}/${this.model.id}`,{},l,this.modelattachments.httpRequestsRefID).subscribe({next:e=>{for(let t in e)this.filteredFiles.find((e=>e.id==t))||(e[t].date=new moment(e[t].date),this.parentFiles.push(e[t]));this.parentCount=this.parentFiles.length,this.broadcastAttachmentCount(),i.next(this.parentFiles),i.complete()},error:e=>{i.error(e),i.complete()}}),i.asObservable()}static ɵfac=function(e){return new(e||EmailCloneAttachmentsModal)(r.Y36(_.o),r.Y36(v.y),r.Y36(_e.A),r.Y36(S.H),r.Y36(r.sBO),r.Y36(J.o),r.Y36(Qt.f))};static ɵcmp=r.Xpm({type:EmailCloneAttachmentsModal,selectors:[["email-clone-attachments-modal"]],features:[r._Bn([x.e])],decls:15,vars:7,consts:[["size","small"],[3,"close"],["label","LBL_CLONE_ATTACHMENTS"],[4,"ngIf","ngIfElse"],["showAttachments",""],[4,"ngIf"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-col--bump-right",3,"ngModel","disabled","label","ngModelChange"],[1,"slds-col--bump-left","slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-col--bump-left","slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_SAVE"],[1,"slds-align--absolute-center","slds-p-around--small"],["label","LBL_NO_RECORDS"],["class","slds-grid slds-grid_vertical-align-center slds-p-around--xx-small",3,"ngClass",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--xx-small",3,"ngClass"],[3,"ngModel","disabled","ngModelChange"],[1,"slds-media",2,"pointer-events","none",3,"modelattachments","file","editmode","disabled"],[3,"ngClass"],["class","slds-grid slds-grid_vertical-align-center slds-p-around--xx-small",4,"ngFor","ngForOf"],[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--xx-small"],[3,"disabled"]],template:function(e,t){if(1&e&&(r.TgZ(0,"system-modal",0)(1,"system-modal-header",1),r.NdJ("close",(function(){return t.close()})),r._UZ(2,"system-label",2),r.qZA(),r.TgZ(3,"system-modal-content"),r.YNc(4,bs,4,2,"ng-container",3),r.YNc(5,vs,1,1,"ng-template",null,4,r.W1O),r.YNc(7,Es,3,4,"div",5),r.qZA(),r.TgZ(8,"system-modal-footer")(9,"div",6)(10,"system-checkbox-toggle",7),r.NdJ("ngModelChange",(function(e){return t.showArchive=e})),r.qZA(),r.TgZ(11,"button",8),r.NdJ("click",(function(){return t.close()})),r._UZ(12,"system-label",9),r.qZA(),r.TgZ(13,"button",10),r.NdJ("click",(function(){return t.save()})),r._UZ(14,"system-label",11),r.qZA()()()()),2&e){const e=r.MAs(6);r.xp6(4),r.Q6J("ngIf",0==t.filteredFiles.length&&!t.showArchive)("ngIfElse",e),r.xp6(3),r.Q6J("ngIf",t.showArchive&&t.linkedFiles.length>0),r.xp6(3),r.Q6J("ngModel",t.showArchive)("disabled",0==t.linkedFiles.length)("label","LBL_SHOW_LINKED"),r.xp6(3),r.Q6J("disabled",!t.canSave)}},dependencies:[i.mk,i.sg,i.O5,l.JJ,l.On,Me.U,hs.v,je.C,E._,q.j,N.x,O.p,U.y,I.W,gs.I],encapsulation:2})}return EmailCloneAttachmentsModal})();var ws=s(3719);let Ts=(()=>{class ModuleEmails{static ɵfac=function(e){return new(e||ModuleEmails)};static ɵmod=r.oAB({type:ModuleEmails});static ɵinj=r.cJS({imports:[i.ez,l.u5,a.ObjectFields,o.GlobalComponents,d.ObjectComponents,c.SystemComponents,n.o,ws.ModuleSpiceAttachments]})}return ModuleEmails})();("undefined"==typeof ngJitMode||ngJitMode)&&r.kYT(Ts,{declarations:[Y,b,C,D,G,V,oe,de,pe,xe,fe,be,ye,Le,Te,Ze,Qe,$e,st,lt,It,ht,ss,$t,Wt,cs,os,rs,us,Ls],imports:[i.ez,l.u5,a.ObjectFields,o.GlobalComponents,d.ObjectComponents,c.SystemComponents,n.o,ws.ModuleSpiceAttachments]})},50721:(e,t,s)=>{s.d(t,{h:()=>h});var i=s(62242),l=s(61135),n=s(39646),a=s(77579),o=s(4154),d=s(14505),c=s(29266),r=s(26625),m=s(75920),u=s(33369);let h=(()=>{class activitiytimeline{metadata;backend;modelutilities;configurationService;session;broadcast;httpRequestsRefID=_.uniqueId("activity_timeline_http_ref_");parent;serviceSubscriptions=[];filters={searchterm:"",objectfilters:[],own:""};loading$=new i.vpe;defaultLimit=5;modules=["Activities","History"];activeStates=["Planned","In Progress","Not Started","Pending Input"];activityObjects=["Tasks","Meetings","Calls","Notes","Emails"];sortDates={Calls:"date_start",Meetings:"date_start",Tasks:"date_due",Emails:"date_entered",Notes:"date_entered"};activities={Activities:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]},History:{loading:!1,loadingmore:!1,list:[],totalcount:0,aggregates:[]}};usefts=!1;_openness=!1;openness$;constructor(e,t,s,i,n,a){this.metadata=e,this.backend=t,this.modelutilities=s,this.configurationService=i,this.session=n,this.broadcast=a,this.serviceSubscriptions.push(this.broadcast.message$.subscribe((e=>this.handleMessage(e)))),this.openness$=new l.X(this._openness)}get openness(){return this._openness}set openness(e){this._openness=e,this.openness$.next(e)}get filterObjects(){if(this.usefts){let e=[];for(let t in this.activities)e=e.concat(this.getAggregateObjects(t));return _.uniq(e)}return this.activityObjects}getAggregateObjects(e){try{let t=[];for(let s of this.activities[e].aggregates.module)t.push(s.module);return t}catch(e){return[]}}stopSubscriptions(){for(let e of this.serviceSubscriptions)e.unsubscribe();this.backend.cancelPendingRequests([this.httpRequestsRefID])}handleMessage(e){let t=e.messagetype.split(".");if("model"===t[0])switch(t[1]){case"merge":this.parent&&e.messagedata.module==this.parent.module&&e.messagedata.id==this.parent.id&&(this.getTimeLineData("Activities",!0),this.getTimeLineData("History",!0));break;case"save":this.metadata.getModuleDefs(e.messagedata.module).ftsactivities.Activities&&this.getTimeLineData("Activities",!0),this.metadata.getModuleDefs(e.messagedata.module).ftsactivities.History&&this.getTimeLineData("History",!0);break;case"delete":for(let t of this.modules){let s=this.activities[t].list.findIndex((t=>t.module==e.messagedata.module&&t.id==e.messagedata.id));s>=0&&this.activities[t].list.splice(s,1)}}}checkModuleActive(e){return 0==this.filters.objectfilters.length||this.filters.objectfilters.indexOf(e)>=0}toggleModuleFilter(e){0==this.filters.objectfilters.length?(this.filters.objectfilters=this.filterObjects,this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(e),1)):this.filters.objectfilters.indexOf(e)>=0?this.filters.objectfilters.splice(this.filters.objectfilters.indexOf(e),1):(this.filters.objectfilters.push(e),this.filters.objectfilters.length==this.filterObjects.length&&(this.filters.objectfilters=[]))}reload(e=!1){this.loading$.emit(!0);for(let t of this.modules)this.getTimeLineData(t,e)}getTimeLineData(e,t=!1){t||(this.activities[e].loading=!0);let s={count:!0,limit:this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};this.backend.postRequest("module/"+e+"/fts/"+this.parent.module+"/"+this.parent.id,{},s,this.httpRequestsRefID).subscribe({next:t=>{if(t){this.resetListData(e);for(let e of t.items)e.data=this.modelutilities.backendModel2spice(e.module,e.data);this.activities[e].list=t.items,this.activities[e].totalcount=parseInt(t.totalcount,10),this.activities[e].aggregates=t.aggregates?t.aggregates:[]}this.activities[e].loading=!1},error:t=>{this.activities[e].loading=!1}})}getMoreTimeLineData(e,t){if(!this.canLoadMore(e)||this.activities[e].loading)return(0,n.of)(!0);let s=new a.x,i={start:this.activities[e].list.length,limit:t||this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own,searchterm:this.filters.searchterm};return this.activities[e].loadingmore=!0,this.backend.postRequest("module/"+e+"/fts/"+this.parent.module+"/"+this.parent.id,{},i,this.httpRequestsRefID).subscribe({next:t=>{for(let s of t.items)s.data=this.modelutilities.backendModel2spice(s.module,s.data),this.activities[e].list.push(s);this.activities[e].loadingmore=!1,s.next(!0),s.complete()},error:t=>{this.activities[e].loadingmore=!1,s.error(t),s.complete()}}),s.asObservable()}resetListData(e){this.activities[e]={loading:!1,loadingmore:!1,list:[],totalcount:0}}canLoadMore(e){return this.activities[e].totalcount>this.activities[e].list.length&&!this.activities[e].loadingmore}sortListdata(e){this.activities[e].list.sort(((t,s)=>{let i=new moment(t.data[this.sortDates[t.module]]),l=new moment(s.data[this.sortDates[s.module]]);return"Activities"!==e?i.isBefore(l):i.isAfter(l)}))}static ɵfac=function(e){return new(e||activitiytimeline)(i.LFG(o.Pu),i.LFG(d.y),i.LFG(c.A),i.LFG(r.C),i.LFG(m.n),i.LFG(u.f))};static ɵprov=i.Yz7({token:activitiytimeline,factory:activitiytimeline.ɵfac})}return activitiytimeline})()}}]);