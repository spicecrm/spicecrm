/*!
 * 
 *                     SpiceCRM
 *
 *                     release: 2024.01.001
 *
 *                     date: 2024-06-07 18:53:45
 *
 *                     build: 2024.01.001.1717779225604
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_accounts_moduleaccounts_ts"],{42884:(t,e,s)=>{s.r(e),s.d(e,{ModuleAccounts:()=>oe});var i=s(60177),n=s(84341),a=s(71341),c=s(7745),o=s(12948),l=s(37328),d=s(70569),r=s(54438);let u=(()=>{class ACManagerService{constructor(){this.contactccdetails={},this.contactCCDetails$=new r.bkB}get contactCCDetails(){return this.contactccdetails}set contactCCDetails(t){this.contactccdetails=t,this.contactCCDetails$.emit(t)}static#t=this.ɵfac=function(t){return new(t||ACManagerService)};static#e=this.ɵprov=r.jDH({token:ACManagerService,factory:ACManagerService.ɵfac})}return ACManagerService})();var m=s(49722),h=s(35911),g=s(83935),f=s(69904),p=s(32062),b=s(48717);function v(t,e){if(1&t&&(r.j41(0,"th",8)(1,"div",15),r.EFF(2),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.SpI(" ",t," ")}}function C(t,e){if(1&t&&(r.j41(0,"td",21)(1,"div",22),r.EFF(2),r.k0s()()),2&t){const t=e.$implicit,s=r.XpG().$implicit,i=r.XpG(2);r.R7$(2),r.SpI(" ",i.getKPI(s.id,t)," ")}}function y(t,e){if(1&t&&(r.j41(0,"tr")(1,"th",16)(2,"div",17),r.EFF(3),r.k0s()(),r.DNE(4,C,3,1,"td",18),r.j41(5,"th",19)(6,"div",20),r.EFF(7,"EUR"),r.k0s()()()),2&t){const t=e.$implicit,s=r.XpG(2);r.R7$(3),r.SpI(" ",t.companycode," "),r.R7$(),r.Y8G("ngForOf",s.years)}}function I(t,e){if(1&t&&(r.j41(0,"div",4)(1,"div",5)(2,"table",6)(3,"thead")(4,"tr",7)(5,"th",8)(6,"div",9),r.nrm(7,"system-label",10),r.k0s()(),r.DNE(8,v,3,1,"th",11),r.j41(9,"th",8)(10,"div",12),r.nrm(11,"system-label",13),r.k0s()()()(),r.j41(12,"tbody"),r.DNE(13,y,8,2,"tr",14),r.k0s()()()()),2&t){const t=r.XpG();r.Y8G("ngStyle",t.tableContainerStyle),r.R7$(8),r.Y8G("ngForOf",t.years),r.R7$(5),r.Y8G("ngForOf",t.companyCodes)}}function F(t,e){1&t&&r.nrm(0,"system-spinner")}function k(t,e){1&t&&(r.j41(0,"div",23)(1,"span"),r.EFF(2," No Company Codes found "),r.k0s()())}let D=(()=>{class AccountsKPIsOverview{constructor(t,e,s,i,n){this.backend=t,this.model=e,this.metadata=s,this.language=i,this.renderer=n,this.years=[],this.limit=0,this.yearto=0,this.companyCodes=[],this.accountKpis={},this.isLoading=!1,this.getYears(),this.isLoading=!0,this.backend.getRequest(`module/AccountKPIs/${this.model.id}/getsummary`,{yearfrom:this.yearto-this.limit+1,yearto:this.yearto}).subscribe((t=>{this.accountKpis=t.accountkpis,this.companyCodes=t.companycodes,this.isLoading=!1}))}get tableContainerStyle(){return{border:"1px solid #dddbda","border-radius":".25rem",height:"417px"}}getYears(){let t=this.metadata.getComponentConfig("AccountsKPIsOverview","AccountKPIs");this.yearto=t&&t.yearto?+t.yearto:(new moment).get("year"),this.limit=t&&t.limit?+t.limit:4;for(let t=this.yearto-this.limit+1;t<=this.yearto;t++)this.years.push(t)}getKPI(t,e){try{return this.accountKpis[t][e]?this.accountKpis[t][e]:0}catch(t){return 0}}static#t=this.ɵfac=function(t){return new(t||AccountsKPIsOverview)(r.rXU(m.H),r.rXU(h.g),r.rXU(g.yu),r.rXU(f.B),r.rXU(r.sFG))};static#e=this.ɵcmp=r.VBU({type:AccountsKPIsOverview,selectors:[["ng-component"]],decls:4,vars:3,consts:[[1,"slds-container--fluid","slds-m-vertical--small"],["class","slds-table--header-fixed_container",3,"ngStyle",4,"ngIf"],[4,"ngIf"],["class","slds-align_absolute-center slds-p-vertical--medium",4,"ngIf"],[1,"slds-table--header-fixed_container",3,"ngStyle"],[1,"slds-scrollable--y",2,"height","100%"],[1,"slds-table","slds-table_bordered","slds-table_header-fixed","slds-theme--default"],[1,"slds-text-title_caps"],["scope","col"],["title","companyCode",1,"slds-p-left--x-small","slds-truncate","slds-cell-fixed","slds-grid","slds-grid_vertical-align-center"],["label","LBL_COMPANYCODE"],["scope","col",4,"ngFor","ngForOf"],["title","currency",1,"slds-p-left--x-small","slds-truncate","slds-cell-fixed","slds-grid","slds-grid_vertical-align-center",2,"width","fit-content"],["label","LBL_CURRENCY"],[4,"ngFor","ngForOf"],["title","year",1,"slds-p-left--x-small","slds-truncate","slds-cell-fixed","slds-grid","slds-grid_vertical-align-center"],["scope","row",1,"slds-theme_shade","slds-text-title_caps"],["title","Company Code",1,"slds-truncate"],["scope","row",4,"ngFor","ngForOf"],["scope","row",1,"slds-theme_shade"],["title","EUR",1,"slds-truncate","slds-text-title_caps"],["scope","row"],["title","Revenue",1,"slds-truncate"],[1,"slds-align_absolute-center","slds-p-vertical--medium"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,I,14,3,"div",1)(2,F,1,0,"system-spinner",2)(3,k,3,0,"div",3),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",e.companyCodes.length>0),r.R7$(),r.Y8G("ngIf",e.isLoading),r.R7$(),r.Y8G("ngIf",!e.isLoading&&0==e.companyCodes.length))},dependencies:[i.Sq,i.bT,i.B3,p.W,b.P],encapsulation:2})}return AccountsKPIsOverview})();var x=s(41731);const G=["ccdetailscontainer"];let A=(()=>{class AccountCCDetailsTab{constructor(t,e,s){this.language=t,this.metadata=e,this.model=s,this.data=void 0,this.componentconfig={},this.ccode={},this.model.module="AccountCCDetails"}ngOnInit(){this.setModelData()}ngAfterViewInit(){this.renderView()}setModelData(){this.data?(this.model.id=this.data.id,this.model.setFields(this.model.utils.backendModel2spice(this.model.module,this.data))):(this.model.initialize(this.parent),this.model.setFields({name:this.ccode.name,companycode_id:this.ccode.id}),this.model.getField("account_id")||this.model.setFields({account_id:this.parent.id,account_name:this.parent.getField("name")}))}renderView(){_.isEmpty(this.componentconfig)&&(this.componentconfig=this.metadata.getComponentConfig("AccountCCDetails","AccountCCDetails"),_.isEmpty(this.componentconfig)&&(this.componentconfig=this.metadata.getComponentConfig("AccountCCDetailsTab","Accounts")));let t=this.componentconfig.componentset;if(t){let e=this.metadata.getComponentSetObjects(t);for(let t of e)this.metadata.addComponent(t.component,this.ccdetailscontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig}))}}static#t=this.ɵfac=function(t){return new(t||AccountCCDetailsTab)(r.rXU(f.B),r.rXU(g.yu),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountCCDetailsTab,selectors:[["account-cc-details-tab"]],viewQuery:function(t,e){if(1&t&&r.GBs(G,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.ccdetailscontainer=t.first)}},inputs:{data:"data",componentconfig:"componentconfig",parent:"parent",ccode:"ccode"},features:[r.Jv_([h.g])],decls:2,vars:0,consts:[["ccdetailscontainer",""]],template:function(t,e){1&t&&r.nrm(0,"div",null,0)},encapsulation:2})}return AccountCCDetailsTab})();const R=t=>({"slds-active":t});function $(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",8),r.bIt("click",(function(){const e=r.eBV(t).index,s=r.XpG(2);return r.Njj(s.setActiveTab(e))})),r.j41(1,"a",9),r.EFF(2),r.k0s()()}if(2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.Y8G("ngClass",r.eq3(2,R,s===i.activeTab)),r.R7$(2),r.SpI(" ",t.companycode," ")}}function j(t,e){if(1&t&&(r.qex(0),r.j41(1,"div",10),r.nrm(2,"account-cc-details-tab",11),r.k0s(),r.bVm()),2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.R7$(),r.Y8G("ngStyle",i.getContentContainerStyle(s)),r.R7$(),r.Y8G("ccode",t)("parent",i.model)("data",i.getCCDetailsData(t))}}function X(t,e){if(1&t&&(r.j41(0,"div",4)(1,"ul",5),r.DNE(2,$,3,4,"li",6),r.k0s(),r.DNE(3,j,3,4,"ng-container",7),r.k0s()),2&t){const t=r.XpG();r.R7$(2),r.Y8G("ngForOf",t.companyCodes)("ngForTrackBy",t.trackByFn),r.R7$(),r.Y8G("ngForOf",t.companyCodes)("ngForTrackBy",t.trackByFn)}}function w(t,e){1&t&&r.nrm(0,"system-spinner")}function T(t,e){1&t&&(r.j41(0,"div",12),r.nrm(1,"system-label",13),r.k0s())}let U=(()=>{class AccountCCDetails{constructor(t,e,s,i){this.language=t,this.model=e,this.backend=s,this.view=i,this.companyCodes=[],this.activatedTabs=[],this.activeTab=0,this.isLoading=!1,this.loadCompanyCodes()}ngOnInit(){this.view.isEditable=!0}loadCompanyCodes(){this.isLoading=!0;let t=JSON.stringify(["companycode","date_modified","description","id"]);this.backend.getRequest("module/CompanyCodes",{fields:t}).subscribe((t=>{this.companyCodes=t.list})),this.isLoading=!1}setActiveTab(t){this.activatedTabs.push(t),this.activeTab=t}getCCDetailsData(t){let e=this.model.data.accountccdetails.beans;for(let s in e)if(e.hasOwnProperty(s)&&e[s].companycode_id==t.id)return e[s]}getContentContainerStyle(t){return{display:t!==this.activeTab?"none":"block",padding:".25rem"}}trackByFn(t,e){return t}static#t=this.ɵfac=function(t){return new(t||AccountCCDetails)(r.rXU(f.B),r.rXU(h.g),r.rXU(m.H),r.rXU(x.U))};static#e=this.ɵcmp=r.VBU({type:AccountCCDetails,selectors:[["ng-component"]],decls:4,vars:3,consts:[[1,"slds-grid","slds-m-top--x-small","slds-p-around--xxx-small",2,"border-radius",".25rem","border","1px solid #dddbda"],["class","slds-tabs--default",4,"ngIf"],[4,"ngIf"],["class","slds-align_absolute-center slds-p-around--small",4,"ngIf"],[1,"slds-tabs--default"],["role","tablist",1,"slds-tabs--default__nav"],["class","slds-tabs--default__item slds-text-title--caps","role","presentation",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],["role","presentation",1,"slds-tabs--default__item","slds-text-title--caps",3,"ngClass","click"],["href","javascript:void(0);","role","tab","aria-selected","false",1,"slds-tabs--default__link"],["role","tabpanel",1,"slds-tabs--default__content","slds-p-around--xx-small","slds-show",3,"ngStyle"],[3,"ccode","parent","data"],[1,"slds-align_absolute-center","slds-p-around--small"],["label","LBL_NO_ENTRIES"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,X,4,4,"div",1)(2,w,1,0,"system-spinner",2)(3,T,2,0,"div",3),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",!e.isLoading&&e.companyCodes.length>0),r.R7$(),r.Y8G("ngIf",e.isLoading),r.R7$(),r.Y8G("ngIf",!e.isLoading&&0==e.companyCodes.length))},dependencies:[i.YU,i.Sq,i.bT,i.B3,p.W,b.P,A],encapsulation:2})}return AccountCCDetails})();var B=s(60595);let E=(()=>{class AccountTerritoryDetailsTab{constructor(t,e,s,i){this.language=t,this.metadata=e,this.parent=s,this.model=i,this.data=void 0,this.componentconfig={},this.model.module="AccountCCDetails"}ngOnInit(){this.setModelData()}ngAfterViewInit(){this.renderView()}setModelData(){this.data?(this.model.id=this.data.id,this.model.setFields(this.model.utils.backendModel2spice(this.model.module,this.data))):(this.model.initialize(this.parent),this.model.getField("account_id")||this.model.setFields({account_id:this.parent.id,account_name:this.parent.getField("name")}))}renderView(){_.isEmpty(this.componentconfig)&&(this.componentconfig=this.metadata.getComponentConfig("AccountTerritoryDetails","AccountCCDetails")),this.componentset=this.componentconfig.componentset}static#t=this.ɵfac=function(t){return new(t||AccountTerritoryDetailsTab)(r.rXU(f.B),r.rXU(g.yu),r.rXU(h.g,4),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountTerritoryDetailsTab,selectors:[["account-territory-details-tab"]],inputs:{data:"data",componentconfig:"componentconfig"},features:[r.Jv_([h.g])],decls:1,vars:1,consts:[[3,"componentset"]],template:function(t,e){1&t&&r.nrm(0,"system-componentset",0),2&t&&r.Y8G("componentset",e.componentset)},dependencies:[B.F],encapsulation:2})}return AccountTerritoryDetailsTab})();const Y=t=>({"slds-active":t});function O(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",8),r.bIt("click",(function(){const e=r.eBV(t).index,s=r.XpG(2);return r.Njj(s.setActiveTab(e))})),r.j41(1,"a",9),r.EFF(2),r.k0s()()}if(2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.Y8G("ngClass",r.eq3(2,Y,s===i.activeTab)),r.R7$(2),r.SpI(" ",t.name," ")}}const N=t=>({"slds-hide":t});function M(t,e){if(1&t&&(r.qex(0),r.j41(1,"div",10),r.nrm(2,"account-territory-details-tab",11),r.k0s(),r.bVm()),2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.R7$(),r.Y8G("ngClass",r.eq3(2,N,s!=i.activeTab)),r.R7$(),r.Y8G("data",t)}}function L(t,e){if(1&t&&(r.j41(0,"div",4)(1,"ul",5),r.DNE(2,O,3,4,"li",6),r.k0s(),r.DNE(3,M,3,4,"ng-container",7),r.k0s()),2&t){const t=r.XpG();r.R7$(2),r.Y8G("ngForOf",t.getCCDetails())("ngForTrackBy",t.trackByFn),r.R7$(),r.Y8G("ngForOf",t.getCCDetails())("ngForTrackBy",t.trackByFn)}}function S(t,e){1&t&&r.nrm(0,"system-spinner")}function V(t,e){1&t&&(r.j41(0,"div",12),r.nrm(1,"system-label",13),r.k0s())}let H=(()=>{class AccountTerritoryDetails{constructor(t,e,s,i){this.language=t,this.model=e,this.backend=s,this.view=i,this.companyCodes=[],this.activatedTabs=[],this.activeTab=0,this.isLoading=!1}ngOnInit(){this.view.isEditable=!0}setActiveTab(t){this.activatedTabs.push(t),this.activeTab=t}getCCDetails(){return this.model.data?.accountccdetails?.beans?_.toArray(this.model.data.accountccdetails.beans):[]}getCCDetailsData(t){let e=this.model.data.accountccdetails.beans;for(let s in e)if(e.hasOwnProperty(s)&&e[s].companycode_id==t.id)return e[s]}trackByFn(t,e){return t}static#t=this.ɵfac=function(t){return new(t||AccountTerritoryDetails)(r.rXU(f.B),r.rXU(h.g),r.rXU(m.H),r.rXU(x.U))};static#e=this.ɵcmp=r.VBU({type:AccountTerritoryDetails,selectors:[["ng-component"]],decls:4,vars:3,consts:[[1,"slds-grid","slds-m-top--x-small","slds-p-around--xxx-small",2,"border-radius",".25rem","border","1px solid #dddbda"],["class","slds-tabs--default",4,"ngIf"],[4,"ngIf"],["class","slds-align_absolute-center slds-p-around--small",4,"ngIf"],[1,"slds-tabs--default"],["role","tablist",1,"slds-tabs--default__nav"],["class","slds-tabs--default__item slds-text-title--caps","role","presentation",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],["role","presentation",1,"slds-tabs--default__item","slds-text-title--caps",3,"ngClass","click"],["href","javascript:void(0);","role","tab","aria-selected","false",1,"slds-tabs--default__link"],["role","tabpanel",1,"slds-tabs--default__content","slds-p-around--xx-small","slds-show",3,"ngClass"],[3,"data"],[1,"slds-align_absolute-center","slds-p-around--small"],["label","LBL_NO_ENTRIES"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,L,4,4,"div",1)(2,S,1,0,"system-spinner",2)(3,V,2,0,"div",3),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",e.getCCDetails().length>0),r.R7$(),r.Y8G("ngIf",e.isLoading),r.R7$(),r.Y8G("ngIf",0==e.getCCDetails().length))},dependencies:[i.YU,i.Sq,i.bT,p.W,b.P,E],encapsulation:2})}return AccountTerritoryDetails})();const q=["ccdetailscontainer"];let K=(()=>{class ContactCCDetailsTab{constructor(t,e,s){this.language=t,this.metadata=e,this.model=s,this.data=void 0,this.contactId=void 0,this.ccId=void 0,this.ccName=void 0}ngOnChanges(){this.setModelData()}ngOnInit(){this.model.module="ContactCCDetails"}ngAfterViewInit(){this.renderView()}renderView(){let t=this.metadata.getComponentConfig("ContactCCDetailsTab","Accounts").componentset;if(t){let e=this.metadata.getComponentSetObjects(t);for(let t of e)this.metadata.addComponent(t.component,this.ccdetailscontainer).subscribe((e=>{e.instance.componentconfig=t.componentconfig}))}}setModelData(){this.data?(this.model.id=this.data.id,this.model.setData(this.data)):(this.model.id=this.model.generateGuid(),this.model.setData({id:this.model.id,name:this.ccName,contact_id:this.contactId,companycode_id:this.ccId,date_entered:new moment,date_modified:new moment},!1))}static#t=this.ɵfac=function(t){return new(t||ContactCCDetailsTab)(r.rXU(f.B),r.rXU(g.yu),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:ContactCCDetailsTab,selectors:[["contact-cc-details-tab"]],viewQuery:function(t,e){if(1&t&&r.GBs(q,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.ccdetailscontainer=t.first)}},inputs:{data:"data",contactId:[r.Mj6.None,"contactid","contactId"],ccId:[r.Mj6.None,"ccid","ccId"],ccName:[r.Mj6.None,"ccname","ccName"]},features:[r.Jv_([h.g]),r.OA$],decls:2,vars:0,consts:[["ccdetailscontainer",""]],template:function(t,e){1&t&&r.nrm(0,"div",null,0)},encapsulation:2})}return ContactCCDetailsTab})();const J=t=>({"slds-active":t});function P(t,e){if(1&t){const t=r.RV6();r.j41(0,"li",8),r.bIt("click",(function(){const e=r.eBV(t).index,s=r.XpG(2);return r.Njj(s.setActiveTab(e))})),r.j41(1,"a",9),r.EFF(2),r.k0s()()}if(2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.Y8G("ngClass",r.eq3(2,J,s===i.activeTab)),r.R7$(2),r.SpI(" ",t.companycode," ")}}function z(t,e){if(1&t&&(r.qex(0),r.j41(1,"div",10),r.nrm(2,"contact-cc-details-tab",11),r.k0s(),r.bVm()),2&t){const t=e.$implicit,s=e.index,i=r.XpG(2);r.R7$(),r.Y8G("ngStyle",i.getContentContainerStyle(s)),r.R7$(),r.Y8G("ccid",t.id)("ccname",t.companycode)("contactid",i.model.id)("data",i.getCCDetailsData(t))}}function W(t,e){if(1&t&&(r.j41(0,"div",4)(1,"ul",5),r.DNE(2,P,3,4,"li",6),r.k0s(),r.DNE(3,z,3,5,"ng-container",7),r.k0s()),2&t){const t=r.XpG();r.R7$(2),r.Y8G("ngForOf",t.companyCodes)("ngForTrackBy",t.trackByFn),r.R7$(),r.Y8G("ngForOf",t.companyCodes)("ngForTrackBy",t.trackByFn)}}function Q(t,e){1&t&&r.nrm(0,"system-spinner")}function Z(t,e){1&t&&(r.j41(0,"div",12),r.nrm(1,"system-label",13),r.k0s())}let tt=(()=>{class ContactCCDetails{constructor(t,e,s,i,n){this.language=t,this.model=e,this.acmService=s,this.backend=i,this.view=n,this.activatedTabs=[],this.companyCodes=[],this.activeTab=0,this.contactccdetails={},this.isLoading=!1,this.loadCompanyCode(),this.subscribeContactCCDetailsChanges()}get contactCCDetails(){return this.contactccdetails}set contactCCDetails(t){this.contactccdetails=t}ngOnInit(){this.view.isEditable=!0}ngOnDestroy(){this.accountsContactsManagerSubscriber.unsubscribe()}setActiveTab(t){this.activatedTabs.push(t),this.activeTab=t}getCCDetailsData(t){if(!_.isEmpty(this.contactCCDetails))for(let e in this.contactCCDetails)if(this.contactCCDetails[e].companycode_id==t.id)return this.contactCCDetails[e]}getContentContainerStyle(t){return{display:t!==this.activeTab?"none":"block",padding:".25rem"}}loadCompanyCode(){this.isLoading=!0;let t=JSON.stringify(["companycode","date_modified","description","id"]);this.backend.getRequest("module/CompanyCodes",{fields:t}).subscribe((t=>{this.companyCodes=t.list,this.isLoading=!1}))}subscribeContactCCDetailsChanges(){this.accountsContactsManagerSubscriber=this.acmService.contactCCDetails$.subscribe((t=>{this.activeTab=0,this.companyCodes=this.companyCodes.slice(),this.contactCCDetails=t}))}trackByFn(t,e){return t}static#t=this.ɵfac=function(t){return new(t||ContactCCDetails)(r.rXU(f.B),r.rXU(h.g),r.rXU(u),r.rXU(m.H),r.rXU(x.U))};static#e=this.ɵcmp=r.VBU({type:ContactCCDetails,selectors:[["contact-cc-details"]],features:[r.Jv_([x.U])],decls:4,vars:3,consts:[[1,"slds-grid","slds-m-top--x-small","slds-p-around--xxx-small",2,"border-radius",".25rem","border","1px solid #dddbda"],["class","slds-tabs--default",4,"ngIf"],[4,"ngIf"],["class","slds-align_absolute-center slds-p-around--small",4,"ngIf"],[1,"slds-tabs--default"],["role","tablist",1,"slds-tabs--default__nav"],["class","slds-tabs--default__item slds-text-title--caps","role","presentation",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],["role","presentation",1,"slds-tabs--default__item","slds-text-title--caps",3,"ngClass","click"],["href","javascript:void(0);","role","tab","aria-selected","false",1,"slds-tabs--default__link"],["role","tabpanel",1,"slds-tabs--default__content","slds-p-around--xx-small","slds-show",3,"ngStyle"],[3,"ccid","ccname","contactid","data"],[1,"slds-align_absolute-center","slds-p-around--small"],["label","LBL_NO_ENTRIES"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,W,4,4,"div",1)(2,Q,1,0,"system-spinner",2)(3,Z,2,0,"div",3),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",!e.isLoading&&e.companyCodes.length>0),r.R7$(),r.Y8G("ngIf",e.isLoading),r.R7$(),r.Y8G("ngIf",!e.isLoading&&0==e.companyCodes.length))},dependencies:[i.YU,i.Sq,i.bT,i.B3,p.W,b.P,K],encapsulation:2})}return ContactCCDetails})();var et=s(91107),st=s(57949);const it=["detailscontainer"];function nt(t,e){1&t&&(r.j41(0,"div",4)(1,"span"),r.nrm(2,"system-label",5),r.k0s()())}let at=(()=>{class AccountsContactsManagerDetails{constructor(t,e,s,i,n,a){this.language=t,this.metadata=e,this.view=s,this.acmService=i,this.relatedmodels=n,this.model=a,this.activeContactId=void 0,this.renderedComponents=[],this.model.module="Contacts"}ngAfterViewInit(){this.buildContainer()}ngOnChanges(){this.activeContactId&&(this.resetView(),this.buildContainer(),this.view.setViewMode(),this.model.id=this.activeContactId,this.model.getData(!0,"",!0).subscribe((t=>{_.isEmpty(t.contactccdetails.beans)?this.acmService.contactCCDetails={}:this.acmService.contactCCDetails=t.contactccdetails.beans})))}resetView(){for(let t of this.renderedComponents)t.destroy();this.renderedComponents=[]}buildContainer(){let t=this.metadata.getComponentConfig("AccountsContactsManager","Accounts").detailscomponentset;if(t){let e=this.metadata.getComponentSetObjects(t);for(let t of e)this.metadata.addComponent(t.component,this.detailscontainer).subscribe((e=>{this.renderedComponents.push(e),e.instance.componentconfig=t.componentconfig}))}}static#t=this.ɵfac=function(t){return new(t||AccountsContactsManagerDetails)(r.rXU(f.B),r.rXU(g.yu),r.rXU(x.U),r.rXU(u),r.rXU(et.K),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountsContactsManagerDetails,selectors:[["accounts-contacts-manager-details"]],viewQuery:function(t,e){if(1&t&&r.GBs(it,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.detailscontainer=t.first)}},inputs:{activeContactId:[r.Mj6.None,"activecontactid","activeContactId"]},features:[r.Jv_([h.g,x.U]),r.OA$],decls:5,vars:2,consts:[[1,"slds-scrollable--y","slds-p-around--x-small"],["class","slds-text-align_center slds-p-vertical--medium",4,"ngIf"],[3,"hidden"],["detailscontainer",""],[1,"slds-text-align_center","slds-p-vertical--medium"],["label","LBL_MAKE_SELECTION"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.DNE(1,nt,3,0,"div",1),r.j41(2,"div",2),r.nrm(3,"div",null,3),r.k0s()()),2&t&&(r.R7$(),r.Y8G("ngIf",!e.activeContactId),r.R7$(),r.Y8G("hidden",!e.activeContactId))},dependencies:[i.bT,p.W],encapsulation:2})}return AccountsContactsManagerDetails})();var ct=s(766),ot=s(15091),lt=s(98427);const dt=["tableContainer"];function rt(t,e){if(1&t&&(r.j41(0,"th",10)(1,"div",11),r.nrm(2,"field-label",12),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}function ut(t,e){if(1&t&&(r.j41(0,"td"),r.nrm(1,"field-container",15),r.k0s()),2&t){const t=e.$implicit;r.R7$(),r.Y8G("fieldname",t.field)("fieldconfig",t.fieldconfig)}}const mt=t=>({module:"Contacts",data:t}),ht=t=>({"slds-theme_shade":t}),gt=(t,e)=>({"border-bottom":t,"font-weight":e});function ft(t,e){if(1&t){const t=r.RV6();r.j41(0,"tr",13),r.bIt("click",(function(){const e=r.eBV(t).$implicit,s=r.XpG(2);return r.Njj(s.setActiveContactId(e.id))}))("mouseover",(function(){const e=r.eBV(t).$implicit,s=r.XpG(2);return r.Njj(s.hovered=e.id)}))("mouseout",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.hovered="")})),r.DNE(1,ut,2,2,"td",14),r.k0s()}if(2&t){const t=e.$implicit,s=r.XpG(2);r.Y8G("system-model-provider",r.eq3(4,mt,t))("ngClass",r.eq3(6,ht,s.activeContactId==t.id))("ngStyle",r.l_i(8,gt,s.hovered==t.id?"1px solid darkred":"",s.activeContactId==t.id?"700":"")),r.R7$(),r.Y8G("ngForOf",s.listfields)}}function pt(t,e){if(1&t&&(r.j41(0,"div",3,4)(2,"div",5)(3,"table",6)(4,"thead")(5,"tr",7),r.DNE(6,rt,3,2,"th",8),r.k0s()(),r.j41(7,"tbody"),r.DNE(8,ft,2,11,"tr",9),r.k0s()()()()),2&t){const t=r.XpG();r.Y8G("ngStyle",t.tableHeight),r.R7$(6),r.Y8G("ngForOf",t.listfields),r.R7$(2),r.Y8G("ngForOf",t.contacts)}}function bt(t,e){1&t&&r.nrm(0,"system-spinner")}function vt(t,e){1&t&&(r.j41(0,"div",16)(1,"span"),r.nrm(2,"system-label",17),r.k0s()())}let Ct=(()=>{class AccountsContactsManagerList{constructor(t,e,s,i){this.language=t,this.metadata=e,this.relatedmodels=s,this.model=i,this.listfields=[],this.hovered="",this.fieldset="",this.tableheight={},this.activeContactId$=new r.bkB,this.activeContactId=void 0,this.model.module="Contacts"}ngOnInit(){let t=this.metadata.getComponentConfig("AccountsContactsManager","Accounts");this.listfields=this.metadata.getFieldSetFields(t.listfieldset)}setActiveContactId(t){this.activeContactId=t,this.activeContactId$.emit(t)}get contacts(){return this.relatedmodels.items}get tableHeight(){return this.tableheight}get isloading(){return this.relatedmodels.isloading}static#t=this.ɵfac=function(t){return new(t||AccountsContactsManagerList)(r.rXU(f.B),r.rXU(g.yu),r.rXU(et.K),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountsContactsManagerList,selectors:[["accounts-contacts-manager-list"]],viewQuery:function(t,e){if(1&t&&r.GBs(dt,7,r.c1b),2&t){let t;r.mGM(t=r.lsd())&&(e.tableContainer=t.first)}},inputs:{fieldset:"fieldset",tableheight:[r.Mj6.None,"tableHeight","tableheight"]},outputs:{activeContactId$:"activeContactId$"},features:[r.Jv_([x.U,h.g])],decls:3,vars:3,consts:[["class","slds-table--header-fixed_container",3,"ngStyle",4,"ngIf"],[4,"ngIf"],["class","slds-text-align_center slds-p-vertical--medium",4,"ngIf"],[1,"slds-table--header-fixed_container",3,"ngStyle"],["tableContainer",""],[1,"slds-scrollable--y",2,"height","100%"],[1,"slds-table","slds-table_bordered","slds-table_cell-buffer","slds-table_header-fixed",2,"border-top","0"],[1,"slds-text-title_caps"],["scope","col",4,"ngFor","ngForOf"],["style","cursor: pointer",3,"system-model-provider","ngClass","ngStyle","click","mouseover","mouseout",4,"ngFor","ngForOf"],["scope","col"],[1,"slds-truncate","slds-cell-fixed","slds-grid","slds-grid_vertical-align-center"],[3,"fieldname","fieldconfig"],[2,"cursor","pointer",3,"system-model-provider","ngClass","ngStyle","click","mouseover","mouseout"],[4,"ngFor","ngForOf"],["fielddisplayclass","slds-truncate",3,"fieldname","fieldconfig"],[1,"slds-text-align_center","slds-p-vertical--medium"],["label","LBL_NO_ENTRIES"]],template:function(t,e){1&t&&r.DNE(0,pt,9,3,"div",0)(1,bt,1,0,"system-spinner",1)(2,vt,3,0,"div",2),2&t&&(r.Y8G("ngIf",!e.isloading&&(null==e.contacts?null:e.contacts.length)>0),r.R7$(),r.Y8G("ngIf",e.isloading),r.R7$(),r.Y8G("ngIf",!e.isloading&&0==(null==e.contacts?null:e.contacts.length)))},dependencies:[i.YU,i.Sq,i.bT,i.B3,ct.b,ot.y,p.W,b.P,lt.v],encapsulation:2})}return AccountsContactsManagerList})();const yt=()=>({object:"Contacts"});let _t=(()=>{class AccountsContactsManager{constructor(t,e,s,i,n){this.language=t,this.metadata=e,this.relatedmodels=s,this.acmService=i,this.model=n,this.editcomponentset="",this.module="",this.displayitems=5,this.activeContactId=void 0,this.relatedmodels.module=this.model.module,this.relatedmodels.id=this.model.id}setActiveContactId(t){this.activeContactId=t}get childrenHeight(){return{height:"340px"}}get mainStyle(){return{height:"350pxpx","border-radius":".25rem",border:"1px solid #dddbda"}}ngAfterViewInit(){this.loadRelated()}loadRelated(){this.relatedmodels.relatedModule="Contacts",this.relatedmodels.getData()}ngOnDestroy(){this.relatedmodels.stopSubscriptions()}aclAccess(){return this.metadata.checkModuleAcl(this.module,"list")}static#t=this.ɵfac=function(t){return new(t||AccountsContactsManager)(r.rXU(f.B),r.rXU(g.yu),r.rXU(et.K),r.rXU(u),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountsContactsManager,selectors:[["accounts-contacts-manager"]],features:[r.Jv_([et.K,u])],decls:6,vars:5,consts:[[3,"componentconfig"],[1,"slds-grid","slds-border--top",2,"height","350px"],[1,"slds-size--1-of-3","slds-border--right","slds-p-around--xxx-small"],[3,"tableHeight","activeContactId$"],[1,"slds-size--2-of-3",3,"ngStyle"],[3,"activecontactid"]],template:function(t,e){1&t&&(r.j41(0,"object-related-card",0)(1,"div",1)(2,"div",2)(3,"accounts-contacts-manager-list",3),r.bIt("activeContactId$",(function(t){return e.setActiveContactId(t)})),r.k0s()(),r.j41(4,"div",4),r.nrm(5,"accounts-contacts-manager-details",5),r.k0s()()()),2&t&&(r.Y8G("componentconfig",r.lJ4(4,yt)),r.R7$(3),r.Y8G("tableHeight",e.childrenHeight),r.R7$(),r.Y8G("ngStyle",e.childrenHeight),r.R7$(),r.Y8G("activecontactid",e.activeContactId))},dependencies:[i.B3,st.B,at,Ct],encapsulation:2})}return AccountsContactsManager})();var It=s(21413);let Ft=(()=>{class accountHierarchy{constructor(t){this.backend=t,this.httpRequestsRefID=window._.uniqueId("account_hierarchy_http_ref_"),this.parentId="",this.requestedFields=[],this.members=[],this.membersList=[]}loadHierachy(t=this.parentId,e=!1){let s=new It.B,i=[];for(let t of this.requestedFields)i.push(t.field);return this.backend.getRequest(`module/Accounts/${t}/hierarchy/${JSON.stringify(i)}`,null,this.httpRequestsRefID).subscribe((i=>{for(let e of i)this.members.push({parent_id:t,id:e.id,member_count:e.member_count,expanded:!1,loaded:!1,summary_text:e.summary_text,data:e.data});this.members.some((s=>{if(s.id===t)return s.loaded=!0,e&&(s.expanded=!0),!0})),this.rebuildMembersList(),s.next(!0),s.complete()})),s.asObservable()}expand(t){this.members.some((e=>{if(e.id===t)return e.loaded?e.expanded=!0:this.loadHierachy(t,!0),!0})),this.rebuildMembersList()}collapse(t){this.members.some((e=>{if(e.id===t)return e.expanded=!1,!0})),this.rebuildMembersList()}rebuildMembersList(){this.membersList=[],this.buildMembersList()}buildMembersList(t=this.parentId,e=0){for(let s of this.members)s.parent_id==t&&(this.membersList.push({level:e+1,id:s.id,member_count:parseInt(s.member_count,10),summary_text:s.summary_text,data:s.data,expanded:s.expanded}),s.expanded&&this.buildMembersList(s.id,e+1))}ngOnDestroy(){this.backend.cancelPendingRequests([this.httpRequestsRefID])}static#t=this.ɵfac=function(t){return new(t||accountHierarchy)(r.KVO(m.H))};static#e=this.ɵprov=r.jDH({token:accountHierarchy,factory:accountHierarchy.ɵfac})}return accountHierarchy})();var kt=s(68823),Dt=s(45915),xt=s(42205),Gt=s(25863);const At=["account-hierarchy-node",""];function Rt(t,e){if(1&t&&r.nrm(0,"system-button-icon",8),2&t){const t=r.XpG(3);r.Y8G("icon",t.getIcon())}}function $t(t,e){1&t&&r.nrm(0,"system-button-icon",8),2&t&&r.Y8G("icon","spinner")}function jt(t,e){if(1&t){const t=r.RV6();r.j41(0,"td",3)(1,"button",4),r.bIt("click",(function(){r.eBV(t);const e=r.XpG(2);return r.Njj(e.expandNode())})),r.DNE(2,Rt,1,1,"system-button-icon",5)(3,$t,1,1,"system-button-icon",5),r.k0s(),r.j41(4,"div",6),r.nrm(5,"field-container",7),r.k0s()()}if(2&t){const t=r.XpG().$implicit,e=r.XpG();r.R7$(),r.Y8G("disabled",0===e.nodedata.member_count),r.R7$(),r.Y8G("ngIf",!e.loading),r.R7$(),r.Y8G("ngIf",e.loading),r.R7$(2),r.Y8G("field",t.field)("fieldconfig",t.fieldconfig)("fielddisplayclass","slds-truncate")}}function Xt(t,e){if(1&t&&(r.j41(0,"td")(1,"div",6),r.nrm(2,"field-container",7),r.k0s()()),2&t){const t=r.XpG().$implicit;r.R7$(2),r.Y8G("field",t.field)("fieldconfig",t.fieldconfig)("fielddisplayclass","slds-truncate")}}function wt(t,e){if(1&t&&(r.qex(0),r.DNE(1,jt,6,6,"td",1)(2,Xt,3,3,"td",2),r.bVm()),2&t){const t=e.index;r.R7$(),r.Y8G("ngIf",0===t),r.R7$(),r.Y8G("ngIf",t>0)}}let Tt=(()=>{class AccountHierarchyNode{constructor(t,e,s,i,n){this.view=t,this.language=e,this.metadata=s,this.accountHierarchy=i,this.model=n,this.nodedata={},this.fields=[],this.loading=!1,this.view.displayLabels=!1}ngOnInit(){this.model.module="Accounts",this.model.id=this.nodedata.id,this.model.setData(this.nodedata.data)}expandNode(){this.nodedata.expanded?this.accountHierarchy.collapse(this.nodedata.id):(this.loading=!0,this.accountHierarchy.expand(this.nodedata.id))}getIcon(){switch(this.nodedata.expanded){case!1:return"chevronright";case!0:return"chevrondown"}}static#t=this.ɵfac=function(t){return new(t||AccountHierarchyNode)(r.rXU(x.U),r.rXU(f.B),r.rXU(g.yu),r.rXU(Ft),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountHierarchyNode,selectors:[["","account-hierarchy-node",""]],hostVars:1,hostBindings:function(t,e){2&t&&r.BMQ("aria-level",e.nodedata.level)},inputs:{nodedata:"nodedata",fields:"fields"},features:[r.Jv_([h.g,x.U])],attrs:At,decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["scope","row","class","slds-tree__item",4,"ngIf"],[4,"ngIf"],["scope","row",1,"slds-tree__item"],[1,"slds-button","slds-button--icon","slds-button--icon-x-small","slds-m-right--x-small",3,"disabled","click"],[3,"icon",4,"ngIf"],[1,"slds-truncate"],[3,"field","fieldconfig","fielddisplayclass"],[3,"icon"]],template:function(t,e){1&t&&r.DNE(0,wt,3,2,"ng-container",0),2&t&&r.Y8G("ngForOf",e.fields)},dependencies:[i.Sq,i.bT,ot.y,Gt.t],encapsulation:2})}return AccountHierarchyNode})();function Ut(t,e){if(1&t&&(r.j41(0,"th",14)(1,"div",15),r.nrm(2,"system-label-fieldname",16),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.Y8G("field",t.field)}}function Bt(t,e){if(1&t&&r.nrm(0,"tr",17),2&t){const t=e.$implicit,s=r.XpG();r.Y8G("nodedata",t)("fields",s.fieldsetFields)}}function Et(t,e){if(1&t&&r.nrm(0,"tbody",18),2&t){const t=r.XpG();r.Y8G("columns",t.fieldsetFields.length)("rows",5)}}let Yt=(()=>{class AccountHierarchy{constructor(t,e,s,i){this.language=t,this.metadata=e,this.accountHierarchy=s,this.model=i,this.componentconfig={},this.fieldsetFields=[],this.loading=!1}loadHierarchy(){return this.accountHierarchy.parentId=this.model.id,this.accountHierarchy.requestedFields=this.fieldsetFields,this.accountHierarchy.loadHierachy()}ngOnInit(){this.fieldsetFields=this.metadata.getFieldSetFields(this.componentconfig.fieldset),this.loading=!0,this.loadHierarchy().subscribe((t=>{this.loading=!1}))}static#t=this.ɵfac=function(t){return new(t||AccountHierarchy)(r.rXU(f.B),r.rXU(g.yu),r.rXU(Ft),r.rXU(h.g))};static#e=this.ɵcmp=r.VBU({type:AccountHierarchy,selectors:[["account-hierarchy"]],features:[r.Jv_([Ft])],decls:17,vars:5,consts:[[1,"slds-card","slds-card_boundary","slds-m-bottom--medium"],[1,"slds-card__header","slds-grid"],[1,"slds-media","slds-media--center","slds-has-flexi-truncate"],[3,"icon","size"],[1,"slds-media__body","slds-truncate"],["href","javascript:void(0);",1,"slds-text-link--reset"],[1,"slds-text-heading--small"],["label","LBL_SUBSIDIARIES"],[1,"slds-card__body"],["role","treegrid",1,"slds-table","slds-table--bordered","slds-tree","slds-table--tree"],[1,"slds-text-title--caps"],["class","slds-cell-buffer--left","scope","col",4,"ngFor","ngForOf"],["account-hierarchy-node","","class","slds-hint-parent","role","row","aria-expanded","true",3,"nodedata","fields",4,"ngFor","ngForOf"],["system-table-stencils","",3,"columns","rows",4,"ngIf"],["scope","col",1,"slds-cell-buffer--left"],[1,"slds-truncate"],["module","Accounts",3,"field"],["account-hierarchy-node","","role","row","aria-expanded","true",1,"slds-hint-parent",3,"nodedata","fields"],["system-table-stencils","",3,"columns","rows"]],template:function(t,e){1&t&&(r.j41(0,"article",0)(1,"div",1)(2,"header",2),r.nrm(3,"system-icon",3),r.j41(4,"div",4)(5,"h2")(6,"a",5)(7,"span",6),r.nrm(8,"system-label",7),r.k0s()()()()()(),r.j41(9,"div",8)(10,"table",9)(11,"thead")(12,"tr",10),r.DNE(13,Ut,3,1,"th",11),r.k0s()(),r.j41(14,"tbody"),r.DNE(15,Bt,1,2,"tr",12),r.k0s(),r.DNE(16,Et,1,2,"tbody",13),r.k0s()()()),2&t&&(r.R7$(3),r.Y8G("icon","hierarchy")("size","small"),r.R7$(10),r.Y8G("ngForOf",e.fieldsetFields),r.R7$(2),r.Y8G("ngForOf",e.accountHierarchy.membersList),r.R7$(),r.Y8G("ngIf",e.loading))},dependencies:[i.Sq,i.bT,kt.J,p.W,Dt.P,xt.t,Tt],encapsulation:2})}return AccountHierarchy})();var Ot=s(13921),Nt=s(57363),Mt=s(41081),Lt=s(66935),St=s(89166),Vt=s(39207);function Ht(t,e){if(1&t&&r.nrm(0,"field-label",3),2&t){const t=r.XpG();r.Y8G("fieldname",t.fieldname)("fieldconfig",t.fieldconfig)}}function qt(t,e){if(1&t&&(r.j41(0,"field-generic-display",6),r.nrm(1,"div",7),r.j41(2,"div"),r.EFF(3),r.k0s()()),2&t){const t=e.$implicit,s=r.XpG(2);r.Y8G("fielddisplayclass",s.fielddisplayclass)("fieldconfig",s.fieldconfig)("editable",s.isEditable()),r.R7$(),r.Y8G("ngStyle",s.getColor(t.id)),r.R7$(2),r.Lme(" (",t.country,") ",t.vat_id," ")}}function Kt(t,e){if(1&t&&(r.j41(0,"div",4),r.DNE(1,qt,4,6,"field-generic-display",5),r.k0s()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngForOf",t.getAccountVATIDs())}}function Jt(t,e){if(1&t&&(r.j41(0,"option",28),r.EFF(1),r.k0s()),2&t){const t=e.$implicit;r.Y8G("value",t.value),r.R7$(),r.JRh(t.display)}}function Pt(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",22)(1,"div",23)(2,"div",24)(3,"select",25,17),r.mxI("ngModelChange",(function(e){r.eBV(t);const s=r.XpG().$implicit;return r.DH7(s.country,e)||(s.country=e),r.Njj(e)})),r.DNE(5,Jt,2,2,"option",26),r.k0s()(),r.nrm(6,"field-messages",27),r.k0s()()}if(2&t){const t=r.XpG().$implicit,e=r.XpG(2);r.R7$(),r.Y8G("ngClass",e.getFieldClass()),r.R7$(2),r.R50("ngModel",t.country),r.R7$(2),r.Y8G("ngForOf",e.options),r.R7$(),r.Y8G("fieldname",e.fieldname)}}function zt(t,e){if(1&t&&r.nrm(0,"system-tooltip",29),2&t){const t=r.XpG().$implicit,e=r.XpG(2);r.Y8G("tooltiptext",e.vatInfo(t.id))}}function Wt(t,e){if(1&t){const t=r.RV6();r.j41(0,"div",12)(1,"button",13)(2,"system-button-icon",14),r.bIt("click",(function(){const e=r.eBV(t).$implicit,s=r.XpG(2);return r.Njj(s.delete(e.id))})),r.k0s()(),r.DNE(3,Pt,7,4,"div",15),r.j41(4,"input",16,17),r.mxI("ngModelChange",(function(e){const s=r.eBV(t).$implicit;return r.DH7(s.vat_id,e)||(s.vat_id=e),r.Njj(e)})),r.k0s(),r.j41(6,"div",18),r.DNE(7,zt,1,1,"system-tooltip",19),r.j41(8,"button",20),r.bIt("click",(function(){const e=r.eBV(t).$implicit,s=r.XpG(2);return r.Njj(s.validate(e.country,e.vat_id,e.id))})),r.nrm(9,"system-label",21),r.k0s()()()}if(2&t){const t=e.$implicit,s=r.XpG(2);r.R7$(3),r.Y8G("ngIf",s.isEditMode()),r.R7$(),r.R50("ngModel",t.vat_id),r.R7$(3),r.Y8G("ngIf",s.isvalid(t.id)),r.R7$(),r.Y8G("disabled",!s.canCheck(t.vat_id))}}function Qt(t,e){if(1&t){const t=r.RV6();r.j41(0,"div"),r.DNE(1,Wt,10,4,"div",8),r.j41(2,"div",9)(3,"button",10)(4,"system-button-icon",11),r.bIt("click",(function(){r.eBV(t);const e=r.XpG();return r.Njj(e.add())})),r.k0s()()()()}if(2&t){const t=r.XpG();r.R7$(),r.Y8G("ngForOf",t.getAccountVATIDs())}}let Zt=(()=>{class AccountVATIDField extends Ot.s{constructor(t,e,s,i,n,a,c){super(t,e,s,i,n),this.model=t,this.view=e,this.language=s,this.metadata=i,this.router=n,this.backend=a,this.toast=c,this.isvalidating=!1,this.options=[],this.subscriptions.add(this.language.currentlanguage$.subscribe((t=>{this.getOptions()})))}get emptyVATIDS(){return this.getAccountVATIDs().length>0}ngOnInit(){this.getOptions(),this.model.getField("accountvatids")||this.model.initializeField("accountvatids",{beans:{},beans_relations_to_delete:{}}),this.getAccountVATIDs()}getOptions(){let t=[],e=this.language.getFieldDisplayOptions("AccountVATIDs","country");for(let s in e)t.push({value:s,display:e[s]});if(this.options=t,this.fieldconfig.sortdirection)switch(this.fieldconfig.sortdirection.toLowerCase()){case"desc":this.options.sort(((t,e)=>t.display.toLowerCase()<e.display.toLowerCase()?1:-1));break;case"asc":this.options.sort(((t,e)=>t.display.toLowerCase()>e.display.toLowerCase()?1:-1))}}getColor(t){let e="gray";switch(this.model.getField("accountvatids").beans[t].vatid_status){case"valid":e="green";break;case"not_valid":e="red"}return{"background-color":e}}getAccountVATIDs(){let t=[];if(this.model.getField("accountvatids")){let e=this.model.getField("accountvatids");for(let s in e.beans)1!=e.beans[s].deleted&&t.push(e.beans[s])}return t}validate(t,e,s){this.isvalidating=!0,this.backend.getRequest(`module/Account/${t+e}/vatids`).subscribe((t=>{"success"==t.status?!0!==t.data.valid?(this.toast.sendToast(this.language.getLabel("ERR_INVALID_VAT"),"error"),this.model.getField("accountvatids").beans[s].vatid_status="not_valid"):(this.model.getField("accountvatids").beans[s].verification_details=JSON.stringify(t.data),this.model.getField("accountvatids").beans[s].vatid_status="valid",this.toast.sendToast(this.language.getLabel("VALID_VAT"),"success")):this.toast.sendToast(this.language.getLabel("ERR_CHECK_VAT"),"error"),this.isvalidating=!1}))}canCheck(t){return t.length>3}add(){let t=this.model.generateGuid();this.model.getField("accountvatids").beans[t]={id:t,account_id:this.model.id,account_name:this.model.displayname,vat_id:"",vatid_status:"",country:""},this.getAccountVATIDs()}delete(t){this.model.getField("accountvatids").beans[t].deleted=1,this.getAccountVATIDs()}isvalid(t){return"valid"==this.model.getField("accountvatids").beans[t].vatid_status}vatInfo(t){let e=JSON.parse(this.model.getField("accountvatids").beans[t].verification_details);return e.name+"\n"+e.address}static#t=this.ɵfac=function(t){return new(t||AccountVATIDField)(r.rXU(h.g),r.rXU(x.U),r.rXU(f.B),r.rXU(g.yu),r.rXU(Nt.Ix),r.rXU(m.H),r.rXU(Mt.o))};static#e=this.ɵcmp=r.VBU({type:AccountVATIDField,selectors:[["account-vatid-field"]],features:[r.Vt3],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],["class","slds-p-vertical--small",4,"ngIf"],[4,"ngIf"],[3,"fieldname","fieldconfig"],[1,"slds-p-vertical--small"],[3,"fielddisplayclass","fieldconfig","editable",4,"ngFor","ngForOf"],[3,"fielddisplayclass","fieldconfig","editable"],[2,"float","left","width","10px","height","10px","border-radius","5px","margin-top","5px","margin-right","5px",3,"ngStyle"],["class","slds-grid slds-grid--vertical-align-center",4,"ngFor","ngForOf"],[1,"slds-grid","slds-align-content-center","slds-p-vertical--x-small","slds-border--top"],[1,"slds-button","slds-button--icon-small","slds-button--icon-border"],["icon","add",3,"click"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-button","slds-button--icon-small","slds-button--icon-border","slds-m-right--x-small"],["icon","close",3,"click"],["class","slds-form-element slds-col slds-m-right--x-small",4,"ngIf"],["type","text",1,"slds-input",3,"ngModel","ngModelChange"],["focus",""],[1,"slds-col_bump-left","slds-grid","slds-grid--vertical-align-center"],["class","slds-m-left--x-small",3,"tooltiptext",4,"ngIf"],[1,"slds-button","slds-button--neutral","slds-m-left--x-small",3,"disabled","click"],["label","LBL_CHECK"],[1,"slds-form-element","slds-col","slds-m-right--x-small"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"fieldname"],[3,"value"],[1,"slds-m-left--x-small",3,"tooltiptext"]],template:function(t,e){1&t&&r.DNE(0,Ht,1,2,"field-label",0)(1,Kt,2,1,"div",1)(2,Qt,5,1,"div",2),2&t&&(r.Y8G("ngIf",e.displayLabel),r.R7$(),r.Y8G("ngIf",!e.isEditMode()),r.R7$(),r.Y8G("ngIf",e.isEditMode()))},dependencies:[i.YU,i.Sq,i.bT,i.B3,n.xH,n.y7,n.me,n.wz,n.BC,n.vS,ct.b,Lt.K,St.A,Gt.t,p.W,Vt.F],encapsulation:2})}return AccountVATIDField})();var te=s(41068),ee=s(50531),se=s(30991),ie=s(28933),ne=s(69139);function ae(t,e){if(1&t&&(r.j41(0,"div",19)(1,"div",20),r.EFF(2),r.k0s(),r.j41(3,"div",21),r.EFF(4),r.k0s()()),2&t){const t=e.$implicit;r.R7$(2),r.JRh(t.nace),r.R7$(2),r.JRh(t.label)}}let ce=(()=>{class AccountNACELoader{constructor(t,e,s){this.language=t,this.modal=e,this.backend=s,this.levels=1,this.treename="industrycodes",this.labelprefix="LBL_NACE_"}ngOnInit(){this.backend.getRequest("common/nace").subscribe({next:t=>{if(t&&t.length>0){let e=t.map((t=>({value:t,display:t})));this.modal.prompt("input",null,"select codes file","shade",null,e).subscribe({next:t=>{this.backend.getRequest("common/nace/"+t).subscribe({next:t=>{this.nacecoedsraw=t.content}})}})}}})}get parsedCodes(){if(!this.nacecoedsraw)return[];let t=[],e=this.nacecoedsraw.replace(/"/g,"").split(/\r?\n/);for(let s of e){let e=s.split(";");(0,te.yr)(parseInt(e[0],10))||parseInt(e[0],10)>this.levels||t.push({level:e[0],nace:e[1],label:e[3]})}return t}save(){this.backend.postRequest("common/nace",{},{treename:this.treename,labelprefix:this.labelprefix,nacecodes:this.parsedCodes}).subscribe({next:()=>{console.log("OK")}})}static#t=this.ɵfac=function(t){return new(t||AccountNACELoader)(r.rXU(f.B),r.rXU(ee.y),r.rXU(m.H))};static#e=this.ɵcmp=r.VBU({type:AccountNACELoader,selectors:[["account-nace-loadser"]],decls:27,vars:5,consts:[[1,"slds-grid","slds-grid_vertical-align-center","slds-p-around--small","slds-border--bottom"],["sprite","custom","icon","custom32"],[1,"slds-text-heading_medium"],["label","LBL_LOAD_NACE_CODES"],[1,"slds-col--bump-left","slds-grid","slds-grid--vertical-align-center"],["label","LBL_LEVELS"],[1,"slds-select_container","slds-m-horizontal--x-small"],[1,"slds-select",3,"ngModel","ngModelChange"],["label","LBL_TREENAME"],[1,"slds-m-horizontal--x-small",3,"ngModel","ngModelChange"],[1,"slds-button","slds-button--brand",3,"disabled","click"],["label","LBL_GENERATE"],["system-to-bottom-noscroll","",1,"slds-theme--default","slds-grid"],[1,"slds-size--1-of-2"],[1,"slds-form-element"],["system-to-bottom","",1,"slds-form-element__control"],[1,"slds-textarea",2,"height","calc(100% - 5px)",3,"ngModel","ngModelChange"],["system-to-bottom","",1,"slds-size--1-of-2","slds-p-horizontal--xx-small"],["class","slds-grid",4,"ngFor","ngForOf"],[1,"slds-grid"],[1,"slds-size--1-of-4"],[1,"slds-size--3-of-4"]],template:function(t,e){1&t&&(r.j41(0,"div",0),r.nrm(1,"system-icon",1),r.j41(2,"h2",2),r.nrm(3,"system-label",3),r.k0s(),r.j41(4,"div",4),r.nrm(5,"system-label",5),r.j41(6,"div",6)(7,"select",7),r.mxI("ngModelChange",(function(t){return r.DH7(e.levels,t)||(e.levels=t),t})),r.j41(8,"option"),r.EFF(9,"1"),r.k0s(),r.j41(10,"option"),r.EFF(11,"2"),r.k0s(),r.j41(12,"option"),r.EFF(13,"3"),r.k0s(),r.j41(14,"option"),r.EFF(15,"4"),r.k0s()()(),r.nrm(16,"system-label",8),r.j41(17,"system-input-text",9),r.mxI("ngModelChange",(function(t){return r.DH7(e.treename,t)||(e.treename=t),t})),r.k0s(),r.j41(18,"button",10),r.bIt("click",(function(){return e.save()})),r.nrm(19,"system-label",11),r.k0s()()(),r.j41(20,"div",12)(21,"div",13)(22,"div",14)(23,"div",15)(24,"textarea",16),r.mxI("ngModelChange",(function(t){return r.DH7(e.nacecoedsraw,t)||(e.nacecoedsraw=t),t})),r.k0s()()()(),r.j41(25,"div",17),r.DNE(26,ae,5,2,"div",18),r.k0s()()),2&t&&(r.R7$(7),r.R50("ngModel",e.levels),r.R7$(10),r.R50("ngModel",e.treename),r.R7$(),r.Y8G("disabled",0==e.parsedCodes.length||!e.treename),r.R7$(6),r.R50("ngModel",e.nacecoedsraw),r.R7$(2),r.Y8G("ngForOf",e.parsedCodes))},dependencies:[i.Sq,n.xH,n.y7,n.me,n.wz,n.BC,n.vS,kt.J,se.H,p.W,ie.b,ne.p],encapsulation:2})}return AccountNACELoader})(),oe=(()=>{class ModuleAccounts{static#t=this.ɵfac=function(t){return new(t||ModuleAccounts)};static#e=this.ɵmod=r.$C({type:ModuleAccounts});static#s=this.ɵinj=r.G2t({providers:[u],imports:[i.MD,n.YN,c.ObjectFields,o.GlobalComponents,l.ObjectComponents,d.SystemComponents,a.h]})}return ModuleAccounts})();("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(oe,{declarations:[D,U,A,E,H,tt,K,_t,at,Ct,Yt,Tt,Zt,ce],imports:[i.MD,n.YN,c.ObjectFields,o.GlobalComponents,l.ObjectComponents,d.SystemComponents,a.h]})}}]);