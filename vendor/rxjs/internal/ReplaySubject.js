"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("./Subject"),queue_1=require("./scheduler/queue"),Subscription_1=require("./Subscription"),observeOn_1=require("./operators/observeOn"),ObjectUnsubscribedError_1=require("./util/ObjectUnsubscribedError"),SubjectSubscription_1=require("./SubjectSubscription"),ReplaySubject=function(n){function e(e,t,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===t&&(t=Number.POSITIVE_INFINITY);var i=n.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return __extends(e,n),e.prototype.nextInfiniteTimeWindow=function(e){var t;this.isStopped||((t=this._events).push(e),t.length>this._bufferSize&&t.shift()),n.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new ReplayEvent(this._getNow(),e)),this._trimBufferThenGetEvents()),n.prototype.next.call(this,e)},e.prototype._subscribe=function(e){var t,r=this._infiniteTimeWindow,i=r?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,o=i.length;if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;if(t=this.isStopped||this.hasError?Subscription_1.Subscription.EMPTY:(this.observers.push(e),new SubjectSubscription_1.SubjectSubscription(this,e)),n&&e.add(e=new observeOn_1.ObserveOnSubscriber(e,n)),r)for(var s=0;s<o&&!e.closed;s++)e.next(i[s]);else for(s=0;s<o&&!e.closed;s++)e.next(i[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},e.prototype._getNow=function(){return(this.scheduler||queue_1.queue).now()},e.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,n=i.length,o=0;o<n&&!(e-i[o].time<r);)o++;return 0<(o=t<n?Math.max(o,n-t):o)&&i.splice(0,o),i},e}(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;var ReplayEvent=function(e,t){this.time=e,this.value=t};