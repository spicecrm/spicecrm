"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var AsyncAction_1=require("./AsyncAction"),AsyncScheduler_1=require("./AsyncScheduler"),VirtualTimeScheduler=function(i){function t(t,e){void 0===t&&(t=VirtualAction),void 0===e&&(e=Number.POSITIVE_INFINITY);var r=i.call(this,t,function(){return r.frame})||this;return r.maxFrames=e,r.frame=0,r.index=-1,r}return __extends(t,i),t.prototype.flush=function(){for(var t,e,r=this.actions,i=this.maxFrames;(e=r[0])&&e.delay<=i&&(r.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=r.shift();)e.unsubscribe();throw t}},t.frameTimeFactor=10,t}(AsyncScheduler_1.AsyncScheduler);exports.VirtualTimeScheduler=VirtualTimeScheduler;var VirtualAction=function(n){function i(t,e,r){void 0===r&&(r=t.index+=1);var i=n.call(this,t,e)||this;return i.scheduler=t,i.work=e,i.index=r,i.active=!0,i.index=t.index=r,i}return __extends(i,n),i.prototype.schedule=function(t,e){if(void 0===e&&(e=0),!this.id)return n.prototype.schedule.call(this,t,e);this.active=!1;var r=new i(this.scheduler,this.work);return this.add(r),r.schedule(t,e)},i.prototype.requestAsyncId=function(t,e,r){this.delay=t.frame+(r=void 0===r?0:r);t=t.actions;return t.push(this),t.sort(i.sortActions),!0},i.prototype.recycleAsyncId=function(t,e,r){void 0===r&&(r=0)},i.prototype._execute=function(t,e){if(!0===this.active)return n.prototype._execute.call(this,t,e)},i.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},i}(AsyncAction_1.AsyncAction);exports.VirtualAction=VirtualAction;